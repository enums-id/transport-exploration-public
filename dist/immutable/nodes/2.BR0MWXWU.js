import"../chunks/DsnmJJEf.js";import{aj as eR,b7 as ZF,bb as XF,a$ as YF,z as Ho,D as up,bc as KF,C as $2,az as tR,R as ed,$ as tp,ac as eT,g as A,aF as Yv,ay as JF,H as QF,T as cM,a3 as qg,y as Ql,E as nR,af as $F,F as Vw,bd as eB,be as K0,bf as J0,bg as Qf,bh as iR,a6 as rR,aR as tB,q as Uw,A as uM,bi as oR,I as nB,bj as yb,x as sR,Q as aR,bk as iB,bl as rB,a1 as lR,bm as oB,a5 as sB,bn as aB,B as Q0,t as Vi,bo as lB,ag as cB,a2 as uB,ae as jw,bp as hB,bq as dB,W as cR,br as fB,bs as pB,aY as mB,bt as gB,bu as _B,aA as uR,b as Ia,bv as yB,bw as hR,aP as vB,ax as Si,bx as xB,by as bB,bz as dR,v as $0,au as fR,bA as wB,aG as Ya,p as Yn,bB as sr,m as Xn,s as Tn,aw as Dn,n as Ln,k as je,l as Kn,aT as Gt,j as yt,aU as fe,bC as TB,aS as Mn,bD as hM,aH as rn,w as vb,bE as vs,u as ki,a as Os,bF as m_,i as Un,av as SB,ar as pR,aq as Kg,as as tT,bG as fa,S as Yu,aV as Za,bH as EB,b2 as nT,bI as np}from"../chunks/CT0Eg4TJ.js";import{p as Re,r as bi,s as Hn,i as Zt,c as mo,b as er}from"../chunks/D4-_LXrw.js";import{a as vv,b as AB,c as ld,o as bp,s as Es}from"../chunks/DGGl7C5H.js";import{a as Ii,s as Gi,c as Hg,S as Ua,b as Cr,d as Pr,e as _l,C as IB}from"../chunks/CPL0kpNk.js";import{i as iT}from"../chunks/xUt5fGsC.js";const MB=[];function Kv(s,n=!1,c=!1){return Jv(s,new Map,"",MB,null,c)}function Jv(s,n,c,m,_=null,x=!1){if(typeof s=="object"&&s!==null){var T=n.get(s);if(T!==void 0)return T;if(s instanceof Map)return new Map(s);if(s instanceof Set)return new Set(s);if(eR(s)){var r=Array(s.length);n.set(s,r),_!==null&&n.set(_,r);for(var I=0;I<s.length;I+=1){var k=s[I];I in s&&(r[I]=Jv(k,n,c,m,null,x))}return r}if(ZF(s)===XF){r={},n.set(s,r),_!==null&&n.set(_,r);for(var P in s)r[P]=Jv(s[P],n,c,m,null,x);return r}if(s instanceof Date)return structuredClone(s);if(typeof s.toJSON=="function"&&!x)return Jv(s.toJSON(),n,c,m,s)}if(s instanceof EventTarget)return s;try{return structuredClone(s)}catch{return s}}function CB(){return Symbol(YF)}function ex(s,n,c){Ho&&up();var m=new tR(s),_=!KF();$2(()=>{var x=n();_&&x!==null&&typeof x=="object"&&(x={}),m.ensure(x,c)})}function cs(s,n){return n}function PB(s,n,c){for(var m=s.items,_=[],x=n.length,T=0;T<x;T++)oB(n[T].e,_,!0);var r=x>0&&_.length===0&&c!==null;if(r){var I=c.parentNode;sB(I),I.append(c),m.clear(),Jl(s,n[0].prev,n[x-1].next)}aB(_,()=>{for(var k=0;k<x;k++){var P=n[k];r||(m.delete(P.k),Jl(s,P.prev,P.next)),aR(P.e,!r)}})}function ro(s,n,c,m,_,x=null){var T=s,r={flags:n,items:new Map,first:null},I=(n&iR)!==0;if(I){var k=s;T=Ho?ed(tp(k)):k.appendChild(eT())}Ho&&up();var P=null,R=!1,F=new Map,V=Yv(()=>{var Y=c();return eR(Y)?Y:Y==null?[]:rR(Y)}),W,G;function K(){kB(G,W,r,F,T,_,n,m,c),x!==null&&(W.length===0?P?oR(P):P=Vw(()=>x(T)):P!==null&&nB(P,()=>{P=null}))}$2(()=>{G??=Q0,W=A(V);var Y=W.length;if(R&&Y===0)return;R=Y===0;let ne=!1;if(Ho){var oe=JF(T)===QF;oe!==(Y===0)&&(T=cM(),ed(T),qg(!1),ne=!0)}if(Ho){for(var ce=null,me,ue=0;ue<Y;ue++){if(Ql.nodeType===nR&&Ql.data===$F){T=Ql,ne=!0,qg(!1);break}var _e=W[ue],te=m(_e,ue);me=Gw(Ql,r,ce,null,_e,te,ue,_,n,c),r.items.set(te,me),ce=me}Y>0&&ed(cM())}if(Ho)Y===0&&x&&(P=Vw(()=>x(T)));else if(eB()){var ie=new Set,xe=Qf;for(ue=0;ue<Y;ue+=1){_e=W[ue],te=m(_e,ue);var de=r.items.get(te)??F.get(te);de?(n&(K0|J0))!==0&&mR(de,_e,ue,n):(me=Gw(null,r,null,null,_e,te,ue,_,n,c,!0),F.set(te,me)),ie.add(te)}for(const[Te,De]of r.items)ie.has(Te)||xe.skipped_effects.add(De.e);xe.add_callback(K)}else K();ne&&qg(!0),A(V)}),Ho&&(T=Ql)}function kB(s,n,c,m,_,x,T,r,I){var k=(T&rB)!==0,P=(T&(K0|J0))!==0,R=n.length,F=c.items,V=c.first,W=V,G,K=null,Y,ne=[],oe=[],ce,me,ue,_e;if(k)for(_e=0;_e<R;_e+=1)ce=n[_e],me=r(ce,_e),ue=F.get(me),ue!==void 0&&(ue.a?.measure(),(Y??=new Set).add(ue));for(_e=0;_e<R;_e+=1){if(ce=n[_e],me=r(ce,_e),ue=F.get(me),ue===void 0){var te=m.get(me);if(te!==void 0){m.delete(me),F.set(me,te);var ie=K?K.next:W;Jl(c,K,te),Jl(c,te,ie),xb(te,ie,_),K=te}else{var xe=W?W.e.nodes_start:_;K=Gw(xe,c,K,K===null?c.first:K.next,ce,me,_e,x,T,I)}F.set(me,K),ne=[],oe=[],W=K.next;continue}if(P&&mR(ue,ce,_e,T),(ue.e.f&yb)!==0&&(oR(ue.e),k&&(ue.a?.unfix(),(Y??=new Set).delete(ue))),ue!==W){if(G!==void 0&&G.has(ue)){if(ne.length<oe.length){var de=oe[0],Te;K=de.prev;var De=ne[0],Be=ne[ne.length-1];for(Te=0;Te<ne.length;Te+=1)xb(ne[Te],de,_);for(Te=0;Te<oe.length;Te+=1)G.delete(oe[Te]);Jl(c,De.prev,Be.next),Jl(c,K,De),Jl(c,Be,de),W=de,K=Be,_e-=1,ne=[],oe=[]}else G.delete(ue),xb(ue,W,_),Jl(c,ue.prev,ue.next),Jl(c,ue,K===null?c.first:K.next),Jl(c,K,ue),K=ue;continue}for(ne=[],oe=[];W!==null&&W.k!==me;)(W.e.f&yb)===0&&(G??=new Set).add(W),oe.push(W),W=W.next;if(W===null)continue;ue=W}ne.push(ue),K=ue,W=ue.next}if(W!==null||G!==void 0){for(var Se=G===void 0?[]:rR(G);W!==null;)(W.e.f&yb)===0&&Se.push(W),W=W.next;var Ne=Se.length;if(Ne>0){var it=(T&iR)!==0&&R===0?_:null;if(k){for(_e=0;_e<Ne;_e+=1)Se[_e].a?.measure();for(_e=0;_e<Ne;_e+=1)Se[_e].a?.fix()}PB(c,Se,it)}}k&&sR(()=>{if(Y!==void 0)for(ue of Y)ue.a?.apply()}),s.first=c.first&&c.first.e,s.last=K&&K.e;for(var qe of m.values())aR(qe.e);m.clear()}function mR(s,n,c,m){(m&K0)!==0&&uM(s.v,n),(m&J0)!==0?uM(s.i,c):s.i=c}function Gw(s,n,c,m,_,x,T,r,I,k,P){var R=(I&K0)!==0,F=(I&iB)===0,V=R?F?tB(_,!1,!1):Uw(_):_,W=(I&J0)===0?T:Uw(T),G={i:W,v:V,k:x,a:null,e:null,prev:c,next:m};try{if(s===null){var K=document.createDocumentFragment();K.append(s=eT())}return G.e=Vw(()=>r(s,V,W,k),Ho),G.e.prev=c&&c.e,G.e.next=m&&m.e,c===null?P||(n.first=G):(c.next=G,c.e.next=G.e),m!==null&&(m.prev=G,m.e.prev=G.e),G}finally{}}function xb(s,n,c){for(var m=s.next?s.next.e.nodes_start:c,_=n?n.e.nodes_start:c,x=s.e.nodes_start;x!==null&&x!==m;){var T=lR(x);_.before(x),x=T}}function Jl(s,n,c){n===null?s.first=c:(n.next=c,n.e.next=c&&c.e),c!==null&&(c.prev=n,c.e.prev=n&&n.e)}function RB(s,n,c=!1,m=!1,_=!1){var x=s,T="";Vi(()=>{var r=Q0;if(T===(T=n()??"")){Ho&&up();return}if(r.nodes_start!==null&&(lB(r.nodes_start,r.nodes_end),r.nodes_start=r.nodes_end=null),T!==""){if(Ho){Ql.data;for(var I=up(),k=I;I!==null&&(I.nodeType!==nR||I.data!=="");)k=I,I=lR(I);if(I===null)throw cB(),uB;jw(Ql,k),x=ed(I);return}var P=T+"";c?P=`<svg>${P}</svg>`:m&&(P=`<math>${P}</math>`);var R=hB(P);if((c||m)&&(R=tp(R)),jw(tp(R),R.lastChild),c||m)for(;tp(R);)x.before(tp(R));else x.before(R)}})}function gR(s,n,c,m,_,x){let T=Ho;Ho&&up();var r=null;Ho&&Ql.nodeType===dB&&(r=Ql,up());var I=Ho?Ql:s,k=new tR(I,!1);$2(()=>{const P=n()||null;var R=c||P==="svg"?fB:null;if(P===null){k.ensure(null,null),vv(!0);return}return k.ensure(P,F=>{if(P){if(r=Ho?r:R?document.createElementNS(R,P):document.createElement(P),jw(r,r),m){Ho&&pB(P)&&r.append(document.createComment(""));var V=Ho?tp(r):r.appendChild(eT());Ho&&(V===null?qg(!1):ed(V)),m(r,V)}Q0.nodes_end=r,F.before(r)}Ho&&ed(F)}),vv(!0),()=>{P&&vv(!1)}},cR),mB(()=>{vv(!0)}),T&&(qg(!0),ed(I))}const zB=()=>performance.now(),hl={tick:s=>requestAnimationFrame(s),now:()=>zB(),tasks:new Set};function _R(){const s=hl.now();hl.tasks.forEach(n=>{n.c(s)||(hl.tasks.delete(n),n.f())}),hl.tasks.size!==0&&hl.tick(_R)}function rT(s){let n;return hl.tasks.size===0&&hl.tick(_R),{promise:new Promise(c=>{hl.tasks.add(n={c:s,f:c})}),abort(){hl.tasks.delete(n)}}}function xv(s,n){hR(()=>{s.dispatchEvent(new CustomEvent(n))})}function DB(s){if(s==="float")return"cssFloat";if(s==="offset")return"cssOffset";if(s.startsWith("--"))return s;const n=s.split("-");return n.length===1?n[0]:n[0]+n.slice(1).map(c=>c[0].toUpperCase()+c.slice(1)).join("")}function dM(s){const n={},c=s.split(";");for(const m of c){const[_,x]=m.split(":");if(!_||x===void 0)break;const T=DB(_.trim());n[T]=x.trim()}return n}const LB=s=>s;function o0(s,n,c,m){var _=(s&xB)!==0,x=(s&bB)!==0,T=_&&x,r=(s&yB)!==0,I=T?"both":_?"in":"out",k,P=n.inert,R=n.style.overflow,F,V;function W(){return hR(()=>k??=c()(n,m?.()??{},{direction:I}))}var G={is_global:r,in(){if(n.inert=P,!_){V?.abort(),V?.reset?.();return}x||F?.abort(),xv(n,"introstart"),F=Ww(n,W(),V,1,()=>{xv(n,"introend"),F?.abort(),F=k=void 0,n.style.overflow=R})},out(oe){if(!x){oe?.(),k=void 0;return}n.inert=!0,xv(n,"outrostart"),V=Ww(n,W(),F,0,()=>{xv(n,"outroend"),oe?.()})},stop:()=>{F?.abort(),V?.abort()}},K=Q0;if((K.transitions??=[]).push(G),_&&AB){var Y=r;if(!Y){for(var ne=K.parent;ne&&(ne.f&cR)!==0;)for(;(ne=ne.parent)&&(ne.f&gB)===0;);Y=!ne||(ne.f&_B)!==0}Y&&uR(()=>{Ia(()=>G.in())})}}function Ww(s,n,c,m,_){var x=m===1;if(vB(n)){var T,r=!1;return sR(()=>{if(!r){var K=n({direction:x?"in":"out"});T=Ww(s,K,c,m,_)}}),{abort:()=>{r=!0,T?.abort()},deactivate:()=>T.deactivate(),reset:()=>T.reset(),t:()=>T.t()}}if(c?.deactivate(),!n?.duration)return _(),{abort:Si,deactivate:Si,reset:Si,t:()=>m};const{delay:I=0,css:k,tick:P,easing:R=LB}=n;var F=[];if(x&&c===void 0&&(P&&P(0,1),k)){var V=dM(k(0,1));F.push(V,V)}var W=()=>1-m,G=s.animate(F,{duration:I,fill:"forwards"});return G.onfinish=()=>{G.cancel();var K=c?.t()??1-m;c?.abort();var Y=m-K,ne=n.duration*Math.abs(Y),oe=[];if(ne>0){var ce=!1;if(k)for(var me=Math.ceil(ne/16.666666666666668),ue=0;ue<=me;ue+=1){var _e=K+Y*R(ue/me),te=dM(k(_e,1-_e));oe.push(te),ce||=te.overflow==="hidden"}ce&&(s.style.overflow="hidden"),W=()=>{var ie=G.currentTime;return K+Y*R(ie/ne)},P&&rT(()=>{if(G.playState!=="running")return!1;var ie=W();return P(ie,1-ie),!0})}G=s.animate(oe,{duration:ne,fill:"forwards"}),G.onfinish=()=>{W=()=>m,P?.(m,1-m),_()}},{abort:()=>{G&&(G.cancel(),G.effect=null,G.onfinish=Si)},deactivate:()=>{_=Si},reset:()=>{m===0&&P?.(1,0)},t:()=>W()}}function fM(s,n,c=n){var m=new WeakSet;dR(s,"input",async _=>{var x=_?s.defaultValue:s.value;if(x=bb(s)?wb(x):x,c(x),Qf!==null&&m.add(Qf),await fR(),x!==(x=n())){var T=s.selectionStart,r=s.selectionEnd,I=s.value.length;if(s.value=x??"",r!==null){var k=s.value.length;T===r&&r===I&&k>I?(s.selectionStart=k,s.selectionEnd=k):(s.selectionStart=T,s.selectionEnd=Math.min(r,k))}}}),(Ho&&s.defaultValue!==s.value||Ia(n)==null&&s.value)&&(c(bb(s)?wb(s.value):s.value),Qf!==null&&m.add(Qf)),$0(()=>{var _=n();if(s===document.activeElement){var x=wB??Qf;if(m.has(x))return}bb(s)&&_===wb(s.value)||s.type==="date"&&!_&&!s.value||_!==s.value&&(s.value=_??"")})}function bb(s){var n=s.type;return n==="number"||n==="range"}function wb(s){return s===""?null:+s}function OB(s,n,c=n){dR(s,"change",()=>{c(s.files)}),Ho&&s.files&&c(s.files),$0(()=>{s.files=n()})}class oT{#t=new WeakMap;#e;#i;static entries=new WeakMap;constructor(n){this.#i=n}observe(n,c){var m=this.#t.get(n)||new Set;return m.add(c),this.#t.set(n,m),this.#n().observe(n,this.#i),()=>{var _=this.#t.get(n);_.delete(c),_.size===0&&(this.#t.delete(n),this.#e.unobserve(n))}}#n(){return this.#e??(this.#e=new ResizeObserver(n=>{for(var c of n){oT.entries.set(c.target,c);for(var m of this.#t.get(c.target)||[])m(c)}}))}}var FB=new oT({box:"border-box"});function s0(s,n,c){var m=FB.observe(s,()=>c(s[n]));uR(()=>(Ia(()=>c(s[n])),m))}function yR(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Qv={exports:{}},BB=Qv.exports,pM;function NB(){return pM||(pM=1,(function(s,n){(function(c,m){s.exports=m()})(BB,(function(){var c,m,_;function x(r,I){if(!c)c=I;else if(!m)m=I;else{var k="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",P={};c(P),_=I(P),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([k],{type:"text/javascript"})))}}x(["exports"],(function(r){var I=1e-6,k=typeof Float32Array<"u"?Float32Array:Array;function P(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],p=i*f-u*l;return p?(o[0]=f*(p=1/p),o[1]=-l*p,o[2]=-u*p,o[3]=i*p,o):null}function R(){var o=new k(9);return k!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function F(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],p=e[4],v=e[5],w=e[6],E=e[7],C=e[8];return o[0]=p*C-v*E,o[1]=u*E-l*C,o[2]=l*v-u*p,o[3]=v*w-f*C,o[4]=i*C-u*w,o[5]=u*f-i*v,o[6]=f*E-p*w,o[7]=l*w-i*E,o[8]=i*p-l*f,o}function V(o,e,i){var l=e[0],u=e[1],f=e[2],p=e[3],v=e[4],w=e[5],E=e[6],C=e[7],z=e[8],L=i[0],N=i[1],U=i[2],X=i[3],J=i[4],Q=i[5],le=i[6],he=i[7],ge=i[8];return o[0]=L*l+N*p+U*E,o[1]=L*u+N*v+U*C,o[2]=L*f+N*w+U*z,o[3]=X*l+J*p+Q*E,o[4]=X*u+J*v+Q*C,o[5]=X*f+J*w+Q*z,o[6]=le*l+he*p+ge*E,o[7]=le*u+he*v+ge*C,o[8]=le*f+he*w+ge*z,o}function W(){var o=new k(16);return k!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o}function G(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function K(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],p=e[4],v=e[5],w=e[6],E=e[7],C=e[8],z=e[9],L=e[10],N=e[11],U=e[12],X=e[13],J=e[14],Q=e[15],le=i*v-l*p,he=i*w-u*p,ge=i*E-f*p,Le=l*w-u*v,Oe=l*E-f*v,Ve=u*E-f*w,We=C*X-z*U,He=C*J-L*U,Tt=C*Q-N*U,Ke=z*J-L*X,Et=z*Q-N*X,Ft=L*Q-N*J,It=le*Ft-he*Et+ge*Ke+Le*Tt-Oe*He+Ve*We;return It?(o[0]=(v*Ft-w*Et+E*Ke)*(It=1/It),o[1]=(u*Et-l*Ft-f*Ke)*It,o[2]=(X*Ve-J*Oe+Q*Le)*It,o[3]=(L*Oe-z*Ve-N*Le)*It,o[4]=(w*Tt-p*Ft-E*He)*It,o[5]=(i*Ft-u*Tt+f*He)*It,o[6]=(J*ge-U*Ve-Q*he)*It,o[7]=(C*Ve-L*ge+N*he)*It,o[8]=(p*Et-v*Tt+E*We)*It,o[9]=(l*Tt-i*Et-f*We)*It,o[10]=(U*Oe-X*ge+Q*le)*It,o[11]=(z*ge-C*Oe-N*le)*It,o[12]=(v*He-p*Ke-w*We)*It,o[13]=(i*Ke-l*He+u*We)*It,o[14]=(X*he-U*Le-J*le)*It,o[15]=(C*Le-z*he+L*le)*It,o):null}function Y(o,e,i){var l=e[0],u=e[1],f=e[2],p=e[3],v=e[4],w=e[5],E=e[6],C=e[7],z=e[8],L=e[9],N=e[10],U=e[11],X=e[12],J=e[13],Q=e[14],le=e[15],he=i[0],ge=i[1],Le=i[2],Oe=i[3];return o[0]=he*l+ge*v+Le*z+Oe*X,o[1]=he*u+ge*w+Le*L+Oe*J,o[2]=he*f+ge*E+Le*N+Oe*Q,o[3]=he*p+ge*C+Le*U+Oe*le,o[4]=(he=i[4])*l+(ge=i[5])*v+(Le=i[6])*z+(Oe=i[7])*X,o[5]=he*u+ge*w+Le*L+Oe*J,o[6]=he*f+ge*E+Le*N+Oe*Q,o[7]=he*p+ge*C+Le*U+Oe*le,o[8]=(he=i[8])*l+(ge=i[9])*v+(Le=i[10])*z+(Oe=i[11])*X,o[9]=he*u+ge*w+Le*L+Oe*J,o[10]=he*f+ge*E+Le*N+Oe*Q,o[11]=he*p+ge*C+Le*U+Oe*le,o[12]=(he=i[12])*l+(ge=i[13])*v+(Le=i[14])*z+(Oe=i[15])*X,o[13]=he*u+ge*w+Le*L+Oe*J,o[14]=he*f+ge*E+Le*N+Oe*Q,o[15]=he*p+ge*C+Le*U+Oe*le,o}function ne(o,e,i){var l,u,f,p,v,w,E,C,z,L,N,U,X=i[0],J=i[1],Q=i[2];return e===o?(o[12]=e[0]*X+e[4]*J+e[8]*Q+e[12],o[13]=e[1]*X+e[5]*J+e[9]*Q+e[13],o[14]=e[2]*X+e[6]*J+e[10]*Q+e[14],o[15]=e[3]*X+e[7]*J+e[11]*Q+e[15]):(u=e[1],f=e[2],p=e[3],v=e[4],w=e[5],E=e[6],C=e[7],z=e[8],L=e[9],N=e[10],U=e[11],o[0]=l=e[0],o[1]=u,o[2]=f,o[3]=p,o[4]=v,o[5]=w,o[6]=E,o[7]=C,o[8]=z,o[9]=L,o[10]=N,o[11]=U,o[12]=l*X+v*J+z*Q+e[12],o[13]=u*X+w*J+L*Q+e[13],o[14]=f*X+E*J+N*Q+e[14],o[15]=p*X+C*J+U*Q+e[15]),o}function oe(o,e,i){var l=i[0],u=i[1],f=i[2];return o[0]=e[0]*l,o[1]=e[1]*l,o[2]=e[2]*l,o[3]=e[3]*l,o[4]=e[4]*u,o[5]=e[5]*u,o[6]=e[6]*u,o[7]=e[7]*u,o[8]=e[8]*f,o[9]=e[9]*f,o[10]=e[10]*f,o[11]=e[11]*f,o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o}function ce(o,e,i){var l=Math.sin(i),u=Math.cos(i),f=e[4],p=e[5],v=e[6],w=e[7],E=e[8],C=e[9],z=e[10],L=e[11];return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[4]=f*u+E*l,o[5]=p*u+C*l,o[6]=v*u+z*l,o[7]=w*u+L*l,o[8]=E*u-f*l,o[9]=C*u-p*l,o[10]=z*u-v*l,o[11]=L*u-w*l,o}function me(o,e,i){var l=Math.sin(i),u=Math.cos(i),f=e[0],p=e[1],v=e[2],w=e[3],E=e[8],C=e[9],z=e[10],L=e[11];return e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=f*u-E*l,o[1]=p*u-C*l,o[2]=v*u-z*l,o[3]=w*u-L*l,o[8]=f*l+E*u,o[9]=p*l+C*u,o[10]=v*l+z*u,o[11]=w*l+L*u,o}function ue(o,e,i){var l=Math.sin(i),u=Math.cos(i),f=e[0],p=e[1],v=e[2],w=e[3],E=e[4],C=e[5],z=e[6],L=e[7];return e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=f*u+E*l,o[1]=p*u+C*l,o[2]=v*u+z*l,o[3]=w*u+L*l,o[4]=E*u-f*l,o[5]=C*u-p*l,o[6]=z*u-v*l,o[7]=L*u-w*l,o}function _e(o,e){return o[0]=e[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=e[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function te(o,e,i){var l,u,f,p=i[0],v=i[1],w=i[2],E=Math.sqrt(p*p+v*v+w*w);return E<I?null:(p*=E=1/E,v*=E,w*=E,l=Math.sin(e),u=Math.cos(e),o[0]=p*p*(f=1-u)+u,o[1]=v*p*f+w*l,o[2]=w*p*f-v*l,o[3]=0,o[4]=p*v*f-w*l,o[5]=v*v*f+u,o[6]=w*v*f+p*l,o[7]=0,o[8]=p*w*f+v*l,o[9]=v*w*f-p*l,o[10]=w*w*f+u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}function ie(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],p=i+i,v=l+l,w=u+u,E=i*p,C=l*p,z=l*v,L=u*p,N=u*v,U=u*w,X=f*p,J=f*v,Q=f*w;return o[0]=1-z-U,o[1]=C+Q,o[2]=L-J,o[3]=0,o[4]=C-Q,o[5]=1-E-U,o[6]=N+X,o[7]=0,o[8]=L+J,o[9]=N-X,o[10]=1-E-z,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}var xe=Y;function de(){var o=new k(3);return k!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Te(o){var e=new k(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e}function De(o){var e=o[0],i=o[1],l=o[2];return Math.sqrt(e*e+i*i+l*l)}function Be(o,e,i){var l=new k(3);return l[0]=o,l[1]=e,l[2]=i,l}function Se(o,e,i,l){return o[0]=e,o[1]=i,o[2]=l,o}function Ne(o,e,i){return o[0]=e[0]+i[0],o[1]=e[1]+i[1],o[2]=e[2]+i[2],o}function it(o,e,i){return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],o}function qe(o,e,i){return o[0]=e[0]*i[0],o[1]=e[1]*i[1],o[2]=e[2]*i[2],o}function ft(o,e,i){return o[0]=Math.min(e[0],i[0]),o[1]=Math.min(e[1],i[1]),o[2]=Math.min(e[2],i[2]),o}function St(o,e,i){return o[0]=Math.max(e[0],i[0]),o[1]=Math.max(e[1],i[1]),o[2]=Math.max(e[2],i[2]),o}function Dt(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o[2]=e[2]*i,o}function Kt(o,e,i,l){return o[0]=e[0]+i[0]*l,o[1]=e[1]+i[1]*l,o[2]=e[2]+i[2]*l,o}function et(o,e){var i=e[0]-o[0],l=e[1]-o[1],u=e[2]-o[2];return i*i+l*l+u*u}function Qe(o){var e=o[0],i=o[1],l=o[2];return e*e+i*i+l*l}function st(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o}function tt(o,e){var i=e[0],l=e[1],u=e[2],f=i*i+l*l+u*u;return f>0&&(f=1/Math.sqrt(f)),o[0]=e[0]*f,o[1]=e[1]*f,o[2]=e[2]*f,o}function gt(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function Lt(o,e,i){var l=e[0],u=e[1],f=e[2],p=i[0],v=i[1],w=i[2];return o[0]=u*w-f*v,o[1]=f*p-l*w,o[2]=l*v-u*p,o}function _t(o,e,i,l){var u=e[0],f=e[1],p=e[2];return o[0]=u+l*(i[0]-u),o[1]=f+l*(i[1]-f),o[2]=p+l*(i[2]-p),o}function Je(o,e,i){var l=e[0],u=e[1],f=e[2],p=i[3]*l+i[7]*u+i[11]*f+i[15];return o[0]=(i[0]*l+i[4]*u+i[8]*f+i[12])/(p=p||1),o[1]=(i[1]*l+i[5]*u+i[9]*f+i[13])/p,o[2]=(i[2]*l+i[6]*u+i[10]*f+i[14])/p,o}function Rt(o,e,i){var l=e[0],u=e[1],f=e[2];return o[0]=l*i[0]+u*i[3]+f*i[6],o[1]=l*i[1]+u*i[4]+f*i[7],o[2]=l*i[2]+u*i[5]+f*i[8],o}function ut(o,e,i){var l=i[0],u=i[1],f=i[2],p=i[3],v=e[0],w=e[1],E=e[2],C=u*E-f*w,z=f*v-l*E,L=l*w-u*v;return o[0]=v+p*(C+=C)+u*(L+=L)-f*(z+=z),o[1]=w+p*z+f*C-l*L,o[2]=E+p*L+l*z-u*C,o}function cn(o){return o[0]=0,o[1]=0,o[2]=0,o}function on(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]}var Jt=it,vt=qe,zt=De;function fn(){var o=new k(4);return k!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function Gn(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o[2]=e[2]*i,o[3]=e[3]*i,o}function Wn(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],p=i*i+l*l+u*u+f*f;return p>0&&(p=1/Math.sqrt(p)),o[0]=i*p,o[1]=l*p,o[2]=u*p,o[3]=f*p,o}function ti(o,e,i){var l=e[0],u=e[1],f=e[2],p=e[3];return o[0]=i[0]*l+i[4]*u+i[8]*f+i[12]*p,o[1]=i[1]*l+i[5]*u+i[9]*f+i[13]*p,o[2]=i[2]*l+i[6]*u+i[10]*f+i[14]*p,o[3]=i[3]*l+i[7]*u+i[11]*f+i[15]*p,o}function yi(){var o=new k(4);return k!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Ri(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function ur(o,e,i){i*=.5;var l=e[0],u=e[1],f=e[2],p=e[3],v=Math.sin(i),w=Math.cos(i);return o[0]=l*w+p*v,o[1]=u*w+f*v,o[2]=f*w-u*v,o[3]=p*w-l*v,o}function wi(o,e,i){i*=.5;var l=e[0],u=e[1],f=e[2],p=e[3],v=Math.sin(i),w=Math.cos(i);return o[0]=l*w-f*v,o[1]=u*w+p*v,o[2]=f*w+l*v,o[3]=p*w-u*v,o}de(),fn();var Oi,zi,qi,ir=Wn,$r=(Oi=de(),zi=Be(1,0,0),qi=Be(0,1,0),function(o,e,i){var l=gt(e,i);return l<-.999999?(Lt(Oi,zi,e),zt(Oi)<1e-6&&Lt(Oi,qi,e),tt(Oi,Oi),(function(u,f,p){p*=.5;var v=Math.sin(p);u[0]=v*f[0],u[1]=v*f[1],u[2]=v*f[2],u[3]=Math.cos(p)})(o,Oi,Math.PI),o):l>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(Lt(Oi,e,i),o[0]=Oi[0],o[1]=Oi[1],o[2]=Oi[2],o[3]=1+l,ir(o,o))});function lr(){var o=new k(2);return k!=Float32Array&&(o[0]=0,o[1]=0),o}function hr(o,e){var i=new k(2);return i[0]=o,i[1]=e,i}function uo(o,e,i){return o[0]=e,o[1]=i,o}function oo(o,e,i){return o[0]=e[0]+i[0],o[1]=e[1]+i[1],o}function ho(o,e,i){return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o}function Co(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o}function us(o){var e=o[0],i=o[1];return Math.sqrt(e*e+i*i)}function rr(o,e){var i=e[0],l=e[1],u=i*i+l*l;return u>0&&(u=1/Math.sqrt(u)),o[0]=e[0]*u,o[1]=e[1]*u,o}function ar(o,e){return o[0]*e[0]+o[1]*e[1]}yi(),yi(),R();var Zo,to,qr=ho;function Xo(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}lr();var Uo=(function(){if(to)return Zo;function o(e,i,l,u){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=l,this.p2y=u}return to=1,Zo=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,u=0;u<8;u++){var f=this.sampleCurveX(l)-e;if(Math.abs(f)<i)return l;var p=this.sampleCurveDerivativeX(l);if(Math.abs(p)<1e-6)break;l-=f/p}var v=0,w=1;for(l=e,u=0;u<20&&(f=this.sampleCurveX(l),!(Math.abs(f-e)<i));u++)e>f?v=l:w=l,l=.5*(w-v)+v;return l},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Zo})(),Po=Xo(Uo);function Mt(o,e){this.x=o,this.y=e}function fo(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(!fo(o[i],e[i]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const i in o)if(!fo(o[i],e[i]))return!1;return!0}return o===e}Mt.prototype={clone(){return new Mt(this.x,this.y)},add(o){return this.clone()._add(o)},sub(o){return this.clone()._sub(o)},multByPoint(o){return this.clone()._multByPoint(o)},divByPoint(o){return this.clone()._divByPoint(o)},mult(o){return this.clone()._mult(o)},div(o){return this.clone()._div(o)},rotate(o){return this.clone()._rotate(o)},rotateAround(o,e){return this.clone()._rotateAround(o,e)},matMult(o){return this.clone()._matMult(o)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(o){return this.x===o.x&&this.y===o.y},dist(o){return Math.sqrt(this.distSqr(o))},distSqr(o){const e=o.x-this.x,i=o.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith(o){return this.angleWithSep(o.x,o.y)},angleWithSep(o,e){return Math.atan2(this.x*e-this.y*o,this.x*o+this.y*e)},_matMult(o){const e=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=e,this},_add(o){return this.x+=o.x,this.y+=o.y,this},_sub(o){return this.x-=o.x,this.y-=o.y,this},_mult(o){return this.x*=o,this.y*=o,this},_div(o){return this.x/=o,this.y/=o,this},_multByPoint(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint(o){return this.x/=o.x,this.y/=o.y,this},_unit(){return this._div(this.mag()),this},_perp(){const o=this.y;return this.y=this.x,this.x=-o,this},_rotate(o){const e=Math.cos(o),i=Math.sin(o),l=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=l,this},_rotateAround(o,e){const i=Math.cos(o),l=Math.sin(o),u=e.y+l*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-l*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Mt},Mt.convert=function(o){if(o instanceof Mt)return o;if(Array.isArray(o))return new Mt(+o[0],+o[1]);if(o.x!==void 0&&o.y!==void 0)return new Mt(+o.x,+o.y);throw new Error("Expected [x, y] or {x, y} point format")};const Yo=Math.PI/180,jo=180/Math.PI;function Xe(o){return o*Yo}function ee(o){return o*jo}const se=[[0,0],[1,0],[1,1],[0,1]];function we(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,i=e*o;return 4*(o<.5?i:3*(o-e)+i-.75)}function Fe(o,e,i,l){const u=new Po(o,e,i,l);return function(f){return u.solve(f)}}const Ie=Fe(.25,.1,.25,1);function Pe(o,e,i){return Math.min(i,Math.max(e,o))}function nt(o,e,i){return(i=Pe((i-o)/(e-o),0,1))*i*(3-2*i)}function Ge(o,e,i){const l=i-e,u=((o-e)%l+l)%l+e;return u===e?i:u}function at(o,e,i){if(!o.length)return i(null,[]);let l=o.length;const u=new Array(o.length);let f=null;o.forEach(((p,v)=>{e(p,((w,E)=>{w&&(f=w),u[v]=E,--l==0&&i(f,u)}))}))}let Bt=1;function At(){return Bt++}function dn(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log2(o)))}function An(o,e){o.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function Nn(o,e,i){const l={};for(const u in o)l[u]=e.call(this,o[u],u,o);return l}function hi(o,e,i){const l={};for(const u in o)e.call(this,o[u],u,o)&&(l[u]=o[u]);return l}function kn(o){return Array.isArray(o)?o.map(kn):typeof o=="object"&&o?Nn(o,kn):o}function Qn(o,e){for(let i=0;i<o.length;i++)if(e.indexOf(o[i])>=0)return!0;return!1}const Mi={};function oi(o){Mi[o]||(typeof console<"u"&&console.warn(o),Mi[o]=!0)}function Ui(o,e,i){return(i.y-o.y)*(e.x-o.x)>(e.y-o.y)*(i.x-o.x)}function Er(o){let e=0;for(let i,l,u=0,f=o.length,p=f-1;u<f;p=u++)i=o[u],l=o[p],e+=(l.x-i.x)*(i.y+l.y);return e}function so([o,e,i]){const l=Xe(e+90),u=Xe(i);return{x:o*Math.cos(l)*Math.sin(u),y:o*Math.sin(l)*Math.sin(u),z:o*Math.cos(u),azimuthal:e,polar:i}}function tr(o){return(typeof self<"u"||o!==void 0)&&typeof WorkerGlobalScope<"u"&&(o!==void 0?o:self)instanceof WorkerGlobalScope}function Ci(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,l,u,f)=>{const p=u||f;return e[l]=!p||p.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Vr=null;function zr(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function mr(o,e,i,l){for(;e<i;){const u=e+i>>1;o[u]<l?e=u+1:i=u}return e}function So(o,e,i,l){for(;e<i;){const u=e+i>>1;o[u]<=l?e=u+1:i=u}return e}function is(o){return o>0?1/(1.001-o):1+o}function rs(o){return o>0?1-1/(1.001-o):-o}function Ma(o,e,i){return(o-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Fo={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Fo.API_URL)return null;try{const o=new URL(Fo.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function wl(o){return Fo.API_URL_REGEX.test(o)}function A_(o){return Fo.API_SPRITE_REGEX.test(o)}let Tl,$c,th,nh,Sl,ih;function Cp(){return Tl==null&&(Tl=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Tl}const Ca={now:()=>nh!==void 0?nh:performance.now(),setNow(o){nh=o},restoreNow(){nh=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:i,height:l}=o;Sl||(Sl=document.createElement("canvas"));const u=Sl.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>Sl.width||l>Sl.height)&&(Sl.width=i,Sl.height=l),u.clearRect(-e,-e,i+2*e,l+2*e),u.drawImage(o,0,0,i,l),u.getImageData(-e,-e,i+2*e,l+2*e)},resolveURL:o=>($c||($c=document.createElement("a")),$c.href=o,$c.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(th==null&&(th=window.matchMedia("(prefers-reduced-motion: reduce)")),th.matches)},hasCanvasFingerprintNoise(){if(ih!==void 0)return ih;if(!Cp())return ih=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let i=0;for(let u=0;u<o.width;++u)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(u,0,1,1);const l=e.getImageData(0,0,o.width,o.height);i=0;for(let u=0;u<l.data.length;++u)if(u%4!=3&&i++!==l.data[u])return ih=!0,!0;return ih=!1,!1}};function Pp(o,e){const i=o.indexOf("?");if(i<0)return`${o}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(o.slice(i));for(const u in e)l.set(u,e[u]);return`${o.slice(0,i)}?${l.toString()}`}function pd(o,e={persistentParams:[]}){const i=o.indexOf("?");if(i<0)return o;const l=new URLSearchParams,u=new URLSearchParams(o.slice(i));for(const p of e.persistentParams){const v=u.get(p);v&&l.set(p,v)}const f=l.toString();return`${o.slice(0,i)}${f.length>0?`?${f}`:""}`}const Fs="mapbox-tiles";let pa=500,Ka=50;const ma=["language","worldview","jobid"];let hs,ac;function kp(){try{return caches}catch{}}function rh(){const o=kp();o&&hs==null&&(hs=o.open(Fs))}let El=1/0;const oh={supported:!1,testSupport:function(o){!Bs&&eu&&(Rp?tu(o):sh=o)}};let sh,eu,Bs=!1,Rp=!1;const md=typeof self<"u"?self:{};function tu(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,eu),o.isContextLost())return;oh.supported=!0}catch{}o.deleteTexture(e),Bs=!0}md.document&&(eu=md.document.createElement("img"),eu.onload=function(){sh&&tu(sh),sh=null,Rp=!0},eu.onerror=function(){Bs=!0,sh=null},eu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const gd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(gd);class zp extends Error{constructor(e,i,l){i===401&&wl(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const _d=tr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ei=function(o,e){if(!(/^file:/.test(i=o.url)||/^file:/.test(_d())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(l,u){const f=new AbortController,p=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:_d(),referrerPolicy:l.referrerPolicy,signal:f.signal});let v=!1,w=!1;const E=(C=p.url).indexOf("sku=")>0&&wl(C);var C;l.type==="json"&&p.headers.set("Accept","application/json");const z=(N,U,X)=>{if(w)return;if(N&&N.message!=="SecurityError"&&oi(N.toString()),U&&X)return L(U);const J=Date.now();fetch(p).then((Q=>{if(Q.ok){const le=E?Q.clone():null;return L(Q,le,J)}return u(new zp(Q.statusText,Q.status,l.url))})).catch((Q=>{Q.name!=="AbortError"&&u(new Error(`${Q.message} ${l.url}`))}))},L=(N,U,X)=>{(l.type==="arrayBuffer"?N.arrayBuffer():l.type==="json"?N.json():N.text()).then((J=>{w||(U&&X&&(function(Q,le,he){if(rh(),hs==null)return;const ge=Ci(le.headers.get("Cache-Control")||"");if(ge["no-store"])return;const Le={status:le.status,statusText:le.statusText,headers:new Headers};le.headers.forEach(((We,He)=>Le.headers.set(He,We))),ge["max-age"]&&Le.headers.set("Expires",new Date(he+1e3*ge["max-age"]).toUTCString());const Oe=Le.headers.get("Expires");if(!Oe||new Date(Oe).getTime()-he<42e4)return;let Ve=pd(Q.url,{persistentParams:ma});if(le.status===206){const We=Q.headers.get("Range");if(!We)return;Le.status=200,Ve=Pp(Ve,{range:We})}(function(We,He){if(ac===void 0)try{new Response(new ReadableStream),ac=!0}catch{ac=!1}ac?He(We.body):We.blob().then(He).catch((Tt=>oi(Tt.message)))})(le,(We=>{const He=new Response((Tt=le.status)!==200&&Tt!==404&&[101,103,204,205,304].includes(Tt)?null:We,Le);var Tt;rh(),hs?.then((Ke=>Ke.put(Ve,He))).catch((Ke=>oi(Ke.message)))}))})(p,U,X),v=!0,u(null,J,N.headers.get("Cache-Control"),N.headers.get("Expires")))})).catch((J=>{w||u(new Error(J.message))}))};return E?(function(N,U){if(rh(),hs==null)return U(null);hs.then((X=>{let J=pd(N.url,{persistentParams:ma});const Q=N.headers.get("Range");Q&&(J=Pp(J,{range:Q})),X.match(J).then((le=>{const he=(function(ge){if(!ge)return!1;const Le=new Date(ge.headers.get("Expires")||0),Oe=Ci(ge.headers.get("Cache-Control")||"");return Number(Le)>Date.now()&&!Oe["no-cache"]})(le);X.delete(J).catch(U),he&&X.put(J,le.clone()).catch(U),U(null,le,he)})).catch(U)})).catch(U)})(p,z):z(null,null),{cancel:()=>{w=!0,v||f.abort()}}})(o,e);if(tr(self)&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var i;return(function(l,u){const f=new XMLHttpRequest;f.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const p in l.headers)f.setRequestHeader(p,l.headers[p]);return l.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=l.credentials==="include",f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let p=f.response;if(l.type==="json")try{p=JSON.parse(f.response)}catch(v){return u(v)}u(null,p,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new zp(f.statusText,f.status,l.url))},f.send(l.body),{cancel:()=>f.abort()}})(o,e)},nu=function(o,e){return Ei(Object.assign(o,{type:"arrayBuffer"}),e)};function I_(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const M_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let yd,Al;yd=[],Al=0;const iu=function(o,e){if(oh.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Al>=Fo.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return yd.push(f),f}Al++;let i=!1;const l=()=>{if(!i)for(i=!0,Al--;yd.length&&Al<Fo.MAX_PARALLEL_IMAGE_REQUESTS;){const f=yd.shift(),{requestParameters:p,callback:v,cancelled:w}=f;w||(f.cancel=iu(p,v).cancel)}},u=nu(o,((f,p,v,w)=>{l(),f?e(f):p&&(self.createImageBitmap?(function(E,C){const z=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(z).then((L=>{C(null,L)})).catch((L=>{C(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(p,((E,C)=>e(E,C,v,w))):(function(E,C){const z=new Image;z.onload=()=>{C(null,z),URL.revokeObjectURL(z.src),z.onload=null,requestAnimationFrame((()=>{z.src=M_}))},z.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(E)],{type:"image/png"});z.src=E.byteLength?URL.createObjectURL(L):M_})(p,((E,C)=>e(E,C,v,w))))}));return{cancel:()=>{u.cancel(),l()}}};var ah,vd,C_,lc={exports:{}},P_={exports:{}},Dp={exports:{}},ru=(function(){if(C_)return lc.exports;C_=1;var o=(ah||(ah=1,P_.exports=function(i,l){var u,f,p,v,w,E,C,z;for(f=i.length-(u=3&i.length),p=l,w=3432918353,E=461845907,z=0;z<f;)C=255&i.charCodeAt(z)|(255&i.charCodeAt(++z))<<8|(255&i.charCodeAt(++z))<<16|(255&i.charCodeAt(++z))<<24,++z,p=27492+(65535&(v=5*(65535&(p=(p^=C=(65535&(C=(C=(65535&C)*w+(((C>>>16)*w&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(C=0,u){case 3:C^=(255&i.charCodeAt(z+2))<<16;case 2:C^=(255&i.charCodeAt(z+1))<<8;case 1:p^=C=(65535&(C=(C=(65535&(C^=255&i.charCodeAt(z)))*w+(((C>>>16)*w&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),P_.exports),e=(vd||(vd=1,Dp.exports=function(i,l){for(var u,f=i.length,p=l^f,v=0;f>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:p^=(255&i.charCodeAt(v+2))<<16;case 2:p^=(255&i.charCodeAt(v+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(v)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Dp.exports);return lc.exports=o,lc.exports.murmur3=o,lc.exports.murmur2=e,lc.exports})(),xd=Xo(ru);class ga{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class lh extends ga{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function bd(o,e,i){i[o]&&i[o].indexOf(e)!==-1||(i[o]=i[o]||[],i[o].push(e))}function Ns(o,e,i){if(i&&i[o]){const l=i[o].indexOf(e);l!==-1&&i[o].splice(l,1)}}class cc{on(e,i){return this._listeners=this._listeners||{},bd(e,i,this._listeners),this}off(e,i){return Ns(e,i,this._listeners),Ns(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},bd(e,i,this._oneTimeListeners),this):new Promise((l=>{this.once(e,l)}))}fire(e,i){const l=typeof e=="string"?new ga(e,i):e,u=l.type;if(this.listens(u)){l.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const w of f)w.call(this,l);const p=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const w of p)Ns(u,w,this._oneTimeListeners),w.call(this,l);const v=this._eventedParent;if(v){const w=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(l,w),v.fire(l)}}else l instanceof lh&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Vs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Vs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,l]=e.split("");return new Vs({name:i,iconsetId:l})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Vs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Lp,wd={},Op=(function(){if(Lp)return wd;Lp=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(f){return(f=Math.round(f))<0?0:f>255?255:f}function i(f){return e(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function l(f){return(p=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:p>1?1:p;var p}function u(f,p,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?f+(p-f)*v*6:2*v<1?p:3*v<2?f+(p-f)*(2/3-v)*6:f}try{wd.parseCSSColor=function(f){var p,v=f.replace(/ /g,"").toLowerCase();if(v in o)return o[v].slice();if(v[0]==="#")return v.length===4?(p=parseInt(v.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:v.length===7&&(p=parseInt(v.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var w=v.indexOf("("),E=v.indexOf(")");if(w!==-1&&E+1===v.length){var C=v.substr(0,w),z=v.substr(w+1,E-(w+1)).split(","),L=1;switch(C){case"rgba":if(z.length!==4)return null;L=l(z.pop());case"rgb":return z.length!==3?null:[i(z[0]),i(z[1]),i(z[2]),L];case"hsla":if(z.length!==4)return null;L=l(z.pop());case"hsl":if(z.length!==3)return null;var N=(parseFloat(z[0])%360+360)%360/360,U=l(z[1]),X=l(z[2]),J=X<=.5?X*(U+1):X+U-X*U,Q=2*X-J;return[e(255*u(Q,J,N+1/3)),e(255*u(Q,J,N)),e(255*u(Q,J,N-1/3)),L];default:return null}}return null}}catch{}return wd})();class Hi{constructor(e,i,l,u=1){this.r=e,this.g=i,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof Hi)return e;if(typeof e!="string")return;const i=Op.parseCSSColor(e);return i?new Hi(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,l,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*l)},${u})`}toNonPremultipliedRenderColor(e){const{r:i,g:l,b:u,a:f}=this;return new k_(e,i,l,u,f)}toPremultipliedRenderColor(e){const{r:i,g:l,b:u,a:f}=this;return new Td(e,i*f,l*f,u*f,f)}clone(){return new Hi(this.r,this.g,this.b,this.a)}}class Fp{constructor(e,i,l,u,f,p=!1){if(this.premultiplied=!1,this.premultiplied=p,e){const v=e.image.height,w=v*v;this.premultiplied?(i=f===0?0:i/f*(v-1),l=f===0?0:l/f*(v-1),u=f===0?0:u/f*(v-1)):(i*=v-1,l*=v-1,u*=v-1);const E=Math.floor(i),C=Math.floor(l),z=Math.floor(u),L=Math.ceil(i),N=Math.ceil(l),U=Math.ceil(u),X=i-E,J=l-C,Q=u-z,le=e.image.data,he=4*(E+C*w+z*v),ge=4*(E+C*w+U*v),Le=4*(E+N*w+z*v),Oe=4*(E+N*w+U*v),Ve=4*(L+C*w+z*v),We=4*(L+C*w+U*v),He=4*(L+N*w+z*v),Tt=4*(L+N*w+U*v);if(he<0||Tt>=le.length)throw new Error("out of range");this.r=Rn(Rn(Rn(le[he],le[ge],Q),Rn(le[Le],le[Oe],Q),J),Rn(Rn(le[Ve],le[We],Q),Rn(le[He],le[Tt],Q),J),X)/255*(this.premultiplied?f:1),this.g=Rn(Rn(Rn(le[he+1],le[ge+1],Q),Rn(le[Le+1],le[Oe+1],Q),J),Rn(Rn(le[Ve+1],le[We+1],Q),Rn(le[He+1],le[Tt+1],Q),J),X)/255*(this.premultiplied?f:1),this.b=Rn(Rn(Rn(le[he+2],le[ge+2],Q),Rn(le[Le+2],le[Oe+2],Q),J),Rn(Rn(le[Ve+2],le[We+2],Q),Rn(le[He+2],le[Tt+2],Q),J),X)/255*(this.premultiplied?f:1),this.a=f}else this.r=i,this.g=l,this.b=u,this.a=f}toArray(){const{r:e,g:i,b:l,a:u}=this;return[255*e,255*i,255*l,u]}toHslaArray(){let{r:e,g:i,b:l,a:u}=this;if(this.premultiplied){if(u===0)return[0,0,0,0];const U=1/u;e*=U,i*=U,l*=U}const f=Math.min(Math.max(e,0),1),p=Math.min(Math.max(i,0),1),v=Math.min(Math.max(l,0),1),w=Math.min(f,p,v),E=Math.max(f,p,v),C=E-w,z=.5*(w+E);if(C===0)return[0,0,100*z,u];const L=z>.5?C/(2-E-w):C/(E+w);let N;switch(E){case f:N=60*((p-v)/C+(p<v?6:0));break;case p:N=60*((v-f)/C+2);break;default:N=60*((f-p)/C+4)}return[N,100*L,100*z,u]}toArray01(){const{r:e,g:i,b:l,a:u}=this;return[e,i,l,u]}toArray01Scaled(e){const{r:i,g:l,b:u}=this;return[i*e,l*e,u*e]}toArray01Linear(){const{r:e,g:i,b:l,a:u}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(l,2.2),u]}}class k_ extends Fp{constructor(e,i,l,u,f){super(e,i,l,u,f,!1)}}class Td extends Fp{constructor(e,i,l,u,f){super(e,i,l,u,f,!0)}}function Rn(o,e,i){return o*(1-i)+e*i}function Bp(o,e,i){return o.map(((l,u)=>Rn(l,e[u],i)))}Hi.black=new Hi(0,0,0,1),Hi.white=new Hi(1,1,1,1),Hi.transparent=new Hi(0,0,0,0),Hi.red=new Hi(1,0,0,1),Hi.blue=new Hi(0,0,1,1);var Us=Object.freeze({__proto__:null,array:Bp,color:function(o,e,i){return new Hi(Rn(o.r,e.r,i),Rn(o.g,e.g,i),Rn(o.b,e.b,i),Rn(o.a,e.a,i))},number:Rn});class _a extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Sd{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[l,u]of i)this.bindings[l]=u}concat(e){return new Sd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Pa={kind:"null"},bn={kind:"number"},Zi={kind:"string"},Ji={kind:"boolean"},As={kind:"color"},uc={kind:"object"},Bi={kind:"value"},Ed={kind:"collator"},Il={kind:"formatted"},ch={kind:"resolvedImage"};function os(o,e){return{kind:"array",itemType:o,N:e}}function yo(o){if(o.kind==="array"){const e=yo(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const vx=[Pa,bn,Zi,Ji,As,Il,uc,os(Bi),ch];function uh(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!uh(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const i of vx)if(!uh(i,e))return null}}return`Expected ${yo(o)} but found ${yo(e)} instead.`}function Np(o,e){return e.some((i=>i.kind===o.kind))}function hh(o,e){return e.some((i=>i==="null"?o===null:i==="array"?Array.isArray(o):i==="object"?o&&!Array.isArray(o)&&typeof o=="object":i===typeof o))}function dh(o,e){return o.kind==="array"&&e.kind==="array"?o.N===e.N&&dh(o.itemType,e.itemType):o.kind===e.kind}class Ml{constructor(e,i,l){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ad{constructor(e,i,l,u,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=l,this.fontStack=u,this.textColor=f}}class ds{constructor(e){this.sections=e}static fromString(e){return new ds([new Ad(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof ds?e:ds.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const u=i.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class ya{constructor(e,i={}){if(this.id=Vs.from(e),this.options=Object.assign({},i),i.transform){const{a:l,b:u,c:f,d:p,e:v,f:w}=i.transform;this.options.transform=new DOMMatrix([l,u,f,p,v,w])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:l,d:u,e:f,f:p}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:l,d:u,e:f,f:p}})}static parse(e){let i,l,u,f;try{({name:i,iconsetId:l,params:u,transform:f}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:p,b:v,c:w,d:E,e:C,f:z}=f||{};return new ya({name:i,iconsetId:l},{params:u,transform:new DOMMatrix([p,v,w,E,C,z])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class ws{constructor(e,i,l,u,f=!1){this.primaryId=Vs.from(e),this.primaryOptions=i,l&&(this.secondaryId=Vs.from(l)),this.secondaryOptions=u,this.available=f}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ya(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ya(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?ws.build({name:e}):e}static build(e,i,l,u){return!e||typeof e=="object"&&!("name"in e)?null:new ws(e,l,i,u)}}function R_(o,e,i,l){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[o,e,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[o,e,i,l]:[o,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ou(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Hi||o instanceof Ml||o instanceof ds||o instanceof ws)return!0;if(Array.isArray(o)){for(const e of o)if(!ou(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!ou(o[e]))return!1;return!0}return!1}function ko(o){if(o===null)return Pa;if(typeof o=="string")return Zi;if(typeof o=="boolean")return Ji;if(typeof o=="number")return bn;if(o instanceof Hi)return As;if(o instanceof Ml)return Ed;if(o instanceof ds)return Il;if(o instanceof ws)return ch;if(Array.isArray(o)){const e=o.length;let i;for(const l of o){const u=ko(l);if(i){if(i===u)continue;i=Bi;break}i=u}return os(i||Bi,e)}return uc}function Ts(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof ds||o instanceof ws||o instanceof Hi?o.toString():JSON.stringify(o)}class si{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ou(e[1]))return i.error("invalid value");const l=e[1];let u=ko(l);const f=i.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new si(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Hi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ds?this.value.serialize():this.value}}class an{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const fh={string:Zi,number:bn,boolean:Ji,object:uc};class On{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let l,u=1;const f=e[0];if(f==="array"){let v,w;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in fh)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=fh[E],u++}else v=Bi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],u++}l=os(v,w)}else l=fh[f];const p=[];for(;u<e.length;u++){const v=i.parse(e[u],u,Bi);if(!v)return null;p.push(v)}return new On(l,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(e);if(!uh(this.type,ko(l)))return l;if(i===this.args.length-1)throw new an(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${yo(ko(l))} but was expected to be of type ${yo(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map((l=>l.serialize())))}}class hc{constructor(e){this.type=Il,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let p=1;p<=e.length-1;++p){const v=e[p];if(f&&typeof v=="object"&&!Array.isArray(v)){f=!1;let w=null;if(v["font-scale"]&&(w=i.parseObjectValue(v["font-scale"],p,"font-scale",bn),!w))return null;let E=null;if(v["text-font"]&&(E=i.parseObjectValue(v["text-font"],p,"text-font",os(Zi)),!E))return null;let C=null;if(v["text-color"]&&(C=i.parseObjectValue(v["text-color"],p,"text-color",As),!C))return null;const z=u[u.length-1];z.scale=w,z.font=E,z.textColor=C}else{const w=i.parse(e[p],p,Bi);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new hc(u)}evaluate(e){return new ds(this.sections.map((i=>{const l=i.content.evaluate(e);return dh(ko(l),ch)?new Ad("",l,null,null,null):new Ad(Ts(l),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),e.push(l)}return e}}class su{constructor(e,i,l,u){this._imageWarnHistory={},this.type=ch,this.namePrimary=e,this.nameSecondary=i,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let l=1;const u=[];function f(){if(l<e.length){const v=i.parse(e[l],l++,Zi);return v?(u.push({image:v,options:{}}),!0):(i.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function p(){if(l<e.length){const w=e[l];if((v=w)===null||typeof v!="object"||Array.isArray(v))return!0;const E=w.params,C=w.iconset,z=i.concat(l);if(!E&&!C)return l++,!0;if(E){if(typeof E!="object"||E.constructor!==Object)return z.error('Image options "params" should be an object'),!1;const L={},N=z.concat(void 0,"params");for(const U in E){if(!U)return N.error("Image parameter name should be non-empty"),!1;const X=N.concat(void 0,U).parse(E[U],void 0,As,void 0,{typeAnnotation:"coerce"});if(!X)return!1;L[U]=X}u[u.length-1].options.params=L}if(C){if(typeof C!="object"||C.constructor!==Object)return z.error('Image options "iconset" should be an object'),!1;if(!C.id)return z.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=C}return l++,!0}var v;return!0}for(let v=0;v<2;v++)if(!f()||!p())return;return new su(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,i){const l={};if(i){for(const u in i)if(i[u])try{l[u]=i[u].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=ws.build(i,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const f=u.getPrimary().id;if(u.available=e.availableImages.some((p=>Vs.isEqual(p,f))),u.available){const p=u.getSecondary()?u.getSecondary().id:null;p&&(u.available=e.availableImages.some((v=>Vs.isEqual(v,p))))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const l={};if(i&&(l.iconset={id:i}),e){l.params={};for(const u in e)e[u]&&(l.params[u]=e[u].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function jn(o){return ph(o)?"string":mh(o)?"number":Up(o)?"boolean":Array.isArray(o)?"array":o===null?"null":Vp(o)?"object":typeof o}function Vp(o){return o!=null&&!Array.isArray(o)&&typeof o!="function"&&!(o instanceof String||o instanceof Number||o instanceof Boolean)&&typeof o=="object"}function ph(o){return typeof o=="string"||o instanceof String}function mh(o){return typeof o=="number"||o instanceof Number}function Up(o){return typeof o=="boolean"||o instanceof Boolean}const Id={"to-boolean":Ji,"to-color":As,"to-number":bn,"to-string":Zi};class ao{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[0],u=[];let f=Pa;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);f=os(i.expectedType.itemType,p)}else{if(!(p>0&&ou(e[1][0])))return null;f=os(ko(e[1][0]),p)}for(let v=0;v<p;v++){const w=e[1][v];let E;if(Array.isArray(w))E=i.parse(w,void 0,f.itemType);else{const C=jn(w);if(C!==f.itemType.kind)return i.error(`Expected ${f.itemType.kind} but found ${C}.`);E=i.registry.literal.parse(["literal",w===void 0?null:w],i)}if(!E)return null;u.push(E)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return i.error("Expected one argument.");f=Id[l];for(let p=1;p<e.length;p++){const v=i.parse(e[p],p,Bi);if(!v)return null;u.push(v)}}return new ao(f,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,l;for(const u of this.args){if(i=u.evaluate(e),l=null,i instanceof Hi)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:R_(i[0],i[1],i[2],i[3]),!l))return new Hi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new an(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new an(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ds.fromString(Ts(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ws.build(Ts(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):Ts(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new hc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new su(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}const jp=["Unknown","Point","LineString","Polygon"];class Ja{constructor(e,i,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?jp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Hi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class fs{constructor(e,i,l,u,f){this.name=e,this.type=i,this._evaluate=l,this.args=u,this._overloadIndex=f}evaluate(e){if(!this._evaluate){const i=fs.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){const l=e[0],u=fs.definitions[l];if(!u)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=[];let w=null,E=-1;for(const[C,z]of p){if(Array.isArray(C)&&C.length!==e.length-1)continue;v.push(C),E++,w=new jd(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const L=[];let N=!1;for(let U=1;U<e.length;U++){const X=e[U],J=Array.isArray(C)?C[U-1]:C.type,Q=w.parse(X,1+L.length,J);if(!Q){N=!0;break}L.push(Q)}if(!N)if(Array.isArray(C)&&C.length!==L.length)w.error(`Expected ${C.length} arguments, but found ${L.length} instead.`);else{for(let U=0;U<L.length;U++){const X=Array.isArray(C)?C[U]:C.type,J=L[U];w.concat(U+1).checkSubtype(X,J.type)}if(w.errors.length===0)return new fs(l,f,z,L,E)}}if(v.length===1)i.errors.push(...w.errors);else{const C=(v.length?v:p.map((([L])=>L))).map(Cl).join(" | "),z=[];for(let L=1;L<e.length;L++){const N=i.parse(e[L],1+z.length);if(!N)return null;z.push(yo(N.type))}i.error(`Expected arguments of type ${C}, but found (${z.join(", ")}) instead.`)}return null}static register(e,i){fs.definitions=i;for(const l in i)e[l]=fs}}function Cl(o){return Array.isArray(o)?`(${o.map(yo).join(", ")})`:`(${yo(o.type)}...)`}class Go{constructor(e,i,l){this.type=Ed,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const u=l["case-sensitive"]===void 0?i.parse(!1,1,Ji):i.parseObjectValue(l["case-sensitive"],1,"case-sensitive",Ji);if(!u)return null;const f=l["diacritic-sensitive"]===void 0?i.parse(!1,1,Ji):i.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",Ji);if(!f)return null;let p=null;return l.locale&&(p=i.parseObjectValue(l.locale,1,"locale",Zi),!p)?null:new Go(u,f,p)}evaluate(e){return new Ml(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function z_(o,e,i=0,l=o.length-1,u=xx){for(;l>i;){if(l-i>600){const w=l-i+1,E=e-i+1,C=Math.log(w),z=.5*Math.exp(2*C/3),L=.5*Math.sqrt(C*z*(w-z)/w)*(E-w/2<0?-1:1);z_(o,e,Math.max(i,Math.floor(e-E*z/w+L)),Math.min(l,Math.floor(e+(w-E)*z/w+L)),u)}const f=o[e];let p=i,v=l;for(gh(o,i,e),u(o[l],f)>0&&gh(o,i,l);p<v;){for(gh(o,p,v),p++,v--;u(o[p],f)<0;)p++;for(;u(o[v],f)>0;)v--}u(o[i],f)===0?gh(o,i,v):(v++,gh(o,v,l)),v<=e&&(i=v+1),e<=v&&(l=v-1)}}function gh(o,e,i){const l=o[e];o[e]=o[i],o[i]=l}function xx(o,e){return o<e?-1:o>e?1:0}function Md(o){let e=0;for(let i,l,u=0,f=o.length,p=f-1;u<f;p=u++)i=o[u],l=o[p],e+=(l.x-i.x)*(i.y+l.y);return e}function au(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function va(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function bx(o,e,i){const l=o[0]-e[0],u=o[1]-e[1],f=o[0]-i[0],p=o[1]-i[1];return l*p-f*u==0&&l*f<=0&&u*p<=0}function lu(o,e,i=!1){let l=!1;for(let v=0,w=e.length;v<w;v++){const E=e[v];for(let C=0,z=E.length,L=z-1;C<z;L=C++){const N=E[L],U=E[C];if(bx(o,N,U))return i;(f=N)[1]>(u=o)[1]!=(p=U)[1]>u[1]&&u[0]<(p[0]-f[0])*(u[1]-f[1])/(p[1]-f[1])+f[0]&&(l=!l)}}var u,f,p;return l}function D_(o,e,i,l){const u=l[0]-i[0],f=l[1]-i[1],p=(o[0]-i[0])*f-u*(o[1]-i[1]),v=(e[0]-i[0])*f-u*(e[1]-i[1]);return p>0&&v<0||p<0&&v>0}function Cd(o,e,i,l){return(u=[l[0]-i[0],l[1]-i[1]])[0]*(f=[e[0]-o[0],e[1]-o[1]])[1]-u[1]*f[0]!=0&&!(!D_(o,e,i,l)||!D_(i,l,o,e));var u,f}function Pd(o){const e=new Mt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Mt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of o[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),i.x<l.x&&(i.x=l.x),i.y<l.y&&(i.y=l.y);return{min:e,max:i}}const Pl=8192;function dc(o,e){const i=(180+o[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Pl),Math.round(l*u*Pl)]}function wx(o,e){for(let i=0;i<e.length;i++)if(lu(o,e[i]))return!0;return!1}function Tx(o,e,i){for(const l of i)for(let u=0,f=l.length,p=f-1;u<f;p=u++)if(Cd(o,e,l[p],l[u]))return!0;return!1}function kd(o,e){for(let i=0;i<o.length;++i)if(!lu(o[i],e))return!1;for(let i=0;i<o.length-1;++i)if(Tx(o[i],o[i+1],e))return!1;return!0}function L_(o,e){for(let i=0;i<e.length;i++)if(kd(o,e[i]))return!0;return!1}function Rd(o,e,i){const l=[];for(let u=0;u<o.length;u++){const f=[];for(let p=0;p<o[u].length;p++){const v=dc(o[u][p],i);au(e,v),f.push(v)}l.push(f)}return l}function ra(o,e,i){const l=[];for(let u=0;u<o.length;u++){const f=Rd(o[u],e,i);l.push(f)}return l}function O_(o,e,i,l){if(o[0]<i[0]||o[0]>i[2]){const u=.5*l;let f=o[0]-i[0]>u?-l:i[0]-o[0]>u?l:0;f===0&&(f=o[0]-i[2]>u?-l:i[2]-o[0]>u?l:0),o[0]+=f}au(e,o)}function F_(o,e,i,l){const u=Math.pow(2,l.z)*Pl,f=[l.x*Pl,l.y*Pl],p=[];if(!o)return p;for(const v of o)for(const w of v){const E=[w.x+f[0],w.y+f[1]];O_(E,e,i,u),p.push(E)}return p}function B_(o,e,i,l){const u=Math.pow(2,l.z)*Pl,f=[l.x*Pl,l.y*Pl],p=[];if(!o)return p;for(const w of o){const E=[];for(const C of w){const z=[C.x+f[0],C.y+f[1]];au(e,z),E.push(z)}p.push(E)}if(e[2]-e[0]<=u/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of p)for(const E of w)O_(E,e,i,u)}var v;return p}class fc{constructor(e,i){this.type=Ji,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ou(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let u=0;u<l.features.length;++u){const f=l.features[u].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new fc(l,l.features[u].geometry)}else if(l.type==="Feature"){const u=l.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new fc(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new fc(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,l){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(l.type==="Polygon"){const v=Rd(l.coordinates,f,p),w=F_(i.geometry(),u,f,p);if(!va(u,f))return!1;for(const E of w)if(!lu(E,v))return!1}if(l.type==="MultiPolygon"){const v=ra(l.coordinates,f,p),w=F_(i.geometry(),u,f,p);if(!va(u,f))return!1;for(const E of w)if(!wx(E,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,l){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(l.type==="Polygon"){const v=Rd(l.coordinates,f,p),w=B_(i.geometry(),u,f,p);if(!va(u,f))return!1;for(const E of w)if(!kd(E,v))return!1}if(l.type==="MultiPolygon"){const v=ra(l.coordinates,f,p),w=B_(i.geometry(),u,f,p);if(!va(u,f))return!1;for(const E of w)if(!L_(E,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const _h={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Gp=1/298.257223563,Wp=Gp*(2-Gp),cu=Math.PI/180;class uu{static fromTile(e,i,l){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),f=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/cu;return new uu(f,l)}static get units(){return _h}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!_h[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(_h).join(", ")}`);const l=6378.137*cu*(i?_h[i]:1),u=Math.cos(e*cu),f=1/(1-Wp*(1-u*u)),p=Math.sqrt(f);this.kx=l*p*u,this.ky=l*p*f*(1-Wp)}distance(e,i){const l=js(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(l*l+u*u)}bearing(e,i){const l=js(i[0]-e[0])*this.kx;return Math.atan2(l,(i[1]-e[1])*this.ky)/cu}destination(e,i,l){const u=l*cu;return this.offset(e,Math.sin(u)*i,Math.cos(u)*i)}offset(e,i,l){return[e[0]+i/this.kx,e[1]+l/this.ky]}lineDistance(e){let i=0;for(let l=0;l<e.length-1;l++)i+=this.distance(e[l],e[l+1]);return i}area(e){let i=0;for(let l=0;l<e.length;l++){const u=e[l];for(let f=0,p=u.length,v=p-1;f<p;v=f++)i+=js(u[f][0]-u[v][0])*(u[f][1]+u[v][1])*(l?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let l=0;if(i<=0)return e[0];for(let u=0;u<e.length-1;u++){const f=e[u],p=e[u+1],v=this.distance(f,p);if(l+=v,l>i)return zd(f,p,(i-(l-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,i,l){let[u,f]=i,p=js(l[0]-u)*this.kx,v=(l[1]-f)*this.ky;if(p!==0||v!==0){const w=(js(e[0]-u)*this.kx*p+(e[1]-f)*this.ky*v)/(p*p+v*v);w>1?(u=l[0],f=l[1]):w>0&&(u+=p/this.kx*w,f+=v/this.ky*w)}return p=js(e[0]-u)*this.kx,v=(e[1]-f)*this.ky,Math.sqrt(p*p+v*v)}pointOnLine(e,i){let l=1/0,u=e[0][0],f=e[0][1],p=0,v=0;for(let w=0;w<e.length-1;w++){let E=e[w][0],C=e[w][1],z=js(e[w+1][0]-E)*this.kx,L=(e[w+1][1]-C)*this.ky,N=0;z===0&&L===0||(N=(js(i[0]-E)*this.kx*z+(i[1]-C)*this.ky*L)/(z*z+L*L),N>1?(E=e[w+1][0],C=e[w+1][1]):N>0&&(E+=z/this.kx*N,C+=L/this.ky*N)),z=js(i[0]-E)*this.kx,L=(i[1]-C)*this.ky;const U=z*z+L*L;U<l&&(l=U,u=E,f=C,p=w,v=N)}return{point:[u,f],index:p,t:Math.max(0,Math.min(1,v))}}lineSlice(e,i,l){let u=this.pointOnLine(l,e),f=this.pointOnLine(l,i);if(u.index>f.index||u.index===f.index&&u.t>f.t){const E=u;u=f,f=E}const p=[u.point],v=u.index+1,w=f.index;!qp(l[v],p[0])&&v<=w&&p.push(l[v]);for(let E=v+1;E<=w;E++)p.push(l[E]);return qp(l[w],f.point)||p.push(f.point),p}lineSliceAlong(e,i,l){let u=0;const f=[];for(let p=0;p<l.length-1;p++){const v=l[p],w=l[p+1],E=this.distance(v,w);if(u+=E,u>e&&f.length===0&&f.push(zd(v,w,(e-(u-E))/E)),u>=i)return f.push(zd(v,w,(i-(u-E))/E)),f;u>e&&f.push(w)}return f}bufferPoint(e,i){const l=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-l,e[0]+u,e[1]+l]}bufferBBox(e,i){const l=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-l,e[2]+u,e[3]+l]}insideBBox(e,i){return js(e[0]-i[0])>=0&&js(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function qp(o,e){return o[0]===e[0]&&o[1]===e[1]}function zd(o,e,i){const l=js(e[0]-o[0]);return[o[0]+l*i,o[1]+(e[1]-o[1])*i]}function js(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class Dd{constructor(e=[],i=((l,u)=>l<u?-1:l>u?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:l}=this,u=i[e];for(;e>0;){const f=e-1>>1,p=i[f];if(l(u,p)>=0)break;i[e]=p,e=f}i[e]=u}_down(e){const{data:i,compare:l}=this,u=this.length>>1,f=i[e];for(;e<u;){let p=1+(e<<1);const v=p+1;if(v<this.length&&l(i[v],i[p])<0&&(p=v),l(i[p],f)>=0)break;i[e]=i[p],e=p}i[e]=f}}var Yt=8192;function Hp(o,e){return e.dist-o.dist}const hu=100,du=50;function yh(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==o[i])return!1;return!0}function vh(o){return o[1]-o[0]+1}function ka(o,e){const i=o[1]>=o[0]&&o[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Ld(o,e){if(o[0]>o[1])return[null,null];const i=vh(o);if(e){if(i===2)return[o,null];const l=Math.floor(i/2);return[[o[0],o[0]+l],[o[0]+l,o[1]]]}{if(i===1)return[o,null];const l=Math.floor(i/2)-1;return[[o[0],o[0]+l],[o[0]+l+1,o[1]]]}}function oa(o,e){const i=[1/0,1/0,-1/0,-1/0];if(!ka(e,o.length))return i;for(let l=e[0];l<=e[1];++l)au(i,o[l]);return i}function vi(o){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<o.length;++i)for(let l=0;l<o[i].length;++l)au(e,o[i][l]);return e}function fu(o,e,i){if(yh(o)||yh(e))return NaN;let l=0,u=0;return o[2]<e[0]&&(l=e[0]-o[2]),o[0]>e[2]&&(l=o[0]-e[2]),o[1]>e[3]&&(u=o[1]-e[3]),o[3]<e[1]&&(u=e[1]-o[3]),i.distance([0,0],[l,u])}function Sx(o){return 360*o-180}function Ex(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Od(o,e){const i=Math.pow(2,e.z),l=(o.y/Yt+e.y)/i;return[Sx((o.x/Yt+e.x)/i),Ex(l)]}function Ax(o,e){const i=[];for(let l=0;l<o.length;++l)i.push(Od(o[l],e));return i}function Or(o,e,i){const l=i.pointOnLine(e,o).point;return i.distance(o,l)}function N_(o,e,i,l,u){const f=i.slice(l[0],l[1]+1);let p=1/0;for(let v=e[0];v<=e[1];++v)if((p=Math.min(p,Or(o[v],f,u)))===0)return 0;return p}function Zp(o,e,i,l,u){const f=Math.min(u.pointToSegmentDistance(o,i,l),u.pointToSegmentDistance(e,i,l)),p=Math.min(u.pointToSegmentDistance(i,o,e),u.pointToSegmentDistance(l,o,e));return Math.min(f,p)}function Ix(o,e,i,l,u){if(!ka(e,o.length)||!ka(l,i.length))return NaN;let f=1/0;for(let p=e[0];p<e[1];++p)for(let v=l[0];v<l[1];++v){if(Cd(o[p],o[p+1],i[v],i[v+1]))return 0;f=Math.min(f,Zp(o[p],o[p+1],i[v],i[v+1],u))}return f}function Mx(o,e,i,l,u){if(!ka(e,o.length)||!ka(l,i.length))return NaN;let f=1/0;for(let p=e[0];p<=e[1];++p)for(let v=l[0];v<=l[1];++v)if((f=Math.min(f,u.distance(o[p],i[v])))===0)return f;return f}function Cx(o,e,i){if(lu(o,e,!0))return 0;let l=1/0;for(const u of e){const f=u.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[f-1]&&(l=Math.min(l,i.pointToSegmentDistance(o,u[f-1],u[0])))===0||(l=Math.min(l,Or(o,u,i)))===0)return l}return l}function Px(o,e,i,l){if(!ka(e,o.length))return NaN;for(let f=e[0];f<=e[1];++f)if(lu(o[f],i,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f)for(const p of i)for(let v=0,w=p.length,E=w-1;v<w;E=v++){if(Cd(o[f],o[f+1],p[E],p[v]))return 0;u=Math.min(u,Zp(o[f],o[f+1],p[E],p[v],l))}return u}function V_(o,e){for(const i of o)for(let l=0;l<=i.length-1;++l)if(lu(i[l],e,!0))return!0;return!1}function kx(o,e,i,l=1/0){const u=vi(o),f=vi(e);if(l!==1/0&&fu(u,f,i)>=l)return l;if(va(u,f)){if(V_(o,e))return 0}else if(V_(e,o))return 0;let p=l;for(const v of o)for(let w=0,E=v.length,C=E-1;w<E;C=w++)for(const z of e)for(let L=0,N=z.length,U=N-1;L<N;U=L++){if(Cd(v[C],v[w],z[U],z[L]))return 0;p=Math.min(p,Zp(v[C],v[w],z[U],z[L],i))}return p}function Fd(o,e,i,l,u,f,p){if(f===null||p===null)return;const v=fu(oa(l,f),oa(u,p),i);v<e&&o.push({dist:v,range1:f,range2:p})}function Rx(o,e,i,l,u=1/0){let f=Math.min(l.distance(o[0],i[0][0]),u);if(f===0)return f;const p=new Dd([{dist:0,range1:[0,o.length-1],range2:[0,0]}],Hp),v=e?du:hu,w=vi(i);for(;p.length;){const E=p.pop();if(E.dist>=f)continue;const C=E.range1;if(vh(C)<=v){if(!ka(C,o.length))return NaN;if(e){const z=Px(o,C,i,l);if((f=Math.min(f,z))===0)return f}else for(let z=C[0];z<=C[1];++z){const L=Cx(o[z],i,l);if((f=Math.min(f,L))===0)return f}}else{const z=Ld(C,e);if(z[0]!==null){const L=fu(oa(o,z[0]),w,l);L<f&&p.push({dist:L,range1:z[0],range2:[0,0]})}if(z[1]!==null){const L=fu(oa(o,z[1]),w,l);L<f&&p.push({dist:L,range1:z[1],range2:[0,0]})}}}return f}function U_(o,e,i,l,u,f=1/0){let p=Math.min(f,u.distance(o[0],i[0]));if(p===0)return p;const v=new Dd([{dist:0,range1:[0,o.length-1],range2:[0,i.length-1]}],Hp),w=e?du:hu,E=l?du:hu;for(;v.length;){const C=v.pop();if(C.dist>=p)continue;const z=C.range1,L=C.range2;if(vh(z)<=w&&vh(L)<=E){if(!ka(z,o.length)||!ka(L,i.length))return NaN;if(e&&l?p=Math.min(p,Ix(o,z,i,L,u)):e||l?e&&!l?p=Math.min(p,N_(i,L,o,z,u)):!e&&l&&(p=Math.min(p,N_(o,z,i,L,u))):p=Math.min(p,Mx(o,z,i,L,u)),p===0)return p}else{const N=Ld(z,e),U=Ld(L,l);Fd(v,p,u,o,i,N[0],U[0]),Fd(v,p,u,o,i,N[0],U[1]),Fd(v,p,u,o,i,N[1],U[0]),Fd(v,p,u,o,i,N[1],U[1])}}return p}function Xp(o,e,i,l,u=1/0){let f=u;const p=oa(o,[0,o.length-1]);for(const v of i)if(!(f!==1/0&&fu(p,oa(v,[0,v.length-1]),l)>=f)&&(f=Math.min(f,U_(o,e,v,!0,l,f)),f===0))return f;return f}function Bd(o,e,i,l,u=1/0){let f=u;const p=oa(o,[0,o.length-1]);for(const v of i){if(f!==1/0&&fu(p,vi(v),l)>=f)continue;const w=Rx(o,e,v,l,f);if(isNaN(w))return w;if((f=Math.min(f,w))===0)return f}return f}function Yp(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class pc{constructor(e,i){this.type=bn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ou(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let u=0;u<l.features.length;++u)if(Yp(l.features[u].geometry.type))return new pc(l,l.features[u].geometry)}else if(l.type==="Feature"){if(Yp(l.geometry.type))return new pc(l,l.geometry)}else if(Yp(l.type))return new pc(l,l)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),l=e.canonicalID();if(i!=null&&l!=null){if(e.geometryType()==="Point")return(function(u,f,p){const v=[];for(const E of u)for(const C of E)v.push(Od(C,f));const w=new uu(v[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?U_(v,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",w):p.type==="MultiLineString"?Xp(v,!1,p.coordinates,w):p.type==="Polygon"||p.type==="MultiPolygon"?Bd(v,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,w):null})(i,l,this.geometries);if(e.geometryType()==="LineString")return(function(u,f,p){const v=[];for(const E of u){const C=[];for(const z of E)C.push(Od(z,f));v.push(C)}const w=new uu(v[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Xp(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",v,w);if(p.type==="MultiLineString"){let E=1/0;for(let C=0;C<p.coordinates.length;C++){const z=Xp(p.coordinates[C],!0,v,w,E);if(isNaN(z))return z;if((E=Math.min(E,z))===0)return E}return E}if(p.type==="Polygon"||p.type==="MultiPolygon"){let E=1/0;for(let C=0;C<v.length;C++){const z=Bd(v[C],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,w,E);if(isNaN(z))return z;if((E=Math.min(E,z))===0)return E}return E}return null})(i,l,this.geometries);if(e.geometryType()==="Polygon")return(function(u,f,p){const v=[];for(const E of(function(C,z){const L=C.length;if(L<=1)return[C];const N=[];let U,X;for(let J=0;J<L;J++){const Q=Md(C[J]);Q!==0&&(C[J].area=Math.abs(Q),X===void 0&&(X=Q<0),X===Q<0?(U&&N.push(U),U=[C[J]]):U.push(C[J]))}return U&&N.push(U),N})(u)){const C=[];for(let z=0;z<E.length;++z)C.push(Ax(E[z],f));v.push(C)}const w=new uu(v[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Bd(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",v,w);if(p.type==="MultiLineString"){let E=1/0;for(let C=0;C<p.coordinates.length;C++){const z=Bd(p.coordinates[C],!0,v,w,E);if(isNaN(z))return z;if((E=Math.min(E,z))===0)return E}return E}return p.type==="Polygon"||p.type==="MultiPolygon"?(function(E,C,z){let L=1/0;for(const N of E)for(const U of C){const X=kx(N,U,z,L);if(isNaN(X))return X;if((L=Math.min(L,X))===0)return L}return L})(p.type==="Polygon"?[p.coordinates]:p.coordinates,v,w):null})(i,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function pu(o){if(o instanceof fs&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof fc||o instanceof pc)return!1;if(o instanceof gu)return o.featureConstant;let e=!0;return o.eachChild((i=>{e&&!pu(i)&&(e=!1)})),e}function Nd(o){if(o instanceof fs&&o.name==="feature-state")return!1;let e=!0;return o.eachChild((i=>{e&&!Nd(i)&&(e=!1)})),e}function Vd(o){if(o instanceof gu)return new Set([o.key]);let e=new Set;return o.eachChild((i=>{e=new Set([...e,...Vd(i)])})),e}function mu(o,e){if(o instanceof fs&&e.indexOf(o.name)>=0)return!1;let i=!0;return o.eachChild((l=>{i&&!mu(l,e)&&(i=!1)})),i}function j_(o,e,i){return[o,e,i].filter(Boolean).join("")}function Kp(o,e){switch(o){case"string":return Ts(e);case"number":return+e;case"boolean":return!!e;case"color":return Hi.parse(e);case"formatted":return ds.fromString(Ts(e));case"resolvedImage":return ws.build(Ts(e))}return e}function G_(o,e,i,l){return l!==void 0&&(o=l*Math.round(o/l)),e!==void 0&&o<e&&(o=e),i!==void 0&&o>i&&(o=i),o}class gu{constructor(e,i,l,u=!1){this.type=e,this.key=i,this.scope=l,this.featureConstant=u}static parse(e,i){let l=i.expectedType;if(l==null&&(l=Bi),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const u=i.parse(e[1],1);if(!(u instanceof si))return i.error("Key name of 'config' expression must be a string literal.");let f,p=!0;const v=Ts(u.value);if(e.length>=3){const w=i.parse(e[2],2);if(!(w instanceof si))return i.error("Scope of 'config' expression must be a string literal.");f=Ts(w.value)}if(i.options){const w=j_(v,f,i._scope),E=i.options.get(w);E&&(p=pu(E.value||E.default))}return new gu(l,v,f,p)}evaluate(e){const i=j_(this.key,this.scope,e.scope),l=e.getConfig(i);if(!l)return null;const{type:u,value:f,values:p,minValue:v,maxValue:w,stepValue:E}=l,C=l.default.evaluate(e);let z=C;if(f){const L=e.scope;e.scope=(L||"").split("").slice(1).join(""),z=f.evaluate(e),e.scope=L}return u&&(z=Kp(u,z)),z===void 0||v===void 0&&w===void 0&&E===void 0||(typeof z=="number"?z=G_(z,v,w,E):Array.isArray(z)&&(z=z.map((L=>typeof L=="number"?G_(L,v,w,E):L)))),f!==void 0&&z!==void 0&&p&&!p.includes(z)&&(z=C,u&&(z=Kp(u,z))),(u&&u!==this.type||z!==void 0&&!dh(ko(z),this.type))&&(z=Kp(this.type.kind,z)),z}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Ud{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=e[1];return i.scope.has(l)?new Ud(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class jd{constructor(e,i=[],l,u=new Sd,f=[],p,v,w){this.registry=e,this.path=i,this.key=i.map((E=>typeof E=="string"?`['${E}']`:`[${E}]`)).join(""),this.scope=u,this.errors=f,this.expectedType=l,this._scope=p,this.options=v,this.iconImageUseTheme=w}parse(e,i,l,u,f={}){return i||l?this.concat(i,null,l,u)._parse(e,f):this._parse(e,f)}parseObjectValue(e,i,l,u,f,p={}){return this.concat(i,l,u,f)._parse(e,p)}_parse(e,i){function l(u,f,p){return p==="assert"?new On(f,[u]):p==="coerce"?new ao(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let f=u.parse(e,this);if(!f)return null;if(this.expectedType){const p=this.expectedType,v=f.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||v.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(p,v))return null}else f=l(f,p,i.typeAnnotation||"coerce");else f=l(f,p,i.typeAnnotation||"assert")}if(!(f instanceof si)&&f.type.kind!=="resolvedImage"&&Jp(f)){const p=new Ja(this._scope,this.options,this.iconImageUseTheme);try{f=new si(f.type,f.evaluate(p))}catch(v){return this.error(v.message),null}}return f}return ao.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,l,u){let f=typeof e=="number"?this.path.concat(e):this.path;f=typeof i=="string"?f.concat(i):f;const p=u?this.scope.concat(u):this.scope;return new jd(this.registry,f,l||null,p,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const l=`${this.key}${i.map((u=>`[${u}]`)).join("")}`;this.errors.push(new _a(l,e))}checkSubtype(e,i){const l=uh(e,i);return l&&this.error(l),l}}function Jp(o){if(o instanceof Ud)return Jp(o.boundExpression);if(o instanceof fs&&o.name==="error"||o instanceof Go||o instanceof fc||o instanceof pc||o instanceof gu)return!1;const e=o instanceof ao||o instanceof On;let i=!0;return o.eachChild((l=>{i=e?i&&Jp(l):i&&l instanceof si})),!!i&&pu(o)&&mu(o,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Gd(o,e){const i=o.length-1;let l,u,f=0,p=i,v=0;for(;f<=p;)if(v=Math.floor((f+p)/2),l=o[v],u=o[v+1],l<=e){if(v===i||e<u)return v;f=v+1}else{if(!(l>e))throw new an("Input is not a number.");p=v-1}return 0}class xh{constructor(e,i,l){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of l)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(e[1],1,bn);if(!l)return null;const u=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let p=1;p<e.length;p+=2){const v=p===1?-1/0:e[p],w=e[p+1],E=p,C=p+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(u.length&&u[u.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const z=i.parse(w,C,f);if(!z)return null;f=f||z.type,u.push([v,z])}return new xh(f,l,u)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return l[0].evaluate(e);const f=i.length;return u>=i[f-1]?l[f-1].evaluate(e):l[Gd(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const W_=.95047,q_=1.08883,H_=4/29,kl=6/29,Z_=3*kl*kl,X_=kl*kl*kl,zx=Math.PI/180,Dx=180/Math.PI;function Qp(o){return o>X_?Math.pow(o,1/3):o/Z_+H_}function Wd(o){return o>kl?o*o*o:Z_*(o-H_)}function qd(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Rl(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function $p(o){const e=Rl(o.r),i=Rl(o.g),l=Rl(o.b),u=Qp((.4124564*e+.3575761*i+.1804375*l)/W_),f=Qp((.2126729*e+.7151522*i+.072175*l)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-Qp((.0193339*e+.119192*i+.9503041*l)/q_)),alpha:o.a}}function em(o){let e=(o.l+16)/116,i=isNaN(o.a)?e:e+o.a/500,l=isNaN(o.b)?e:e-o.b/200;return e=1*Wd(e),i=W_*Wd(i),l=q_*Wd(l),new Hi(qd(3.2404542*i-1.5371385*e-.4985314*l),qd(-.969266*i+1.8760108*e+.041556*l),qd(.0556434*i-.2040259*e+1.0572252*l),o.alpha)}function Lx(o,e,i){const l=e-o;return o+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const mc={forward:$p,reverse:em,interpolate:function(o,e,i){return{l:Rn(o.l,e.l,i),a:Rn(o.a,e.a,i),b:Rn(o.b,e.b,i),alpha:Rn(o.alpha,e.alpha,i)}}},gc={forward:function(o){const{l:e,a:i,b:l}=$p(o),u=Math.atan2(l,i)*Dx;return{h:u<0?u+360:u,c:Math.sqrt(i*i+l*l),l:e,alpha:o.a}},reverse:function(o){const e=o.h*zx,i=o.c;return em({l:o.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:o.alpha})},interpolate:function(o,e,i){return{h:Lx(o.h,e.h,i),c:Rn(o.c,e.c,i),l:Rn(o.l,e.l,i),alpha:Rn(o.alpha,e.alpha,i)}}};var Y_=Object.freeze({__proto__:null,hcl:gc,lab:mc});class Gs{constructor(e,i,l,u,f){this.type=e,this.operator=i,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[p,v]of f)this.labels.push(p),this.outputs.push(v)}static interpolationFactor(e,i,l,u){let f=0;if(e.name==="exponential")f=Hd(i,e.base,l,u);else if(e.name==="linear")f=Hd(i,1,l,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;f=new Po(p[0],p[1],p[2],p[3]).solve(Hd(i,1,l,u))}return f}static parse(e,i){let[l,u,f,...p]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const E=u[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:E}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const E=u.slice(1);if(E.length!==4||E.some((C=>typeof C!="number"||C<0||C>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,bn),!f)return null;const v=[];let w=null;l==="interpolate-hcl"||l==="interpolate-lab"?w=As:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let E=0;E<p.length;E+=2){const C=p[E],z=p[E+1],L=E+3,N=E+4;if(typeof C!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(v.length&&v[v.length-1][0]>=C)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const U=i.parse(z,N,w);if(!U)return null;w=w||U.type,v.push([C,U])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new Gs(w,l,u,f,v):i.error(`Type ${yo(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return l[0].evaluate(e);const f=i.length;if(u>=i[f-1])return l[f-1].evaluate(e);const p=Gd(i,u),v=Gs.interpolationFactor(this.interpolation,u,i[p],i[p+1]),w=l[p].evaluate(e),E=l[p+1].evaluate(e);return this.operator==="interpolate"?Us[this.type.kind.toLowerCase()](w,E,v):this.operator==="interpolate-hcl"?gc.reverse(gc.interpolate(gc.forward(w),gc.forward(E),v)):mc.reverse(mc.interpolate(mc.forward(w),mc.forward(E),v))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function Hd(o,e,i,l){const u=l-i,f=o-i;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}class bh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let l=null;const u=i.expectedType;u&&u.kind!=="value"&&(l=u);const f=[];for(const v of e.slice(1)){const w=i.parse(v,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,f.push(w)}const p=u&&f.some((v=>uh(u,v.type)));return new bh(p?Bi:l,f)}evaluate(e){let i,l=null,u=0;for(const f of this.args){if(u++,l=f.evaluate(e),l&&l instanceof ws&&!l.available&&(i||(i=l),l=null,u===this.args.length))return i;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Zd{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let f=1;f<e.length-1;f+=2){const p=e[f];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,f);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const v=i.parse(e[f+1],f+1);if(!v)return null;l.push([p,v])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,l);return u?new Zd(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,l]of this.bindings)e.push(i,l.serialize());return e.push(this.result.serialize()),e}}class tm{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,bn),u=i.parse(e[2],2,os(i.expectedType||Bi));return l&&u?new tm(u.type.itemType,l,u):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new an("Array index out of bounds: negative index");if(i>=l.length)throw new an("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new an("Array index must be an integer. Use at-interpolated for fractional indices");return l[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class nm{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,bn),u=i.parse(e[2],2,os(i.expectedType||Bi));return l&&u?new nm(u.type.itemType,l,u):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new an(`Array index out of bounds: ${i} < 0.`);if(i>l.length-1)throw new an(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i===Math.floor(i))return l[i];const u=Math.floor(i),f=Math.ceil(i),p=l[u],v=l[f];if(typeof p!="number"||typeof v!="number")throw new an(`Cannot interpolate between non-number values at index ${i}.`);const w=i-u;return p*(1-w)+v*w}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Xd{constructor(e,i){this.type=Ji,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Bi),u=i.parse(e[2],2,Bi);return l&&u?Np(l.type,[Ji,Zi,bn,Pa,Bi])?new Xd(l,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${yo(l.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!hh(i,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${yo(ko(i))} instead.`);if(!hh(l,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${yo(ko(l))} instead.`);return l.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class wh{constructor(e,i,l){this.type=bn,this.needle=e,this.haystack=i,this.fromIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Bi),u=i.parse(e[2],2,Bi);if(!l||!u)return null;if(!Np(l.type,[Ji,Zi,bn,Pa,Bi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${yo(l.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,bn);return f?new wh(l,u,f):null}return new wh(l,u)}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!hh(i,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${yo(ko(i))} instead.`);if(!hh(l,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${yo(ko(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return l.indexOf(i,u)}return l.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class _u{constructor(e,i,l,u,f,p){this.inputType=e,this.type=i,this.input=l,this.cases=u,this.outputs=f,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let l,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const f={},p=[];for(let E=2;E<e.length-1;E+=2){let C=e[E];const z=e[E+1];Array.isArray(C)||(C=[C]);const L=i.concat(E);if(C.length===0)return L.error("Expected at least one branch label.");for(const U of C){if(typeof U!="number"&&typeof U!="string")return L.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return L.error("Numeric branch labels must be integer values.");if(l){if(L.checkSubtype(l,ko(U)))return null}else l=ko(U);if(f[String(U)]!==void 0)return L.error("Branch labels must be unique.");f[String(U)]=p.length}const N=i.parse(z,E,u);if(!N)return null;u=u||N.type,p.push(N)}const v=i.parse(e[1],1,Bi);if(!v)return null;const w=i.parse(e[e.length-1],e.length-1,u);return w?v.type.kind!=="value"&&i.concat(1).checkSubtype(l,v.type)?null:new _u(l,u,v,f,p,w):null}evaluate(e){const i=this.input.evaluate(e);return(dh(ko(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],u={};for(const p of i){const v=u[this.cases[p]];v===void 0?(u[this.cases[p]]=l.length,l.push([this.cases[p],[p]])):l[v][1].push(p)}const f=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,v]of l)e.push(v.length===1?f(v[0]):v.map(f)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class im{constructor(e,i,l){this.type=e,this.branches=i,this.otherwise=l}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const v=i.parse(e[p],p,Ji);if(!v)return null;const w=i.parse(e[p+1],p+1,l);if(!w)return null;u.push([v,w]),l=l||w.type}const f=i.parse(e[e.length-1],e.length-1,l);return f?new im(l,u,f):null}evaluate(e){for(const[i,l]of this.branches)if(i.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,l]of this.branches)e(i),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Th{constructor(e,i,l,u){this.type=e,this.input=i,this.beginIndex=l,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Bi),u=i.parse(e[2],2,bn);if(!l||!u)return null;if(!Np(l.type,[os(Bi),Zi,Bi]))return i.error(`Expected first argument to be of type array or string, but found ${yo(l.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,bn);return f?new Th(l.type,l,u,f):null}return new Th(l.type,l,u)}evaluate(e){const i=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!hh(i,["string","array"]))throw new an(`Expected first argument to be of type array or string, but found ${yo(ko(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(l,u)}return i.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class rm{constructor(e,i){this.type=os(Zi),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Zi),u=i.parse(e[2],2,Zi);return l&&u?new rm(l,u):void 0}evaluate(e){const i=this.str.evaluate(e),l=this.delimiter.evaluate(e);return i.split(l)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function K_(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function om(o,e,i,l){return l.compare(e,i)===0}function _c(o,e,i){const l=o!=="=="&&o!=="!=";return class vR{constructor(f,p,v){this.type=Ji,this.lhs=f,this.rhs=p,this.collator=v,this.hasUntypedArgument=f.type.kind==="value"||p.type.kind==="value"}static parse(f,p){if(f.length!==3&&f.length!==4)return p.error("Expected two or three arguments.");const v=f[0];let w=p.parse(f[1],1,Bi);if(!w)return null;if(!K_(v,w.type))return p.concat(1).error(`"${v}" comparisons are not supported for type '${yo(w.type)}'.`);let E=p.parse(f[2],2,Bi);if(!E)return null;if(!K_(v,E.type))return p.concat(2).error(`"${v}" comparisons are not supported for type '${yo(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return p.error(`Cannot compare types '${yo(w.type)}' and '${yo(E.type)}'.`);l&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new On(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new On(w.type,[E])));let C=null;if(f.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(C=p.parse(f[3],3,Ed),!C)return null}return new vR(w,E,C)}evaluate(f){const p=this.lhs.evaluate(f),v=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const w=ko(p),E=ko(v);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new an(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=ko(p),E=ko(v);if(w.kind!=="string"||E.kind!=="string")return e(f,p,v)}return this.collator?i(f,p,v,this.collator.evaluate(f)):e(f,p,v)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[o];return this.eachChild((p=>{f.push(p.serialize())})),f}}}const Ox=_c("==",(function(o,e,i){return e===i}),om),Fx=_c("!=",(function(o,e,i){return e!==i}),(function(o,e,i,l){return!om(0,e,i,l)})),Bx=_c("<",(function(o,e,i){return e<i}),(function(o,e,i,l){return l.compare(e,i)<0})),Yd=_c(">",(function(o,e,i){return e>i}),(function(o,e,i,l){return l.compare(e,i)>0})),Nx=_c("<=",(function(o,e,i){return e<=i}),(function(o,e,i,l){return l.compare(e,i)<=0})),Vx=_c(">=",(function(o,e,i){return e>=i}),(function(o,e,i,l){return l.compare(e,i)>=0}));class sm{constructor(e,i,l,u,f,p){this.type=Zi,this.number=e,this.locale=i,this.currency=l,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const l=i.parse(e[1],1,bn);if(!l)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parseObjectValue(u.locale,2,"locale",Zi),!f))return null;let p=null;if(u.currency&&(p=i.parseObjectValue(u.currency,2,"currency",Zi),!p))return null;let v=null;if(u.unit&&(v=i.parseObjectValue(u.unit,2,"unit",Zi),!v))return null;let w=null;if(u["min-fraction-digits"]&&(w=i.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",bn),!w))return null;let E=null;return u["max-fraction-digits"]&&(E=i.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",bn),!E)?null:new sm(l,f,p,v,w,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class am{constructor(e){this.type=bn,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=i.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${yo(l.type)} instead.`):new am(l):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new an(`Expected value to be of type string or array, but found ${yo(ko(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function lm(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const yu={"==":Ox,"!=":Fx,">":Yd,"<":Bx,">=":Vx,"<=":Nx,array:On,at:tm,"at-interpolated":nm,boolean:On,case:im,coalesce:bh,collator:Go,format:hc,image:su,in:Xd,"index-of":wh,interpolate:Gs,"interpolate-hcl":Gs,"interpolate-lab":Gs,length:am,let:Zd,literal:si,match:_u,number:On,"number-format":sm,object:On,slice:Th,step:xh,string:On,"to-boolean":ao,"to-color":ao,"to-number":ao,"to-string":ao,var:Ud,within:fc,distance:pc,config:gu,split:rm};function J_(o,[e,i,l,u]){e=e.evaluate(o),i=i.evaluate(o),l=l.evaluate(o);const f=u?u.evaluate(o):1,p=R_(e,i,l,f);if(p)throw new an(p);return new Hi(e/255,i/255,l/255,f)}function cm(o,[e,i,l,u]){e=e.evaluate(o),i=i.evaluate(o),l=l.evaluate(o);const f=u?u.evaluate(o):1,p=(function(E,C,z,L){return typeof E=="number"&&E>=0&&E<=360?typeof C=="number"&&C>=0&&C<=100&&typeof z=="number"&&z>=0&&z<=100?L===void 0||typeof L=="number"&&L>=0&&L<=1?null:`Invalid hsla value [${[E,C,z,L].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof L=="number"?[E,C,z,L]:[E,C,z]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof L=="number"?[E,C,z,L]:[E,C,z]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,l,f);if(p)throw new an(p);const v=`hsla(${e}, ${i}%, ${l}%, ${f})`,w=Hi.parse(v);if(!w)throw new an(`Failed to parse HSLA color: ${v}`);return w}function um(o,e){return o in e}function Kd(o,e){const i=e[o];return i===void 0?null:i}function yc(o){return{type:o}}function vc(o){return{result:"success",value:o}}function zl(o){return{result:"error",value:o}}function hm(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function Jd(o){return o["property-type"]==="data-driven"}function dm(o){return hm(o.expression,"measure-light")}function fm(o){return hm(o.expression,"zoom")}function Qd(o){return!!o.expression&&o.expression.interpolated}function $d(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function pm(o){return o}function ef(o,e){const i=e.type==="color",l=o.stops&&typeof o.stops[0][0]=="object",u=l||!(l||o.property!==void 0),f=o.type||(Qd(e)?"exponential":"interval");if(i&&((o=Object.assign({},o)).stops&&(o.stops=o.stops.map((E=>[E[0],Hi.parse(E[1])]))),o.default=Hi.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!Y_[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let p,v,w;if(f==="exponential")p=Q_;else if(f==="interval")p=Dl;else if(f==="categorical"){p=Ux,v=Object.create(null);for(const E of o.stops)v[E[0]]=E[1];w=typeof o.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);p=jx}if(l){const E={},C=[];for(let N=0;N<o.stops.length;N++){const U=o.stops[N],X=U[0].zoom;E[X]===void 0&&(E[X]={zoom:X,type:o.type,property:o.property,default:o.default,stops:[]},C.push(X)),E[X].stops.push([U[0].value,U[1]])}const z=[];for(const N of C)z.push([E[N].zoom,ef(E[N],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Gs.interpolationFactor.bind(void 0,L),zoomStops:z.map((N=>N[0])),evaluate:({zoom:N},U)=>Q_({stops:z,base:o.base},e,N).evaluate(N,U)}}if(u){const E=f==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Gs.interpolationFactor.bind(void 0,E),zoomStops:o.stops.map((C=>C[0])),evaluate:({zoom:C})=>p(o,e,C,v,w)}}return{kind:"source",evaluate(E,C){const z=C&&C.properties?C.properties[o.property]:void 0;return z===void 0?vu(o.default,e.default):p(o,e,z,v,w)}}}function vu(o,e,i){return o!==void 0?o:e!==void 0?e:i!==void 0?i:void 0}function Ux(o,e,i,l,u){return vu(typeof i===u?l[i]:void 0,o.default,e.default)}function Dl(o,e,i){if(!mh(i))return vu(o.default,e.default);const l=o.stops.length;if(l===1||i<=o.stops[0][0])return o.stops[0][1];if(i>=o.stops[l-1][0])return o.stops[l-1][1];const u=Gd(o.stops.map((f=>f[0])),i);return o.stops[u][1]}function Q_(o,e,i){const l=o.base!==void 0?o.base:1;if(!mh(i))return vu(o.default,e.default);const u=o.stops.length;if(u===1||i<=o.stops[0][0])return o.stops[0][1];if(i>=o.stops[u-1][0])return o.stops[u-1][1];const f=Gd(o.stops.map((C=>C[0])),i),p=(function(C,z,L,N){const U=N-L,X=C-L;return U===0?0:z===1?X/U:(Math.pow(z,X)-1)/(Math.pow(z,U)-1)})(i,l,o.stops[f][0],o.stops[f+1][0]),v=o.stops[f][1],w=o.stops[f+1][1];let E=Us[e.type]||pm;if(o.colorSpace&&o.colorSpace!=="rgb"){const C=Y_[o.colorSpace];E=(z,L)=>C.reverse(C.interpolate(C.forward(z),C.forward(L),p))}return typeof v.evaluate=="function"?{evaluate(...C){const z=v.evaluate.apply(void 0,C),L=w.evaluate.apply(void 0,C);if(z!==void 0&&L!==void 0)return E(z,L,p)}}:E(v,w,p)}function jx(o,e,i){return e.type==="color"?i=Hi.parse(i):e.type==="formatted"?i=ds.fromString(i.toString()):e.type==="resolvedImage"?i=ws.build(i.toString()):jn(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),vu(i,o.default,e.default)}fs.register(yu,{error:[{kind:"error"},[Zi],(o,[e])=>{throw new an(e.evaluate(o))}],typeof:[Zi,[Bi],(o,[e])=>yo(ko(e.evaluate(o)))],"to-rgba":[os(bn,4),[As],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[os(bn,4),[As],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[As,[bn,bn,bn],J_],rgba:[As,[bn,bn,bn,bn],J_],hsl:[As,[bn,bn,bn],cm],hsla:[As,[bn,bn,bn,bn],cm],has:{type:Ji,overloads:[[[Zi],(o,[e])=>um(e.evaluate(o),o.properties())],[[Zi,uc],(o,[e,i])=>um(e.evaluate(o),i.evaluate(o))]]},get:{type:Bi,overloads:[[[Zi],(o,[e])=>Kd(e.evaluate(o),o.properties())],[[Zi,uc],(o,[e,i])=>Kd(e.evaluate(o),i.evaluate(o))]]},"feature-state":[Bi,[Zi],(o,[e])=>Kd(e.evaluate(o),o.featureState||{})],properties:[uc,[],o=>o.properties()],"geometry-type":[Zi,[],o=>o.geometryType()],worldview:[Zi,[],o=>o.globals.worldview||""],id:[Bi,[],o=>o.id()],zoom:[bn,[],o=>o.globals.zoom],pitch:[bn,[],o=>o.globals.pitch||0],"distance-from-center":[bn,[],o=>o.distanceFromCenter()],"measure-light":[bn,[Zi],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[bn,[],o=>o.globals.heatmapDensity||0],"line-progress":[bn,[],o=>o.globals.lineProgress||0],"raster-value":[bn,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[bn,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[bn,[],o=>o.globals.skyRadialProgress||0],accumulated:[Bi,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[bn,yc(bn),(o,e)=>{let i=0;for(const l of e)i+=l.evaluate(o);return i}],"*":[bn,yc(bn),(o,e)=>{let i=1;for(const l of e)i*=l.evaluate(o);return i}],"-":{type:bn,overloads:[[[bn,bn],(o,[e,i])=>e.evaluate(o)-i.evaluate(o)],[[bn],(o,[e])=>-e.evaluate(o)]]},"/":[bn,[bn,bn],(o,[e,i])=>e.evaluate(o)/i.evaluate(o)],"%":[bn,[bn,bn],(o,[e,i])=>e.evaluate(o)%i.evaluate(o)],ln2:[bn,[],()=>Math.LN2],pi:[bn,[],()=>Math.PI],e:[bn,[],()=>Math.E],"^":[bn,[bn,bn],(o,[e,i])=>Math.pow(e.evaluate(o),i.evaluate(o))],sqrt:[bn,[bn],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[bn,[bn],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[bn,[bn],(o,[e])=>Math.log(e.evaluate(o))],log2:[bn,[bn],(o,[e])=>Math.log2(e.evaluate(o))],sin:[bn,[bn],(o,[e])=>Math.sin(e.evaluate(o))],cos:[bn,[bn],(o,[e])=>Math.cos(e.evaluate(o))],tan:[bn,[bn],(o,[e])=>Math.tan(e.evaluate(o))],asin:[bn,[bn],(o,[e])=>Math.asin(e.evaluate(o))],acos:[bn,[bn],(o,[e])=>Math.acos(e.evaluate(o))],atan:[bn,[bn],(o,[e])=>Math.atan(e.evaluate(o))],min:[bn,yc(bn),(o,e)=>Math.min(...e.map((i=>i.evaluate(o))))],max:[bn,yc(bn),(o,e)=>Math.max(...e.map((i=>i.evaluate(o))))],abs:[bn,[bn],(o,[e])=>Math.abs(e.evaluate(o))],round:[bn,[bn],(o,[e])=>{const i=e.evaluate(o);return i<0?-Math.round(-i):Math.round(i)}],floor:[bn,[bn],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[bn,[bn],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[Ji,[Zi,Bi],(o,[e,i])=>o.properties()[e.value]===i.value],"filter-id-==":[Ji,[Bi],(o,[e])=>o.id()===e.value],"filter-type-==":[Ji,[Zi],(o,[e])=>o.geometryType()===e.value],"filter-<":[Ji,[Zi,Bi],(o,[e,i])=>{const l=o.properties()[e.value],u=i.value;return typeof l==typeof u&&l<u}],"filter-id-<":[Ji,[Bi],(o,[e])=>{const i=o.id(),l=e.value;return typeof i==typeof l&&i<l}],"filter->":[Ji,[Zi,Bi],(o,[e,i])=>{const l=o.properties()[e.value],u=i.value;return typeof l==typeof u&&l>u}],"filter-id->":[Ji,[Bi],(o,[e])=>{const i=o.id(),l=e.value;return typeof i==typeof l&&i>l}],"filter-<=":[Ji,[Zi,Bi],(o,[e,i])=>{const l=o.properties()[e.value],u=i.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[Ji,[Bi],(o,[e])=>{const i=o.id(),l=e.value;return typeof i==typeof l&&i<=l}],"filter->=":[Ji,[Zi,Bi],(o,[e,i])=>{const l=o.properties()[e.value],u=i.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[Ji,[Bi],(o,[e])=>{const i=o.id(),l=e.value;return typeof i==typeof l&&i>=l}],"filter-has":[Ji,[Bi],(o,[e])=>e.value in o.properties()],"filter-has-id":[Ji,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Ji,[os(Zi)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[Ji,[os(Bi)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[Ji,[Zi,os(Bi)],(o,[e,i])=>i.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[Ji,[Zi,os(Bi)],(o,[e,i])=>(function(l,u,f,p){for(;f<=p;){const v=f+p>>1;if(u[v]===l)return!0;u[v]>l?p=v-1:f=v+1}return!1})(o.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ji,overloads:[[[Ji,Ji],(o,[e,i])=>e.evaluate(o)&&i.evaluate(o)],[yc(Ji),(o,e)=>{for(const i of e)if(!i.evaluate(o))return!1;return!0}]]},any:{type:Ji,overloads:[[[Ji,Ji],(o,[e,i])=>e.evaluate(o)||i.evaluate(o)],[yc(Ji),(o,e)=>{for(const i of e)if(i.evaluate(o))return!0;return!1}]]},"!":[Ji,[Ji],(o,[e])=>!e.evaluate(o)],"is-supported-script":[Ji,[Zi],(o,[e])=>{const i=o.globals&&o.globals.isSupportedScript;return!i||i(e.evaluate(o))}],upcase:[Zi,[Zi],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[Zi,[Zi],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[Zi,yc(Bi),(o,e)=>e.map((i=>Ts(i.evaluate(o)))).join("")],"resolved-locale":[Zi,[Ed],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[bn,[bn,bn,Bi],(o,e)=>{const[i,l,u]=e.map((p=>p.evaluate(o)));if(i>l||i===l)return i;let f;if(typeof u=="string")f=(function(p){let v=0;if(p.length===0)return v;for(let w=0;w<p.length;w++)v=(v<<5)-v+p.charCodeAt(w),v|=0;return v})(u);else{if(typeof u!="number")throw new an(`Invalid seed input: ${u}`);f=u}return i+lm(f)()*(l-i)}]});class tf{constructor(e,i,l,u,f){this.expression=e,this._warningHistory={},this._evaluator=new Ja(l,u,f),this._defaultValue=i?(function(p){return p.type==="color"&&($d(p.default)||Array.isArray(p.default))?new Hi(0,0,0,0):p.type==="color"?Hi.parse(p.default)||null:p.default===void 0?null:p.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Vd(e)}evaluateWithoutErrorHandling(e,i,l,u,f,p,v,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,l,u,f,p,v,w,E){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this._evaluator.iconImageUseTheme=E||null;try{const C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new an(`Expected value to be one of ${Object.keys(this._enumValues).map((z=>JSON.stringify(z))).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${C.message}`)),this._defaultValue}}}function mm(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in yu}function Ra(o,e,i,l,u){const f=new jd(yu,[],e?(function(v){const w={color:As,string:Zi,number:bn,enum:Zi,boolean:Ji,formatted:Il,resolvedImage:ch};return v.type==="array"?os(w[v.value]||Bi,v.length):w[v.type]})(e):void 0,void 0,void 0,i,l,u),p=f.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?vc(new tf(p,e,i,l,u)):zl(f.errors)}class Sh{constructor(e,i,l,u){this.kind=e,this._styleExpression=i,this.isLightConstant=l,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!Nd(i.expression),this.configDependencies=Vd(i.expression)}evaluateWithoutErrorHandling(e,i,l,u,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,u,f,p)}evaluate(e,i,l,u,f,p,v){return this._styleExpression.evaluate(e,i,l,u,f,p,void 0,void 0,v)}}class Ll{constructor(e,i,l,u,f,p){this.kind=e,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Nd(i.expression),this.isLightConstant=f,this.isLineProgressConstant=p,this.configDependencies=Vd(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,l,u,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,u,f,p)}evaluate(e,i,l,u,f,p){return this._styleExpression.evaluate(e,i,l,u,f,p)}interpolationFactor(e,i,l){return this.interpolationType?Gs.interpolationFactor(this.interpolationType,e,i,l):0}}function gm(o,e,i,l,u){if((o=Ra(o,e,i,l,u)).result==="error")return o;const f=o.value.expression,p=pu(f);if(!p&&!Jd(e))return zl([new _a("","data expressions not supported")]);const v=mu(f,["zoom","pitch","distance-from-center"]);if(!v&&!fm(e))return zl([new _a("","zoom expressions not supported")]);const w=mu(f,["measure-light"]);if(!w&&!dm(e))return zl([new _a("","measure-light expression not supported")]);const E=mu(f,["line-progress"]);if(!E&&!(function(L){return hm(L.expression,"line-progress")})(e))return zl([new _a("","line-progress expression not supported")]);const C=e.expression&&e.expression.relaxZoomRestriction,z=rf(f);return z||v||C?z instanceof _a?zl([z]):z instanceof Gs&&!Qd(e)?zl([new _a("",'"interpolate" expressions cannot be used with this property')]):vc(z?new Ll(p&&E?"camera":"composite",o.value,z.labels,z instanceof Gs?z.interpolation:void 0,w,E):new Sh(p&&E?"constant":"source",o.value,w,E)):zl([new _a("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class nf{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,ef(this._parameters,this._specification))}static deserialize(e){return new nf(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function rf(o){let e=null;if(o instanceof Zd)e=rf(o.result);else if(o instanceof bh){for(const i of o.args)if(e=rf(i),e)break}else(o instanceof xh||o instanceof Gs)&&o.input instanceof fs&&o.input.name==="zoom"&&(e=o);return e instanceof _a||o.eachChild((i=>{const l=rf(i);l instanceof _a?e=l:e&&l&&e!==l&&(e=new _a("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Eh,of,$_=(function(){if(of)return Eh;of=1,Eh=e;var o=3;function e(i,l,u){var f=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var p=new Int32Array(this.arrayBuffer);i=p[0],this.d=(l=p[1])+2*(u=p[2]);for(var v=0;v<this.d*this.d;v++){var w=p[o+v],E=p[o+v+1];f.push(w===E?null:p.subarray(w,E))}var C=p[o+f.length+1];this.keys=p.subarray(p[o+f.length],C),this.bboxes=p.subarray(C),this.insert=this._insertReadonly}else{this.d=l+2*u;for(var z=0;z<this.d*this.d;z++)f.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=u,this.scale=l/i,this.uid=0;var L=u/l*i;this.min=-L,this.max=i+L}return e.prototype.insert=function(i,l,u,f,p){this._forEachCell(l,u,f,p,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(p)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,l,u,f,p,v){this.cells[p].push(v)},e.prototype.query=function(i,l,u,f,p){var v=this.min,w=this.max;if(i<=v&&l<=v&&w<=u&&w<=f&&!p)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(i,l,u,f,this._queryCell,E,{},p),E},e.prototype._queryCell=function(i,l,u,f,p,v,w,E){var C=this.cells[p];if(C!==null)for(var z=this.keys,L=this.bboxes,N=0;N<C.length;N++){var U=C[N];if(w[U]===void 0){var X=4*U;(E?E(L[X+0],L[X+1],L[X+2],L[X+3]):i<=L[X+2]&&l<=L[X+3]&&u>=L[X+0]&&f>=L[X+1])?(w[U]=!0,v.push(z[U])):w[U]=!1}}},e.prototype._forEachCell=function(i,l,u,f,p,v,w,E){for(var C=this._convertToCellCoord(i),z=this._convertToCellCoord(l),L=this._convertToCellCoord(u),N=this._convertToCellCoord(f),U=C;U<=L;U++)for(var X=z;X<=N;X++){var J=this.d*X+U;if((!E||E(this._convertFromCellCoord(U),this._convertFromCellCoord(X),this._convertFromCellCoord(U+1),this._convertFromCellCoord(X+1)))&&p.call(this,i,l,u,f,J,v,w,E))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,l=o+this.cells.length+1+1,u=0,f=0;f<this.cells.length;f++)u+=this.cells[f].length;var p=new Int32Array(l+u+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var v=l,w=0;w<i.length;w++){var E=i[w];p[o+w]=v,p.set(E,v),v+=E.length}return p[o+i.length]=v,p.set(this.keys,v),p[o+i.length+1]=v+=this.keys.length,p.set(this.bboxes,v),v+=this.bboxes.length,p.buffer},Eh})(),xc=Xo($_);const xu={};function ln(o,e,i={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),xu[e]={klass:o,omit:i.omit||[]}}ln(Object,"Object"),xc.serialize=function(o,e){const i=o.toArrayBuffer();return e&&e.add(i),{buffer:i}},xc.deserialize=function(o){return new xc(o.buffer)},Object.defineProperty(xc,"name",{value:"Grid"}),ln(xc,"Grid"),delete Mt.prototype.constructor,typeof DOMMatrix<"u"&&ln(DOMMatrix,"DOMMatrix"),ln(Hi,"Color"),ln(Error,"Error"),ln(ds,"Formatted"),ln(Ad,"FormattedSection"),ln(zp,"AJAXError"),ln(ws,"ResolvedImage"),ln(nf,"StylePropertyFunction"),ln(tf,"StyleExpression",{omit:["_evaluator"]}),ln(Vs,"ImageId"),ln(ya,"ImageVariant"),ln(Ll,"ZoomDependentExpression"),ln(Sh,"ZoomConstantExpression"),ln(fs,"CompoundExpression",{omit:["_evaluate"]});for(const o in yu)xu[yu[o]._classRegistryKey]||ln(yu[o],`Expression${o}`);function _m(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Qa(o){return self.ImageBitmap&&o instanceof ImageBitmap}function Ol(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(_m(o)||Qa(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const i=[];for(const l of o)i.push(Ol(l,e));return i}if(o instanceof Map){const i={$name:"Map",entries:[]};for(const[l,u]of o.entries())i.entries.push(Ol(l),Ol(u,e));return i}if(o instanceof Set){const i={$name:"Set"};let l=0;for(const u of o.values())i[++l]=Ol(u);return i}if(o instanceof DOMMatrix){const i={$name:"DOMMatrix"},l=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const u of l)i[u]=o[u];return i}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const i=o.constructor,l=i._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const u=i.serialize?i.serialize(o,e):{};if(!i.serialize){for(const f in o)o.hasOwnProperty(f)&&(xu[l].omit.indexOf(f)>=0||(u[f]=Ol(o[f],e)));o instanceof Error&&(u.message=o.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof o)}function Fl(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||_m(o)||Qa(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(Fl);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const u=o.entries||[],f=new Map;for(let p=0;p<u.length;p+=2)f.set(Fl(u[p]),Fl(u[p+1]));return f}if(e==="Set"){const u=new Set;for(const f of Object.keys(o))f!=="$name"&&u.add(Fl(o[f]));return u}if(e==="DOMMatrix"){let u;return u=o.is2D?[o.a,o.b,o.c,o.d,o.e,o.f]:[o.m11,o.m12,o.m13,o.m14,o.m21,o.m22,o.m23,o.m24,o.m31,o.m32,o.m33,o.m34,o.m41,o.m42,o.m43,o.m44],new DOMMatrix(u)}if(e==="BigInt")return BigInt(o.value);const{klass:i}=xu[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(o);const l=Object.create(i.prototype);for(const u of Object.keys(o))u!=="$name"&&(l[u]=Fl(o[u]));return l}throw new Error("can't deserialize object of type "+typeof o)}const Pn={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function ym(o){for(const e of o)if(af(e.charCodeAt(0)))return!0;return!1}function ey(o){for(const e of o)if(!sf(e.charCodeAt(0)))return!1;return!0}function sf(o){return!(Pn.Arabic(o)||Pn["Arabic Supplement"](o)||Pn["Arabic Extended-A"](o)||Pn["Arabic Presentation Forms-A"](o)||Pn["Arabic Presentation Forms-B"](o))}function af(o){return!(o!==746&&o!==747&&(o<4352||!(Pn["Bopomofo Extended"](o)||Pn.Bopomofo(o)||Pn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Pn["CJK Compatibility Ideographs"](o)||Pn["CJK Compatibility"](o)||Pn["CJK Radicals Supplement"](o)||Pn["CJK Strokes"](o)||!(!Pn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Pn["CJK Unified Ideographs Extension A"](o)||Pn["CJK Unified Ideographs"](o)||Pn["Enclosed CJK Letters and Months"](o)||Pn["Hangul Compatibility Jamo"](o)||Pn["Hangul Jamo Extended-A"](o)||Pn["Hangul Jamo Extended-B"](o)||Pn["Hangul Jamo"](o)||Pn["Hangul Syllables"](o)||Pn.Hiragana(o)||Pn["Ideographic Description Characters"](o)||Pn.Kanbun(o)||Pn["Kangxi Radicals"](o)||Pn["Katakana Phonetic Extensions"](o)||Pn.Katakana(o)&&o!==12540||!(!Pn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Pn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Pn["Unified Canadian Aboriginal Syllabics"](o)||Pn["Unified Canadian Aboriginal Syllabics Extended"](o)||Pn["Vertical Forms"](o)||Pn["Yijing Hexagram Symbols"](o)||Pn["Yi Syllables"](o)||Pn["Yi Radicals"](o))))}function lf(o){return!(af(o)||(function(e){return!!(Pn["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Pn["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Pn["Letterlike Symbols"](e)||Pn["Number Forms"](e)||Pn["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Pn["Control Pictures"](e)&&e!==9251||Pn["Optical Character Recognition"](e)||Pn["Enclosed Alphanumerics"](e)||Pn["Geometric Shapes"](e)||Pn["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Pn["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Pn["CJK Symbols and Punctuation"](e)||Pn.Katakana(e)||Pn["Private Use Area"](e)||Pn["CJK Compatibility Forms"](e)||Pn["Small Form Variants"](e)||Pn["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(o))}function Gx(o){return Pn.Arabic(o)||Pn["Arabic Supplement"](o)||Pn["Arabic Extended-A"](o)||Pn["Arabic Presentation Forms-A"](o)||Pn["Arabic Presentation Forms-B"](o)}function ty(o){return o>=1424&&o<=2303||Pn["Arabic Presentation Forms-A"](o)||Pn["Arabic Presentation Forms-B"](o)}function Wx(o,e){return!(!e&&ty(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Pn.Khmer(o))}function qx(o){for(const e of o)if(ty(e.charCodeAt(0)))return!0;return!1}const Is={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let vm=null,ps=Is.unavailable,Bl=null;const ny=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(ps=Is.error),vm&&vm(o)};function xm(){bm.fire(new ga("pluginStateChange",{pluginStatus:ps,pluginURL:Bl}))}const bm=new cc,cf=function(){return ps},bc=function(){if(ps!==Is.deferred||!Bl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ps=Is.loading,xm(),Bl&&nu({url:Bl},(o=>{o?ny(o):(ps=Is.loaded,xm())}))},za={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ps===Is.loaded||za.applyArabicShaping!=null,isLoading:()=>ps===Is.loading,setState(o){ps=o.pluginStatus,Bl=o.pluginURL},isParsing:()=>ps===Is.parsing,isParsed:()=>ps===Is.parsed,getPluginURL:()=>Bl};class dr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,l){for(const u of i)if(!Wx(u.charCodeAt(0),l))return!1;return!0})(e,za.isLoaded())}}class wc{constructor(e,i,l,u,f){this.property=e,this.value=i,this.expression=(function(p,v,w,E,C){if($d(p))return new nf(p,v);if(mm(p)||Array.isArray(p)&&p.length>0){const z=gm(p,v,w,E,C);if(z.result==="error")throw new Error(z.value.map((L=>`${L.key}: ${L.message}`)).join(", "));return z.value}{let z=p;return typeof p=="string"&&v.type==="color"&&(z=Hi.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>z}}})(i===void 0?e.specification.default:i,e.specification,l,u,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,l,u){return this.property.possiblyEvaluate(this,e,i,l,u)}}class wm{constructor(e,i,l,u){this.property=e,this.value=new wc(e,void 0,i,l,u)}transitioned(e,i){return new $a(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new $a(this.property,this.value,null,{},0)}}class iy{constructor(e,i,l,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=l,this._iconImageUseTheme=u,this.configDependencies=new Set}getValue(e){return kn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new wm(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new wc(this._values[e].property,i===null?void 0:kn(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const l=this._properties.properties;if(e)for(const u in e){const f=e[u];if(u.endsWith("-transition")){const p=u.slice(0,-11);l[p]&&this.setTransition(p,f)}else l.hasOwnProperty(u)&&this.setValue(u,f)}}getTransition(e){return kn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new wm(this._values[e].property)),this._values[e].transition=kn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const l=new Tm(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,i._values[u]);return l}untransitioned(){const e=new Tm(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class $a{constructor(e,i,l,u,f){const p=u.delay||0,v=u.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+p,this.end=this.begin+v,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,i,l){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,l),p=this.prior;if(p){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return p.possiblyEvaluate(e,i,l);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,l),f,we(v))}}return f}}class Tm{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,l){const u=new Ec(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,l);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Tc{constructor(e,i,l,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=l,this._iconImageUseTheme=u,this.configDependencies=new Set}getValue(e){return kn(this._values[e].value)}setValue(e,i){this._values[e]=new wc(this._values[e].property,i===null?void 0:kn(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l)}return e}possiblyEvaluate(e,i,l,u){const f=new Ec(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].possiblyEvaluate(e,i,l,u);return f}}class Sc{constructor(e,i,l,u){this.property=e,this.value=i,this.parameters=l,this.iconImageUseTheme=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,l,u){return this.property.evaluate(this.value,this.parameters,e,i,l,u,this.iconImageUseTheme)}}class Ec{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Wt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,l){const u=Us[this.specification.type];return u?u(e,i,l):e}}class tn{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,l,u,f){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Sc(this,{kind:"constant",value:e.expression.evaluate(i,null,{},l,u,void 0,f)},i):new Sc(this,e.expression,i,f)}interpolate(e,i,l){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Sc(this,{kind:"constant",value:void 0},e.parameters);const u=Us[this.specification.type];return u?new Sc(this,{kind:"constant",value:u(e.value.value,i.value.value,l)},e.parameters):e}evaluate(e,i,l,u,f,p,v){return e.kind==="constant"?e.value:e.evaluate(i,l,u,f,p,void 0,v)}}class bu{constructor(e){this.specification=e}possiblyEvaluate(e,i,l,u){return!!e.expression.evaluate(i,null,{},l,u)}interpolate(){return!1}}class Ur{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new dr(0,{});for(const l in e){const u=e[l];u.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new wc(u,void 0),p=this.defaultTransitionablePropertyValues[l]=new wm(u);this.defaultTransitioningPropertyValues[l]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate(i)}}}ln(tn,"DataDrivenProperty"),ln(Wt,"DataConstantProperty"),ln(bu,"ColorRampProperty");var Ye=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function uf(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Ac(o){if(Array.isArray(o))return o.map(Ac);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const i in o)e[i]=Ac(o[i]);return e}return uf(o)}function hf(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!hf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ah(o,e="",i=null,l="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};hf(o)||(o=df(o));const u=o;let f=!0;try{f=(function(C){if(!wu(C))return C;let z=Ac(C);return xa(z),z=ry(z),z})(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let p=null,v=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){v=Ye[`filter_${l}`];const C=Ra(f,v,e,i);if(C.result==="error")throw new Error(C.value.map((z=>`${z.key}: ${z.message}`)).join(", "));p=(z,L,N)=>C.value.evaluate(z,L,{},N)}let w=null,E=null;if(f!==u){const C=Ra(u,v,e,i);if(C.result==="error")throw new Error(C.value.map((z=>`${z.key}: ${z.message}`)).join(", "));w=(z,L,N,U,X)=>C.value.evaluate(z,L,{},N,void 0,void 0,U,X),E=!pu(C.value.expression)}return{filter:p,dynamicFilter:w||void 0,needGeometry:sy(f),needFeature:!!E}}function ry(o){if(!Array.isArray(o))return o;const e=(function(i){if(oy.has(i[0])){for(let l=1;l<i.length;l++)if(wu(i[l]))return!0}return i})(o);return e===!0?e:e.map((i=>ry(i)))}function xa(o){let e=!1;const i=[];if(o[0]==="case"){for(let l=1;l<o.length-1;l+=2)e=e||wu(o[l]),i.push(o[l+1]);i.push(o[o.length-1])}else if(o[0]==="match"){e=e||wu(o[1]);for(let l=2;l<o.length-1;l+=2)i.push(o[l+1]);i.push(o[o.length-1])}else if(o[0]==="step"){e=e||wu(o[1]);for(let l=1;l<o.length-1;l+=2)i.push(o[l+1])}e&&(o.length=0,o.push("any",...i));for(let l=1;l<o.length;l++)xa(o[l])}function wu(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<o.length;i++)if(wu(o[i]))return!0;return!1}const oy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Hx(o,e){return o<e?-1:o>e?1:0}function sy(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(sy(o[e]))return!0;return!1}function df(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?Sm(o[1],o[2],"=="):e==="!="?ff(Sm(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Sm(o[1],o[2],e):e==="any"?(i=o.slice(1),["any"].concat(i.map(df))):e==="all"?["all"].concat(o.slice(1).map(df)):e==="none"?["all"].concat(o.slice(1).map(df).map(ff)):e==="in"?ay(o[1],o.slice(2)):e==="!in"?ff(ay(o[1],o.slice(2))):e==="has"?ly(o[1]):e!=="!has"||ff(ly(o[1]));var i}function Sm(o,e,i){switch(o){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,o,e]}}function ay(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",o,["literal",e.sort(Hx)]]:["filter-in-small",o,["literal",e]]}}function ly(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function ff(o){return["!",o]}const Ih="";function Tu(o,e){return e?`${o}${Ih}${e}`:o}let Em;const cy=()=>Em||(Em=new Ur({"icon-size":new tn(Ye.layout_symbol["icon-size"]),"icon-image":new tn(Ye.layout_symbol["icon-image"]),"icon-rotate":new tn(Ye.layout_symbol["icon-rotate"]),"icon-offset":new tn(Ye.layout_symbol["icon-offset"])}));class Zx{constructor(e,i,l,u,f,p){const v=Ra(e,Ye.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=i,l){this.properties=new Ec(cy()),this.unevaluatedLayout=new Tc(cy(),u,f,p);for(const w in l)this.unevaluatedLayout.setValue(w,l[w])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.properties&&(e.properties=this.properties),e}}const uy="-transition",hy=new Set(["fill","line","background","hillshade","raster"]);class ss extends cc{constructor(e,i,l,u,f,p){if(super(),this.id=e.id,this.fqid=Tu(this.id,l),this.type=e.type,this.scope=l,this.lut=u,this.options=f,this.iconImageUseTheme=p,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const v=Ra(this.filter,Ye[`filter_${e.type}`]);v.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...v.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),e.appearances&&e.appearances.forEach((v=>{this.appearances.push(new Zx(v.condition,v.name,v.properties,this.scope,f,this.iconImageUseTheme))})),i.layout&&(this._unevaluatedLayout=new Tc(i.layout,this.scope,f,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new iy(i.paint,this.scope,f);for(const v in e.paint)this.setPaintProperty(v,e.paint[v]);for(const v in e.layout)this.setLayoutProperty(v,e.layout[v]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ec(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&hy.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(uy)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const l=this._transitionablePaint,u=l._properties.properties;if(e.endsWith(uy)){const z=e.slice(0,-11);return u[z]&&l.setTransition(z,i||void 0),!1}if(!u[e])return!1;const f=l._values[e],p=f.value.isDataDriven(),v=f.value;l.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const w=l._values[e].value,E=w.isDataDriven(),C=e.endsWith("pattern")||e==="line-dasharray";return E||p||C||this._handleOverridablePaintPropertyUpdate(e,v,w)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,l){return null}_handleOverridablePaintPropertyUpdate(e,i,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((i=>i.serialize()))),hi(e,((i,l)=>!(i===void 0||l==="layout"&&!Object.keys(i).length||l==="paint"&&!Object.keys(i).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Sc&&Jd(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Ah(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(e){}queryIntersectsFeature(e,i,l,u,f,p,v,w,E){}}const Nl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Su{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class br{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xi(o,e=1){let i=0,l=0;return{members:o.map((u=>{const f=Nl[u.type].BYTES_PER_ELEMENT,p=i=dy(i,Math.max(e,f)),v=u.components||1;return l=Math.max(l,f),i+=f*v,{name:u.name,type:u.type,components:v,offset:p}})),size:dy(i,Math.max(l,e)),alignment:e}}function dy(o,e){return Math.ceil(o/e)*e}class Vl extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=l,e}}Vl.prototype.bytesPerElement=4,ln(Vl,"StructArrayLayout2i4");class Ic extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=l,this.int16[f+2]=u,e}}Ic.prototype.bytesPerElement=6,ln(Ic,"StructArrayLayout3i6");class Mc extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=l,this.int16[p+2]=u,this.int16[p+3]=f,e}}Mc.prototype.bytesPerElement=8,ln(Mc,"StructArrayLayout4i8");class Ul extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ul.prototype.bytesPerElement=4,ln(Ul,"StructArrayLayout1f4");class Am extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=4*e,p=2*e;return this.int16[f+0]=i,this.int16[f+1]=l,this.float32[p+1]=u,e}}Am.prototype.bytesPerElement=8,ln(Am,"StructArrayLayout2i1f8");class pf extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=l,this.int16[f+2]=u,e}}pf.prototype.bytesPerElement=8,ln(pf,"StructArrayLayout3i8");class Im extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,u,f)}emplace(e,i,l,u,f,p){const v=5*e;return this.int16[v+0]=i,this.int16[v+1]=l,this.int16[v+2]=u,this.int16[v+3]=f,this.int16[v+4]=p,e}}Im.prototype.bytesPerElement=10,ln(Im,"StructArrayLayout5i10");class mf extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,u,f,p,v)}emplace(e,i,l,u,f,p,v,w){const E=6*e,C=12*e,z=3*e;return this.int16[E+0]=i,this.int16[E+1]=l,this.uint8[C+4]=u,this.uint8[C+5]=f,this.uint8[C+6]=p,this.uint8[C+7]=v,this.float32[z+2]=w,e}}mf.prototype.bytesPerElement=12,ln(mf,"StructArrayLayout2i4ub1f12");class Ss extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=l,this.float32[f+2]=u,e}}Ss.prototype.bytesPerElement=12,ln(Ss,"StructArrayLayout3f12");class jl extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,u,f)}emplace(e,i,l,u,f,p){const v=6*e,w=3*e;return this.uint16[v+0]=i,this.uint16[v+1]=l,this.uint16[v+2]=u,this.uint16[v+3]=f,this.float32[w+2]=p,e}}jl.prototype.bytesPerElement=12,ln(jl,"StructArrayLayout4ui1f12");class Eu extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const p=4*e;return this.uint16[p+0]=i,this.uint16[p+1]=l,this.uint16[p+2]=u,this.uint16[p+3]=f,e}}Eu.prototype.bytesPerElement=8,ln(Eu,"StructArrayLayout4ui8");class gf extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,u,f,p)}emplace(e,i,l,u,f,p,v){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=u,this.int16[w+3]=f,this.int16[w+4]=p,this.int16[w+5]=v,e}}gf.prototype.bytesPerElement=12,ln(gf,"StructArrayLayout6i12");class Mm extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p,v,w,E,C,z,L){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,l,u,f,p,v,w,E,C,z,L)}emplace(e,i,l,u,f,p,v,w,E,C,z,L,N){const U=12*e;return this.int16[U+0]=i,this.int16[U+1]=l,this.int16[U+2]=u,this.int16[U+3]=f,this.uint16[U+4]=p,this.uint16[U+5]=v,this.uint16[U+6]=w,this.uint16[U+7]=E,this.int16[U+8]=C,this.int16[U+9]=z,this.int16[U+10]=L,this.int16[U+11]=N,e}}Mm.prototype.bytesPerElement=24,ln(Mm,"StructArrayLayout4i4ui4i24");class Cm extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,u,f,p)}emplace(e,i,l,u,f,p,v){const w=10*e,E=5*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=u,this.float32[E+2]=f,this.float32[E+3]=p,this.float32[E+4]=v,e}}Cm.prototype.bytesPerElement=20,ln(Cm,"StructArrayLayout3i3f20");class ba extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=l,this.float32[p+2]=u,this.float32[p+3]=f,e}}ba.prototype.bytesPerElement=16,ln(ba,"StructArrayLayout4f16");class Au extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Au.prototype.bytesPerElement=4,ln(Au,"StructArrayLayout1ul4");class vo extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=l,e}}vo.prototype.bytesPerElement=4,ln(vo,"StructArrayLayout2ui4");class Iu extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p,v,w,E,C,z,L,N){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,l,u,f,p,v,w,E,C,z,L,N)}emplace(e,i,l,u,f,p,v,w,E,C,z,L,N,U){const X=20*e,J=10*e;return this.int16[X+0]=i,this.int16[X+1]=l,this.int16[X+2]=u,this.int16[X+3]=f,this.int16[X+4]=p,this.float32[J+3]=v,this.float32[J+4]=w,this.float32[J+5]=E,this.float32[J+6]=C,this.int16[X+14]=z,this.uint32[J+8]=L,this.uint16[X+18]=N,this.uint16[X+19]=U,e}}Iu.prototype.bytesPerElement=40,ln(Iu,"StructArrayLayout5i4f1i1ul2ui40");class _f extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,u,f,p,v)}emplace(e,i,l,u,f,p,v,w){const E=8*e;return this.int16[E+0]=i,this.int16[E+1]=l,this.int16[E+2]=u,this.int16[E+4]=f,this.int16[E+5]=p,this.int16[E+6]=v,this.int16[E+7]=w,e}}_f.prototype.bytesPerElement=16,ln(_f,"StructArrayLayout3i2i2i16");class Pm extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,u,f)}emplace(e,i,l,u,f,p){const v=4*e,w=8*e;return this.float32[v+0]=i,this.float32[v+1]=l,this.float32[v+2]=u,this.int16[w+6]=f,this.int16[w+7]=p,e}}Pm.prototype.bytesPerElement=16,ln(Pm,"StructArrayLayout2f1f2i16");class km extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,u,f,p)}emplace(e,i,l,u,f,p,v){const w=20*e,E=5*e;return this.uint8[w+0]=i,this.uint8[w+1]=l,this.float32[E+1]=u,this.float32[E+2]=f,this.float32[E+3]=p,this.float32[E+4]=v,e}}km.prototype.bytesPerElement=20,ln(km,"StructArrayLayout2ub4f20");class Eo extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=l,this.uint16[f+2]=u,e}}Eo.prototype.bytesPerElement=6,ln(Eo,"StructArrayLayout3ui6");class Mh extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J,Q,le,he,ge,Le){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J,Q,le,he,ge,Le)}emplace(e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J,Q,le,he,ge,Le,Oe){const Ve=30*e,We=15*e,He=60*e;return this.int16[Ve+0]=i,this.int16[Ve+1]=l,this.int16[Ve+2]=u,this.float32[We+2]=f,this.float32[We+3]=p,this.uint16[Ve+8]=v,this.uint16[Ve+9]=w,this.uint32[We+5]=E,this.uint32[We+6]=C,this.uint32[We+7]=z,this.uint16[Ve+16]=L,this.uint16[Ve+17]=N,this.uint16[Ve+18]=U,this.float32[We+10]=X,this.float32[We+11]=J,this.uint8[He+48]=Q,this.uint8[He+49]=le,this.uint8[He+50]=he,this.uint32[We+13]=ge,this.int16[Ve+28]=Le,this.uint8[He+58]=Oe,e}}Mh.prototype.bytesPerElement=60,ln(Mh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Rm extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J,Q,le,he,ge,Le,Oe,Ve,We,He,Tt,Ke,Et,Ft,It,Pt,Ut,bt){const kt=this.length;return this.resize(kt+1),this.emplace(kt,e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J,Q,le,he,ge,Le,Oe,Ve,We,He,Tt,Ke,Et,Ft,It,Pt,Ut,bt)}emplace(e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J,Q,le,he,ge,Le,Oe,Ve,We,He,Tt,Ke,Et,Ft,It,Pt,Ut,bt,kt){const dt=20*e,lt=40*e,jt=80*e;return this.float32[dt+0]=i,this.float32[dt+1]=l,this.int16[lt+4]=u,this.int16[lt+5]=f,this.int16[lt+6]=p,this.int16[lt+7]=v,this.int16[lt+8]=w,this.int16[lt+9]=E,this.int16[lt+10]=C,this.int16[lt+11]=z,this.int16[lt+12]=L,this.uint16[lt+13]=N,this.uint16[lt+14]=U,this.uint16[lt+15]=X,this.uint16[lt+16]=J,this.uint16[lt+17]=Q,this.uint16[lt+18]=le,this.uint16[lt+19]=he,this.uint16[lt+20]=ge,this.uint16[lt+21]=Le,this.uint16[lt+22]=Oe,this.uint16[lt+23]=Ve,this.uint16[lt+24]=We,this.uint16[lt+25]=He,this.uint16[lt+26]=Tt,this.uint16[lt+27]=Ke,this.uint32[dt+14]=Et,this.float32[dt+15]=Ft,this.float32[dt+16]=It,this.float32[dt+17]=Pt,this.float32[dt+18]=Ut,this.uint8[jt+76]=bt,this.uint16[lt+39]=kt,e}}Rm.prototype.bytesPerElement=80,ln(Rm,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Ch extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,u,f,p)}emplace(e,i,l,u,f,p,v){const w=6*e;return this.float32[w+0]=i,this.float32[w+1]=l,this.float32[w+2]=u,this.float32[w+3]=f,this.float32[w+4]=p,this.float32[w+5]=v,e}}Ch.prototype.bytesPerElement=24,ln(Ch,"StructArrayLayout6f24");class Cc extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,u,f)}emplace(e,i,l,u,f,p){const v=5*e;return this.float32[v+0]=i,this.float32[v+1]=l,this.float32[v+2]=u,this.float32[v+3]=f,this.float32[v+4]=p,e}}Cc.prototype.bytesPerElement=20,ln(Cc,"StructArrayLayout5f20");class zm extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,u,f,p,v)}emplace(e,i,l,u,f,p,v,w){const E=7*e;return this.float32[E+0]=i,this.float32[E+1]=l,this.float32[E+2]=u,this.float32[E+3]=f,this.float32[E+4]=p,this.float32[E+5]=v,this.float32[E+6]=w,e}}zm.prototype.bytesPerElement=28,ln(zm,"StructArrayLayout7f28");class yf extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p,v,w,E,C,z){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,l,u,f,p,v,w,E,C,z)}emplace(e,i,l,u,f,p,v,w,E,C,z,L){const N=11*e;return this.float32[N+0]=i,this.float32[N+1]=l,this.float32[N+2]=u,this.float32[N+3]=f,this.float32[N+4]=p,this.float32[N+5]=v,this.float32[N+6]=w,this.float32[N+7]=E,this.float32[N+8]=C,this.float32[N+9]=z,this.float32[N+10]=L,e}}yf.prototype.bytesPerElement=44,ln(yf,"StructArrayLayout11f44");class Ph extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p,v,w,E){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,l,u,f,p,v,w,E)}emplace(e,i,l,u,f,p,v,w,E,C){const z=9*e;return this.float32[z+0]=i,this.float32[z+1]=l,this.float32[z+2]=u,this.float32[z+3]=f,this.float32[z+4]=p,this.float32[z+5]=v,this.float32[z+6]=w,this.float32[z+7]=E,this.float32[z+8]=C,e}}Ph.prototype.bytesPerElement=36,ln(Ph,"StructArrayLayout9f36");class Mu extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=l,e}}Mu.prototype.bytesPerElement=8,ln(Mu,"StructArrayLayout2f8");class vf extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=l,this.uint16[p+3]=u,this.uint16[p+4]=f,e}}vf.prototype.bytesPerElement=12,ln(vf,"StructArrayLayout1ul3ui12");class xf extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}xf.prototype.bytesPerElement=2,ln(xf,"StructArrayLayout1ui2");class Dm extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J)}emplace(e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J,Q){const le=16*e;return this.float32[le+0]=i,this.float32[le+1]=l,this.float32[le+2]=u,this.float32[le+3]=f,this.float32[le+4]=p,this.float32[le+5]=v,this.float32[le+6]=w,this.float32[le+7]=E,this.float32[le+8]=C,this.float32[le+9]=z,this.float32[le+10]=L,this.float32[le+11]=N,this.float32[le+12]=U,this.float32[le+13]=X,this.float32[le+14]=J,this.float32[le+15]=Q,e}}Dm.prototype.bytesPerElement=64,ln(Dm,"StructArrayLayout16f64");class Cu extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,p,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,u,f,p,v)}emplace(e,i,l,u,f,p,v,w){const E=10*e,C=5*e;return this.uint16[E+0]=i,this.uint16[E+1]=l,this.uint16[E+2]=u,this.uint16[E+3]=f,this.float32[C+2]=p,this.float32[C+3]=v,this.float32[C+4]=w,e}}Cu.prototype.bytesPerElement=20,ln(Cu,"StructArrayLayout4ui3f20");class Pu extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Pu.prototype.bytesPerElement=2,ln(Pu,"StructArrayLayout1i2");class bf extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}bf.prototype.bytesPerElement=1,ln(bf,"StructArrayLayout1ub1");class fy extends Su{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}fy.prototype.size=40;class Lm extends Iu{get(e){return new fy(this,e)}}ln(Lm,"CollisionBoxArray");class py extends Su{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}py.prototype.size=60;class wf extends Mh{get(e){return new py(this,e)}}ln(wf,"PlacedSymbolArray");class my extends Su{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}my.prototype.size=80;class gy extends Rm{get(e){return new my(this,e)}}ln(gy,"SymbolInstanceArray");class _y extends Ul{getoffsetX(e){return this.float32[1*e+0]}}ln(_y,"GlyphOffsetArray");class yy extends Vl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ln(yy,"SymbolLineVertexArray");class Om extends Su{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Om.prototype.size=12;class vy extends vf{get(e){return new Om(this,e)}}ln(vy,"FeatureIndexArray");class xy extends vo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ln(xy,"FillExtrusionCentroidArray");class by extends Su{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}by.prototype.size=6;class wy extends Ic{get(e){return new by(this,e)}}ln(wy,"FillExtrusionWallArray");const Xx=xi([{name:"a_pos",components:2,type:"Int16"}],4),Yx=xi([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Kx=xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Fr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,l,u){let f=this.segments[this.segments.length-1];return e>Fr.MAX_VERTEX_ARRAY_LENGTH&&oi(`Max vertices per segment is ${Fr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Fr.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:i,primitiveOffset:l,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}prepareSegment(e,i,l,u){return this._prepareSegment(e,i.length,l.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,l,u){return new Fr([{vertexOffset:e,primitiveOffset:i,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}function kh(o,e){return 256*(o=Pe(Math.floor(o),0,255))+Pe(Math.floor(e),0,255)}Fr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ln(Fr,"SegmentVector");const Jx=xi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Qx=xi([{name:"a_pattern_b",components:4,type:"Uint16"}]),Tf=xi([{name:"a_dash",components:4,type:"Uint16"}]);class Rh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,l,u){this.ids.push(Fm(e)),this.positions.push(i,l,u)}eachPosition(e,i){const l=Fm(e);let u=0,f=this.ids.length-1;for(;u<f;){const p=u+f>>1;this.ids[p]>=l?f=p:u=p+1}for(;this.ids[u]===l;)i(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,i){const l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Bm(l,u,0,l.length-1),i&&(i.add(l.buffer),i.add(u.buffer)),{ids:l,positions:u}}static deserialize(e){const i=new Rh;let l;i.ids=e.ids,i.positions=e.positions;for(const u of i.ids)u!==l&&i.uniqueIds.push(u),l=u;return i.indexed=!0,i}}function Fm(o){const e=+o;return Number.isSafeInteger(e)?e:xd(String(o))}function Bm(o,e,i,l){for(;i<l;){const u=o[i+l>>1];let f=i-1,p=l+1;for(;;){do f++;while(o[f]<u);do p--;while(o[p]>u);if(f>=p)break;zh(o,f,p),zh(e,3*f,3*p),zh(e,3*f+1,3*p+1),zh(e,3*f+2,3*p+2)}p-i<l-p?(Bm(o,e,i,p),i=p+1):(Bm(o,e,p+1,l),l=p)}}function zh(o,e,i){const l=o[e];o[e]=o[i],o[i]=l}ln(Rh,"FeaturePositionMap");class Da{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Dh extends Da{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class no extends Da{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class La extends Da{constructor(e){super(e),this.current=[0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Lh extends Da{constructor(e){super(e),this.current=[0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class Oh extends Da{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Ty extends Da{constructor(e){super(e),this.current=Hi.transparent.toPremultipliedRenderColor(null)}set(e,i,l){this.fetchUniformLocation(e,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const $x=new Float32Array(16);class Fh extends Da{constructor(e){super(e),this.current=$x}set(e,i,l){if(this.fetchUniformLocation(e,i)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const e1=new Float32Array(9),t1=new Float32Array(4);class Sf extends Da{constructor(e){super(e),this.current=t1}set(e,i,l){if(this.fetchUniformLocation(e,i)){for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function Bh(o){return[kh(255*o.r,255*o.g),kh(255*o.b,255*o.a)]}class Ws{constructor(e,i,l,u){this.value=e,this.uniformNames=i.map((f=>`u_${f}`)),this.type=l,this.context=u}setUniform(e,i,l,u,f){const p=u.constantOr(this.value);i.set(e,f,p instanceof Hi?p.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):p)}getBinding(e,i){return this.type==="color"?new Ty(e):new no(e)}}class Pc{constructor(e,i){this.uniformNames=i.map((l=>`u_${l}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,l,u,f){let p=null;f!=="u_pattern"&&f!=="u_dash"||(p=this.pattern),f==="u_pattern_b"&&(p=this.patternTransition),f==="u_pixel_ratio"&&(p=this.pixelRatio),p&&i.set(e,f,p)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Oh(e):new no(e)}}class Gl{constructor(e,i,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map((f=>({name:`a_${f}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,i,l,u,f,p,v,w){const E=this.paintVertexArray.length,C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new dr(0,{brightness:p,worldview:w}),i,{},f,u,v):this.expression.kind==="constant"&&this.expression.value,z=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new dr(0,{brightness:p,worldview:w}),i,{},f,u,v):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(E,e,C,z?null:this.context.lut)}updatePaintArray(e,i,l,u,f,p,v,w){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:w},l,u,void 0,f):this.expression.kind==="constant"&&this.expression.value,C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new dr(0,{brightness:v,worldview:w}),l,u,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,i,E,C?null:this.context.lut)}_setPaintValue(e,i,l,u){if(this.type==="color"){const f=Bh(l.toPremultipliedRenderColor(u));for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,f[0],f[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class el{constructor(e,i,l,u,f,p){this.expression=e,this.uniformNames=i.map((v=>`u_${v}_t`)),this.type=l,this.useIntegerZoom=u,this.context=f,this.maxValue=0,this.paintVertexAttributes=i.map((v=>({name:`a_${v}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,i,l,u,f,p,v,w){const E=this.expression.evaluate(new dr(this.context.zoom,{brightness:p,worldview:w}),i,{},f,u,v),C=this.expression.evaluate(new dr(this.context.zoom+1,{brightness:p,worldview:w}),i,{},f,u,v),z=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new dr(0,{brightness:p,worldview:w}),i,{},f,u,v):this.lutExpression.value)==="none",L=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(L,e,E,C,z?null:this.context.lut)}updatePaintArray(e,i,l,u,f,p,v,w){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:w},l,u,void 0,f),C=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:w},l,u,void 0,f),z=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new dr(0,{brightness:v,worldview:w}),l,u,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,i,E,C,z?null:this.context.lut)}_setPaintValue(e,i,l,u,f){if(this.type==="color"){const p=Bh(l.toPremultipliedRenderColor(f)),v=Bh(l.toPremultipliedRenderColor(f));for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,p[0],p[1],v[0],v[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,l,u,f){const p=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,v=Pe(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);i.set(e,f,v)}getBinding(e,i){return new no(e)}}class tl{constructor(e,i,l,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(l==="array"?Tf:Jx).members;for(let p=0;p<i.length;++p);this.paintVertexArray=new u,this.paintTransitionVertexArray=new Eu}populatePaintArray(e,i,l,u){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(e,i,l,u,f,p,v){this._setPaintValues(e,i,l.patterns&&l.patterns[this.layerId],p)}_setPaintValues(e,i,l,u){if(!u||!l)return;const f=u[l[0]],p=u[l[1]];if(f){if(f){const{tl:v,br:w,pixelRatio:E}=f;for(let C=e;C<i;C++)this.paintVertexArray.emplace(C,v[0],v[1],w[0],w[1],E)}if(p){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:w}=p;for(let E=e;E<i;E++)this.paintTransitionVertexArray.emplace(E,v[0],v[1],w[0],w[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Qx.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class kc{constructor(e,i,l=(()=>!0)){this.binders={},this._buffers=[],this.context=i;const u=[];for(const f in e.paint._values){const p=e.paint.get(f);if(f.endsWith("-use-theme")||!l(f)||!(p instanceof Sc&&Jd(p.property.specification)))continue;const v=_S(f,e.type),w=p.value,E=p.property.specification.type,C=!!p.property.useIntegerZoom,z=f==="line-dasharray"||f.endsWith("pattern"),L=e.paint.get(`${f}-use-theme`),N=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||L&&L.value.kind!=="constant";if(w.kind!=="constant"||N)if(w.kind==="source"||N||z){const U=a(f,E,"source");this.binders[f]=z?new tl(w,v,E,U,e.id):new Gl(w,v,E,U),u.push(`/a_${f}`)}else{const U=a(f,E,"composite");this.binders[f]=new el(w,v,E,C,i,U),u.push(`/z_${f}`)}else this.binders[f]=z?new Pc(w.value,v):new Ws(w.value,v,E,i),u.push(`/u_${f}`);L&&(this.binders[f].lutExpression=L.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Gl||i instanceof el?i.maxValue:0}populatePaintArrays(e,i,l,u,f,p,v,w){for(const E in this.binders){const C=this.binders[E];C.context=this.context,(C instanceof Gl||C instanceof el||C instanceof tl)&&C.populatePaintArray(e,i,l,u,f,p,v,w)}}setConstantPatternPositions(e,i){for(const l in this.binders){const u=this.binders[l];u instanceof Pc&&u.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof tl?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,l,u,f,p,v,w,E,C){let z=!1;const L=Object.keys(e),N=L.length!==0&&!w,U=N?L:i.uniqueIds;this.context.lut=f.lut;for(const X in this.binders){const J=this.binders[X];if(J.context=this.context,(J instanceof Gl||J instanceof el||J instanceof tl)&&J.expression&&J.expression.kind&&J.expression.kind!=="constant"&&(J.expression.isStateDependent===!0||J.expression.isLightConstant===!1)){const Q=f.paint.get(X);J.expression=Q.value;for(const le of U){const he=e[le.toString()];i.eachPosition(le,((ge,Le,Oe)=>{const Ve=u.feature(ge);J.updatePaintArray(Le,Oe,Ve,he,p,v,E,C)}))}if(!N)for(const le of l.uniqueIds){const he=e[le.toString()];l.eachPosition(le,((ge,Le,Oe)=>{const Ve=u.feature(ge);J.updatePaintArray(Le,Oe,Ve,he,p,v,E,C)}))}z=!0}}return z}defines(){const e=[];for(const i in this.binders){const l=this.binders[i];(l instanceof Ws||l instanceof Pc)&&e.push(...l.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Ws||u instanceof Pc||u instanceof el)for(const f of u.uniformNames)i.push({name:f,property:l,binding:u.getBinding(e,f)})}return i}setUniforms(e,i,l,u,f){for(const{name:p,property:v,binding:w}of l)this.binders[v].setUniform(e,w,f,u.get(v),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Gl||i instanceof el||i instanceof tl)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof tl&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const l=this.binders[i];(l instanceof Gl||l instanceof el||l instanceof tl)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Gl||i instanceof el||i instanceof tl)&&i.destroy()}}}class wa{constructor(e,i,l=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new kc(u,i,l);this.needsUpload=!1,this._featureMap=new Rh,this._featureMapWithoutIds=new Rh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,l,u,f,p,v,w,E){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(e,i,u,f,p,v,w,E);i.id!==void 0?this._featureMap.add(i.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,l,u,f,p,v,w){for(const E of l)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,E,u,f,p,v||0,w)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Sy={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function _S(o,e){return Sy[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const d={"line-pattern":{source:jl,composite:jl},"fill-pattern":{source:jl,composite:jl},"fill-extrusion-pattern":{source:jl,composite:jl},"line-dasharray":{source:Eu,composite:Eu}},t={color:{source:Mu,composite:ba},number:{source:Ul,composite:Mu}};function a(o,e,i){const l=d[o];return l&&l[i]||t[e][i]}ln(Ws,"ConstantBinder"),ln(Pc,"PatternConstantBinder"),ln(Gl,"SourceExpressionBinder"),ln(tl,"PatternCompositeBinder"),ln(el,"CompositeExpressionBinder"),ln(kc,"ProgramConfiguration",{omit:["_buffers"]}),ln(wa,"ProgramConfigurationSet");const h=Yt/Math.PI/2,g=5,y=6,b=16383,S=64,M=[S,32,16],D=-h,O=h;function j(o,e,i,l=h){return i=Xe(i),[o*Math.sin(i)*l,-e*l,o*Math.cos(i)*l]}function B(o,e,i){return j(Math.cos(Xe(o)),Math.sin(Xe(o)),e,i)}const q=63710088e-1,H=2*Math.PI*q;class Z{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Z(Ge(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,l=this.lat*i,u=e.lat*i,f=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return q*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new re({lng:this.lng-l,lat:this.lat-i},{lng:this.lng+l,lat:this.lat+i})}toEcef(e){return B(this.lat,this.lng,h+e*h/q)}static convert(e){if(e instanceof Z)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Z(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Z(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class re{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Z?new Z(e.lng,e.lat):Z.convert(e),this}setSouthWest(e){return this._sw=e instanceof Z?new Z(e.lng,e.lat):Z.convert(e),this}extend(e){const i=this._sw,l=this._ne;let u,f;if(e instanceof Z)u=e,f=e;else{if(!(e instanceof re))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(re.convert(e)):this.extend(Z.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Z.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return i||l?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new Z(u.lng,u.lat),this._ne=new Z(f.lng,f.lat)),this}getCenter(){return new Z((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Z(this.getWest(),this.getNorth())}getSouthEast(){return new Z(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=Z.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){if(e)return e instanceof re?e:new re(e)}}const $=0,ae=25.5;function pe(o){return H*Math.cos(o*Math.PI/180)}function ye(o){return(180+o)/360}function Ce(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Ae(o,e){return o/pe(e)}function ke(o){return 360*o-180}function Me(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Ee(o,e){return o*pe(Me(e))}const ze=85.051129;function ot(o){return Math.cos(Xe(Pe(o,-ze,ze)))}function Ze(o,e){const i=Pe(e,$,ae),l=Math.pow(2,i);return ot(o)*H/(512*l)}function mt(o){return 1/Math.cos(o*Math.PI/180)}function $e(o,e=0){const i=Math.exp(Math.PI*(1-(o.y+e/Yt)/(1<<o.z)*2));return 80150034*i/(i*i+1)/Yt/(1<<o.z)}class pt{constructor(e,i,l=0){this.x=+e,this.y=+i,this.z=+l}static fromLngLat(e,i=0){const l=Z.convert(e);return new pt(ye(l.lng),Ce(l.lat),Ae(i,l.lat))}toLngLat(){return new Z(ke(this.x),Me(this.y))}toAltitude(){return Ee(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/H*mt(Me(this.y))}}function Ht(o,e,i,l,u,f,p,v,w){const E=(e+l)/2,C=(i+u)/2,z=new Mt(E,C);v(z),(function(L,N,U,X,J,Q){const le=U-J,he=X-Q;return Math.abs((X-N)*le-(U-L)*he)/Math.hypot(le,he)})(z.x,z.y,f.x,f.y,p.x,p.y)>=w?(Ht(o,e,i,E,C,f,z,v,w),Ht(o,E,C,l,u,z,p,v,w)):o.push(p)}function rt(o,e,i){let l=o[0],u=l.x,f=l.y;e(l);const p=[l];for(let v=1;v<o.length;v++){const w=o[v],{x:E,y:C}=w;e(w),Ht(p,u,f,E,C,l,w,e,i),u=E,f=C,l=w}return p}function Ue(o,e,i,l){if(l(e,i)){const u=e.add(i)._mult(.5);Ue(o,e,u,l),Ue(o,u,i,l)}else o.push(i)}function xt(o,e){let i=o[0];const l=[i];for(let u=1;u<o.length;u++){const f=o[u];Ue(l,i,f,e),i=f}return l}const ct=Math.pow(2,14)-1,Ct=-ct-1;function qt(o,e){const i=Math.round(o.x*e),l=Math.round(o.y*e);return o.x=Pe(i,Ct,ct),o.y=Pe(l,Ct,ct),(i<o.x||i>o.x+1||l<o.y||l>o.y+1)&&oi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function nn(o,e,i){const l=o.loadGeometry(),u=o.extent,f=Yt/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:v,x:w,y:E,projection:C}=i,z=L=>{const N=ke((e.x+L.x/u)/p),U=Me((e.y+L.y/u)/p),X=C.project(N,U);L.x=(X.x*v-w)*u,L.y=(X.y*v-E)*u};for(let L=0;L<l.length;L++)if(o.type!==1)l[L]=rt(l[L],z,1);else{const N=[];for(const U of l[L])U.x<0||U.x>=u||U.y<0||U.y>=u||(z(U),N.push(U));l[L]=N}}for(const p of l)for(const v of p)qt(v,f);return l}function Vt(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?nn(o):[]}}class Ot{constructor(e,i,l,u,f){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=f,e.readFields(vn,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,l=[];let u,f=1,p=0,v=0,w=0;for(;e.pos<i;){if(p<=0){const E=e.readVarint();f=7&E,p=E>>3}if(p--,f===1||f===2)v+=e.readSVarint(),w+=e.readSVarint(),f===1&&(u&&l.push(u),u=[]),u&&u.push(new Mt(v,w));else{if(f!==7)throw new Error(`unknown command ${f}`);u&&u.push(u[0].clone())}}return u&&l.push(u),l}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let l=1,u=0,f=0,p=0,v=1/0,w=-1/0,E=1/0,C=-1/0;for(;e.pos<i;){if(u<=0){const z=e.readVarint();l=7&z,u=z>>3}if(u--,l===1||l===2)f+=e.readSVarint(),p+=e.readSVarint(),f<v&&(v=f),f>w&&(w=f),p<E&&(E=p),p>C&&(C=p);else if(l!==7)throw new Error(`unknown command ${l}`)}return[v,E,w,C]}toGeoJSON(e,i,l){const u=this.extent*Math.pow(2,l),f=this.extent*e,p=this.extent*i,v=this.loadGeometry();function w(L){return[360*(L.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+p)/u)*Math.PI))-90]}function E(L){return L.map(w)}let C;if(this.type===1){const L=[];for(const U of v)L.push(U[0]);const N=E(L);C=L.length===1?{type:"Point",coordinates:N[0]}:{type:"MultiPoint",coordinates:N}}else if(this.type===2){const L=v.map(E);C=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{const L=(function(U){const X=U.length;if(X<=1)return[U];const J=[];let Q,le;for(let he=0;he<X;he++){const ge=gn(U[he]);ge!==0&&(le===void 0&&(le=ge<0),le===ge<0?(Q&&J.push(Q),Q=[U[he]]):Q&&Q.push(U[he]))}return Q&&J.push(Q),J})(v),N=[];for(const U of L)N.push(U.map(E));C=N.length===1?{type:"Polygon",coordinates:N[0]}:{type:"MultiPolygon",coordinates:N}}}const z={type:"Feature",geometry:C,properties:this.properties};return this.id!=null&&(z.id=this.id),z}}function vn(o,e,i){o===1?e.id=i.readVarint():o===2?(function(l,u){const f=l.readVarint()+l.pos;for(;l.pos<f;){const p=u._keys[l.readVarint()],v=u._values[l.readVarint()];u.properties[p]=v}})(i,e):o===3?e.type=i.readVarint():o===4&&(e._geometry=i.pos)}function gn(o){let e=0;for(let i,l,u=0,f=o.length,p=f-1;u<f;p=u++)i=o[u],l=o[p],e+=(l.x-i.x)*(i.y+l.y);return e}Ot.types=["Unknown","Point","LineString","Polygon"];class yn{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(mn,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Ot(this._pbf,i,this.extent,this._keys,this._values)}}function mn(o,e,i){o===15?e.version=i.readVarint():o===1?e.name=i.readString():o===5?e.extent=i.readVarint():o===2?e._features.push(i.pos):o===3?e._keys.push(i.readString()):o===4&&e._values.push((function(l){let u=null;const f=l.readVarint()+l.pos;for(;l.pos<f;){const p=l.readVarint()>>3;u=p===1?l.readString():p===2?l.readFloat():p===3?l.readDouble():p===4?l.readVarint64():p===5?l.readVarint():p===6?l.readSVarint():p===7?l.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(i))}class qn{constructor(e,i){this.layers=e.readFields(ii,{},i)}}function ii(o,e,i){if(o===3){const l=new yn(i,i.readVarint()+i.pos);l.length&&(e[l.name]=l)}}const ai="3d_elevation_id",Xi="level";class Jn{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,l){return this.get(e,!0,i,l)}optional(e,i,l){return this.get(e,!1,i,l)}success(){return this._valid}get(e,i,l,u){const f=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&f!==void 0&&!Number.isNaN(f)?l(u?u(f):f):i&&(this._valid=!1),this}}class Pi{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,l){return this.featureFunc(e,i,l)}parseVertex(e,i,l){return this.vertexFunc(e,i,l)}}const ji=new Pi(((o,e,i)=>o.reset(e).require(ai,(l=>{i.id=l})).optional("fixed_height_relative",(l=>{i.constantHeight=l}),ri.decodeRelativeHeight).geometry((l=>{i.bounds=l}),Pd).success()),((o,e,i)=>o.reset(e).require(ai,(l=>{i.id=l})).require("elevation_idx",(l=>{i.idx=l})).require("extent",(l=>{i.extent=l})).require("height_relative",(l=>{i.height=l}),ri.decodeRelativeHeight).geometry((l=>{i.position=l}),ri.getPoint).success())),wr=new Pi(((o,e,i)=>o.reset(e).require(ai,(l=>{i.id=l})).optional("fixed_height",(l=>{i.constantHeight=l}),ri.decodeMetricHeight).geometry((l=>{i.bounds=l}),Pd).success()),((o,e,i)=>o.reset(e).require(ai,(l=>{i.id=l})).require("elevation_idx",(l=>{i.idx=l})).require("extent",(l=>{i.extent=l})).require("height",(l=>{i.height=l}),ri.decodeMetricHeight).geometry((l=>{i.position=l}),ri.getPoint).success()));class ri{static getPoint(e){return hr(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?wr:void 0:ji}static parse(e){const i=[],l=[],u=e.length,f=new Jn;for(let p=0;p<u;p++){const v=e.feature(p),w=v.properties.version,E=ri.getVersionSchema(w);if(E===void 0){oi(`Unknown elevation feature version number ${w||"(unknown)"}`);continue}const C=v.properties.type;if(!C)continue;const z=Ot.types[v.type];if(z==="Point"&&C==="curve_point"){const L={};E.parseVertex(f,v,L)&&i.push(L)}else if(z==="Polygon"&&C==="curve_meta"){const L={};E.parseFeature(f,v,L)&&l.push(L)}}return{vertices:i,features:l}}}class Fi{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const u=ar(i,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/u;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,!0}}class Di{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const u=gt(i,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,l[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,l){if((function(N,U){var X=N[0],J=N[1],Q=N[2],le=U[0],he=U[1],ge=U[2];return Math.abs(X-le)<=I*Math.max(1,Math.abs(X),Math.abs(le))&&Math.abs(J-he)<=I*Math.max(1,Math.abs(J),Math.abs(he))&&Math.abs(Q-ge)<=I*Math.max(1,Math.abs(Q),Math.abs(ge))})(this.pos,e)||i===0)return l[0]=l[1]=l[2]=0,!1;const[u,f,p]=this.dir,v=this.pos[0]-e[0],w=this.pos[1]-e[1],E=this.pos[2]-e[2],C=u*u+f*f+p*p,z=2*(v*u+w*f+E*p),L=z*z-4*C*(v*v+w*w+E*E-i*i);if(L<0){const N=Math.max(-z/2,0),U=v+u*N,X=w+f*N,J=E+p*N,Q=Math.hypot(U,X,J);return l[0]=U*i/Q,l[1]=X*i/Q,l[2]=J*i/Q,!1}{const N=(-z-Math.sqrt(L))/(2*C);if(N<0){const U=Math.hypot(v,w,E);return l[0]=v*i/U,l[1]=w*i/U,l[2]=E*i/U,!1}return l[0]=v+u*N,l[1]=w+f*N,l[2]=E+p*N,!0}}}class Ni{constructor(e,i,l,u,f){this.TL=e,this.TR=i,this.BR=l,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,i,l){const u=[-1,1,1],f=[1,1,1],p=[1,-1,1],v=[-1,-1,1],w=Je(u,u,e),E=Je(f,f,e),C=Je(p,p,e),z=Je(v,v,e);return new Ni(w,E,C,z,i/l)}}function Ar(o,e,i){let l=1/0,u=-1/0;const f=[];for(const p of o){Jt(f,p,e);const v=gt(f,i);l=Math.min(l,v),u=Math.max(u,v)}return[l,u]}function Yr(o,e){let i=!0;for(let l=0;l<o.planes.length;l++){const u=o.planes[l];let f=0;for(let p=0;p<e.length;p++)f+=+(gt(u,e[p])+u[3]>=0);if(f===0)return 0;f!==e.length&&(i=!1)}return i?2:1}function Ro(o,e){for(const i of o.projections){const l=Ar(e,o.points[0],i.axis);if(i.projection[1]<l[0]||i.projection[0]>l[1])return 0}return 1}function Ir(o,e){let i=0;const l=[0,0,0,0];for(let p=0;p<o.length;p++)l[0]=o[p][0],l[1]=o[p][1],l[2]=o[p][2],l[3]=1,(u=l)[0]*(f=e)[0]+u[1]*f[1]+u[2]*f[2]+u[3]*f[3]>=0&&i++;var u,f;return i}class li{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Fn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Jt([],this.points[2],this.points[3]),Jt([],this.points[0],this.points[3]),Jt([],this.points[4],this.points[0]),Jt([],this.points[5],this.points[1]),Jt([],this.points[6],this.points[2]),Jt([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const u=[0,-l[2],l[1]],f=[l[2],0,-l[0]];this.projections.push({axis:u,projection:Ar(this.points,this.points[0],u)}),this.projections.push({axis:f,projection:Ar(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(e,i,l,u){const f=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((E=>{const C=ti([],E,e),z=1/C[3]/i*f;return(L=C)[0]=(N=C)[0]*(U=[z,z,u?1/C[3]:z,z])[0],L[1]=N[1]*U[1],L[2]=N[2]*U[2],L[3]=N[3]*U[3],L;var L,N,U})),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((E=>{const C=tt([],Lt([],Jt([],p[E[0]],p[E[1]]),Jt([],p[E[2]],p[E[1]]))),z=-gt(C,p[E[1]]);return C.concat(z)})),w=[];for(let E=0;E<p.length;E++)w.push([p[E][0],p[E][1],p[E][2]]);return new li(w,v)}intersectsPrecise(e,i,l){for(let u=0;u<i.length;u++)if(!Ir(e,i[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!Ir(e,this.planes[u]))return 0;for(const u of l)for(const f of this.frustumEdges){const p=Lt([],u,f),v=De(p);if(v===0)continue;Dt(p,p,1/v);const w=Ar(this.points,this.points[0],p),E=Ar(e,this.points[0],p);if(w[0]>E[1]||E[0]>w[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const l=i[3];if(gt([i[0],i[1],i[2]],e)+l<0)return!1}return!0}}class Fn{static fromPoints(e){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const u of e)ft(i,i,u),St(l,l,u);return new Fn(i,l)}static fromTileIdAndHeight(e,i,l){const u=1<<e.canonical.z,f=e.canonical.x,p=e.canonical.y;return new Fn([f/u,p/u,i],[(f+1)/u,(p+1)/u,l])}static applyTransform(e,i){const l=e.getCorners();for(let u=0;u<l.length;++u)Je(l[u],l[u],i);return Fn.fromPoints(l)}static applyTransformFast(e,i){const l=[i[12],i[13],i[14]],u=[...l];for(let f=0;f<3;f++)for(let p=0;p<3;p++){const v=i[4*p+f],w=v*e.min[p],E=v*e.max[p];l[f]+=Math.min(w,E),u[f]+=Math.max(w,E)}return new Fn(l,u)}static projectAabbCorners(e,i){const l=e.getCorners();for(let u=0;u<l.length;++u)Je(l[u],l[u],i);return l}constructor(e,i){this.min=e,this.max=i,this.center=Dt([],Ne([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=Te(this.min),u=Te(this.max);for(let f=0;f<i.length;f++)l[f]=i[f]?this.min[f]:this.center[f],u[f]=i[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Fn(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Yr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Yr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Ro(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Ro(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ln(Fn,"Aabb");class Yi{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,l=i[1],u=-i[0],f=(e.extent+1)*this.metersToTile;return[new Mt(Math.trunc(e.position[0]+l*f),Math.trunc(e.position[1]+u*f)),new Mt(Math.trunc(e.position[0]-l*f),Math.trunc(e.position[1]-u*f))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class jr{constructor(e,i,l,u,f,p){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[lr(),lr(),lr(),lr(),lr(),lr(),lr()],this.id=e,this.heightRange={min:l,max:l},this.safeArea=i,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=f,this.edges=this.edges.filter((v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((w=this.vertices[v.a].position)[0]===(E=this.vertices[v.b].position)[0]&&w[1]===E[1]);var w,E})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:hr(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const w=this.vertices[v.a].position,E=this.vertices[v.b].position,C=ho(lr(),E,w),z=us(C),L=Co(lr(),C,1/z);this.edgeProps.push({vec:C,dir:L,len:z});const N=this.vertexProps[v.a].dir,U=this.vertexProps[v.b].dir;oo(N,N,L),oo(U,U,L)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||rr(v.dir,v.dir);this.tessellate(p)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[l,u]=i;return Rn(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,u)}computeSlopeNormal(e,i){const l=this.getClosestEdge(e);if(!l)return Be(0,0,1);const u=l[0],f=this.edges[u],p=this.edgeProps[u].vec,v=Be(p[0],p[1],(this.vertices[f.b].height-this.vertices[f.a].height)*i),w=Be(v[1],-v[0],0);Lt(w,w,v);const E=De(w);return E>0?Dt(w,w,1/E):Se(w,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,l=Number.POSITIVE_INFINITY,u=0;const[f,p,v,w,E,C,z]=this._tmpVec2;uo(z,e.x,e.y);const L=new Fi(z,null);for(let N=0;N<this.edges.length;N++){const U=this.edges[N],X=this.edgeProps[N].dir;L.dir=X;const J=this.vertices[U.a].position,Q=this.vertices[U.b].position,le=L.intersectsPlane(J,this.vertexProps[U.a].dir,f),he=L.intersectsPlane(Q,this.vertexProps[U.b].dir,p);if(!le||!he)continue;ho(v,p,f),ho(w,z,f);const ge=ar(v,v),Le=ge>0?ar(w,v)/ge:0,Oe=Pe(Le,0,1),Ve=Math.abs((Le-Oe)*this.edgeProps[N].len);ho(E,z,J),uo(C,X[1],-X[0]);const We=Ve+Math.abs(ar(E,C));We<l&&(i=N,l=We,u=Oe)}return[i,u]}tessellate(e){const i=de(),l=de(),u=de(),f=de();for(let p=this.edges.length-1;p>=0;--p){const v=this.edges[p].a,w=this.edges[p].b,{position:E,height:C,extent:z}=this.vertices[v],{position:L,height:N,extent:U}=this.vertices[w],X=this.vertexProps[v].dir,J=this.vertexProps[w].dir;if(Se(i,E[0]/e,E[1]/e,C),Se(l,L[0]/e,L[1]/e,N),Se(u,X[1],-X[0],0),Dt(u,u,z),Se(f,J[1],-J[0],0),Dt(f,f,U),this.distSqLines(Be(i[0]+.5*u[0],i[1]+.5*u[1],i[2]+.5*u[2]),Be(l[0]-.5*f[0],l[1]-.5*f[1],l[2]-.5*f[2]),Be(i[0]-.5*u[0],i[1]-.5*u[1],i[2]-.5*u[2]),Be(l[0]+.5*f[0],l[1]+.5*f[1],l[2]+.5*f[2]))<=.0025000000000000005)continue;const Q=this.vertices.length,le=oo(lr(),E,L);this.vertices.push({position:Co(le,le,.5),height:.5*(C+N),extent:.5*(z+U)});const he=oo(lr(),X,J);this.vertexProps.push({dir:rr(he,he)}),this.edges.splice(p,1),this.edgeProps.splice(p,1),this.edges.push({a:v,b:Q}),this.edges.push({a:Q,b:w});const ge=ho(lr(),this.vertices[Q].position,E),Le=us(ge),Oe={vec:ge,dir:Co(lr(),ge,1/Le),len:Le};this.edgeProps.push(Oe),this.edgeProps.push(Oe)}}distSqLines(e,i,l,u){const f=it(de(),i,e),p=it(de(),u,l),v=it(de(),e,l),w=gt(f,f),E=gt(f,p),C=gt(f,v),z=gt(p,p),L=gt(p,v),N=w*z-E*E;if(N===0)return et(_t(f,l,u,gt(v,p)/gt(p,p)),e);const U=(w*L-E*C)/N;return et(_t(f,e,i,(E*L-C*z)/N),_t(p,l,u,U))}}class Dr{static parseFrom(e,i){const l=ri.parse(e);if(!l)return[];let{vertices:u,features:f}=l;const p=1/$e(i);f.sort(((C,z)=>C.id-z.id)),u.sort(((C,z)=>C.id-z.id||C.idx-z.idx)),u=u.filter(((C,z,L)=>z===L.findIndex((N=>N.id===C.id&&N.idx===C.idx))));const v=new Array;let w=0;const E=u.length;for(const C of f){if(C.constantHeight){v.push(new jr(C.id,C.bounds,C.constantHeight));continue}for(;w!==E&&u[w].id<C.id;)w++;if(w===E||u[w].id!==C.id)continue;const z=new Array,L=new Array,N=w;for(;w!==E&&u[w].id===C.id;){const U=u[w];if(z.push({position:U.position,height:U.height,extent:U.extent}),w!==N&&u[w-1].idx===U.idx-1){const X=w-N;L.push({a:X-1,b:X})}w++}v.push(new jr(C.id,C.bounds,void 0,z,L,p))}return v}static getElevationFeature(e,i){if(!i)return;const l=+e.properties[ai];return Number.isNaN(l)?void 0:i.find((u=>u.id===l))}}class lo{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Yt,this.yOffset=(e.y*this.zScale-i.y)*Yt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,l){const u=this.constantElevation(i,l);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),l))}computeBiasedHeight(e,i){return i<=0?e:e+i*nt(0,i,e>=0?e:Math.abs(.5*e))}}ln(jr,"ElevationFeature");class Bo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Vl,this.indexArray=new Eo,this.segments=new Fr,this.programConfigurations=new wa(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ul),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,u){const f=this.layers[0],p=[];let v=null;f.type==="circle"&&(v=f.layout.get("circle-sort-key"));for(const{feature:E,id:C,index:z,sourceLayerIndex:L}of e){const N=this.layers[0]._featureFilter.needGeometry,U=Vt(E,N);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom,{worldview:this.worldview}),U,l))continue;const X=v?v.evaluate(U,{},l):void 0,J={id:C,properties:E.properties,type:E.type,sourceLayerIndex:L,index:z,geometry:N?U.geometry:nn(E,l,u),patterns:{},sortKey:X};p.push(J)}v&&p.sort(((E,C)=>E.sortKey-C.sortKey));let w=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new gf,w=u.projection);for(const E of p){const{geometry:C,index:z,sourceLayerIndex:L}=E,N=e[z].feature;this.addFeature(E,C,z,i.availableImages,l,w,i.brightness,i.elevationFeatures),i.featureIndex.insert(N,C,z,L,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,l,u,f,p,v){this.programConfigurations.updatePaintArrays(e,i,f,l,u,p,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Kx.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Yx.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,l,u,f,p,v,w){let E;this.elevationMode!=="none"&&(E=Dr.getElevationFeature(e,w));for(const C of i)for(const z of C){const L=z.x,N=z.y;if(L<0||L>=Yt||N<0||N>=Yt)continue;if(p){const J=p.projectTilePoint(L,N,f),Q=p.upVector(f,L,N);this.addGlobeExtVertex(J,Q),this.addGlobeExtVertex(J,Q),this.addGlobeExtVertex(J,Q),this.addGlobeExtVertex(J,Q)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),X=U.vertexLength;if(this.addCircleVertex(L,N,-1,-1),this.addCircleVertex(L,N,1,-1),this.addCircleVertex(L,N,1,1),this.addCircleVertex(L,N,-1,1),this.elevationMode!=="none"){const J=E?E.pointElevation(new Mt(L,N)):0;this.hasElevation=this.hasElevation||J!==0;for(let Q=0;Q<4;Q++)this.elevatedLayoutVertexArray.emplaceBack(J)}this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+2,X+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,f,v,void 0,this.worldview)}addCircleVertex(e,i,l,u){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*i+(u+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function qs(o,e){for(let i=0;i<o.length;i++)if(zo(e,o[i]))return!0;for(let i=0;i<e.length;i++)if(zo(o,e[i]))return!0;return!!ms(o,e)}function Hs(o,e,i){return!!zo(o,e)||!!Kr(e,o,i)}function Ms(o,e){if(o.length===1)return xo(e,o[0]);for(let i=0;i<e.length;i++){const l=e[i];for(let u=0;u<l.length;u++)if(zo(o,l[u]))return!0}for(let i=0;i<o.length;i++)if(xo(e,o[i]))return!0;for(let i=0;i<e.length;i++)if(ms(o,e[i]))return!0;return!1}function Cs(o,e,i){if(o.length>1){if(ms(o,e))return!0;for(let l=0;l<e.length;l++)if(Kr(e[l],o,i))return!0}for(let l=0;l<o.length;l++)if(Kr(o[l],e,i))return!0;return!1}function ms(o,e){if(o.length===0||e.length===0)return!1;for(let i=0;i<o.length-1;i++){const l=o[i],u=o[i+1];for(let f=0;f<e.length-1;f++)if(sa(l,u,e[f],e[f+1]))return!0}return!1}function sa(o,e,i,l){return Ui(o,i,l)!==Ui(e,i,l)&&Ui(o,e,i)!==Ui(o,e,l)}function Ta(o,e,i){return(o.x-i.x)*(e.y-i.y)-(o.y-i.y)*(e.x-i.x)}function Hr(o,e,i,l){const u=Ta(o,e,l),f=Ta(o,e,i);if(Math.sign(u)===Math.sign(f))return;const p=Ta(i,l,o),v=p+f-u;return Math.sign(p)!==Math.sign(v)?[p/(p-v),f/(f-u)]:void 0}function Kr(o,e,i){const l=i*i;if(e.length===1)return o.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(Lr(o,e[u-1],e[u])<l)return!0;return!1}function Lr(o,e,i){const l=e.distSqr(i);if(l===0)return o.distSqr(e);const u=((o.x-e.x)*(i.x-e.x)+(o.y-e.y)*(i.y-e.y))/l;return o.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function xo(o,e){let i,l,u,f=!1;for(let p=0;p<o.length;p++){i=o[p];for(let v=0,w=i.length-1;v<i.length;w=v++)l=i[v],u=i[w],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(f=!f)}return f}function zo(o,e){let i=!1;for(let l=0,u=o.length-1;l<o.length;u=l++){const f=o[l],p=o[u];f.y>e.y!=p.y>e.y&&e.x<(p.x-f.x)*(e.y-f.y)/(p.y-f.y)+f.x&&(i=!i)}return i}function io(o,e,i,l,u){for(const p of o)if(e<=p.x&&i<=p.y&&l>=p.x&&u>=p.y)return!0;const f=[new Mt(e,i),new Mt(e,u),new Mt(l,u),new Mt(l,i)];if(o.length>2){for(const p of f)if(zo(o,p))return!0}for(let p=0;p<o.length-1;p++)if(Ko(o[p],o[p+1],f))return!0;return!1}function Ko(o,e,i){const l=i[0],u=i[2];if(o.x<l.x&&e.x<l.x||o.x>u.x&&e.x>u.x||o.y<l.y&&e.y<l.y||o.y>u.y&&e.y>u.y)return!1;const f=Ui(o,e,i[0]);return f!==Ui(o,e,i[1])||f!==Ui(o,e,i[2])||f!==Ui(o,e,i[3])}function Oa(o,e,i,l,u,f){let p=e.y-o.y,v=o.x-e.x;if(f=f||0){const w=p*p+v*v;if(w===0)return!0;const E=Math.sqrt(w);p/=E,v/=E}return!((i.x-o.x)*p+(i.y-o.y)*v-f<0||(l.x-o.x)*p+(l.y-o.y)*v-f<0||(u.x-o.x)*p+(u.y-o.y)*v-f<0)}function nl(o,e,i,l,u,f,p){return!(Oa(o,e,l,u,f,p)||Oa(e,i,l,u,f,p)||Oa(i,o,l,u,f,p)||Oa(l,u,o,e,i,p)||Oa(u,f,o,e,i,p)||Oa(f,l,o,e,i,p))}function Sa(o,e,i){const l=e.paint.get(o).value;return l.kind==="constant"?l.value:i.programConfigurations.get(e.id).getMaxValue(o)}function Wl(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function ql(o,e,i,l,u){if(!e[0]&&!e[1])return o;const f=Mt.convert(e)._mult(u);i==="viewport"&&f._rotate(-l);const p=[];for(let v=0;v<o.length;v++)p.push(o[v].sub(f));return p}function Fa(o,e,i,l){const u=Mt.convert(o)._mult(l);return e==="viewport"&&u._rotate(-i),u}let ku,il;function Ba(o,e,i){var l=2*Math.PI*6378137/256/Math.pow(2,i);return[o*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}ln(Bo,"CircleBucket",{omit:["layers"]});class rl{constructor(e,i,l){this.z=e,this.x=i,this.y=l,this.key=Af(0,e,e,i,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const l=(function(f,p,v){var w=Ba(256*f,256*(p=Math.pow(2,v)-p-1),v),E=Ba(256*(f+1),256*(p+1),v);return w[0]+","+w[1]+","+E[0]+","+E[1]})(this.x,this.y,this.z),u=(function(f,p,v){let w,E="";for(let C=f;C>0;C--)w=1<<C-1,E+=(p&w?1:0)+(v&w?2:0);return E})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ef{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Af(e,i.z,i.z,i.x,i.y)}}class gs{constructor(e,i,l,u,f){this.overscaledZ=e,this.wrap=i,this.canonical=new rl(l,+u,+f),this.key=i===0&&e===l?this.canonical.key:Af(i,e,l,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new gs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gs(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Af(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Af(this.wrap*+i,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new gs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new gs(i,this.wrap,i,l,u),new gs(i,this.wrap,i,l+1,u),new gs(i,this.wrap,i,l,u+1),new gs(i,this.wrap,i,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new gs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new gs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ef(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Af(o,e,i,l,u){const f=1<<Math.min(i,22);let p=f*(u%f)+l%f;return o&&i<22&&(p+=f*f*((o<0?-2*o-1:2*o)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}const mL=[o=>{let e=o.canonical.x-1,i=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,i--),new gs(o.overscaledZ,i,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,i=o.wrap;return e===1<<o.canonical.z&&(e=0,i++),new gs(o.overscaledZ,i,o.canonical.z,e,o.canonical.y)},o=>new gs(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new gs(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];ln(rl,"CanonicalTileID"),ln(gs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const gL=xi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ey}=gL,_L=xi([{name:"a_pos_3",components:3,type:"Int16"}]);var yS=xi([{name:"a_pos",type:"Int16",components:2}]);function Ay(o){return o*h/q}const yL=[new Fn([D,D,D],[O,O,O]),new Fn([D,D,D],[0,0,O]),new Fn([0,D,D],[O,0,O]),new Fn([D,0,D],[0,O,O]),new Fn([0,0,D],[O,O,O])];function vS(o,e,i,l=!0){const u=Dt([],o._camera.position,o.worldSize),f=[e,i,1,1];ti(f,f,o.pixelMatrixInverse),Gn(f,f,1/f[3]);const p=tt([],Jt([],f,u)),v=o.globeMatrix,w=[v[12],v[13],v[14]],E=Jt([],w,u),C=De(E),z=tt([],E),L=o.worldSize/(2*Math.PI),N=gt(z,p),U=Math.asin(L/C);if(U<Math.acos(N)){if(!l)return null;const Tt=[],Ke=[];Dt(Tt,p,C/N),tt(Ke,Jt(Ke,Tt,E)),tt(p,Ne(p,E,Dt(p,Ke,Math.tan(U)*C)))}const X=[];new Di(u,p).closestPointOnSphere(w,L,X);const J=tt([],zr(v,0)),Q=tt([],zr(v,1)),le=tt([],zr(v,2)),he=gt(J,X),ge=gt(Q,X),Le=gt(le,X),Oe=ee(Math.asin(-ge/L));let Ve=ee(Math.atan2(he,Le));Ve=o.center.lng+(function(Tt,Ke){const Et=(Ke-Tt+180)%360-180;return Et<-180?Et+360:Et})(o.center.lng,Ve);const We=ye(Ve),He=Pe(Ce(Oe),0,1);return new pt(We,He)}class vL{constructor(e,i,l){this.a=Jt([],e,l),this.b=Jt([],i,l),this.center=l;const u=tt([],this.a),f=tt([],this.b);this.angle=Math.acos(gt(u,f))}}function n1(o,e){if(o.angle===0)return null;let i;return i=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),i<0||i>1?null:(function(l,u,f,p){const v=Math.sin(f);return l*(Math.sin((1-p)*f)/v)+u*(Math.sin(p*f)/v)})(o.a[e],o.b[e],o.angle,Pe(i,0,1))+o.center[e]}function Hl(o){if(o.z<=1)return yL[o.z+2*o.y+o.x];const e=i1(Iy(o));return Fn.fromPoints(e)}function Rc(o,e,i){return Dt(o,o,1-i),Kt(o,o,e,i)}function xS(o,e,i){for(const l of o)Je(l,l,e),Dt(l,l,i)}function bS(o,e,i,l){const u=e/o.worldSize,f=o.globeMatrix;if(i.z<=1){const He=Hl(i).getCorners();return xS(He,f,u),Fn.fromPoints(He)}const p=Iy(i,l),v=i1(p,h+Ay(o._tileCoverLift));xS(v,f,u);const w=Number.MAX_VALUE,E=[-w,-w,-w],C=[w,w,w];if(p.contains(o.center)){for(const Ke of v)ft(C,C,Ke),St(E,E,Ke);E[2]=0;const He=o.point,Tt=[He.x*u,He.y*u,0];return ft(C,C,Tt),St(E,E,Tt),new Fn(C,E)}if(o._tileCoverLift>0){for(const He of v)ft(C,C,He),St(E,E,He);return new Fn(C,E)}const z=[f[12]*u,f[13]*u,f[14]*u],L=p.getCenter(),N=Pe(o.center.lat,-ze,ze),U=Pe(L.lat,-ze,ze),X=ye(o.center.lng),J=Ce(N);let Q=X-ye(L.lng);const le=J-Ce(U);Q>.5?Q-=1:Q<-.5&&(Q+=1);let he=0;Math.abs(Q)>Math.abs(le)?he=Q>=0?1:3:(he=le>=0?0:2,Kt(z,z,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(Xe(le>=0?p.getSouth():p.getNorth()))*h));const ge=v[he],Le=v[(he+1)%4],Oe=new vL(ge,Le,z),Ve=[n1(Oe,0)||ge[0],n1(Oe,1)||ge[1],n1(Oe,2)||ge[2]],We=Ru(o.zoom);if(We>0){const He=(function({x:Ke,y:Et,z:Ft},It,Pt,Ut,bt){const kt=1/(1<<Ft);let dt=Ke*kt,lt=dt+kt,jt=Et*kt,Nt=jt+kt,wn=0;const sn=(dt+lt)/2-Ut;return sn>.5?wn=-1:sn<-.5&&(wn=1),dt=((dt+wn)*It-(Ut*=It))*Pt+Ut,lt=((lt+wn)*It-Ut)*Pt+Ut,jt=(jt*It-(bt*=It))*Pt+bt,Nt=(Nt*It-bt)*Pt+bt,[[dt,Nt,0],[lt,Nt,0],[lt,jt,0],[dt,jt,0]]})(i,e,o._pixelsPerMercatorPixel,X,J);for(let Ke=0;Ke<v.length;Ke++)Rc(v[Ke],He[Ke],We);const Tt=Ne([],He[he],He[(he+1)%4]);Dt(Tt,Tt,.5),Rc(Ve,Tt,We)}for(const He of v)ft(C,C,He),St(E,E,He);return C[2]=Math.min(ge[2],Le[2]),ft(C,C,Ve),St(E,E,Ve),new Fn(C,E)}function Iy({x:o,y:e,z:i},l=!1){const u=1/(1<<i),f=new Z(ke(o*u),e===(1<<i)-1&&l?-90:Me((e+1)*u)),p=new Z(ke((o+1)*u),e===0&&l?90:Me(e*u));return new re(f,p)}function i1(o,e=h){const i=Xe(o.getNorth()),l=Xe(o.getSouth()),u=Math.cos(i),f=Math.cos(l),p=Math.sin(i),v=Math.sin(l),w=o.getWest(),E=o.getEast();return[j(f,v,w,e),j(f,v,E,e),j(u,p,E,e),j(u,p,w,e)]}function Nm(o,e,i,l){const u=1<<i.z,f=(o/Yt+i.x)/u;return B(Me((e/Yt+i.y)/u),ke(f),l)}function My({min:o,max:e}){return b/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const wS=new Float64Array(16);function Cy(o){const e=My(o),i=_e(wS,[e,e,e]);return ne(i,i,st([],o.min))}function r1(o){const e=(l=o.min,(i=wS)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=l[0],i[13]=l[1],i[14]=l[2],i[15]=1,i);var i,l;const u=1/My(o);return oe(e,e,[u,u,u])}function o1(o){const e=Yt/(2*Math.PI);return o/(2*Math.PI)/e}function TS(o,e){return Yt/(512*Math.pow(2,o))*My(Hl(e))}function SS(o,e,i,l,u){const f=o1(i),p=[o,e,-i/(2*Math.PI)],v=G(new Float64Array(16));return ne(v,v,p),oe(v,v,[f,f,f]),ce(v,v,Xe(-u)),me(v,v,Xe(-l)),v}function Ru(o){return nt(g,y,o)}function ES(o,e){const i=B(e.lat,e.lng),l=(function(U){const X=B(U._center.lat,U._center.lng);let J=Lt([],Be(0,1,0),X);const Q=te([],-U.angle,X);J=Je(J,J,Q),te(Q,-U._pitch,J);const le=tt([],X);return Dt(le,le,Ay(U.cameraToCenterDistance/U.pixelsPerMeter)),Je(le,le,Q),Ne([],X,le)})(o);return p=(u=it([],l,i))[0],v=u[1],w=u[2],E=(f=i)[0],C=f[1],z=f[2],N=(L=Math.sqrt((p*p+v*v+w*w)*(E*E+C*C+z*z)))&&gt(u,f)/L,Math.acos(Math.min(Math.max(N,-1),1));var u,f,p,v,w,E,C,z,L,N}function s1(o,e){return ES(o,e)>Math.PI/2*1.01}const AS=Xe(85),xL=Math.cos(AS),bL=Math.sin(AS),wL=W(),IS=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function MS(o,e,i,l,u,f,p,v,w){if(f&&o.queryGeometry.isAboveHorizon)return!1;f&&(w*=o.pixelToTileUnitsFactor);const E=o.tileID.canonical,C=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const z of e)for(const L of z){const N=L.add(v),U=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(N.x,N.y,!0):0,X=i.projection.projectTilePoint(N.x,N.y,E);if(U>0){const he=i.projection.upVector(E,N.x,N.y);X.x+=he[0]*C*U,X.y+=he[1]*C*U,X.z+=he[2]*C*U}const J=f?N:TL(X.x,X.y,X.z,l),Q=f?o.tilespaceRays.map((he=>EL(he,U))):o.queryGeometry.screenGeometry,le=ti([],[X.x,X.y,X.z,1],l);if(!p&&f?w*=le[3]/i.cameraToCenterDistance:p&&!f&&(w*=i.cameraToCenterDistance/le[3]),f){const he=Me((L.y/Yt+E.y)/(1<<E.z));w/=i.projection.pixelsPerMeter(he,1)/Ae(1,he)}if(Hs(Q,J,w))return!0}return!1}function TL(o,e,i,l){const u=ti([],[o,e,i,1],l);return new Mt(u[0]/u[3],u[1]/u[3])}const CS=Be(0,0,0),SL=Be(0,0,1);function EL(o,e){const i=de();return CS[2]=e,o.intersectsPlane(CS,SL,i),new Mt(i[0],i[1])}class PS extends Bo{}let kS,RS,zS,DS;function LS(o,{width:e,height:i},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*l);return o.width=e,o.height=i,o.data=u,o}function OS(o,e,i){const{width:l,height:u}=e;l===o.width&&u===o.height||(a1(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,l),height:Math.min(o.height,u)},i,null),o.width=l,o.height=u,o.data=e.data)}function a1(o,e,i,l,u,f,p,v){if(u.width===0||u.height===0)return e;if(u.width>o.width||u.height>o.height||i.x>o.width-u.width||i.y>o.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const w=o.data,E=e.data,C=f===4&&v;for(let z=0;z<u.height;z++){const L=((i.y+z)*o.width+i.x)*f,N=((l.y+z)*e.width+l.x)*f;if(C)for(let U=0;U<u.width;U++){const X=L+U*f+3,J=N+U*f;E[J+0]=255,E[J+1]=255,E[J+2]=255,E[J+3]=w[X]}else if(p)for(let U=0;U<u.width;U++){const X=L+U*f,J=N+U*f,Q=new Hi(w[X+0]/255,w[X+1]/255,w[X+2]/255,w[X+3]).toNonPremultipliedRenderColor(p).toArray();E[J+0]=Q[0],E[J+1]=Q[1],E[J+2]=Q[2],E[J+3]=Q[3]}else for(let U=0;U<u.width*f;U++)E[N+U]=w[L+U]}return e}ln(PS,"HeatmapBucket",{omit:["layers"]});class zu{constructor(e,i){LS(this,e,1,i)}resize(e){OS(this,new zu(e),1)}clone(){return new zu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,u,f){a1(e,i,l,u,f,1,null)}}class Jo{constructor(e,i){LS(this,e,4,i)}resize(e){OS(this,new Jo(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Jo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,u,f,p,v){a1(e,i,l,u,f,4,p,v)}}class FS{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Vm(o){const e={},i=o.resolution||256,l=o.clips?o.clips.length:1,u=o.image||new Jo({width:i,height:l}),f=(p,v,w)=>{e[o.evaluationKey]=w;const E=o.expression.evaluate(e),C=E?E.toNonPremultipliedRenderColor(null):null;C&&(u.data[p+v+0]=Math.floor(255*C.r),u.data[p+v+1]=Math.floor(255*C.g),u.data[p+v+2]=Math.floor(255*C.b),u.data[p+v+3]=Math.floor(255*C.a))};if(o.clips)for(let p=0,v=0;p<l;++p,v+=4*i)for(let w=0,E=0;w<i;w++,E+=4){const C=w/(i-1),{start:z,end:L}=o.clips[p];f(v,E,z*(1-C)+L*C)}else for(let p=0,v=0;p<i;p++,v+=4)f(0,v,p/(i-1));return u}ln(zu,"AlphaImage"),ln(Jo,"RGBAImage");const AL=xi([{name:"a_pos",components:2,type:"Int16"}],4),IL=xi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),ML=xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),CL=xi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function If(o,e,i=2){const l=e&&e.length,u=l?e[0]*i:o.length;let f=BS(o,0,u,i,!0);const p=[];if(!f||f.next===f.prev)return p;let v,w,E;if(l&&(f=(function(C,z,L,N){const U=[];for(let X=0,J=z.length;X<J;X++){const Q=BS(C,z[X]*N,X<J-1?z[X+1]*N:C.length,N,!1);Q===Q.next&&(Q.steiner=!0),U.push(FL(Q))}U.sort(DL);for(let X=0;X<U.length;X++)L=LL(U[X],L);return L})(o,e,f,i)),o.length>80*i){v=o[0],w=o[1];let C=v,z=w;for(let L=i;L<u;L+=i){const N=o[L],U=o[L+1];N<v&&(v=N),U<w&&(w=U),N>C&&(C=N),U>z&&(z=U)}E=Math.max(C-v,z-w),E=E!==0?32767/E:0}return Um(f,p,i,v,w,E,0),p}function BS(o,e,i,l,u){let f;if(u===(function(p,v,w,E){let C=0;for(let z=v,L=w-E;z<w;z+=E)C+=(p[L]-p[z])*(p[z+1]+p[L+1]),L=z;return C})(o,e,i,l)>0)for(let p=e;p<i;p+=l)f=jS(p/l|0,o[p],o[p+1],f);else for(let p=i-l;p>=e;p-=l)f=jS(p/l|0,o[p],o[p+1],f);return f&&Mf(f,f.next)&&(Wm(f),f=f.next),f}function Nh(o,e){if(!o)return o;e||(e=o);let i,l=o;do if(i=!1,l.steiner||!Mf(l,l.next)&&Lo(l.prev,l,l.next)!==0)l=l.next;else{if(Wm(l),l=e=l.prev,l===l.next)break;i=!0}while(i||l!==e);return e}function Um(o,e,i,l,u,f,p){if(!o)return;!p&&f&&(function(w,E,C,z){let L=w;do L.z===0&&(L.z=l1(L.x,L.y,E,C,z)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==w);L.prevZ.nextZ=null,L.prevZ=null,(function(N){let U,X=1;do{let J,Q=N;N=null;let le=null;for(U=0;Q;){U++;let he=Q,ge=0;for(let Oe=0;Oe<X&&(ge++,he=he.nextZ,he);Oe++);let Le=X;for(;ge>0||Le>0&&he;)ge!==0&&(Le===0||!he||Q.z<=he.z)?(J=Q,Q=Q.nextZ,ge--):(J=he,he=he.nextZ,Le--),le?le.nextZ=J:N=J,J.prevZ=le,le=J;Q=he}le.nextZ=null,X*=2}while(U>1)})(L)})(o,l,u,f);let v=o;for(;o.prev!==o.next;){const w=o.prev,E=o.next;if(f?kL(o,l,u,f):PL(o))e.push(w.i,o.i,E.i),Wm(o),o=E.next,v=E.next;else if((o=E)===v){p?p===1?Um(o=RL(Nh(o),e),e,i,l,u,f,2):p===2&&zL(o,e,i,l,u,f):Um(Nh(o),e,i,l,u,f,1);break}}}function PL(o){const e=o.prev,i=o,l=o.next;if(Lo(e,i,l)>=0)return!1;const u=e.x,f=i.x,p=l.x,v=e.y,w=i.y,E=l.y,C=Math.min(u,f,p),z=Math.min(v,w,E),L=Math.max(u,f,p),N=Math.max(v,w,E);let U=l.next;for(;U!==e;){if(U.x>=C&&U.x<=L&&U.y>=z&&U.y<=N&&jm(u,v,f,w,p,E,U.x,U.y)&&Lo(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function kL(o,e,i,l){const u=o.prev,f=o,p=o.next;if(Lo(u,f,p)>=0)return!1;const v=u.x,w=f.x,E=p.x,C=u.y,z=f.y,L=p.y,N=Math.min(v,w,E),U=Math.min(C,z,L),X=Math.max(v,w,E),J=Math.max(C,z,L),Q=l1(N,U,e,i,l),le=l1(X,J,e,i,l);let he=o.prevZ,ge=o.nextZ;for(;he&&he.z>=Q&&ge&&ge.z<=le;){if(he.x>=N&&he.x<=X&&he.y>=U&&he.y<=J&&he!==u&&he!==p&&jm(v,C,w,z,E,L,he.x,he.y)&&Lo(he.prev,he,he.next)>=0||(he=he.prevZ,ge.x>=N&&ge.x<=X&&ge.y>=U&&ge.y<=J&&ge!==u&&ge!==p&&jm(v,C,w,z,E,L,ge.x,ge.y)&&Lo(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;he&&he.z>=Q;){if(he.x>=N&&he.x<=X&&he.y>=U&&he.y<=J&&he!==u&&he!==p&&jm(v,C,w,z,E,L,he.x,he.y)&&Lo(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;ge&&ge.z<=le;){if(ge.x>=N&&ge.x<=X&&ge.y>=U&&ge.y<=J&&ge!==u&&ge!==p&&jm(v,C,w,z,E,L,ge.x,ge.y)&&Lo(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function RL(o,e){let i=o;do{const l=i.prev,u=i.next.next;!Mf(l,u)&&VS(l,i,i.next,u)&&Gm(l,u)&&Gm(u,l)&&(e.push(l.i,i.i,u.i),Wm(i),Wm(i.next),i=o=u),i=i.next}while(i!==o);return Nh(i)}function zL(o,e,i,l,u,f){let p=o;do{let v=p.next.next;for(;v!==p.prev;){if(p.i!==v.i&&BL(p,v)){let w=US(p,v);return p=Nh(p,p.next),w=Nh(w,w.next),Um(p,e,i,l,u,f,0),void Um(w,e,i,l,u,f,0)}v=v.next}p=p.next}while(p!==o)}function DL(o,e){let i=o.x-e.x;return i===0&&(i=o.y-e.y,i===0)&&(i=(o.next.y-o.y)/(o.next.x-o.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function LL(o,e){const i=(function(u,f){let p=f;const v=u.x,w=u.y;let E,C=-1/0;if(Mf(u,p))return p;do{if(Mf(u,p.next))return p.next;if(w<=p.y&&w>=p.next.y&&p.next.y!==p.y){const X=p.x+(w-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(X<=v&&X>C&&(C=X,E=p.x<p.next.x?p:p.next,X===v))return E}p=p.next}while(p!==f);if(!E)return null;const z=E,L=E.x,N=E.y;let U=1/0;p=E;do{if(v>=p.x&&p.x>=L&&v!==p.x&&NS(w<N?v:C,w,L,N,w<N?C:v,w,p.x,p.y)){const X=Math.abs(w-p.y)/(v-p.x);Gm(p,u)&&(X<U||X===U&&(p.x>E.x||p.x===E.x&&OL(E,p)))&&(E=p,U=X)}p=p.next}while(p!==z);return E})(o,e);if(!i)return e;const l=US(i,o);return Nh(l,l.next),Nh(i,i.next)}function OL(o,e){return Lo(o.prev,o,e.prev)<0&&Lo(e.next,o,o.next)<0}function l1(o,e,i,l,u){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-i)*u|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function FL(o){let e=o,i=o;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==o);return i}function NS(o,e,i,l,u,f,p,v){return(u-p)*(e-v)>=(o-p)*(f-v)&&(o-p)*(l-v)>=(i-p)*(e-v)&&(i-p)*(f-v)>=(u-p)*(l-v)}function jm(o,e,i,l,u,f,p,v){return!(o===p&&e===v)&&NS(o,e,i,l,u,f,p,v)}function BL(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!(function(i,l){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==l.i&&u.next.i!==l.i&&VS(u,u.next,i,l))return!0;u=u.next}while(u!==i);return!1})(o,e)&&(Gm(o,e)&&Gm(e,o)&&(function(i,l){let u=i,f=!1;const p=(i.x+l.x)/2,v=(i.y+l.y)/2;do u.y>v!=u.next.y>v&&u.next.y!==u.y&&p<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==i);return f})(o,e)&&(Lo(o.prev,o,e.prev)||Lo(o,e.prev,e))||Mf(o,e)&&Lo(o.prev,o,o.next)>0&&Lo(e.prev,e,e.next)>0)}function Lo(o,e,i){return(e.y-o.y)*(i.x-e.x)-(e.x-o.x)*(i.y-e.y)}function Mf(o,e){return o.x===e.x&&o.y===e.y}function VS(o,e,i,l){const u=ky(Lo(o,e,i)),f=ky(Lo(o,e,l)),p=ky(Lo(i,l,o)),v=ky(Lo(i,l,e));return u!==f&&p!==v||!(u!==0||!Py(o,i,e))||!(f!==0||!Py(o,l,e))||!(p!==0||!Py(i,o,l))||!(v!==0||!Py(i,e,l))}function Py(o,e,i){return e.x<=Math.max(o.x,i.x)&&e.x>=Math.min(o.x,i.x)&&e.y<=Math.max(o.y,i.y)&&e.y>=Math.min(o.y,i.y)}function ky(o){return o>0?1:o<0?-1:0}function Gm(o,e){return Lo(o.prev,o,o.next)<0?Lo(o,e,o.next)>=0&&Lo(o,o.prev,e)>=0:Lo(o,e,o.prev)<0||Lo(o,o.next,e)<0}function US(o,e){const i=c1(o.i,o.x,o.y),l=c1(e.i,e.x,e.y),u=o.next,f=e.prev;return o.next=e,e.prev=o,i.next=u,u.prev=i,l.next=i,i.prev=l,f.next=l,l.prev=f,l}function jS(o,e,i,l){const u=c1(o,e,i);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function Wm(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function c1(o,e,i){return{i:o,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function qm(o,e){const i=o.length;if(i<=1)return[o];const l=[];let u,f;for(let p=0;p<i;p++){const v=Er(o[p]);v!==0&&(o[p].area=Math.abs(v),f===void 0&&(f=v<0),f===v<0?(u&&l.push(u),u=[o[p]]):u.push(o[p]))}if(u&&l.push(u),e>1)for(let p=0;p<l.length;p++)l[p].length<=e||(z_(l[p],e,1,l[p].length-1,NL),l[p]=l[p].slice(0,e));return l}function NL(o,e){return e.area-o.area}function GS(o,e,i=1){if(!o)return null;const l=typeof o=="string"?ws.from(o).getPrimary():o.getPrimary(),u=typeof o=="string"?null:o.getSecondary();for(const f of[l,u]){if(!f)continue;const p=f.id.toString();e.has(p)||e.set(p,[]),f.scaleSelf(i),e.get(p).push(f)}return{primary:l.toString(),secondary:u?u.toString():null}}function u1(o,e,i,l){const u=l.patternDependencies;let f=!1;for(const p of e){const v=p.paint.get(`${o}-pattern`);v.isConstant()||(f=!0),GS(v.constantOr(null),u,i)&&(f=!0)}return f}function h1(o,e,i,l,u,f){const p=f.patternDependencies;for(const v of e){const w=v.paint.get(`${o}-pattern`).value;if(w.kind!=="constant"){let E=w.evaluate({zoom:l},i,{},f.availableImages);E=E&&E.name?E.name:E;const C=GS(E,p,u);if(!C)continue;const{primary:z,secondary:L}=C;z&&(i.patterns[v.id]=[z,L].filter(Boolean))}}return i}class WS{constructor(){this.polygons=new Map}add(e,...i){const l=this.polygons.get(e);l?l.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,l]of e.polygons)this.add(i,...l)}}class zc{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=Yt&&i>=Yt}static evaluate(e){if(e.length===0)return new zc;let i=[];for(const w of e)i.push(...w.portals);if(i.length===0)return new zc;for(const w of i){const E=w.va,C=w.vb;(zc.isOnBorder(E.x,C.x)||zc.isOnBorder(E.y,C.y))&&(w.type="border")}const l=i.filter((w=>w.type!=="unevaluated")),u=i.filter((w=>w.type==="unevaluated"));if(u.length===0)return new zc;u.sort(((w,E)=>w.hash===E.hash?w.isTunnel===E.isTunnel?0:w.isTunnel?-1:1:w.hash<E.hash?1:-1)),i=l.concat(u);let f=l.length,p=f,v=f;do if(p++,p===i.length||i[f].hash!==i[p].hash){if(p-f==2){v<f&&(i[v]=i[f],i[f]=null);const w=i[v],E=i[p-1];w.type=w.isTunnel!==E.isTunnel?"tunnel":"polygon",w.connection={a:w.connection.a,b:E.connection.a},v++}f=p}while(f!==i.length);return i.splice(v),i.sort(((w,E)=>w.hash<E.hash?1:-1)),{portals:i}}}ln(zc,"ElevationPortalGraph"),ln(WS,"ElevationPolygons");class VL{constructor(e,i,l){this.outPositions=e,this.outNormals=i,this.outIndices=l,this.vertexLookup=new Map}addVertex(e,i,l){let u=e[2];l!=null&&(u*=l);const f=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,p=this.vertexLookup.get(f);if(p!=null)return p;const v=this.outPositions.length;this.vertexLookup.set(f,v);const w=Math.trunc(16384*i[0]),E=Math.trunc(16384*i[1]),C=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(w,E,C),v}addTriangle(e,i,l){this.outIndices.emplaceBack(e,i,l)}addTriangles(e,i,l){if(e.length===0)return;const u=l.length===1,f=de(),p=de();for(let v=0;v<e.length;v+=3){const w=i[e[v+0]],E=i[e[v+1]],C=i[e[v+2]],z=u?l[0]:l[e[v+1]],L=u?l[0]:l[e[v+2]];Se(f,w.x,w.y,u?l[0]:l[e[v+0]]);const N=this.addVertex(f,p);Se(f,E.x,E.y,z);const U=this.addVertex(f,p);Se(f,C.x,C.y,L);const X=this.addVertex(f,p);this.outIndices.emplaceBack(N,U,X)}}addQuad(e,i,l,u,f,p){const v=this.addVertex(e,f,p),w=this.addVertex(i,f,p),E=this.addVertex(l,f,p),C=this.addVertex(u,f,p);this.addTriangle(v,w,E),this.addTriangle(E,C,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Zs{constructor(e,i,l,u){this.unevaluatedPortals=new zc,this.portalPolygons=new WS,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Am,this.vertexNormals=new pf,this.indexArray=new Eo,this.tileToMeters=$e(e),this.bridgeProgramConfigurations=new wa(i,{zoom:l,lut:u},(f=>f!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new wa(i,{zoom:l,lut:u},(f=>f!=="fill-bridge-guard-rail-color"))}addVertices(e,i){const l=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(i[u]);return l}addTriangles(e,i,l){const u=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const f of e)u.push(f+i)}addRenderableRing(e,i,l,u,f,p){const v=[new Mt(f.min.x,f.min.y),new Mt(f.max.x,f.min.y),new Mt(f.max.x,f.max.y),new Mt(f.min.x,f.max.y)];for(let w=0;w<l-1;w++){const E=i+w,C=E+1,z=this.unevalVertices[E],L=this.unevalVertices[C];if(!(z.x>=f.min.x&&z.x<=f.max.x&&z.y>=f.min.y&&z.y<=f.max.y||L.x>=f.min.x&&L.x<=f.max.x&&L.y>=f.min.y&&L.y<=f.max.y||Ko(z,L,v))||this.isOnBorder(z.x,L.x)||this.isOnBorder(z.y,L.y))continue;const N=Zs.computeEdgeHash(this.unevalVertices[E],this.unevalVertices[C]);let U,X=this.vertexHashLookup.get(Zs.computePosHash(z));X!=null?U=X.next:(X=this.vertexHashLookup.get(Zs.computePosHash(L)),U=X!=null?X.prev:N),this.unevalEdges.push({polygonIdx:e,a:E,b:C,hash:N,portalHash:U,isTunnel:u,type:"unevaluated",featureInfo:p})}}addPortalCandidates(e,i,l,u,f){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:f});const p=i[0];this.vertexHashLookup.clear();let v=Zs.computeEdgeHash(p[p.length-2],p[p.length-1]);for(let w=0;w<p.length-1;w++){const E=p[w+0],C=p[w+1],z=hr(C.x-E.x,C.y-E.y),L=us(z);if(L===0)continue;let N="unevaluated";const U=u.pointElevation(E),X=u.pointElevation(C);Math.abs(U)<.01&&Math.abs(X)<.01?N="entrance":(this.isOnBorder(E.x,C.x)||this.isOnBorder(E.y,C.y))&&(N="border");const J=Zs.computeEdgeHash(E,C);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:E,vb:C,vab:z,length:L,hash:J,isTunnel:l,type:N});const Q=Zs.computePosHash(E);this.vertexHashLookup.set(Q,{prev:v,next:J}),v=J}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=L=>{L.primitiveLength=this.indexArray.length-L.primitiveOffset},u=new VL(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const f=i(),p=i(),v=i(),w=(L,N)=>{L.sort(((X,J)=>X.type===N&&J.type!==N?-1:X.type!==N&&J.type===N?1:0));const U=L.findIndex((X=>X.type!==N));return U>=0?U:L.length};let E=0;this.unevalEdges.length>0&&(E=w(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},this.tileToMeters)),l(v);const C=i(),z=i();if(this.unevalEdges.length>0){const L=this.unevalEdges.splice(E),N=w(L,"tunnel")+E;this.unevalEdges.push(...L),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},{min:E,max:N})}l(C),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(z),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(p),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(f),this.maskSegments=Fr.simpleSegment(0,z.primitiveOffset,0,z.primitiveLength),this.depthSegments=Fr.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength),this.renderableBridgeSegments=Fr.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=Fr.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.shadowCasterSegments=Fr.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength)}update(e,i,l,u,f,p,v,w){this.bridgeProgramConfigurations.updatePaintArrays(e,i,f,l,u,p,v,w),this.tunnelProgramConfigurations.updatePaintArrays(e,i,f,l,u,p,v,w)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,ML.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,CL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,l,u,f){const p=(v,w)=>{for(let E=0;E<w.length-1;E++){const C=w[E].featureIndex,z=w[E+1].vertexStart,L=e.feature(C);v.populatePaintArrays(z,L,C,{},l,i,u,void 0,f)}};p(this.bridgeProgramConfigurations,this.bridgeFeatureSections),p(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,l,u,f){const p=new Map;for(let v=u;v<f;v++){const w=l[v],E=w.a,C=w.b,z=Zs.computePosHash(e[E]),L=Zs.computePosHash(e[C]);let N=p.get(z);N||(N={},p.set(z,N));let U=p.get(L);U||(U={},p.set(L,U)),i[E]<=0&&i[C]<=0||(N.to=C,U.from=E)}return p}isTerminalVertex(e,i){const l=Zs.computePosHash(this.unevalVertices[e]),u=i.get(l);return!u||!u.from||!u.to}constructBridgeStructures(e,i,l,u,f,p){e.clearVertexLookup();const v=this.computeVertexConnections(i,l,u,f.min,f.max),w=1/p,E=.5*w,C=(Pt,Ut)=>Se(Pt,i[Ut].x,i[Ut].y,l[Ut]*w),z=de(),L=de(),N=de(),U=de(),X=de(),J=(Pt,Ut)=>{const bt=v.get(Zs.computePosHash(i[Ut])),kt=bt.from,dt=bt.to;if(!kt||!dt)return;C(z,kt),C(L,Ut),C(N,dt),cn(U),on(z,L)||(Jt(X,L,z),tt(U,X)),on(N,L)||(Jt(X,N,L),Ne(U,U,tt(X,X)));const lt=zt(U);return lt>0?Dt(Pt,U,1/lt):void 0};let Q=Number.POSITIVE_INFINITY;this.sortSubarray(u,f.min,f.max,((Pt,Ut)=>Pt.featureInfo.featureIndex-Ut.featureInfo.featureIndex));const le=de(),he=de(),ge=de(),Le=de(),Oe=de(),Ve=de(),We=de(),He=de(),Tt=de(),Ke=[de(),de(),de(),de()],Et=[de(),de(),de(),de()],Ft=[{coord:new Mt(0,0),height:0},{coord:new Mt(0,0),height:0}],It=(Pt,Ut)=>Pt>Ut;for(let Pt=f.min;Pt<f.max;Pt++){const Ut=u[Pt];if(!Ut.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Ft,i,l,Ut,It))continue;const[bt,kt]=Ft;if(Se(le,bt.coord.x,bt.coord.y,w*bt.height),Se(he,kt.coord.x,kt.coord.y,w*kt.height),on(le,he))continue;Jt(ge,he,le),tt(ge,ge);const dt=J(He,Ut.a)||ge,lt=J(Tt,Ut.b)||ge;Se(Le,dt[1],-dt[0],0),tt(Le,Le),Se(Oe,lt[1],-lt[0],0),tt(Oe,Oe),Lt(He,Le,dt),tt(Ve,He),Lt(He,Oe,lt),tt(We,He),Ne(Ke[0],le,Dt(He,Jt(He,Le,Ve),E)),Ne(Ke[1],le,Dt(He,Ne(He,Le,Ve),E)),Ne(Ke[2],le,Dt(He,Ve,E)),Ke[3]=le,Ne(Et[0],he,Dt(He,Jt(He,Oe,We),E)),Ne(Et[1],he,Dt(He,Ne(He,Oe,We),E)),Ne(Et[2],he,Dt(He,We,E)),Et[3]=he,Q=this.addFeatureSection(Ut.featureInfo.featureIndex,Q,this.bridgeFeatureSections,e);const jt=e.addVertex(Ke[0],Le,p),Nt=e.addVertex(Ke[1],Le,p),wn=e.addVertex(Et[0],Oe,p),sn=e.addVertex(Et[1],Oe,p);e.addTriangle(jt,Nt,wn),e.addTriangle(Nt,sn,wn);const pn=e.addVertex(Ke[1],Ve,p),Xt=e.addVertex(Ke[2],Ve,p),xn=e.addVertex(Et[1],We,p),Zn=e.addVertex(Et[2],We,p);e.addTriangle(pn,Xt,xn),e.addTriangle(Xt,Zn,xn),st(Le,Le),st(Oe,Oe);const en=e.addVertex(Ke[2],Le,p),_n=e.addVertex(Ke[3],Le,p),zn=e.addVertex(Et[2],Oe,p),$n=e.addVertex(Et[3],Oe,p);e.addTriangle(en,_n,zn),e.addTriangle(_n,$n,zn);const di=this.isTerminalVertex(Ut.a,v),ni=this.isTerminalVertex(Ut.b,v);bt.height<.01&&di&&e.addQuad(Ke[3],Ke[2],Ke[1],Ke[0],st(dt,dt),p),kt.height<.01&&ni&&e.addQuad(Et[0],Et[1],Et[2],Et[3],lt,p)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,l,u,f,p){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const w=(Q,le)=>Q.featureInfo.featureIndex-le.featureInfo.featureIndex;this.sortSubarray(u,f.min,f.max,w),this.sortSubarray(u,p.min,p.max,w);const E=Q=>tt(Q,Q),C=[{coord:new Mt(0,0),height:0},{coord:new Mt(0,0),height:0}],z=(Q,le)=>Q<le,L=de(),N=de(),U=de(),X=de(),J=de();for(let Q=f.min;Q<f.max;Q++){if(!this.prepareEdgePoints(C,i,l,u[Q],z))continue;const[le,he]=C,ge=E(Se(J,-(he.coord.y-le.coord.y),he.coord.x-le.coord.x,0));v=this.addFeatureSection(u[Q].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Se(L,le.coord.x,le.coord.y,le.height),Se(N,he.coord.x,he.coord.y,he.height),Se(U,he.coord.x,he.coord.y,u[Q].isTunnel?-.1:0),Se(X,le.coord.x,le.coord.y,u[Q].isTunnel?-.1:0),ge)}for(let Q=p.min;Q<p.max;Q++){const le=u[Q];le.isTunnel&&([le.a,le.b]=[le.b,le.a]);const he=i[le.a],ge=i[le.b],Le=E(Se(J,-(ge.y-he.y),ge.x-he.x,0));v=this.addFeatureSection(le.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Se(L,ge.x,ge.y,0),Se(N,he.x,he.y,0),Se(U,he.x,he.y,l[le.a]+4),Se(X,ge.x,ge.y,l[le.b]+4),Le),e.addQuad(Se(L,he.x,he.y,0),Se(N,ge.x,ge.y,0),Se(U,ge.x,ge.y,l[le.b]+4),Se(X,he.x,he.y,l[le.a]+4),Le)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,l,u){e.coord.x=i,e.coord.y=l,e.height=u}prepareEdgePoints(e,i,l,u,f){let p=i[u.a].x,v=i[u.a].y,w=i[u.b].x,E=i[u.b].y,C=l[u.a],z=l[u.b];const L=f(C,0),N=f(z,0);if(L&&N)return this.setElevatedPoint(e[0],p,v,C),this.setElevatedPoint(e[1],w,E,z),!0;if(!L&&!N)return!1;if(L){if(!N){const U=z/(z-C);w=Rn(w,p,U),E=Rn(E,v,U),z=Rn(z,C,U)}}else{const U=C/(C-z);p=Rn(p,w,U),v=Rn(v,E,U),C=Rn(C,z,U)}return this.setElevatedPoint(e[0],p,v,C),this.setElevatedPoint(e[1],w,E,z),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((v,w)=>v.hash===w.hash?w.polygonIdx-v.polygonIdx:w.hash>v.hash?1:-1));let l=0,u=0,f=0,p=i[l].polygonIdx;do u++,(u===i.length||i[l].hash!==i[u].hash)&&((u-l==1||i[u-1].polygonIdx!==p)&&(f<l&&(i[f]=i[l],i[l]=null),i[f].type="none",f++),l=u,l!==i.length&&(p=i[l].polygonIdx));while(l!==i.length);if(i.splice(f),i.length!==0&&e.length!==0){i.sort(((E,C)=>E.portalHash<C.portalHash?1:-1));let v=0,w=0;for(;v!==i.length&&w!==e.length;){const E=i[v],C=e[w];E.portalHash>C.hash?v++:C.hash>E.portalHash?w++:(E.type=C.type,v++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Yt&&i>=Yt}addFeatureSection(e,i,l,u){return e!==i&&(i=e,l.push({featureIndex:e,vertexStart:u.getVertexCount()}),u.clearVertexLookup()),i}sortSubarray(e,i,l,u){const f=e.slice(i,l);f.sort(u),e.splice(i,f.length,...f)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Zs.computePosHash(e))<<32n|BigInt(Zs.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var qS,HS={exports:{}},ZS=(qS||(qS=1,(function(o,e){(function(i){function l(ve,be){return ve>be?1:ve<be?-1:0}var u=function(ve,be){ve===void 0&&(ve=l),be===void 0&&(be=!1),this._compare=ve,this._root=null,this._size=0,this._noDuplicates=!!be},f={size:{configurable:!0}};function p(ve,be,ht,wt,$t){var Qt=$t-wt;if(Qt>0){var un=wt+Math.floor(Qt/2),Sn={key:be[un],data:ht[un],parent:ve};return Sn.left=p(Sn,be,ht,wt,un),Sn.right=p(Sn,be,ht,un+1,$t),Sn}return null}function v(ve,be,ht,wt,$t){if(!(ht>=wt)){for(var Qt=ve[ht+wt>>1],un=ht-1,Sn=wt+1;;){do un++;while($t(ve[un],Qt)<0);do Sn--;while($t(ve[Sn],Qt)>0);if(un>=Sn)break;var fi=ve[un];ve[un]=ve[Sn],ve[Sn]=fi,fi=be[un],be[un]=be[Sn],be[Sn]=fi}v(ve,be,ht,Sn,$t),v(ve,be,Sn+1,wt,$t)}}u.prototype.rotateLeft=function(ve){var be=ve.right;be&&(ve.right=be.left,be.left&&(be.left.parent=ve),be.parent=ve.parent),ve.parent?ve===ve.parent.left?ve.parent.left=be:ve.parent.right=be:this._root=be,be&&(be.left=ve),ve.parent=be},u.prototype.rotateRight=function(ve){var be=ve.left;be&&(ve.left=be.right,be.right&&(be.right.parent=ve),be.parent=ve.parent),ve.parent?ve===ve.parent.left?ve.parent.left=be:ve.parent.right=be:this._root=be,be&&(be.right=ve),ve.parent=be},u.prototype._splay=function(ve){for(;ve.parent;){var be=ve.parent;be.parent?be.left===ve&&be.parent.left===be?(this.rotateRight(be.parent),this.rotateRight(be)):be.right===ve&&be.parent.right===be?(this.rotateLeft(be.parent),this.rotateLeft(be)):be.left===ve&&be.parent.right===be?(this.rotateRight(be),this.rotateLeft(be)):(this.rotateLeft(be),this.rotateRight(be)):be.left===ve?this.rotateRight(be):this.rotateLeft(be)}},u.prototype.splay=function(ve){for(var be,ht,wt,$t,Qt;ve.parent;)(ht=(be=ve.parent).parent)&&ht.parent?((wt=ht.parent).left===ht?wt.left=ve:wt.right=ve,ve.parent=wt):(ve.parent=null,this._root=ve),$t=ve.left,Qt=ve.right,ve===be.left?(ht&&(ht.left===be?(be.right?(ht.left=be.right,ht.left.parent=ht):ht.left=null,be.right=ht,ht.parent=be):($t?(ht.right=$t,$t.parent=ht):ht.right=null,ve.left=ht,ht.parent=ve)),Qt?(be.left=Qt,Qt.parent=be):be.left=null,ve.right=be,be.parent=ve):(ht&&(ht.right===be?(be.left?(ht.right=be.left,ht.right.parent=ht):ht.right=null,be.left=ht,ht.parent=be):(Qt?(ht.left=Qt,Qt.parent=ht):ht.left=null,ve.right=ht,ht.parent=ve)),$t?(be.right=$t,$t.parent=be):be.right=null,ve.left=be,be.parent=ve)},u.prototype.replace=function(ve,be){ve.parent?ve===ve.parent.left?ve.parent.left=be:ve.parent.right=be:this._root=be,be&&(be.parent=ve.parent)},u.prototype.minNode=function(ve){if(ve===void 0&&(ve=this._root),ve)for(;ve.left;)ve=ve.left;return ve},u.prototype.maxNode=function(ve){if(ve===void 0&&(ve=this._root),ve)for(;ve.right;)ve=ve.right;return ve},u.prototype.insert=function(ve,be){var ht=this._root,wt=null,$t=this._compare;if(this._noDuplicates)for(;ht;){if(wt=ht,$t(ht.key,ve)===0)return;ht=$t(ht.key,ve)<0?ht.right:ht.left}else for(;ht;)wt=ht,ht=$t(ht.key,ve)<0?ht.right:ht.left;return ht={key:ve,data:be,left:null,right:null,parent:wt},wt?$t(wt.key,ht.key)<0?wt.right=ht:wt.left=ht:this._root=ht,this.splay(ht),this._size++,ht},u.prototype.find=function(ve){for(var be=this._root,ht=this._compare;be;){var wt=ht(be.key,ve);if(wt<0)be=be.right;else{if(!(wt>0))return be;be=be.left}}return null},u.prototype.contains=function(ve){for(var be=this._root,ht=this._compare;be;){var wt=ht(ve,be.key);if(wt===0)return!0;be=wt<0?be.left:be.right}return!1},u.prototype.remove=function(ve){var be=this.find(ve);if(!be)return!1;if(this.splay(be),be.left)if(be.right){var ht=this.minNode(be.right);ht.parent!==be&&(this.replace(ht,ht.right),ht.right=be.right,ht.right.parent=ht),this.replace(be,ht),ht.left=be.left,ht.left.parent=ht}else this.replace(be,be.left);else this.replace(be,be.right);return this._size--,!0},u.prototype.removeNode=function(ve){if(!ve)return!1;if(this.splay(ve),ve.left)if(ve.right){var be=this.minNode(ve.right);be.parent!==ve&&(this.replace(be,be.right),be.right=ve.right,be.right.parent=be),this.replace(ve,be),be.left=ve.left,be.left.parent=be}else this.replace(ve,ve.left);else this.replace(ve,ve.right);return this._size--,!0},u.prototype.erase=function(ve){var be=this.find(ve);if(be){this.splay(be);var ht=be.left,wt=be.right,$t=null;ht&&(ht.parent=null,$t=this.maxNode(ht),this.splay($t),this._root=$t),wt&&(ht?$t.right=wt:this._root=wt,wt.parent=$t),this._size--}},u.prototype.pop=function(){var ve=this._root,be=null;if(ve){for(;ve.left;)ve=ve.left;be={key:ve.key,data:ve.data},this.remove(ve.key)}return be},u.prototype.next=function(ve){var be=ve;if(be)if(be.right)for(be=be.right;be&&be.left;)be=be.left;else for(be=ve.parent;be&&be.right===ve;)ve=be,be=be.parent;return be},u.prototype.prev=function(ve){var be=ve;if(be)if(be.left)for(be=be.left;be&&be.right;)be=be.right;else for(be=ve.parent;be&&be.left===ve;)ve=be,be=be.parent;return be},u.prototype.forEach=function(ve){for(var be=this._root,ht=[],wt=!1,$t=0;!wt;)be?(ht.push(be),be=be.left):ht.length>0?(ve(be=ht.pop(),$t++),be=be.right):wt=!0;return this},u.prototype.range=function(ve,be,ht,wt){for(var $t=[],Qt=this._compare,un=this._root;$t.length!==0||un;)if(un)$t.push(un),un=un.left;else{if(Qt((un=$t.pop()).key,be)>0)break;if(Qt(un.key,ve)>=0&&ht.call(wt,un))return this;un=un.right}return this},u.prototype.keys=function(){for(var ve=this._root,be=[],ht=[],wt=!1;!wt;)ve?(be.push(ve),ve=ve.left):be.length>0?(ve=be.pop(),ht.push(ve.key),ve=ve.right):wt=!0;return ht},u.prototype.values=function(){for(var ve=this._root,be=[],ht=[],wt=!1;!wt;)ve?(be.push(ve),ve=ve.left):be.length>0?(ve=be.pop(),ht.push(ve.data),ve=ve.right):wt=!0;return ht},u.prototype.at=function(ve){for(var be=this._root,ht=[],wt=!1,$t=0;!wt;)if(be)ht.push(be),be=be.left;else if(ht.length>0){if(be=ht.pop(),$t===ve)return be;$t++,be=be.right}else wt=!0;return null},u.prototype.load=function(ve,be,ht){if(ve===void 0&&(ve=[]),be===void 0&&(be=[]),ht===void 0&&(ht=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var wt=ve.length;return ht&&v(ve,be,0,wt-1,this._compare),this._root=p(null,ve,be,0,wt),this._size=wt,this},u.prototype.min=function(){var ve=this.minNode(this._root);return ve?ve.key:null},u.prototype.max=function(){var ve=this.maxNode(this._root);return ve?ve.key:null},u.prototype.isEmpty=function(){return this._root===null},f.size.get=function(){return this._size},u.createTree=function(ve,be,ht,wt,$t){return new u(ht,$t).load(ve,be,wt)},Object.defineProperties(u.prototype,f);var w=0,E=1,C=2,z=3,L=0,N=1,U=2,X=3;function J(ve,be,ht){be===null?(ve.inOut=!1,ve.otherInOut=!0):(ve.isSubject===be.isSubject?(ve.inOut=!be.inOut,ve.otherInOut=be.otherInOut):(ve.inOut=!be.otherInOut,ve.otherInOut=be.isVertical()?!be.inOut:be.inOut),be&&(ve.prevInResult=!Q(be,ht)||be.isVertical()?be.prevInResult:be));var wt=Q(ve,ht);ve.resultTransition=wt?(function($t,Qt){var un,Sn=!$t.inOut,fi=!$t.otherInOut;switch(Qt){case L:un=Sn&&fi;break;case N:un=Sn||fi;break;case X:un=Sn^fi;break;case U:un=$t.isSubject?Sn&&!fi:fi&&!Sn}return un?1:-1})(ve,ht):0}function Q(ve,be){switch(ve.type){case w:switch(be){case L:return!ve.otherInOut;case N:return ve.otherInOut;case U:return ve.isSubject&&ve.otherInOut||!ve.isSubject&&!ve.otherInOut;case X:return!0}break;case C:return be===L||be===N;case z:return be===U;case E:return!1}return!1}var le=function(ve,be,ht,wt,$t){this.left=be,this.point=ve,this.otherEvent=ht,this.isSubject=wt,this.type=$t||w,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},he={inResult:{configurable:!0}};function ge(ve,be){return ve[0]===be[0]&&ve[1]===be[1]}le.prototype.isBelow=function(ve){var be=this.point,ht=this.otherEvent.point;return this.left?(be[0]-ve[0])*(ht[1]-ve[1])-(ht[0]-ve[0])*(be[1]-ve[1])>0:(ht[0]-ve[0])*(be[1]-ve[1])-(be[0]-ve[0])*(ht[1]-ve[1])>0},le.prototype.isAbove=function(ve){return!this.isBelow(ve)},le.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},he.inResult.get=function(){return this.resultTransition!==0},le.prototype.clone=function(){var ve=new le(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ve.contourId=this.contourId,ve.resultTransition=this.resultTransition,ve.prevInResult=this.prevInResult,ve.isExteriorRing=this.isExteriorRing,ve.inOut=this.inOut,ve.otherInOut=this.otherInOut,ve},Object.defineProperties(le.prototype,he);var Le=11102230246251565e-32,Oe=134217729,Ve=(3+8*Le)*Le;function We(ve,be,ht,wt,$t){var Qt,un,Sn,fi,pi=be[0],ui=wt[0],Ki=0,Mr=0;ui>pi==ui>-pi?(Qt=pi,pi=be[++Ki]):(Qt=ui,ui=wt[++Mr]);var ci=0;if(Ki<ve&&Mr<ht)for(ui>pi==ui>-pi?(Sn=Qt-((un=pi+Qt)-pi),pi=be[++Ki]):(Sn=Qt-((un=ui+Qt)-ui),ui=wt[++Mr]),Qt=un,Sn!==0&&($t[ci++]=Sn);Ki<ve&&Mr<ht;)ui>pi==ui>-pi?(Sn=Qt-((un=Qt+pi)-(fi=un-Qt))+(pi-fi),pi=be[++Ki]):(Sn=Qt-((un=Qt+ui)-(fi=un-Qt))+(ui-fi),ui=wt[++Mr]),Qt=un,Sn!==0&&($t[ci++]=Sn);for(;Ki<ve;)Sn=Qt-((un=Qt+pi)-(fi=un-Qt))+(pi-fi),pi=be[++Ki],Qt=un,Sn!==0&&($t[ci++]=Sn);for(;Mr<ht;)Sn=Qt-((un=Qt+ui)-(fi=un-Qt))+(ui-fi),ui=wt[++Mr],Qt=un,Sn!==0&&($t[ci++]=Sn);return Qt===0&&ci!==0||($t[ci++]=Qt),ci}function He(ve){return new Float64Array(ve)}var Tt=33306690738754716e-32,Ke=22204460492503146e-32,Et=11093356479670487e-47,Ft=He(4),It=He(8),Pt=He(12),Ut=He(16),bt=He(4);function kt(ve,be,ht){var wt=(function($t,Qt,un,Sn,fi,pi){var ui=(Qt-pi)*(un-fi),Ki=($t-fi)*(Sn-pi),Mr=ui-Ki;if(ui===0||Ki===0||ui>0!=Ki>0)return Mr;var ci=Math.abs(ui+Ki);return Math.abs(Mr)>=Tt*ci?Mr:-(function(fr,Qi,Li,gr,_r,cr,pr){var $i,mi,nr,Br,Bn,Ai,yr,Gr,Tr,bo,or,po,Ps,Qo,Wo,ks,Yl,wo,Do=fr-_r,$o=Li-_r,_s=Qi-cr,as=gr-cr;Ft[0]=(Wo=(Gr=Do-(yr=(Ai=Oe*Do)-(Ai-Do)))*(bo=as-(Tr=(Ai=Oe*as)-(Ai-as)))-((Qo=Do*as)-yr*Tr-Gr*Tr-yr*bo))-((or=Wo-(Yl=(Gr=_s-(yr=(Ai=Oe*_s)-(Ai-_s)))*(bo=$o-(Tr=(Ai=Oe*$o)-(Ai-$o)))-((ks=_s*$o)-yr*Tr-Gr*Tr-yr*bo)))+(Bn=Wo-or))+(Bn-Yl),Ft[1]=(Ps=Qo-((po=Qo+or)-(Bn=po-Qo))+(or-Bn))-((or=Ps-ks)+(Bn=Ps-or))+(Bn-ks),Ft[2]=po-((wo=po+or)-(Bn=wo-po))+(or-Bn),Ft[3]=wo;var Vu=(function(kK,aM){for(var lM=aM[0],_b=1;_b<4;_b++)lM+=aM[_b];return lM})(0,Ft),wg=Ke*pr;if(Vu>=wg||-Vu>=wg||($i=fr-(Do+(Bn=fr-Do))+(Bn-_r),nr=Li-($o+(Bn=Li-$o))+(Bn-_r),mi=Qi-(_s+(Bn=Qi-_s))+(Bn-cr),Br=gr-(as+(Bn=gr-as))+(Bn-cr),$i===0&&mi===0&&nr===0&&Br===0)||(wg=Et*pr+Ve*Math.abs(Vu),(Vu+=Do*Br+as*$i-(_s*nr+$o*mi))>=wg||-Vu>=wg))return Vu;bt[0]=(Wo=(Gr=$i-(yr=(Ai=Oe*$i)-(Ai-$i)))*(bo=as-(Tr=(Ai=Oe*as)-(Ai-as)))-((Qo=$i*as)-yr*Tr-Gr*Tr-yr*bo))-((or=Wo-(Yl=(Gr=mi-(yr=(Ai=Oe*mi)-(Ai-mi)))*(bo=$o-(Tr=(Ai=Oe*$o)-(Ai-$o)))-((ks=mi*$o)-yr*Tr-Gr*Tr-yr*bo)))+(Bn=Wo-or))+(Bn-Yl),bt[1]=(Ps=Qo-((po=Qo+or)-(Bn=po-Qo))+(or-Bn))-((or=Ps-ks)+(Bn=Ps-or))+(Bn-ks),bt[2]=po-((wo=po+or)-(Bn=wo-po))+(or-Bn),bt[3]=wo;var WF=We(4,Ft,4,bt,It);bt[0]=(Wo=(Gr=Do-(yr=(Ai=Oe*Do)-(Ai-Do)))*(bo=Br-(Tr=(Ai=Oe*Br)-(Ai-Br)))-((Qo=Do*Br)-yr*Tr-Gr*Tr-yr*bo))-((or=Wo-(Yl=(Gr=_s-(yr=(Ai=Oe*_s)-(Ai-_s)))*(bo=nr-(Tr=(Ai=Oe*nr)-(Ai-nr)))-((ks=_s*nr)-yr*Tr-Gr*Tr-yr*bo)))+(Bn=Wo-or))+(Bn-Yl),bt[1]=(Ps=Qo-((po=Qo+or)-(Bn=po-Qo))+(or-Bn))-((or=Ps-ks)+(Bn=Ps-or))+(Bn-ks),bt[2]=po-((wo=po+or)-(Bn=wo-po))+(or-Bn),bt[3]=wo;var qF=We(WF,It,4,bt,Pt);bt[0]=(Wo=(Gr=$i-(yr=(Ai=Oe*$i)-(Ai-$i)))*(bo=Br-(Tr=(Ai=Oe*Br)-(Ai-Br)))-((Qo=$i*Br)-yr*Tr-Gr*Tr-yr*bo))-((or=Wo-(Yl=(Gr=mi-(yr=(Ai=Oe*mi)-(Ai-mi)))*(bo=nr-(Tr=(Ai=Oe*nr)-(Ai-nr)))-((ks=mi*nr)-yr*Tr-Gr*Tr-yr*bo)))+(Bn=Wo-or))+(Bn-Yl),bt[1]=(Ps=Qo-((po=Qo+or)-(Bn=po-Qo))+(or-Bn))-((or=Ps-ks)+(Bn=Ps-or))+(Bn-ks),bt[2]=po-((wo=po+or)-(Bn=wo-po))+(or-Bn),bt[3]=wo;var HF=We(qF,Pt,4,bt,Ut);return Ut[HF-1]})($t,Qt,un,Sn,fi,pi,ci)})(ve[0],ve[1],be[0],be[1],ht[0],ht[1]);return wt>0?-1:wt<0?1:0}function dt(ve,be){var ht=ve.point,wt=be.point;return ht[0]>wt[0]?1:ht[0]<wt[0]?-1:ht[1]!==wt[1]?ht[1]>wt[1]?1:-1:(function($t,Qt,un,Sn){return $t.left!==Qt.left?$t.left?1:-1:kt(un,$t.otherEvent.point,Qt.otherEvent.point)!==0?$t.isBelow(Qt.otherEvent.point)?-1:1:!$t.isSubject&&Qt.isSubject?1:-1})(ve,be,ht)}function lt(ve,be,ht){var wt=new le(be,!1,ve,ve.isSubject),$t=new le(be,!0,ve.otherEvent,ve.isSubject);return ge(ve.point,ve.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ve),wt.contourId=$t.contourId=ve.contourId,dt($t,ve.otherEvent)>0&&(ve.otherEvent.left=!0,$t.left=!1),ve.otherEvent.otherEvent=$t,ve.otherEvent=wt,ht.push($t),ht.push(wt),ht}function jt(ve,be){return ve[0]*be[1]-ve[1]*be[0]}function Nt(ve,be){return ve[0]*be[0]+ve[1]*be[1]}function wn(ve,be,ht){var wt=(function(fi,pi,ui,Ki,Mr){var ci=[pi[0]-fi[0],pi[1]-fi[1]],fr=[Ki[0]-ui[0],Ki[1]-ui[1]];function Qi(Ai,yr,Gr){return[Ai[0]+yr*Gr[0],Ai[1]+yr*Gr[1]]}var Li=[ui[0]-fi[0],ui[1]-fi[1]],gr=jt(ci,fr),_r=gr*gr,cr=Nt(ci,ci);if(_r>0){var pr=jt(Li,fr)/gr;if(pr<0||pr>1)return null;var $i=jt(Li,ci)/gr;return $i<0||$i>1?null:pr===0||pr===1?[Qi(fi,pr,ci)]:$i===0||$i===1?[Qi(ui,$i,fr)]:[Qi(fi,pr,ci)]}if((_r=(gr=jt(Li,ci))*gr)>0)return null;var mi=Nt(ci,Li)/cr,nr=mi+Nt(ci,fr)/cr,Br=Math.min(mi,nr),Bn=Math.max(mi,nr);return Br<=1&&Bn>=0?Br===1?[Qi(fi,Br>0?Br:0,ci)]:Bn===0?[Qi(fi,Bn<1?Bn:1,ci)]:[Qi(fi,Br>0?Br:0,ci),Qi(fi,Bn<1?Bn:1,ci)]:null})(ve.point,ve.otherEvent.point,be.point,be.otherEvent.point),$t=wt?wt.length:0;if($t===0||$t===1&&(ge(ve.point,be.point)||ge(ve.otherEvent.point,be.otherEvent.point))||$t===2&&ve.isSubject===be.isSubject)return 0;if($t===1)return ge(ve.point,wt[0])||ge(ve.otherEvent.point,wt[0])||lt(ve,wt[0],ht),ge(be.point,wt[0])||ge(be.otherEvent.point,wt[0])||lt(be,wt[0],ht),1;var Qt=[],un=!1,Sn=!1;return ge(ve.point,be.point)?un=!0:dt(ve,be)===1?Qt.push(be,ve):Qt.push(ve,be),ge(ve.otherEvent.point,be.otherEvent.point)?Sn=!0:dt(ve.otherEvent,be.otherEvent)===1?Qt.push(be.otherEvent,ve.otherEvent):Qt.push(ve.otherEvent,be.otherEvent),un&&Sn||un?(be.type=E,ve.type=be.inOut===ve.inOut?C:z,un&&!Sn&&lt(Qt[1].otherEvent,Qt[0].point,ht),2):Sn?(lt(Qt[0],Qt[1].point,ht),3):Qt[0]!==Qt[3].otherEvent?(lt(Qt[0],Qt[1].point,ht),lt(Qt[1],Qt[2].point,ht),3):(lt(Qt[0],Qt[1].point,ht),lt(Qt[3].otherEvent,Qt[2].point,ht),3)}function sn(ve,be){if(ve===be)return 0;if(kt(ve.point,ve.otherEvent.point,be.point)!==0||kt(ve.point,ve.otherEvent.point,be.otherEvent.point)!==0)return ge(ve.point,be.point)?ve.isBelow(be.otherEvent.point)?-1:1:ve.point[0]===be.point[0]?ve.point[1]<be.point[1]?-1:1:dt(ve,be)===1?be.isAbove(ve.point)?-1:1:ve.isBelow(be.point)?-1:1;if(ve.isSubject!==be.isSubject)return ve.isSubject?-1:1;var ht=ve.point,wt=be.point;return ht[0]===wt[0]&&ht[1]===wt[1]?(ht=ve.otherEvent.point)[0]===(wt=be.otherEvent.point)[0]&&ht[1]===wt[1]?0:ve.contourId>be.contourId?1:-1:dt(ve,be)===1?1:-1}var pn=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Xt(ve,be,ht,wt){var $t,Qt=ve+1,un=be[ve].point,Sn=be.length;for(Qt<Sn&&($t=be[Qt].point);Qt<Sn&&$t[0]===un[0]&&$t[1]===un[1];){if(!ht[Qt])return Qt;++Qt<Sn&&($t=be[Qt].point)}for(Qt=ve-1;ht[Qt]&&Qt>wt;)Qt--;return Qt}pn.prototype.isExterior=function(){return this.holeOf==null};var xn=en,Zn=en;function en(ve,be){if(!(this instanceof en))return new en(ve,be);if(this.data=ve||[],this.length=this.data.length,this.compare=be||_n,this.length>0)for(var ht=(this.length>>1)-1;ht>=0;ht--)this._down(ht)}function _n(ve,be){return ve<be?-1:ve>be?1:0}en.prototype={push:function(ve){this.data.push(ve),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ve=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ve}},peek:function(){return this.data[0]},_up:function(ve){for(var be=this.data,ht=this.compare,wt=be[ve];ve>0;){var $t=ve-1>>1,Qt=be[$t];if(ht(wt,Qt)>=0)break;be[ve]=Qt,ve=$t}be[ve]=wt},_down:function(ve){for(var be=this.data,ht=this.compare,wt=this.length>>1,$t=be[ve];ve<wt;){var Qt=1+(ve<<1),un=Qt+1,Sn=be[Qt];if(un<this.length&&ht(be[un],Sn)<0&&(Qt=un,Sn=be[un]),ht(Sn,$t)>=0)break;be[ve]=Sn,ve=Qt}be[ve]=$t}},xn.default=Zn;var zn=Math.max,$n=Math.min,di=0;function ni(ve,be,ht,wt,$t,Qt){var un,Sn,fi,pi,ui,Ki;for(un=0,Sn=ve.length-1;un<Sn;un++)if(pi=ve[un+1],ui=new le(fi=ve[un],!1,void 0,be),Ki=new le(pi,!1,ui,be),ui.otherEvent=Ki,fi[0]!==pi[0]||fi[1]!==pi[1]){ui.contourId=Ki.contourId=ht,Qt||(ui.isExteriorRing=!1,Ki.isExteriorRing=!1),dt(ui,Ki)>0?Ki.left=!0:ui.left=!0;var Mr=fi[0],ci=fi[1];$t[0]=$n($t[0],Mr),$t[1]=$n($t[1],ci),$t[2]=zn($t[2],Mr),$t[3]=zn($t[3],ci),wt.push(ui),wt.push(Ki)}}var hn=[];function ei(ve,be,ht){typeof ve[0][0][0]=="number"&&(ve=[ve]),typeof be[0][0][0]=="number"&&(be=[be]);var wt=(function(ci,fr,Qi){var Li=null;return ci.length*fr.length==0&&(Qi===L?Li=hn:Qi===U?Li=ci:Qi!==N&&Qi!==X||(Li=ci.length===0?fr:ci)),Li})(ve,be,ht);if(wt)return wt===hn?null:wt;var $t=[1/0,1/0,-1/0,-1/0],Qt=[1/0,1/0,-1/0,-1/0],un=(function(ci,fr,Qi,Li,gr){var _r,cr,pr,$i,mi,nr,Br=new xn(null,dt);for(pr=0,$i=ci.length;pr<$i;pr++)for(mi=0,nr=(_r=ci[pr]).length;mi<nr;mi++)(cr=mi===0)&&di++,ni(_r[mi],!0,di,Br,Qi,cr);for(pr=0,$i=fr.length;pr<$i;pr++)for(mi=0,nr=(_r=fr[pr]).length;mi<nr;mi++)cr=mi===0,gr===U&&(cr=!1),cr&&di++,ni(_r[mi],!1,di,Br,Li,cr);return Br})(ve,be,$t,Qt,ht);if(wt=(function(ci,fr,Qi,Li,gr){var _r=null;return(Qi[0]>Li[2]||Li[0]>Qi[2]||Qi[1]>Li[3]||Li[1]>Qi[3])&&(gr===L?_r=hn:gr===U?_r=ci:gr!==N&&gr!==X||(_r=ci.concat(fr))),_r})(ve,be,$t,Qt,ht))return wt===hn?null:wt;for(var Sn=(function(ci){var fr,Qi,Li=(function(pr){var $i,mi,nr,Br,Bn=[];for(mi=0,nr=pr.length;mi<nr;mi++)(($i=pr[mi]).left&&$i.inResult||!$i.left&&$i.otherEvent.inResult)&&Bn.push($i);for(var Ai=!1;!Ai;)for(Ai=!0,mi=0,nr=Bn.length;mi<nr;mi++)mi+1<nr&&dt(Bn[mi],Bn[mi+1])===1&&(Br=Bn[mi],Bn[mi]=Bn[mi+1],Bn[mi+1]=Br,Ai=!1);for(mi=0,nr=Bn.length;mi<nr;mi++)($i=Bn[mi]).otherPos=mi;for(mi=0,nr=Bn.length;mi<nr;mi++)($i=Bn[mi]).left||(Br=$i.otherPos,$i.otherPos=$i.otherEvent.otherPos,$i.otherEvent.otherPos=Br);return Bn})(ci),gr={},_r=[],cr=function(){if(!gr[fr]){var pr=_r.length,$i=(function(Bn,Ai,yr){var Gr=new pn;if(Bn.prevInResult!=null){var Tr=Bn.prevInResult,bo=Tr.outputContourId;if(Tr.resultTransition>0){var or=Ai[bo];if(or.holeOf!=null){var po=or.holeOf;Ai[po].holeIds.push(yr),Gr.holeOf=po,Gr.depth=Ai[bo].depth}else Ai[bo].holeIds.push(yr),Gr.holeOf=bo,Gr.depth=Ai[bo].depth+1}else Gr.holeOf=null,Gr.depth=Ai[bo].depth}else Gr.holeOf=null,Gr.depth=0;return Gr})(Li[fr],_r,pr),mi=function(Bn){gr[Bn]=!0,Bn<Li.length&&Li[Bn]&&(Li[Bn].outputContourId=pr)},nr=fr,Br=fr;for($i.points.push(Li[fr].point);mi(nr),mi(nr=Li[nr].otherPos),$i.points.push(Li[nr].point),!((nr=Xt(nr,Li,gr,Br))==Br||nr>=Li.length)&&Li[nr];);_r.push($i)}};for(fr=0,Qi=Li.length;fr<Qi;fr++)cr();return _r})((function(ci,fr,Qi,Li,gr,_r){for(var cr,pr,$i,mi=new u(sn),nr=[],Br=Math.min(Li[2],gr[2]);ci.length!==0;){var Bn=ci.pop();if(nr.push(Bn),_r===L&&Bn.point[0]>Br||_r===U&&Bn.point[0]>Li[2])break;if(Bn.left){pr=cr=mi.insert(Bn),cr=cr!==($i=mi.minNode())?mi.prev(cr):null,pr=mi.next(pr);var Ai=cr?cr.key:null;if(J(Bn,Ai,_r),pr&&wn(Bn,pr.key,ci)===2&&(J(Bn,Ai,_r),J(pr.key,Bn,_r)),cr&&wn(cr.key,Bn,ci)===2){var yr=cr;J(Ai,(yr=yr!==$i?mi.prev(yr):null)?yr.key:null,_r),J(Bn,Ai,_r)}}else pr=cr=mi.find(Bn=Bn.otherEvent),cr&&pr&&(cr=cr!==$i?mi.prev(cr):null,pr=mi.next(pr),mi.remove(Bn),pr&&cr&&wn(cr.key,pr.key,ci))}return nr})(un,0,0,$t,Qt,ht)),fi=[],pi=0;pi<Sn.length;pi++){var ui=Sn[pi];if(ui.isExterior()){for(var Ki=[ui.points],Mr=0;Mr<ui.holeIds.length;Mr++)Ki.push(Sn[ui.holeIds[Mr]].points);fi.push(Ki)}}return fi}var Ti={UNION:N,DIFFERENCE:U,INTERSECTION:L,XOR:X};i.diff=function(ve,be){return ei(ve,be,U)},i.intersection=function(ve,be){return ei(ve,be,L)},i.operations=Ti,i.union=function(ve,be){return ei(ve,be,N)},i.xor=function(ve,be){return ei(ve,be,X)},Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,HS.exports)),HS.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Ry(o,e,i,l){const u=[],f=l===0?(p,v,w,E,C,z)=>{p.push(new Mt(z,w+(z-v)/(E-v)*(C-w)))}:(p,v,w,E,C,z)=>{p.push(new Mt(v+(z-w)/(C-w)*(E-v),z))};for(const p of o){const v=[];for(const w of p){if(w.length<=2)continue;const E=[];for(let L=0;L<w.length-1;L++){const N=w[L].x,U=w[L].y,X=w[L+1].x,J=w[L+1].y,Q=l===0?N:U,le=l===0?X:J;Q<e?le>e&&f(E,N,U,X,J,e):Q>i?le<i&&f(E,N,U,X,J,i):E.push(w[L]),le<e&&Q>=e&&f(E,N,U,X,J,e),le>i&&Q<=i&&f(E,N,U,X,J,i)}let C=w[w.length-1];const z=l===0?C.x:C.y;z>=e&&z<=i&&E.push(C),E.length&&(C=E[E.length-1],E[0].x===C.x&&E[0].y===C.y||E.push(E[0]),v.push(E))}v.length&&u.push(v)}return u}function UL(o,e){const i=d1(o),l=d1([e]),u=ZS.intersection(i,l);return u==null?[]:XS(u)}function jL(o,e){let l=d1(o,65536);const u=[];for(;e.valid();e.next()){const[f,p]=e.get(),v=f.x*65536,w=f.y*65536,E=p.x*65536,C=p.y*65536,z=E-v,L=C-w,N=Math.hypot(z,L);if(N===0)continue;const U=Math.trunc(L/N*3),X=-Math.trunc(z/N*3);u.push([[[v,w],[E,C],[E+U,C+X],[v+U,w+X],[v,w]]])}return u.length>0&&(l=ZS.diff(l,u)),XS(l,1/65536)}function d1(o,e=1){return[o.map((i=>i.map((l=>[l.x*e,l.y*e]))))]}function XS(o,e=1){return o.map((i=>i.map(((l,u)=>{const f=l.map((p=>new Mt(p[0]*e,p[1]*e).round()));return u>0&&f.reverse(),f}))))}class f1{constructor(e,i){this.layoutVertexArray=new Vl,this.indexArray=new Eo,this.lineIndexArray=new vo,this.triangleSegments=new Fr,this.lineSegments=new Fr,this.programConfigurations=new wa(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Ul)}update(e,i,l,u,f,p,v,w){this.programConfigurations.updatePaintArrays(e,i,f,l,u,p,v,w)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,AL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,IL.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,l,u,f,p,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,u,f,p,void 0,v)}}class p1{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new f1(e,!1),this.elevationBufferData=new f1(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,u){this.hasPattern=u1("fill",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:C}of e){const z=this.layers[0]._featureFilter.needGeometry,L=Vt(v,z);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom,{worldview:this.worldview}),L,l))continue;const N=f?f.evaluate(L,{},l,i.availableImages):void 0,U={id:w,properties:v.properties,type:v.type,sourceLayerIndex:C,index:E,geometry:z?L.geometry:nn(v,l,u),patterns:{},sortKey:N};p.push(U)}f&&p.sort(((v,w)=>v.sortKey-w.sortKey));for(const v of p){const{geometry:w,index:E,sourceLayerIndex:C}=v;if(this.hasPattern){const z=h1("fill",this.layers,v,this.zoom,this.pixelRatio,i);this.patternFeatures.push(z)}else this.addFeature(v,w,E,l,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[E].feature,w,E,C,this.index)}}update(e,i,l,u,f,p,v){this.bufferData.update(e,i,l,u,f,p,v,this.worldview),this.elevationBufferData.update(e,i,l,u,f,p,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,l,u,f,p,v,this.worldview)}addFeatures(e,i,l,u,f,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,l,u,p,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,l,u,f,p=[],v,w){const E=qm(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,E,u,l,w):this.addGeometry(E,this.bufferData),this.bufferData.populatePaintArrays(e,l,f,p,u,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,f,p,u,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,l,u,f){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,l,u,f,this.worldview))}addElevatedRoadFeature(e,i,l,u,f){const p=new Array,v=Dr.getElevationFeature(e,f);if(!v)return void this.addGeometry(i,this.bufferData);{const E=this.clipPolygonsToTile(i,1);E.length>0&&p.push({polygons:E,elevationFeature:v,elevationTileID:l})}const w={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:u};for(const E of p)if(E.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Zs(E.elevationTileID,this.layers,this.zoom,this.lut));const z=E.elevationFeature.isTunnel();let L=0;e.properties.hasOwnProperty(Xi)&&(L=+e.properties[Xi]);for(const N of E.polygons)this.elevatedStructures.addPortalCandidates(E.elevationFeature.id,N,z,E.elevationFeature,L)}E.elevationFeature.constantHeight==null&&(E.polygons=this.prepareElevatedPolygons(E.polygons,E.elevationFeature,E.elevationTileID));const C=new lo(l,E.elevationTileID);this.addElevatedGeometry(E.polygons,C,E.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u,w)}}addElevatedGeometry(e,i,l,u,f,p){const v={elevation:l,elevationSampler:i,bias:u,index:f,featureInfo:p},[w,E]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:w,max:E}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,w),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,E))}addGeometry(e,i,l){let u=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,p=null;l&&(p=l.elevationSampler.constantElevation(l.elevation,l.bias),p!=null&&(u=p,f=p));const v=(w,E,C)=>{if(l!=null)if(E.push(w),p!=null)i.elevatedLayoutVertexArray.emplaceBack(p),C.push(p);else{const z=l.elevationSampler.pointElevation(w,l.elevation,l.bias);i.elevatedLayoutVertexArray.emplaceBack(z),C.push(z),u=Math.min(u,z),f=Math.max(f,z)}};for(const w of e){let E=0;for(const he of w)E+=he.length;const C=i.triangleSegments.prepareSegment(E,i.layoutVertexArray,i.indexArray),z=C.vertexLength,L=[],N=[],U=[],X=[],J=[],Q=i.layoutVertexArray.length;for(const he of w){if(he.length===0)continue;he!==w[0]&&N.push(L.length/2);const ge=i.lineSegments.prepareSegment(he.length,i.layoutVertexArray,i.lineIndexArray),Le=ge.vertexLength;l&&J.push(i.layoutVertexArray.length-Q),v(he[0],U,X),i.layoutVertexArray.emplaceBack(he[0].x,he[0].y),i.lineIndexArray.emplaceBack(Le+he.length-1,Le),L.push(he[0].x),L.push(he[0].y);for(let Oe=1;Oe<he.length;Oe++)v(he[Oe],U,X),i.layoutVertexArray.emplaceBack(he[Oe].x,he[Oe].y),i.lineIndexArray.emplaceBack(Le+Oe-1,Le+Oe),L.push(he[Oe].x),L.push(he[Oe].y);ge.vertexLength+=he.length,ge.primitiveLength+=he.length}const le=If(L,N);for(let he=0;he<le.length;he+=3)i.indexArray.emplaceBack(z+le[he],z+le[he+1],z+le[he+2]);if(le.length>0&&l&&this.elevationMode==="hd-road-base"){const he=l.elevation.isTunnel(),ge=l.elevation.safeArea,Le=this.elevatedStructures.addVertices(U,X);this.elevatedStructures.addTriangles(le,Le,he);const Oe=J.length;if(Oe>0){for(let Ve=0;Ve<Oe-1;Ve++)this.elevatedStructures.addRenderableRing(l.index,J[Ve]+Le,J[Ve+1]-J[Ve],he,ge,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,J[Oe-1]+Le,U.length-J[Oe-1],he,ge,l.featureInfo)}}C.vertexLength+=E,C.primitiveLength+=le.length/3}return[u,f]}prepareElevatedPolygons(e,i,l){const u=1/$e(l),f=[];for(const p of e){const v=jL(p,new Yi(i,u));f.push(...v)}return f}clipPolygonsToTile(e,i){const l=-i,u=-i,f=Yt+i,p=Yt+i;let v=0;const w=[],E=[];for(;v<e.length;v++){const L=e[v],N=Pd(L);(N.min.x>=l&&N.max.x<=f&&N.min.y>=u&&N.max.y<=p?w:E).push(L)}if(w.length===e.length)return e;const C=[new Mt(l,u),new Mt(f,u),new Mt(f,p),new Mt(l,p),new Mt(l,u)],z=w;for(const L of E)z.push(...UL(L,C));return z}}let YS,KS,JS,QS;ln(p1,"FillBucket",{omit:["layers","patternFeatures"]}),ln(f1,"FillBufferData"),ln(Zs,"ElevatedStructures");class zy{constructor(e,i,l,u){if(this.triangleCount=i.length/3,this.min=new Mt(0,0),this.max=new Mt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[f,p]=[e[0].clone(),e[0].clone()];for(let z=1;z<e.length;++z){const L=e[z];f.x=Math.min(f.x,L.x),f.y=Math.min(f.y,L.y),p.x=Math.max(p.x,L.x),p.y=Math.max(p.y,L.y)}if(u){const z=Math.ceil(Math.max(p.x-f.x,p.y-f.y)/u);l=Math.max(l,z)}if(l===0)return;this.min=f,this.max=p;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const w=Math.max(v.x,v.y)/l;this.cellsX=Math.max(1,Math.ceil(v.x/w)),this.cellsY=Math.max(1,Math.ceil(v.y/w)),this.xScale=1/w,this.yScale=1/w;const E=[];for(let z=0;z<this.triangleCount;z++){const L=e[i[3*z+0]].sub(this.min),N=e[i[3*z+1]].sub(this.min),U=e[i[3*z+2]].sub(this.min),X=Zl(Math.floor(Math.min(L.x,N.x,U.x)),this.xScale,this.cellsX),J=Zl(Math.floor(Math.max(L.x,N.x,U.x)),this.xScale,this.cellsX),Q=Zl(Math.floor(Math.min(L.y,N.y,U.y)),this.yScale,this.cellsY),le=Zl(Math.floor(Math.max(L.y,N.y,U.y)),this.yScale,this.cellsY),he=new Mt(0,0),ge=new Mt(0,0),Le=new Mt(0,0),Oe=new Mt(0,0);for(let Ve=Q;Ve<=le;++Ve){he.y=ge.y=Ve*w,Le.y=Oe.y=(Ve+1)*w;for(let We=X;We<=J;++We)he.x=Le.x=We*w,ge.x=Oe.x=(We+1)*w,(nl(L,N,U,he,ge,Oe)||nl(L,N,U,he,Oe,Le))&&E.push({cellIdx:Ve*this.cellsX+We,triIdx:z})}}if(E.length===0)return;E.sort(((z,L)=>z.cellIdx-L.cellIdx||z.triIdx-L.triIdx));let C=0;for(;C<E.length;){const z=E[C].cellIdx,L={start:this.payload.length,len:0};for(;C<E.length&&E[C].cellIdx===z;)++L.len,this.payload.push(E[C++].triIdx);this.cells[z]=L}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=Zl(e.x-this.min.x,this.xScale,this.cellsX),u=Zl(e.y-this.min.y,this.yScale,this.cellsY),f=this.cells[u*this.cellsX+l];if(f){this._lazyInitLookup();for(let p=0;p<f.len;p++){const v=this.payload[f.start+p],w=Math.floor(v/8),E=1<<v%8;if(!(this.lookup[w]&E)&&(this.lookup[w]|=E,i.push(v),i.length===this.triangleCount))return}}}query(e,i,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const u=Zl(e.x-this.min.x,this.xScale,this.cellsX),f=Zl(i.x-this.min.x,this.xScale,this.cellsX),p=Zl(e.y-this.min.y,this.yScale,this.cellsY),v=Zl(i.y-this.min.y,this.yScale,this.cellsY);for(let w=p;w<=v;w++)for(let E=u;E<=f;E++){const C=this.cells[w*this.cellsX+E];if(C)for(let z=0;z<C.len;z++){const L=this.payload[C.start+z],N=Math.floor(L/8),U=1<<L%8;if(!(this.lookup[N]&U)&&(this.lookup[N]|=U,l.push(L),l.length===this.triangleCount))return}}}}function Zl(o,e,i){return Math.max(0,Math.min(i-1,Math.floor(o*e)))}ln(zy,"TriangleGridIndex");class $S{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const l of this.footprints)i.push({footprint:l,id:e})}populate(e,i,l,u){const f=[];for(const{feature:p,id:v,index:w,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,z=Vt(p,C);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom,{worldview:this.worldview}),z,l))continue;const L={id:v,properties:p.properties,type:p.type,sourceLayerIndex:E,index:w,geometry:C?z.geometry:nn(p,l,u),patterns:{}};f.push(L)}for(const p of f){const{geometry:v,index:w,sourceLayerIndex:E}=p;this.addFeature(p,v,w,l,{},i.availableImages,i.brightness),i.featureIndex.insert(e[w].feature,v,w,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,l,u,f,p,v){}destroy(){}addFeature(e,i,l,u,f,p=[],v){for(const w of qm(i,2)){const E=[],C=[],z=[],L=new Mt(1/0,1/0),N=new Mt(-1/0,-1/0);for(const J of w)if(J.length!==0){J!==w[0]&&z.push(C.length/2);for(let Q=0;Q<J.length;Q++)C.push(J[Q].x),C.push(J[Q].y),E.push(J[Q]),L.x=Math.min(L.x,J[Q].x),L.y=Math.min(L.y,J[Q].y),N.x=Math.max(N.x,J[Q].x),N.y=Math.max(N.y,J[Q].y)}const U=If(C,z),X=new zy(E,U,8,256);this.footprints.push({vertices:E,indices:U,grid:X,min:L,max:N})}}}ln($S,"ClipBucket",{omit:["layers"]});const GL=xi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),WL=xi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),qL=xi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),HL=xi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),ZL=xi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),XL=xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:YL}=GL,Hm=Number.MAX_SAFE_INTEGER,eE=Hm-1;function tE(o,e,i,l){return o.order<e||o.order===Hm||!(o.clipMask&i)||(function(u,f){return f.length!==0&&f.find((p=>p===u))===void 0})(l,o.clipScope)}function Dy(o,e){return o.x-e.x||o.y-e.y}function nE(o,e){return Dy(o.min,e.min)===0&&Dy(o.max,e.max)===0}function m1(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function Ly(o,e){if(o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(o[i].sourceId!==e[i].sourceId||!nE(o[i],e[i])||o[i].order!==e[i].order||o[i].clipMask!==e[i].clipMask||!fo(o[i].clipScope,e[i].clipScope))return!1;return!0}function iE(o,e,i){const l=1/Yt,u=1/(1<<i.canonical.z),f=(e.x*l+i.canonical.x)*u+i.wrap,p=(e.y*l+i.canonical.y)*u;return{min:new Mt((o.x*l+i.canonical.x)*u+i.wrap,(o.y*l+i.canonical.y)*u),max:new Mt(f,p)}}function KL(o,e,i){const l=1<<i.canonical.z,u=((e.x-i.wrap)*l-i.canonical.x)*Yt,f=(e.y*l-i.canonical.y)*Yt;return{min:new Mt(((o.x-i.wrap)*l-i.canonical.x)*Yt,(o.y*l-i.canonical.y)*Yt),max:new Mt(u,f)}}function g1(o,e,i,l,u,f,p){const v=o.indices,w=o.vertices,E=[];for(let C=l;C<l+u;C+=3){const z=e[i[C+0]+f],L=e[i[C+1]+f],N=e[i[C+2]+f],U=Math.min(z.x,L.x,N.x),X=Math.max(z.x,L.x,N.x),J=Math.min(z.y,L.y,N.y),Q=Math.max(z.y,L.y,N.y);E.length=0,o.grid.query(new Mt(U,J),new Mt(X,Q),E);for(let le=0;le<E.length;le++){const he=E[le];if(nl(w[v[3*he+0]],w[v[3*he+1]],w[v[3*he+2]],z,L,N,p))return!0}}return!1}function rE(o,e,i,l){if(!o||!i)return!1;let u=o.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(i.vertices.length<o.vertices.length)return rE(i,l,o,e);const f=e.canonical,p=l.canonical,v=Math.pow(2,p.z-f.z);u=o.vertices.map((w=>new Mt((w.x+f.x*Yt)*v-p.x*Yt,(w.y+f.y*Yt)*v-p.y*Yt)))}return g1(i,u,o.indices,0,o.indices.length,0,0)}function oE(o,e,i,l){const u=Math.pow(2,l.z-i.z);return new Mt((o+i.x*Yt)*u-l.x*Yt,(e+i.y*Yt)*u-l.y*Yt)}function _1(o,e){const i=[];e.grid.queryPoint(o,i);const l=e.indices,u=e.vertices;for(let f=0;f<i.length;f++){const p=i[f];if(zo([u[l[3*p+0]],u[l[3*p+1]],u[l[3*p+2]]],o))return!0}return!1}const y1=[new Mt(0,0),new Mt(Yt,0),new Mt(Yt,Yt),new Mt(0,Yt)];function sE(o,e){const i=[];let l=[];if(!e||o.length<2)return[o];if(o.length===2)return Ko(o[0],o[1],y1)?[o]:[];for(let u=0;u<o.length+2;u++){const f=o[u%o.length],p=o[(u+1)%o.length],v=Ko(u===0?o[o.length-1]:o[(u-1)%o.length],f,y1),w=Ko(f,p,y1),E=v||w;E&&l.push(f),E&&w||l.length>0&&(l.length>1&&i.push(l),l=[])}return l.length>1&&i.push(l),i}const v1=Ot.types,JL=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],QL=["fill-extrusion-flood-light-ground-radius"],$L=Math.pow(2,13),e3=Math.pow(2,15)-1,aE=new Mt(0,1),Du=2147483648;function Zm(o,e,i,l,u,f,p,v){o.emplaceBack((e<<1)+p,(i<<1)+f,(Math.floor(l*$L)<<1)+u,Math.round(v))}function Xm(o,e,i){o.emplaceBack(e.x*Yt,e.y*Yt,i?1:0)}function Oy(o,e,i,l,u,f){o.emplaceBack(e.x,e.y,(i.x<<1)+l,(i.y<<1)+u,f)}function Ym(o,e,i){o.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class lE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cE{constructor(){this.centroidXY=new Mt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Mt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Mt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Mt(this.max.x-this.min.x,this.max.y-this.min.y)}}class uE{constructor(){this.acc=new Mt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,l){this.accCount++,this.acc._add(i);let u=!!this.borders;i.x<e.min.x?(e.min.x=i.x,u=!0):i.x>e.max.x&&(e.max.x=i.x,u=!0),i.y<e.min.y?(e.min.y=i.y,u=!0):i.y>e.max.y&&(e.max.y=i.y,u=!0),((i.x===0||i.x===Yt)&&i.x===l.x)!=((i.y===0||i.y===Yt)&&i.y===l.y)&&this.processBorderOverlap(i,l),u&&this.checkBorderIntersection(i,l)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Rn(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Yt!=e.x>Yt&&this.addBorderIntersection(1,Rn(i.y,e.y,(Yt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Rn(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Yt!=e.y>Yt&&this.addBorderIntersection(3,Rn(i.x,e.x,(Yt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new Mt(0,0):new Mt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function hE(o,e){const i=o.add(e)._unit(),l=Pe(o.x*i.x+o.y*i.y,-1,1);var u,f,p;return u=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(u)))/4*e3*((f=o).x*(p=e).y-f.y*p.x<0?-1:1)}const t3=[o=>o.x<0,o=>o.x>Yt,o=>o.y<0,o=>o.y>Yt];function n3(o,e,i,l){const u=[4];if(l===0)return u;i._mult(l);const f=o.sub(i),p=e.sub(i),v=[o,e,f,p];for(let w=0;w<4;w++)for(const E of v)if(t3[w](E)){u.push(w);break}return u}class x1{constructor(e){this.vertexArray=new Im,this.indexArray=new Eo,this.programConfigurations=new wa(e.layers,{zoom:e.zoom,lut:e.lut},(i=>QL.includes(i))),this._segments=new Fr,this.hiddenByLandmarkVertexArray=new bf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Fr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,l,u=!1){const f=e.length;if(f>2){let p=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let w;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const E=e[0],C=e[1];w=hE(E.sub(e[f-1])._perp()._unit(),C.sub(E)._perp()._unit())}for(let E=0;E<f;E++){const C=E===f-1?0:E+1,z=e[E],L=e[C],N=e[C===f-1?0:C+1],U=L.sub(z)._perp()._unit(),X=hE(U,N.sub(L)._perp()._unit()),J=w,Q=X;if(b1(z,L,i)||u&&pE(z,i)&&pE(L,i)){w=X;continue}const le=v.vertexLength;Oy(this.vertexArray,z,L,1,1,J),Oy(this.vertexArray,z,L,1,0,J),Oy(this.vertexArray,z,L,0,1,Q),Oy(this.vertexArray,z,L,0,0,Q),v.vertexLength+=4;const he=n3(z,L,U,l);for(const ge of he)this._segmentToGroundQuads[p].push({id:le,region:ge}),this._segmentToRegionTriCounts[p][ge]+=2,v.primitiveLength+=2;w=X}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let l=0;l<i;l++)this._segmentToGroundQuads[l].sort(((u,f)=>u.region-f.region));for(let l=0;l<i;l++){const u=this._segmentToGroundQuads[l],f=e[l],p=this._segmentToRegionTriCounts[l];p.reduce(((w,E)=>w+E),0);let v=0;for(let w=0;w<=4;w++){const E=p[w];if(E!==0){let C=this.regionSegments[w];C||(C=this.regionSegments[w]=new Fr);const z={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+v,vertexLength:f.vertexLength,primitiveLength:E};C.get().push(z)}v+=E}for(let w=0;w<u.length;w++){const E=u[w].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,l,u,f,p,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,l,u,f,p,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,WL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,l,u,f,p,v,w){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,l,u,f,p,v,w)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Du))}updateHiddenByLandmarkRange(e,i,l){if(!this.hasData())return;const u=i+e;if(i!==0){for(let f=e;f<u;++f)this.hiddenByLandmarkVertexArray.emplace(f,l?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,ZL.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Fy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Eo,this.footprintVertices=new Vl,this.footprintSegments=[],this.layoutVertexArray=new Mc,this.centroidVertexArray=new xy,this.wallVertexArray=new wy,this.indexArray=new Eo,this.programConfigurations=new wa(e.layers,{zoom:e.zoom,lut:e.lut},(i=>JL.includes(i))),this.segments=new Fr,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new x1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,u){this.features=[],this.hasPattern=u1("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=$e(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:p,index:v,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,C=Vt(f,E);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom,{worldview:this.worldview}),C,l))continue;const z={id:p,sourceLayerIndex:w,index:v,geometry:E?C.geometry:nn(f,l,u),properties:f.properties,type:f.type,patterns:{}},L=this.layoutVertexArray.length,N=v1[z.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:f.id,feature:h1("fill-extrusion",this.layers,z,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const U of z.geometry)for(const X of sE(U,N))this.addFeature(f.id,z,[X],v,l,{},i.availableImages,u,i.brightness);else this.addFeature(f.id,z,z.geometry,v,l,{},i.availableImages,u,i.brightness);i.featureIndex.insert(f,z.geometry,v,w,this.index,L)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,l,u,f,p){for(const{featureId:v,feature:w}of this.features){const E=v1[w.type]==="Polygon",{geometry:C}=w;if(this.wallMode)for(const z of C)for(const L of sE(z,E))this.addFeature(v,w,[L],w.index,i,l,u,f,p);else this.addFeature(v,w,C,w.index,i,l,u,f,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,l,u,f,p,v){this.programConfigurations.updatePaintArrays(e,i,f,l,u,p,v,this.worldview),this.groundEffect.update(e,i,f,l,u,p,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,YL),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,HL.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,XL.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,qL.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,l,u,f,p,v,w,E){const C=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,z=[new Mt(0,0),new Mt(Yt,Yt)],L=w.projection,N=L.name==="globe",U=this.wallMode||v1[i.type]==="Polygon",X=new uE;X.centroidDataIndex=this.centroidData.length;const J=new cE;J.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(J.buildingId=i.properties.building_id);const Q=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},f)<=0,le=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},f);let he;if(J.height=le,J.vertexArrayOffset=this.layoutVertexArray.length,J.groundVertexArrayOffset=this.groundEffect.vertexArray.length,N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new gf),this.wallMode){if(N)return void oi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;he=(function(Ke){const Et=Ke[0].x===Ke[Ke.length-1].x&&Ke[0].y===Ke[Ke.length-1].y;(function(Xt){let xn=0;const Zn=Xt.length;for(let en=0;en<Zn;en++)xn+=(Xt[(en+1)%Zn].x-Xt[en].x)*(Xt[(en+1)%Zn].y+Xt[en].y);return xn>=0})(Ke)||(Ke=Ke.reverse());const It={geometry:[],joinNormals:[],indices:[]},Pt=[],Ut=[],bt=[];let kt=Ke.length;for(;kt>=2&&Ke[kt-1].equals(Ke[kt-2]);)kt--;if(kt<(Et?3:2))return It;let dt,lt,jt,Nt,wn,sn=0;for(;sn<kt-1&&Ke[sn].equals(Ke[sn+1]);)sn++;Et&&(dt=Ke[kt-2],wn=Ke[sn].sub(dt)._unit()._perp());for(let Xt=sn;Xt<kt;Xt++){if(jt=Xt===kt-1?Et?Ke[sn+1]:void 0:Ke[Xt+1],jt&&Ke[Xt].equals(jt))continue;wn&&(Nt=wn),dt&&(lt=dt),dt=Ke[Xt],wn=jt?jt.sub(dt)._unit()._perp():Nt,Nt=Nt||wn;let xn=Nt.add(wn);xn.x===0&&xn.y===0||xn._unit();const Zn=xn.x*wn.x+xn.y*wn.y,en=Zn!==0?1/Zn:1/0,_n=Nt.x*wn.y-Nt.y*wn.x>0;let zn="miter";const $n=2;zn==="miter"&&en>$n&&(zn="bevel"),zn==="bevel"&&(en>100&&(zn="flipbevel"),en<$n&&(zn="miter"));const di=(ni,hn,ei,Ti)=>{const ve=new Mt(ni.x,ni.y),be=new Mt(ni.x,ni.y);ve.x+=hn.x*Ti,ve.y+=hn.y*Ti,be.x-=hn.x*Math.max(ei,1),be.y-=hn.y*Math.max(ei,1),bt.push(hn),Pt.push(ve),Ut.push(be)};if(zn==="miter")xn._mult(en),di(dt,xn,0,0);else if(zn==="flipbevel")xn=wn.mult(-1),di(dt,xn,0,0),di(dt,xn.mult(-1),0,0);else{const ni=-Math.sqrt(en*en-1),hn=_n?ni:0,ei=_n?0:ni;lt&&di(dt,Nt,hn,ei),jt&&di(dt,wn,hn,ei)}}It.geometry=[...Pt,...Ut.reverse(),Pt[0]],It.joinNormals=[...bt,...bt.reverse(),bt[bt.length-1]];const pn=It.geometry.length-1;for(let Xt=0;Xt<pn/2;Xt++)if(Xt+1<pn/2){let xn=Xt,Zn=Xt+1,en=pn-1-Xt,_n=pn-2-Xt;xn=xn===0?pn-1:xn-1,Zn=Zn===0?pn-1:Zn-1,en=en===0?pn-1:en-1,_n=_n===0?pn-1:_n-1,It.indices.push(en),It.indices.push(Zn),It.indices.push(xn),It.indices.push(en),It.indices.push(_n),It.indices.push(Zn)}return It})(l[0]),l=[he.geometry]}const ge=(Ke,Et)=>Ke<(Et.length-1)/2||Ke===Et.length-1,Le=this.wallMode?[l]:qm(l,500);for(let Ke=Le.length-1;Ke>=0;Ke--){const Et=Le[Ke];(Et.length===0||(Oe=Et[0]).every((Ft=>Ft.x<=0))||Oe.every((Ft=>Ft.x>=Yt))||Oe.every((Ft=>Ft.y<=0))||Oe.every((Ft=>Ft.y>=Yt)))&&Le.splice(Ke,1)}var Oe;let Ve;if(N)Ve=yE(Le,z,f);else{Ve=[];for(const Ke of Le)Ve.push({polygon:Ke,bounds:z})}const We=U?this.edgeRadius:0,He=We>0&&this.zoom<17,Tt=(Ke,Et)=>{if(Ke.length===0)return!1;const Ft=Ke[Ke.length-1];return Et.x===Ft.x&&Et.y===Ft.y};for(const{polygon:Ke,bounds:Et}of Ve){let Ft=0,It=0;for(const kt of Ke)U&&!kt[0].equals(kt[kt.length-1])&&kt.push(kt[0]),It+=U?kt.length-1:kt.length;const Pt=this.segments.prepareSegment((U?5:4)*It,this.layoutVertexArray,this.indexArray);J.footprintSegIdx<0&&(J.footprintSegIdx=this.footprintSegments.length),J.polygonSegIdx<0&&(J.polygonSegIdx=this.polygonSegments.length);const Ut={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},bt=new lE;if(bt.vertexOffset=this.footprintVertices.length,bt.indexOffset=3*this.footprintIndices.length,bt.ringIndices=[],U){const kt=[],dt=[];Ft=Pt.vertexLength;for(let jt=0;jt<Ke.length;jt++){const Nt=Ke[jt];Nt.length&&jt!==0&&dt.push(kt.length/2);const wn=[];let sn,pn;sn=Nt[1].sub(Nt[0])._perp()._unit(),bt.ringIndices.push(Nt.length-1);for(let Xt=1;Xt<Nt.length;Xt++){const xn=Nt[Xt],Zn=Nt[Xt===Nt.length-1?1:Xt+1],en=xn.clone();if(We){pn=Zn.sub(xn)._perp()._unit();const _n=sn.add(pn)._unit(),zn=We*Math.min(4,1/(sn.x*_n.x+sn.y*_n.y));en.x+=zn*_n.x,en.y+=zn*_n.y,en.x=Math.round(en.x),en.y=Math.round(en.y),sn=pn}if(!Q||We!==0&&!He||Tt(wn,en)||wn.push(en),Zm(this.layoutVertexArray,en.x,en.y,0,0,1,1,0),this.wallMode){const _n=ge(Xt,Nt);Xm(this.wallVertexArray,he.joinNormals[Xt],!_n)}Pt.vertexLength++,this.footprintVertices.emplaceBack(xn.x,xn.y),kt.push(xn.x,xn.y),N&&Ym(this.layoutVertexExtArray,L.projectTilePoint(en.x,en.y,f),L.upVector(f,en.x,en.y))}Q&&(We===0||He)&&(wn.length!==0&&Tt(wn,wn[0])&&wn.pop(),this.groundEffect.addData(wn,Et,C))}const lt=this.wallMode?he.indices:If(kt,dt);for(let jt=0;jt<lt.length;jt+=3)this.footprintIndices.emplaceBack(bt.vertexOffset+lt[jt+0],bt.vertexOffset+lt[jt+1],bt.vertexOffset+lt[jt+2]),this.indexArray.emplaceBack(Ft+lt[jt],Ft+lt[jt+2],Ft+lt[jt+1]),Pt.primitiveLength++;bt.indexCount+=lt.length,bt.vertexCount+=this.footprintVertices.length-bt.vertexOffset}for(let kt=0;kt<Ke.length;kt++){const dt=Ke[kt];X.startRing(J,dt[0]);let lt=dt.length>4&&mE(dt[dt.length-2],dt[0],dt[1]),jt=We?i3(dt[dt.length-2],dt[0],dt[1],We):0;const Nt=[];let wn,sn,pn;sn=dt[1].sub(dt[0])._perp()._unit();let Xt=!0;for(let xn=1,Zn=0;xn<dt.length;xn++){let en=dt[xn-1],_n=dt[xn];const zn=dt[xn===dt.length-1?1:xn+1];if(X.appendEdge(J,_n,en),b1(_n,en,Et)){We&&(sn=zn.sub(_n)._perp()._unit(),Xt=!Xt);continue}const $n=_n.sub(en)._perp(),di=$n.x/(Math.abs($n.x)+Math.abs($n.y)),ni=$n.y>0?1:0,hn=en.dist(_n);if(Zn+hn>32768&&(Zn=0),We){pn=zn.sub(_n)._perp()._unit();let be=fE(en,_n,zn,dE(sn,pn),We);isNaN(be)&&(be=0);const ht=_n.sub(en)._unit();en=en.add(ht.mult(jt))._round(),_n=_n.add(ht.mult(-be))._round(),jt=be,sn=pn,Q&&this.zoom>=17&&(Tt(Nt,en)||Nt.push(en),Tt(Nt,_n)||Nt.push(_n))}const ei=Pt.vertexLength,Ti=dt.length>4&&mE(en,_n,zn);let ve=gE(Zn,lt,Xt);if(Zm(this.layoutVertexArray,en.x,en.y,di,ni,0,0,ve),Zm(this.layoutVertexArray,en.x,en.y,di,ni,0,1,ve),this.wallMode){const be=ge(xn-1,dt),ht=he.joinNormals[xn-1];Xm(this.wallVertexArray,ht,be),Xm(this.wallVertexArray,ht,be)}if(Zn+=hn,ve=gE(Zn,Ti,!Xt),lt=Ti,Zm(this.layoutVertexArray,_n.x,_n.y,di,ni,0,0,ve),Zm(this.layoutVertexArray,_n.x,_n.y,di,ni,0,1,ve),this.wallMode){const be=ge(xn,dt),ht=he.joinNormals[xn];Xm(this.wallVertexArray,ht,be),Xm(this.wallVertexArray,ht,be)}if(Pt.vertexLength+=4,this.indexArray.emplaceBack(ei+0,ei+1,ei+2),this.indexArray.emplaceBack(ei+1,ei+3,ei+2),Pt.primitiveLength+=2,We){const be=Ft+(xn===1?dt.length-2:xn-2),ht=xn===1?Ft:be+1;if(this.indexArray.emplaceBack(ei+1,be,ei+3),this.indexArray.emplaceBack(be,ht,ei+3),Pt.primitiveLength+=2,wn===void 0&&(wn=ei),!b1(zn,dt[xn],Et)){const wt=xn===dt.length-1?wn:Pt.vertexLength;this.indexArray.emplaceBack(ei+2,ei+3,wt),this.indexArray.emplaceBack(ei+3,wt+1,wt),this.indexArray.emplaceBack(ei+3,ht,wt+1),Pt.primitiveLength+=3}Xt=!Xt}if(N){const be=this.layoutVertexExtArray,ht=L.projectTilePoint(en.x,en.y,f),wt=L.projectTilePoint(_n.x,_n.y,f),$t=L.upVector(f,en.x,en.y),Qt=L.upVector(f,_n.x,_n.y);Ym(be,ht,$t),Ym(be,ht,$t),Ym(be,wt,Qt),Ym(be,wt,Qt)}}U&&(Ft+=dt.length-1),Q&&We&&this.zoom>=17&&(Nt.length!==0&&Tt(Nt,Nt[0])&&Nt.pop(),this.groundEffect.addData(Nt,Et,C,We>0))}this.footprintSegments.push(bt),Ut.triangleCount=this.indexArray.length-Ut.triangleArrayOffset,this.polygonSegments.push(Ut),++J.footprintSegLen,++J.polygonSegLen}if(J.vertexCount=this.layoutVertexArray.length-J.vertexArrayOffset,J.groundVertexCount=this.groundEffect.vertexArray.length-J.groundVertexArrayOffset,J.vertexCount!==0){if(J.centroidXY=X.borders?aE:this.encodeCentroid(X,J),this.centroidData.push(J),X.borders){this.featuresOnBorder.push(X);const Ke=this.featuresOnBorder.length-1;for(let Et=0;Et<X.borders.length;Et++)X.borders[Et][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Et].push(Ke)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,p,v,f,E,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,u,p,v,f,E,this.worldview),this.maxHeight=Math.max(this.maxHeight,le)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,l)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[l].borders[e][0]))}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const w=this.centroidData[v],E=+(w.min.y+w.max.y>Yt),C=2*E+(+(w.min.x+w.max.x>Yt)^E);for(let z=0;z<w.polygonSegLen;z++){const L=w.polygonSegIdx+z;e.push({centroidIdx:v,subtile:C,polygonSegmentIdx:L,triangleSegmentIdx:this.polygonSegments[L].triangleSegIdx})}}const i=new Eo;e.sort(((v,w)=>v.triangleSegmentIdx===w.triangleSegmentIdx?v.subtile-w.subtile:v.triangleSegmentIdx-w.triangleSegmentIdx));let l=0,u=0,f=0;for(const v of e){if(v.triangleSegmentIdx!==l)break;f++}const p=e.length;for(;u!==e.length;){l=e[u].triangleSegmentIdx;let v=0,w=u,E=u;for(let C=w;C<f&&e[C].subtile===v;C++)E++;for(;w!==f;){const C=e[w];v=C.subtile;const z=this.centroidData[C.centroidIdx].min.clone(),L=this.centroidData[C.centroidIdx].max.clone(),N={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let U=w;U<E;U++){const X=e[U],J=this.polygonSegments[X.polygonSegmentIdx],Q=this.centroidData[X.centroidIdx].min,le=this.centroidData[X.centroidIdx].max,he=this.indexArray.uint16;for(let ge=J.triangleArrayOffset;ge<J.triangleArrayOffset+J.triangleCount;ge++)i.emplaceBack(he[3*ge],he[3*ge+1],he[3*ge+2]);N.primitiveLength+=J.triangleCount,z.x=Math.min(z.x,Q.x),z.y=Math.min(z.y,Q.y),L.x=Math.max(L.x,le.x),L.y=Math.max(L.y,le.y)}N.primitiveLength>0&&this.triangleSubSegments.push({segment:N,min:z,max:L}),w=E;for(let U=w;U<f&&e[U].subtile===e[w].subtile;U++)E++}u=f;for(let C=u;C<p&&e[C].triangleSegmentIdx===e[u].triangleSegmentIdx;C++)f++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,l){const u=new Fr;if(this.wallMode){for(const X of this.triangleSubSegments)u.segments.push(X.segment);return u}let f=0,p=0;const v=1<<e.canonical.z;if(i){const X=i.getMinMaxForTile(e);X&&(f=X.min,p=X.max)}p+=this.maxHeight;const w=e.toUnwrapped();let E;const C=[w.canonical.x/v+w.wrap,w.canonical.y/v],z=[(w.canonical.x+1)/v+w.wrap,(w.canonical.y+1)/v],L=(X,J,Q)=>[X[0]*(1-Q[0])+J[0]*Q[0],X[1]*(1-Q[1])+J[1]*Q[1]],N=[],U=[];for(const X of this.triangleSubSegments){N[0]=X.min.x/Yt,N[1]=X.min.y/Yt,U[0]=X.max.x/Yt,U[1]=X.max.y/Yt;const J=L(C,z,N),Q=L(C,z,U);if(new Fn([J[0],J[1],f],[Q[0],Q[1],p]).intersectsPrecise(l)===0){E&&(u.segments.push(E),E=void 0);continue}const le=X.segment;E&&E.vertexOffset!==le.vertexOffset&&(u.segments.push(E),E=void 0),E?(E.vertexLength+=le.vertexLength,E.primitiveLength+=le.primitiveLength):E={vertexOffset:le.vertexOffset,primitiveLength:le.primitiveLength,vertexLength:le.vertexLength,primitiveOffset:le.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&u.segments.push(E),u}encodeCentroid(e,i){const l=e.centroid(),u=i.span(),f=Math.min(7,Math.round(u.x*this.tileToMeter/10)),p=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Mt(Pe(l.x,1,Yt-1)<<3|f,Pe(l.y,1,Yt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new Mt(0,0);const i=e.borders,l=Number.MAX_VALUE;if(i[0][0]!==l||i[1][0]!==l){const u=i[0][0]!==l?0:1;return new Mt(6|(i[0][0]!==l?0:65528),(i[u][0]+i[u][1])/2<<3|6)}{const u=i[2][0]!==l?2:3;return new Mt((i[u][0]+i[u][1])/2<<3|6,6|(i[2][0]!==l?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,u=e.flags&Du?aE:e.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==u.y||f!==u.x){for(let p=i;p<l;++p)this.centroidVertexArray.emplace(p,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,l){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(Ly(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const p of this.centroidData)p.flags&=2147483647;const f=[];for(const p of this.activeReplacements){if(p.order<l)continue;const v=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));if(p.footprint.buildingId){const w=p.footprint.buildingId;for(const E of this.centroidData)E.buildingId===w&&(E.flags|=Du)}else for(const w of this.centroidData)if(!(w.flags&Du||p.min.x>w.max.x||w.min.x>p.max.x||p.min.y>w.max.y||w.min.y>p.max.y))for(let E=0;E<w.footprintSegLen;E++){const C=this.footprintSegments[w.footprintSegIdx+E];if(f.length=0,r3(this.footprintVertices,C.vertexOffset,C.vertexCount,p.footprintTileId.canonical,e.canonical,f),g1(p.footprint,f,this.footprintIndices.uint16,C.indexOffset,C.indexCount,-C.vertexOffset,-v)){w.flags|=Du;break}}}for(const p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,l){let u=!1;for(let f=0;f<l.footprintSegLen;f++){const p=this.footprintSegments[l.footprintSegIdx+f];let v=0;for(const w of p.ringIndices){for(let E=v,C=w+v-1;E<w+v;C=E++){const z=this.footprintVertices.int16[2*(E+p.vertexOffset)+0],L=this.footprintVertices.int16[2*(E+p.vertexOffset)+1],N=this.footprintVertices.int16[2*(C+p.vertexOffset)+1];L>i!=N>i&&e<(this.footprintVertices.int16[2*(C+p.vertexOffset)+0]-z)*(i-L)/(N-L)+z&&(u=!u)}v=w}}return u}getHeightAtTileCoord(e,i){let l=Number.NEGATIVE_INFINITY,u=!0;const f=4*(e+Yt)*Yt+(i+Yt);if(this.partLookup.hasOwnProperty(f)){const p=this.partLookup[f];return p?{height:p.height,hidden:!!(p.flags&Du)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||p.height<=l||this.footprintContainsPoint(e,i,p)&&(l=p.height,this.partLookup[f]=p,u=!!(p.flags&Du));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.partLookup[f]=void 0}}function dE(o,e){const i=o.add(e)._unit();return o.x*i.x+o.y*i.y}function i3(o,e,i,l){const u=e.sub(o)._perp()._unit(),f=i.sub(e)._perp()._unit();return fE(o,e,i,dE(u,f),l)}function fE(o,e,i,l,u){const f=Math.sqrt(1-l*l);return Math.min(o.dist(e)/3,e.dist(i)/3,u*f/l)}function b1(o,e,i){return o.x<i[0].x&&e.x<i[0].x||o.x>i[1].x&&e.x>i[1].x||o.y<i[0].y&&e.y<i[0].y||o.y>i[1].y&&e.y>i[1].y}function pE(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function mE(o,e,i){if(o.x<0||o.x>=Yt||e.x<0||e.x>=Yt||i.x<0||i.x>=Yt)return!1;const l=i.sub(e),u=l.perp(),f=o.sub(e);return(l.x*f.x+l.y*f.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function gE(o,e,i){const l=e?2|o:-3&o;return i?1|l:-2&l}function _E(){const o=Math.PI/32,e=Math.tan(o),i=q;return i*Math.sqrt(1+2*e*e)-i}function yE(o,e,i){const l=1<<i.z,u=ke(i.x/l),f=ke((i.x+1)/l),p=Me(i.y/l),v=Me((i.y+1)/l);return(function(w,E,C,z,L=0,N){const U=[];if(!w.length||!C||!z)return U;const X=(Oe,Ve)=>{for(const We of Oe)U.push({polygon:We,bounds:Ve})},J=Math.ceil(Math.log2(C)),Q=Math.ceil(Math.log2(z)),le=J-Q,he=[];for(let Oe=0;Oe<Math.abs(le);Oe++)he.push(le>0?0:1);for(let Oe=0;Oe<Math.min(J,Q);Oe++)he.push(0),he.push(1);let ge=w;if(ge=Ry(ge,E[0].y-L,E[1].y+L,1),ge=Ry(ge,E[0].x-L,E[1].x+L,0),!ge.length)return U;const Le=[];for(he.length?Le.push({polygons:ge,bounds:E,depth:0}):X(ge,E);Le.length;){const Oe=Le.pop(),Ve=Oe.depth,We=he[Ve],He=Oe.bounds[0],Tt=Oe.bounds[1],Ke=We===0?He.x:He.y,Et=We===0?Tt.x:Tt.y,Ft=N?N(We,Ke,Et):.5*(Ke+Et),It=Ry(Oe.polygons,Ke-L,Ft+L,We),Pt=Ry(Oe.polygons,Ft-L,Et+L,We);if(It.length){const Ut=[He,new Mt(We===0?Ft:Tt.x,We===1?Ft:Tt.y)];he.length>Ve+1?Le.push({polygons:It,bounds:Ut,depth:Ve+1}):X(It,Ut)}if(Pt.length){const Ut=[new Mt(We===0?Ft:He.x,We===1?Ft:He.y),Tt];he.length>Ve+1?Le.push({polygons:Pt,bounds:Ut,depth:Ve+1}):X(Pt,Ut)}}return U})(o,e,Math.ceil((f-u)/11.25),Math.ceil((p-v)/11.25),1,((w,E,C)=>{if(w===0)return .5*(E+C);{const z=Me((i.y+E/Yt)/l);return(Ce(.5*(Me((i.y+C/Yt)/l)+z))*l-i.y)*Yt}}))}function r3(o,e,i,l,u,f){const p=Math.pow(2,l.z-u.z);for(let v=0;v<i;v++){let w=o.int16[2*(v+e)+0],E=o.int16[2*(v+e)+1];w=(w+u.x*Yt)*p-l.x*Yt,E=(E+u.y*Yt)*p-l.y*Yt,f.push(new Mt(w,E))}}let vE,xE;ln(Fy,"FillExtrusionBucket",{omit:["layers","features"]}),ln(cE,"PartData"),ln(lE,"FootprintSegment"),ln(uE,"BorderCentroidData"),ln(x1,"GroundEffect");class Vh extends Mt{constructor(e,i,l){super(e,i),this.z=l}}class bE extends Vh{constructor(e,i,l,u){super(e,i,l),this.w=u}}function wE(o,e,i,l){const u=i==="x"?"y":"x",f=(l-o[i])/(e[i]-o[i]);o[u]=Math.round(o[u]+(e[u]-o[u])*f),o[i]=l,o.hasOwnProperty("z")&&(o.z=Rn(o.z,e.z,f)),o.hasOwnProperty("w")&&(o.w=Rn(o.w,e.w,f))}function TE(o,e,i,l){const u=i,f=l;for(const p of["x","y"]){let v=o,w=e;v[p]>=w[p]&&(v=e,w=o),v[p]<u&&w[p]>u&&wE(v,w,p,u),v[p]<f&&w[p]>f&&wE(w,v,p,f)}}function By(o,e,i,l,u,f){const p=[];for(let v=0;v<o.length;v++){const w=o[v];let E;const C=p.length;let z=0;for(let L=0;L<w.length-1;L++){let N=w[L],U=w[L+1],X=0;const J=z;let Q,le;f&&(X=Math.hypot(U.x-N.x,U.y-N.y),z+=X,Q=N,le=U),N.x<e&&U.x<e||(N.x<e?N=new Mt(e,N.y+(e-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x<e&&(U=new Mt(e,N.y+(e-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y<i&&U.y<i||(N.y<i?N=new Mt(N.x+(i-N.y)/(U.y-N.y)*(U.x-N.x),i)._round():U.y<i&&(U=new Mt(N.x+(i-N.y)/(U.y-N.y)*(U.x-N.x),i)._round()),N.x>=l&&U.x>=l||(N.x>=l?N=new Mt(l,N.y+(l-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x>=l&&(U=new Mt(l,N.y+(l-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y>=u&&U.y>=u||(N.y>=u?N=new Mt(N.x+(u-N.y)/(U.y-N.y)*(U.x-N.x),u)._round():U.y>=u&&(U=new Mt(N.x+(u-N.y)/(U.y-N.y)*(U.x-N.x),u)._round()),E&&N.equals(E[E.length-1])||(E=[N],p.push(E),f&&f.push({progress:{min:J+SE(Q,le,N)*X,max:1},parentIndex:v,prevPoint:Q,nextPoint:le})),E.push(U),f&&(f[f.length-1].progress.max=J+SE(Q,le,U)*X,f[f.length-1].nextPoint=le)))))}if(f&&z>0)for(let L=C;L<p.length;L++)f[L].progress.min/=z,f[L].progress.max/=z}return p}function o3(o,e,i,l,u){if(o.length<2)return void l.push(o);const f=[];for(;e.valid();){const[E,C]=e.get();for(let z=0;z<o.length-1;z++){const L=o[z],N=o[z+1],U=Hr(L,N,E,C);if(U){const[X]=U,J=new Mt(Rn(L.x,N.x,X),Rn(L.y,N.y,X));f.push({t:z+X,distance:0,point:J})}}e.next()}if(f.length===0)return void l.push(o);f.sort(((E,C)=>E.t-C.t));let p=0,v=0,w=[];for(l.push(w);p!==o.length;){if(v===f.length){for(;p!==o.length;)w.length!==0&&w[w.length-1].equals(o[p])||w.push(o[p]),p++;break}f[v].t<=p?(w.length!==0&&w[w.length-1].equals(f[v].point)||w.push(f[v].point),Math.trunc(f[v].t),v++):(w.length!==0&&w[w.length-1].equals(o[p])||w.push(o[p]),p++)}}function SE(o,e,i){return o.x!==e.x?(i.x-o.x)/(e.x-o.x):o.y!==e.y?(i.y-o.y)/(e.y-o.y):0}function Km(o,e){return o.x*e.x+o.y*e.y}function EE(o,e){if(o.length===1){let i=0;const l=e[i++];let u;for(;!u||l.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],p=o[0],v=u.sub(l),w=f.sub(l),E=p.sub(l),C=Km(v,v),z=Km(v,w),L=Km(w,w),N=Km(E,v),U=Km(E,w),X=C*L-z*z,J=(L*N-z*U)/X,Q=(C*U-z*N)/X,le=l.z*(1-J-Q)+u.z*J+f.z*Q;if(isFinite(le))return le}return 1/0}{let i=1/0;for(const l of e)i=Math.min(i,l.z);return i}}function AE(o,e,i,l,u,f,p,v){const w=p*u.getElevationAt(o,e,!0,!0),E=f[0]!==0,C=E?f[1]===0?p*(f[0]/7-450):p*(function(z,L,N){const U=Math.floor(L[0]/8),X=Math.floor(L[1]/8),J=10*(L[0]-8*U),Q=10*(L[1]-8*X),le=z.getElevationAt(U,X,!0,!0),he=z.getMeterToDEM(N),ge=Math.floor(.5*(J*he-1)),Le=Math.floor(.5*(Q*he-1)),Oe=z.tileCoordToPixel(U,X),Ve=2*ge+1,We=2*Le+1,He=(function(Pt,Ut,bt,kt,dt){return[Pt.getElevationAtPixel(Ut,bt,!0),Pt.getElevationAtPixel(Ut+dt,bt,!0),Pt.getElevationAtPixel(Ut,bt+dt,!0),Pt.getElevationAtPixel(Ut+kt,bt+dt,!0)]})(z,Oe.x-ge,Oe.y-Le,Ve,We),Tt=Math.abs(He[0]-He[1]),Ke=Math.abs(He[2]-He[3]),Et=Math.abs(He[0]-He[2])+Math.abs(He[1]-He[3]),Ft=Math.min(.25,.5*he*(Tt+Ke)/Ve),It=Math.min(.25,.5*he*Et/We);return le+Math.max(Ft*J,It*Q)})(u,f,v):w;return{base:w+(i===0?-1:i),top:E?Math.max(C+l,w+i+2):w+l}}class s3{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class a3{constructor(){this.tasks={},this.taskQueue=[],An(["process"],this),this.invoker=new s3(this.process),this.nextId=0}add(e,i){const l=this.nextId++,u=(function({type:f,isSymbolTile:p,zoom:v}){return v=v||0,f==="message"?0:f!=="maybePrepare"||p?f!=="parseTile"||p?f==="parseTile"&&p?300-v:f==="maybePrepare"&&p?400-v:500:200-v:100-v})(i);if(u===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:i,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((l=>!!this.tasks[l])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<i&&(i=f.priority,e=u)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class IE{constructor(e,i,l){this.target=e,this.parent=i,this.mapId=l,this.callbacks={},this.cancelCallbacks={},An(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new a3}send(e,i,l,u,f=!1,p){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=p,this.callbacks[v]=l);const w=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!l,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Ol(i,w)},w),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(i.mustQueue||tr(self)){const u=this.callbacks[l],f=this.scheduler.add((()=>this.processTask(l,i)),u&&u.metadata||{type:"message"});f&&(this.cancelCallbacks[l]=f)}else this.processTask(l,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(i.error?l(Fl(i.error)):l(null,Fl(i.data)))}else{const l=new Set,u=i.hasCallback?(p,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?Ol(p):null,data:Ol(v,l)},l)}:()=>{},f=Fl(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,u);else if(this.parent.getWorkerSource){const p=i.type.split("."),{source:v,scope:w}=f;this.parent.getWorkerSource(i.sourceMapId,p[0],v,w)[p[1]](f,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Jm={workerUrl:"",workerClass:null,workerParams:void 0};const w1="mapboxgl_preloaded_worker_pool";class Uh{constructor(){this.active={}}acquire(e,i=Uh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Jm.workerClass!=null?new Jm.workerClass:new self.Worker(Jm.workerUrl,Jm.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[w1]}numActive(){return Object.keys(this.active).length}}Uh.workerCount=2;class Cf{constructor(e,i,l="Worker",u=Uh.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=At();const f=this.workerPool.acquire(this.id,u);for(let p=0;p<f.length;p++){const v=new Cf.Actor(f[p],i,this.id);v.name=`${l} ${p}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,l){at(this.actors,((u,f)=>{u.send(e,i,f)}),l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let Qm,T1;function Ny(){return Qm||(Qm=new Uh),Qm}Cf.Actor=IE;class l3{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),l=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,l/i.BYTES_PER_ELEMENT),l}createFloatArray(e){const i=new Float32Array(e),l=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,l/i.BYTES_PER_ELEMENT),l}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let l=0;l<e.length;++l)this.module.heapU8[i+l]=e.charCodeAt(l);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,l=e.facadeGlazingColorRgb,u=e.roofColorRgb,f=e.wallColorRgb,p=e.normalScale;this.module.setStyle(i[0],i[1],i[2],l[0],l[1],l[2],u[0],u[1],u[2],f[0],f[1],f[2],p[0],p[1],p[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,l){this.module.setFauxFacadeOptions(e?1:0,i?1:0,l)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const v of e){const w=this.createStringBuffer(v.roofType),E=[0],C=[];for(const N of v.coordinates)if(Array.isArray(N)){for(const U of N)C.push(U.x),C.push(U.y);E.push(C.length)}const z=this.createIntArray(E),L=this.createFloatArray(C);this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,w,v.roofType.length,L,z,E.length-1),this.module.free(w),this.module.free(z),this.module.free(L)}for(const v of i){let w;w=v.entrances?JSON.parse(v.entrances):[];const E=this.createFloatArray(w),C=[];for(const L of v.coordinates)C.push(L.x),C.push(L.y);const z=this.createFloatArray(C);this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,E,w.length,z,C.length),this.module.free(E),this.module.free(z)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const l=this.module.getMeshCount(),u=new Array(l);for(let v=0;v<l;v++){const w=this.module.getPositionsPtr(v),E=this.module.getPositionsLength(v),C=new Float32Array(this.module.heapF32.buffer,w,E),z=this.module.getNormalsPtr(v),L=this.module.getNormalsLength(v),N=new Float32Array(this.module.heapF32.buffer,z,L),U=this.module.getColorsPtr(v),X=this.module.getColorsLength(v),J=new Uint8Array(this.module.heapU8.buffer,U,X),Q=this.module.getAOPtr(v),le=this.module.getAOLength(v),he=new Float32Array(this.module.heapF32.buffer,Q,le),ge=this.module.getUVPtr(v),Le=this.module.getUVLength(v),Oe=new Float32Array(this.module.heapF32.buffer,ge,Le),Ve=this.module.getFauxFacadePtr(v),We=this.module.getFauxFacadeLength(v),He=new Uint8Array(this.module.heapU8.buffer,Ve,We),Tt=this.module.getIndicesPtr(v),Ke=this.module.getIndicesLength(v),Et=new Int32Array(this.module.heap32.buffer,Tt,Ke),Ft=this.module.getBuildingPart(v),It=this.readStringBuffer(Ft);u[v]={positions:C,normals:N,colors:J,ao:he,uv:Oe,isFauxFacade:He,indices:Et,buildingPart:It}}const f=this.module.getRingCount(),p=[];for(let v=0;v<f;v++){const w=this.module.getRingPtr(v),E=this.module.getRingLength(v),C=new Float32Array(this.module.heapF32.buffer,w,E);p.push(C)}return{meshes:u,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:p}}}let $m,S1,ol,Pf,E1,kf=null,Rf=null,ME=null,Vy=null;function CE(){return tr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:S1||Fo.DRACO_URL}function PE(){if(tr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Pf)return Pf;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Pf=WebAssembly.validate(o)?Fo.MESHOPT_SIMD_URL:Fo.MESHOPT_URL,Pf}function c3(){return Vy}const Uy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},u3={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},eg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function kE(o,e,i){const l=i.json.bufferViews.length,u=i.buffers.length;e.bufferView=l,i.json.bufferViews[l]={buffer:u,byteLength:o.byteLength},i.buffers[u]=o}const A1="KHR_draco_mesh_compression";function h3(o,e){const i=o.extensions&&o.extensions[A1];if(!i)return;const l=new ol.Decoder,u=LE(e,i.bufferView),f=new ol.Mesh;if(!l.DecodeArrayToMesh(u,u.byteLength,f))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[o.indices],v=Uy[p.componentType],w=p.count*v.BYTES_PER_ELEMENT,E=ol._malloc(w);v===Uint16Array?l.GetTrianglesUInt16Array(f,w,E):l.GetTrianglesUInt32Array(f,w,E),kE(ol.memory.buffer.slice(E,E+w),p,e),ol._free(E);for(const C of Object.keys(i.attributes)){const z=l.GetAttributeByUniqueId(f,i.attributes[C]),L=e.json.accessors[o.attributes[C]],N=u3[L.componentType],U=L.count*eg[L.type]*Uy[L.componentType].BYTES_PER_ELEMENT,X=ol._malloc(U);l.GetAttributeDataArrayForAllPoints(f,z,ol[N],U,X),kE(ol.memory.buffer.slice(X,X+U),L,e),ol._free(X)}l.destroy(),f.destroy(),delete o.extensions[A1]}const jy="EXT_meshopt_compression";function d3(o,e){if(!o.extensions||!o.extensions[jy])return;const i=o.extensions[jy],l=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),u=new Uint8Array(i.count*i.byteStride);E1.decodeGltfBuffer(u,i.count,i.byteStride,l,i.mode,i.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=u.buffer,delete o.extensions[jy]}const RE=1179937895,zE=new TextDecoder("utf8");function DE(o,e){return new URL(o,e).href}function f3(o,e,i,l){return fetch(DE(o.uri,l)).then((u=>u.arrayBuffer())).then((u=>{e.buffers[i]=u}))}function LE(o,e){const i=o.json.bufferViews[e];return new Uint8Array(o.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function p3(o,e,i,l){if(o.uri){const u=DE(o.uri,l);return fetch(u).then((f=>f.blob())).then((f=>createImageBitmap(f))).then((f=>{e.images[i]=f}))}if(o.bufferView!==void 0){const u=LE(e,o.bufferView),f=new Blob([u],{type:o.mimeType});return createImageBitmap(f).then((p=>{e.images[i]=p}))}}function OE(o,e=0,i){const l={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===RE){const C=new Uint32Array(o,e);let z=2;const L=(C[z++]>>2)-3,N=C[z++]>>2;if(z++,l.json=JSON.parse(zE.decode(C.subarray(z,z+N))),z+=N,z<L){const U=C[z++];z++;const X=e+(z<<2);l.buffers[0]=o.slice(X,X+U)}}else l.json=JSON.parse(zE.decode(new Uint8Array(o,e)));const{buffers:u,images:f,meshes:p,extensionsUsed:v,bufferViews:w}=l.json;let E=Promise.resolve();if(u){const C=[];for(let z=0;z<u.length;z++){const L=u[z];L.uri?C.push(f3(L,l,z,i)):l.buffers[z]||(l.buffers[z]=null)}E=Promise.all(C)}return E.then((()=>{const C=[],z=v&&v.includes(A1),L=v&&v.includes(jy);if(z&&C.push((function(){if(!ol)return $m??($m=(function(N){let U,X=null;function J(){U=new Uint8Array(X.buffer)}function Q(){throw new Error("Unexpected Draco error.")}const le={a:{a:Q,d:function(he,ge,Le){return U.copyWithin(he,ge,ge+Le)},c:function(he){const ge=U.length,Le=Math.max(he>>>0,Math.ceil(1.2*ge)),Oe=Math.ceil((Le-ge)/65536);try{return X.grow(Oe),J(),!0}catch{return!1}},b:Q}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(N,le):N.then((he=>he.arrayBuffer())).then((he=>WebAssembly.instantiate(he,le)))).then((he=>{const{Rb:ge,Qb:Le,P:Oe,T:Ve,X:We,Ja:He,La:Tt,Qa:Ke,Va:Et,Wa:Ft,eb:It,jb:Pt,f:Ut,e:bt,yb:kt,zb:dt,Ab:lt,Bb:jt,Db:Nt,Gb:wn}=he.instance.exports;X=bt;const sn=(()=>{let pn=0,Xt=0,xn=0,Zn=0;return en=>{xn&&(ge(Zn),ge(pn),Xt+=xn,xn=pn=0),pn||(Xt+=128,pn=Le(Xt));const _n=en.length+7&-8;let zn=pn;_n>=Xt&&(xn=_n,zn=Zn=Le(_n));for(let $n=0;$n<en.length;$n++)U[zn+$n]=en[$n];return zn}})();return J(),Ut(),{memory:bt,_free:ge,_malloc:Le,Mesh:class{constructor(){this.ptr=Oe()}destroy(){Ve(this.ptr)}},Decoder:class{constructor(){this.ptr=He()}destroy(){Pt(this.ptr)}DecodeArrayToMesh(pn,Xt,xn){const Zn=sn(pn),en=Tt(this.ptr,Zn,Xt,xn.ptr);return!!We(en)}GetAttributeByUniqueId(pn,Xt){return{ptr:Ke(this.ptr,pn.ptr,Xt)}}GetTrianglesUInt16Array(pn,Xt,xn){Et(this.ptr,pn.ptr,Xt,xn)}GetTrianglesUInt32Array(pn,Xt,xn){Ft(this.ptr,pn.ptr,Xt,xn)}GetAttributeDataArrayForAllPoints(pn,Xt,xn,Zn,en){It(this.ptr,pn.ptr,Xt.ptr,xn,Zn,en)}},DT_INT8:kt(),DT_UINT8:dt(),DT_INT16:lt(),DT_UINT16:jt(),DT_UINT32:Nt(),DT_FLOAT32:wn()}}))})(fetch(CE())),$m.then((N=>{ol=N,$m=void 0})))})()),L&&C.push((function(){if(E1)return;const N=(function(U){let X;const J=WebAssembly.instantiateStreaming(U,{}).then((he=>{X=he.instance,X.exports.__wasm_call_ctors()})),Q={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},le={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:J,supported:!0,decodeGltfBuffer(he,ge,Le,Oe,Ve,We){(function(He,Tt,Ke,Et,Ft,It,Pt){const Ut=He.exports.sbrk,bt=Et+3&-4,kt=Ut(bt*Ft),dt=Ut(It.length),lt=new Uint8Array(He.exports.memory.buffer);lt.set(It,dt);const jt=Tt(kt,Et,Ft,dt,It.length);if(jt===0&&Pt&&Pt(kt,bt,Ft),Ke.set(lt.subarray(kt,kt+Et*Ft)),Ut(kt-Ut(0)),jt!==0)throw new Error(`Malformed buffer data: ${jt}`)})(X,X.exports[le[Ve]],he,ge,Le,Oe,X.exports[Q[We]])}}})(fetch(PE()));return N.ready.then((()=>{E1=N}))})()),f)for(let N=0;N<f.length;N++)C.push(p3(f[N],l,N,i));return(C.length?Promise.all(C):Promise.resolve()).then((()=>{if(z&&p)for(const{primitives:N}of p)for(const U of N)h3(U,l);if(L&&p&&w)for(const N of w)d3(N,l);return l}))}))}function I1(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function M1(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class C1{constructor(e,i,l,u){this.context=e,this.format=l,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:u&&u.premultiply})}update(e,i){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:f}=this,{gl:p}=f,{x:v,y:w}=i&&i.position?i.position:{x:0,y:0},E=v+l,C=w+u;!this.size||this.size[0]===E&&this.size[1]===C||(p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(this.texture),this.texture=p.createTexture(),this.size=null),p.bindTexture(p.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA8&&(!i||i.premultiply!==!1));const z=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&E>0&&C>0){const L=this.useMipmap?Math.floor(Math.log2(Math.max(E,C)))+1:1;p.texStorage2D(p.TEXTURE_2D,L,this.format,E,C),this.size=[E,C]}this.size&&(z?p.texSubImage2D(p.TEXTURE_2D,0,v,w,I1(this.format),M1(this.format),e):"data"in e&&e.data&&p.texSubImage2D(p.TEXTURE_2D,0,v,w,l,u,I1(this.format),M1(this.format),e.data)),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,i,l=!1){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,l,u,f){const{context:p}=this,{gl:v}=p;v.bindTexture(v.TEXTURE_2D,this.texture),i!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),this.wrapS=l),u!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,u),this.wrapT=u),f!==this.compareMode&&(f?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,f)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=f)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class tg{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}}const m3=xi([{name:"a_pos_3f",components:3,type:"Float32"}]),g3=xi([{name:"a_color_3f",components:3,type:"Float32"}]),_3=xi([{name:"a_color_4f",components:4,type:"Float32"}]),y3=xi([{name:"a_uv_2f",components:2,type:"Float32"}]),v3=xi([{name:"a_normal_3f",components:3,type:"Float32"}]),x3=xi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),b3=xi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function FE(o,e){const i=Gy(o.projection,o.zoom,o.width,o.height),l=(function(f,p,v,w,E){const C=new Z(v.lng-180*Lu,v.lat),z=new Z(v.lng+180*Lu,v.lat),L=f.project(C.lng,C.lat),N=f.project(z.lng,z.lat),U=-Math.atan2(N.y-L.y,N.x-L.x),X=pt.fromLngLat(v);X.y=Pe(X.y,-1+Lu,1-Lu);const J=X.toLngLat(),Q=f.project(J.lng,J.lat),le=pt.fromLngLat(J);le.x+=Lu;const he=le.toLngLat(),ge=f.project(he.lng,he.lat),Le=NE(ge.x-Q.x,ge.y-Q.y,U),Oe=pt.fromLngLat(J);Oe.y+=Lu;const Ve=Oe.toLngLat(),We=f.project(Ve.lng,Ve.lat),He=NE(We.x-Q.x,We.y-Q.y,U),Tt=Math.abs(Le.x)/Math.abs(He.y),Ke=G([]);ue(Ke,Ke,-U*(1-(E?0:w)));const Et=G([]);return oe(Et,Et,[1,1-(1-Tt)*w,1]),Et[4]=-He.x/He.y*w,ue(Et,Et,U),Y(Et,Ke,Et),Et})(o.projection,0,o.center,i,e),u=BE(o);return oe(l,l,[u,u,1]),l}function BE(o){const e=o.projection,i=Gy(o.projection,o.zoom,o.width,o.height),l=P1(e,o.center),u=P1(e,Z.convert(e.center));return Math.pow(2,l*i+(1-i)*u)}function Gy(o,e,i,l,u=1/0){const f=o.range;if(!f)return 0;const p=Math.min(u,Math.max(i,l)),v=Math.log2(p/1024);return nt(f[0]+v,f[1]+v,e)}const Lu=1/4e4;function P1(o,e){const i=Pe(e.lat,-ze,ze),l=new Z(e.lng-180*Lu,i),u=new Z(e.lng+180*Lu,i),f=o.project(l.lng,i),p=o.project(u.lng,i),v=pt.fromLngLat(l),w=pt.fromLngLat(u),E=p.x-f.x,C=p.y-f.y,z=w.x-v.x,L=w.y-v.y,N=Math.sqrt((z*z+L*L)/(E*E+C*C));return Math.log2(N)}function NE(o,e,i){const l=Math.cos(i),u=Math.sin(i);return{x:o*l-e*u,y:o*u+e*l}}function VE(o,e,i){G(o),ue(o,o,Xe(e[2])),ce(o,o,Xe(e[0])),me(o,o,Xe(e[1])),oe(o,o,i),Y(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Wy(o,e,i,l,u,f,p,v){const w=[i[0]-e[0],i[1]-e[1],0],E=[l[0]-e[0],l[1]-e[1],0];if(De(w)<1e-12||De(E)<1e-12)return Ri(o);const C=Lt([],w,E);tt(C,C),it(E,l,e),w[2]=(f-u)*v,E[2]=(p-u)*v;const z=w;return Lt(z,w,E),tt(z,z),$r(o,C,z)}function k1(o,e,i=!1){const l=Ru(e.zoom),u=(function(f,p,v){const w=p.worldSize,E=[f[12],f[13],f[14]],C=Me(E[1]/w),z=ke(E[0]/w),L=G([]),N=Ae(1,C)*w,U=Ae(1,0)*w*Ze(C,p.zoom),X=1/o1(w);let J=U*X;if(v){const ge=Gy(p.projection,p.zoom,p.width,p.height,1024);J=X*p.projection.pixelSpaceConversion(p.center.lat,w,ge)}const Q=B(C,z);Ne(Q,Q,Dt([],tt([],Q),N*J*E[2]));const le=(function(ge){const Le=[ge[0],ge[1],ge[2]];let Oe=[0,1,0];const Ve=Lt([],Oe,Le);return Lt(Oe,Le,Ve),Qe(Oe)===0&&(Oe=[0,1,0],Lt(Ve,Le,Oe)),tt(Ve,Ve),tt(Oe,Oe),tt(Le,Le),[Ve[0],Ve[1],Ve[2],0,Oe[0],Oe[1],Oe[2],0,Le[0],Le[1],Le[2],0,ge[0],ge[1],ge[2],1]})(Q);oe(L,L,[J,J,J*N]),ne(L,L,[-E[0],-E[1],-E[2]]);const he=Y([],p.globeMatrix,le);return Y(he,he,L),Y(he,he,f),he})(o,e,i);if(l>0){const f=(function(p,v){const w=v.worldSize,E=Ae(1,0)*w*Ze(v.center.lat,v.zoom)/o1(w),C=Ae(1,v.center.lat)*w,z=G([]);me(z,z,Xe(v.center.lng)),ce(z,z,Xe(v.center.lat)),ne(z,z,[0,0,h]),oe(z,z,[E,E,E*C]);const L=v.point;return ne(z,z,[-L.x,-L.y,0]),Y(z,z,p),Y(z,v.globeMatrix,z)})(o,e);return(function(p,v,w){const E=(U,X,J)=>{const Q=De(U),le=De(X),he=Rc(U,X,J);return Dt(he,he,1/De(he)*Rn(Q,le,J))},C=E([p[0],p[1],p[2]],[v[0],v[1],v[2]],w),z=E([p[4],p[5],p[6]],[v[4],v[5],v[6]],w),L=E([p[8],p[9],p[10]],[v[8],v[9],v[10]],w),N=Rc([p[12],p[13],p[14]],[v[12],v[13],v[14]],w);return[C[0],C[1],C[2],0,z[0],z[1],z[2],0,L[0],L[1],L[2],0,N[0],N[1],N[2],1]})(u,f,l)}return u}function UE(o,e,i,l){const u=Fn.projectAabbCorners(l,i);let f=Number.MAX_VALUE,p=-1;for(let E=0;E<u.length;++E){const C=u[E];C[0]=(.5*C[0]+.5)*e.width,C[1]=(.5-.5*C[1])*e.height,C[2]<f&&(p=E,f=C[2])}const v=E=>new Mt(u[E][0],u[E][1]);let w;switch(p){case 0:case 6:w=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:w=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:w=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:w=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(qs(o,w))return f}const jh=64,zf={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function jE(o,e,i,l,u,f,p,v,w,E=!1){const C=i.zoom,z=i.project(l),L=Ze(l.lat,C),N=1/L;G(o),ne(o,o,[z.x+p[0]*N,z.y+p[1]*N,p[2]]);let U=1,X=1;const J=i.worldSize;if(E){if(i.projection.name==="mercator"){let ge=0;i.elevation&&(ge=i.elevation.getAtPointOrZero(new pt(z.x/J,z.y/J),0));const Le=ti([],[z.x,z.y,ge,1],i.projMatrix)[3]/i.cameraToCenterDistance;U=Le,X=Le*Ze(i.center.lat,C)}else if(i.projection.name==="globe"){const ge=k1(o,i),Le=[0,0,0,1];ti(Le,Le,Y([],i.projMatrix,ge));const Oe=Le[3]/i.cameraToCenterDistance,Ve=Ru(C),We=i.projection.pixelsPerMeter(l.lat,J)*Ze(l.lat,C),He=i.projection.pixelsPerMeter(i.center.lat,J)*Ze(i.center.lat,C);U=Oe/Rn(We,ot(i.center.lat),Ve),X=Oe*L/We,U*=He,X*=He}}else U=N;oe(o,o,[U,U,X]);const Q=[...o],le=e.orientation,he=[];if(VE(he,[le[0]+u[0],le[1]+u[1],le[2]+u[2]],f),Y(o,Q,he),v&&i.elevation){let ge=0;const Le=[];if(w&&i.elevation){ge=(function(Ve,We,He,Tt,Ke){const Et=We.elevation;if(!Et)return 0;const Ft=Fn.projectAabbCorners(He,Tt),It=Ae(1,Ke.lat)*We.worldSize,Pt=(function(Xt,xn){const Zn=[0,0,1],en=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const _n of en){const zn=Xt[_n.corners[0]],$n=Xt[_n.corners[1]],di=Xt[_n.corners[2]],ni=[$n[0]-zn[0],$n[1]-zn[1],xn*($n[2]-zn[2])],hn=Lt(ni,ni,[di[0]-zn[0],di[1]-zn[1],xn*(di[2]-zn[2])]);tt(hn,hn),_n.dotProductWithUp=gt(hn,Zn)}return en.sort(((_n,zn)=>_n.dotProductWithUp-zn.dotProductWithUp)),en[0].corners})(Ft,It),Ut=Ft[Pt[0]],bt=Ft[Pt[1]],kt=Ft[Pt[2]],dt=Ft[Pt[3]],lt=Et.getAtPointOrZero(new pt(Ut[0]/We.worldSize,Ut[1]/We.worldSize),0),jt=Et.getAtPointOrZero(new pt(bt[0]/We.worldSize,bt[1]/We.worldSize),0),Nt=Et.getAtPointOrZero(new pt(kt[0]/We.worldSize,kt[1]/We.worldSize),0),wn=Et.getAtPointOrZero(new pt(dt[0]/We.worldSize,dt[1]/We.worldSize),0),sn=(lt+wn)/2,pn=(jt+Nt)/2;return sn>pn?jt<Nt?Wy(Ve,bt,dt,Ut,jt,wn,lt,It):Wy(Ve,kt,Ut,dt,Nt,lt,wn,It):lt<wn?Wy(Ve,Ut,bt,kt,lt,jt,Nt,It):Wy(Ve,dt,kt,bt,wn,Nt,jt,It),Math.max(sn,pn)})(Le,i,e.aabb,o,l);const Oe=Y([],ie([],Le),he);Y(o,Q,Oe)}else ge=i.elevation.getAtPointOrZero(new pt(z.x/J,z.y/J),0);ge!==0&&(o[14]+=ge)}}function ng(o,e,i=!1){o.uploaded||(o.gfxTexture=new C1(e,o.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function w3(o,e,i){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,m3.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,v3.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,y3.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?g3:_3).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,b3.members,!0)),o.segments=Fr.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const l=o.material;l.pbrMetallicRoughness.baseColorTexture&&ng(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&ng(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&ng(l.normalTexture,e),l.occlusionTexture&&ng(l.occlusionTexture,e,i),l.emissionTexture&&ng(l.emissionTexture,e)}function R1(o,e,i){if(o.meshes)for(const l of o.meshes)w3(l,e,i);if(o.children)for(const l of o.children)R1(l,e,i)}function qy(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)qy(e)}function z1(o){if(o.meshes)for(const i of o.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(const i of o.children)z1(i)}function Gh(o,e){const i=o.json.bufferViews[e.bufferView],l=Uy[e.componentType];return new l(o.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==eg[e.type]*l.BYTES_PER_ELEMENT?i.byteStride/l.BYTES_PER_ELEMENT:eg[e.type]))}function D1(o,e,i,l){const u=Uy[e.componentType],f=(function(C){switch(C){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(u),p=o.json.bufferViews[e.bufferView],v=p.byteStride?p.byteStride/u.BYTES_PER_ELEMENT:eg[e.type],w=i.float32,E=w.length/i.capacity;for(let C=0,z=0;C<e.count*v;C+=v,z+=E)for(let L=0;L<E;L++)w[z+L]=l[C+L]*f;i._trim()}function T3(o,e,i){const l=o.indices,u=o.attributes,f={};f.indexArray=new Eo;const p=e.json.accessors[l],v=p.count/3;f.indexArray.reserve(v);const w=Gh(e,p);for(let L=0;L<v;L++)f.indexArray.emplaceBack(w[3*L],w[3*L+1],w[3*L+2]);f.indexArray._trim(),f.vertexArray=new Ss;const E=e.json.accessors[u.POSITION];f.vertexArray.reserve(E.count);const C=Gh(e,E);for(let L=0;L<E.count;L++)f.vertexArray.emplaceBack(C[3*L],C[3*L+1],C[3*L+2]);if(f.vertexArray._trim(),f.aabb=new Fn(E.min,E.max),f.centroid=(function(L,N){const U=[0,0,0],X=L.length;if(X>0){for(let J=0;J<X;J++){const Q=3*L[J];U[0]+=N[Q],U[1]+=N[Q+1],U[2]+=N[Q+2]}U[0]/=X,U[1]/=X,U[2]/=X}return U})(w,C),u.COLOR_0!==void 0){const L=e.json.accessors[u.COLOR_0],N=eg[L.type],U=Gh(e,L);f.colorArray=N===3?new Ss:new ba,f.colorArray.resize(L.count),D1(e,L,f.colorArray,U)}if(u.NORMAL!==void 0){f.normalArray=new Ss;const L=e.json.accessors[u.NORMAL];f.normalArray.resize(L.count);const N=Gh(e,L);D1(e,L,f.normalArray,N)}if(u.TEXCOORD_0!==void 0&&i.length>0){f.texcoordArray=new Mu;const L=e.json.accessors[u.TEXCOORD_0];f.texcoordArray.resize(L.count);const N=Gh(e,L);D1(e,L,f.texcoordArray,N)}if(u._FEATURE_ID_RGBA4444!==void 0){const L=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=Gh(e,L))}u._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(Gh(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const z=o.material;return f.material=(function(L,N){const{emissiveFactor:U=[0,0,0],alphaMode:X="OPAQUE",alphaCutoff:J=.5,normalTexture:Q,occlusionTexture:le,emissiveTexture:he,doubleSided:ge}=L,{baseColorFactor:Le=[1,1,1,1],metallicFactor:Oe=1,roughnessFactor:Ve=1,baseColorTexture:We,metallicRoughnessTexture:He}=L.pbrMetallicRoughness||{},Tt=le?N[le.index]:void 0;if(le&&le.extensions&&le.extensions.KHR_texture_transform&&Tt){const Ke=le.extensions.KHR_texture_transform;Tt.offsetScale=[Ke.offset[0],Ke.offset[1],Ke.scale[0],Ke.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Hi(...Le),metallicFactor:Oe,roughnessFactor:Ve,baseColorTexture:We?N[We.index]:void 0,metallicRoughnessTexture:He?N[He.index]:void 0},doubleSided:ge,emissiveFactor:new Hi(...U),alphaMode:X,alphaCutoff:J,normalTexture:Q?N[Q.index]:void 0,occlusionTexture:Tt,emissionTexture:he?N[he.index]:void 0,defined:L.defined===void 0}})(z!==void 0?e.json.materials[z]:{defined:!1},i),f}function GE(o,e,i){const{matrix:l,rotation:u,translation:f,scale:p,mesh:v,extras:w,children:E}=o,C={};if(C.matrix=l||(function(z,L,N,U){var X=L[0],J=L[1],Q=L[2],le=L[3],he=X+X,ge=J+J,Le=Q+Q,Oe=X*he,Ve=X*ge,We=X*Le,He=J*ge,Tt=J*Le,Ke=Q*Le,Et=le*he,Ft=le*ge,It=le*Le,Pt=U[0],Ut=U[1],bt=U[2];return z[0]=(1-(He+Ke))*Pt,z[1]=(Ve+It)*Pt,z[2]=(We-Ft)*Pt,z[3]=0,z[4]=(Ve-It)*Ut,z[5]=(1-(Oe+Ke))*Ut,z[6]=(Tt+Et)*Ut,z[7]=0,z[8]=(We+Ft)*bt,z[9]=(Tt-Et)*bt,z[10]=(1-(Oe+He))*bt,z[11]=0,z[12]=N[0],z[13]=N[1],z[14]=N[2],z[15]=1,z})([],u||[0,0,0,1],f||[0,0,0],p||[1,1,1]),v!==void 0){C.meshes=i[v];const z=C.anchor=[0,0];for(const L of C.meshes){const{min:N,max:U}=L.aabb;z[0]+=N[0]+U[0],z[1]+=N[1]+U[1]}z[0]=Math.floor(z[0]/C.meshes.length/2),z[1]=Math.floor(z[1]/C.meshes.length/2)}if(w&&(w.id&&(C.id=w.id),w.lights&&(C.lights=(function(z){if(!z.length)return[];const L=(function(Q){const le=atob(Q),he=new Uint8Array(le.length);for(let ge=0;ge<le.length;ge++)he[ge]=le.codePointAt(ge);return he})(z),N=[],U=L.length/24,X=new Uint16Array(L.buffer),J=new Float32Array(L.buffer);for(let Q=0;Q<U;Q++){const le=X[2*Q*6]/30,he=X[2*Q*6+1]/30,ge=X[2*Q*6+10]/100,Le=J[6*Q+1],Oe=J[6*Q+2],Ve=J[6*Q+3],We=J[6*Q+4],He=Ve-Le,Tt=We-Oe,Ke=Math.hypot(He,Tt);N.push({pos:[Le+.5*He,Oe+.5*Tt,he],normal:[Tt/Ke,-He/Ke,0],width:Ke,height:le,depth:ge,points:[Le,Oe,Ve,We]})}return N})(w.lights))),E){const z=[];for(const L of E)z.push(GE(e.json.nodes[L],e,i));C.children=z}return C}function S3(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new zy(o.vertices,o.indices,8,256),[i,l]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:i,max:l}}function E3(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const l=[];for(const p of i){if(!Array.isArray(p)||p.length!==2)continue;const v=p[0],w=p[1];typeof v=="number"&&typeof w=="number"&&l.push(new Mt(v,w))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let u=0;for(let p=0;p<l.length;p++){const v=l[p],w=l[(p+1)%l.length],E=l[(p+2)%l.length];u+=(v.x-w.x)*(E.y-w.y)-(E.x-w.x)*(v.y-w.y)}u>0&&l.reverse();const f=If(l.flatMap((p=>[p.x,p.y])),[]);return f.length===0?null:{vertices:l,indices:f}}function A3(o,e){const i=[],l=[];let u=0;const f=[];for(const p of o){u=i.length;const v=p.vertexArray.float32,w=p.indexArray.uint16;for(let E=0;E<p.vertexArray.length;E++)f[0]=v[3*E+0],f[1]=v[3*E+1],f[2]=v[3*E+2],Je(f,f,e),i.push(new Mt(f[0],f[1]));for(let E=0;E<3*p.indexArray.length;E++)l.push(w[E]+u)}if(l.length%3!=0)return null;for(let p=0;p<l.length;p+=3){const v=i[l[p+0]],w=i[l[p+1]],E=i[l[p+2]];(v.x-w.x)*(E.y-w.y)-(E.x-w.x)*(v.y-w.y)>0&&([l[p+1],l[p+2]]=[l[p+2],l[p+1]])}return{vertices:i,indices:l}}function WE(o){const e=(function(w,E){const C=[],z=WebGL2RenderingContext;if(w.json.textures)for(const L of w.json.textures){const N={magFilter:z.LINEAR,minFilter:z.NEAREST,wrapS:z.REPEAT,wrapT:z.REPEAT};L.sampler!==void 0&&Object.assign(N,w.json.samplers[L.sampler]),C.push({image:E[L.source],sampler:N,uploaded:!1})}return C})(o,o.images),i=(function(w,E){const C=[];for(const z of w.json.meshes){const L=[];for(const N of z.primitives)L.push(T3(N,w,E));C.push(L)}return C})(o,e),{scenes:l,scene:u,nodes:f}=o.json,p=l?l[u||0].nodes:[...f.keys()],v=[];for(const w of p)v.push(GE(f[w],o,i));return(function(w,E,C){const z={},L=new Set;for(let N=0;N<w.length;N++){const U=C[E[N]];if(!U.extras)continue;const X=U.extras["mapbox:footprint:version"],J=U.extras["mapbox:footprint:id"];(X||J)&&L.add(N),X==="1.0.0"&&J&&(z[J]=N)}for(let N=0;N<w.length;N++){if(L.has(N))continue;const U=w[N],X=C[E[N]];if(!X.extras)continue;let J=null;U.id in z&&(J=A3(w[z[U.id]].meshes,U.matrix)),J||(J=E3(X)),J&&(U.footprint=S3(J))}if(L.size>0){const N=Array.from(L.values()).sort(((U,X)=>U-X));for(let U=N.length-1;U>=0;U--)w.splice(N[U],1)}})(v,p,o.json.nodes),v}function I3(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,i=o.aabb.min[0]-1,l=o.aabb.min[1]-1,u=jh/(o.aabb.max[0]-i+2),f=jh/(o.aabb.max[1]-l+2);for(let p=0;p<e.length;p+=3){const v=e[p+2],w=(e[p+0]-i)*u|0,E=(e[p+1]-l)*f|0;v>o.heightmap[E*jh+w]&&(o.heightmap[E*jh+w]=v)}}function qE(o,e,i,l,u){i.reserve(i.length+4*o.length),l.reserve(l.length+10*o.length),u.reserve(u.length+10*o.length);let f=l.length;for(const p of o){const v=Math.min(10,Math.max(4,1.3*p.height))*e,w=[-p.normal[1],p.normal[0],0],E=Math.min(.29,.1*p.width/p.depth),C=p.width-2*p.depth*e*(E+.01),z=Kt([],p.pos,w,C/2),L=Kt([],p.pos,w,-C/2),N=[z[0],z[1],z[2]+p.height],U=[L[0],L[1],L[2]+p.height],X=Kt([],p.normal,w,E);Dt(X,X,v);const J=Kt([],p.normal,w,-E);Dt(J,J,v),Ne(X,z,X),Ne(J,L,J),z[2]+=.1,L[2]+=.1,l.emplaceBack(X[0],X[1],X[2]),l.emplaceBack(J[0],J[1],J[2]),l.emplaceBack(z[0],z[1],z[2]),l.emplaceBack(L[0],L[1],L[2]),l.emplaceBack(N[0],N[1],N[2]),l.emplaceBack(U[0],U[1],U[2]),l.emplaceBack(z[0],z[1],z[2]),l.emplaceBack(L[0],L[1],L[2]),l.emplaceBack(X[0],X[1],X[2]),l.emplaceBack(J[0],J[1],J[2]);const Q=C/v/2;u.emplaceBack(-Q-E,-1,Q,.8),u.emplaceBack(Q+E,-1,Q,.8),u.emplaceBack(-Q,0,Q,1.3),u.emplaceBack(Q,0,Q,1.3),u.emplaceBack(Q+E,-.8,Q,.7),u.emplaceBack(Q+E,-.8,Q,.7),u.emplaceBack(0,0,Q,1.3),u.emplaceBack(0,0,Q,1.3),u.emplaceBack(Q+E,-1.2,Q,.8),u.emplaceBack(Q+E,-1.2,Q,.8),i.emplaceBack(6+f,4+f,8+f),i.emplaceBack(7+f,9+f,5+f),i.emplaceBack(0+f,1+f,2+f),i.emplaceBack(1+f,3+f,2+f),f+=10}}function M3(o,e){const i={};i.indexArray=new Eo,i.vertexArray=new Ss,i.colorArray=new ba,qE(o,e,i.indexArray,i.vertexArray,i.colorArray);const l={defined:!0};l.emissiveFactor=Hi.black;const u={};return u.baseColorFactor=Hi.white,l.pbrMetallicRoughness=u,i.material=l,i.aabb=new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const HE=xi([{name:"a_pos_3f",components:3,type:"Float32"}]),C3=xi([{name:"a_normal_3",components:3,type:"Int16"}]),P3=xi([{name:"a_centroid_3",components:3,type:"Int16"}]),ZE=xi([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),k3=xi([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),R3=xi([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),z3=xi([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),D3=xi([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),XE=Ot.types,L1=32767;function L3(o,e){const i=Yt+e;for(const l of o)for(const u of l)if(u.x<-e||u.x>i||u.y<-e||u.y>i)return!1;return!0}class YE{constructor(){this.layoutVertexArray=new Ss,this.layoutAttenuationArray=new ba,this.layoutColorArray=new vo,this.indexArray=new Eo,this.indexArrayForConflation=new Eo,this.segmentsBucket=new Fr}}class O1{constructor(){this.layoutVertexArray=new Ss,this.layoutNormalArray=new Ic,this.layoutCentroidArray=new Ic,this.layoutColorArray=new vo,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new Eo,this.indexArrayForConflation=new Eo,this.segmentsBucket=new Fr,this.entranceBloom=new YE}}class KE{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new O1,this.buildingWithFacade=new O1,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new vo,this.buildingWithFacade.layoutFacadeDataArray=new Eu,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new vo,this.programConfigurations=new wa(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new x1(e)}updateFootprints(e,i){for(const l of this.footprints)i.push({footprint:l,id:e})}prepare(){return(function(){if(Vy!=null||ME!=null)return null;if(Rf!=null)return Rf;const e=fetch(Fo.BUILDING_GEN_URL);return Rf=(function(i){let l,u,f,p;function v(){l=new Uint8Array(p.buffer),u=new Int32Array(p.buffer),f=new Float32Array(p.buffer)}function w(){throw new Error("Unexpected BuildingGen error.")}const E=()=>{},C={a:{a:w,f:function(z){const L=l.length,N=Math.max(z>>>0,Math.ceil(1.2*L)),U=Math.ceil((N-L)/65536);try{return p.grow(U),v(),!0}catch{return!1}},g:w,b:E,c:E,d:E,e:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,C):i.then((z=>z.arrayBuffer())).then((z=>WebAssembly.instantiate(z,C)))).then((z=>{const L=z.instance.exports;return(0,L.g)(),p=L.f,v(),new l3({setStyle:L.h,setAOOptions:L.i,setMetricOptions:L.j,setStructuralOptions:L.k,setFacadeOptions:L.l,setFauxFacadeOptions:L.m,setFacadeClassifierOptions:L.n,addFeature:L.o,addFacade:L.p,generateMesh:L.q,getLastError:L.r,getOuterRingLength:L.s,getMeshCount:L.t,getPositionsPtr:L.u,getPositionsLength:L.v,getNormalsPtr:L.w,getNormalsLength:L.x,getColorsPtr:L.y,getColorsLength:L.z,getAOPtr:L.A,getAOLength:L.B,getUVPtr:L.C,getUVLength:L.D,getFauxFacadePtr:L.E,getFauxFacadeLength:L.F,getIndicesPtr:L.G,getIndicesLength:L.H,getBuildingPart:L.I,getRingCount:L.J,getRingPtr:L.K,getRingLength:L.L,free:L.M,malloc:L.N,heapU8:l,heap32:u,heapF32:f})}))})(e).then((i=>(Rf=null,Vy=i,Vy))).catch((i=>{oi("Could not load building-gen"),Rf=null,ME=i})),Rf})()}populate(e,i,l,u){const f=c3();if(!f)return;const p=$e(l);this.tileToMeter=p,this.brightness=i.brightness,f.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,p],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:p,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),f.setAOOptions(!1,.3),f.setMetricOptions(!1,16),f.setStructuralOptions(!0),f.setFacadeClassifierOptions(3);const v=new Map;for(const{feature:w}of e){if(XE[w.type]!=="LineString")continue;const E=this.layers[0]._featureFilter.needGeometry,C=Vt(w,E);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom),C,l))continue;const z=E?C.geometry:nn(w,l,u),L=[];for(const J of z)for(const Q of J)L.push({x:Q.x,y:Q.y});const N={coordinates:L,crossPerc:w.properties.cross_perc,distanceToRoad:w.properties.distance_to_road,entrances:w.properties.entrances,sourceId:0},U=w.properties.source_id;let X=v.get(U);X||(X=[],v.set(U,X)),X.push(N)}this.maxHeight=0;for(const{feature:w,index:E}of e){if(XE[w.type]==="LineString")continue;const C=this.layers[0]._featureFilter.needGeometry,z=Vt(w,C);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom),z,l))continue;const L=C?z.geometry:nn(w,l,u),N=qm(L,500);if(!L3(L,163))continue;const U=this.layers[0],X=U.layout.get("building-base").evaluate(w,{},l),J=U.layout.get("building-height").evaluate(w,{},l),Q=U.layout.get("building-roof-shape").evaluate(w,{},l),le=U.paint.get("building-ambient-occlusion-intensity"),he=U.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(Q==="flat")continue;const ge=U.layout.get("building-facade").evaluate(w,{},l);f.setFacadeOptions(4,!0),f.setFauxFacadeOptions(ge,!1,1);const Le=w.properties.source_id;let Oe;Oe=v.has(Le)?v.get(Le):[];let Ve=0,We=0,He=0,Tt=0,Ke=0,Et=0;if(ge){let hn=Math.round(U.layout.get("building-facade-floors").evaluate(w,{},l));if(X===0){hn=Math.max(1,hn-(Oe.length>0?1:0));let Ti=4;if(J>100){const ve=[10,13,15];Ti=ve[w.id?w.id%ve.length:0],f.setFacadeOptions(Ti,!0)}Ke=1.6803*Ti/p}else Ke=X/p;Et=J/p,Ke=Math.min(Ke,Et),He=U.layout.get("building-facade-unit-width").evaluate(w,{},l)/p,Tt=(Et-Ke)/hn,f.setFauxFacadeOptions(!0,!0,He);const ei=U.layout.get("building-facade-window").evaluate(w,{},l);Ve=ei[0],We=ei[1]}const Ft=[],It=new Mt(1/0,1/0),Pt=new Mt(-1/0,-1/0),Ut=new Mt(0,0);let bt=0;for(const hn of N)if(hn.length>0){const ei=[];for(const Ti of hn){const ve=[];for(let be=Ti.length-1;be>=0;be--){const ht=Ti[be];ve.push({x:ht.x,y:ht.y}),It.x=Math.min(It.x,ht.x),It.y=Math.min(It.y,ht.y),Pt.x=Math.max(Pt.x,ht.x),Pt.y=Math.max(Pt.y,ht.y),Ut.x+=ht.x,Ut.y+=ht.y,bt++}ei.push(ve)}Ft.push({id:w.id?w.id:0,height:J,minHeight:X,sourceId:0,roofType:Q,coordinates:ei})}Ut.x/=bt||1,Ut.y/=bt||1;const kt=f.generateMesh(Ft,Oe);if(typeof kt=="string"){oi(`Unable to generate building ${w.id}: ${kt}`);continue}if(kt.meshes.length===0||kt.modifiedPolygonRings.length===0)continue;let dt=0;for(const hn of kt.meshes)dt+=hn.positions.length/3;const lt=ge?this.buildingWithFacade:this.buildingWithoutFacade,jt=lt.segmentsBucket.prepareSegment(dt,lt.layoutVertexArray,lt.indexArray),Nt=[];let wn=null,sn=0,pn=-1;const Xt=lt.indexArray.length;let xn=0;for(const hn of kt.meshes){const ei=lt.layoutVertexArray.length;if(hn.buildingPart==="entrance"){const wt=new Array;for(let Sn=0;Sn<hn.indices.length;Sn+=12){const fi=hn.positions[Sn+0],pi=hn.positions[Sn+1],ui=hn.positions[Sn+3],Ki=hn.positions[Sn+4],Mr=hn.positions[Sn+2],ci=hn.positions[Sn+8]-Mr,fr=1,Qi=ui-fi,Li=Ki-pi,gr=Math.hypot(Qi,Li);wt.push({pos:[fi+.5*Qi,pi+.5*Li,Mr],normal:[Li/gr,-Qi/gr,0],width:gr,height:ci,depth:fr,points:[fi,pi,ui,Ki]})}const $t=lt.entranceBloom.segmentsBucket.prepareSegment(10*wt.length,lt.entranceBloom.layoutVertexArray,lt.entranceBloom.indexArray),Qt=lt.entranceBloom.layoutVertexArray.length;sn=lt.entranceBloom.indexArray.length,qE(wt,.5/this.tileToMeter,lt.entranceBloom.indexArray,lt.entranceBloom.layoutVertexArray,lt.entranceBloom.layoutAttenuationArray);const un=lt.entranceBloom.layoutVertexArray.length-Qt;pn=lt.entranceBloom.indexArray.length-sn;for(let Sn=0;Sn<un;Sn++)lt.entranceBloom.layoutColorArray.emplaceBack(65535,65535);$t.vertexLength+=un,$t.primitiveLength+=pn,wn={part:hn.buildingPart,vertexOffset:Qt,vertexLength:un}}for(let wt=0;wt<hn.positions.length;wt+=3)xn=Math.max(xn,hn.positions[wt+2]),lt.layoutVertexArray.emplaceBack(hn.positions[wt],hn.positions[wt+1],hn.positions[wt+2]);const Ti=Math.floor(Ut.x),ve=Math.floor(Ut.y),be=Math.floor(xn);for(let wt=0;wt<hn.positions.length;wt+=3)lt.layoutCentroidArray.emplaceBack(Ti,ve,be);for(let wt=0;wt<hn.normals.length;wt+=3)lt.layoutNormalArray.emplaceBack(hn.normals[wt+0]*L1,hn.normals[wt+1]*L1,hn.normals[wt+2]*L1);for(let wt=0;wt<hn.ao.length;wt++)lt.layoutAOArray.push(hn.ao[wt]);for(let wt=0;wt<hn.colors.length;wt+=3){const $t=1+(hn.ao[wt/3]-1)*le;lt.layoutColorArray.emplaceBack(hn.colors[wt]*$t<<8|hn.colors[wt+1]*$t,hn.colors[wt+2]*$t<<8)}if(ge){for(let wt=0;wt<hn.positions.length;wt+=3)lt.layoutFacadePaintArray.emplaceBack(65535,255);for(let wt=0;wt<hn.isFauxFacade.length;wt++)if(hn.isFauxFacade[wt]){const $t=1|Math.min(65535,Math.floor(hn.uv[2*wt]*kt.outerRingLength)),Qt=Math.floor(255*Ve)<<8|Math.floor(255*We),un=Math.floor(65535*Math.min(1,He/Yt)),Sn=Math.floor(65535*Math.min(1,Tt/Yt));lt.layoutFacadeDataArray.emplaceBack($t,Qt,un,Sn);const fi=Math.floor(65535*Math.min(1,Ke/Yt)),pi=Math.floor(65535*Math.min(1,Et/Yt));lt.layoutFacadeVerticalRangeArray.emplaceBack(fi,pi)}else lt.layoutFacadeDataArray.emplaceBack(0,0,0,0),lt.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const ht=jt.vertexLength;for(let wt=0;wt<hn.indices.length;wt+=3)lt.indexArray.emplaceBack(ht+hn.indices[wt],ht+hn.indices[wt+1],ht+hn.indices[wt+2]);jt.vertexLength+=hn.positions.length/3,jt.primitiveLength+=hn.indices.length/3,(hn.buildingPart==="roof"||hn.buildingPart==="wall"||hn.buildingPart==="facade_glazing"||hn.buildingPart==="entrance")&&Nt.push({part:hn.buildingPart,vertexOffset:ei,vertexLength:hn.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,xn),this.buildingFeatures.push({feature:z,hasFauxFacade:ge,segment:jt,parts:Nt,buildingBloom:wn});const Zn=lt.indexArray.length-Xt,en=[],_n=[],zn=new Mt(1/0,1/0),$n=new Mt(-1/0,-1/0),di=this.groundEffect.vertexArray.length;for(const hn of kt.modifiedPolygonRings){const ei=[],Ti=new Mt(1/0,1/0),ve=new Mt(-1/0,-1/0);for(let be=0;be<hn.length;be+=2){const ht=hn.length-be-2;Ti.x=Math.min(Ti.x,hn[ht]),Ti.y=Math.min(Ti.y,hn[ht+1]),ve.x=Math.max(ve.x,hn[ht]),ve.y=Math.max(ve.y,hn[ht+1]);const wt=new Mt(hn[ht],hn[ht+1]);ei.push(wt),en.push(wt.x,wt.y),_n.push(wt.clone())}zn.x=Math.min(zn.x,Ti.x),zn.y=Math.min(zn.y,Ti.y),$n.x=Math.max($n.x,ve.x),$n.y=Math.max($n.y,ve.y),this.groundEffect.addData(ei,[Ti,ve],he)}const ni=this.groundEffect.vertexArray.length-di;(It.x<0||Pt.x>Yt||It.y<0||Pt.y>Yt)&&this.featuresOnBorder.push({featureId:w.id,footprintIndex:this.footprints.length});{const hn=If(en,null,2),ei=new zy(_n,hn,8,256);let Ti=w.id;w.properties&&w.properties.hasOwnProperty("building_id")&&(Ti=w.properties.building_id),this.footprints.push({vertices:_n,indices:hn,grid:ei,min:zn,max:$n,buildingId:Ti,hiddenFlags:0,indicesOffset:Xt,indicesLength:Zn,bloomIndicesOffset:sn,bloomIndicesLength:pn,groundEffectVertexOffset:di,groundEffectVertexLength:ni,hasFauxFacade:ge,segment:jt,height:xn})}this.programConfigurations.populatePaintArrays(lt.layoutVertexArray.length,w,E,{},i.availableImages,l,i.brightness),this.groundEffect.addPaintPropertiesData(w,E,{},i.availableImages,l,i.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,l,u,f,p,v){this.programConfigurations.updatePaintArrays(e,i,f,l,u,p,v),this.groundEffect.update(e,i,f,l,u,p,v),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=l=>{l.layoutVertexBuffer=e.createVertexBuffer(l.layoutVertexArray,HE.members),l.layoutNormalBuffer=e.createVertexBuffer(l.layoutNormalArray,C3.members),l.layoutCentroidBuffer=e.createVertexBuffer(l.layoutCentroidArray,P3.members),l.layoutFacadeDataArray&&l.layoutFacadeDataArray.length&&(l.layoutFacadeDataBuffer=e.createVertexBuffer(l.layoutFacadeDataArray,R3.members)),l.layoutFacadeVerticalRangeArray&&l.layoutFacadeVerticalRangeArray.length&&(l.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(l.layoutFacadeVerticalRangeArray,z3.members)),l.entranceBloom.layoutVertexArray.length&&(l.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(l.entranceBloom.layoutVertexArray,HE.members),l.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(l.entranceBloom.layoutAttenuationArray,D3.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,l=!0){let u=!1;const f=l?i:0,p=0|(l?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of e){const w=this.footprints[v],E=w.hiddenFlags&p|f;w.hiddenFlags!==E&&(w.hiddenFlags=E,u=!0,this.groundEffect.updateHiddenByLandmarkRange(w.groundEffectVertexOffset,w.groundEffectVertexLength,w.hiddenFlags!==0))}return u&&(this.indexArrayForConflationUploaded=!1),u}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=u=>{u.indexArray.length!==0&&(u.indexArrayForConflation.resize(u.indexArray.length),u.indexArrayForConflation.uint16.set(u.indexArray.uint16),u.entranceBloom.indexArrayForConflation.resize(u.entranceBloom.indexArray.length),u.entranceBloom.indexArrayForConflation.uint16.set(u.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const u of this.footprints){const f=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,p=u.indicesOffset+u.indicesLength;if(u.hiddenFlags!==0){for(let w=u.indicesOffset;w<p;w++)f.indexArrayForConflation.uint16[3*w+0]=0,f.indexArrayForConflation.uint16[3*w+1]=0,f.indexArrayForConflation.uint16[3*w+2]=0;const v=u.bloomIndicesOffset+u.bloomIndicesLength;for(let w=u.bloomIndicesOffset;w<v;w++)f.entranceBloom.indexArrayForConflation.uint16[3*w+0]=0,f.entranceBloom.indexArrayForConflation.uint16[3*w+1]=0,f.entranceBloom.indexArrayForConflation.uint16[3*w+2]=0}}const l=u=>{u.indexArray.length!==0&&(u.indexBuffer?u.indexBuffer.updateData(u.indexArrayForConflation):u.indexBuffer=e.createIndexBuffer(u.indexArrayForConflation,!0),u.entranceBloom.indexBuffer?u.entranceBloom.indexBuffer.updateData(u.entranceBloom.indexArrayForConflation):u.entranceBloom.indexBuffer=e.createIndexBuffer(u.entranceBloom.indexArrayForConflation,!0))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=l=>{l.layoutColorBuffer?l.layoutColorBuffer.updateData(l.layoutColorArray):l.layoutColorBuffer=e.createVertexBuffer(l.layoutColorArray,ZE.members,!0),l.layoutFacadePaintArray&&(l.layoutFacadePaintBuffer?l.layoutFacadePaintBuffer.updateData(l.layoutFacadePaintArray):l.layoutFacadePaintBuffer=e.createVertexBuffer(l.layoutFacadePaintArray,k3.members,!0)),l.entranceBloom.layoutColorBuffer?l.entranceBloom.layoutColorBuffer.updateData(l.entranceBloom.layoutColorArray):l.entranceBloom.layoutColorBuffer=e.createVertexBuffer(l.entranceBloom.layoutColorArray,ZE.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const l=e.paint.get("building-ambient-occlusion-intensity");for(const u of this.buildingFeatures){const f=i[u.feature.id],p=u.feature;p.properties["building-part"]="roof";const v=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),w=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical);p.properties["building-part"]="wall";const E=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),C=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical);p.properties["building-part"]="window";const z=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),L=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical);p.properties["building-part"]="door";const N=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),U=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical),X=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const Q of u.parts){let le,he=v;Q.part==="roof"?(he=v,le=w):Q.part==="wall"?(he=E,le=C):Q.part==="facade_glazing"?(he=z,le=L):Q.part==="entrance"&&(he=N,le=U),le=Pe(le,0,1);for(let ge=0;ge<Q.vertexLength;ge++){const Le=Q.vertexOffset+ge,Oe=1+(X.layoutAOArray[Le]-1)*l;X.layoutColorArray.emplace(Le,he.r*Oe*255<<8|he.g*Oe*255,he.b*Oe*255<<8|255*le),u.hasFauxFacade&&X.layoutFacadePaintArray.emplace(Le,255*z.r<<8|255*z.g,255*z.b<<8|255*L)}}const J=u.buildingBloom;if(J)for(let Q=0;Q<J.vertexLength;Q++)X.entranceBloom.layoutColorArray.emplace(J.vertexOffset+Q,255*N.r<<8|255*N.g,255*N.b<<8|51*U)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,l){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(Ly(this.activeReplacements,u))return;this.activeReplacements=u;for(const p of this.footprints)p.hiddenFlags&=-2;const f=[];for(const p of this.activeReplacements){if(p.order<=eE)continue;const v=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));for(const w of this.footprints)w.min.x>p.max.x||w.max.x<p.min.x||w.min.y>p.max.y||w.max.y<p.min.y||(f.length=0,O3(w.vertices,0,w.vertices.length,p.footprintTileId.canonical,e.canonical,f),g1(p.footprint,f,w.indices,0,w.indices.length,0,-v)&&(w.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const p of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(p.groundEffectVertexOffset,p.groundEffectVertexLength,p.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,i){let l=Number.NEGATIVE_INFINITY,u=!0;const f=4*(e+Yt)*Yt+(i+Yt);if(this.footprintLookup.hasOwnProperty(f)){const v=this.footprintLookup[f];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}const p=new Mt(e,i);for(const v of this.footprints)e>v.max.x||v.min.x>e||i>v.max.y||v.min.y>i||v.height<=l||_1(p,v)&&(l=v.height,this.footprintLookup[f]=v,u=v.hiddenFlags!==0);if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.footprintLookup[f]=void 0}}function O3(o,e,i,l,u,f){const p=Math.pow(2,l.z-u.z);for(let v=0;v<i;v++){let w=o[v+e].x,E=o[v+e].y;w=(w+u.x*Yt)*p-l.x*Yt,E=(E+u.y*Yt)*p-l.y*Yt,f.push(new Mt(w,E))}}let JE,QE;ln(KE,"BuildingBucket",{omit:["layers"]}),ln(O1,"BuildingGeometry"),ln(YE,"BuildingBloomGeometry");const F3=xi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),B3=xi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:N3}=F3,V3=xi([{name:"a_packed",components:3,type:"Float32"}]),{members:U3}=V3,j3=xi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:G3}=j3;class $E{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new zu({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const l=this.getKey(e,i);return this.positions[l]}trim(){const e=this.width,i=this.height=dn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,l){const u=[];let f=e.length%2==1?-e[e.length-1]*l:0,p=e[0]*l,v=!0;u.push({left:f,right:p,isDash:v,zeroLength:e[0]===0});let w=e[0];for(let E=1;E<e.length;E++){v=!v;const C=e[E];f=w*l,w+=C,p=w*l,u.push({left:f,right:p,isDash:v,zeroLength:C===0})}return u}addRoundDash(e,i,l){const u=i/2;for(let f=-l;f<=l;f++){const p=this.width*(this.nextRow+l+f);let v=0,w=e[v];for(let E=0;E<this.width;E++){E/w.right>1&&(w=e[++v]);const C=Math.abs(E-w.left),z=Math.abs(E-w.right),L=Math.min(C,z);let N;const U=f/l*(u+1);if(w.isDash){const X=u-Math.abs(U);N=Math.sqrt(L*L+X*X)}else N=u-Math.sqrt(L*L+U*U);this.image.data[p+E]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const E=e[w],C=e[w+1];E.zeroLength?e.splice(w,1):C&&C.isDash===E.isDash&&(C.left=E.left,e.splice(w,1))}const l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const f=this.width*this.nextRow;let p=0,v=e[p];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++p]);const E=Math.abs(w-v.left),C=Math.abs(w-v.right),z=Math.min(E,C);this.image.data[f+w]=Math.max(0,Math.min(255,(v.isDash?z:-z)+i+128))}}addDash(e,i){const l=this.getKey(e,i);if(this.positions[l])return this.positions[l];const u=i==="round",f=u?7:0,p=2*f+1;if(this.nextRow+p>this.height)return oi("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let C=0;C<e.length;C++)e[C]<0&&(oi("Negative value is found in line dasharray, replacing values with 0"),e[C]=0),v+=e[C];if(v!==0){const C=this.width/v,z=this.getDashRanges(e,this.width,C);u?this.addRoundDash(z,C,f):this.addRegularDash(z,i==="square"?.5*C:0)}const w=this.nextRow+f;this.nextRow+=p;const E={tl:[w,f],br:[v,0]};return this.positions[l]=E,E}}ln($E,"LineAtlas");const W3=Ot.types,q3=Math.cos(Math.PI/180*37.5),H3=Math.cos(Math.PI/180*5);class F1{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new mf,this.layoutVertexArray2=new Ss,this.patternVertexArray=new Ss,this.indexArray=new Eo,this.programConfigurations=new wa(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Fr,this.maxLineLength=0,this.zOffsetVertexArray=new Ss,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:Yt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,u){this.hasPattern=u1("line",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("line-sort-key");this.tileToMeter=$e(l);const p=this.layers[0].layout.get("line-elevation-reference");if(p==="hd-road-markup")this.elevationType="road";else{const L=this.layers[0].layout.get("line-z-offset"),N=L.isConstant()&&!L.constantOr(0);this.elevationType=p!=="sea"&&p!=="ground"&&N?"none":"offset",this.elevationType==="offset"&&p==="none"&&oi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const w=[];for(const{feature:L,id:N,index:U,sourceLayerIndex:X}of e){const J=this.layers[0]._featureFilter.needGeometry,Q=Vt(L,J);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom,{worldview:this.worldview}),Q,l))continue;const le=f?f.evaluate(Q,{},l):void 0,he={id:N,properties:L.properties,type:L.type,sourceLayerIndex:X,index:U,geometry:J?Q.geometry:nn(L,l,u),patterns:{},sortKey:le};w.push(he)}f&&w.sort(((L,N)=>L.sortKey-N.sortKey));const{lineAtlas:E,featureIndex:C}=i,z=this.addConstantDashes(E);for(const L of w){const{geometry:N,index:U,sourceLayerIndex:X}=L;if(z&&this.addFeatureDashes(L,E),this.hasPattern){const J=h1("line",this.layers,L,this.zoom,this.pixelRatio,i);this.patternFeatures.push(J)}else this.addFeature(L,N,U,l,E.positions,i.availableImages,i.brightness,i.elevationFeatures);C.insert(e[U].feature,N,U,X,this.index)}}addConstantDashes(e){let i=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(u.kind!=="constant"||f.kind!=="constant")i=!0;else{const p=f.value,v=u.value;if(!v)continue;e.addDash(v,p)}}return i}addFeatureDashes(e,i){const l=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(f.kind==="constant"&&p.kind==="constant")continue;let v,w;if(f.kind==="constant"){if(v=f.value,!v)continue}else v=f.evaluate({zoom:l},e);w=p.kind==="constant"?p.value:p.evaluate({zoom:l},e),i.addDash(v,w),e.patterns[u.id]=[i.getKey(v,w)]}}update(e,i,l,u,f,p,v,w){this.programConfigurations.updatePaintArrays(e,i,f,l,u,p,v,w)}addFeatures(e,i,l,u,f,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,l,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,U3)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,G3)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,B3.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,N3),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let l,u;if(i&&i>0?(l=`mapbox_clip_start_${i}`,u=`mapbox_clip_end_${i}`):(l="mapbox_clip_start",u="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(l)&&e.properties.hasOwnProperty(u))return{start:+e.properties[l],end:+e.properties[u]}}addFeature(e,i,l,u,f,p,v,w){const E=this.layers[0].layout,C=E.get("line-join").evaluate(e,{}),z=E.get("line-cap").evaluate(e,{}),L=E.get("line-miter-limit"),N=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const U=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=E.get("line-z-offset").value;const X=this.layers[0].paint.get("line-width").value;if(X.kind!=="constant"&&X.isLineProgressConstant===!1&&(this.variableWidthValue=X),this.elevationType==="road"){const J=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,u,w,C,z,L,N)){const[Q,le]=this.clipRuntimeLinesToTile(i,1);for(let he=0;he<Q.length;he++){const ge=Q[he],Le=le[he],Oe={progress:{min:Le.progress.min,max:Le.progress.max},nextDir:this.computeSegNextDir(Le,ge),prevDir:this.computeSegPrevDir(Le,ge)};this.addLine(ge,e,u,C,z,L,N,Oe,U&&Le.parentIndex>0?Le.parentIndex:null)}this.fillNonElevatedRoadSegment(J)}}else for(let J=0;J<i.length;J++)this.addLine(i[J],e,u,C,z,L,N,void 0,U&&J>0?J:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,f,p,u,v,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return By(e,-i,-i,Yt+i,Yt+i)}clipRuntimeLinesToTile(e,i){const l=[];return[By(e,-i,-i,Yt+i,Yt+i,l),l]}addElevatedRoadFeature(e,i,l,u,f,p,v,w){const E=[],C=Dr.getElevationFeature(e,u);if(C){const z=this.clipLinesToTile(i,1),L=this.prepareElevatedLines(z,C,l);for(const N of L)E.push({geometry:N,elevation:C,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(E.length===0)return!1;for(const z of E){const L=this.layoutVertexArray.length;this.addLine(z.geometry,e,l,f,p,v,w);const N=new lo(l,z.elevationTileID);if(z.elevation)for(let U=L;U<this.layoutVertexArray.length;U++){const X=new Mt(this.layoutVertexArray.int16[6*U]>>1,this.layoutVertexArray.int16[6*U+1]>>1),J=N.pointElevation(X,z.elevation,.05);this.updateHeightRange(J),this.zOffsetVertexArray.emplaceBack(J,0,0)}else this.fillNonElevatedRoadSegment(L)}return!0}prepareElevatedLines(e,i,l){if(i.constantHeight!=null)return e;const u=[],f=1/$e(l);for(const p of e)o3(p,new Yi(i,f),0,u);return u}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,l,u,f,p,v,w,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=E?this.lineFeatureClips(i,E):this.lineClips;const C=u==="none";this.patternJoinNone=this.hasPattern&&C,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const z=w&&w.progress.min>0,L=w&&w.progress.max<1;if(this.lineClips){let He={min:this.lineClips.start,max:this.lineClips.end},Tt=1;if(w){const Ft=this.lineClips.end-this.lineClips.start;He=(function(It,Pt,Ut){return{min:Ma(It.min,Pt,Ut),max:Ma(It.max,Pt,Ut)}})(w.progress,{min:0,max:1},He),Ft>0&&(Tt=(He.max-He.min)/Ft)}const Ke=+i.properties.mapbox_clip_feature_len,Et=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Ke)||Number.isNaN(Et)){for(let It=0;It<e.length-1;It++)this.totalDistance+=e[It].dist(e[It+1]);const Ft=this.totalDistance/(He.max-He.min);this.totalFeatureLength=Number.isFinite(Ft)?Ft:0,this.lineClips.start=He.min,this.lineClips.end=He.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ke,this.distance=Et*Tt,this.lineClips.start=He.min,this.lineClips.end=He.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const N=W3[i.type]==="Polygon";let U=e.length;for(;U>=2&&e[U-1].equals(e[U-2]);)U--;let X=0;for(;X<U-1&&e[X].equals(e[X+1]);)X++;if(U<(N?3:2))return;u==="bevel"&&(p=1.05);const J=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray);let Q,le,he,ge,Le,Oe,Ve,We;w&&w.prevDir&&(Oe=w.prevDir.perp()),w&&w.nextDir&&(Ve=w.nextDir.perp()),this.e1=this.e2=-1,N&&(Q=e[U-2],Le=e[X].sub(Q)._unit()._perp());for(let He=X;He<U;He++){if(he=He===U-1?N?e[X+1]:void 0:e[He+1],he&&e[He].equals(he))continue;Le&&(ge=Le),Q&&(le=Q),Q=e[He],We=this.evaluateLineProgressFeatures(le?le.dist(Q):0),Le=he?he.sub(Q)._unit()._perp():ge,ge=ge||Le;const Tt=le&&he;let Ke=Tt?u:N||C?"butt":f;const Et=ge.x*Le.x+ge.y*Le.y;if(C){const lt=function(jt){if(jt.patternJoinNone){const Nt=jt.segmentPoints.length/2,wn=jt.lineSoFar-jt.segmentStart;for(let sn=0;sn<Nt;++sn){const pn=jt.segmentPoints[2*sn+1],Xt=Math.round(jt.segmentPoints[2*sn])+.5+.25*pn;jt.patternVertexArray.emplaceBack(Xt,wn,jt.segmentStart),jt.patternVertexArray.emplaceBack(Xt,wn,jt.segmentStart)}jt.segmentPoints.length=0}jt.e1=jt.e2=-1};if(Tt&&Et<H3){this.updateDistance(le,Q),this.addCurrentVertex(Q,ge,1,1,J,We),lt(this),this.addCurrentVertex(Q,Le,-1,-1,J,We);continue}if(le){if(!he){this.updateDistance(le,Q),this.addCurrentVertex(Q,ge,1,1,J,We),lt(this);continue}Ke="miter"}}let Ft=ge.add(Le);Ft.x===0&&Ft.y===0||Ft._unit();const It=Ft.x*Le.x+Ft.y*Le.y,Pt=It!==0?1/It:1/0,Ut=2*Math.sqrt(2-2*It),bt=It<q3&&le&&he,kt=ge.x*Le.y-ge.y*Le.x>0,dt=this.overscaling<=16?15*Yt/(512*this.overscaling):0;if(Tt&&Ke==="round"){if(Pt<v)Ke="miter";else if(Pt<=2){const lt=B1(Q,-10,Yt+10);Ke=this.elevationType==="offset"&&(lt||this.hasCrossSlope)?"miter":"fakeround"}}if(Ke==="miter"&&Pt>p&&(Ke="bevel"),Ke==="bevel"&&(Pt>2&&(Ke="flipbevel"),Pt<p&&(Ke="miter")),le&&!(Ke==="miter"&&bt)&&this.updateDistance(le,Q),Ke==="miter")if(bt){const lt=Q.dist(le);if(lt>2*dt){const Nt=Q.sub(Q.sub(le)._mult(dt/lt)._round());this.updateDistance(le,Nt),this.addCurrentVertex(Nt,ge,0,0,J,We),le=Nt}this.updateDistance(le,Q),Ft._mult(Pt),this.addCurrentVertex(Q,Ft,0,0,J,We);const jt=Q.dist(he);if(jt>2*dt){const Nt=Q.add(he.sub(Q)._mult(dt/jt)._round());this.updateDistance(Q,Nt),this.addCurrentVertex(Nt,Le,0,0,J,We),Q=Nt}}else Ft._mult(Pt),this.addCurrentVertex(Q,Ft,0,0,J,We);else if(Ke==="flipbevel"){if(Pt>100)Ft=Le.mult(-1);else{const lt=Pt*ge.add(Le).mag()/ge.sub(Le).mag();Ft._perp()._mult(lt*(kt?-1:1))}this.addCurrentVertex(Q,Ft,0,0,J,We),this.addCurrentVertex(Q,Ft.mult(-1),0,0,J,We)}else if(Ke==="bevel"||Ke==="fakeround"){We!=null&&le&&this.addCurrentVertex(Q,Ve||ge,-1,-1,J,We);const lt=Q.dist(le)<=2*dt&&Ke!=="bevel",jt=Ft.mult(kt?1:-1);jt._mult(Pt);const Nt=Le.mult(kt?-1:1),wn=ge.mult(kt?-1:1),sn=this.evaluateLineProgressFeatures(this.distance);if(We==null&&(this.addHalfVertex(Q,jt.x,jt.y,!1,!kt,0,J,sn),lt||this.addHalfVertex(Q,jt.x+2*wn.x,jt.y+2*wn.y,!1,kt,0,J,sn)),Ke==="fakeround"){const pn=Math.round(180*Ut/Math.PI/20);this.addHalfVertex(Q,wn.x,wn.y,!1,kt,0,J,sn);for(let Xt=0;Xt<pn;Xt++){let xn=Xt/pn;if(xn!==.5){const en=xn-.5;xn+=xn*en*(xn-1)*((1.0904+Et*(Et*(3.55645-1.43519*Et)-3.2452))*en*en+(.848013+Et*(.215638*Et-1.06021)))}const Zn=Nt.sub(wn)._mult(xn)._add(wn)._unit();this.addHalfVertex(Q,Zn.x,Zn.y,!1,kt,0,J,sn)}this.addHalfVertex(Q,Nt.x,Nt.y,!1,kt,0,J,sn)}lt||We!=null||this.addHalfVertex(Q,jt.x+2*Nt.x,jt.y+2*Nt.y,!1,kt,0,J,sn),We!=null&&he&&this.addCurrentVertex(Q,Oe||Le,1,1,J,We)}else if(Ke==="butt")this.addCurrentVertex(Q,Ft,0,0,J,We);else if(Ke==="square"){if(!le){const lt=z?0:-1;this.addCurrentVertex(Q,Ft,lt,lt,J,We)}if(this.addCurrentVertex(Q,Ft,0,0,J,We),le){const lt=L?0:1;this.addCurrentVertex(Q,Ft,lt,lt,J,We)}}else if(Ke==="round"){if(le){const lt=!Tt&&Ve?Ve:ge;this.addCurrentVertex(Q,lt,0,0,J,We),!Tt&&L||this.addCurrentVertex(Q,lt,1,1,J,We,!0)}if(he){const lt=!Tt&&Oe?Oe:Le;!Tt&&z||this.addCurrentVertex(Q,lt,-1,-1,J,We,!0),this.addCurrentVertex(Q,lt,0,0,J,We)}}}}addVerticesTo(e,i,l,u,f,p,v,w,E,C){const z=(i.w-e.w)/this.tessellationStep|0;let L=0;const N=this.scaledDistance;if(z>1){this.lineSoFar=e.w;const X=(i.x-e.x)/z,J=(i.y-e.y)/z,Q=(i.z-e.z)/z,le=(i.w-e.w)/z;for(let he=1;he<z;++he){e.x+=X,e.y+=J,e.z+=Q,this.lineSoFar+=le,L+=le;const ge=this.evaluateLineProgressFeatures(this.prevDistance+L);this.scaledDistance=(this.prevDistance+L)/this.totalDistance,this.addHalfVertex(e,l,u,C,!1,v,E,ge),this.addHalfVertex(e,f,p,C,!0,-w,E,ge)}}this.lineSoFar=i.w,this.scaledDistance=N;const U=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,l,u,C,!1,v,E,U),this.addHalfVertex(i,f,p,C,!0,-w,E,U)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):oi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,l,u,f,p,v=!1){const w=i.x+i.y*l,E=i.y-i.x*l,C=i.y*u-i.x,z=-i.y-i.x*u;if(p!=null){const L=this.elevationType==="offset",N=-10,U=Yt+10,X=p.zOffset,J=new bE(e.x,e.y,X,this.lineSoFar),Q=!!L&&B1(e,N,U),le=this.lineSoFar,he=this.distance;if(this.currentVertex)if(Q){const ge=this.currentVertexIsOutside,Le=this.currentVertex,Oe=new bE(e.x,e.y,X,this.lineSoFar);if(TE(Le,Oe,N,U),!B1(Oe,N,U)){if(ge){this.e1=this.e2=-1,this.distance-=Le.dist(J),this.lineSoFar=Le.w;const Ve=this.evaluateLineProgressFeatures(Le.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Le,w,E,v,!1,l,f,Ve),this.addHalfVertex(Le,C,z,v,!0,-u,f,Ve),this.prevDistance=this.distance}this.distance=this.prevDistance+Le.dist(Oe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Le,Oe,w,E,C,z,l,u,f,v),this.distance=he,this.scaledDistance=this.distance/this.totalDistance}}else{const ge=this.currentVertex;if(this.currentVertexIsOutside){TE(ge,J,N,U),this.e1=this.e2=-1,this.distance-=ge.dist(J),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ge.w;const Le=this.evaluateLineProgressFeatures(ge.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ge,w,E,v,!1,l,f,Le),this.addHalfVertex(ge,C,z,v,!0,-u,f,Le),this.prevDistance=this.distance,this.distance=he,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ge,J,w,E,C,z,l,u,f,v)}else Q||(this.addHalfVertex(e,w,E,v,!1,l,f,p),this.addHalfVertex(e,C,z,v,!0,-u,f,p));this.currentVertex=J,this.currentVertexIsOutside=Q,this.lineSoFar=le}else this.addHalfVertex(e,w,E,v,!1,l,f,p),this.addHalfVertex(e,C,z,v,!0,-u,f,p)}addHalfVertex({x:e,y:i},l,u,f,p,v,w,E){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(p?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const z=Rn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,z)}const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),w.primitiveLength++),p?this.e2=C:this.e1=C,E!=null&&this.zOffsetVertexArray.emplaceBack(E.zOffset,E.variableWidth,E.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function B1(o,e,i){return o.x<e||o.x>i||o.y<e||o.y>i}let eA,tA;function nA(o,e,i){return e*(Yt/(o.tileSize*Math.pow(2,i-o.tileID.overscaledZ)))}ln(F1,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const iA=(o,e,i)=>(1-i)*o+i*e;function rA(o,e){return 1/nA(o,1,e.tileZoom)}function oA(o,e,i,l){return o.translatePosMatrix(l||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const sA=o=>{const e=[];aA(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=o.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=o.layout.get("line-join").constantOr("miter")==="none",u=!!o.paint.get("line-pattern").constantOr(1);return l&&u&&e.push("LINE_JOIN_NONE"),e};function aA(o){const e=o.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let N1;const lA=()=>N1||(N1={layout:eA||(eA=new Ur({"line-cap":new tn(Ye.layout_line["line-cap"]),"line-join":new tn(Ye.layout_line["line-join"]),"line-miter-limit":new Wt(Ye.layout_line["line-miter-limit"]),"line-round-limit":new Wt(Ye.layout_line["line-round-limit"]),"line-sort-key":new tn(Ye.layout_line["line-sort-key"]),"line-z-offset":new tn(Ye.layout_line["line-z-offset"]),"line-elevation-reference":new Wt(Ye.layout_line["line-elevation-reference"]),"line-cross-slope":new Wt(Ye.layout_line["line-cross-slope"]),visibility:new Wt(Ye.layout_line.visibility),"line-width-unit":new Wt(Ye.layout_line["line-width-unit"])})),paint:tA||(tA=new Ur({"line-opacity":new tn(Ye.paint_line["line-opacity"]),"line-color":new tn(Ye.paint_line["line-color"]),"line-translate":new Wt(Ye.paint_line["line-translate"]),"line-translate-anchor":new Wt(Ye.paint_line["line-translate-anchor"]),"line-width":new tn(Ye.paint_line["line-width"]),"line-gap-width":new tn(Ye.paint_line["line-gap-width"]),"line-offset":new tn(Ye.paint_line["line-offset"]),"line-blur":new tn(Ye.paint_line["line-blur"]),"line-dasharray":new tn(Ye.paint_line["line-dasharray"]),"line-pattern":new tn(Ye.paint_line["line-pattern"]),"line-pattern-cross-fade":new Wt(Ye.paint_line["line-pattern-cross-fade"]),"line-gradient":new bu(Ye.paint_line["line-gradient"]),"line-trim-offset":new Wt(Ye.paint_line["line-trim-offset"]),"line-trim-fade-range":new Wt(Ye.paint_line["line-trim-fade-range"]),"line-trim-color":new Wt(Ye.paint_line["line-trim-color"]),"line-emissive-strength":new Wt(Ye.paint_line["line-emissive-strength"]),"line-border-width":new tn(Ye.paint_line["line-border-width"]),"line-border-color":new tn(Ye.paint_line["line-border-color"]),"line-occlusion-opacity":new Wt(Ye.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},N1);class Z3 extends tn{possiblyEvaluate(e,i){return i=new dr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,l,u){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,l,u)}}let ig;function cA(o,e){return e>0?e+2*o:o}const X3=xi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Y3=xi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),K3=xi([{name:"a_projected_pos",components:4,type:"Float32"}],4);xi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const J3=xi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Q3=xi([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),$3=xi([{name:"a_texb",components:2,type:"Uint16"}]),eO=xi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),tO=xi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const uA=xi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nO=xi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xi([{name:"triangle",components:3,type:"Uint16"}]),xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),xi([{type:"Float32",name:"offsetX"}]),xi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var No=24;function iO(o,e,i){return o.sections.forEach((l=>{l.text=(function(u,f,p){const v=f.layout.get("text-transform").evaluate(p,{});return v==="uppercase"?u=u.toLocaleUpperCase():v==="lowercase"&&(u=u.toLocaleLowerCase()),za.applyArabicShaping&&(u=za.applyArabicShaping(u)),u})(l.text,e,i)})),o}const rg={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function rO(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}function oO(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}const V1=4294967296,hA=1/V1,dA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Hy=class{constructor(o=new Uint8Array(16)){this.buf=ArrayBuffer.isView(o)?o:new Uint8Array(o),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(o,e,i=this.length){for(;this.pos<i;){const l=this.readVarint(),u=l>>3,f=this.pos;this.type=7&l,o(u,e,this),this.pos===f&&this.skip(l)}return e}readMessage(o,e){return this.readFields(o,e,this.readVarint()+this.pos)}readFixed32(){const o=this.dataView.getUint32(this.pos,!0);return this.pos+=4,o}readSFixed32(){const o=this.dataView.getInt32(this.pos,!0);return this.pos+=4,o}readFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*V1;return this.pos+=8,o}readSFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*V1;return this.pos+=8,o}readFloat(){const o=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,o}readDouble(){const o=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,o}readVarint(o){const e=this.buf;let i,l;return l=e[this.pos++],i=127&l,l<128?i:(l=e[this.pos++],i|=(127&l)<<7,l<128?i:(l=e[this.pos++],i|=(127&l)<<14,l<128?i:(l=e[this.pos++],i|=(127&l)<<21,l<128?i:(l=e[this.pos],i|=(15&l)<<28,(function(u,f,p){const v=p.buf;let w,E;if(E=v[p.pos++],w=(112&E)>>4,E<128||(E=v[p.pos++],w|=(127&E)<<3,E<128)||(E=v[p.pos++],w|=(127&E)<<10,E<128)||(E=v[p.pos++],w|=(127&E)<<17,E<128)||(E=v[p.pos++],w|=(127&E)<<24,E<128)||(E=v[p.pos++],w|=(1&E)<<31,E<128))return Df(u,w,f);throw new Error("Expected varint not more than 10 bytes")})(i,o,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const o=this.readVarint();return o%2==1?(o+1)/-2:o/2}readBoolean(){return!!this.readVarint()}readString(){const o=this.readVarint()+this.pos,e=this.pos;return this.pos=o,o-e>=12&&dA?dA.decode(this.buf.subarray(e,o)):(function(i,l,u){let f="",p=l;for(;p<u;){const v=i[p];let w,E,C,z=null,L=v>239?4:v>223?3:v>191?2:1;if(p+L>u)break;L===1?v<128&&(z=v):L===2?(w=i[p+1],(192&w)==128&&(z=(31&v)<<6|63&w,z<=127&&(z=null))):L===3?(w=i[p+1],E=i[p+2],(192&w)==128&&(192&E)==128&&(z=(15&v)<<12|(63&w)<<6|63&E,(z<=2047||z>=55296&&z<=57343)&&(z=null))):L===4&&(w=i[p+1],E=i[p+2],C=i[p+3],(192&w)==128&&(192&E)==128&&(192&C)==128&&(z=(15&v)<<18|(63&w)<<12|(63&E)<<6|63&C,(z<=65535||z>=1114112)&&(z=null))),z===null?(z=65533,L=1):z>65535&&(z-=65536,f+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),f+=String.fromCharCode(z),p+=L}return f})(this.buf,e,o)}readBytes(){const o=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,o);return this.pos=o,e}readPackedVarint(o=[],e){const i=this.readPackedEnd();for(;this.pos<i;)o.push(this.readVarint(e));return o}readPackedSVarint(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSVarint());return o}readPackedBoolean(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readBoolean());return o}readPackedFloat(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFloat());return o}readPackedDouble(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readDouble());return o}readPackedFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed32());return o}readPackedSFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed32());return o}readPackedFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed64());return o}readPackedSFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed64());return o}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(o){const e=7&o;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(o,e){this.writeVarint(o<<3|e)}realloc(o){let e=this.length||16;for(;e<this.pos+o;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeSFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*hA),!0),this.pos+=8}writeSFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*hA),!0),this.pos+=8}writeVarint(o){(o=+o||0)>268435455||o<0?(function(e,i){let l,u;if(e>=0?(l=e%4294967296|0,u=e/4294967296|0):(l=~(-e%4294967296),u=~(-e/4294967296),4294967295^l?l=l+1|0:(l=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(f,p,v){v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,v.buf[v.pos]=127&(f>>>=7)})(l,0,i),(function(f,p){const v=(7&f)<<4;p.buf[p.pos++]|=v|((f>>>=3)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f)))))})(u,i)})(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))}writeSVarint(o){this.writeVarint(o<0?2*-o-1:2*o)}writeBoolean(o){this.writeVarint(+o)}writeString(o){o=String(o),this.realloc(4*o.length),this.pos++;const e=this.pos;this.pos=(function(l,u,f){for(let p,v,w=0;w<u.length;w++){if(p=u.charCodeAt(w),p>55295&&p<57344){if(!v){p>56319||w+1===u.length?(l[f++]=239,l[f++]=191,l[f++]=189):v=p;continue}if(p<56320){l[f++]=239,l[f++]=191,l[f++]=189,v=p;continue}p=v-55296<<10|p-56320|65536,v=null}else v&&(l[f++]=239,l[f++]=191,l[f++]=189,v=null);p<128?l[f++]=p:(p<2048?l[f++]=p>>6|192:(p<65536?l[f++]=p>>12|224:(l[f++]=p>>18|240,l[f++]=p>>12&63|128),l[f++]=p>>6&63|128),l[f++]=63&p|128)}return f})(this.buf,o,this.pos);const i=this.pos-e;i>=128&&fA(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(o){this.realloc(4),this.dataView.setFloat32(this.pos,o,!0),this.pos+=4}writeDouble(o){this.realloc(8),this.dataView.setFloat64(this.pos,o,!0),this.pos+=8}writeBytes(o){const e=o.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=o[i]}writeRawMessage(o,e){this.pos++;const i=this.pos;o(e,this);const l=this.pos-i;l>=128&&fA(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l}writeMessage(o,e,i){this.writeTag(o,2),this.writeRawMessage(e,i)}writePackedVarint(o,e){e.length&&this.writeMessage(o,sO,e)}writePackedSVarint(o,e){e.length&&this.writeMessage(o,aO,e)}writePackedBoolean(o,e){e.length&&this.writeMessage(o,uO,e)}writePackedFloat(o,e){e.length&&this.writeMessage(o,lO,e)}writePackedDouble(o,e){e.length&&this.writeMessage(o,cO,e)}writePackedFixed32(o,e){e.length&&this.writeMessage(o,hO,e)}writePackedSFixed32(o,e){e.length&&this.writeMessage(o,dO,e)}writePackedFixed64(o,e){e.length&&this.writeMessage(o,fO,e)}writePackedSFixed64(o,e){e.length&&this.writeMessage(o,pO,e)}writeBytesField(o,e){this.writeTag(o,2),this.writeBytes(e)}writeFixed32Field(o,e){this.writeTag(o,5),this.writeFixed32(e)}writeSFixed32Field(o,e){this.writeTag(o,5),this.writeSFixed32(e)}writeFixed64Field(o,e){this.writeTag(o,1),this.writeFixed64(e)}writeSFixed64Field(o,e){this.writeTag(o,1),this.writeSFixed64(e)}writeVarintField(o,e){this.writeTag(o,0),this.writeVarint(e)}writeSVarintField(o,e){this.writeTag(o,0),this.writeSVarint(e)}writeStringField(o,e){this.writeTag(o,2),this.writeString(e)}writeFloatField(o,e){this.writeTag(o,5),this.writeFloat(e)}writeDoubleField(o,e){this.writeTag(o,1),this.writeDouble(e)}writeBooleanField(o,e){this.writeVarintField(o,+e)}};function Df(o,e,i){return i?4294967296*e+(o>>>0):4294967296*(e>>>0)+(o>>>0)}function fA(o,e,i){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(l);for(let u=i.pos-1;u>=o;u--)i.buf[u+l]=i.buf[u]}function sO(o,e){for(let i=0;i<o.length;i++)e.writeVarint(o[i])}function aO(o,e){for(let i=0;i<o.length;i++)e.writeSVarint(o[i])}function lO(o,e){for(let i=0;i<o.length;i++)e.writeFloat(o[i])}function cO(o,e){for(let i=0;i<o.length;i++)e.writeDouble(o[i])}function uO(o,e){for(let i=0;i<o.length;i++)e.writeBoolean(o[i])}function hO(o,e){for(let i=0;i<o.length;i++)e.writeFixed32(o[i])}function dO(o,e){for(let i=0;i<o.length;i++)e.writeSFixed32(o[i])}function fO(o,e){for(let i=0;i<o.length;i++)e.writeFixed64(o[i])}function pO(o,e){for(let i=0;i<o.length;i++)e.writeSFixed64(o[i])}const U1=3;function mO(o,e,i){e.glyphs=[],o===1&&i.readMessage(gO,e)}function gO(o,e,i){if(o===3){const{id:l,bitmap:u,width:f,height:p,left:v,top:w,advance:E}=i.readMessage(_O,{});e.glyphs.push({id:l,bitmap:new zu({width:f+2*U1,height:p+2*U1},u),metrics:{width:f,height:p,left:v,top:w,advance:E}})}else o===4?e.ascender=i.readSVarint():o===5&&(e.descender=i.readSVarint())}function _O(o,e,i){o===1?e.id=i.readVarint():o===2?e.bitmap=i.readBytes():o===3?e.width=i.readVarint():o===4?e.height=i.readVarint():o===5?e.left=i.readSVarint():o===6?e.top=i.readSVarint():o===7&&(e.advance=i.readVarint())}const pA=U1,Xs={horizontal:1,vertical:2,horizontalOnly:3};class og{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const l=new og;return l.scale=e||1,l.fontStack=i,l}static forImage(e){const i=new og;return i.image=e,i}}class Lf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,l){const u=new Lf;for(let f=0;f<e.sections.length;f++){const p=e.sections[f];p.image?u.addImageSection(p,l):u.addTextSection(p,i)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,l){let u="";for(let f=0;f<i.length;f++){const p=i.charCodeAt(f+1)||null,v=i.charCodeAt(f-1)||null;u+=!l&&(p&&lf(p)&&!rg[i[f+1]]||v&&lf(v)&&!rg[i[f-1]])||!rg[i[f]]?i[f]:rg[i[f]]}return u})(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Zy[this.text.charCodeAt(l)];l++)e++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Zy[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const l=new Lf;return l.text=this.text.substring(e,i),l.sectionIndex=this.sectionIndex.slice(e,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(og.forText(e.scale,e.fontStack||i));const l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e,i){const l=e.image?e.image.getPrimary():null;if(!l)return void oi("Can't add FormattedSection with an empty image.");l.scaleSelf(i);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(og.forImage(l)),this.sectionIndex.push(this.sections.length-1)):oi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function j1(o,e,i,l,u,f,p,v,w,E,C,z,L,N,U,X=1){const J=Lf.fromFeature(o,u,X);z===Xs.vertical&&J.verticalizePunctuation(L);let Q=[];const le=(function(Ve,We,He,Tt,Ke,Et){if(!Ve)return[];const Ft=[],It=(function(kt,dt,lt,jt,Nt,wn){let sn=0;for(let pn=0;pn<kt.length();pn++){const Xt=kt.getSection(pn);sn+=mA(kt.getCodePoint(pn),Xt,jt,Nt,dt,wn)}return sn/Math.max(1,Math.ceil(sn/lt))})(Ve,We,He,Tt,Ke,Et),Pt=Ve.text.indexOf("")>=0;let Ut=0;for(let kt=0;kt<Ve.length();kt++){const dt=Ve.getSection(kt),lt=Ve.getCodePoint(kt);if(Zy[lt]||(Ut+=mA(lt,dt,Tt,Ke,We,Et)),kt<Ve.length()-1){const jt=!((bt=lt)<11904||!(Pn["Bopomofo Extended"](bt)||Pn.Bopomofo(bt)||Pn["CJK Compatibility Forms"](bt)||Pn["CJK Compatibility Ideographs"](bt)||Pn["CJK Compatibility"](bt)||Pn["CJK Radicals Supplement"](bt)||Pn["CJK Strokes"](bt)||Pn["CJK Symbols and Punctuation"](bt)||Pn["CJK Unified Ideographs Extension A"](bt)||Pn["CJK Unified Ideographs"](bt)||Pn["Enclosed CJK Letters and Months"](bt)||Pn["Halfwidth and Fullwidth Forms"](bt)||Pn.Hiragana(bt)||Pn["Ideographic Description Characters"](bt)||Pn["Kangxi Radicals"](bt)||Pn["Katakana Phonetic Extensions"](bt)||Pn.Katakana(bt)||Pn["Vertical Forms"](bt)||Pn["Yi Radicals"](bt)||Pn["Yi Syllables"](bt)));(yO[lt]||jt||dt.image)&&Ft.push(_A(kt+1,Ut,It,Ft,vO(lt,Ve.getCodePoint(kt+1),jt&&Pt),!1))}}var bt;return yA(_A(Ve.length(),Ut,It,Ft,0,!0))})(J,E,f,e,l,N),{processBidirectionalText:he,processStyledBidirectionalText:ge}=za;if(he&&J.sections.length===1){const Ve=he(J.toString(),le);for(const We of Ve){const He=new Lf;He.text=We,He.sections=J.sections;for(let Tt=0;Tt<We.length;Tt++)He.sectionIndex.push(0);Q.push(He)}}else if(ge){const Ve=ge(J.text,J.sectionIndex,le);for(const We of Ve){const He=new Lf;He.text=We[0],He.sectionIndex=We[1],He.sections=J.sections,Q.push(He)}}else Q=(function(Ve,We){const He=[],Tt=Ve.text;let Ke=0;for(const Et of We)He.push(Ve.substring(Ke,Et)),Ke=Et;return Ke<Tt.length&&He.push(Ve.substring(Ke,Tt.length)),He})(J,le);const Le=[],Oe={positionedLines:Le,text:J.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ve,We,He,Tt,Ke,Et,Ft,It,Pt,Ut,bt,kt){let dt=0,lt=0,jt=0;const Nt=It==="right"?1:It==="left"?0:.5;let wn=!1;for(const en of Ke){const _n=en.getSections();for(const zn of _n){if(zn.image)continue;const $n=We[zn.fontStack];if($n&&(wn=$n.ascender!==void 0&&$n.descender!==void 0,!wn))break}if(!wn)break}let sn=0;for(const en of Ke){en.trim();const _n=en.getMaxScale(),zn=(_n-1)*No,$n={positionedGlyphs:[],lineOffset:0};Ve.positionedLines[sn]=$n;const di=$n.positionedGlyphs;let ni=0;if(!en.length()){lt+=Et,++sn;continue}let hn=0,ei=0;for(let ve=0;ve<en.length();ve++){const be=en.getSection(ve),ht=en.getSectionIndex(ve),wt=en.getCodePoint(ve);let $t=be.scale,Qt=null,un=null,Sn=null,fi=No,pi=0,ui=Pt;ui===Xs.vertical&&((pn=wt)===12312||pn===12313||pn===12316||pn===12540||pn===12448)&&(ui=Xs.horizontal);const Ki=!(ui===Xs.horizontal||!bt&&!af(wt)||bt&&(Zy[wt]||Gx(wt)));if(be.image){const Mr=Tt.get(be.image.toString());if(!Mr)continue;Sn=be.image,Ve.iconsInText=Ve.iconsInText||!0,un=Mr.paddedRect;const ci=Mr.displaySize;$t=$t*No/kt,Qt={width:ci[0],height:ci[1],left:0,top:-pA,advance:Ki?ci[1]:ci[0],localGlyph:!1},pi=wn?-Qt.height*$t:_n*No-17-ci[1]*$t,fi=Qt.advance;const fr=(Ki?ci[0]:ci[1])*$t-No*_n;fr>0&&fr>ni&&(ni=fr)}else{const Mr=He[be.fontStack];if(!Mr)continue;Mr[wt]&&(un=Mr[wt]);const ci=We[be.fontStack];if(!ci)continue;const fr=ci.glyphs[wt];if(!fr)continue;if(Qt=fr.metrics,fi=wt!==8203?No:0,wn){const Qi=ci.ascender!==void 0?Math.abs(ci.ascender):0,Li=ci.descender!==void 0?Math.abs(ci.descender):0,gr=(Qi+Li)*$t;hn<gr&&(hn=gr,ei=(Qi-Li)/2*$t),pi=-Qi*$t}else pi=(_n-$t)*No-17}Ki?(Ve.verticalizable=!0,di.push({glyph:wt,image:Sn,x:dt,y:lt+pi,vertical:Ki,scale:$t,localGlyph:Qt.localGlyph,fontStack:be.fontStack,sectionIndex:ht,metrics:Qt,rect:un}),dt+=fi*$t+Ut):(di.push({glyph:wt,image:Sn,x:dt,y:lt+pi,vertical:Ki,scale:$t,localGlyph:Qt.localGlyph,fontStack:be.fontStack,sectionIndex:ht,metrics:Qt,rect:un}),dt+=Qt.advance*$t+Ut)}di.length!==0&&(jt=Math.max(dt-Ut,jt),wn?vA(di,Nt,ni,ei,Et*_n/2):vA(di,Nt,ni,0,Et/2)),dt=0;const Ti=Et*_n+ni;$n.lineOffset=Math.max(ni,zn),lt+=Ti,++sn}var pn;const Xt=lt,{horizontalAlign:xn,verticalAlign:Zn}=G1(Ft);(function(en,_n,zn,$n,di,ni){const hn=(_n-zn)*di,ei=-ni*$n;for(const Ti of en)for(const ve of Ti.positionedGlyphs)ve.x+=hn,ve.y+=ei})(Ve.positionedLines,Nt,xn,Zn,jt,Xt),Ve.top+=-Zn*Xt,Ve.bottom=Ve.top+Xt,Ve.left+=-xn*jt,Ve.right=Ve.left+jt,Ve.hasBaseline=wn})(Oe,e,i,l,Q,p,v,w,z,E,L,U),!(function(Ve){for(const We of Ve)if(We.positionedGlyphs.length!==0)return!1;return!0})(Le))return Oe}const Zy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function mA(o,e,i,l,u,f){if(e.image){const p=l.get(e.image.toString());return p?p.displaySize[0]*e.scale*No/f+u:0}{const p=i[e.fontStack],v=p&&p.glyphs[o];return v?v.metrics.advance*e.scale+u:0}}function gA(o,e,i,l){const u=Math.pow(o-e,2);return l?o<e?u/2:2*u:u+Math.abs(i)*i}function vO(o,e,i){let l=0;return o===10&&(l-=1e4),i&&(l+=150),o!==40&&o!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function _A(o,e,i,l,u,f){let p=null,v=gA(e,i,u,f);for(const w of l){const E=gA(e-w.x,i,u,f)+w.badness;E<=v&&(p=w,v=E)}return{index:o,x:e,priorBreak:p,badness:v}}function yA(o){return o?yA(o.priorBreak).concat(o.index):[]}function G1(o){let e=.5,i=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function vA(o,e,i,l,u){if(!(e||i||l||u))return;const f=o.length-1,p=o[f],v=(p.x+p.metrics.advance*p.scale)*e;for(let w=0;w<=f;w++)o[w].x-=v,o[w].y+=i+l+u}function xA(o){return o.imagePrimary!==void 0&&o.top!==void 0&&o.bottom!==void 0&&o.left!==void 0&&o.right!==void 0}function xO(o,e,i,l){const{horizontalAlign:u,verticalAlign:f}=G1(l),p=i[0]-o.displaySize[0]*u,v=i[1]-o.displaySize[1]*f;return{imagePrimary:o,imageSecondary:e,top:v,bottom:v+o.displaySize[1],left:p,right:p+o.displaySize[0]}}function bA(o,e,i,l,u,f){const p=o.imagePrimary;let v;if(p.content){const J=p.content,Q=p.pixelRatio||1;v=[J[0]/Q,J[1]/Q,p.displaySize[0]-J[2]/Q,p.displaySize[1]-J[3]/Q]}const w=e.left*f,E=e.right*f;let C,z,L,N;i==="width"||i==="both"?(N=u[0]+w-l[3],z=u[0]+E+l[1]):(N=u[0]+(w+E-p.displaySize[0])/2,z=N+p.displaySize[0]);const U=e.top*f,X=e.bottom*f;return i==="height"||i==="both"?(C=u[1]+U-l[0],L=u[1]+X+l[2]):(C=u[1]+(U+X-p.displaySize[1])/2,L=C+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:C,right:z,bottom:L,left:N,collisionPadding:v}}function wA(o){return!o.imagePrimary.stretchX}function TA(o){return!o.imagePrimary.stretchY}function SA(o){return{width:o.right-o.left,height:o.bottom-o.top}}const Xl=128;function EA(o,e,i){const{expression:l}=e;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new dr(o+1,{worldview:i}))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:f}=l;let p=0;for(;p<u.length&&u[p]<=o;)p++;p=Math.max(0,p-1);let v=p;for(;v<u.length&&u[v]<o+1;)v++;v=Math.min(u.length-1,v);const w=u[p],E=u[v];return l.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:E,minSize:l.evaluate(new dr(w,{worldview:i})),maxSize:l.evaluate(new dr(E,{worldview:i})),interpolationType:f}}}function W1(o,{uSize:e,uSizeT:i},{lowerSize:l,upperSize:u}){return o.kind==="source"?l/Xl:o.kind==="composite"?Rn(l/Xl,u/Xl,i):e}function sg(o,e,i=1){let l=0,u=0;if(o.kind==="constant")u=o.layoutSize*i;else if(o.kind!=="source"){const{interpolationType:f,minZoom:p,maxZoom:v}=o,w=f?Pe(Gs.interpolationFactor(f,e,p,v),0,1):0;o.kind==="camera"?u=Rn(o.minSize,o.maxSize,w)*i:l=w*i}return{uSizeT:l,uSize:u}}class Dc extends Mt{constructor(e,i,l,u,f){super(e,i),this.angle=u,this.z=l,f!==void 0&&(this.segment=f)}clone(){return new Dc(this.x,this.y,this.z,this.angle,this.segment)}}function AA(o,e,i,l,u){if(e.segment===void 0)return!0;let f=e,p=e.segment+1,v=0;for(;v>-i/2;){if(p--,p<0)return!1;v-=o[p].dist(f),f=o[p]}v+=o[p].dist(o[p+1]),p++;const w=[];let E=0;for(;v<i/2;){const C=o[p],z=o[p+1];if(!z)return!1;let L=o[p-1].angleTo(C)-C.angleTo(z);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:L}),E+=L;v-w[0].distance>l;)E-=w.shift().angleDelta;if(E>u)return!1;p++,v+=C.dist(z)}return!0}function IA(o){let e=0;for(let i=0;i<o.length-1;i++)e+=o[i].dist(o[i+1]);return e}function MA(o,e,i){return o?.6*e*i:0}function CA(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function bO(o,e,i,l,u,f){const p=MA(i,u,f),v=CA(i,l)*f;let w=0;const E=IA(o)/2;for(let C=0;C<o.length-1;C++){const z=o[C],L=o[C+1],N=z.dist(L);if(w+N>E){const U=(E-w)/N,X=Rn(z.x,L.x,U),J=Rn(z.y,L.y,U),Q=new Dc(X,J,0,L.angleTo(z),C);return!p||AA(o,Q,v,p,e)?Q:void 0}w+=N}}function wO(o,e,i,l,u,f,p,v,w){const E=MA(l,f,p),C=CA(l,u),z=C*p,L=o[0].x===0||o[0].x===w||o[0].y===0||o[0].y===w;return e-z<e/4&&(e=z+e/4),PA(o,L?e/2*v%e:(C/2+2*f)*p*v%e,e,E,i,z,L,!1,w)}function PA(o,e,i,l,u,f,p,v,w){const E=f/2,C=IA(o);let z=0,L=e-i,N=[];for(let U=0;U<o.length-1;U++){const X=o[U],J=o[U+1],Q=X.dist(J),le=J.angleTo(X);for(;L+i<z+Q;){L+=i;const he=(L-z)/Q,ge=Rn(X.x,J.x,he),Le=Rn(X.y,J.y,he);if(ge>=0&&ge<w&&Le>=0&&Le<w&&L-E>=0&&L+E<=C){const Oe=new Dc(ge,Le,0,le,U);l&&!AA(o,Oe,f,l,u)||N.push(Oe)}}z+=Q}return v||N.length||p||(N=PA(o,z/2,i,l,u,f,p,!0,w)),N}function kA(o){let e=0,i=0;for(const p of o)e+=p.w*p.h,i=Math.max(i,p.w);o.sort(((p,v)=>v.h-p.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const p of o)for(let v=l.length-1;v>=0;v--){const w=l[v];if(!(p.w>w.w||p.h>w.h)){if(p.x=w.x,p.y=w.y,f=Math.max(f,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===w.w&&p.h===w.h){const E=l.pop();E&&v<l.length&&(l[v]=E)}else p.h===w.h?(w.x+=p.w,w.w-=p.w):p.w===w.w?(w.y+=p.h,w.h-=p.h):(l.push({x:w.x+p.w,y:w.y,w:w.w-p.w,h:p.h}),w.y+=p.h,w.h-=p.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}ln(Dc,"Anchor");const Wh=1;class ag{static getImagePositionScale(e,i,l){if(i&&e&&e.options&&e.options.transform){const u=e.options.transform;return{x:u.a,y:u.d}}return{x:l,y:l}}constructor(e,i,l,u){this.paddedRect=e;const{pixelRatio:f,version:p,stretchX:v,stretchY:w,content:E,sdf:C,usvg:z}=i;this.pixelRatio=f,this.stretchX=v,this.stretchY=w,this.content=E,this.version=p,this.padding=l,this.sdf=C,this.usvg=z,this.scale=ag.getImagePositionScale(u,z,f)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function q1(o,e,i){const l=ya.parse(o),u=(function(f,p,v=[1,1]){return{x:0,y:0,w:(f.data?f.data.width:f.width*v[0])+2*p,h:(f.data?f.data.height:f.height*v[1])+2*p}})(e,i,[l.options.transform.a,l.options.transform.d]);return{bin:u,imagePosition:new ag(u,e,i,l),imageVariant:l}}class RA{constructor(e,i,l){const u=new Map,f=new Map;this.haveRenderCallbacks=[];const p=[];this.addImages(e,u,Wh,p),this.addImages(i,f,2,p);const{w:v,h:w}=kA(p),E=new Jo({width:v||1,height:w||1});for(const[C,z]of e.entries()){const L=u.get(C).paddedRect;Jo.copy(z.data,E,{x:0,y:0},{x:L.x+Wh,y:L.y+Wh},z.data,null,z.sdf)}for(const[C,z]of i.entries()){const L=f.get(C),N=L.paddedRect;let U=L.padding;const X=N.x+U,J=N.y+U,Q=z.data.width,le=z.data.height;U=U>1?U-1:U,Jo.copy(z.data,E,{x:0,y:0},{x:X,y:J},z.data,l),Jo.copy(z.data,E,{x:0,y:le-U},{x:X,y:J-U},{width:Q,height:U},l),Jo.copy(z.data,E,{x:0,y:0},{x:X,y:J+le},{width:Q,height:U},l),Jo.copy(z.data,E,{x:Q-U,y:0},{x:X-U,y:J},{width:U,height:le},l),Jo.copy(z.data,E,{x:0,y:0},{x:X+Q,y:J},{width:U,height:le},l),Jo.copy(z.data,E,{x:Q-U,y:le-U},{x:X-U,y:J-U},{width:U,height:U},l),Jo.copy(z.data,E,{x:0,y:le-U},{x:X+Q,y:J-U},{width:U,height:U},l),Jo.copy(z.data,E,{x:0,y:0},{x:X+Q,y:J+le},{width:U,height:U},l),Jo.copy(z.data,E,{x:Q-U,y:0},{x:X-U,y:J+le},{width:U,height:U},l)}this.lut=l,this.image=E,this.iconPositions=u,this.patternPositions=f}addImages(e,i,l,u){for(const[f,p]of e.entries()){const{bin:v,imagePosition:w,imageVariant:E}=q1(f,p,l);i.set(f,w),u.push(v),p.hasRenderCallback&&this.haveRenderCallbacks.push(E.id)}}patchUpdatedImages(e,i,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((u=>e.hasImage(u,l))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const u of e.getUpdatedImages(l)){for(const f of this.iconPositions.keys()){const p=ya.parse(f);if(Vs.isEqual(p.id,u)){const v=e.getImage(u,l);this.patchUpdatedImage(this.iconPositions.get(f),v,i,null)}}for(const f of this.patternPositions.keys()){const p=ya.parse(f);if(Vs.isEqual(p.id,u)){const v=e.getImage(u,l);this.patchUpdatedImage(this.patternPositions.get(f),v,i,this.lut)}}}}patchUpdatedImage(e,i,l,u=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[f,p]=e.tl,v=e.sdf;if(this.lut||v){const w={width:i.data.width,height:i.data.height},E=new Jo(w);Jo.copy(i.data,E,{x:0,y:0},{x:0,y:0},w,u,v),l.update(E,{position:{x:f,y:p}})}else l.update(i.data,{position:{x:f,y:p}})}}ln(ag,"ImagePosition"),ln(RA,"ImageAtlas");const lg=1e20;function zA(o,e,i,l,u,f,p,v,w){for(let E=e;E<e+l;E++)DA(o,i*f+E,f,u,p,v,w);for(let E=i;E<i+u;E++)DA(o,E*f+e,1,l,p,v,w)}function DA(o,e,i,l,u,f,p){f[0]=0,p[0]=-lg,p[1]=lg,u[0]=o[e];for(let v=1,w=0,E=0;v<l;v++){u[v]=o[e+v*i];const C=v*v;do{const z=f[w];E=(u[v]-u[z]+C-z*z)/(v-z)/2}while(E<=p[w]&&--w>-1);w++,f[w]=v,p[w]=E,p[w+1]=lg}for(let v=0,w=0;v<l;v++){for(;p[w+1]<v;)w++;const E=f[w],C=v-E;o[e+v*i]=u[E]+C*C}}const sl=2,H1={none:0,ideographs:1,all:2};class Of{constructor(e,i,l){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=l,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const l=[],u=this.url||Fo.GLYPHS_URL;for(const f in e)for(const p of e[f])l.push({stack:f,id:p});at(l,(({stack:f,id:p},v)=>{let w=this.entries[f];w||(w=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=w.glyphs[p];if(E!==void 0)return void v(null,{stack:f,id:p,glyph:E});if(E=this._tinySDF(w,f,p),E)return w.glyphs[p]=E,void v(null,{stack:f,id:p,glyph:E});const C=Math.floor(p/256);if(256*C>65535)return oi("glyphs > 65535 not supported"),void v(null,{stack:f,id:p,glyph:E});if(w.ranges[C])return void v(null,{stack:f,id:p,glyph:E});let z=w.requests[C];z||(z=w.requests[C]=[],Of.loadGlyphRange(f,C,u,this.requestManager,((L,N)=>{if(N){w.ascender=N.ascender,w.descender=N.descender;for(const U in N.glyphs)this._doesCharSupportLocalGlyph(+U)||(w.glyphs[+U]=N.glyphs[+U]);w.ranges[C]=!0}for(const U of z)U(L,N);delete w.requests[C]}))),z.push(((L,N)=>{L?v(L):N&&v(null,{stack:f,id:p,glyph:N.glyphs[p]||null})}))}),((f,p)=>{if(f)i(f);else if(p){const v={};for(const{stack:w,id:E,glyph:C}of p)v[w]===void 0&&(v[w]={}),v[w].glyphs===void 0&&(v[w].glyphs={}),v[w].glyphs[E]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},v[w].ascender=this.entries[w].ascender,v[w].descender=this.entries[w].descender;i(null,v)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==H1.none&&(this.localGlyphMode===H1.all?!!this.localFontFamily:!!this.localFontFamily&&(Pn["CJK Unified Ideographs"](e)||Pn["Hangul Syllables"](e)||Pn.Hiragana(e)||Pn.Katakana(e)||Pn["CJK Symbols and Punctuation"](e)||Pn["CJK Unified Ideographs Extension A"](e)||Pn["CJK Unified Ideographs Extension B"](e)||Pn.Osage(e)))}_tinySDF(e,i,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let f=e.tinySDF;if(!f){let X="400";/bold/i.test(i)?X="900":/medium/i.test(i)?X="500":/light/i.test(i)&&(X="200"),f=e.tinySDF=new Of.TinySDF({fontFamily:u,fontWeight:X,fontSize:24*sl,buffer:3*sl,radius:8*sl}),f.fontWeight=X}if(this.localGlyphs[f.fontWeight][l])return this.localGlyphs[f.fontWeight][l];const p=String.fromCodePoint(l),{data:v,width:w,height:E,glyphWidth:C,glyphHeight:z,glyphLeft:L,glyphTop:N,glyphAdvance:U}=f.draw(p);return this.localGlyphs[f.fontWeight][l]={id:l,bitmap:new zu({width:w,height:E},v),metrics:{width:C/sl,height:z/sl,left:L/sl,top:N/sl-27,advance:U/sl,localGlyph:!0}}}}Of.loadGlyphRange=function(o,e,i,l,u){const f=256*e,p=f+255,v=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",o).replace("{range}",`${f}-${p}`),gd.Glyphs);nu(v,((w,E)=>{if(w)u(w);else if(E){const C={},z=(function(L){return new Hy(L).readFields(mO,{})})(E);for(const L of z.glyphs)C[L.id]=L;u(null,{glyphs:C,ascender:z.ascender,descender:z.descender})}}))},Of.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:p="normal",lang:v=null}={}){this.buffer=e,this.cutoff=l,this.radius=i,this.lang=v;const w=this.size=o+4*e,E=this._createCanvas(w),C=this.ctx=E.getContext("2d",{willReadFrequently:!0});C.font=`${p} ${f} ${o}px ${u}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(o),p=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),w=Math.min(this.size-this.buffer,p+Math.ceil(l)),E=v+2*this.buffer,C=w+2*this.buffer,z=Math.max(E*C,0),L=new Uint8ClampedArray(z),N={data:L,width:E,height:C,glyphWidth:v,glyphHeight:w,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(v===0||w===0)return N;const{ctx:U,buffer:X,gridInner:J,gridOuter:Q}=this;this.lang&&(U.lang=this.lang),U.clearRect(X,X,v,w),U.fillText(o,X,X+p);const le=U.getImageData(X,X,v,w);Q.fill(lg,0,z),J.fill(0,0,z);for(let he=0;he<w;he++)for(let ge=0;ge<v;ge++){const Le=le.data[4*(he*v+ge)+3]/255;if(Le===0)continue;const Oe=(he+X)*E+ge+X;if(Le===1)Q[Oe]=0,J[Oe]=lg;else{const Ve=.5-Le;Q[Oe]=Ve>0?Ve*Ve:0,J[Oe]=Ve<0?Ve*Ve:0}}zA(Q,0,0,E,C,E,this.f,this.v,this.z),zA(J,X,X,v,w,E,this.f,this.v,this.z);for(let he=0;he<z;he++){const ge=Math.sqrt(Q[he])-Math.sqrt(J[he]);L[he]=Math.round(255-255*(ge/this.radius+this.cutoff))}return N}};const Ou=Wh;function LA(o,e){return o+e[1]-e[0]}function OA(o,e,i,l,u=1){const f=[],p=o.imagePrimary,v=p.pixelRatio,w=p.paddedRect.w-2*Ou,E=p.paddedRect.h-2*Ou,C=(o.right-o.left)*u,z=(o.bottom-o.top)*u,L=p.stretchX||[[0,w]],N=p.stretchY||[[0,E]],U=L.reduce(LA,0),X=N.reduce(LA,0),J=w-U,Q=E-X;let le=0,he=U,ge=0,Le=X,Oe=0,Ve=J,We=0,He=Q;if(p.content&&l){const Ke=p.content;le=Xy(L,0,Ke[0]),ge=Xy(N,0,Ke[1]),he=Xy(L,Ke[0],Ke[2]),Le=Xy(N,Ke[1],Ke[3]),Oe=Ke[0]-le,We=Ke[1]-ge,Ve=Ke[2]-Ke[0]-he,He=Ke[3]-Ke[1]-Le}const Tt=(Ke,Et,Ft,It)=>{const Pt=Yy(Ke.stretch-le,he,C,o.left*u),Ut=Ky(Ke.fixed-Oe,Ve,Ke.stretch,U),bt=Yy(Et.stretch-ge,Le,z,o.top*u),kt=Ky(Et.fixed-We,He,Et.stretch,X),dt=Yy(Ft.stretch-le,he,C,o.left*u),lt=Ky(Ft.fixed-Oe,Ve,Ft.stretch,U),jt=Yy(It.stretch-ge,Le,z,o.top*u),Nt=Ky(It.fixed-We,He,It.stretch,X),wn=new Mt(Pt,bt),sn=new Mt(dt,bt),pn=new Mt(dt,jt),Xt=new Mt(Pt,jt),xn=new Mt(Ut/v,kt/v),Zn=new Mt(lt/v,Nt/v),en=e*Math.PI/180;if(en){const hn=Math.sin(en),ei=Math.cos(en),Ti=[ei,-hn,hn,ei];wn._matMult(Ti),sn._matMult(Ti),Xt._matMult(Ti),pn._matMult(Ti)}const _n=Ke.stretch+Ke.fixed,zn=Ft.stretch+Ft.fixed,$n=Et.stretch+Et.fixed,di=It.stretch+It.fixed,ni=o.imageSecondary;return{tl:wn,tr:sn,bl:Xt,br:pn,texPrimary:{x:p.paddedRect.x+Ou+_n,y:p.paddedRect.y+Ou+$n,w:zn-_n,h:di-$n},texSecondary:ni?{x:ni.paddedRect.x+Ou+_n,y:ni.paddedRect.y+Ou+$n,w:zn-_n,h:di-$n}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xn,pixelOffsetBR:Zn,minFontScaleX:Ve/v/C,minFontScaleY:He/v/z,isSDF:i}};if(l&&(p.stretchX||p.stretchY)){const Ke=FA(L,J,U),Et=FA(N,Q,X);for(let Ft=0;Ft<Ke.length-1;Ft++){const It=Ke[Ft],Pt=Ke[Ft+1];for(let Ut=0;Ut<Et.length-1;Ut++)f.push(Tt(It,Et[Ut],Pt,Et[Ut+1]))}}else f.push(Tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:E+1}));return f}function Xy(o,e,i){let l=0;for(const u of o)l+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return l}function FA(o,e,i){const l=[{fixed:-Ou,stretch:0}];for(const[u,f]of o){const p=l[l.length-1];l.push({fixed:u-p.stretch,stretch:p.stretch}),l.push({fixed:u-p.stretch,stretch:p.stretch+(f-u)})}return l.push({fixed:e+Ou,stretch:i}),l}function Yy(o,e,i,l){return o/e*i+l}function Ky(o,e,i,l){return o-e*i/l}function TO(o,e,i,l){const u=e+o.positionedLines[l].lineOffset;return l===0?i+u/2:i+(u+(e+o.positionedLines[l-1].lineOffset))/2}function SO(o,e=1,i=!1){let l=1/0,u=1/0,f=-1/0,p=-1/0;const v=o[0];for(let N=0;N<v.length;N++){const U=v[N];(!N||U.x<l)&&(l=U.x),(!N||U.y<u)&&(u=U.y),(!N||U.x>f)&&(f=U.x),(!N||U.y>p)&&(p=U.y)}const w=Math.min(f-l,p-u);let E=w/2;const C=new Dd([],EO);if(w===0)return new Mt(l,u);for(let N=l;N<f;N+=w)for(let U=u;U<p;U+=w)C.push(new Ff(N+E,U+E,E,o));let z=(function(N){let U=0,X=0,J=0;const Q=N[0];for(let le=0,he=Q.length,ge=he-1;le<he;ge=le++){const Le=Q[le],Oe=Q[ge],Ve=Le.x*Oe.y-Oe.x*Le.y;X+=(Le.x+Oe.x)*Ve,J+=(Le.y+Oe.y)*Ve,U+=3*Ve}return new Ff(X/U,J/U,0,N)})(o),L=C.length;for(;C.length;){const N=C.pop();(N.d>z.d||!z.d)&&(z=N,i&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,L)),N.max-z.d<=e||(E=N.h/2,C.push(new Ff(N.p.x-E,N.p.y-E,E,o)),C.push(new Ff(N.p.x+E,N.p.y-E,E,o)),C.push(new Ff(N.p.x-E,N.p.y+E,E,o)),C.push(new Ff(N.p.x+E,N.p.y+E,E,o)),L+=4)}return i&&(console.log(`num probes: ${L}`),console.log(`best distance: ${z.d}`)),z.p}function EO(o,e){return e.max-o.max}class Ff{constructor(e,i,l,u){this.p=new Mt(e,i),this.h=l,this.d=(function(f,p){let v=!1,w=1/0;for(let E=0;E<p.length;E++){const C=p[E];for(let z=0,L=C.length,N=L-1;z<L;N=z++){const U=C[z],X=C[N];U.y>f.y!=X.y>f.y&&f.x<(X.x-U.x)*(f.y-U.y)/(X.y-U.y)+U.x&&(v=!v),w=Math.min(w,Lr(f,U,X))}}return(v?1:-1)*Math.sqrt(w)})(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const AO=Object.keys,Z1=Number.POSITIVE_INFINITY,IO=Math.sqrt(2);function BA(o,[e,i]){let l=0,u=0;if(i===Z1){e<0&&(e=0);const f=e/IO;switch(o){case"top-right":case"top-left":u=f-7;break;case"bottom-right":case"bottom-left":u=7-f;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(o){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),o){case"top-right":case"top-left":case"top":u=i-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-i}switch(o){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,u]}function Jy(o,e,i,l,u,f,p,v,w){if(!e||!e.usvg)return;const E=SA(l),C=SA(u),z=f!=="both"&&f!=="width"||!wA(l)?1:C.width/E.width,L=f!=="both"&&f!=="height"||!TA(l)?1:C.height/E.height;i.scaleSelf(z,L);const N=i.toString();p.set(N,i),v.set(N,e);const{imagePosition:U}=q1(N,e,Wh);w.set(N,U)}function NA(o,e,i,l,u,f,p,v,w){if(!o)return;const E=(function(C,z,L,N,U,X){if(C.kind==="camera")return C.maxSize;if(C.kind==="composite"){const J=z.possiblyEvaluate(new dr(C.maxZoom,{worldview:X}),L).evaluate(U,{},L),Q=z.possiblyEvaluate(new dr(C.minZoom,{worldview:X}),L).evaluate(U,{},L);return Math.max(J,Q)}return z.possiblyEvaluate(new dr(N,{worldview:X})).evaluate(U,{},L)})(e,i,l,u,f,w);return o.scaleSelf(E*v*p)}function VA(o,e,i,l,u,f,p,v,w){return{iconPrimary:NA(o.getPrimary(),e,i,l,u,f,p,v,w),iconSecondary:NA(o.getSecondary(),e,i,l,u,f,p,v,w)}}function MO(o,e,i){if(!e)return;const l=i.get(o.toString()),u=i.get(e.toString());l&&u&&(l.paddedRect.w===u.paddedRect.w&&l.paddedRect.h===u.paddedRect.h||oi(`Mismatch in icon variant sizes: ${o.toString()} and ${e.toString()}`),l.usvg!==u.usvg&&oi(`Mismatch in icon variant image types: ${o.id} and ${e.id}`))}function UA(o,e,i,l){if(!o)return;const u=e.get(i.toString());if(o.imagePrimary=u,l){const f=e.get(l.toString());o.imageSecondary=f}}function CO(o,e){for(const i in o.horizontal)jA(o.horizontal[i],e);jA(o.vertical,e)}function jA(o,e){if(o){for(const i of o.positionedLines)for(const l of i.positionedGlyphs)if(l.image!==null){const u=l.image.toString();l.rect=e.get(u).paddedRect}}}function X1(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function PO(o,e,i,l,u,f,p,v,w){const E=Y1(f.horizontal)||f.vertical,C=i.get("icon-text-fit-padding").evaluate(l,{},u);let z,L=e;return e&&w!=="none"&&(o.allowVerticalPlacement&&f.vertical&&(z=bA(e,f.vertical,w,C,v,p)),E&&(L=bA(e,E,w,C,v,p))),{defaultShapedIcon:L,verticallyShapedIcon:z}}function kO(o,e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J,Q,le,he){let ge=p.textMaxSize.evaluate(e,{},L);ge===void 0?ge=v*p.textScaleFactor:ge*=p.textScaleFactor;const Le=o.layers[0].layout,Oe=Y1(i.horizontal)||i.vertical,Ve=N.name==="globe",We=No,He=o.tilePixelRatio*ge/We,Tt=(Ut=o.overscaling,o.zoom>18&&Ut>2&&(Ut>>=1),Math.max(Yt/(512*Ut),1)*Le.get("symbol-spacing")),Ke=Le.get("text-padding")*o.tilePixelRatio,Et=Le.get("icon-padding")*o.tilePixelRatio,Ft=Xe(Le.get("text-max-angle")),It=Le.get("icon-rotation-alignment")==="map"&&he!=="point",Pt=Tt/2;var Ut;o.hasAnyIconTextFit===!1&&J!=="none"&&(o.hasAnyIconTextFit=!0);const bt=e.properties?+e.properties[ai]:null,kt=bt&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(bt):65535,dt=(lt,jt,Nt)=>{if(jt.x<0||jt.x>=Yt||jt.y<0||jt.y>=Yt)return;let wn=null;if(Ve){const{x:sn,y:pn,z:Xt}=N.projectTilePoint(jt.x,jt.y,Nt);wn={anchor:new Dc(sn,pn,Xt,0,void 0),up:N.upVector(Nt,jt.x,jt.y)}}(function(sn,pn,Xt,xn,Zn,en,_n,zn,$n,di,ni,hn,ei,Ti,ve,be,ht,wt,$t,Qt,un,Sn,fi,pi,ui,Ki,Mr,ci,fr){const Qi=sn.addToLineVertexArray(pn,xn);let Li,gr,_r,cr,pr,$i,mi,nr=0,Br=0,Bn=0,Ai=0,yr=-1,Gr=-1;const Tr={};let bo=xd("");const or=Xt?Xt.anchor:pn,po=ci!=="none";let Ps=0,Qo=0;if($n._unevaluatedLayout.getValue("text-radial-offset")===void 0){const wo=$n.layout.get("text-offset").evaluate(un,{},ui);Ps=wo[0]*No,Qo=wo[1]*No}else Ps=$n.layout.get("text-radial-offset").evaluate(un,{},ui)*No,Qo=Z1;if(sn.allowVerticalPlacement&&Zn.vertical){const wo=Zn.vertical;if(ve)$i=K1(wo),zn&&(mi=K1(zn));else{const Do=$n.layout.get("text-rotate").evaluate(un,{},ui)+90;_r=Qy(di,or,pn,ni,hn,ei,wo,Ti,Do,be),zn&&(cr=Qy(di,or,pn,ni,hn,ei,zn,wt,Do))}}if(en){const wo=sn.iconSizeData,Do=$n.layout.get("icon-rotate").evaluate(un,{},ui),$o=OA(en,Do,fi,po,Sn.iconScaleFactor),_s=zn?OA(zn,Do,fi,po,Sn.iconScaleFactor):void 0;gr=Qy(di,or,pn,ni,hn,ei,en,wt,Do,null),nr=4*$o.length;let as=null;wo.kind==="source"?(as=[Xl*$n.layout.get("icon-size").evaluate(un,{},ui)*Sn.iconScaleFactor],as[0]>Fu&&oi(`${sn.layerIds[0]}: Value for "icon-size" is >= ${cg}. Reduce your "icon-size".`)):wo.kind==="composite"&&(as=[Xl*Sn.compositeIconSizes[0].evaluate(un,{},ui)*Sn.iconScaleFactor,Xl*Sn.compositeIconSizes[1].evaluate(un,{},ui)*Sn.iconScaleFactor],(as[0]>Fu||as[1]>Fu)&&oi(`${sn.layerIds[0]}: Value for "icon-size" is >= ${cg}. Reduce your "icon-size".`)),sn.addSymbols(sn.icon,$o,as,Qt,$t,un,void 0,Xt,pn,Qi.lineStartIndex,Qi.lineLength,-1,pi,ui,Ki,Mr),yr=sn.icon.placedSymbolArray.length-1,_s&&(Br=4*_s.length,sn.addSymbols(sn.icon,_s,as,Qt,$t,un,Xs.vertical,Xt,pn,Qi.lineStartIndex,Qi.lineLength,-1,pi,ui,Ki,Mr),Gr=sn.icon.placedSymbolArray.length-1)}for(const wo in Zn.horizontal){const Do=wo,$o=Zn.horizontal[Do];Li||(bo=xd($o.text),ve?pr=K1($o):Li=Qy(di,or,pn,ni,hn,ei,$o,Ti,$n.layout.get("text-rotate").evaluate(un,{},ui),be));const _s=$o.positionedLines.length===1;if(Bn+=GA(sn,Xt,pn,$o,_n,$n,ve,un,be,Qi,Zn.vertical?Xs.horizontal:Xs.horizontalOnly,_s?AO(Zn.horizontal):[Do],Tr,yr,Sn,pi,ui,Ki),_s)break}Zn.vertical&&(Ai+=GA(sn,Xt,pn,Zn.vertical,_n,$n,ve,un,be,Qi,Xs.vertical,["vertical"],Tr,Gr,Sn,pi,ui,Ki));let Wo=-1;const ks=(wo,Do)=>wo?Math.max(wo,Do):Do;Wo=ks(pr,Wo),Wo=ks($i,Wo),Wo=ks(mi,Wo);const Yl=Wo>-1?1:0;sn.glyphOffsetArray.length>=65535&&oi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),un.sortKey!==void 0&&sn.addToSortKeyRanges(sn.symbolInstances.length,un.sortKey),sn.symbolInstances.emplaceBack(pn.x,pn.y,or.x,or.y,or.z,Tr.right>=0?Tr.right:-1,Tr.center>=0?Tr.center:-1,Tr.left>=0?Tr.left:-1,Tr.vertical>=0?Tr.vertical:-1,yr,Gr,bo,Li!==void 0?Li:sn.collisionBoxArray.length,Li!==void 0?Li+1:sn.collisionBoxArray.length,_r!==void 0?_r:sn.collisionBoxArray.length,_r!==void 0?_r+1:sn.collisionBoxArray.length,gr!==void 0?gr:sn.collisionBoxArray.length,gr!==void 0?gr+1:sn.collisionBoxArray.length,cr||sn.collisionBoxArray.length,cr?cr+1:sn.collisionBoxArray.length,ni,Bn,Ai,nr,Br,Yl,0,Ps,Qo,Wo,0,po?1:0,fr)})(o,jt,wn,lt,i,l,f,u,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,Ke,le,E,0,Et,It,Q,e,p,C,z,L,U,X,J,kt)};if(he==="line")for(const lt of By(e.geometry,0,0,Yt,Yt)){const jt=wO(lt,Tt,Ft,i.vertical||Oe,l,We,He,o.overscaling,Yt);for(const Nt of jt)Oe&&RO(o,Oe.text,Pt,Nt)||dt(lt,Nt,L)}else if(he==="line-center"){for(const lt of e.geometry)if(lt.length>1){const jt=bO(lt,Ft,i.vertical||Oe,l,We,He);jt&&dt(lt,jt,L)}}else if(e.type==="Polygon")for(const lt of qm(e.geometry,0)){const jt=SO(lt,16);dt(lt[0],new Dc(jt.x,jt.y,0,0,void 0),L)}else if(e.type==="LineString")for(const lt of e.geometry)dt(lt,new Dc(lt[0].x,lt[0].y,0,0,void 0),L);else if(e.type==="Point")for(const lt of e.geometry)for(const jt of lt)dt([jt],new Dc(jt.x,jt.y,0,0,void 0),L)}const cg=255,Fu=cg*Xl;function GA(o,e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J,Q){const le=(function(Le,Oe,Ve,We,He,Tt,Ke,Et){const Ft=[];if(Oe.positionedLines.length===0)return Ft;const It=We.layout.get("text-rotate").evaluate(Tt,{})*Math.PI/180,Pt=(function(lt){const jt=lt[0],Nt=lt[1],wn=jt*Nt;return wn>0?[jt,-Nt]:wn<0?[-jt,Nt]:jt===0?[Nt,jt]:[Nt,-jt]})(Ve);let Ut=Math.abs(Oe.top-Oe.bottom);for(const lt of Oe.positionedLines)Ut-=lt.lineOffset;const bt=Oe.positionedLines.length,kt=Ut/bt;let dt=Oe.top-Ve[1];for(let lt=0;lt<bt;++lt){const jt=Oe.positionedLines[lt];dt=TO(Oe,kt,dt,lt);for(const Nt of jt.positionedGlyphs){if(!Nt.rect)continue;const wn=Nt.rect||{};let sn=pA+1,pn=!0,Xt=1,xn=0;if(Nt.image){const un=Ke.get(Nt.image.toString());if(!un)continue;if(un.sdf){oi("SDF images are not supported in formatted text and will be ignored.");continue}pn=!1,Xt=un.pixelRatio,sn=Wh/Xt}const Zn=(He||Et)&&Nt.vertical,en=Nt.metrics.advance*Nt.scale/2,_n=Nt.metrics,zn=Nt.rect;if(zn===null)continue;Et&&Oe.verticalizable&&(xn=Nt.image?en-Nt.metrics.width*Nt.scale/2:0);const $n=He?[Nt.x+en,Nt.y]:[0,0];let di=[0,0],ni=[0,0],hn=!1;He||(Zn?(ni=[Nt.x+en+Pt[0],Nt.y+Pt[1]-xn],hn=!0):di=[Nt.x+en+Ve[0],Nt.y+Ve[1]-xn]);const ei=zn.w*Nt.scale/(Xt*(Nt.localGlyph?sl:1)),Ti=zn.h*Nt.scale/(Xt*(Nt.localGlyph?sl:1));let ve,be,ht,wt;if(Zn){const un=Nt.y-dt,Sn=new Mt(-en,en-un),fi=-Math.PI/2,pi=new Mt(...ni);ve=new Mt(-en+di[0],di[1]),ve._rotateAround(fi,Sn)._add(pi),ve.x+=-un+en,ve.y-=(_n.left-sn)*Nt.scale;const ui=Nt.image?_n.advance*Nt.scale:No*Nt.scale,Ki=String.fromCodePoint(Nt.glyph);rO(Ki)?ve.x+=(1-sn)*Nt.scale:oO(Ki)?ve.x+=ui-_n.height*Nt.scale+(-sn-1)*Nt.scale:ve.x+=Nt.image||_n.width+2*sn===zn.w&&_n.height+2*sn===zn.h?(ui-Ti)/2:(ui-(_n.height+2*sn)*Nt.scale)/2,be=new Mt(ve.x,ve.y-ei),ht=new Mt(ve.x+Ti,ve.y),wt=new Mt(ve.x+Ti,ve.y-ei)}else{const un=(_n.left-sn)*Nt.scale-en+di[0],Sn=(-_n.top-sn)*Nt.scale+di[1],fi=un+ei,pi=Sn+Ti;ve=new Mt(un,Sn),be=new Mt(fi,Sn),ht=new Mt(un,pi),wt=new Mt(fi,pi)}if(It){let un;un=He?new Mt(0,0):hn?new Mt(Pt[0],Pt[1]):new Mt(Ve[0],Ve[1]),ve._rotateAround(It,un),be._rotateAround(It,un),ht._rotateAround(It,un),wt._rotateAround(It,un)}const $t=new Mt(0,0),Qt=new Mt(0,0);Ft.push({tl:ve,tr:be,bl:ht,br:wt,texPrimary:wn,texSecondary:void 0,writingMode:Oe.writingMode,glyphOffset:$n,sectionIndex:Nt.sectionIndex,isSDF:pn,pixelOffsetTL:$t,pixelOffsetBR:Qt,minFontScaleX:0,minFontScaleY:0})}}return Ft})(0,l,w,f,p,v,u,o.allowVerticalPlacement),he=o.textSizeData;let ge=null;he.kind==="source"?(ge=[Xl*f.layout.get("text-size").evaluate(v,{},J)*U.textScaleFactor],ge[0]>Fu&&oi(`${o.layerIds[0]}: Value for "text-size" is >= ${cg}. Reduce your "text-size".`)):he.kind==="composite"&&(ge=[Xl*U.compositeTextSizes[0].evaluate(v,{},J)*U.textScaleFactor,Xl*U.compositeTextSizes[1].evaluate(v,{},J)*U.textScaleFactor],(ge[0]>Fu||ge[1]>Fu)&&oi(`${o.layerIds[0]}: Value for "text-size" is >= ${cg}. Reduce your "text-size".`)),o.addSymbols(o.text,le,ge,w,p,v,C,e,i,E.lineStartIndex,E.lineLength,N,X,J,Q,!1);for(const Le of z)L[Le]=o.text.placedSymbolArray.length-1;return 4*le.length}function Y1(o){for(const e in o)return o[e];return null}function Qy(o,e,i,l,u,f,p,v,w,E){let C=p.top,z=p.bottom,L=p.left,N=p.right;if(xA(p)&&p.collisionPadding){const U=p.collisionPadding;L-=U[0],C-=U[1],N+=U[2],z+=U[3]}if(w){const U=new Mt(L,C),X=new Mt(N,C),J=new Mt(L,z),Q=new Mt(N,z),le=Xe(w);let he=new Mt(0,0);E&&(he=new Mt(E[0],E[1])),U._rotateAround(le,he),X._rotateAround(le,he),J._rotateAround(le,he),Q._rotateAround(le,he),L=Math.min(U.x,X.x,J.x,Q.x),N=Math.max(U.x,X.x,J.x,Q.x),C=Math.min(U.y,X.y,J.y,Q.y),z=Math.max(U.y,X.y,J.y,Q.y)}return o.emplaceBack(e.x,e.y,e.z,i.x,i.y,L,C,N,z,v,l,u,f),o.length-1}function K1(o){xA(o)&&o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function RO(o,e,i,l){const u=o.compareText;if(e in u){const f=u[e];for(let p=f.length-1;p>=0;p--)if(l.dist(f[p])<i)return!0}else u[e]=[];return u[e].push(l),!1}function WA(o,e){const i=o.fovAboveCenter,l=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,u=(o._camera.position[2]*o.worldSize-l)/Math.cos(o._pitch),f=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-o._pitch-i,.01));let p=Math.sin(o._pitch)*f+u;const v=u*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let w=Math.max(o.zoom-17,0);o.isOrthographic&&(w/=10),p*=1+w}return Math.min(1.01*p,v)}function ug(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const i=Math.pow(2,-o.z),l=o.x*i,u=(o.x+1)*i,f=o.y*i,p=(o.y+1)*i,v=ke(l),w=ke(u),E=Me(f),C=Me(p),z=e.project(v,E),L=e.project(w,E),N=e.project(w,C),U=e.project(v,C);let X=Math.min(z.x,L.x,N.x,U.x),J=Math.min(z.y,L.y,N.y,U.y),Q=Math.max(z.x,L.x,N.x,U.x),le=Math.max(z.y,L.y,N.y,U.y);const he=i/16;function ge(Oe,Ve,We,He,Tt,Ke){const Et=(We+Tt)/2,Ft=(He+Ke)/2,It=e.project(ke(Et),Me(Ft)),Pt=Math.max(0,X-It.x,J-It.y,It.x-Q,It.y-le);X=Math.min(X,It.x),Q=Math.max(Q,It.x),J=Math.min(J,It.y),le=Math.max(le,It.y),Pt>he&&(ge(Oe,It,We,He,Et,Ft),ge(It,Ve,Et,Ft,Tt,Ke))}ge(z,L,l,f,u,f),ge(L,N,u,f,u,p),ge(N,U,u,p,l,p),ge(U,z,l,p,l,f),X-=he,J-=he,Q+=he,le+=he;const Le=1/Math.max(Q-X,le-J);return{scale:Le,x:X*Le,y:J*Le,x2:Q*Le,y2:le*Le,projection:e}}function qA(o,{x:e,y:i},l=0){return new Mt(((e-l)*o.scale-o.x)*Yt,(i*o.scale-o.y)*Yt)}const zO=G(new Float32Array(16));class Bu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Z(0,0)}projectTilePoint(e,i,l){return{x:e,y:i,z:0}}locationPoint(e,i,l,u=!0){return e._coordinatePoint(e.locationCoordinate(i,l),u)}pixelsPerMeter(e,i){return Ae(1,e)*i}pixelSpaceConversion(e,i,l){return 1}farthestPixelDistance(e){return WA(e,e.pixelsPerMeter)}pointCoordinate(e,i,l,u){const f=e.horizonLineFromTop(!1),p=new Mt(i,Math.max(f,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,u))}pointCoordinate3D(e,i,l){const u=new Mt(i,l);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const l=e.horizonLineFromTop();return i.y<l}createInversionMatrix(e,i){return zO}createTileMatrix(e,i,l){let u,f,p;const v=l.canonical,w=G(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=ug(v,this);u=1,f=E.x+l.wrap*E.scale,p=E.y,oe(w,w,[u/E.scale,u/E.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(v.z),f=(v.x+Math.pow(2,v.z)*l.wrap)*u,p=v.y*u;return ne(w,w,[f,p,0]),oe(w,w,[u/Yt,u/Yt,1]),w}upVector(e,i,l){return[0,0,1]}upVectorScale(e,i,l){return{metersToTile:1}}}class DO extends Bu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,l]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Xe(i));this.n=(u+Math.sin(Xe(l)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:l,c:u,r0:f}=this,p=Xe(e-this.center[0]),v=Xe(i),w=Math.sqrt(u-2*l*Math.sin(v))/l;return{x:w*Math.sin(p*l),y:w*Math.cos(p*l)-f,z:0}}unproject(e,i){const{n:l,c:u,r0:f}=this,p=f+i;let v=Math.atan2(e,Math.abs(p))*Math.sign(p);p*l<0&&(v-=Math.PI*Math.sign(e)*Math.sign(p));const w=Xe(this.center[0])*l;v=Ge(v,-Math.PI-w,Math.PI-w);const E=Pe(ee(v/l)+this.center[0],-180,180),C=Math.asin(Pe((u-(e*e+p*p)*l*l)/(2*l),-1,1)),z=Pe(ee(C),-ze,ze);return new Z(E,z)}}const hg=1.340264,dg=-.081106,fg=893e-6,pg=.003796,$y=Math.sqrt(3)/2;class LO extends Bu{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const l=Math.asin($y*Math.sin(i)),u=l*l,f=u*u*u;return{x:.5*(e*Math.cos(l)/($y*(hg+3*dg*u+f*(7*fg+9*pg*u)))/Math.PI+.5),y:1-.5*(l*(hg+dg*u+f*(fg+pg*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,u=l*l,f=u*u*u;for(let C,z,L,N=0;N<12&&(z=l*(hg+dg*u+f*(fg+pg*u))-i,L=hg+3*dg*u+f*(7*fg+9*pg*u),C=z/L,l=Pe(l-C,-Math.PI/3,Math.PI/3),u=l*l,f=u*u*u,!(Math.abs(C)<1e-12));++N);const p=$y*e*(hg+3*dg*u+f*(7*fg+9*pg*u))/Math.cos(l),v=Math.asin(Math.sin(l)/$y),w=Pe(180*p/Math.PI,-180,180),E=Pe(180*v/Math.PI,-ze,ze);return new Z(w,E)}}class OO extends Bu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const l=360*(e-.5),u=Pe(360*(.5-i),-ze,ze);return new Z(l,u)}}const Bf=Math.PI/2;function ev(o){return Math.tan((Bf+o)/2)}class FO extends Bu{constructor(e){super(e),this.center=e.center||[0,30];const[i,l]=this.parallels=e.parallels||[30,30];let u=Xe(i),f=Xe(l);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const p=Math.cos(u),v=ev(u);this.n=u===f?Math.sin(u):Math.log(p/Math.cos(f))/Math.log(ev(f)/v),this.f=p*Math.pow(ev(u),this.n)/this.n}project(e,i){i=Xe(i),this.southernCenter&&(i=-i),e=Xe(e-this.center[0]);const l=1e-6,{n:u,f}=this;f>0?i<-Bf+l&&(i=-Bf+l):i>Bf-l&&(i=Bf-l);const p=f/Math.pow(ev(i),u);let v=p*Math.sin(u*e),w=f-p*Math.cos(u*e);return v=.5*(v/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:v,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:u}=this,f=u-i,p=Math.sign(f),v=Math.sign(l)*Math.sqrt(e*e+f*f);let w=Math.atan2(e,Math.abs(f))*p;f*l<0&&(w-=Math.PI*Math.sign(e)*p);const E=Pe(ee(w/l)+this.center[0],-180,180),C=Pe(ee(2*Math.atan(Math.pow(u/v,1/l))-Bf),-ze,ze);return new Z(E,this.southernCenter?-C:C)}}class HA extends Bu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ye(e),y:Ce(i),z:0}}unproject(e,i){const l=ke(e),u=Me(i);return new Z(l,u)}}const ZA=Xe(ze);class BO extends Bu{project(e,i){const l=(i=Xe(i))*i,u=l*l;return{x:.5*((e=Xe(e))*(.8707-.131979*l+u*(u*(.003971*l-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+u*(.028874*l-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,u=25,f=0,p=l*l;do{p=l*l;const E=p*p;f=(l*(1.007226+p*(.015085+E*(.028874*p-.044475-.005916*E)))-i)/(1.007226+p*(.045255+E*(.259866*p-.311325-.005916*11*E))),l=Pe(l-f,-ZA,ZA)}while(Math.abs(f)>1e-6&&--u>0);p=l*l;const v=Pe(ee(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),w=ee(l);return new Z(v,w)}}const XA=Xe(ze);class NO extends Bu{project(e,i){i=Xe(i),e=Xe(e);const l=Math.cos(i),u=2/Math.PI,f=Math.acos(l*Math.cos(e/2)),p=Math.sin(f)/f,v=.5*(e*u+2*l*Math.sin(e/2)/p)||0,w=.5*(i+Math.sin(i)/p)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let l=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,f=25;const p=1e-6;let v=0,w=0;do{const E=Math.cos(u),C=Math.sin(u),z=2*C*E,L=C*C,N=E*E,U=Math.cos(l/2),X=Math.sin(l/2),J=2*U*X,Q=X*X,le=1-N*U*U,he=le?1/le:0,ge=le?Math.acos(E*U)*Math.sqrt(1/le):0,Le=.5*(2*ge*E*X+2*l/Math.PI)-e,Oe=.5*(ge*C+u)-i,Ve=.5*he*(N*Q+ge*E*U*L)+1/Math.PI,We=he*(J*z/4-ge*C*X),He=.125*he*(z*X-ge*C*N*J),Tt=.5*he*(L*U+ge*Q*E)+.5,Ke=We*He-Tt*Ve;v=(Oe*We-Le*Tt)/Ke,w=(Le*He-Oe*Ve)/Ke,l=Pe(l-v,-Math.PI,Math.PI),u=Pe(u-w,-XA,XA)}while((Math.abs(v)>p||Math.abs(w)>p)&&--f>0);return new Z(ee(l),ee(u))}}class YA extends Bu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Xe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:l,cosPhi:u}=this;return{x:Xe(e)*u*l+.5,y:-Math.sin(Xe(i))/u*l+.5,z:0}}unproject(e,i){const{scale:l,cosPhi:u}=this,f=-(i-.5)/l,p=Pe(ee((e-.5)/l)/u,-180,180),v=Math.asin(Pe(f*u,-1,1)),w=Pe(ee(v),-ze,ze);return new Z(p,w)}}class VO extends HA{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,l){const u=Nm(e,i,l);return Je(u,u,Cy(Hl(l))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i,l){const u=B(i.lat,i.lng),f=tt([],u),p=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Kt(u,u,f,Ae(1,0)*Yt*p);const v=G(new Float64Array(16));return Y(v,e.pixelMatrix,e.globeMatrix),Je(u,u,v),new Mt(u[0],u[1])}pixelsPerMeter(e,i){return Ae(1,0)*i}pixelSpaceConversion(e,i,l){const u=Ae(1,e)*i,f=Rn(Ae(1,45)*i,u,l);return this.pixelsPerMeter(e,i)/f}createTileMatrix(e,i,l){const u=r1(Hl(l.canonical));return Y(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:l}=e,u=Cy(Hl(i));return me(u,u,Xe(l.lng)),ce(u,u,Xe(l.lat)),oe(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,l,u){return vS(e,i,l,!0)||new pt(0,0)}pointCoordinate3D(e,i,l){const u=this.pointCoordinate(e,i,l,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!vS(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(u,f){const p=u.cameraToCenterDistance,v=u._centerAltitude*f,w=u._camera,E=u._camera.forward(),C=Ne([],Dt([],E,-p),[0,0,v]),z=u.worldSize/(2*Math.PI),L=[0,0,-z],N=u.width/u.height,U=Math.tan(u.fovAboveCenter),X=Dt([],w.up(),U),J=Dt([],w.right(),U*N),Q=tt([],Ne([],Ne([],E,X),J)),le=[];let he;if(new Di(C,Q).closestPointOnSphere(L,z,le)){const ge=Ne([],le,L),Le=Jt([],ge,C);he=Math.cos(u.fovAboveCenter)*De(Le)}else{const ge=Jt([],C,L),Le=Jt([],L,C);tt(Le,Le);const Oe=De(ge)-z;he=Math.sqrt(Oe*(Oe+2*z));const Ve=Math.acos(he/(z+Oe))-Math.acos(gt(E,Le));he*=Math.cos(Ve)}return 1.01*he})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Ru(e.zoom);if(l>0){const u=WA(e,Ae(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Rn(i,u+f*(1-Math.cos(p)),Math.pow(l,10))}return i}upVector(e,i,l){return Nm(i,l,e,1)}upVectorScale(e){return{metersToTile:Ay(My(Hl(e)))}}}function KA(o){const e=o.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new HA(o);case"equirectangular":return new OO(o);case"naturalEarth":return new BO(o);case"equalEarth":return new LO(o);case"winkelTripel":return new NO(o);case"albers":return i?new YA(o):new DO(o);case"lambertConformalConic":return i?new YA(o):new FO(o);case"globe":return new VO(o)}throw new Error(`Invalid projection name: ${o.name}`)}const UO=Ot.types,jO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tv(o,e,i,l,u,f,p,v,w,E,C,z,L){const N=v?Math.min(Fu,Math.round(v[0])):0,U=v?Math.min(Fu,Math.round(v[1])):0;o.emplaceBack(e,i,Math.round(32*l),Math.round(32*u),f,p,(N<<1)+(w?1:0),U,16*E,16*C,256*z,256*L)}function nv(o,e,i){o.emplaceBack(e,i)}function iv(o,e,i,l,u,f,p){o.emplaceBack(e,i,l,u,f,p)}const rv=(o,e,i,l)=>{for(let u=0;u<e;u++)o.emplaceBack(i[0],i[1],i[2],l[0],l[1],l[2])};function ov(o,e,i,l,u){o.emplaceBack(e,i,l,u),o.emplaceBack(e,i,l,u),o.emplaceBack(e,i,l,u),o.emplaceBack(e,i,l,u)}function GO(o){for(const e of o.sections)if(qx(e.text))return!0;return!1}class J1{constructor(e){this.layoutVertexArray=new Mm,this.indexArray=new Eo,this.programConfigurations=e,this.segments=new Fr,this.dynamicLayoutVertexArray=new ba,this.opacityVertexArray=new Au,this.placedSymbolArray=new wf,this.iconTransitioningVertexArray=new vo,this.globeExtVertexArray=new Cm,this.zOffsetVertexArray=new Ul,this.orientationVertexArray=new Ch}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,l,u,f){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,X3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,K3.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,jO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,$3.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Y3.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,J3.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,Q3.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}ln(J1,"SymbolBuffers");class Q1{constructor(e,i,l){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new l,this.segments=new Fr,this.collisionVertexArray=new km,this.collisionVertexArrayExt=new ba}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,eO.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,tO.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ln(Q1,"CollisionBuffers");class sv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((p=>p.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=G([]),this.placementViewportMatrix=G([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=EA(this.zoom,i["text-size"],this.worldview),this.iconSizeData=EA(this.zoom,i["icon-size"],this.worldview);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.lut=e.lut,this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map((p=>Xs[p])),this.stateDependentLayerIds=this.layers.filter((p=>p.isStateDependent())).map((p=>p.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new J1(new wa(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new J1(new wa(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new _y,this.lineVertexArray=new yy,this.symbolInstances=new gy}calculateGlyphDependencies(e,i,l,u,f){for(const p of e){const v=p.codePointAt(0);if(v===void 0)break;if(i[v]=!0,u&&f&&v<=65535){const w=rg[p];w&&(i[w.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Ly(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}populate(e,i,l,u){const f=this.layers[0],p=f.layout,v=this.projection.name==="globe",w=p.get("text-font"),E=p.get("text-field"),C=p.get("icon-image"),[z,L]=p.get("icon-size-scale-range"),N=Pe(i.scaleFactor||1,z,L),U=(E.value.kind!=="constant"||E.value.value instanceof ds&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),X=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,J=p.get("symbol-sort-key");if(this.features=[],!U&&!X)return;const Q=i.iconDependencies,le=i.glyphDependencies,he=i.availableImages,ge=new dr(this.zoom,{worldview:this.worldview});for(const{feature:Le,id:Oe,index:Ve,sourceLayerIndex:We}of e){const He=f._featureFilter.needGeometry,Tt=Vt(Le,He);if(!f._featureFilter.filter(ge,Tt,l))continue;if(He||(Tt.geometry=nn(Le,l,u)),v&&Le.type!==1&&l.z<=5){const Pt=Tt.geometry,Ut=.98078528056,bt=(kt,dt)=>gt(Nm(kt.x,kt.y,l,1),Nm(dt.x,dt.y,l,1))<Ut;for(let kt=0;kt<Pt.length;kt++)Pt[kt]=xt(Pt[kt],bt)}let Ke,Et;if(U){const Pt=f.getValueAndResolveTokens("text-field",Tt,l,he),Ut=ds.factory(Pt);GO(Ut)&&(this.hasRTLText=!0),(!this.hasRTLText||cf()==="unavailable"||this.hasRTLText&&za.isParsed())&&(Ke=iO(Ut,f,Tt))}if(X){const Pt=f.getValueAndResolveTokens("icon-image",Tt,l,he);Et=typeof Pt=="string"?ws.build(Pt):Pt}if(!Ke&&!Et)continue;const Ft=this.sortFeaturesByKey?J.evaluate(Tt,{},l):void 0,It={id:Oe,text:Ke,icon:Et,index:Ve,sourceLayerIndex:We,geometry:Tt.geometry,properties:Le.properties,type:UO[Le.type],sortKey:Ft};if(this.features.push(It),Et){const Pt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ut,iconSecondary:bt}=VA(Et,this.iconSizeData,Pt["icon-size"],l,this.zoom,It,this.pixelRatio,N,this.worldview),kt=Ut.id.toString();if(Q.has(kt)?Q.get(kt).push(Ut):Q.set(kt,[Ut]),bt){this.hasAnySecondaryIcon=!0;const dt=bt.id.toString();Q.has(dt)?Q.get(dt).push(bt):Q.set(dt,[bt])}}if(Ke){const Pt=w.evaluate(Tt,{},l).join(","),Ut=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xs.vertical)>=0;for(const bt of Ke.sections)if(bt.image){const kt=bt.image.getPrimary().scaleSelf(this.pixelRatio),dt=kt.id.toString(),lt=Q.get(dt)||[];lt.push(kt),Q.set(dt,lt)}else{const kt=ym(Ke.toString()),dt=bt.fontStack||Pt,lt=le[dt]=le[dt]||{};this.calculateGlyphDependencies(bt.text,lt,Ut,this.allowVerticalPlacement,kt)}}}if(p.get("symbol-placement")==="line"&&(this.features=(function(Le){const Oe={},Ve={},We=[];let He=0;function Tt(It){We.push(Le[It]),He++}function Ke(It,Pt,Ut){const bt=Ve[It];return delete Ve[It],Ve[Pt]=bt,We[bt].geometry[0].pop(),We[bt].geometry[0]=We[bt].geometry[0].concat(Ut[0]),bt}function Et(It,Pt,Ut){const bt=Oe[Pt];return delete Oe[Pt],Oe[It]=bt,We[bt].geometry[0].shift(),We[bt].geometry[0]=Ut[0].concat(We[bt].geometry[0]),bt}function Ft(It,Pt,Ut){const bt=Ut?Pt[0][Pt[0].length-1]:Pt[0][0];return`${It}:${bt.x}:${bt.y}`}for(let It=0;It<Le.length;It++){const Pt=Le[It],Ut=Pt.geometry,bt=Pt.text?Pt.text.toString():null;if(!bt){Tt(It);continue}const kt=Ft(bt,Ut),dt=Ft(bt,Ut,!0);if(kt in Ve&&dt in Oe&&Ve[kt]!==Oe[dt]){const lt=Et(kt,dt,Ut),jt=Ke(kt,dt,We[lt].geometry);delete Oe[kt],delete Ve[dt],Ve[Ft(bt,We[jt].geometry,!0)]=jt,We[lt].geometry=null}else kt in Ve?Ke(kt,dt,Ut):dt in Oe?Et(kt,dt,Ut):(Tt(It),Oe[kt]=He-1,Ve[dt]=He-1)}return We.filter((It=>It.geometry))})(this.features)),p.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Le of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Le.id,this.elevationFeatures.length),this.elevationFeatures.push(Le)}}else p.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((Le,Oe)=>Le.sortKey-Oe.sortKey))}update(e,i,l,u,f,p,v){this.text.programConfigurations.updatePaintArrays(e,i,f,l,u,p,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,f,l,u,p,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const l=$e(e),u=1/l;let f=!1,p=!1;for(let v=0;v<this.symbolInstances.length;v++){const w=this.symbolInstances.get(v),E=Be(1,0,0),C=Be(0,1,0),{numHorizontalGlyphVertices:z,numVerticalGlyphVertices:L,numIconVertices:N,numVerticalIconVertices:U}=w,X=z>0||L>0,J=N>0,Q=this.elevationFeatures[w.elevationFeatureIndex];if(Q){const le=new Mt(w.tileAnchorX,w.tileAnchorY),he=.075+Q.pointElevation(le);w.zOffset!==he&&(i=!0,w.zOffset=he);const ge=Q.computeSlopeNormal(le,u),Le=$r(yi(),Be(0,0,1),ge);ut(E,E,Le),ut(C,C,Le),E[2]*=l,C[2]*=l,E[0]===1&&E[1]===0&&E[2]===0&&C[0]===0&&C[1]===1&&C[2]===0||(f=f||X,p=p||J)}if(X&&(rv(this.text.orientationVertexArray,z,E,C),rv(this.text.orientationVertexArray,L,E,C)),J){const{placedIconSymbolIndex:le,verticalPlacedIconSymbolIndex:he}=w;le>=0&&rv(this.icon.orientationVertexArray,N,E,C),he>=0&&rv(this.icon.orientationVertexArray,U,E,C)}}f||(this.text.orientationVertexArray=void 0),p||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(f,p,v)=>{l+=p,l>f.length&&f.resize(l);for(let w=-p;w<0;w++)f.emplace(w+l,v)},i=(f,p,v)=>{u+=p,u>f.length&&f.resize(u);for(let w=-p;w<0;w++)f.emplace(w+u,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,u=0;for(let f=0;f<this.symbolInstances.length;f++){const p=this.symbolInstances.get(f),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:w,numIconVertices:E}=p,C=p.zOffset,z=E>0;if((v>0||w>0)&&(e(this.text.zOffsetVertexArray,v,C),e(this.text.zOffsetVertexArray,w,C)),z){const{placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:N}=p;L>=0&&i(this.icon.zOffsetVertexArray,E,C),N>=0&&i(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,C)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=KA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:f}of i)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,i,l,u,f,p,v,w,E,C,z,L,N,U,X,J){const Q=e.indexArray,le=e.layoutVertexArray,he=e.globeExtVertexArray,ge=e.segments.prepareSegment(4*i.length,le,Q,this.canOverlap?p.sortKey:void 0),Le=this.glyphOffsetArray.length,Oe=ge.vertexLength,Ve=this.allowVerticalPlacement&&v===Xs.vertical?Math.PI/2:0,We=p.text&&p.text.sections;for(let Tt=0;Tt<i.length;Tt++){const{tl:Ke,tr:Et,bl:Ft,br:It,texPrimary:Pt,texSecondary:Ut,pixelOffsetTL:bt,pixelOffsetBR:kt,minFontScaleX:dt,minFontScaleY:lt,glyphOffset:jt,isSDF:Nt,sectionIndex:wn}=i[Tt],sn=ge.vertexLength,pn=jt[1];if(tv(le,E.x,E.y,Ke.x,pn+Ke.y,Pt.x,Pt.y,l,Nt,bt.x,bt.y,dt,lt),tv(le,E.x,E.y,Et.x,pn+Et.y,Pt.x+Pt.w,Pt.y,l,Nt,kt.x,bt.y,dt,lt),tv(le,E.x,E.y,Ft.x,pn+Ft.y,Pt.x,Pt.y+Pt.h,l,Nt,bt.x,kt.y,dt,lt),tv(le,E.x,E.y,It.x,pn+It.y,Pt.x+Pt.w,Pt.y+Pt.h,l,Nt,kt.x,kt.y,dt,lt),w){const{x:Xt,y:xn,z:Zn}=w.anchor,[en,_n,zn]=w.up;iv(he,Xt,xn,Zn,en,_n,zn),iv(he,Xt,xn,Zn,en,_n,zn),iv(he,Xt,xn,Zn,en,_n,zn),iv(he,Xt,xn,Zn,en,_n,zn),ov(e.dynamicLayoutVertexArray,Xt,xn,Zn,Ve)}else ov(e.dynamicLayoutVertexArray,E.x,E.y,E.z,Ve);if(J){const Xt=Ut||Pt;nv(e.iconTransitioningVertexArray,Xt.x,Xt.y),nv(e.iconTransitioningVertexArray,Xt.x+Xt.w,Xt.y),nv(e.iconTransitioningVertexArray,Xt.x,Xt.y+Xt.h),nv(e.iconTransitioningVertexArray,Xt.x+Xt.w,Xt.y+Xt.h)}Q.emplaceBack(sn,sn+1,sn+2),Q.emplaceBack(sn+1,sn+2,sn+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(jt[0]),Tt!==i.length-1&&wn===i[Tt+1].sectionIndex||e.programConfigurations.populatePaintArrays(le.length,p,p.index,{},N,U,X,We&&We[wn],this.worldview)}const He=w?w.anchor:E;e.placedSymbolArray.emplaceBack(He.x,He.y,He.z,E.x,E.y,Le,this.glyphOffsetArray.length-Le,Oe,C,z,E.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],v,0,0,0,L,0)}_commitLayoutVertex(e,i,l,u,f,p,v){e.emplaceBack(i,l,u,f,p,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,i,l,u,f,p,v){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),E=w.vertexLength,C=v.tileAnchorX,z=v.tileAnchorY;for(let N=0;N<4;N++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,i,e.padding,v.zOffset),this._commitLayoutVertex(l.layoutVertexArray,u,f,p,C,z,new Mt(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,f,p,C,z,new Mt(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,f,p,C,z,new Mt(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,f,p,C,z,new Mt(e.x1,e.y2)),w.vertexLength+=4;const L=l.indexArray;L.emplaceBack(E,E+1),L.emplaceBack(E+1,E+2),L.emplaceBack(E+2,E+3),L.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,l,u,f,p){for(let v=u;v<f;v++){const w=l.get(v),E=this.getSymbolInstanceTextSize(e,p,i,v);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,l,u,f,p){for(let v=u;v<f;v++){const w=l.get(v),E=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Q1(_f,uA.members,vo),this.iconCollisionBox=new Q1(_f,uA.members,vo);const u=sg(this.iconSizeData,e),f=sg(this.textSizeData,e,l);for(let p=0;p<this.symbolInstances.length;p++){const v=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(f,e,i,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(f,e,i,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,e,i,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,e,i,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,i,l,u){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),p=W1(this.textSizeData,e,f)/No;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,l){const u=this.icon.placedSymbolArray.get(l),f=W1(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,l,u){e.emplaceBack(i,-l,-l,u),e.emplaceBack(i,l,-l,u),e.emplaceBack(i,l,l,u),e.emplaceBack(i,-l,l,u)}_updateTextDebugCollisionBoxes(e,i,l,u,f,p,v){for(let w=u;w<f;w++){const E=l.get(w),C=this.getSymbolInstanceTextSize(e,p,i,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,E.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,i,l,u,f,p,v){for(let w=u;w<f;w++){const E=l.get(w),C=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,E.padding,p.zOffset)}}updateCollisionDebugBuffers(e,i,l,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=sg(this.iconSizeData,e,u),p=sg(this.textSizeData,e,l);for(let v=0;v<this.symbolInstances.length;v++){const w=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(p,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w,l),this._updateTextDebugCollisionBoxes(p,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w,l),this._updateIconDebugCollisionBoxes(f,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w,u),this._updateIconDebugCollisionBoxes(f,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,l,u,f,p,v,w,E){const C={};if(i<l){const{x1:z,y1:L,x2:N,y2:U,padding:X,projectedAnchorX:J,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:he,tileAnchorY:ge,featureIndex:Le}=e.get(i);C.textBox={x1:z,y1:L,x2:N,y2:U,padding:X,projectedAnchorX:J,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:he,tileAnchorY:ge},C.textFeatureIndex=Le}if(u<f){const{x1:z,y1:L,x2:N,y2:U,padding:X,projectedAnchorX:J,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:he,tileAnchorY:ge,featureIndex:Le}=e.get(u);C.verticalTextBox={x1:z,y1:L,x2:N,y2:U,padding:X,projectedAnchorX:J,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:he,tileAnchorY:ge},C.verticalTextFeatureIndex=Le}if(p<v){const{x1:z,y1:L,x2:N,y2:U,padding:X,projectedAnchorX:J,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:he,tileAnchorY:ge,featureIndex:Le}=e.get(p);C.iconBox={x1:z,y1:L,x2:N,y2:U,padding:X,projectedAnchorX:J,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:he,tileAnchorY:ge},C.iconFeatureIndex=Le}if(w<E){const{x1:z,y1:L,x2:N,y2:U,padding:X,projectedAnchorX:J,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:he,tileAnchorY:ge,featureIndex:Le}=e.get(w);C.verticalIconBox={x1:z,y1:L,x2:N,y2:U,padding:X,projectedAnchorX:J,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:he,tileAnchorY:ge},C.verticalIconFeatureIndex=Le}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const l=e.placedSymbolArray.get(i),u=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),l=Math.cos(e),u=[],f=[],p=[];for(let v=0;v<this.symbolInstances.length;++v){p.push(v);const w=this.symbolInstances.get(v);u.push(0|Math.round(i*w.tileAnchorX+l*w.tileAnchorY)),f.push(w.featureIndex)}return p.sort(((v,w)=>u[v]-u[w]||f[w]-f[v])),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=l;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),p>=0&&p!==f&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let JA,QA,$1;ln(sv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),sv.addDynamicAttributes=ov;class $A{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Pa,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ln($A,"FormatSectionOverride",{omit:["defaultValue"]});const eb=()=>$1||($1={layout:JA||(JA=new Ur({"symbol-placement":new Wt(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Wt(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Wt(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new tn(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Wt(Ye.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Wt(Ye.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Wt(Ye.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Wt(Ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Wt(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Wt(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Wt(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new tn(Ye.layout_symbol["icon-size"]),"icon-size-scale-range":new Wt(Ye.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new tn(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new tn(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new tn(Ye.layout_symbol["icon-image"]),"icon-image-use-theme":new Wt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new tn(Ye.layout_symbol["icon-rotate"]),"icon-padding":new Wt(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Wt(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new tn(Ye.layout_symbol["icon-offset"]),"icon-anchor":new tn(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Wt(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Wt(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Wt(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new tn(Ye.layout_symbol["text-field"]),"text-font":new tn(Ye.layout_symbol["text-font"]),"text-size":new tn(Ye.layout_symbol["text-size"]),"text-size-scale-range":new Wt(Ye.layout_symbol["text-size-scale-range"]),"text-max-width":new tn(Ye.layout_symbol["text-max-width"]),"text-line-height":new tn(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new tn(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new tn(Ye.layout_symbol["text-justify"]),"text-radial-offset":new tn(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Wt(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new tn(Ye.layout_symbol["text-anchor"]),"text-max-angle":new Wt(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Wt(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new tn(Ye.layout_symbol["text-rotate"]),"text-padding":new Wt(Ye.layout_symbol["text-padding"]),"text-keep-upright":new Wt(Ye.layout_symbol["text-keep-upright"]),"text-transform":new tn(Ye.layout_symbol["text-transform"]),"text-offset":new tn(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new Wt(Ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Wt(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new Wt(Ye.layout_symbol["text-optional"]),visibility:new Wt(Ye.layout_symbol.visibility)})),paint:QA||(QA=new Ur({"icon-opacity":new tn(Ye.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new tn(Ye.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new tn(Ye.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new tn(Ye.paint_symbol["text-emissive-strength"]),"icon-color":new tn(Ye.paint_symbol["icon-color"]),"icon-halo-color":new tn(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new tn(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new tn(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Wt(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Wt(Ye.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Wt(Ye.paint_symbol["icon-image-cross-fade"]),"text-opacity":new tn(Ye.paint_symbol["text-opacity"]),"text-occlusion-opacity":new tn(Ye.paint_symbol["text-occlusion-opacity"]),"text-color":new tn(Ye.paint_symbol["text-color"],{runtimeType:As,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new tn(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new tn(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new tn(Ye.paint_symbol["text-halo-blur"]),"text-translate":new Wt(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new Wt(Ye.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Wt(Ye.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Wt(Ye.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Wt(Ye.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Wt(Ye.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new tn(Ye.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},$1);class av extends ss{constructor(e,i,l,u){super(e,eb(),i,l,u,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=G([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const f of l)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,l,u){return this._saturation===e&&this._contrast===i&&this._brightnessMin===l&&this._brightnessMax===u||(this._colorAdjustmentMatrix=(function(f,p,v,w){f=rs(f),p=is(p);const E=W(),C=f/3,z=1-2*C,L=[z,C,C,0,C,z,C,0,C,C,z,0,0,0,0,1],N=.5-.5*p,U=w-v;return Y(E,[U,0,0,0,0,U,0,0,0,0,U,0,v,v,v,1],[p,0,0,0,0,p,0,0,0,0,p,0,N,N,N,1]),Y(E,E,L),E})(e,i,l,u),this._saturation=e,this._contrast=i,this._brightnessMin=l,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,l,u){const f=this.layout.get(e).evaluate(i,{},l,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||mm(p.value)||!f?f:(function(v,w){return w.replace(/{([^{}]+)}/g,((E,C)=>C in v?String(v[C]):""))})(i.properties,f)}createBucket(e){return new sv(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of eb().paint.overridableProperties){if(!av.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),l=new $A(i),u=new tf(l,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new Sh("source",u):new Ll("composite",u,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Sc(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&av.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const l=e.get("text-field"),u=eb().paint.properties[i];let f=!1;const p=v=>{for(const w of v)if(u.overrides&&u.overrides.hasOverride(w))return void(f=!0)};if(l.value.kind==="constant"&&l.value.value instanceof ds)p(l.value.value.sections);else if(l.value.kind==="source"){const v=E=>{f||(E instanceof si&&ko(E.value)===Il?p(E.value.sections):E instanceof hc?p(E.sections):E.eachChild(v))},w=l.value;w._styleExpression&&v(w._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,l){return{config:new kc(this,{zoom:i,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let eI,tI,nI,iI;var tb=xi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function lv(o,e,i,l,u,f,p,v){const w=[o,e,1,i,l,1,u,f,1],E=[p,v,1],C=F([],w),[z,L,N]=Rt(E,E,C);return V(w,w,[z,0,0,0,L,0,0,0,N])}function rI(o,e,i,l,u,f,p,v){const w=(function(E,C,z,L,N,U,X,J){const Q=lv(0,0,1,0,1,1,0,1),le=lv(E,C,z,L,N,U,X,J);return V(le,le,F([],Q))})(o,e,i,l,u,f,p,v);return[w[2]/w[8]/Yt,w[5]/w[8]/Yt]}function cv(o){return[o[0],Math.min(Math.max(o[1],-ze),ze)]}class oI extends cc{constructor(e,i,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new ga("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=iu(this.map._requestManager.transformRequest(this.url,gd.Image),((l,u)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new lh(l)):u&&(this.image=u instanceof HTMLImageElement?Ca.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new tg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ga("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof tg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],l=e[0][1];for(const f of e)f[1]>l&&(l=f[1]),f[1]<i&&(i=f[1]);const u=(l+i)/2;if(u>ze?this.onNorthPole=!0:u<-ze&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=e.map(pt.fromLngLat);this.tileID=(function(p){let v=1/0,w=1/0,E=-1/0,C=-1/0;for(const X of p)v=Math.min(v,X.x),w=Math.min(w,X.y),E=Math.max(E,X.x),C=Math.max(C,X.y);const z=Math.max(E-v,C-w),L=Math.max(0,Math.floor(-Math.log2(z))),N=Math.pow(2,L);let U=Math.floor((v+E)/2*N);return U>1&&(U-=1),new rl(L,U,Math.floor((w+C)/2*N))})(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ga("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof tg||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const Q in this.tiles){const le=this.tiles[Q];le.state!=="loaded"&&(le.state="loaded",le.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=ug(new rl(0,0,0),this.map.transform.projection),l=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(Q){const le=Q[1].x-Q[0].x,he=Q[1].y-Q[0].y,ge=Q[2].x-Q[1].x,Le=Q[2].y-Q[1].y,Oe=Q[3].x-Q[2].x,Ve=Q[3].y-Q[2].y,We=Q[0].x-Q[3].x,He=Q[0].y-Q[3].y,Tt=le*Le-ge*he,Ke=ge*Ve-Oe*Le,Et=Oe*He-We*Ve,Ft=We*he-le*He;return Tt>0&&Ke>0&&Et>0&&Ft>0||Tt<0&&Ke<0&&Et<0&&Ft<0})(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=ug(this.tileID,this.map.transform.projection),[f,p,v,w]=this.coordinates.map((Q=>{const le=u.projection.project(Q[0],Q[1]);return qA(u,le)._round()}));this.perspectiveTransform=rI(f.x,f.y,p.x,p.y,v.x,v.y,w.x,w.y);const E=this._boundsArray=new Mc;E.emplaceBack(f.x,f.y,0,0),E.emplaceBack(p.x,p.y,Yt,0),E.emplaceBack(w.x,w.y,0,Yt),E.emplaceBack(v.x,v.y,Yt,Yt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(E,tb.members),this.boundsSegments=Fr.simpleSegment(0,0,4,2);const C=[],z=[cv((L=this.coordinates)[0]),cv(L[1]),cv(L[2]),cv(L[3])];var L;const[N,U,X,J]=(function(Q){let le=Q[0][0],he=le,ge=Q[0][1],Le=ge;for(let Oe=1;Oe<Q.length;Oe++)Q[Oe][0]<le?le=Q[Oe][0]:Q[Oe][0]>he&&(he=Q[Oe][0]),Q[Oe][1]<ge?ge=Q[Oe][1]:Q[Oe][1]>Le&&(Le=Q[Oe][1]);return[le,ge,he-le,Le-ge]})(z);{const Q=new Mc,[le,he,ge,Le]=(function(bt){let kt=bt[0].x,dt=kt,lt=bt[0].y,jt=lt;for(let Nt=1;Nt<bt.length;Nt++)bt[Nt].x<kt?kt=bt[Nt].x:bt[Nt].x>dt&&(dt=bt[Nt].x),bt[Nt].y<lt?lt=bt[Nt].y:bt[Nt].y>jt&&(jt=bt[Nt].y);return[kt,lt,dt-kt,jt-lt]})(l),Oe=bt=>[(bt.x-le)/ge,(bt.y-he)/Le],[Ve,We,He,Tt]=l.map(Oe),Ke=(function(bt,kt,dt,lt,jt,Nt,wn,sn){const pn=lv(0,0,1,0,1,1,0,1);return V(pn,pn,F([],lv(bt,kt,dt,lt,jt,Nt,wn,sn)))})(Ve[0],Ve[1],We[0],We[1],He[0],He[1],Tt[0],Tt[1]);this.elevatedGlobePerspectiveTransform=rI(Ve[0],Ve[1],We[0],We[1],He[0],He[1],Tt[0],Tt[1]);const Et=(bt,kt)=>{C.push(bt.lng);const dt=Math.round((bt.lng-N)/X*Yt),lt=Math.round((bt.lat-U)/J*Yt),jt=Oe(kt),Nt=Rt([],[jt[0],jt[1],1],Ke),wn=Math.round(Nt[0]/Nt[2]*Yt),sn=Math.round(Nt[1]/Nt[2]*Yt);Q.emplaceBack(dt,lt,wn,sn)},Ft=l[3].x-l[0].x,It=l[3].y-l[0].y,Pt=l[2].x-l[1].x,Ut=l[2].y-l[1].y;for(let bt=0;bt<65;bt++){const kt=bt/64,dt=[l[0].x+kt*Ft,l[0].y+kt*It],lt=[l[1].x+kt*Pt,l[1].y+kt*Ut],jt=lt[0]-dt[0],Nt=lt[1]-dt[1];for(let wn=0;wn<65;wn++){const sn=wn/64,pn={x:dt[0]+jt*sn,y:dt[1]+Nt*sn};Et(i.projection.unproject(pn.x,pn.y),pn)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(Q,tb.members)}{this.maxLongitudeTriangleSize=0;let Q=[],le=new Eo;const he=(ge,Le,Oe)=>{le.emplaceBack(ge,Le,Oe);const Ve=C[ge],We=C[Le],He=C[Oe],Tt=Math.min(Math.min(Ve,We),He),Ke=Math.max(Math.max(Ve,We),He)-Tt;Ke>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ke),Q.push(Tt+Ke/2)};for(let ge=0;ge<64;ge++)for(let Le=0;Le<64;Le++){const Oe=65*ge+Le,Ve=Oe+1,We=Oe+65,He=We+1;he(Oe,We,Ve),he(Ve,We,He)}[Q,le]=(function(ge,Le){const Oe=Array.from({length:ge.length},((He,Tt)=>Tt));Oe.sort(((He,Tt)=>ge[He]-ge[Tt]));const Ve=[],We=new Eo;for(let He=0;He<Oe.length;He++){const Tt=Oe[He];Ve.push(ge[Tt]);const Ke=3*Tt,Et=Ke+1;We.emplaceBack(Le.uint16[Ke],Le.uint16[Et],Le.uint16[Et+1])}return[Ve,We]})(Q,le),this.elevatedGlobeTrianglesCenterLongitudes=Q,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(le)}this.elevatedGlobeSegments=Fr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,X/Yt,0,J/Yt,0,0,U,N,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,l=i.gl;!this._dirty||this.texture instanceof tg||(this.texture?this.texture.update(this.image):(this.texture=new C1(i,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let u=(f=e+180)+360*Math.round((l[0]-f)/360);var f;const p=new Fr,v=(z,L)=>{p.segments.push({vertexOffset:0,primitiveOffset:z,vertexLength:i.segments[0].vertexLength,primitiveLength:L,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-u)<=w){const z=So(l,0,l.length,u+w);return z===l.length||v(z,mr(l,z+1,l.length,u+360-w)-z),p}u<l[0]&&(u+=360);const E=mr(l,0,l.length,u-w);if(E===l.length)return v(0,l.length),p;v(0,E-0);const C=So(l,E+1,l.length,u+w);return C!==l.length&&v(C,l.length-C),p}}const WO=(Math.pow(256,2)-1)/16907520;class sI extends ss{constructor(e,i,l,u){super(e,{layout:nI||(nI=new Ur({visibility:new Wt(Ye.layout_raster.visibility)})),paint:iI||(iI=new Ur({"raster-opacity":new Wt(Ye.paint_raster["raster-opacity"]),"raster-color":new bu(Ye.paint_raster["raster-color"]),"raster-color-mix":new Wt(Ye.paint_raster["raster-color-mix"]),"raster-color-range":new Wt(Ye.paint_raster["raster-color-range"]),"raster-hue-rotate":new Wt(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Wt(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Wt(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Wt(Ye.paint_raster["raster-saturation"]),"raster-contrast":new Wt(Ye.paint_raster["raster-contrast"]),"raster-resampling":new Wt(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Wt(Ye.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Wt(Ye.paint_raster["raster-emissive-strength"]),"raster-array-band":new Wt(Ye.paint_raster["raster-array-band"]),"raster-elevation":new Wt(Ye.paint_raster["raster-elevation"]),"raster-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof oI&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[l,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(u)||l===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=Vm({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,u])}}let aI,lI,cI,uI,hI;class dI extends ss{constructor(e,i,l,u){super(e,{layout:aI||(aI=new Ur({visibility:new Wt(Ye["layout_raster-particle"].visibility)})),paint:lI||(lI=new Ur({"raster-particle-array-band":new Wt(Ye["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Wt(Ye["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new bu(Ye["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Wt(Ye["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Wt(Ye["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Wt(Ye["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Wt(Ye["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Wt(Ye["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,u),this._updateColorRamp(),this.lastInvalidatedAt=Ca.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Vm({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ca.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class qO extends ss{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function nb(o,e,i){const l=[0,0,1],u=Ri([]);return wi(u,u,i?-Xe(o)+Math.PI:Xe(o)),ur(u,u,-Xe(e)),ut(l,l,u),tt(l,l)}const fI={None:0,Model:1,Symbol:2,FillExtrusion:4};class uv{constructor(e,i,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function ib(o,e){const i=o.indexOf("://")===-1;try{return new URL(o,i&&e?"http://example.com":void 0),!0}catch{return!1}}class pI{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class mI{constructor(){this.instancedDataArray=new Dm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class rb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,l,u){this.tileToMeter=$e(l);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:v,index:w,sourceLayerIndex:E}of e){const C=v??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),z=Vt(p,f);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom,{worldview:this.worldview}),z,l))continue;const L={id:C,sourceLayerIndex:E,index:w,geometry:f?z.geometry:nn(p,l,u),properties:p.properties,type:p.type,patterns:{}},N=this.addFeature(L,L.geometry,z);N&&i.featureIndex.insert(p,L.geometry,w,E,this.index,this.instancesPerModel[N].instancedDataArray.length,Yt/32)}this.lookup=null}update(e,i,l,u){for(const f in this.instancesPerModel){const p=this.instancesPerModel[f];for(const v in e)p.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(p.features[p.idToFeaturesIndex[v]],e[v],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];for(const u of l.features){const f=this.layers[0],p=u.feature,v=this.canonical,w=f.paint.get("model-rotation").evaluate(p,{},v),E=f.paint.get("model-scale").evaluate(p,{},v),C=f.paint.get("model-translation").evaluate(p,{},v);on(u.rotation,w)&&on(u.scale,E)&&on(u.translation,C)||(this.evaluate(u,u.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,i,l,u){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const f=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Ly(this.activeReplacements,f))return!1;this.activeReplacements=f;let p=!1;for(const v in this.instancesPerModel){const w=this.instancesPerModel[v],E=w.instancedDataArray;for(const C of w.features){const z=C.instancedDataOffset,L=C.instancedDataCount;for(let N=0;N<L;N++){const U=16*(N+z);let X=E.float32[U+0];const J=X>Yt;X=J?X-Yt:X;const Q=Math.floor(X),le=E.float32[U+1];let he=!1;for(const ge of this.activeReplacements)if(!tE(ge,l,fI.Model,u)&&!(ge.min.x>Q||Q>ge.max.x||ge.min.y>le||le>ge.max.y)&&(he=_1(oE(Q,le,e.canonical,ge.footprintTileId.canonical),ge.footprint),he))break;E.float32[U]=he?X+Yt:X,p=p||he!==J}}}return p}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,x3.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,l){const u=this.layers[0],f=u.layout.get("model-id").evaluate(l,{},this.canonical);if(!f)return oi(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),f;(ib(f,!1)||this.styleDefinedModelURLs[f]!==void 0)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new mI);const p=this.instancesPerModel[f],v=p.instancedDataArray,w=new pI(l,v.length);for(const E of i)for(const C of E){if(C.x<0||C.x>=Yt||C.y<0||C.y>=Yt)continue;if(this.lookupDim!==0){const L=(this.lookupDim-1)/Yt,N=this.lookupDim*(C.y*L|0)+C.x*L|0;if(this.lookup){if(this.lookup[N]!==0)continue;this.lookup[N]=1}}this.instanceCount++;const z=v.length;v.resize(z+1),p.instancesEvaluatedElevation.push(0),v.float32[16*z]=C.x,v.float32[16*z+1]=C.y}return w.instancedDataCount=p.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(w),this.evaluate(w,{},p,!1)),f}getModelUris(){return this.modelUris}evaluate(e,i,l,u){const f=this.layers[0],p=e.feature,v=this.canonical,w=e.rotation=f.paint.get("model-rotation").evaluate(p,i,v),E=e.scale=f.paint.get("model-scale").evaluate(p,i,v),C=e.translation=f.paint.get("model-translation").evaluate(p,i,v),z=f.paint.get("model-color").evaluate(p,i,v);z.a=f.paint.get("model-color-mix-intensity").evaluate(p,i,v);const L=[];this.maxVerticalOffset<C[2]&&(this.maxVerticalOffset=C[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),VE(L,w,E);const N=Math.round(100*z.a)+z.b/1.05;for(let U=0;U<e.instancedDataCount;++U){const X=e.instancedDataOffset+U,J=16*X,Q=l.instancedDataArray.float32;let le=0;u&&(le=Q[J+6]-l.instancesEvaluatedElevation[X]);const he=0|Q[J+1];Q[J]=(0|Q[J])+z.r/1.05,Q[J+1]=he+z.g/1.05,Q[J+2]=N,Q[J+3]=1/(v.z>10?this.tileToMeter:$e(v,he)),Q[J+4]=C[0],Q[J+5]=C[1],Q[J+6]=C[2]+le,Q[J+7]=L[0],Q[J+8]=L[1],Q[J+9]=L[2],Q[J+10]=L[4],Q[J+11]=L[5],Q[J+12]=L[6],Q[J+13]=L[8],Q[J+14]=L[9],Q[J+15]=L[10],l.instancesEvaluatedElevation[X]=C[2]}}}let gI,_I;ln(rb,"ModelBucket",{omit:["layers"]}),ln(mI,"PerModelAttributes"),ln(pI,"ModelFeature");class Nf{constructor(e,i,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(e,i,l){const u=l||e.findDEMTileFor(i);if(!u||!u.dem)return;const f=u.dem,p=u.tileID,v=1<<i.canonical.z-p.canonical.z;return new Nf(u,f.dim/Yt/v,[(i.canonical.x/v-p.canonical.x)*f.dim,(i.canonical.y/v-p.canonical.y)*f.dim])}tileCoordToPixel(e,i){const l=i*this._scale+this._offset[1];return new Mt(Math.floor(e*this._scale+this._offset[0]),Math.floor(l))}getElevationAt(e,i,l,u){const f=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],v=Math.floor(f),w=Math.floor(p),E=this._dem;return u=!!u,l?Rn(Rn(E.get(v,w,u),E.get(v,w+1,u),p-w),Rn(E.get(v+1,w,u),E.get(v+1,w+1,u),p-w),f-v):E.get(v,w,u)}getElevationAtPixel(e,i,l){return this._dem.get(e,i,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ae(1,e)*this._dem.stride}}const ob=new Float32Array(262144),qh=new Uint8Array(262144);function yI(o){let e=0;if(o.meshes)for(const i of o.meshes)e=Math.max(e,i.aabb.max[2]);if(o.children)for(const i of o.children)e=Math.max(e,yI(i));return e}function vI(o,e,i){if(o.meshes)for(const l of o.meshes){if(l.aabb.min[0]===1/0)continue;const u=Fn.applyTransform(l.aabb,o.matrix);i.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(o.children)for(const l of o.children)vI(l,e,i)}const xI=["","wall","door","roof","window","lamp","logo"];class bI{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:yI(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=Fn.applyTransformFast(l.aabb,this.node.matrix),i.encapsulate(l.transformedAabb)),e++;this.aabb=i}return this.aabb}}class hv{constructor(e,i,l,u,f,p,v,w){this.id=l,this.layers=e,this.layerIds=this.layers.map((E=>E.fqid)),this.stateDependentLayerIds=this.layers.filter((E=>E.isStateDependent())).map((E=>E.id)),this.modelTraits|=zf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=zf.HasMapboxMeshFeatures),f&&(this.modelTraits|=zf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.worldview=w,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const E of i)this.nodesInfo.push(new bI(E)),vI(E,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const l of this.getNodesInfo()){const u=l.node;u.footprint&&i.push({footprint:u.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const l=i?this.stateDependentLayers:this.layers;if(!fo(e,this.states))for(const u of l)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const l of i){const u=l.node;this.uploaded?this.updatePbrBuffer(u):R1(u,e,!0)}for(const l of i)qy(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),i=!0);return i}needsReEvaluation(e,i,l){const u=e.transform.projectionOptions,f=e.style.getBrightness(),p=this.brightness!==f;if(!this.uploaded||this.dirty||u.name!==this.projection.name||mg(l.paint.get("model-color").value,p)||mg(l.paint.get("model-color-mix-intensity").value,p)||mg(l.paint.get("model-roughness").value,p)||mg(l.paint.get("model-emissive-strength").value,p)||mg(l.paint.get("model-height-based-emissive-strength-multiplier").value,p)){this.projection=u,this.brightness=f;const v=this.getNodesInfo();for(const w of v)w.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),u=this.id.canonical;for(const f of l){const p=f.feature;f.evaluatedTranslation=i.paint.get("model-translation").evaluate(p,{},u),f.evaluatedScale=i.paint.get("model-scale").evaluate(p,{},u)}}evaluate(e,i){const l=this.getNodesInfo();for(const u of l){if(!u.node.meshes)continue;const f=u.feature,p=i&&i[f.id];if(fo(p,u.state))continue;u.state=structuredClone(p);const v=u.node.meshes&&u.node.meshes[0].featureData,w=u.evaluatedColor[2],E=u.evaluatedRMEA[2],C=this.id.canonical;if(u.hasTranslucentParts=!1,v){for(let z=0;z<xI.length;z++){const L=xI[z];L.length&&(f.properties.part=L);const N=e.paint.get("model-color").evaluate(f,p,C).toPremultipliedRenderColor(null),U=e.paint.get("model-color-mix-intensity").evaluate(f,p,C);u.evaluatedColor[z]=[N.r,N.g,N.b,U],u.evaluatedRMEA[z][0]=e.paint.get("model-roughness").evaluate(f,p,C),u.evaluatedRMEA[z][2]=e.paint.get("model-emissive-strength").evaluate(f,p,C),u.evaluatedRMEA[z][3]=N.a,u.emissionHeightBasedParams[z]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,p,C),!u.hasTranslucentParts&&N.a<1&&(u.hasTranslucentParts=!0)}delete f.properties.part,ZO(u,w!==u.evaluatedColor[2]||E!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(f,p,C);u.evaluatedTranslation=e.paint.get("model-translation").evaluate(f,p,C),u.evaluatedScale=e.paint.get("model-scale").evaluate(f,p,C),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,l,u){const f=e.findDEMTileFor(l);if(f&&(f.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const p=Nf.create(e,l,f);if(!p)return;this.modelTraits&zf.HasMapboxMeshFeatures&&this.updateDEM(e,p,l,u);for(const v of this.getNodesInfo()){const w=v.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const E=w.footprint.vertices;let C=p.getElevationAt(E[0].x,E[0].y,!0,!0);for(let z=1;z<E.length;z++)C=Math.min(C,p.getElevationAt(E[z].x,E[z].y,!0,!0));w.elevation=C}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,l,u){let f=i._dem._modifiedForSources[u];if(f===void 0&&(i._dem._modifiedForSources[u]=[],f=i._dem._modifiedForSources[u]),f.includes(l.canonical))return;const p=i._dem.dim;f.push(l.canonical);let v=!1;for(const w of this.getNodesInfo()){const E=w.node;if(!E.footprint||!E.footprint.grid)continue;const C=E.footprint.grid,z=i.tileCoordToPixel(C.min.x,C.min.y),L=i.tileCoordToPixel(C.max.x,C.max.y),N=Math.min(Math.min(p-L.y,z.x),Math.min(z.y,p-L.x));if(N<0)continue;const U=Pe(N,2,5);let X=Math.max(0,z.x-U),J=Math.max(0,z.y-U),Q=Math.min(L.x+U,p-1),le=Math.min(L.y+U,p-1);for(let Oe=J;Oe<=le;++Oe)for(let Ve=X;Ve<=Q;++Ve)qh[Oe*p+Ve]=255;let he=0,ge=0;for(let Oe=0;Oe<C.cellsY;++Oe)for(let Ve=0;Ve<C.cellsX;++Ve){if(!C.cells[Oe*C.cellsX+Ve])continue;const We=i.tileCoordToPixel(C.min.x+Ve/C.xScale,C.min.y+Oe/C.yScale),He=i.tileCoordToPixel(C.min.x+(Ve+1)/C.xScale,C.min.y+(Oe+1)/C.yScale);for(let Tt=We.y;Tt<=Math.min(He.y+1,p-1);++Tt)for(let Ke=We.x;Ke<=Math.min(He.x+1,p-1);++Ke)qh[Tt*p+Ke]===255&&(qh[Tt*p+Ke]=0,he+=i.getElevationAtPixel(Ke,Tt),ge++)}const Le=he/ge;X=Math.max(1,z.x-U),J=Math.max(1,z.y-U),Q=Math.min(L.x+U,p-2),le=Math.min(L.y+U,p-2),v=!0;for(let Oe=J;Oe<=le;++Oe)for(let Ve=X;Ve<=Q;++Ve)qh[Oe*p+Ve]===0&&(ob[Oe*p+Ve]=i._dem.set(Ve,Oe,Le));for(let Oe=1;Oe<U;++Oe){X=Math.max(1,z.x-Oe),J=Math.max(1,z.y-Oe),Q=Math.min(L.x+Oe,p-2),le=Math.min(L.y+Oe,p-2);for(let Ve=J;Ve<=le;++Ve)for(let We=X;We<=Q;++We){const He=Ve*p+We;if(qh[He]===255){let Tt=0,Ke=0,Et=-1,Ft=-1;for(let It=-1;It<=1;++It)for(let Pt=-1;Pt<=1;++Pt){const Ut=(Ve+It)*p+We+Pt;if(qh[Ut]>=Oe)continue;const bt=ob[Ut],kt=Math.abs(bt);kt>Ke&&(Tt=bt,Ke=kt,Et=Pt,Ft=It)}if(Ke>.1){const It=1-(Oe+.5*Math.abs(Et*Ft))/U;let Pt=i._dem.get(We,Ve)+Tt*It;const Ut=i._dem.get(We+Et,Ve+Ft),bt=i._dem.get(We-Et,Ve-Ft,!0);(Pt-Ut)*(Pt-bt)>0&&(Pt=(Ut+bt)/2),ob[He]=i._dem.set(We,Ve,Pt),qh[He]=Oe}}}}}v&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Ca.now())}setFilter(e){this.filter=e?Ah(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new dr(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)qy(i.node),z1(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped());for(const u of this.getNodesInfo()){const f=u.node.footprint;u.hiddenByReplacement=!!f&&!l.find((p=>p.footprint===f))}}getHeightAtTileCoord(e,i){const l=[],u=[0,0,0],f=G([]);for(const p of this.getNodesInfo()){const v=p.node.meshes[0],w=v.transformedAabb;if(e<w.min[0]||i<w.min[1]||e>w.max[0]||i>w.max[1])continue;if(p.node.hidden===!0)return{height:1/0,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};K(f,p.node.matrix),u[0]=e,u[1]=i,Je(u,u,f);const E=(u[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*jh|0,C=Math.min(63,(u[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*jh|0)*jh+Math.min(63,E),z=v.heightmap[C];if(!(z<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:z,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new Mt(e,i),new Mt(e,i),l),l.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function mg(o,e){return o instanceof Sh&&!o.isLightConstant&&e}function HO(o,e,i,l,u,f,p,v){let w=(61440&e|(61440&e)>>4)>>8,E=(3840&e|(3840&e)>>4)>>4,C=240&e|(240&e)>>4;i[3]>0&&(w=Rn(w,255*i[0],i[3]),E=Rn(E,255*i[1],i[3]),C=Rn(C,255*i[2],i[3]));const z=w<<8|E,L=C<<8|Math.floor(255*l[3]),N=(function(Oe){const Ve=Pe(Oe,0,2);return Math.min(Math.round(.5*Ve*255),255)})(l[2])<<8|15*l[0]<<4|15*l[1],U=Pe(u[0],0,1),X=Pe(u[1],0,1),J=Pe(u[2],0,1),Q=Pe(u[3],0,1);let le,he,ge,Le;if(U!==X&&p!==f&&X!==U){const Oe=p-f;he=1/(Oe*(X-U)),ge=-(f+Oe*U)/(Oe*(X-U));const Ve=Pe(u[4],-1,1);Le=Math.pow(10,Ve),le=255*J<<8|255*Q}else le=65535,he=0,ge=1,Le=1;if(o.emplaceBack(z,L,N,le,he,ge,Le),v){const Oe=v.length;v.clear();for(let Ve=0;Ve<Oe;Ve++)v.emplaceBack(z,L,N,le,he,ge,Le)}}function ZO(o,e,i){const l=o.node;let u=0;const f=i&zf.HasMeshoptCompression;for(const p of l.meshes){if(l.lights&&l.lightMeshIndex===u||!p.featureData)continue;p.featureArray=new Cu,p.featureArray.reserve(p.featureData.length);let v=e;for(const w of p.featureData){const E=f?65535&w:w>>16&65535,C=f?w>>16&65535:65535&w,z=(15&C)<8?15&C:0,L=o.evaluatedRMEA[z],N=o.evaluatedColor[z],U=o.emissionHeightBasedParams[z];let X;if(v&&z===2&&l.lights&&(X=new Cu,X.resize(10*l.lights.length)),HO(p.featureArray,E,N,L,U,p.aabb.min[2],p.aabb.max[2],X),X&&v){v=!1;const J=l.meshes[l.lightMeshIndex];J.featureArray=X,J.featureArray._trim()}}p.featureArray._trim(),u++}}function wI(o,e,i,l){const u=1<<o.z;e.lat=Me((l/Yt+o.y)/u),e.lng=ke((i/Yt+o.x)/u)}function XO(o,e,i,l){const u=o.getNodesInfo()[e];if(!u||u.hiddenByReplacement||!u.node.meshes)return;let f=Number.MAX_VALUE;const p=u.node,v=i.tile,w=l.calculatePosMatrix(v.tileID.toUnwrapped(),l.worldSize),E=u.evaluatedScale;let C=0;l.elevation&&p.elevation&&(C=p.elevation*l.elevation.exaggeration()),ne(w,w,[(p.anchor?p.anchor[0]:0)*(E[0]-1),(p.anchor?p.anchor[1]:0)*(E[1]-1),C]),oe(w,w,E);const z=i.queryGeometry,L=z.isPointQuery()?z.screenBounds:z.screenGeometry,N=function(X){const J=Y([],w,X.matrix);Y(J,l.expandedFarZProjMatrix,J);for(let Q=0;Q<X.meshes.length;++Q){const le=X.meshes[Q];if(Q===X.lightMeshIndex)continue;const he=UE(L,l,J,le.aabb);he!=null&&(f=Math.min(he,f))}if(X.children)for(const Q of X.children)N(Q)};if(N(p),f===Number.MAX_VALUE)return;const U=new Z(0,0);return wI(v.tileID.canonical,U,u.node.anchor[0],u.node.anchor[1]),{intersectionZ:f,position:U,feature:u.feature}}ln(hv,"Tiled3dModelBucket",{omit:["layers"]}),ln(bI,"Tiled3dModelFeature");const YO={circle:class extends ss{constructor(o,e,i,l){super(o,{layout:ku||(ku=new Ur({"circle-sort-key":new tn(Ye.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Wt(Ye.layout_circle["circle-elevation-reference"]),visibility:new Wt(Ye.layout_circle.visibility)})),paint:il||(il=new Ur({"circle-radius":new tn(Ye.paint_circle["circle-radius"]),"circle-color":new tn(Ye.paint_circle["circle-color"]),"circle-blur":new tn(Ye.paint_circle["circle-blur"]),"circle-opacity":new tn(Ye.paint_circle["circle-opacity"]),"circle-translate":new Wt(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Wt(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Wt(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Wt(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new tn(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new tn(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new tn(Ye.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Wt(Ye.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}createBucket(o){return new Bo(o)}queryRadius(o){const e=o;return Sa("circle-radius",this,e)+Sa("circle-stroke-width",this,e)+Wl(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,i,l,u,f,p,v){const w=Fa(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return MS(o,l,f,p,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,i){const l=IS(this);return{config:new kc(this,{zoom:e,lut:i}),defines:l,overrideFog:!1}}is3D(o){return!o&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends ss{createBucket(o){return new PS(o)}constructor(o,e,i,l){super(o,{layout:kS||(kS=new Ur({visibility:new Wt(Ye.layout_heatmap.visibility)})),paint:RS||(RS=new Ur({"heatmap-radius":new tn(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new tn(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Wt(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bu(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Wt(Ye.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Vm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(o){return Sa("heatmap-radius",this,o)}queryIntersectsFeature(o,e,i,l,u,f,p,v){const w=this.paint.get("heatmap-radius").evaluate(e,i);return MS(o,l,f,p,v,!0,!0,new Mt(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,i){return o==="heatmap"?{config:new kc(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends ss{constructor(o,e,i,l){super(o,{layout:zS||(zS=new Ur({visibility:new Wt(Ye.layout_hillshade.visibility)})),paint:DS||(DS=new Ur({"hillshade-illumination-direction":new Wt(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Wt(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Wt(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Wt(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Wt(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Wt(Ye.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Wt(Ye.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,i){return{overrideFog:!1}}},fill:class extends ss{constructor(o,e,i,l){super(o,{layout:YS||(YS=new Ur({"fill-sort-key":new tn(Ye.layout_fill["fill-sort-key"]),visibility:new Wt(Ye.layout_fill.visibility),"fill-elevation-reference":new Wt(Ye.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new tn(Ye.layout_fill["fill-construct-bridge-guard-rail"])})),paint:KS||(KS=new Ur({"fill-antialias":new Wt(Ye.paint_fill["fill-antialias"]),"fill-opacity":new tn(Ye.paint_fill["fill-opacity"]),"fill-color":new tn(Ye.paint_fill["fill-color"]),"fill-outline-color":new tn(Ye.paint_fill["fill-outline-color"]),"fill-translate":new Wt(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Wt(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new tn(Ye.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Wt(Ye.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Wt(Ye.paint_fill["fill-emissive-strength"]),"fill-z-offset":new tn(Ye.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new tn(Ye.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new tn(Ye.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(o,e,i){return{config:new kc(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new p1(o)}queryRadius(){return Wl(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,i,l,u,f){return!o.queryGeometry.isAboveHorizon&&Ms(ql(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?e&&!o:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends ss{constructor(o,e,i,l){super(o,{layout:vE||(vE=new Ur({visibility:new Wt(Ye["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Wt(Ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:xE||(xE=new Ur({"fill-extrusion-opacity":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new tn(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new tn(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new tn(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new tn(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new tn(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new tn(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new tn(Ye["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new tn(Ye["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new Fy(o)}queryRadius(){return Wl(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,i,l,u,f,p,v,w){const E=Fa(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(e,i),z=this.paint.get("fill-extrusion-base").evaluate(e,i),L=[0,0],N=v&&f.elevation,U=f.elevation?f.elevation.exaggeration():1,X=o.tile.getBucket(this);if(N&&X instanceof Fy){const ge=X.centroidVertexArray,Le=w+1;Le<ge.length&&(L[0]=ge.geta_centroid_pos0(Le),L[1]=ge.geta_centroid_pos1(Le))}if(L[0]===0&&L[1]===1)return!1;f.projection.name==="globe"&&(l=yE([l],[new Mt(0,0),new Mt(Yt,Yt)],o.tileID.canonical).map((ge=>ge.polygon)).flat());const J=N?v:null,[Q,le]=(function(ge,Le,Oe,Ve,We,He,Tt,Ke,Et,Ft,It){return ge.projection.name==="globe"?(function(Pt,Ut,bt,kt,dt,lt,jt,Nt,wn,sn,pn){const Xt=[],xn=[],Zn=Pt.projection.upVectorScale(pn,Pt.center.lat,Pt.worldSize).metersToTile,en=[0,0,0,1],_n=[0,0,0,1],zn=(di,ni,hn,ei)=>{di[0]=ni,di[1]=hn,di[2]=ei,di[3]=1},$n=_E();bt>0&&(bt+=$n),kt+=$n;for(const di of Ut){const ni=[],hn=[];for(const ei of di){const Ti=ei.x+dt.x,ve=ei.y+dt.y,be=Pt.projection.projectTilePoint(Ti,ve,pn),ht=Pt.projection.upVector(pn,ei.x,ei.y);let wt=bt,$t=kt;if(jt){const Qt=AE(Ti,ve,bt,kt,jt,Nt,wn,sn);wt+=Qt.base,$t+=Qt.top}bt!==0?zn(en,be.x+ht[0]*Zn*wt,be.y+ht[1]*Zn*wt,be.z+ht[2]*Zn*wt):zn(en,be.x,be.y,be.z),zn(_n,be.x+ht[0]*Zn*$t,be.y+ht[1]*Zn*$t,be.z+ht[2]*Zn*$t),Je(en,en,lt),Je(_n,_n,lt),ni.push(new Vh(en[0],en[1],en[2])),hn.push(new Vh(_n[0],_n[1],_n[2]))}Xt.push(ni),xn.push(hn)}return[Xt,xn]})(ge,Le,Oe,Ve,We,He,Tt,Ke,Et,Ft,It):Tt?(function(Pt,Ut,bt,kt,dt,lt,jt,Nt,wn){const sn=[],pn=[],Xt=[0,0,0,1];for(const xn of Pt){const Zn=[],en=[];for(const _n of xn){const zn=_n.x+kt.x,$n=_n.y+kt.y,di=AE(zn,$n,Ut,bt,lt,jt,Nt,wn);Xt[0]=zn,Xt[1]=$n,Xt[2]=di.base,Xt[3]=1,ti(Xt,Xt,dt),Xt[3]=Math.max(Xt[3],1e-5);const ni=new Vh(Xt[0]/Xt[3],Xt[1]/Xt[3],Xt[2]/Xt[3]);Xt[0]=zn,Xt[1]=$n,Xt[2]=di.top,Xt[3]=1,ti(Xt,Xt,dt),Xt[3]=Math.max(Xt[3],1e-5);const hn=new Vh(Xt[0]/Xt[3],Xt[1]/Xt[3],Xt[2]/Xt[3]);Zn.push(ni),en.push(hn)}sn.push(Zn),pn.push(en)}return[sn,pn]})(Le,Oe,Ve,We,He,Tt,Ke,Et,Ft):(function(Pt,Ut,bt,kt,dt){const lt=[],jt=[],Nt=dt[8]*Ut,wn=dt[9]*Ut,sn=dt[10]*Ut,pn=dt[11]*Ut,Xt=dt[8]*bt,xn=dt[9]*bt,Zn=dt[10]*bt,en=dt[11]*bt;for(const _n of Pt){const zn=[],$n=[];for(const di of _n){const ni=di.x+kt.x,hn=di.y+kt.y,ei=dt[0]*ni+dt[4]*hn+dt[12],Ti=dt[1]*ni+dt[5]*hn+dt[13],ve=dt[2]*ni+dt[6]*hn+dt[14],be=dt[3]*ni+dt[7]*hn+dt[15],ht=ei+Nt,wt=Ti+wn,$t=ve+sn,Qt=Math.max(be+pn,1e-5),un=ei+Xt,Sn=Ti+xn,fi=ve+Zn,pi=Math.max(be+en,1e-5);zn.push(new Vh(ht/Qt,wt/Qt,$t/Qt)),$n.push(new Vh(un/pi,Sn/pi,fi/pi))}lt.push(zn),jt.push($n)}return[lt,jt]})(Le,Oe,Ve,We,He)})(f,l,z,C,E,p,J,L,U,f.center.lat,o.tileID.canonical),he=o.queryGeometry;return(function(ge,Le,Oe){let Ve=1/0;Ms(Oe,Le)&&(Ve=EE(Oe,Le[0]));for(let We=0;We<Le.length;We++){const He=Le[We],Tt=ge[We];for(let Ke=0;Ke<He.length-1;Ke++){const Et=He[Ke],Ft=[Et,He[Ke+1],Tt[Ke+1],Tt[Ke],Et];qs(Oe,Ft)&&(Ve=Math.min(Ve,EE(Oe,Ft)))}}return Ve!==1/0&&Ve})(Q,le,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},building:class extends ss{constructor(o,e,i,l){super(o,{layout:JE||(JE=new Ur({visibility:new Wt(Ye.layout_building.visibility),"building-facade":new tn(Ye.layout_building["building-facade"]),"building-facade-floors":new tn(Ye.layout_building["building-facade-floors"]),"building-facade-unit-width":new tn(Ye.layout_building["building-facade-unit-width"]),"building-facade-window":new tn(Ye.layout_building["building-facade-window"]),"building-roof-shape":new tn(Ye.layout_building["building-roof-shape"]),"building-height":new tn(Ye.layout_building["building-height"]),"building-base":new tn(Ye.layout_building["building-base"]),"building-flood-light-wall-radius":new tn(Ye.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new tn(Ye.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new tn(Ye.layout_building["building-flip-roof-orientation"])})),paint:QE||(QE=new Ur({"building-opacity":new Wt(Ye.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Wt(Ye.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Wt(Ye.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Wt(Ye.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Wt(Ye.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Wt(Ye.paint_building["building-vertical-scale"]),"building-cast-shadows":new Wt(Ye.paint_building["building-cast-shadows"]),"building-color":new tn(Ye.paint_building["building-color"]),"building-emissive-strength":new tn(Ye.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Wt(Ye.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Wt(Ye.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Wt(Ye.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Wt(Ye.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Wt(Ye.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new KE(o)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(o){return!0}},line:class extends ss{constructor(o,e,i,l){const u=lA();super(o,u,e,i,l),u.layout&&(this.layout=new Ec(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof xh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(ig)return ig;const i=lA();return ig=new Z3(i.paint.properties["line-width"].specification),ig.useIntegerZoom=!0,ig})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new F1(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,i){const l=sA(this);return{config:new kc(this,{zoom:e,lut:i}),defines:l,overrideFog:!1}}queryRadius(o){const e=o,i=cA(Sa("line-width",this,e),Sa("line-gap-width",this,e)),l=Sa("line-offset",this,e);return i/2+Math.abs(l)+Wl(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,i,l,u,f){if(o.queryGeometry.isAboveHorizon)return!1;const p=ql(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),v=o.pixelToTileUnitsFactor/2*cA(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(l=(function(E,C){const z=[],L=new Mt(0,0);for(let N=0;N<E.length;N++){const U=E[N],X=[];for(let J=0;J<U.length;J++){const Q=U[J],le=U[J+1],he=J===0?L:Q.sub(U[J-1])._unit()._perp(),ge=J===U.length-1?L:le.sub(Q)._unit()._perp(),Le=he._add(ge)._unit();Le._mult(1/(Le.x*ge.x+Le.y*ge.y)),X.push(Le._mult(C)._add(Q))}z.push(X)}return z})(l,w*o.pixelToTileUnitsFactor)),(function(E,C,z){for(let L=0;L<C.length;L++){const N=C[L];if(E.length>=3){for(let U=0;U<N.length;U++)if(zo(E,N[U]))return!0}if(Cs(E,N,z))return!0}return!1})(p,l,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:av,background:class extends ss{constructor(o,e,i,l){super(o,{layout:eI||(eI=new Ur({visibility:new Wt(Ye.layout_background.visibility)})),paint:tI||(tI=new Ur({"background-pitch-alignment":new Wt(Ye.paint_background["background-pitch-alignment"]),"background-color":new Wt(Ye.paint_background["background-color"]),"background-pattern":new Wt(Ye.paint_background["background-pattern"]),"background-opacity":new Wt(Ye.paint_background["background-opacity"]),"background-emissive-strength":new Wt(Ye.paint_background["background-emissive-strength"]),"background-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,i){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:sI,"raster-particle":dI,sky:class extends ss{constructor(o,e,i,l){super(o,{layout:cI||(cI=new Ur({visibility:new Wt(Ye.layout_sky.visibility)})),paint:uI||(uI=new Ur({"sky-type":new Wt(Ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new Wt(Ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Wt(Ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Wt(Ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Wt(Ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new bu(Ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Wt(Ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Wt(Ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Wt(Ye.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Vm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),u=!l,f=o.style.light,p=f.properties.get("position");return u&&f.properties.get("anchor")==="viewport"&&oi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?nb(p.azimuthal,90-p.polar,e):nb(l[0],90-l[1],e)}const i=this.paint.get("sky-gradient-center");return nb(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends ss{constructor(o,e,i,l){super(o,{paint:hI||(hI=new Ur({}))},e,null)}},model:class extends ss{constructor(o,e,i,l){super(o,{layout:gI||(gI=new Ur({visibility:new Wt(Ye.layout_model.visibility),"model-id":new tn(Ye.layout_model["model-id"])})),paint:_I||(_I=new Ur({"model-opacity":new tn(Ye.paint_model["model-opacity"]),"model-rotation":new tn(Ye.paint_model["model-rotation"]),"model-scale":new tn(Ye.paint_model["model-scale"]),"model-translation":new tn(Ye.paint_model["model-translation"]),"model-color":new tn(Ye.paint_model["model-color"]),"model-color-mix-intensity":new tn(Ye.paint_model["model-color-mix-intensity"]),"model-type":new Wt(Ye.paint_model["model-type"]),"model-cast-shadows":new Wt(Ye.paint_model["model-cast-shadows"]),"model-receive-shadows":new Wt(Ye.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Wt(Ye.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new tn(Ye.paint_model["model-emissive-strength"]),"model-roughness":new tn(Ye.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new tn(Ye.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Wt(Ye.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Wt(Ye.paint_model["model-front-cutoff"]),"model-elevation-reference":new Wt(Ye.paint_model["model-elevation-reference"]),"model-color-use-theme":new tn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new rb(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof hv?Yt-1:0}queryIntersectsFeature(o,e,i,l,u,f){if(!this.modelManager)return!1;const p=this.modelManager,v=o.tile.getBucket(this);if(!(v&&v instanceof rb))return!1;for(const w in v.instancesPerModel){const E=v.instancesPerModel[w],C=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(C)){const z=E.features[E.idToFeaturesIndex[C]],L=p.getModel(w,this.scope);if(!L)return!1;let N=W();const U=new Z(0,0),X=v.canonical;let J=Number.MAX_VALUE;for(let Q=0;Q<z.instancedDataCount;++Q){const le=16*(z.instancedDataOffset+Q),he=E.instancedDataArray.float32,ge=[he[le+4],he[le+5],he[le+6]];wI(X,U,he[le],0|he[le+1]),jE(N,L,f,U,z.rotation,z.scale,ge,!1,!1,!1),f.projection.name==="globe"&&(N=k1(N,f));const Le=Y([],f.projMatrix,N),Oe=o.queryGeometry,Ve=UE(Oe.isPointQuery()?Oe.screenBounds:Oe.screenGeometry,f,Le,L.aabb);Ve!=null&&(J=Math.min(Ve,J))}return J!==Number.MAX_VALUE&&J}}return!1}_handleOverridablePaintPropertyUpdate(o,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ll}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ss{constructor(o,e,i,l){super(o,{layout:JS||(JS=new Ur({"clip-layer-types":new Wt(Ye.layout_clip["clip-layer-types"]),"clip-layer-scope":new Wt(Ye.layout_clip["clip-layer-scope"])})),paint:QS||(QS=new Ur({}))},e,i,l)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new $S(o)}is3D(o){return!0}}},sb=new Hi(0,0,0),ab={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},lb={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},dv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},KO={PAINT_ORDER_FILL_AND_STROKE:1},gg={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},TI={MASK_TYPE_LUMINANCE:1};function JO(o,e,i){o===1&&e.icons.push((function(l,u){return(function(f){if(f.usvg_tree.height||(f.usvg_tree.height=f.usvg_tree.width),!f.metadata)return f;const{metadata:p}=f;if(p.content_area){const{content_area:v}=p;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=f.usvg_tree.width),v.height==null&&(v.height=v.width)}if(p.text_placeholder){const{text_placeholder:v}=p;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return p.stretch_x&&p.stretch_x.length&&SI(p,"x"),p.stretch_y&&p.stretch_y.length&&SI(p,"y"),f})(l.readFields(QO,{name:void 0},u))})(i,i.readVarint()+i.pos))}function SI(o,e){const i=[],l=o[`stretch_${e}`];let u=null;for(let f=0;f<l.length;f++)u===null?u=i.length===0?l[0]:i[i.length-1][1]+l[f]:(i.push([u,u+l[f]]),u=null);o[`stretch_${e}_areas`]=i}function QO(o,e,i){o===1?e.name=i.readString():o===2?e.metadata=(function(l,u){return l.readFields($O,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)})(i,i.readVarint()+i.pos):o===3&&(e.usvg_tree=(function(l,u){return l.readFields(nF,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function $O(o,e,i){o===1?e.stretch_x=i.readPackedVarint():o===2?e.stretch_y=i.readPackedVarint():o===3?e.content_area=EI(i,i.readVarint()+i.pos):o===4?e.variables.push((function(l,u){return l.readFields(tF,{name:void 0},u)})(i,i.readVarint()+i.pos)):o===5&&(e.text_placeholder=EI(i,i.readVarint()+i.pos))}function EI(o,e){return o.readFields(eF,{},e)}function eF(o,e,i){o===1?e.left=i.readVarint():o===2?e.width=i.readVarint():o===3?e.top=i.readVarint():o===4&&(e.height=i.readVarint())}function tF(o,e,i){o===1?e.name=i.readString():o===2&&(e.rgb_color=mv(i.readVarint()),e.value="rgb_color")}function nF(o,e,i){o===1?e.width=e.height=i.readVarint():o===2?e.height=i.readVarint():o===3?e.children.push(fv(i,i.readVarint()+i.pos)):o===4?e.linear_gradients.push((function(l,u){return l.readFields(cF,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)})(i,i.readVarint()+i.pos)):o===5?e.radial_gradients.push((function(l,u){return l.readFields(hF,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)})(i,i.readVarint()+i.pos)):o===7?e.clip_paths.push((function(l,u){return l.readFields(dF,{children:[]},u)})(i,i.readVarint()+i.pos)):o===8&&e.masks.push((function(l,u){const f=l.readFields(fF,{left:0,width:20,mask_type:TI.MASK_TYPE_LUMINANCE,children:[]},u);return f.height==null&&(f.height=f.width),f.top==null&&(f.top=f.left),f})(i,i.readVarint()+i.pos))}function fv(o,e){return o.readFields(iF,{},e)}function iF(o,e,i){o===1?(e.group=(function(l,u){return l.readFields(rF,{opacity:255,children:[]},u)})(i,i.readVarint()+i.pos),e.node="group"):o===2&&(e.path=(function(l,u){return l.readFields(sF,{paint_order:1,commands:[],step:1,diffs:[],rule:ab.PATH_RULE_NON_ZERO},u)})(i,i.readVarint()+i.pos),e.node="path")}function rF(o,e,i){o===1?e.transform=pv(i,i.readVarint()+i.pos):o===2?e.opacity=i.readVarint():o===5?e.clip_path_idx=i.readVarint():o===6?e.mask_idx=i.readVarint():o===7&&e.children.push(fv(i,i.readVarint()+i.pos))}function pv(o,e){return o.readFields(oF,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function oF(o,e,i){o===1?e.sx=i.readFloat():o===2?e.ky=i.readFloat():o===3?e.kx=i.readFloat():o===4?e.sy=i.readFloat():o===5?e.tx=i.readFloat():o===6&&(e.ty=i.readFloat())}function sF(o,e,i){o===1?e.fill=(function(l,u){return l.readFields(aF,{rgb_color:sb,paint:"rgb_color",opacity:255},u)})(i,i.readVarint()+i.pos):o===2?e.stroke=(function(l,u){return l.readFields(lF,{rgb_color:sb,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)})(i,i.readVarint()+i.pos):o===3?e.paint_order=i.readVarint():o===5?i.readPackedVarint(e.commands):o===6?e.step=i.readFloat():o===7?i.readPackedSVarint(e.diffs):o===8&&(e.rule=i.readVarint())}function aF(o,e,i){o===1?(e.rgb_color=mv(i.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=i.readVarint())}function mv(o){return new Hi((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function lF(o,e,i){o===1?(e.rgb_color=mv(i.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):o===5?i.readPackedFloat(e.dasharray):o===6?e.dashoffset=i.readFloat():o===7?e.miterlimit=i.readFloat():o===8?e.opacity=i.readVarint():o===9?e.width=i.readFloat():o===10?e.linecap=i.readVarint():o===11&&(e.linejoin=i.readVarint())}function cF(o,e,i){o===1?e.transform=pv(i,i.readVarint()+i.pos):o===2?e.spread_method=i.readVarint():o===3?e.stops.push(AI(i,i.readVarint()+i.pos)):o===4?e.x1=i.readFloat():o===5?e.y1=i.readFloat():o===6?e.x2=i.readFloat():o===7&&(e.y2=i.readFloat())}function AI(o,e){return o.readFields(uF,{offset:0,opacity:255,rgb_color:sb},e)}function uF(o,e,i){o===1?e.offset=i.readFloat():o===2?e.opacity=i.readVarint():o===3&&(e.rgb_color=mv(i.readVarint()))}function hF(o,e,i){o===1?e.transform=pv(i,i.readVarint()+i.pos):o===2?e.spread_method=i.readVarint():o===3?e.stops.push(AI(i,i.readVarint()+i.pos)):o===4?e.cx=i.readFloat():o===5?e.cy=i.readFloat():o===6?e.r=i.readFloat():o===7?e.fx=i.readFloat():o===8?e.fy=i.readFloat():o===9&&(e.fr=i.readFloat())}function dF(o,e,i){o===1?e.transform=pv(i,i.readVarint()+i.pos):o===2?e.clip_path_idx=i.readVarint():o===3&&e.children.push(fv(i,i.readVarint()+i.pos))}function fF(o,e,i){o===1?e.left=e.top=i.readFloat():o===2?e.width=e.height=i.readFloat():o===3?e.top=i.readFloat():o===4?e.height=i.readFloat():o===5?e.mask_type=i.readVarint():o===6?e.mask_idx=i.readVarint():o===7&&e.children.push(fv(i,i.readVarint()+i.pos))}class pF{static calculate(e={},i=[]){const l=new Map,u=new Map;if(Object.keys(e).length===0)return l;i.forEach((f=>{u.set(f.name,f.rgb_color||new Hi(0,0,0))}));for(const[f,p]of Object.entries(e))u.has(f)?l.set(u.get(f).toString(),p):console.warn(`Ignoring unknown image variable "${f}"`);return l}}function Vf(o,e=255,i){const l=e/255,u=o.toString(),f=i.has(u)?i.get(u).clone():o.clone();return f.a*=l,f.toString()}function _g(o,e){if(!Cp()){const i=document.createElement("canvas");return i.width=o,i.height=e,i}return new OffscreenCanvas(o,e)}function mF(o,e){const i=pF.calculate(e.params,o.metadata?o.metadata.variables:[]),l=o.usvg_tree,u=l.width,f=l.height,p=e.transform?e.transform:new DOMMatrix,v=Math.max(1,Math.round(u*p.a)),w=Math.max(1,Math.round(f*p.d)),E=new DOMMatrix([v/u,0,0,w/f,0,0]),C=_g(v,w).getContext("2d");return cb(C,E,l,l,i),C.getImageData(0,0,v,w)}function cb(o,e,i,l,u){for(const f of l.children)II(o,e,i,f,u)}function II(o,e,i,l,u){l.group?(o.save(),(function(f,p,v,w,E){const C=w.mask_idx!=null?v.masks[w.mask_idx]:null,z=w.clip_path_idx!=null?v.clip_paths[w.clip_path_idx]:null;if(w.transform&&(p=Uf(w.transform).preMultiplySelf(p)),!(function(U,X,J){return U.opacity!==255||X||J})(w,z!=null,C!=null))return void cb(f,p,v,w,E);const L=_g(f.canvas.width,f.canvas.height),N=L.getContext("2d");cb(N,p,v,w,E),z&&DI(N,p,v,z),C&&LI(N,p,v,C,E),f.globalAlpha=w.opacity/255,f.drawImage(L,0,0)})(o,e,i,l.group,u),o.restore()):l.path&&(o.save(),(function(f,p,v,w,E){f.setTransform(p),w.paint_order===KO.PAINT_ORDER_FILL_AND_STROKE?(MI(f,v,w,E),PI(f,v,w,E)):(PI(f,v,w,E),MI(f,v,w,E))})(o,e,i,l.path,u),o.restore())}function MI(o,e,i,l){const u=i.fill;if(!u)return;const f=u.opacity/255;switch(o.save(),o.beginPath(),OI(i,o),u.paint){case"rgb_color":o.fillStyle=Vf(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":{const p=e.linear_gradients[u.linear_gradient_idx];p.transform&&o.setTransform(Uf(p.transform).preMultiplySelf(o.getTransform())),o.fillStyle=kI(o,p,f,l);break}case"radial_gradient_idx":{const p=e.radial_gradients[u.radial_gradient_idx];p.transform&&o.setTransform(Uf(p.transform).preMultiplySelf(o.getTransform())),o.fillStyle=RI(o,p,f,l)}}o.fill(CI(i)),o.restore()}function CI(o){return o.rule===ab.PATH_RULE_NON_ZERO?"nonzero":o.rule===ab.PATH_RULE_EVEN_ODD?"evenodd":void 0}function PI(o,e,i,l){const u=i.stroke;if(!u)return;const f=FI(i);o.lineWidth=u.width,o.miterLimit=u.miterlimit,o.setLineDash(u.dasharray),o.lineDashOffset=u.dashoffset;const p=u.opacity/255;switch(u.paint){case"rgb_color":o.strokeStyle=Vf(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":o.strokeStyle=kI(o,e.linear_gradients[u.linear_gradient_idx],p,l,!0);break;case"radial_gradient_idx":o.strokeStyle=RI(o,e.radial_gradients[u.radial_gradient_idx],p,l,!0)}switch(u.linejoin){case dv.LINE_JOIN_MITER_CLIP:case dv.LINE_JOIN_MITER:o.lineJoin="miter";break;case dv.LINE_JOIN_ROUND:o.lineJoin="round";break;case dv.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(u.linecap){case lb.LINE_CAP_BUTT:o.lineCap="butt";break;case lb.LINE_CAP_ROUND:o.lineCap="round";break;case lb.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(f)}function kI(o,e,i,l,u=!1){if(e.stops.length===1){const L=e.stops[0];return Vf(L.rgb_color,L.opacity*i,l)}const{x1:f,y1:p,x2:v,y2:w}=e;let E=new DOMPoint(f,p),C=new DOMPoint(v,w);if(u){const L=Uf(e.transform);E=L.transformPoint(E),C=L.transformPoint(C)}const z=o.createLinearGradient(E.x,E.y,C.x,C.y);for(const L of e.stops)z.addColorStop(L.offset,Vf(L.rgb_color,L.opacity*i,l));return z}function RI(o,e,i,l,u=!1){if(e.stops.length===1){const Q=e.stops[0];return Vf(Q.rgb_color,Q.opacity*i,l)}const f=Uf(e.transform),{fx:p,fy:v,fr:w,cx:E,cy:C,r:z}=e;let L=new DOMPoint(p,v),N=new DOMPoint(E,C),U=w,X=z;if(u){L=f.transformPoint(L),N=f.transformPoint(N);const Q=(f.a+f.d)/2;U=w*Q,X=e.r*Q}const J=o.createRadialGradient(L.x,L.y,U,N.x,N.y,X);for(const Q of e.stops)J.addColorStop(Q.offset,Vf(Q.rgb_color,Q.opacity*i,l));return J}function zI(o,e,i,l){const u=l.transform?Uf(l.transform).preMultiplySelf(e):e,f=_g(o.canvas.width,o.canvas.height),p=f.getContext("2d");for(const w of l.children)if(w.group)zI(p,u,i,w.group);else if(w.path){const E=w.path,C=new Path2D;C.addPath(FI(E),u),p.fill(C,CI(E))}const v=l.clip_path_idx!=null?i.clip_paths[l.clip_path_idx]:null;v&&DI(p,u,i,v),o.globalCompositeOperation="source-over",o.drawImage(f,0,0)}function DI(o,e,i,l){const u=_g(o.canvas.width,o.canvas.height);zI(u.getContext("2d"),e,i,l),o.globalCompositeOperation="destination-in",o.drawImage(u,0,0)}function LI(o,e,i,l,u){if(l.children.length===0)return;const f=l.mask_idx!=null?i.masks[l.mask_idx]:null;f&&LI(o,e,i,f,u);const p=o.canvas.width,v=o.canvas.height,w=_g(p,v),E=w.getContext("2d"),C=l.width,z=l.height,L=l.left,N=l.top,U=new Path2D,X=new Path2D;X.rect(L,N,C,z),U.addPath(X,e),E.clip(U);for(const le of l.children)II(E,e,i,le,u);const J=E.getImageData(0,0,p,v),Q=J.data;if(l.mask_type===TI.MASK_TYPE_LUMINANCE)for(let le=0;le<Q.length;le+=4)Q[le+3]=Q[le+3]/255*(.2126*Q[le]+.7152*Q[le+1]+.0722*Q[le+2]);E.putImageData(J,0,0),o.globalCompositeOperation="destination-in",o.drawImage(w,0,0)}function Uf(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function OI(o,e){const i=o.step;let l=o.diffs[0]*i,u=o.diffs[1]*i;e.moveTo(l,u);for(let f=0,p=2;f<o.commands.length;f++)switch(o.commands[f]){case gg.PATH_COMMAND_MOVE:l+=o.diffs[p++]*i,u+=o.diffs[p++]*i,e.moveTo(l,u);break;case gg.PATH_COMMAND_LINE:l+=o.diffs[p++]*i,u+=o.diffs[p++]*i,e.lineTo(l,u);break;case gg.PATH_COMMAND_QUAD:{const v=l+o.diffs[p++]*i,w=u+o.diffs[p++]*i;l=v+o.diffs[p++]*i,u=w+o.diffs[p++]*i,e.quadraticCurveTo(v,w,l,u);break}case gg.PATH_COMMAND_CUBIC:{const v=l+o.diffs[p++]*i,w=u+o.diffs[p++]*i,E=v+o.diffs[p++]*i,C=w+o.diffs[p++]*i;l=E+o.diffs[p++]*i,u=C+o.diffs[p++]*i,e.bezierCurveTo(v,w,E,C,l,u);break}case gg.PATH_COMMAND_CLOSE:e.closePath()}return e}function FI(o){return OI(o,new Path2D)}class gv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}ln(gv,"LRUCache");class ub{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Jo(e,e.data)}getFromCache(e,i,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new gv(150)),this.cacheMap.get(l).get(Tu(e.toString(),i))}setInCache(e,i,l,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new gv(150));const f=this.cacheDependenciesMap.get(u),p=Tu(e.id.toString(),l);f.get(p)||f.set(p,new Set);const v=this.cacheMap.get(u),w=e.toString();f.get(p).add(w),v.put(Tu(e.toString(),l),i)}removeImagesFromCacheByIds(e,i,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const u=this.cacheMap.get(l),f=this.cacheDependenciesMap.get(l);for(const p of e){const v=Tu(p.toString(),i);if(f.has(v)){for(const w of f.get(v))u.delete(w);f.delete(v)}}}rasterize(e,i,l,u,f=mF){const p=this.getFromCache(e,l,u);if(p)return p.clone();const v=f(i.icon,e.options),w=ub._getImage(v);return this.setInCache(e,w,l,u),w.clone()}}class BI{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const l=this.toIdx(e,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function NI(o,e,i,l){let u=0,f=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(l[p])<1e-15){if(i[p]<o[p]||i[p]>e[p])return null}else{const v=1/l[p];let w=(o[p]-i[p])*v,E=(e[p]-i[p])*v;if(w>E){const C=w;w=E,E=C}if(w>u&&(u=w),E<f&&(f=E),u>f)return null}return u}function VI(o,e,i,l,u,f,p,v,w,E,C){const z=l-o,L=u-e,N=f-i,U=p-o,X=v-e,J=w-i,Q=C[1]*J-C[2]*X,le=C[2]*U-C[0]*J,he=C[0]*X-C[1]*U,ge=z*Q+L*le+N*he;if(Math.abs(ge)<1e-15)return null;const Le=1/ge,Oe=E[0]-o,Ve=E[1]-e,We=E[2]-i,He=(Oe*Q+Ve*le+We*he)*Le;if(He<0||He>1)return null;const Tt=Ve*N-We*L,Ke=We*z-Oe*N,Et=Oe*L-Ve*z,Ft=(C[0]*Tt+C[1]*Ke+C[2]*Et)*Le;return Ft<0||He+Ft>1?null:(U*Tt+X*Ke+J*Et)*Le}function UI(o,e,i){return(o-e)/(i-e)}function jI(o,e,i,l,u,f,p,v,w){const E=1<<i,C=f-l,z=p-u,L=(o+1)/E*C+l,N=(e+0)/E*z+u,U=(e+1)/E*z+u;v[0]=(o+0)/E*C+l,v[1]=N,w[0]=L,w[1]=U}class GI{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(f){const p=Math.ceil(Math.log2(f.dim/8)),v=[];let w=Math.ceil(Math.pow(2,p));const E=1/w,C=(N,U,X,J,Q)=>{const le=J?1:0,he=(N+1)*X-le,ge=U*X,Le=(U+1)*X-le;Q[0]=N*X,Q[1]=ge,Q[2]=he,Q[3]=Le};let z=new BI(w);const L=[];for(let N=0;N<w*w;N++){C(N%w,Math.floor(N/w),E,!1,L);const U=Nu(L[0],L[1],f),X=Nu(L[2],L[1],f),J=Nu(L[2],L[3],f),Q=Nu(L[0],L[3],f);z.minimums.push(Math.min(U,X,J,Q)),z.maximums.push(Math.max(U,X,J,Q)),z.leaves.push(1)}for(v.push(z),w/=2;w>=1;w/=2){const N=v[v.length-1];z=new BI(w);for(let U=0;U<w*w;U++){C(U%w,Math.floor(U/w),2,!0,L);const X=N.getElevation(L[0],L[1]),J=N.getElevation(L[2],L[1]),Q=N.getElevation(L[2],L[3]),le=N.getElevation(L[0],L[3]),he=N.isLeaf(L[0],L[1]),ge=N.isLeaf(L[2],L[1]),Le=N.isLeaf(L[2],L[3]),Oe=N.isLeaf(L[0],L[3]),Ve=Math.min(X.min,J.min,Q.min,le.min),We=Math.max(X.max,J.max,Q.max,le.max),He=he&&ge&&Le&&Oe;z.maximums.push(We),z.minimums.push(Ve),z.leaves.push(We-Ve<=5&&He?1:0)}v.push(z)}return v})(this.dem),l=i.length-1,u=i[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(e,i,l,u,f,p,v=1){return NI([e,i,-100],[l,u,this.maximums[0]*v],f,p)}raycast(e,i,l,u,f,p,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,l,u,f,p,v);if(w==null)return null;const E=[],C=[],z=[],L=[],N=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:U,t:X,nodex:J,nodey:Q,depth:le}=N.pop();if(this.leaves[U]){jI(J,Q,le,e,i,l,u,z,L);const ge=1<<le,Le=(J+0)/ge,Oe=(J+1)/ge,Ve=(Q+0)/ge,We=(Q+1)/ge,He=Nu(Le,Ve,this.dem)*v,Tt=Nu(Oe,Ve,this.dem)*v,Ke=Nu(Oe,We,this.dem)*v,Et=Nu(Le,We,this.dem)*v,Ft=VI(z[0],z[1],He,L[0],z[1],Tt,L[0],L[1],Ke,f,p),It=VI(L[0],L[1],Ke,z[0],L[1],Et,z[0],z[1],He,f,p),Pt=Math.min(Ft!==null?Ft:Number.MAX_VALUE,It!==null?It:Number.MAX_VALUE);if(Pt!==Number.MAX_VALUE)return Pt;{const Ut=Kt([],f,p,X);if(WI(He,Tt,Et,Ke,UI(Ut[0],z[0],L[0]),UI(Ut[1],z[1],L[1]))>=Ut[2])return X}continue}let he=0;for(let ge=0;ge<this._siblingOffset.length;ge++){jI((J<<1)+this._siblingOffset[ge][0],(Q<<1)+this._siblingOffset[ge][1],le+1,e,i,l,u,z,L),z[2]=-100,L[2]=this.maximums[this.childOffsets[U]+ge]*v;const Le=NI(z,L,f,p);if(Le!=null){const Oe=Le;E[ge]=Oe;let Ve=!1;for(let We=0;We<he&&!Ve;We++)Oe>=E[C[We]]&&(C.splice(We,0,ge),Ve=!0);Ve||(C[he]=ge),he++}}for(let ge=0;ge<he;ge++){const Le=C[ge];N.push({idx:this.childOffsets[U]+Le,t:E[Le],nodex:(J<<1)+this._siblingOffset[Le][0],nodey:(Q<<1)+this._siblingOffset[Le][1],depth:le+1})}}return null}_addNode(e,i,l){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,l,u,f){if(e[u].isLeaf(i,l)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const p=u-1,v=e[p];let w=0,E=0;for(let C=0;C<this._siblingOffset.length;C++){const z=2*i+this._siblingOffset[C][0],L=2*l+this._siblingOffset[C][1],N=v.getElevation(z,L),U=v.isLeaf(z,L),X=this._addNode(N.min,N.max,U);U&&(w|=1<<C),E||(E=X)}for(let C=0;C<this._siblingOffset.length;C++)w&1<<C||this._construct(e,2*i+this._siblingOffset[C][0],2*l+this._siblingOffset[C][1],p,E+C)}}function WI(o,e,i,l,u,f){return Rn(Rn(o,i,f),Rn(e,l,f),u)}function Nu(o,e,i){const l=i.dim,u=Pe(o*l-.5,0,l-1),f=Pe(e*l-.5,0,l-1),p=Math.floor(u),v=Math.floor(f),w=Math.min(p+1,l-1),E=Math.min(v+1,l-1);return WI(i.get(p,v),i.get(w,v),i.get(p,E),i.get(w,E),u-p,f-v)}const gF={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function _F(o,e,i){return(256*o*256+256*e+i)/10-1e4}function yF(o,e,i){return 256*o+e+i/256-32768}class _v{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,l,u=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void oi(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const f=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let w=0;w<f;w++)p[this._idx(-1,w)]=p[this._idx(0,w)],p[this._idx(f,w)]=p[this._idx(f-1,w)],p[this._idx(w,-1)]=p[this._idx(w,0)],p[this._idx(w,f)]=p[this._idx(w,f-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(f,-1)]=p[this._idx(f-1,0)],p[this._idx(-1,f)]=p[this._idx(0,f-1)],p[this._idx(f,f)]=p[this._idx(f-1,f-1)]}const v=l==="terrarium"?yF:_F;for(let w=0;w<p.length;++w){const E=4*w;this.floatView[w]=v(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=Ca.now()}_buildQuadTree(){this._tree=new GI(this)}get(e,i,l=!1){l&&(e=Pe(e,-1,this.dim),i=Pe(i,-1,this.dim));const u=this._idx(e,i);return this.floatView[u]}set(e,i,l){const u=this._idx(e,i),f=this.floatView[u];return this.floatView[u]=l,l-f}static getUnpackVector(e){return gF[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const l=[0,0,0,0],u=_v.getUnpackVector(i);let f=Math.floor((e+u[3])/u[2]);return l[2]=f%256,f=Math.floor(f/256),l[1]=f%256,f=Math.floor(f/256),l[0]=f,l}getPixels(){return new FS({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,p=l*this.dim,v=l*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(l){case-1:p=v-1;break;case 1:v=p+1}const w=-i*this.dim,E=-l*this.dim;for(let C=p;C<v;C++)for(let z=u;z<f;z++){const L=4*this._idx(z,C),N=4*this._idx(z+w,C+E);this.pixels[L+0]=e.pixels[N+0],this.pixels[L+1]=e.pixels[N+1],this.pixels[L+2]=e.pixels[N+2],this.pixels[L+3]=e.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function vF(o,e,i){o===1?e.headerLength=i.readFixed32():o===2?e.x=i.readVarint():o===3?e.y=i.readVarint():o===4?e.z=i.readVarint():o===5&&e.layers.push((function(l,u){return l.readFields(SF,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)})(i,i.readVarint()+i.pos))}function xF(o,e,i){o===1?(e.delta_filter=(function(l,u){return l.readFields(bF,{blockSize:0},u)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):o===2?(i.readVarint(),e.filter="zigzag_filter"):o===3?(i.readVarint(),e.filter="bitshuffle_filter"):o===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function bF(o,e,i){o===1&&(e.blockSize=i.readVarint())}function wF(o,e,i){o===1?(i.readVarint(),e.codec="gzip_data"):o===2?(i.readVarint(),e.codec="jpeg_image"):o===3?(i.readVarint(),e.codec="webp_image"):o===4&&(i.readVarint(),e.codec="png_image")}function TF(o,e,i){let l=0,u=0;o===1?e.firstByte=i.readFixed64():o===2?e.lastByte=i.readFixed64():o===3?e.filters.push((function(f,p){return f.readFields(xF,{},p)})(i,i.readVarint()+i.pos)):o===4?e.codec=(function(f,p){return f.readFields(wF,{},p)})(i,i.readVarint()+i.pos):o===5?u=i.readFloat():o===6?l=i.readFloat():o===7?e.bands.push(i.readString()):o===8?e.offset=i.readDouble():o===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=l)}function SF(o,e,i){o===1?e.version=i.readVarint():o===2?e.name=i.readString():o===3?e.units=i.readString():o===4?e.tileSize=i.readVarint():o===5?e.buffer=i.readVarint():o===6?e.pixelFormat=i.readVarint():o===7&&e.dataIndex.push((function(l,u){return l.readFields(TF,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)})(i,i.readVarint()+i.pos))}function EF(o,e,i){if(o===2)(function(l,u,f){l.readFields(AF,f,u)})(i,i.readVarint()+i.pos,e);else if(o===3)throw new Error("Not implemented")}function AF(o,e,i){if(o===1){let l=0;const u=i.readVarint()+i.pos;for(;i.pos<u;)e[l++]=i.readVarint()}}function IF(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let l=2;l>=1;l--){const u=l===1?1:0,f=l===2?1:0;for(let p=0;p<e[0];p++){const v=e[1]*p;for(let w=u;w<e[1];w++){const E=e[2]*(w+v);for(let C=f;C<e[2];C++){const z=e[3]*(C+E);for(let L=0;L<e[3];L++){const N=z+L;o[N]+=o[N-i]}}}}i*=e[l]}return o}function MF(o){for(let e=0,i=o.length;e<i;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function CF(o,e){switch(e){case"uint32":return o;case"uint16":for(let i=0;i<o.length;i+=2){const l=o[i],u=o[i+1];o[i]=(240&l)>>4|(61440&l)>>8|(240&u)<<4|61440&u,o[i+1]=15&l|(3840&l)>>4|(15&u)<<8|(3840&u)<<4}return o;case"uint8":for(let i=0;i<o.length;i+=4){const l=o[i],u=o[i+1],f=o[i+2],p=o[i+3];o[i+0]=(192&l)>>6|(192&u)>>4|(192&f)>>2|192&p,o[i+1]=(48&l)>>4|(48&u)>>2|48&f|(48&p)<<2,o[i+2]=(12&l)>>2|12&u|(12&f)<<2|(12&p)<<4,o[i+3]=3&l|(3&u)<<2|(3&f)<<4|(3&p)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}ln(_v,"DEMData"),ln(GI,"DemMinMaxQuadTree",{omit:["dem"]});var Ea=Uint8Array,yg=Uint16Array,PF=Int32Array,qI=new Ea([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),HI=new Ea([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),kF=new Ea([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ZI=function(o,e){for(var i=new yg(31),l=0;l<31;++l)i[l]=e+=1<<o[l-1];var u=new PF(i[30]);for(l=1;l<30;++l)for(var f=i[l];f<i[l+1];++f)u[f]=f-i[l]<<5|l;return{b:i,r:u}},XI=ZI(qI,2),YI=XI.b,RF=XI.r;YI[28]=258,RF[258]=28;for(var zF=ZI(HI,0).b,KI=new yg(32768),Ao=0;Ao<32768;++Ao){var jf=(43690&Ao)>>1|(21845&Ao)<<1;KI[Ao]=((65280&(jf=(61680&(jf=(52428&jf)>>2|(13107&jf)<<2))>>4|(3855&jf)<<4))>>8|(255&jf)<<8)>>1}var vg=function(o,e,i){for(var l=o.length,u=0,f=new yg(e);u<l;++u)o[u]&&++f[o[u]-1];var p,v=new yg(e);for(u=1;u<e;++u)v[u]=v[u-1]+f[u-1]<<1;p=new yg(1<<e);var w=15-e;for(u=0;u<l;++u)if(o[u])for(var E=u<<4|o[u],C=e-o[u],z=v[o[u]-1]++<<C,L=z|(1<<C)-1;z<=L;++z)p[KI[z]>>w]=E;return p},xg=new Ea(288);for(Ao=0;Ao<144;++Ao)xg[Ao]=8;for(Ao=144;Ao<256;++Ao)xg[Ao]=9;for(Ao=256;Ao<280;++Ao)xg[Ao]=7;for(Ao=280;Ao<288;++Ao)xg[Ao]=8;var JI=new Ea(32);for(Ao=0;Ao<32;++Ao)JI[Ao]=5;var DF=vg(xg,9),LF=vg(JI,5),hb=function(o){for(var e=o[0],i=1;i<o.length;++i)o[i]>e&&(e=o[i]);return e},al=function(o,e,i){var l=e/8|0;return(o[l]|o[l+1]<<8)>>(7&e)&i},db=function(o,e){var i=e/8|0;return(o[i]|o[i+1]<<8|o[i+2]<<16)>>(7&e)},OF=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ll=function(o,e,i){var l=new Error(e||OF[o]);if(l.code=o,Error.captureStackTrace&&Error.captureStackTrace(l,ll),!i)throw l;return l},FF=new Ea(0),BF=typeof TextDecoder<"u"&&new TextDecoder;try{BF.decode(FF,{stream:!0})}catch{}const NF={gzip_data:"gzip"};class Na extends Error{constructor(e){super(e),this.name="MRTError"}}const VF={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},QI={uint32:1,uint16:2,uint8:4},UF={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let fb;class yv{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Na(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),l=new DataView(e);if(i[0]!==13)throw new Na("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),l=this.getHeaderLength(e);if(i.length<l)throw new Na(`Expected header with length >= ${l} but got buffer of length ${i.length}`);const u=new fb(i.subarray(0,l)).readFields(vF,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Na(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const f of u.layers)this.layers[f.name]=new $I(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],l=this.getLayer(e.layerName);for(let u of e.blockIndices){const f=l.dataIndex[u],p=f.firstByte-e.firstByte,v=f.lastByte-e.firstByte;if(l._blocksInProgress.has(u))continue;const w={layerName:l.name,firstByte:p,lastByte:v,pixelFormat:l.pixelFormat,blockIndex:u,blockShape:[f.bands.length].concat(l.bandShape),buffer:l.buffer,codec:f.codec.codec,filters:f.filters.map((E=>E.filter))};l._blocksInProgress.add(u),i.push(w)}return new eM(i,(()=>{i.forEach((u=>l._blocksInProgress.delete(u.blockIndex)))}),((u,f)=>{if(i.forEach((p=>l._blocksInProgress.delete(p.blockIndex))),u)throw u;f.forEach((p=>{this.getLayer(p.layerName).processDecodedData(p)}))}))}}class $I{constructor({version:e,name:i,units:l,tileSize:u,pixelFormat:f,buffer:p,dataIndex:v},w){if(this.version=e,this.version!==1)throw new Na(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=l,this.tileSize=u,this.buffer=p,this.pixelFormat=VF[f],this.dataIndex=v,this.bandShape=[u+2*p,u+2*p,QI[this.pixelFormat]],this._decodedBlocks=new gv(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return QI[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[l,u]of this.dataIndex.entries()){for(const[f,p]of u.bands.entries())if(p===e)return{bandIndex:i+f,blockIndex:l,blockBandIndex:f};i+=u.bands.length}break;case"number":for(const[l,u]of this.dataIndex.entries()){if(e>=i&&e<i+u.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-i};i+=u.bands.length}break;default:throw new Na(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,l=-1/0;const u=[],f=new Set;for(const p of e){const{blockIndex:v}=this.getBlockForBand(p);if(v<0)throw new Na(`Invalid band: ${JSON.stringify(p)}`);const w=this.dataIndex[v];u.includes(v)||u.push(v),f.add(v),i=Math.min(i,w.firstByte),l=Math.max(l,w.lastByte)}if(f.size>this.cacheSize)throw new Na(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:l,blockIndices:u}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:l}=this.getBlockForBand(e);if(i<0)throw new Na(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(i.toString());if(!u)throw new Na(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[i],p=this.bandShape.reduce(((E,C)=>E*C),1),v=l*p,w=u.subarray(v,v+p);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}yv.setPbf=function(o){fb=o};class eM{constructor(e,i,l){this.tasks=e,this._onCancel=i,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}yv.performDecoding=function(o,e){const i=new Uint8Array(o);return Promise.all(e.tasks.map((l=>{const{layerName:u,firstByte:f,lastByte:p,pixelFormat:v,blockShape:w,blockIndex:E,filters:C,codec:z}=l,L=i.subarray(f,p+1),N=new Uint32Array(w[0]*w[1]*w[2]);let U;if(z!=="gzip_data")throw new Na(`Unhandled codec: ${z}`);return U=(function(X,J){if(!globalThis.DecompressionStream&&J==="gzip_data")return Promise.resolve(((ge=(function(Ve){Ve[0]==31&&Ve[1]==139&&Ve[2]==8||ll(6,"invalid gzip data");var We=Ve[3],He=10;4&We&&(He+=2+(Ve[10]|Ve[11]<<8));for(var Tt=(We>>3&1)+(We>>4&1);Tt>0;Tt-=!Ve[He++]);return He+(2&We)})(he=X))+8>he.length&&ll(6,"invalid gzip data"),(function(Ve,We,He,Tt){var Ke=Ve.length;if(!Ke||We.f&&!We.l)return He||new Ea(0);var Et=!He,Ft=Et||We.i!=2,It=We.i;Et&&(He=new Ea(3*Ke));var Pt,Ut,bt=function(gr){var _r=He.length;if(gr>_r){var cr=new Ea(Math.max(2*_r,gr));cr.set(He),He=cr}},kt=We.f||0,dt=We.p||0,lt=We.b||0,jt=We.l,Nt=We.d,wn=We.m,sn=We.n,pn=8*Ke;do{if(!jt){kt=al(Ve,dt,1);var Xt=al(Ve,dt+1,3);if(dt+=3,!Xt){var xn=Ve[(ve=4+((dt+7)/8|0))-4]|Ve[ve-3]<<8,Zn=ve+xn;if(Zn>Ke){It&&ll(0);break}Ft&&bt(lt+xn),He.set(Ve.subarray(ve,Zn),lt),We.b=lt+=xn,We.p=dt=8*Zn,We.f=kt;continue}if(Xt==1)jt=DF,Nt=LF,wn=9,sn=5;else if(Xt==2){var en=al(Ve,dt,31)+257,_n=al(Ve,dt+10,15)+4,zn=en+al(Ve,dt+5,31)+1;dt+=14;for(var $n=new Ea(zn),di=new Ea(19),ni=0;ni<_n;++ni)di[kF[ni]]=al(Ve,dt+3*ni,7);dt+=3*_n;var hn=hb(di),ei=(1<<hn)-1,Ti=vg(di,hn);for(ni=0;ni<zn;){var ve,be=Ti[al(Ve,dt,ei)];if(dt+=15&be,(ve=be>>4)<16)$n[ni++]=ve;else{var ht=0,wt=0;for(ve==16?(wt=3+al(Ve,dt,3),dt+=2,ht=$n[ni-1]):ve==17?(wt=3+al(Ve,dt,7),dt+=3):ve==18&&(wt=11+al(Ve,dt,127),dt+=7);wt--;)$n[ni++]=ht}}var $t=$n.subarray(0,en),Qt=$n.subarray(en);wn=hb($t),sn=hb(Qt),jt=vg($t,wn),Nt=vg(Qt,sn)}else ll(1);if(dt>pn){It&&ll(0);break}}Ft&&bt(lt+131072);for(var un=(1<<wn)-1,Sn=(1<<sn)-1,fi=dt;;fi=dt){var pi=(ht=jt[db(Ve,dt)&un])>>4;if((dt+=15&ht)>pn){It&&ll(0);break}if(ht||ll(2),pi<256)He[lt++]=pi;else{if(pi==256){fi=dt,jt=null;break}var ui=pi-254;pi>264&&(ui=al(Ve,dt,(1<<(ci=qI[ni=pi-257]))-1)+YI[ni],dt+=ci);var Ki=Nt[db(Ve,dt)&Sn],Mr=Ki>>4;if(Ki||ll(3),dt+=15&Ki,Qt=zF[Mr],Mr>3){var ci=HI[Mr];Qt+=db(Ve,dt)&(1<<ci)-1,dt+=ci}if(dt>pn){It&&ll(0);break}Ft&&bt(lt+131072);var fr=lt+ui;if(lt<Qt){var Qi=0-Qt,Li=Math.min(Qt,fr);for(Qi+lt<0&&ll(3);lt<Li;++lt)He[lt]=(void 0)[Qi+lt]}for(;lt<fr;++lt)He[lt]=He[lt-Qt]}}We.l=jt,We.p=fi,We.b=lt,We.f=kt,jt&&(kt=1,We.m=wn,We.d=Nt,We.n=sn)}while(!kt);return lt!=He.length&&Et?(Pt=He,((Ut=lt)==null||Ut>Pt.length)&&(Ut=Pt.length),new Ea(Pt.subarray(0,Ut))):He.subarray(0,lt)})(he.subarray(ge,-8),{i:2},new Ea(((Q=he)[(le=Q.length)-4]|Q[le-3]<<8|Q[le-2]<<16|Q[le-1]<<24)>>>0))));var Q,le,he,ge;const Le=NF[J];if(!Le)throw new Error(`Unhandled codec: ${J}`);const Oe=new globalThis.DecompressionStream(Le);return new Response(new Blob([X]).stream().pipeThrough(Oe)).arrayBuffer().then((Ve=>new Uint8Array(Ve)))})(L,z).then((X=>((function(J,Q){J.readFields(EF,Q)})(new fb(X),N),new UF[v](N.buffer)))),U.then((X=>{for(let J=C.length-1;J>=0;J--)switch(C[J]){case"delta_filter":IF(X,w);break;case"zigzag_filter":MF(X);break;case"bitshuffle_filter":CF(X,v);break;default:throw new Na(`Unhandled filter "${C[J]}"`)}return{layerName:u,blockIndex:E,data:X}})).catch((X=>{throw X}))})))},ln(eM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),ln(yv,"MapboxRasterTile"),ln($I,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class tM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const l=e[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const jF=["id","tile","layer","source","sourceLayer","state"];class Gf{constructor(e,i,l,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=l,this._y=u,this.properties=e.properties,this.id=f}clone(){const e=new Gf(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of jF)this[i]!==void 0&&(e[i]=this[i]);return e}}class nM{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new xc(Yt,16,0),this.featureIndexArray=new vy,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,l,u,f,p=0,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,f,p);const E=this.grid;for(let C=0;C<i.length;C++){const z=i[C],L=[1/0,1/0,-1/0,-1/0];for(let N=0;N<z.length;N++){const U=z[N];L[0]=Math.min(L[0],U.x),L[1]=Math.min(L[1],U.y),L[2]=Math.max(L[2],U.x),L[3]=Math.max(L[3],U.y)}v!==0&&(L[0]-=v,L[1]-=v,L[2]+=v,L[3]+=v),L[0]<Yt&&L[1]<Yt&&L[2]>=0&&L[3]>=0&&E.insert(w,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new qn(new Hy(this.rawTileData)).layers,this.sourceLayerCoder=new tM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:l,transform:u,tileTransform:f,pixelPosMatrix:p,availableImages:v,worldview:w}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const E=l.bufferedTilespaceBounds,C=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,((U,X,J,Q)=>io(l.bufferedTilespaceGeometry,U,X,J,Q)));C.sort(GF);let z=null;u.elevation&&C.length>0&&(z=Nf.create(u.elevation,this.tileID));const L={};let N;for(let U=0;U<C.length;U++){const X=C[U];if(X===N)continue;N=X;const J=this.featureIndexArray.get(X);let Q=null;this.is3DTile?this.loadMatchingModelFeature(L,J,e,l,u,w):this.loadMatchingFeature(L,J,e,v,w,((le,he,ge,Le=0)=>(Q||(Q=nn(le,this.tileID.canonical,f)),he.queryIntersectsFeature(l,le,ge,Q,this.z,u,p,z,Le))))}return L}loadMatchingFeature(e,i,l,u,f,p){const{featureIndex:v,bucketIndex:w,sourceLayerIndex:E,layoutVertexArrayOffset:C}=i,z=this.bucketLayerIDs[w],L=l.layers,N=Object.keys(L);if(N.length&&!Qn(N,z))return;const U=l.sourceCache,X=this.sourceLayerCoder.decode(E),J=this.vtLayers[X].feature(v),Q=this.getId(J,X);for(let le=0;le<z.length;le++){const he=z[le];if(!L[he])continue;const{styleLayer:ge,targets:Le}=L[he];let Oe={};Q!==void 0&&(Oe=U.getFeatureState(ge.sourceLayer,Q));const Ve=!p||p(J,ge,Oe,C);if(!Ve)continue;const We=new Gf(J,this.z,this.x,this.y,Q);We.tile=this.tileID.canonical,We.state=Oe;let He=this.serializedLayersCache.get(he);He||(He=ge.serialize(),He.id=he,this.serializedLayersCache.set(he,He)),We.source=He.source,We.sourceLayer=He["source-layer"],We.layer=Object.assign({},He),We.layer.paint=iM(He.paint,ge.paint,J,Oe,u),We.layer.layout=iM(He.layout,ge.layout,J,Oe,u);let Tt=!1;for(const Ke of Le){this.updateFeatureProperties(We,Ke);const{filter:Et}=Ke;if(Et){if(J.properties=We.properties,Et.needGeometry){const Ft=Vt(J,!0);if(!Et.filter(new dr(this.tileID.overscaledZ,{worldview:f}),Ft,this.tileID.canonical))continue}else if(!Et.filter(new dr(this.tileID.overscaledZ,{worldview:f}),J))continue}Tt=!0,Ke.targetId&&this.addFeatureVariant(We,Ke)}Tt&&this.appendToResult(e,he,v,We,Ve)}}loadMatchingModelFeature(e,i,l,u,f,p){const{featureIndex:v,bucketIndex:w}=i,E=this.bucketLayerIDs[w],C=l.layers,z=Object.keys(C);if(!z.length||Qn(z,E))for(let L=0;L<E.length;L++){const N=E[L],{styleLayer:U,targets:X}=C[N];if(U.type!=="model")continue;const J=u.tile,Q=J.getBucket(U);if(!(Q&&Q instanceof hv))continue;const le=XO(Q,v,u,f);if(!le)continue;const{z:he,x:ge,y:Le}=J.tileID.canonical,{feature:Oe,intersectionZ:Ve,position:We}=le;let He={};Oe.id!==void 0&&(He=l.sourceCache.getFeatureState(U.sourceLayer,Oe.id));const Tt=new Gf({},he,ge,Le,Oe.id);Tt.tile=this.tileID.canonical,Tt.state=He,Tt.properties=Oe.properties,Tt.geometry={type:"Point",coordinates:[We.lng,We.lat]};let Ke=this.serializedLayersCache.get(N);Ke||(Ke=U.serialize(),Ke.id=N,this.serializedLayersCache.set(N,Ke)),Tt.source=Ke.source,Tt.sourceLayer=Ke["source-layer"],Tt.layer=Object.assign({},Ke);let Et=!1;for(const Ft of X){this.updateFeatureProperties(Tt,Ft);const{filter:It}=Ft;if(It){if(Oe.properties=Tt.properties,It.needGeometry){if(!It.filter(new dr(this.tileID.overscaledZ,{worldview:p}),Oe,this.tileID.canonical))continue}else if(!It.filter(new dr(this.tileID.overscaledZ,{worldview:p}),Oe))continue}Et=!0,Ft.targetId&&this.addFeatureVariant(Tt,Ft)}Et&&this.appendToResult(e,N,v,Tt,Ve)}}updateFeatureProperties(e,i,l){if(i.properties){const u={};for(const f in i.properties){const p=i.properties[f].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);p!=null&&(u[f]=p)}e.properties=u}}addFeatureVariant(e,i,l){const u={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(u)}appendToResult(e,i,l,u,f){let p=e[i];p===void 0&&(p=e[i]=[]),p.push({featureIndex:l,feature:u,intersectionZ:f})}lookupSymbolFeatures(e,i,l,u,f,p){const v={};this.loadVTLayers();for(const w of e)this.loadMatchingFeature(v,{bucketIndex:i,sourceLayerIndex:l,featureIndex:w,layoutVertexArrayOffset:0},u,f,p);return v}loadFeature(e){const{featureIndex:i,sourceLayerIndex:l}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(l),f=this.vtFeatures[u];if(f[i])return f[i];const p=this.vtLayers[u].feature(i);return f[i]=p,p}hasLayer(e){for(const i of this.bucketLayerIDs)for(const l of i)if(e===l)return!0;return!1}getId(e,i){let l=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const f=Ra(u);if(f.result!=="success"){const p=f.value.map((v=>`${v.key}: ${v.message}`)).join(", ");return void oi(`Failed to create expression for promoteId: ${p}`)}this.promoteIdExpression=f.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Ja),l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[u];typeof l=="boolean"&&(l=Number(l))}return l}}function iM(o,e,i,l,u){return Nn(o,((f,p)=>{const v=e instanceof Ec?e.get(p):null;return v&&v.evaluate?v.evaluate(i,l,void 0,u):v}))}function GF(o,e){return e-o}ln(nM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const rM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,l]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=l>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=rM[15&l];if(!f)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new pb(v,p,f,e)}constructor(e,i=64,l=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=rM.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${l}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+v+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=i,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return mb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:p,nodeSize:v}=this,w=[0,f.length-1,0],E=[];for(;w.length;){const C=w.pop()||0,z=w.pop()||0,L=w.pop()||0;if(z-L<=v){for(let J=L;J<=z;J++){const Q=p[2*J],le=p[2*J+1];Q>=e&&Q<=l&&le>=i&&le<=u&&E.push(f[J])}continue}const N=L+z>>1,U=p[2*N],X=p[2*N+1];U>=e&&U<=l&&X>=i&&X<=u&&E.push(f[N]),(C===0?e<=U:i<=X)&&(w.push(L),w.push(N-1),w.push(1-C)),(C===0?l>=U:u>=X)&&(w.push(N+1),w.push(z),w.push(1-C))}return E}within(e,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:p}=this,v=[0,u.length-1,0],w=[],E=l*l;for(;v.length;){const C=v.pop()||0,z=v.pop()||0,L=v.pop()||0;if(z-L<=p){for(let J=L;J<=z;J++)sM(f[2*J],f[2*J+1],e,i)<=E&&w.push(u[J]);continue}const N=L+z>>1,U=f[2*N],X=f[2*N+1];sM(U,X,e,i)<=E&&w.push(u[N]),(C===0?e-l<=U:i-l<=X)&&(v.push(L),v.push(N-1),v.push(1-C)),(C===0?e+l>=U:i+l>=X)&&(v.push(N+1),v.push(z),v.push(1-C))}return w}}function mb(o,e,i,l,u,f){if(u-l<=i)return;const p=l+u>>1;oM(o,e,p,l,u,f),mb(o,e,i,l,p-1,1-f),mb(o,e,i,p+1,u,1-f)}function oM(o,e,i,l,u,f){for(;u>l;){if(u-l>600){const E=u-l+1,C=i-l+1,z=Math.log(E),L=.5*Math.exp(2*z/3),N=.5*Math.sqrt(z*L*(E-L)/E)*(C-E/2<0?-1:1);oM(o,e,i,Math.max(l,Math.floor(i-C*L/E+N)),Math.min(u,Math.floor(i+(E-C)*L/E+N)),f)}const p=e[2*i+f];let v=l,w=u;for(bg(o,e,l,i),e[2*u+f]>p&&bg(o,e,l,u);v<w;){for(bg(o,e,v,w),v++,w--;e[2*v+f]<p;)v++;for(;e[2*w+f]>p;)w--}e[2*l+f]===p?bg(o,e,l,w):(w++,bg(o,e,w,u)),w<=i&&(l=w+1),i<=w&&(u=w-1)}}function bg(o,e,i,l){gb(o,i,l),gb(e,2*i,2*l),gb(e,2*i+1,2*l+1)}function gb(o,e,i){const l=o[e];o[e]=o[i],o[i]=l}function sM(o,e,i,l){const u=o-i,f=e-l;return u*u+f*f}r.$=Up,r.A=ya,r.B=Tu,r.C=2,r.D=Cf,r.E=cc,r.F=ag,r.G=kA,r.H=Vp,r.I=Vs,r.J=uf,r.K=jn,r.L=mh,r.M=Qd,r.N=Jd,r.O=fm,r.P=Mt,r.Q=mm,r.R=gd,r.S=Ac,r.T=C1,r.U=Ra,r.V=uv,r.W=gm,r.X=mu,r.Y=pu,r.Z=Nd,r._=fs,r.a=function(o){return Fo.API_CDN_URL_REGEX.test(o)},r.a$=Me,r.a0=ph,r.a1=Op,r.a2=hf,r.a3=class extends uv{},r.a4=$d,r.a5=dm,r.a6=Ye,r.a7=function(o){const e=o.value;return e?ph(e)?ib(e,!0)?[]:[new uv(o.key,e,`invalid url "${e}"`)]:[new uv(o.key,e,`string expected, "${jn(e)}" found`)]:[]},r.a8=iy,r.a9=Ur,r.aA=Pe,r.aB=Y,r.aC=ti,r.aD=h,r.aE=zo,r.aF=ye,r.aG=rt,r.aH=function(o,e){const i={};for(let l=0;l<e.length;l++){const u=e[l];u in o&&(i[u]=o[u])}return i},r.aI=re,r.aJ=Ce,r.aK=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,i,l){const u=this.entries[o]=this.entries[o]||{callbacks:[]};if(u.result){const[f,p]=u.result;return this.scheduler?this.scheduler.add((()=>{l(f,p)}),e):l(f,p),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=i(((f,p)=>{u.result=[f,p];for(const v of u.callbacks)this.scheduler?this.scheduler.add((()=>{v(f,p)}),e):v(f,p);setTimeout((()=>delete this.entries[o]),3e3)}))),()=>{u.result||(u.callbacks=u.callbacks.filter((f=>f!==l)),u.callbacks.length||(u.cancel(),delete this.entries[o]))}}},r.aL=function(o,e,i){const l=JSON.stringify(o.request);return o.data&&(this.deduped.entries[l]={result:[null,o.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},(u=>{const f=nu(o.request,((p,v,w,E)=>{p?u(p):v&&u(null,{vectorTile:i?void 0:new qn(new Hy(v)),rawData:v,cacheControl:w,expires:E})}));return()=>{f.cancel(),u()}}),e)},r.aM=function(o){El++,El>Ka&&(o.getActor().send("enforceCacheSizeLimit",pa),El=0)},r.aN=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log2(o)))},r.aO=gs,r.aP=sI,r.aQ=dI,r.aR=Z,r.aS=oI,r.aT=function(o,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let l=0;l<o.length;l++){const u=document.createElement("source");I_(o[l])||(i.crossOrigin="Anonymous"),u.src=o[l],i.appendChild(u)}return{cancel:()=>{}}},r.aU=tg,r.aV=function(o){return fetch(o).then((e=>e.arrayBuffer())).then((e=>OE(e,0,o)))},r.aW=WE,r.aX=class{constructor(o,e,i,l){this.id=o,this.position=e!=null?new Z(e[0],e[1]):new Z(0,0),this.orientation=i??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,e){if(Y(o.matrix,e,o.matrix),o.meshes)for(const i of o.meshes){const l=Fn.applyTransformFast(i.aabb,o.matrix);this.aabb.encapsulate(l)}if(o.children)for(const i of o.children)this._applyTransformations(i,o.matrix)}computeBoundsAndApplyParent(){const o=G([]);for(const e of this.nodes)this._applyTransformations(e,o)}computeModelMatrix(o,e,i,l,u,f,p=!1){jE(this.matrix,this,o.transform,this.position,e,i,l,u,f,p)}upload(o){if(!this.uploaded){for(const e of this.nodes)R1(e,o);for(const e of this.nodes)qy(e);this.uploaded=!0}}destroy(){for(const o of this.nodes)z1(o)}},r.aY=An,r.aZ=ug,r.a_=ke,r.aa=Wt,r.ab=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return so(o.expression.evaluate(e))}interpolate(o,e,i){return{x:Rn(o.x,e.x,i),y:Rn(o.y,e.y,i),z:Rn(o.z,e.z,i),azimuthal:Rn(o.azimuthal,e.azimuthal,i),polar:Rn(o.polar,e.polar,i)}}},r.ac=dr,r.ad=Ll,r.ae=pt,r.af=Je,r.ag=De,r.ah=nt,r.ai=Ec,r.aj=Ru,r.ak=Rn,r.al=Yt,r.am=Bp,r.an=Xe,r.ao=Hi,r.ap=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return(function([i,l]){const u=so([1,i,l]);return{x:u.x,y:u.y,z:u.z}})(o.expression.evaluate(e))}interpolate(o,e,i){return{x:Rn(o.x,e.x,i),y:Rn(o.y,e.y,i),z:Rn(o.z,e.z,i)}}},r.aq=function(o,e,i=0,l=!0){const u=new Mt(i,i),f=o.sub(u),p=e.add(u),v=[f,new Mt(p.x,f.y),p,new Mt(f.x,p.y)];return l&&v.push(f.clone()),v},r.ar=function(o,e){const i=[];for(let l=0;l<o.length;l++){const u=Ge(l-1,-1,o.length-1),f=Ge(l+1,-1,o.length-1),p=o[l],v=o[f],w=o[u].sub(p).unit(),E=v.sub(p).unit(),C=E.angleWithSep(w.x,w.y),z=w.add(E).unit().mult(-1*e/Math.sin(C/2));i.push(p.add(z))}return i},r.as=qA,r.at=io,r.au=function(o,e,i=0){return Be(((e.x-i)*o.scale-o.x)*Yt,(e.y*o.scale-o.y)*Yt,Ee(e.z,e.y))},r.av=Jt,r.aw=tt,r.ax=Di,r.ay=nA,r.az=function(o){let e=1/0,i=1/0,l=-1/0,u=-1/0;for(const f of o)e=Math.min(e,f.x),i=Math.min(i,f.y),l=Math.max(l,f.x),u=Math.max(u,f.y);return{min:new Mt(e,i),max:new Mt(l,u)}},r.b=function(o){return Fo.API_FONTS_REGEX.test(o)},r.b$=_1,r.b0=Mc,r.b1=Eo,r.b2=At,r.b3=Lm,r.b4=sv,r.b5=function(){za.isLoading()||za.isLoaded()||cf()!=="deferred"||bc()},r.b6=Ah,r.b7=Vt,r.b8=Gf,r.b9=Ci,r.bA=G,r.bB=ue,r.bC=W,r.bD=function(o,e){const{x:i,y:l}=o.point,u=SS(i,l,o.worldSize/o._pixelsPerMercatorPixel,0,0);return Y(u,u,r1(Hl(e)))},r.bE=P,r.bF=cn,r.bG=function(o,e){var i=e[0]-o[0],l=e[1]-o[1],u=e[2]-o[2];return Math.sqrt(i*i+l*l+u*u)},r.bH=Kt,r.bI=Lt,r.bJ=gt,r.bK=sg,r.bL=Xs,r.bM=W1,r.bN=function(o,e,i,l,u){const f=5*e+2;o.float32[f+0]=i,o.float32[f+1]=l,o.float32[f+2]=u},r.bO=ov,r.bP=hr,r.bQ=Co,r.bR=oo,r.bS=qr,r.bT=Ge,r.bU=function(o,e,i,l){var u=new k(4);return u[0]=o,u[1]=e,u[2]=i,u[3]=l,u},r.bV=By,r.bW=qs,r.bX=No,r.bY=tE,r.bZ=fI,r.b_=oE,r.ba=F1,r.bb=p1,r.bc=nn,r.bd=Vl,r.be=xf,r.bf=yS,r.bg=Fr,r.bh=If,r.bi=tb,r.bj=function(o,e){const i=Ru(e.zoom);if(i===0)return Hl(o);const l=Iy(o),u=i1(l),f=ye(l.getWest())*e.worldSize,p=ye(l.getEast())*e.worldSize,v=Ce(l.getNorth())*e.worldSize,w=Ce(l.getSouth())*e.worldSize,E=[f,v,0],C=[p,v,0],z=[f,w,0],L=[p,w,0],N=K([],e.globeMatrix);return Je(E,E,N),Je(C,C,N),Je(z,z,N),Je(L,L,N),u[0]=Rc(u[0],z,i),u[1]=Rc(u[1],L,i),u[2]=Rc(u[2],C,i),u[3]=Rc(u[3],E,i),Fn.fromPoints(u)},r.bk=Cy,r.bl=K,r.bm=Nm,r.bn=Rc,r.bo=Ic,r.bp=_L,r.bq=_e,r.br=ne,r.bs=yv,r.bt=Hy,r.bu=nu,r.bv=function(o,e){const i=[];for(const l in o)l in e||i.push(l);return i},r.bw=at,r.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.by=fo,r.bz=function(o){var e=new k(16);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],e},r.c=A_,r.c$=function(o){return o*o*o*o*o},r.c0=G1,r.c1=BA,r.c2=X1,r.c3=pb,r.c4=Dt,r.c5=zt,r.c6=Ri,r.c7=function(o,e,i){i*=.5;var l=e[0],u=e[1],f=e[2],p=e[3],v=Math.sin(i),w=Math.cos(i);return o[0]=l*w+u*v,o[1]=u*w-l*v,o[2]=f*w+p*v,o[3]=p*w-f*v,o},r.c8=ur,r.c9=zr,r.cA=li,r.cB=BE,r.cC=rl,r.cD=bS,r.cE=function(o,e,i,l,u,f,p,v,w){if(w.name==="globe")return bS(o,e,new rl(i,l,u),!1);const E=ug({z:i,x:l,y:u},w);return new Fn([(f+E.x/E.scale)*e,e*(E.y/E.scale),p],[(f+E.x2/E.scale)*e,e*(E.y2/E.scale),v])},r.cF=function(o,e,i){return o[0]=Math.min(e[0],i[0]),o[1]=Math.min(e[1],i[1]),o[2]=Math.min(e[2],i[2]),o[3]=Math.min(e[3],i[3]),o},r.cG=function(o,e,i){return o[0]=Math.max(e[0],i[0]),o[1]=Math.max(e[1],i[1]),o[2]=Math.max(e[2],i[2]),o[3]=Math.max(e[3],i[3]),o},r.cH=function(o){const e=Math.round((o+45+360)%360/90)%4;return se[e]},r.cI=ze,r.cJ=Gn,r.cK=y,r.cL=function(o){const e=G(new Float64Array(16));Y(e,o.pixelMatrix,o.globeMatrix);const i=[0,D,0],l=[0,O,0];return Je(i,i,e),Je(l,l,e),[i[0]>0&&i[0]<=o.width&&i[1]>0&&i[1]<=o.height&&!s1(o,new Z(o.center.lat,90)),l[0]>0&&l[0]<=o.width&&l[1]>0&&l[1]<=o.height&&!s1(o,new Z(o.center.lat,-90))]},r.cM=function(o,e){const{scale:i}=o.tileTransform,l=i*Yt/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return(function(u,f,p){var v=f[1],w=f[2],E=f[3],C=p[0],z=p[1];return u[0]=f[0]*C,u[1]=v*C,u[2]=w*z,u[3]=E*z,u})(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},r.cN=Gy,r.cO=xe,r.cP=FE,r.cQ=function(o){const e=FE(o,!0);return P([],[e[0],e[1],e[4],e[5]])},r.cR=oe,r.cS=Ni,r.cT=ce,r.cU=function(o){const{x:e,y:i}=o.point,{lng:l,lat:u}=o._center;return SS(e,i,o.worldSize,l,u)},r.cV=qe,r.cW=ee,r.cX=Af,r.cY=Ko,r.cZ=g,r.c_=function(o,e,i){let l=0;for(let u=0;u<2;++u)o[u]>0&&(l+=(o[u]-0)*(o[u]-0)),e[u]<0&&(l+=(0-e[u])*(0-e[u]));return l},r.ca=function(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o[3]=e[3],o},r.cb=ie,r.cc=function(o,e,i,l,u){var f=1/Math.tan(e/2);if(o[0]=f/i,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=f,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,u!=null&&u!==1/0){var p=1/(l-u);o[10]=(u+l)*p,o[14]=2*u*l*p}else o[10]=-1,o[14]=-2*l;return o},r.cd=function(o,e,i,l,u,f,p){var v=1/(e-i),w=1/(l-u),E=1/(f-p);return o[0]=-2*v,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*w,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*E,o[11]=0,o[12]=(e+i)*v,o[13]=(u+l)*w,o[14]=(p+f)*E,o[15]=1,o},r.ce=Ae,r.cf=function(o,e,i){o[4*e+0]=i[0],o[4*e+1]=i[1],o[4*e+2]=i[2],o[4*e+3]=i[3]},r.cg=Dh,r.ch=Lh,r.ci=no,r.cj=La,r.ck=Fh,r.cl=KA,r.cm=function(){var o=new k(4);return k!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},r.cn=function(o,e,i){var l=e[0],u=e[1],f=e[2],p=e[3],v=Math.sin(i),w=Math.cos(i);return o[0]=l*w+f*v,o[1]=u*w+p*v,o[2]=l*-v+f*w,o[3]=u*-v+p*w,o},r.co=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]&&o[3]===e[3]},r.cp=on,r.cq=function(o){var e=o[0],i=o[1],l=o[2],u=o[3];return Math.sqrt(e*e+i*i+l*l+u*u)},r.cr=ir,r.cs=ut,r.ct=Ef,r.cu=3,r.cv=2,r.cw=7,r.cx=6,r.cy=_t,r.cz=de,r.d=function(o){return Fo.API_TILEJSON_REGEX.test(o)},r.d$=sA,r.d0=pe,r.d1=45,r.d2=Oh,r.d3=function(o,e,i){const l=Math.sqrt(o*o+e*e+i*i),u=l>0?Math.acos(i/l)*jo:0;let f=o!==0||e!==0?Math.atan2(-e,-o)*jo+90:0;return f<0&&(f+=360),[l,f,u]},r.d4=Be,r.d5=so,r.d6=$e,r.d7=Ne,r.d8=Fn,r.d9=it,r.dA=function(o,e,i){const l=Ru(i.zoom),u=o.style.map._antialias,f=o.terrain&&o.terrain.exaggeration()>0;return l===0&&!u&&!f},r.dB=function(o){const e=o.pixelsPerMeter,i=e/Ae(1,o.center.lat),l=G(new Float64Array(16));return ne(l,l,[o.point.x,o.point.y,0]),oe(l,l,[i,i,e]),Float32Array.from(l)},r.dC=Iy,r.dD=function(o){const e=ze-5;o=Pe(o,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Xe(o))),3);return Math.round(i*(M.length-1))},r.dE=function(o,e,i,l){const u=e.getNorth(),f=e.getSouth(),p=e.getWest(),v=e.getEast(),w=1<<o.z,E=v-p,C=u-f,z=E/S,L=-C/M[i],N=[0,z,0,L,0,0,u,p,0];if(o.z>0){const U=180/l;V(N,N,[U/E+1,0,0,0,U/C+1,0,-.5*U/z,.5*U/L,1])}return N[2]=w,N[5]=o.x,N[8]=o.y,N},r.dF=Hl,r.dG=function(o,e,i){const l=G(new Float64Array(16)),u=(e/(1<<o)-.5)*Math.PI*2;return me(l,i.globeMatrix,u),Float32Array.from(l)},r.dH=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const i=e.getSource().maxzoom,l=1<<i,u=Math.floor(o.x),f=Math.floor((o.x-u)*l),p=Math.floor(o.y*l),v=this.findDEMTileFor(new gs(i,u,i,f,p));return!(!v||!v.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||o.y<0||o.y>1)return e;const u=l.getSource().maxzoom,f=1<<u,p=Math.floor(o.x),v=o.x-p,w=new gs(u,p,u,Math.floor(v*f),Math.floor(o.y*f)),E=this.findDEMTileFor(w);if(!E||!E.dem)return e;const C=E.dem,z=1<<E.tileID.canonical.z,L=(v*z-E.tileID.canonical.x)*C.dim,N=(o.y*z-E.tileID.canonical.y)*C.dim,U=Math.floor(L),X=Math.floor(N);return(i?this.exaggeration():1)*Rn(Rn(C.get(U,X),C.get(U,X+1),N-X),Rn(C.get(U+1,X),C.get(U+1,X+1),N-X),L-U)}getAtTileOffset(o,e,i){const l=1<<o.canonical.z;return this.getAtPointOrZero(new pt(o.wrap+(o.canonical.x+e/Yt)/l,(o.canonical.y+i/Yt)/l))}getAtTileOffsetFunc(o,e,i,l){return u=>{const f=this.getAtTileOffset(o,u.x,u.y),p=l.upVector(o.canonical,u.x,u.y);return Dt(p,p,f*l.upVectorScale(o.canonical,e,i).metersToTile),p}}getForTilePoints(o,e,i,l){if(this.isUsingMockSource())return!1;const u=Nf.create(this,o,l);return!!u&&(e.forEach((f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],i)})),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const i=e.dem.tree,l=e.tileID,u=1<<o.canonical.z-l.canonical.z;let f=o.canonical.x/u-l.canonical.x,p=o.canonical.y/u-l.canonical.y,v=0;for(let w=0;w<o.canonical.z-l.canonical.z&&!i.leaves[v];w++){f*=2,p*=2;const E=2*Math.floor(p)+Math.floor(f);v=i.childOffsets[v]+E,f%=1,p%=1}return{min:this.exaggeration()*i.minimums[v],max:this.exaggeration()*i.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,i=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const u of o){const f=this.getMinMaxForTile(u.tileID);f&&(i=Math.min(i,f.min),l=Math.max(l,f.max),e=!0)}return e?{min:i,max:l}:null}},r.dI=FS,r.dJ=Ay,r.dK=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},r.dL=R,r.dM=function(o,e){var i=Math.sin(e),l=Math.cos(e);return o[0]=l,o[1]=i,o[2]=0,o[3]=-i,o[4]=l,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},r.dN=Rt,r.dO=TS,r.dP=is,r.dQ=rs,r.dR=256,r.dS=function(o,e){const i=[0,0,0];return Je(i,i,Cy(Hl(e.canonical))),Je(i,i,o),i},r.dT=o=>({u_matrix:new Fh(o),u_texsize:new La(o),u_pixels_to_tile_units:new Sf(o),u_device_pixel_ratio:new no(o),u_width_scale:new no(o),u_floor_width_scale:new no(o),u_image:new Dh(o),u_units_to_pixels:new La(o),u_tile_units_to_pixels:new no(o),u_alpha_discard_threshold:new no(o),u_trim_offset:new La(o),u_trim_fade_range:new La(o),u_trim_color:new Oh(o),u_emissive_strength:new no(o),u_zbias_factor:new no(o),u_tile_to_meter:new no(o),u_ground_shadow_factor:new Lh(o),u_pattern_transition:new no(o)}),r.dU=o=>({u_matrix:new Fh(o),u_pixels_to_tile_units:new Sf(o),u_device_pixel_ratio:new no(o),u_width_scale:new no(o),u_floor_width_scale:new no(o),u_units_to_pixels:new La(o),u_dash_image:new Dh(o),u_gradient_image:new Dh(o),u_image_height:new no(o),u_texsize:new La(o),u_tile_units_to_pixels:new no(o),u_alpha_discard_threshold:new no(o),u_trim_offset:new La(o),u_trim_fade_range:new La(o),u_trim_color:new Oh(o),u_emissive_strength:new no(o),u_zbias_factor:new no(o),u_tile_to_meter:new no(o),u_ground_shadow_factor:new Lh(o)}),r.dV=o=>({u_camera_to_center_distance:new no(o),u_extrude_scale:new Sf(o),u_device_pixel_ratio:new no(o),u_matrix:new Fh(o),u_inv_rot_matrix:new Fh(o),u_merc_center:new La(o),u_tile_id:new Lh(o),u_zoom_transition:new no(o),u_up_dir:new Lh(o),u_emissive_strength:new no(o)}),r.dW=Pm,r.dX=nO,r.dY=class{constructor(o,e,i,l){this.context=o,this.format=l,this.size=i,this.texture=o.gl.createTexture();const[u,f,p]=this.size,{gl:v}=o;v.bindTexture(v.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,u,f,p,0,I1(this.format),M1(this.format),e.data)}bind(o,e){const{context:i}=this,{gl:l}=i;l.bindTexture(l.TEXTURE_3D,this.texture),o!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,o),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},r.dZ=IS,r.d_=(o,e,i,l,u,f)=>{const p=o.transform,v=p.projection.name==="globe";let w;if(f.paint.get("circle-pitch-alignment")==="map")if(v){const C=TS(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;w=Float32Array.from([C,0,0,C])}else w=p.calculatePixelsToTileUnitsMatrix(i);else w=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(p.projection),u_matrix:o.translatePosMatrix(e.projMatrix,i,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ca.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:wL,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(v){E.u_inv_rot_matrix=l,E.u_merc_center=u,E.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],E.u_zoom_transition=Ru(p.zoom);const C=u[0]*Yt,z=u[1]*Yt;E.u_up_dir=p.projection.upVector(new rl(0,0,0),C,z)}return E},r.da=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},r.db=ib,r.dc=function(o,e){return o.readFields(JO,{icons:[]},e)},r.dd=Ny,r.de=Of,r.df=H1,r.dg=_d,r.dh=ny,r.di=pd,r.dj=xd,r.dk=kn,r.dl=function(o){const e=o.indexOf(Ih);return e>=0?o.slice(0,e):o},r.dm=function(o){return o.indexOf(Ih)>=0},r.dn=function(o){const e=o.lastIndexOf(Ih);return e>=0?o.slice(e+1):""},r.dp=function(o){const e=[],i=o.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.dq=function(o,e,i,l){return o.type==="custom"?new qO(o,e):new YO[o.type](o,e,i,l)},r.dr=hi,r.ds=function(o){const e=o.indexOf(Ih);return e>=0?o.slice(e+1):""},r.dt=class extends Gf{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},r.du=bm,r.dv=Ei,r.dw=function(o){return o({pluginStatus:ps,pluginURL:Bl}),bm.on("pluginStateChange",o),o},r.dx=Ty,r.dy=class extends Da{constructor(o){super(o),this.current=e1}set(o,e,i){if(this.fetchUniformLocation(o,e)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.dz=we,r.e=Fo,r.e$=function(){const o=Qm;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(w1),Qm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.e0=ws,r.e1=(o,e,i,l,u,f,p,v,w,E)=>{const C=o.transform,z=C.pitch<15?iA(.07,.7,Pe((14-C.zoom)/5,0,1)):.07,L=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:oA(o,e,i,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:f,u_floor_width_scale:p,u_image:0,u_tile_units_to_pixels:rA(e,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:z,u_tile_to_meter:$e(e.tileID.canonical,0),u_ground_shadow_factor:w,u_pattern_transition:E}},r.e2=(o,e,i,l,u,f,p,v,w,E)=>{const C=o.transform,z=C.calculatePixelsToTileUnitsMatrix(e),L=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",N=C.pitch<15?iA(.07,.7,Pe((14-C.zoom)/5,0,1)):.07;return{u_matrix:oA(o,e,i,l),u_pixels_to_tile_units:z,u_device_pixel_ratio:f,u_width_scale:p,u_floor_width_scale:v,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:aA(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:rA(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:N,u_tile_to_meter:$e(e.tileID.canonical,0),u_ground_shadow_factor:E}},r.e3=dn,r.e4=Vm,r.e5=Ee,r.e6=mL,r.e7=Fy,r.e8=_E,r.e9=Du,r.eA=vo,r.eB=Mu,r.eC=function(o,e,i,l,u,f,p,v,w,E,C,z,L,N,U,X){var J=new k(16);return J[0]=o,J[1]=e,J[2]=i,J[3]=l,J[4]=u,J[5]=f,J[6]=p,J[7]=v,J[8]=w,J[9]=E,J[10]=C,J[11]=z,J[12]=L,J[13]=N,J[14]=U,J[15]=X,J},r.eD=q,r.eE=Ph,r.eF=yf,r.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Mt(1/0,1/0),max:new Mt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const i=iE(new Mt(0,0),new Mt(Yt,Yt),o),l=[];if(e&&!m1(i,this._globalClipBounds))return l;for(const u of this._activeRegions){if(u.hiddenByOverlap||!m1(i,u))continue;const f=KL(u.min,u.max,o);l.push({min:f.min,max:f.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return l}setSources(o){this._setSources(o.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const l of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(l).buckets[e.layer];u&&u.updateFootprints(l.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const i=o.getOrder(),l=o.getClipMask(),u=o.getClipScope();for(const f of e){if(!f.footprint)continue;const p=iE(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:i,clipMask:l,clipScope:u})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||Dy(e.min,i.min)||Dy(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(l,u){const f=(p,v)=>p+v;return l.length-u.length||l.reduce(f,"").localeCompare(u.reduce(f,""))})(e.clipScope,i.clipScope)));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const i=this._activeRegions[e],l=this._prevRegions[e];o=i.priority!==l.priority||!nE(i,l)||i.order!==l.order||i.clipMask!==l.clipMask||!fo(i.clipScope,l.clipScope),++e}}if(o){++this._updateTime;for(const i of this._activeRegions)i.order!==Hm&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const l=this._activeRegions;if(i>=l.length)return i;const u=l[i].priority;for(;i<l.length&&l[i].priority===u;)++i;return i};if(this._sourceIds.length>1){let i=0,l=e(i);for(;i!==l;){let u=i;const f=i;for(;u!==l;){const p=this._activeRegions[u];p.hiddenByOverlap=!1;for(let v=0;v<f;v++){const w=this._activeRegions[v];if(!w.hiddenByOverlap&&p.order===Hm&&m1(p,w)&&(p.hiddenByOverlap=rE(p.footprint,p.tileId,w.footprint,w.tileId),p.hiddenByOverlap))break}++u}i=l,l=e(i)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},r.eH=Hm,r.eI=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const i=new Vl,l=new Eo,u=[],f=o+1+2,p=e[0]+1,v=e[0]+1+(1+e.length),w=(E,C,z)=>{let L=E===f-1?E-2:E===0?E:E-1;return L+=z?24575:0,[L,C]};for(let E=0;E<f;++E)i.emplaceBack(...w(E,0,!0));for(let E=0;E<p;++E)for(let C=0;C<f;++C)i.emplaceBack(...w(C,E,(C===0||C===f-1)&&!0));for(let E=0;E<e.length;++E){const C=e[E];for(let z=0;z<f;++z)i.emplaceBack(...w(z,C,!0))}for(let E=0;E<e.length;++E){const C=l.length,z=e[E]+1+2,L=new Eo;for(let X=0;X<z-1;X++){const J=X===z-2,Q=J?f*(v-e.length+E-X):f;for(let le=0;le<f-1;le++){const he=X*f+le;X===0||J||le===0||le===f-2?(L.emplaceBack(he+1,he,he+Q),L.emplaceBack(he+Q,he+Q+1,he+1)):(l.emplaceBack(he+1,he,he+Q),l.emplaceBack(he+Q,he+Q+1,he+1))}}const N=Fr.simpleSegment(0,C,i.length,l.length-C);for(let X=0;X<L.uint16.length;X+=3)l.emplaceBack(L.uint16[X],L.uint16[X+1],L.uint16[X+2]);const U=Fr.simpleSegment(0,C,i.length,l.length-C);u.push({withoutSkirts:N,withSkirts:U})}return{vertices:i,indices:l,segments:u}}_createGrid(o){const e=this._fillGridMeshWithLods(S,M);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,yS.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new Eo;for(let p=0;p<=S;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const i=new Cc,l=new Cc,u=new Cc,f=new Cc;this._poleSegments=[];for(let p=0,v=0;p<g;p++){const w=360/(1<<p);i.emplaceBack(0,-h,0,.5,0),l.emplaceBack(0,-h,0,.5,1),u.emplaceBack(0,-h,0,.5,.5),f.emplaceBack(0,-h,0,.5,.5);for(let E=0;E<=S;E++){let C=E/S,z=0;const L=Rn(0,w,C),[N,U,X]=j(xL,bL,L,h);i.emplaceBack(N,U,X,C,z),l.emplaceBack(N,U,X,C,1-z);const J=Xe(L);C=.5+.5*Math.sin(J),z=.5+.5*Math.cos(J),u.emplaceBack(N,U,X,C,z),f.emplaceBack(N,U,X,C,1-z)}this._poleSegments.push(Fr.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(i,Ey,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(l,Ey,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(u,Ey,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(f,Ey,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},r.eJ=eE,r.eK=Fe,r.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.eM=Ie,r.eN=mt,r.eO=function(o,e,i){return o[0]=e[0]/i[0],o[1]=e[1]/i[1],o[2]=e[2]/i[2],o},r.eP=vt,r.eQ=B,r.eR=Qe,r.eS=Se,r.eT=function([o,e,i]){const l=Math.hypot(o,e,i),u=Math.atan2(o,i),f=.5*Math.PI-Math.acos(-e/l);return new Z(ee(u),ee(f))},r.eU=Wn,r.eV=P1,r.eW=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!(function(i){if(Vr==null){const l=i.navigator?i.navigator.userAgent:null;Vr=!!i.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Vr})(o)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.eX=function(o,e){pa=o,Ka=e},r.eY=s1,r.eZ=ES,r.e_=function(o){const e=[0,0,0],i=G(new Float64Array(16));return Y(i,o.pixelMatrix,o.globeMatrix),Je(e,e,i),new Mt(e[0],e[1])},r.ea=450,r.eb=7,r.ec=Ze,r.ed=function(o,e){if(o===e){var i=e[1],l=e[2],u=e[3],f=e[6],p=e[7],v=e[11];o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=i,o[6]=e[9],o[7]=e[13],o[8]=l,o[9]=f,o[11]=e[14],o[12]=u,o[13]=p,o[14]=v}else o[0]=e[0],o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=e[1],o[5]=e[5],o[6]=e[9],o[7]=e[13],o[8]=e[2],o[9]=e[6],o[10]=e[10],o[11]=e[14],o[12]=e[3],o[13]=e[7],o[14]=e[11],o[15]=e[15];return o},r.ee=WO,r.ef=xi,r.eg=Pu,r.eh=256,r.ei=r1,r.ej=Ss,r.ek=me,r.el=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[4],o[4]=e[5],o[5]=e[6],o[6]=e[8],o[7]=e[9],o[8]=e[10],o},r.em=Cc,r.en=zm,r.eo=lm,r.ep=function(o,e,i,l,u){return Pe((o-e)/(i-e)*(u-l)+l,l,u)},r.eq=wi,r.er=function(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],p=e[4],v=e[5],w=e[6],E=e[7],C=e[8],z=C*p-v*E,L=-C*f+v*w,N=E*f-p*w,U=i*z+l*L+u*N;return U?(o[0]=z*(U=1/U),o[1]=(-C*l+u*E)*U,o[2]=(v*l-u*p)*U,o[3]=L*U,o[4]=(C*i-u*w)*U,o[5]=(-v*i+u*f)*U,o[6]=N*U,o[7]=(-E*i+l*w)*U,o[8]=(p*i-l*f)*U,o):null},r.es=2,r.et=st,r.eu=k1,r.ev=[1,1,1],r.ew=Nf,r.ex=fn,r.ey=function(o,e,i,l){var u=e[0],f=e[1],p=e[2],v=e[3];return o[0]=u+l*(i[0]-u),o[1]=f+l*(i[1]-f),o[2]=p+l*(i[2]-p),o[3]=v+l*(i[3]-v),o},r.ez=zf,r.f=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},r.f0=function(){Ny().acquire(w1)},r.f1=cf,r.f2=function(o,e,i=!1){if(ps===Is.deferred||ps===Is.loading||ps===Is.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Bl=Ca.resolveURL(o),ps=Is.deferred,vm=e,xm(),i||bc()},r.f3=function(o){Pf=Ca.resolveURL(o),kf||(kf=new Cf(Ny(),new cc)),kf.broadcast("setMeshoptUrl",Pf)},r.f4=PE,r.f5=function(o){S1=Ca.resolveURL(o),kf||(kf=new Cf(Ny(),new cc)),kf.broadcast("setDracoUrl",S1)},r.f6=CE,r.f7=Jm,r.f8=function(o){const e=kp();if(!e)return;const i=e.delete(Fs);o&&i.then((()=>o())).catch(o)},r.f9=Uh,r.fA=function(o){rh(),hs?.then((e=>{e.keys().then((i=>{for(let l=0;l<i.length-o;l++)e.delete(i[l]).catch((u=>oi(u.message)))})).catch((i=>oi(i.message)))})).catch((e=>oi(e.message)))},r.fa=ln,r.fb=zu,r.fc=sl,r.fd=tM,r.fe=nM,r.ff=$E,r.fg=ai,r.fh="hd_road_elevation",r.fi=Dr,r.fj=Nn,r.fk=zc,r.fl=q1,r.fm=Wh,r.fn=function(o,e,i,l,u,f,p,v=1,w,E,C){o.createArrays(),o.tilePixelRatio=Yt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const z=o.layers[0].layout,L=o.layers[0]._unevaluatedLayout._values,N={};N.scaleFactor=v,N.textSizeScaleRange=z.get("text-size-scale-range"),N.iconSizeScaleRange=z.get("icon-size-scale-range");const[U,X]=N.textSizeScaleRange,[J,Q]=N.iconSizeScaleRange;N.textScaleFactor=Pe(N.scaleFactor,U,X),N.iconScaleFactor=Pe(N.scaleFactor,J,Q);const le=L["text-size"],he=L["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:He,maxZoom:Tt}=o.textSizeData;N.compositeTextSizes=[le.possiblyEvaluate(new dr(He,{worldview:C}),f),le.possiblyEvaluate(new dr(Tt,{worldview:C}),f)]}if(o.iconSizeData.kind==="composite"){const{minZoom:He,maxZoom:Tt}=o.iconSizeData;N.compositeIconSizes=[he.possiblyEvaluate(new dr(He,{worldview:C}),f),he.possiblyEvaluate(new dr(Tt,{worldview:C}),f)]}N.layoutTextSize=le.possiblyEvaluate(new dr(p+1,{worldview:C}),f),N.layoutIconSize=he.possiblyEvaluate(new dr(p+1,{worldview:C}),f),N.textMaxSize=le.possiblyEvaluate(new dr(18,{worldview:C}),f);const ge=z.get("symbol-placement"),Le=z.get("text-rotation-alignment")==="map"&&ge!=="point",Oe=z.get("text-size");let Ve=!1;const We=[];for(const He of o.features){const Tt=z.get("text-font").evaluate(He,{},f).join(","),Ke=Oe.evaluate(He,{},f)*N.textScaleFactor,Et=N.layoutTextSize.evaluate(He,{},f)*N.textScaleFactor,Ft=N.layoutIconSize.evaluate(He,{},f)*N.iconScaleFactor,It={horizontal:{},vertical:void 0},Pt=He.text;let Ut,bt=[0,0];if(Pt){const _n=Pt.toString(),zn=z.get("text-letter-spacing").evaluate(He,{},f)*No,$n=z.get("text-line-height").evaluate(He,{},f)*No,di=ey(_n)?zn:0,ni=z.get("text-anchor").evaluate(He,{},f),hn=z.get("text-variable-anchor");if(!hn){const ht=z.get("text-radial-offset").evaluate(He,{},f);if(ht)bt=BA(ni,[ht*No,Z1]);else{const wt=z.get("text-offset").evaluate(He,{},f);bt=[wt[0]*No,wt[1]*No]}}let ei=Le?"center":z.get("text-justify").evaluate(He,{},f);const Ti=ge==="point",ve=Ti?z.get("text-max-width").evaluate(He,{},f)*No:1/0,be=ht=>{o.allowVerticalPlacement&&ym(_n)&&(It.vertical=j1(Pt,e,i,u,Tt,ve,$n,ni,ht,di,bt,Xs.vertical,!0,Et,Ke,w))};if(!Le&&hn){const ht=ei==="auto"?hn.map(($t=>X1($t))):[ei];let wt=!1;for(let $t=0;$t<ht.length;$t++){const Qt=ht[$t];if(!It.horizontal[Qt])if(wt)It.horizontal[Qt]=It.horizontal[0];else{const un=j1(Pt,e,i,u,Tt,ve,$n,"center",Qt,di,bt,Xs.horizontal,!1,Et,Ke,w);un&&(It.horizontal[Qt]=un,wt=un.positionedLines.length===1)}}be("left")}else{if(ei==="auto"&&(ei=X1(ni)),Ti||z.get("text-writing-mode").indexOf("horizontal")>=0||!ym(_n)){const ht=j1(Pt,e,i,u,Tt,ve,$n,ni,ei,di,bt,Xs.horizontal,!1,Et,Ke,w);ht&&(It.horizontal[ei]=ht)}be(Ti?"left":ei)}}let kt,dt,lt,jt,Nt,wn,sn=!1;const pn=z.get("icon-text-fit").evaluate(He,{},f);if(He.icon&&He.icon.hasPrimary()){const _n=VA(He.icon,o.iconSizeData,L["icon-size"],f,o.zoom,He,w,N.iconScaleFactor,C);kt=_n.iconPrimary,lt=_n.iconSecondary;const zn=kt.toString();if(dt=l.get(zn),dt&&(Nt=z.get("icon-offset").evaluate(He,{},f),wn=z.get("icon-anchor").evaluate(He,{},f),Ut=xO(u.get(zn),lt?u.get(lt.toString()):void 0,Nt,wn),sn=dt.sdf,o.sdfIcons===void 0?o.sdfIcons=dt.sdf:o.sdfIcons!==dt.sdf&&oi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(dt.pixelRatio!==o.pixelRatio||z.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0)),lt){const $n=lt.toString();jt=l.get($n)}}Ve=Ve||!(!He.icon||!He.icon.hasSecondary());const Xt=Y1(It.horizontal)||It.vertical;o.iconsInText||(o.iconsInText=!!Xt&&Xt.iconsInText);const xn=Et*N.textScaleFactor/No,{defaultShapedIcon:Zn,verticallyShapedIcon:en}=PO(o,Ut,z,He,f,It,xn,Nt,pn);pn!=="none"&&Ut&&(wA(Ut)||TA(Ut))&&(Jy(0,dt,kt,Ut,Zn,pn,E,l,u),Jy(0,jt,lt,Ut,Zn,pn,E,l,u),en&&(Jy(0,dt,kt,Ut,en,pn,E,l,u),Jy(0,jt,lt,Ut,en,pn,E,l,u))),Ut=Zn,We.push({feature:He,shapedTextOrientations:It,shapedText:Xt,shapedIcon:Ut,iconPrimary:kt,iconSecondary:lt,iconOffset:Nt,iconAnchor:wn,verticallyShapedIcon:en,layoutTextSize:Et,layoutIconSize:Ft,textOffset:bt,isSDFIcon:sn,iconTextFit:pn})}return{featureData:We,sizes:N,hasAnySecondaryIcon:Ve,textAlongLine:Le,symbolPlacement:ge}},r.fo=RA,r.fp=function(o,e,i,l,u,f,p,v,w,E){const{featureData:C,hasAnySecondaryIcon:z,sizes:L,textAlongLine:N,symbolPlacement:U}=e;for(const X of C){const{shapedIcon:J,verticallyShapedIcon:Q,feature:le,shapedTextOrientations:he,shapedText:ge,layoutTextSize:Le,textOffset:Oe,isSDFIcon:Ve,iconPrimary:We,iconSecondary:He,iconTextFit:Tt,iconOffset:Ke}=X;UA(J,E.iconPositions,We,He),UA(Q,E.iconPositions,We,He),CO(he,E.iconPositions),MO(We,He,E.iconPositions),(ge||J)&&kO(o,le,he,J,Q,w,L,Le,0,Oe,Ve,l,u,p,v,z,Tt,Ke,N,U)}i&&o.generateCollisionDebugBuffers(f,o.collisionBoxArray,L.textScaleFactor)},r.fq=qn,r.fr=_v,r.fs=Ot,r.ft=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==RE){const i=new Uint32Array(o,0,7),[,,l,u,f,p]=i;e=i.byteLength+u+f+p+f,(l!==o.byteLength||e>=o.byteLength)&&oi("Invalid b3dm header information.")}return OE(o,e)},r.fu=function(o,e){const i=WE(o);for(const l of i){for(const u of l.meshes)I3(u);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(M3(l.lights,e)))}return i},r.fv=hv,r.fw=tr,r.fx=IE,r.fy=za,r.fz=Is,r.g=function(o,e){return Ei(Object.assign(o,{method:"GET"}),e)},r.h=function(o){return o.indexOf("mapbox:")===0},r.i=function(o){return Fo.API_STYLE_REGEX.test(o)&&!A_(o)},r.j=wl,r.k=oh,r.l=function(o){return decodeURIComponent(atob(o).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},r.m=function(o,e){return Ei(Object.assign(o,{type:"json"}),e)},r.n=iu,r.o=Ca,r.p=function(o,e){return Ei(Object.assign(o,{method:"POST"}),e)},r.q=Jo,r.r=Cp,r.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=function(){return T1||(T1=new Uh),T1},r.u=function(){return(function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)})()},r.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},r.w=oi,r.x=ub,r.y=lh,r.z=ga})),x(["./shared"],(function(r){function I(Xe){const ee=Xe?Xe.url.toString():void 0;return ee?performance.getEntriesByName(ee):[]}function k(Xe){if(typeof Xe=="number"||typeof Xe=="boolean"||typeof Xe=="string"||Xe==null)return JSON.stringify(Xe);if(Array.isArray(Xe)){let se="[";for(const we of Xe)se+=`${k(we)},`;return`${se}]`}let ee="{";for(const se of Object.keys(Xe).sort())ee+=`${se}:${k(Xe[se])},`;return`${ee}}`}function P(Xe){let ee="";for(const se of r.bx)ee+=`/${k(Xe[se])}`;return ee}class R{constructor(ee){this.keyCache={},this._layers={},this._layerConfigs={},ee&&this.replace(ee)}replace(ee,se){this._layerConfigs={},this._layers={},this.update(ee,[],se)}update(ee,se,we){this._options=we;for(const Ie of ee)this._layerConfigs[Ie.id]=Ie,(this._layers[Ie.id]=r.dq(Ie,this.scope,null,this._options)).compileFilter(we),this.keyCache[Ie.id]&&delete this.keyCache[Ie.id];for(const Ie of se)delete this.keyCache[Ie],delete this._layerConfigs[Ie],delete this._layers[Ie];this.familiesBySource={};const Fe=(function(Ie,Pe){const nt={};for(let at=0;at<Ie.length;at++){const Bt=Ie[at];let At=Pe&&Pe[Bt.id];At||(Bt.type==="symbol"?At=Bt.id:(At=P(Bt),Bt.type==="line"&&Bt.paint&&(function An(Nn){return typeof Nn=="string"&&Nn==="line-progress"||(Array.isArray(Nn)?Nn.some(An):!(!Nn||typeof Nn!="object")&&Object.values(Nn).some(An))})(Bt.paint["line-width"])&&(At+=`/${k(Bt.paint["line-width"])}`))),Pe&&(Pe[Bt.id]=At);let dn=nt[At];dn||(dn=nt[At]=[]),dn.push(Bt)}const Ge=[];for(const at in nt)Ge.push(nt[at]);return Ge})(Object.values(this._layerConfigs),this.keyCache);for(const Ie of Fe){const Pe=Ie.map((dn=>this._layers[dn.id])),nt=Pe[0];if(nt.visibility==="none")continue;const Ge=nt.source||"";let at=this.familiesBySource[Ge];at||(at=this.familiesBySource[Ge]={});const Bt=nt.sourceLayer||"_geojsonTileLayer";let At=at[Bt];At||(At=at[Bt]=[]),At.push(Pe)}}}const F=1*r.fc;class V{constructor(ee){const se={},we=[];for(const nt in ee){const Ge=ee[nt],at=se[nt]={};for(const Bt in Ge.glyphs){const At=Ge.glyphs[+Bt];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const dn=At.metrics.localGlyph?F:1,An={x:0,y:0,w:At.bitmap.width+2*dn,h:At.bitmap.height+2*dn};we.push(An),at[Bt]=An}}const{w:Fe,h:Ie}=r.G(we),Pe=new r.fb({width:Fe||1,height:Ie||1});for(const nt in ee){const Ge=ee[nt];for(const at in Ge.glyphs){const Bt=Ge.glyphs[+at];if(!Bt||Bt.bitmap.width===0||Bt.bitmap.height===0)continue;const At=se[nt][at],dn=Bt.metrics.localGlyph?F:1;r.fb.copy(Bt.bitmap,Pe,{x:0,y:0},{x:At.x+dn,y:At.y+dn},Bt.bitmap)}}this.image=Pe,this.positions=se}}r.fa(V,"GlyphAtlas");class W{constructor(ee){this.tileID=new r.aO(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.lut=ee.lut,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.scope=ee.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.request&&ee.request.collectResourceTiming,this.promoteId=ee.promoteId,this.isSymbolTile=ee.isSymbolTile,this.tileTransform=r.aZ(ee.tileID.canonical,ee.projection),this.projection=ee.projection,this.worldview=ee.worldview,this.localizableLayerIds=ee.localizableLayerIds,this.brightness=ee.brightness,this.extraShadowCaster=!!ee.extraShadowCaster,this.tessellationStep=ee.tessellationStep,this.scaleFactor=ee.scaleFactor,this.worldview=ee.worldview}parse(ee,se,we,Fe,Ie,Pe){this.status="parsing",this.data=ee,this.collisionBoxArray=new r.b3;const nt=new r.fd(Object.keys(ee.layers).sort()),Ge=new r.fe(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const at={},Bt=new r.ff(256,256),At={featureIndex:Ge,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Bt,availableImages:we,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},dn=[],An=se.familiesBySource[this.source];for(const hi in An){const kn=ee.layers[hi];if(!kn)continue;let Qn=!1,Mi=!1,oi=!1;for(const tr of An[hi])tr[0].type==="symbol"?Qn=!0:Mi=!0,tr[0].is3D()&&tr[0].type!=="model"&&(oi=!0);if(this.extraShadowCaster&&!oi||this.isSymbolTile===!0&&!Qn||this.isSymbolTile===!1&&!Mi)continue;kn.version===1&&r.w(`Vector tile source "${this.source}" layer "${hi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ui=nt.encode(hi),Er=[];let so=!1;for(let tr=0,Ci=0;tr<kn.length;tr++){const Vr=kn.feature(tr),zr=Ge.getId(Vr,hi);if(this.localizableLayerIds&&this.localizableLayerIds.has(hi)){const mr=Vr.properties?Vr.properties.worldview:null;if(this.worldview&&typeof mr=="string")if(mr==="all")Vr.properties.$localized=!0;else{if(!mr.split(",").includes(this.worldview))continue;Vr.properties.$localized=!0,Vr.properties.worldview=this.worldview}}!so&&Vr.properties&&Vr.properties.hasOwnProperty(r.fg)&&(so=!0),Er.push({feature:Vr,id:zr,index:Ci,sourceLayerIndex:Ui}),Ci++}so&&!At.elevationFeatures&&ee.layers.hasOwnProperty(r.fh)&&(At.elevationFeatures=r.fi.parseFrom(ee.layers[r.fh],this.canonical));for(const tr of An[hi]){const Ci=tr[0];if(this.extraShadowCaster&&(!Ci.is3D()||Ci.type==="model")||this.isSymbolTile!==void 0&&Ci.type==="symbol"!==this.isSymbolTile||Ci.minzoom&&this.zoom<Math.floor(Ci.minzoom)||Ci.maxzoom&&this.zoom>=Ci.maxzoom||Ci.visibility==="none")continue;G(tr,this.zoom,At.brightness,we,this.worldview);const Vr=at[Ci.id]=Ci.createBucket({index:Ge.bucketLayerIDs.length,layers:tr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ui,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Fe,worldview:this.worldview});Ge.bucketLayerIDs.push(tr.map((mr=>r.B(mr.id,mr.scope))));let zr=Vr.prepare?Vr.prepare():null;zr!=null?(zr=zr.then((()=>Vr.populate(Er,At,this.tileID.canonical,this.tileTransform))),dn.push(zr)):Vr.populate(Er,At,this.tileID.canonical,this.tileTransform)}}const Nn=()=>{let hi,kn,Qn,Mi,oi,Ui;Bt.trim();const Er={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},so=()=>{if(hi)return this.status="done",Pe(hi);if(this.extraShadowCaster)this.status="done",Pe(null,{buckets:Object.values(at).filter((Ci=>!Ci.isEmpty())),featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:At.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(kn&&Qn&&Mi){const Ci=new V(kn),Vr=new Map;for(const[So,is]of Qn.entries()){const{imagePosition:rs}=r.fl(So,is,r.fm);Vr.set(So,rs)}const zr={};for(const So in at){const is=at[So];is instanceof r.b4&&(G(is.layers,this.zoom,At.brightness,we,this.worldview),zr[So]=r.fn(is,kn,Ci.positions,Qn,Vr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,oi,this.worldview))}const mr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ie,Qn,oi,(()=>{mr.iconsPending=!1,tr(zr,Ci,mr)})),this.rasterizeIfNeeded(Ie,Mi,Ui,(()=>{mr.patternsPending=!1,tr(zr,Ci,mr)}))}},tr=(Ci,Vr,zr,mr)=>{if(zr.iconsPending||zr.patternsPending)return;const So=new r.fo(Qn,Mi,this.lut);for(const is in at){const rs=at[is];if(is in Ci)r.fp(rs,Ci[is],this.showCollisionBoxes,we,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Qn,So);else if(rs.hasPattern&&(rs instanceof r.ba||rs instanceof r.bb||rs instanceof r.e7)){G(rs.layers,this.zoom,At.brightness,we,this.worldview);const Ma=Object.fromEntries(So.patternPositions);rs.addFeatures(At,this.tileID.canonical,Ma,we,this.tileTransform,this.brightness)}}this.status="done",Pe(null,{buckets:Object.values(at).filter((is=>!is.isEmpty())),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Vr.image,lineAtlas:Bt,imageAtlas:So,brightness:At.brightness})};if(!this.extraShadowCaster){const Ci=r.fj(At.glyphDependencies,(mr=>Object.keys(mr).map(Number)));Object.keys(Ci).length?Ie.send("getGlyphs",{uid:this.uid,stacks:Ci},((mr,So)=>{hi||(hi=mr,kn=So,so())}),void 0,!1,Er):kn={};const Vr=Array.from(At.iconDependencies.keys()).map((mr=>r.I.parse(mr)));Vr.length?Ie.send("getImages",{images:Vr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((mr,So)=>{hi||(hi=mr,Qn=new Map,oi=this.updateImageMapAndGetImageTaskQueue(Qn,So,At.iconDependencies),so())}),void 0,!1,Er):(Qn=new Map,oi=new Map);const zr=Array.from(At.patternDependencies.keys()).map((mr=>r.I.parse(mr)));zr.length?Ie.send("getImages",{images:zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((mr,So)=>{hi||(hi=mr,Mi=new Map,Ui=this.updateImageMapAndGetImageTaskQueue(Mi,So,At.patternDependencies),so())}),void 0,!1,Er):(Mi=new Map,Ui=new Map)}if(At.elevationFeatures&&At.elevationFeatures.length>0){const Ci=[];for(const zr of Object.values(at))if(zr instanceof r.bb){const mr=zr.getUnevaluatedPortalGraph();mr&&Ci.push(mr)}const Vr=r.fk.evaluate(Ci);for(const zr of Object.values(at))if(zr instanceof r.bb){const mr=ee.layers[nt.decode(zr.sourceLayerIndex)];zr.setEvaluatedPortalGraph(Vr,mr,this.tileID.canonical,At.availableImages,At.brightness)}}so()};dn.length>0?Promise.allSettled(dn).then(Nn).catch(Pe):Nn()}rasterizeIfNeeded(ee,se,we,Fe){Array.from(se.values()).some((Ie=>Ie.usvg))?this.rasterize(ee,se,we,Fe):Fe()}updateImageMapAndGetImageTaskQueue(ee,se,we){const Fe=new Map;for(const Ie of se.keys()){const Pe=we.get(Ie)||[];for(const nt of Pe){const Ge=nt.toString(),at=se.get(nt.id.toString());at.usvg?Fe.has(Ge)||(Fe.set(Ge,nt),ee.set(Ge,Object.assign({},at))):ee.set(Ge,at)}}return Fe}rasterize(ee,se,we,Fe){this.rasterizeTask=ee.send("rasterizeImages",{scope:this.scope,tasks:we},((Ie,Pe)=>{if(!Ie)for(const[nt,Ge]of Pe.entries()){const at=Object.assign(se.get(nt),{data:Ge});se.set(nt,at)}Fe()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function G(Xe,ee,se,we,Fe){const Ie=new r.ac(ee,{brightness:se,worldview:Fe});for(const Pe of Xe)Pe.recalculate(Ie,we)}class K extends r.E{constructor(ee,se,we,Fe,Ie,Pe,nt){super(),this.actor=ee,this.layerIndex=se,this.availableImages=we,this.availableModels=Fe,this.loadVectorData=Pe||r.aL,this.loading={},this.loaded={},this.deduped=new r.aK(ee.scheduler),this.isSpriteLoaded=Ie,this.scheduler=ee.scheduler,this.brightness=nt}loadTile(ee,se){const we=ee.uid,Fe=ee&&ee.request,Ie=Fe&&Fe.collectResourceTiming,Pe=this.loading[we]=new W(ee);Pe.abort=this.loadVectorData(ee,((nt,Ge)=>{const at=!this.loading[we];if(delete this.loading[we],Pe.cancelRasterize(),at||nt||!Ge)return Pe.status="done",at||(this.loaded[we]=Pe),se(nt);const Bt=Ge.rawData,At={};Ge.expires&&(At.expires=Ge.expires),Ge.cacheControl&&(At.cacheControl=Ge.cacheControl),Pe.vectorTile=Ge.vectorTile||new r.fq(new r.bt(Bt));const dn=()=>{Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((An,Nn)=>{if(An||!Nn)return se(An);const hi={};if(Ie){const kn=I(Fe);kn.length>0&&(hi.resourceTiming=JSON.parse(JSON.stringify(kn)))}se(null,Object.assign({rawTileData:Bt.slice(0)},Nn,At,hi))}))};this.isSpriteLoaded?dn():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(dn,{type:"parseTile",isSymbolTile:ee.isSymbolTile,zoom:ee.tileZoom}):dn()})),this.loaded=this.loaded||{},this.loaded[we]=Pe}))}reloadTile(ee,se){const we=this.loaded,Fe=ee.uid;if(we&&we[Fe]){const Ie=we[Fe];Ie.scaleFactor=ee.scaleFactor,Ie.showCollisionBoxes=ee.showCollisionBoxes,Ie.projection=ee.projection,Ie.brightness=ee.brightness,Ie.tileTransform=r.aZ(ee.tileID.canonical,ee.projection),Ie.extraShadowCaster=ee.extraShadowCaster,Ie.lut=ee.lut,Ie.worldview=ee.worldview;const Pe=(nt,Ge)=>{const at=Ie.reloadCallback;at&&(delete Ie.reloadCallback,Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,at)),se(nt,Ge)};Ie.status==="parsing"?Ie.reloadCallback=Pe:Ie.status==="done"&&(Ie.vectorTile?Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Pe):Pe())}else se(null,void 0)}abortTile(ee,se){const we=ee.uid,Fe=this.loading[we];Fe&&(Fe.abort&&Fe.abort(),delete this.loading[we]),se()}removeTile(ee,se){const we=this.loaded,Fe=ee.uid;we&&we[Fe]&&delete we[Fe],se()}}class Y{loadTile(ee,se){const{uid:we,encoding:Fe,rawImageData:Ie,padding:Pe}=ee,nt=ImageBitmap&&Ie instanceof ImageBitmap?this.getImageData(Ie,Pe):Ie;se(null,new r.fr(we,nt,Fe,Pe<1))}reloadTile(ee,se){se(null,null)}abortTile(ee,se){se()}removeTile(ee,se){se()}getImageData(ee,se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);const we=this.offscreenCanvasContext.getImageData(-se,-se,ee.width+2*se,ee.height+2*se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),we}}r.bs.setPbf(r.bt);class ne{constructor(ee){this._mrt=new r.bs(ee.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ee.uid,this.tileID=ee.tileID,this.source=ee.source}parse(ee,se){const we=this._mrt;this.status="parsing",this._entireBuffer=ee;try{we.parseHeader(ee),this._isHeaderLoaded=!0;const Fe=[];for(const Ie in we.layers){const Pe=we.getLayer(Ie),nt=Pe.getDataRange(Pe.getBandList()),Ge=we.createDecodingTask(nt),at=ee.slice(nt.firstByte,nt.lastByte+1),Bt=r.bs.performDecoding(at,Ge).then((At=>Ge.complete(null,At))).catch((At=>Ge.complete(At,null)));Fe.push(Bt)}Promise.allSettled(Fe).then((()=>se(null,we))).catch((Ie=>se(Ie)))}catch(Fe){se(Fe)}}}class oe{constructor(ee){this.actor=ee,this.loading={},this.loaded={}}loadTile(ee,se){const we=ee.uid,Fe=ee.request,Ie=this.loading[we]=new ne(ee),{cancel:Pe}=r.bu(Fe,((nt,Ge,at,Bt)=>{const At=!this.loading[we];if(delete this.loading[we],At||nt||!Ge)return Ie.status="done",At||(this.loaded[we]=Ie),se(nt);Ie.parse(Ge,((dn,An)=>{if(dn||!An)return se(dn);se(null,An,at,Bt)})),this.loaded[we]=Ie}));Ie.abort=Pe}reloadTile(ee,se){se(null,void 0)}abortTile(ee,se){const we=ee.uid,Fe=this.loading[we];Fe&&(Fe.abort&&Fe.abort(),delete this.loading[we]),se()}removeTile(ee,se){const we=ee.uid;this.loaded[we]&&delete this.loaded[we],se()}decodeRasterArray(ee,se){r.bs.performDecoding(ee.buffer,ee.task).then((we=>se(null,we))).catch((we=>se(we)))}}const ce=r.fs.prototype.toGeoJSON;class me{constructor(ee){this._feature=ee,this.extent=r.al,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const se of this._feature.geometry)ee.push([new r.P(se[0],se[1])]);return ee}{const ee=[];for(const se of this._feature.geometry){const we=[];for(const Fe of se)we.push(new r.P(Fe[0],Fe[1]));ee.push(we)}return ee}}toGeoJSON(ee,se,we){return ce.call(this,ee,se,we)}}class ue{constructor(ee,se){this.name=ee,this.extent=r.al,this.length=se.length,this._jsonFeatures=se}feature(ee){return new me(this._jsonFeatures[ee])}}class _e{constructor(ee){this.layers={},this.extent=r.al;for(const se of Object.keys(ee))this.layers[se]=new ue(se,ee[se])}}const te=64/4096,ie=128;class xe{constructor(){this.features=new Map}clear(){this.features.clear()}load(ee=[],se){for(const we of ee){const Fe=we.id;if(Fe==null)continue;let Ie=this.features.get(Fe);Ie&&this.updateCache(Ie,se),we.geometry?(Ie=Te(we),this.updateCache(Ie,se),this.features.set(Fe,Ie)):this.features.delete(Fe),this.updateCache(Ie,se)}}updateCache(ee,se){for(const{canonical:we,uid:Fe}of Object.values(se)){const{z:Ie,x:Pe,y:nt}=we;de(ee,Math.pow(2,Ie),Pe,nt)&&delete se[Fe]}}getTile(ee,se,we){const Fe=Math.pow(2,ee),Ie=[];for(const Pe of this.features.values())de(Pe,Fe,se,we)&&Ie.push(Ne(Pe,Fe,se,we));return{features:Ie}}getFeatures(){return[...this.features.values()]}}function de({minX:Xe,minY:ee,maxX:se,maxY:we},Fe,Ie,Pe){return Xe<(Ie+1+te)/Fe&&ee<(Pe+1+te)/Fe&&se>(Ie-te)/Fe&&we>(Pe-te)/Fe}function Te(Xe){const{id:ee,geometry:se,properties:we}=Xe;if(!se)return;if(se.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Fe,coordinates:Ie}=se,Pe={id:ee,type:1,geometry:[],tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},nt=Pe.geometry;if(Fe==="Point")De(Ie,nt,Pe);else if(Fe==="MultiPoint")for(const Ge of Ie)De(Ge,nt,Pe);else if(Fe==="LineString")Pe.type=2,Be(Ie,nt,Pe);else if(Fe==="MultiLineString")Pe.type=2,Se(Ie,nt,Pe);else if(Fe==="Polygon")Pe.type=3,Se(Ie,nt,Pe,!0);else{if(Fe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Pe.type=3;for(const Ge of Ie)Se(Ge,nt,Pe,!0)}return Pe}function De([Xe,ee],se,we){const Fe=r.aF(Xe);let Ie=r.aJ(ee);Ie=Ie<0?0:Ie>1?1:Ie,se.push(Fe,Ie),we.minX=Math.min(we.minX,Fe),we.minY=Math.min(we.minY,Ie),we.maxX=Math.max(we.maxX,Fe),we.maxY=Math.max(we.maxY,Ie)}function Be(Xe,ee,se,we=!1,Fe=!1){const Ie=[];for(const Pe of Xe)De(Pe,Ie,se);ee.push(Ie),we&&(function(Pe,nt){let Ge=0;for(let at=0,Bt=Pe.length,At=Bt-2;at<Bt;At=at,at+=2)Ge+=(Pe[at]-Pe[At])*(Pe[at+1]+Pe[At+1]);if(Ge>0===nt)for(let at=0,Bt=Pe.length;at<Bt/2;at+=2){const At=Pe[at],dn=Pe[at+1];Pe[at]=Pe[Bt-2-at],Pe[at+1]=Pe[Bt-1-at],Pe[Bt-2-at]=At,Pe[Bt-1-at]=dn}})(Ie,Fe)}function Se(Xe,ee,se,we=!1){for(let Fe=0;Fe<Xe.length;Fe++)Be(Xe[Fe],ee,se,we,Fe===0)}function Ne(Xe,ee,se,we){const{id:Fe,type:Ie,geometry:Pe,tags:nt}=Xe,Ge=[];if(Ie===1)(function(at,Bt,At,dn,An){for(let Nn=0;Nn<at.length;Nn+=2){const hi=Math.round(r.al*(at[Nn+0]*Bt-At)),kn=Math.round(r.al*(at[Nn+1]*Bt-dn));An.push([hi,kn])}})(Pe,ee,se,we,Ge);else for(const at of Pe)it(at,ee,se,we,Ge);return{id:Fe,type:Ie,geometry:Ge,tags:nt}}function it(Xe,ee,se,we,Fe){const Ie=-ie,Pe=r.al+ie;let nt;for(let Ge=0;Ge<Xe.length-2;Ge+=2){let at=Math.round(r.al*(Xe[Ge+0]*ee-se)),Bt=Math.round(r.al*(Xe[Ge+1]*ee-we)),At=Math.round(r.al*(Xe[Ge+2]*ee-se)),dn=Math.round(r.al*(Xe[Ge+3]*ee-we));const An=At-at,Nn=dn-Bt;at<Ie&&At<Ie||(at<Ie?(Bt+=Math.round(Nn*((Ie-at)/An)),at=Ie):At<Ie&&(dn=Bt+Math.round(Nn*((Ie-at)/An)),At=Ie),Bt<Ie&&dn<Ie||(Bt<Ie?(at+=Math.round(An*((Ie-Bt)/Nn)),Bt=Ie):dn<Ie&&(At=at+Math.round(An*((Ie-Bt)/Nn)),dn=Ie),at>=Pe&&At>=Pe||(at>=Pe?(Bt+=Math.round(Nn*((Pe-at)/An)),at=Pe):At>=Pe&&(dn=Bt+Math.round(Nn*((Pe-at)/An)),At=Pe),Bt>=Pe&&dn>=Pe||(Bt>=Pe?(at+=Math.round(An*((Pe-Bt)/Nn)),Bt=Pe):dn>=Pe&&(At=at+Math.round(An*((Pe-Bt)/Nn)),dn=Pe),nt&&at===nt[nt.length-1][0]&&Bt===nt[nt.length-1][1]||(nt=[[at,Bt]],Fe.push(nt)),nt.push([At,dn])))))}}function qe({name:Xe,features:ee},se){se.writeStringField(1,Xe),se.writeVarintField(5,r.al);const we=new Map,Fe=new Map,Ie={keys:we,values:Fe,feature:null};for(const Pe of ee)Ie.feature=Pe,se.writeMessage(2,ft,Ie);for(const Pe of we.keys())se.writeStringField(3,Pe);for(const Pe of Fe.keys())se.writeMessage(4,Qe,Pe)}function ft(Xe,ee){const se=Xe.feature;se.id!==void 0&&Number.isSafeInteger(+se.id)&&ee.writeVarintField(1,+se.id),se.tags&&ee.writeMessage(2,St,Xe),ee.writeVarintField(3,se.type),ee.writeMessage(4,et,se)}function St({keys:Xe,values:ee,feature:se},we){for(const Fe of Object.keys(se.tags)){let Ie=se.tags[Fe];if(Ie===null)continue;let Pe=Xe.get(Fe);Pe===void 0&&(Pe=Xe.size,Xe.set(Fe,Pe)),we.writeVarint(Pe);const nt=typeof Ie;nt!=="string"&&nt!=="boolean"&&nt!=="number"&&(Ie=JSON.stringify(Ie));let Ge=ee.get(Ie);Ge===void 0&&(Ge=ee.size,ee.set(Ie,Ge)),we.writeVarint(Ge)}}function Dt(Xe,ee){return(ee<<3)+(7&Xe)}function Kt(Xe){return Xe<<1^Xe>>31}function et(Xe,ee){const{geometry:se,type:we}=Xe;let Fe=0,Ie=0;if(we===1){ee.writeVarint(Dt(1,se.length));for(const Pe of se){const nt=Pe[0]-Fe,Ge=Pe[1]-Ie;ee.writeVarint(Kt(nt)),ee.writeVarint(Kt(Ge)),Fe+=nt,Ie+=Ge}}else for(const Pe of se){ee.writeVarint(Dt(1,1));const nt=Pe.length-(we===3?1:0);for(let Ge=0;Ge<nt;Ge++){Ge===1&&ee.writeVarint(Dt(2,nt-1));const at=Pe[Ge][0]-Fe,Bt=Pe[Ge][1]-Ie;ee.writeVarint(Kt(at)),ee.writeVarint(Kt(Bt)),Fe+=at,Ie+=Bt}we===3&&ee.writeVarint(Dt(7,1))}}function Qe(Xe,ee){const se=typeof Xe;se==="string"?ee.writeStringField(1,Xe):se==="boolean"?ee.writeBooleanField(7,Xe):se==="number"&&(Xe%1!=0?ee.writeDoubleField(3,Xe):Xe<0?ee.writeSVarintField(6,Xe):ee.writeVarintField(5,Xe))}const st={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xe=>Xe},tt=Math.fround||(gt=new Float32Array(1),Xe=>(gt[0]=+Xe,gt[0]));var gt;const Lt=3,_t=5,Je=6;class Rt{constructor(ee){this.options=Object.assign(Object.create(st),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:se,minZoom:we,maxZoom:Fe}=this.options;se&&console.time("total time");const Ie=`prepare ${ee.length} points`;se&&console.time(Ie),this.points=ee;const Pe=[];for(let Ge=0;Ge<ee.length;Ge++){const at=ee[Ge];if(!at.geometry)continue;const[Bt,At]=at.geometry.coordinates,dn=tt(on(Bt)),An=tt(Jt(At));Pe.push(dn,An,1/0,Ge,-1,1),this.options.reduce&&Pe.push(0)}let nt=this.trees[Fe+1]=this._createTree(Pe);se&&console.timeEnd(Ie);for(let Ge=Fe;Ge>=we;Ge--){const at=+Date.now();nt=this.trees[Ge]=this._createTree(this._cluster(nt,Ge)),se&&console.log("z%d: %d clusters in %dms",Ge,nt.numItems,+Date.now()-at)}return se&&console.timeEnd("total time"),this}getClusters(ee,se){let we=((ee[0]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,ee[1]));let Ie=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)we=-180,Ie=180;else if(we>Ie){const At=this.getClusters([we,Fe,180,Pe],se),dn=this.getClusters([-180,Fe,Ie,Pe],se);return At.concat(dn)}const nt=this.trees[this._limitZoom(se)],Ge=nt.range(on(we),Jt(Pe),on(Ie),Jt(Fe)),at=nt.data,Bt=[];for(const At of Ge){const dn=this.stride*At;Bt.push(at[dn+_t]>1?ut(at,dn,this.clusterProps):this.points[at[dn+Lt]])}return Bt}getChildren(ee){const se=this._getOriginId(ee),we=this._getOriginZoom(ee),Fe="No cluster with the specified id.",Ie=this.trees[we];if(!Ie)throw new Error(Fe);const Pe=Ie.data;if(se*this.stride>=Pe.length)throw new Error(Fe);const nt=this.options.radius/(this.options.extent*Math.pow(2,we-1)),Ge=Ie.within(Pe[se*this.stride],Pe[se*this.stride+1],nt),at=[];for(const Bt of Ge){const At=Bt*this.stride;Pe[At+4]===ee&&at.push(Pe[At+_t]>1?ut(Pe,At,this.clusterProps):this.points[Pe[At+Lt]])}if(at.length===0)throw new Error(Fe);return at}getLeaves(ee,se,we){const Fe=[];return this._appendLeaves(Fe,ee,se=se||10,we=we||0,0),Fe}getTile(ee,se,we){const Fe=this.trees[this._limitZoom(ee)],Ie=Math.pow(2,ee),{extent:Pe,radius:nt}=this.options,Ge=nt/Pe,at=(we-Ge)/Ie,Bt=(we+1+Ge)/Ie,At={features:[]};return this._addTileFeatures(Fe.range((se-Ge)/Ie,at,(se+1+Ge)/Ie,Bt),Fe.data,se,we,Ie,At),se===0&&this._addTileFeatures(Fe.range(1-Ge/Ie,at,1,Bt),Fe.data,Ie,we,Ie,At),se===Ie-1&&this._addTileFeatures(Fe.range(0,at,Ge/Ie,Bt),Fe.data,-1,we,Ie,At),At.features.length?At:null}getClusterExpansionZoom(ee){let se=this._getOriginZoom(ee)-1;for(;se<=this.options.maxZoom;){const we=this.getChildren(ee);if(se++,we.length!==1)break;ee=we[0].properties.cluster_id}return se}_appendLeaves(ee,se,we,Fe,Ie){const Pe=this.getChildren(se);for(const nt of Pe){const Ge=nt.properties;if(Ge&&Ge.cluster?Ie+Ge.point_count<=Fe?Ie+=Ge.point_count:Ie=this._appendLeaves(ee,Ge.cluster_id,we,Fe,Ie):Ie<Fe?Ie++:ee.push(nt),ee.length===we)break}return Ie}_createTree(ee){const se=new r.c3(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<ee.length;we+=this.stride)se.add(ee[we],ee[we+1]);return se.finish(),se.data=ee,se}_addTileFeatures(ee,se,we,Fe,Ie,Pe){for(const nt of ee){const Ge=nt*this.stride,at=se[Ge+_t]>1;let Bt,At,dn;if(at)Bt=cn(se,Ge,this.clusterProps),At=se[Ge],dn=se[Ge+1];else{const hi=this.points[se[Ge+Lt]];Bt=hi.properties;const[kn,Qn]=hi.geometry.coordinates;At=on(kn),dn=Jt(Qn)}const An={type:1,geometry:[[Math.round(this.options.extent*(At*Ie-we)),Math.round(this.options.extent*(dn*Ie-Fe))]],tags:Bt};let Nn;Nn=at||this.options.generateId?se[Ge+Lt]:this.points[se[Ge+Lt]].id,Nn!==void 0&&(An.id=Nn),Pe.features.push(An)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,se){const{radius:we,extent:Fe,reduce:Ie,minPoints:Pe}=this.options,nt=we/(Fe*Math.pow(2,se)),Ge=ee.data,at=[],Bt=this.stride;for(let At=0;At<Ge.length;At+=Bt){if(Ge[At+2]<=se)continue;Ge[At+2]=se;const dn=Ge[At],An=Ge[At+1],Nn=ee.within(Ge[At],Ge[At+1],nt),hi=Ge[At+_t];let kn=hi;for(const Qn of Nn){const Mi=Qn*Bt;Ge[Mi+2]>se&&(kn+=Ge[Mi+_t])}if(kn>hi&&kn>=Pe){let Qn,Mi=dn*hi,oi=An*hi,Ui=-1;const Er=(At/Bt<<5)+(se+1)+this.points.length;for(const so of Nn){const tr=so*Bt;if(Ge[tr+2]<=se)continue;Ge[tr+2]=se;const Ci=Ge[tr+_t];Mi+=Ge[tr]*Ci,oi+=Ge[tr+1]*Ci,Ge[tr+4]=Er,Ie&&(Qn||(Qn=this._map(Ge,At,!0),Ui=this.clusterProps.length,this.clusterProps.push(Qn)),Ie(Qn,this._map(Ge,tr)))}Ge[At+4]=Er,at.push(Mi/kn,oi/kn,1/0,Er,-1,kn),Ie&&at.push(Ui)}else{for(let Qn=0;Qn<Bt;Qn++)at.push(Ge[At+Qn]);if(kn>1)for(const Qn of Nn){const Mi=Qn*Bt;if(!(Ge[Mi+2]<=se)){Ge[Mi+2]=se;for(let oi=0;oi<Bt;oi++)at.push(Ge[Mi+oi])}}}}return at}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,se,we){if(ee[se+_t]>1){const Pe=this.clusterProps[ee[se+Je]];return we?Object.assign({},Pe):Pe}const Fe=this.points[ee[se+Lt]].properties,Ie=this.options.map(Fe);return we&&Ie===Fe?Object.assign({},Ie):Ie}}function ut(Xe,ee,se){return{type:"Feature",id:Xe[ee+Lt],properties:cn(Xe,ee,se),geometry:{type:"Point",coordinates:[(we=Xe[ee],360*(we-.5)),vt(Xe[ee+1])]}};var we}function cn(Xe,ee,se){const we=Xe[ee+_t],Fe=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,Ie=Xe[ee+Je],Pe=Ie===-1?{}:Object.assign({},se[Ie]);return Object.assign(Pe,{cluster:!0,cluster_id:Xe[ee+Lt],point_count:we,point_count_abbreviated:Fe})}function on(Xe){return Xe/360+.5}function Jt(Xe){const ee=Math.sin(Xe*Math.PI/180),se=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return se<0?0:se>1?1:se}function vt(Xe){const ee=(180-360*Xe)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function zt(Xe,ee,se,we){let Fe=we;const Ie=ee+(se-ee>>1);let Pe,nt=se-ee;const Ge=Xe[ee],at=Xe[ee+1],Bt=Xe[se],At=Xe[se+1];for(let dn=ee+3;dn<se;dn+=3){const An=fn(Xe[dn],Xe[dn+1],Ge,at,Bt,At);if(An>Fe)Pe=dn,Fe=An;else if(An===Fe){const Nn=Math.abs(dn-Ie);Nn<nt&&(Pe=dn,nt=Nn)}}Fe>we&&(Pe-ee>3&&zt(Xe,ee,Pe,we),Xe[Pe+2]=Fe,se-Pe>3&&zt(Xe,Pe,se,we))}function fn(Xe,ee,se,we,Fe,Ie){let Pe=Fe-se,nt=Ie-we;if(Pe!==0||nt!==0){const Ge=((Xe-se)*Pe+(ee-we)*nt)/(Pe*Pe+nt*nt);Ge>1?(se=Fe,we=Ie):Ge>0&&(se+=Pe*Ge,we+=nt*Ge)}return Pe=Xe-se,nt=ee-we,Pe*Pe+nt*nt}function Gn(Xe,ee,se,we){const Fe={id:Xe??null,type:ee,geometry:se,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")Wn(Fe,se);else if(ee==="Polygon")Wn(Fe,se[0]);else if(ee==="MultiLineString")for(const Ie of se)Wn(Fe,Ie);else if(ee==="MultiPolygon")for(const Ie of se)Wn(Fe,Ie[0]);return Fe}function Wn(Xe,ee){for(let se=0;se<ee.length;se+=3)Xe.minX=Math.min(Xe.minX,ee[se]),Xe.minY=Math.min(Xe.minY,ee[se+1]),Xe.maxX=Math.max(Xe.maxX,ee[se]),Xe.maxY=Math.max(Xe.maxY,ee[se+1])}function ti(Xe,ee,se,we){if(!ee.geometry)return;const Fe=ee.geometry.coordinates;if(Fe&&Fe.length===0)return;const Ie=ee.geometry.type,Pe=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2);let nt=[],Ge=ee.id;if(se.promoteId?Ge=ee.properties[se.promoteId]:se.generateId&&(Ge=we||0),Ie==="Point")yi(Fe,nt);else if(Ie==="MultiPoint")for(const at of Fe)yi(at,nt);else if(Ie==="LineString")Ri(Fe,nt,Pe,!1);else if(Ie==="MultiLineString"){if(se.lineMetrics){for(const at of Fe)nt=[],Ri(at,nt,Pe,!1),Xe.push(Gn(Ge,"LineString",nt,ee.properties));return}ur(Fe,nt,Pe,!1)}else if(Ie==="Polygon")ur(Fe,nt,Pe,!0);else{if(Ie!=="MultiPolygon"){if(Ie==="GeometryCollection"){for(const at of ee.geometry.geometries)ti(Xe,{id:Ge,geometry:at,properties:ee.properties},se,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const at of Fe){const Bt=[];ur(at,Bt,Pe,!0),nt.push(Bt)}}Xe.push(Gn(Ge,Ie,nt,ee.properties))}function yi(Xe,ee){ee.push(wi(Xe[0]),Oi(Xe[1]),0)}function Ri(Xe,ee,se,we){let Fe,Ie,Pe=0;for(let Ge=0;Ge<Xe.length;Ge++){const at=wi(Xe[Ge][0]),Bt=Oi(Xe[Ge][1]);ee.push(at,Bt,0),Ge>0&&(Pe+=we?(Fe*Bt-at*Ie)/2:Math.sqrt(Math.pow(at-Fe,2)+Math.pow(Bt-Ie,2))),Fe=at,Ie=Bt}const nt=ee.length-3;ee[2]=1,zt(ee,0,nt,se),ee[nt+2]=1,ee.size=Math.abs(Pe),ee.start=0,ee.end=ee.size}function ur(Xe,ee,se,we){for(let Fe=0;Fe<Xe.length;Fe++){const Ie=[];Ri(Xe[Fe],Ie,se,we),ee.push(Ie)}}function wi(Xe){return Xe/360+.5}function Oi(Xe){const ee=Math.sin(Xe*Math.PI/180),se=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return se<0?0:se>1?1:se}function zi(Xe,ee,se,we,Fe,Ie,Pe,nt){if(we/=ee,Ie>=(se/=ee)&&Pe<we)return Xe;if(Pe<se||Ie>=we)return null;const Ge=[];for(const at of Xe){const Bt=at.geometry;let At=at.type;const dn=Fe===0?at.minX:at.minY,An=Fe===0?at.maxX:at.maxY;if(dn>=se&&An<we){Ge.push(at);continue}if(An<se||dn>=we)continue;let Nn=[];if(At==="Point"||At==="MultiPoint")qi(Bt,Nn,se,we,Fe);else if(At==="LineString")ir(Bt,Nn,se,we,Fe,!1,nt.lineMetrics);else if(At==="MultiLineString")lr(Bt,Nn,se,we,Fe,!1);else if(At==="Polygon")lr(Bt,Nn,se,we,Fe,!0);else if(At==="MultiPolygon")for(const hi of Bt){const kn=[];lr(hi,kn,se,we,Fe,!0),kn.length&&Nn.push(kn)}if(Nn.length){if(nt.lineMetrics&&At==="LineString"){for(const hi of Nn)Ge.push(Gn(at.id,At,hi,at.tags));continue}At!=="LineString"&&At!=="MultiLineString"||(Nn.length===1?(At="LineString",Nn=Nn[0]):At="MultiLineString"),At!=="Point"&&At!=="MultiPoint"||(At=Nn.length===3?"Point":"MultiPoint"),Ge.push(Gn(at.id,At,Nn,at.tags))}}return Ge.length?Ge:null}function qi(Xe,ee,se,we,Fe){for(let Ie=0;Ie<Xe.length;Ie+=3){const Pe=Xe[Ie+Fe];Pe>=se&&Pe<=we&&hr(ee,Xe[Ie],Xe[Ie+1],Xe[Ie+2])}}function ir(Xe,ee,se,we,Fe,Ie,Pe){let nt=$r(Xe);const Ge=Fe===0?uo:oo;let at,Bt,At=Xe.start;for(let kn=0;kn<Xe.length-3;kn+=3){const Qn=Xe[kn],Mi=Xe[kn+1],oi=Xe[kn+2],Ui=Xe[kn+3],Er=Xe[kn+4],so=Fe===0?Qn:Mi,tr=Fe===0?Ui:Er;let Ci=!1;Pe&&(at=Math.sqrt(Math.pow(Qn-Ui,2)+Math.pow(Mi-Er,2))),so<se?tr>se&&(Bt=Ge(nt,Qn,Mi,Ui,Er,se),Pe&&(nt.start=At+at*Bt)):so>we?tr<we&&(Bt=Ge(nt,Qn,Mi,Ui,Er,we),Pe&&(nt.start=At+at*Bt)):hr(nt,Qn,Mi,oi),tr<se&&so>=se&&(Bt=Ge(nt,Qn,Mi,Ui,Er,se),Ci=!0),tr>we&&so<=we&&(Bt=Ge(nt,Qn,Mi,Ui,Er,we),Ci=!0),!Ie&&Ci&&(Pe&&(nt.end=At+at*Bt),ee.push(nt),nt=$r(Xe)),Pe&&(At+=at)}let dn=Xe.length-3;const An=Xe[dn],Nn=Xe[dn+1],hi=Fe===0?An:Nn;hi>=se&&hi<=we&&hr(nt,An,Nn,Xe[dn+2]),dn=nt.length-3,Ie&&dn>=3&&(nt[dn]!==nt[0]||nt[dn+1]!==nt[1])&&hr(nt,nt[0],nt[1],nt[2]),nt.length&&ee.push(nt)}function $r(Xe){const ee=[];return ee.size=Xe.size,ee.start=Xe.start,ee.end=Xe.end,ee}function lr(Xe,ee,se,we,Fe,Ie){for(const Pe of Xe)ir(Pe,ee,se,we,Fe,Ie,!1)}function hr(Xe,ee,se,we){Xe.push(ee,se,we)}function uo(Xe,ee,se,we,Fe,Ie){const Pe=(Ie-ee)/(we-ee);return hr(Xe,Ie,se+(Fe-se)*Pe,1),Pe}function oo(Xe,ee,se,we,Fe,Ie){const Pe=(Ie-se)/(Fe-se);return hr(Xe,ee+(we-ee)*Pe,Ie,1),Pe}function ho(Xe,ee){const se=[];for(let we=0;we<Xe.length;we++){const Fe=Xe[we],Ie=Fe.type;let Pe;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")Pe=Co(Fe.geometry,ee);else if(Ie==="MultiLineString"||Ie==="Polygon"){Pe=[];for(const nt of Fe.geometry)Pe.push(Co(nt,ee))}else if(Ie==="MultiPolygon"){Pe=[];for(const nt of Fe.geometry){const Ge=[];for(const at of nt)Ge.push(Co(at,ee));Pe.push(Ge)}}se.push(Gn(Fe.id,Ie,Pe,Fe.tags))}return se}function Co(Xe,ee){const se=[];se.size=Xe.size,Xe.start!==void 0&&(se.start=Xe.start,se.end=Xe.end);for(let we=0;we<Xe.length;we+=3)se.push(Xe[we]+ee,Xe[we+1],Xe[we+2]);return se}function us(Xe,ee){if(Xe.transformed)return Xe;const se=1<<Xe.z,we=Xe.x,Fe=Xe.y;for(const Ie of Xe.features){const Pe=Ie.geometry,nt=Ie.type;if(Ie.geometry=[],nt===1)for(let Ge=0;Ge<Pe.length;Ge+=2)Ie.geometry.push(rr(Pe[Ge],Pe[Ge+1],ee,se,we,Fe));else for(let Ge=0;Ge<Pe.length;Ge++){const at=[];for(let Bt=0;Bt<Pe[Ge].length;Bt+=2)at.push(rr(Pe[Ge][Bt],Pe[Ge][Bt+1],ee,se,we,Fe));Ie.geometry.push(at)}}return Xe.transformed=!0,Xe}function rr(Xe,ee,se,we,Fe,Ie){return[Math.round(se*(Xe*we-Fe)),Math.round(se*(ee*we-Ie))]}function ar(Xe,ee,se,we,Fe){const Ie=ee===Fe.maxZoom?0:Fe.tolerance/((1<<ee)*Fe.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:Xe.length,source:null,x:se,y:we,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const nt of Xe)Zo(Pe,nt,Ie,Fe);return Pe}function Zo(Xe,ee,se,we){const Fe=ee.geometry,Ie=ee.type,Pe=[];if(Xe.minX=Math.min(Xe.minX,ee.minX),Xe.minY=Math.min(Xe.minY,ee.minY),Xe.maxX=Math.max(Xe.maxX,ee.maxX),Xe.maxY=Math.max(Xe.maxY,ee.maxY),Ie==="Point"||Ie==="MultiPoint")for(let nt=0;nt<Fe.length;nt+=3)Pe.push(Fe[nt],Fe[nt+1]),Xe.numPoints++,Xe.numSimplified++;else if(Ie==="LineString")to(Pe,Fe,Xe,se,!1,!1);else if(Ie==="MultiLineString"||Ie==="Polygon")for(let nt=0;nt<Fe.length;nt++)to(Pe,Fe[nt],Xe,se,Ie==="Polygon",nt===0);else if(Ie==="MultiPolygon")for(let nt=0;nt<Fe.length;nt++){const Ge=Fe[nt];for(let at=0;at<Ge.length;at++)to(Pe,Ge[at],Xe,se,!0,at===0)}if(Pe.length){let nt=ee.tags||null;if(Ie==="LineString"&&we.lineMetrics){nt={};for(const at in ee.tags)nt[at]=ee.tags[at];nt.mapbox_clip_start=Fe.start/Fe.size,nt.mapbox_clip_end=Fe.end/Fe.size}const Ge={geometry:Pe,type:Ie==="Polygon"||Ie==="MultiPolygon"?3:Ie==="LineString"||Ie==="MultiLineString"?2:1,tags:nt};ee.id!==null&&(Ge.id=ee.id),Xe.features.push(Ge)}}function to(Xe,ee,se,we,Fe,Ie){const Pe=we*we;if(we>0&&ee.size<(Fe?Pe:we))return void(se.numPoints+=ee.length/3);const nt=[];for(let Ge=0;Ge<ee.length;Ge+=3)(we===0||ee[Ge+2]>Pe)&&(se.numSimplified++,nt.push(ee[Ge],ee[Ge+1])),se.numPoints++;Fe&&(function(Ge,at){let Bt=0;for(let At=0,dn=Ge.length,An=dn-2;At<dn;An=At,At+=2)Bt+=(Ge[At]-Ge[An])*(Ge[At+1]+Ge[An+1]);if(Bt>0===at)for(let At=0,dn=Ge.length;At<dn/2;At+=2){const An=Ge[At],Nn=Ge[At+1];Ge[At]=Ge[dn-2-At],Ge[At+1]=Ge[dn-1-At],Ge[dn-2-At]=An,Ge[dn-1-At]=Nn}})(nt,Ie),Xe.push(nt)}const qr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Xo{constructor(ee,se){const we=(se=this.options=(function(Ie,Pe){for(const nt in Pe)Ie[nt]=Pe[nt];return Ie})(Object.create(qr),se)).debug;if(we&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");let Fe=(function(Ie,Pe){const nt=[];if(Ie.type==="FeatureCollection")for(let Ge=0;Ge<Ie.features.length;Ge++)ti(nt,Ie.features[Ge],Pe,Ge);else ti(nt,Ie.type==="Feature"?Ie:{geometry:Ie},Pe);return nt})(ee,se);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Fe=(function(Ie,Pe){const nt=Pe.buffer/Pe.extent;let Ge=Ie;const at=zi(Ie,1,-1-nt,nt,0,-1,2,Pe),Bt=zi(Ie,1,1-nt,2+nt,0,-1,2,Pe);return(at||Bt)&&(Ge=zi(Ie,1,-nt,1+nt,0,-1,2,Pe)||[],at&&(Ge=ho(at,1).concat(Ge)),Bt&&(Ge=Ge.concat(ho(Bt,-1)))),Ge})(Fe,se),Fe.length&&this.splitTile(Fe,0,0,0),we&&(Fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,se,we,Fe,Ie,Pe,nt){const Ge=[ee,se,we,Fe],at=this.options,Bt=at.debug;for(;Ge.length;){Fe=Ge.pop(),we=Ge.pop(),se=Ge.pop(),ee=Ge.pop();const At=1<<se,dn=Uo(se,we,Fe);let An=this.tiles[dn];if(!An&&(Bt>1&&console.time("creation"),An=this.tiles[dn]=ar(ee,se,we,Fe,at),this.tileCoords.push({z:se,x:we,y:Fe}),Bt)){Bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,we,Fe,An.numFeatures,An.numPoints,An.numSimplified),console.timeEnd("creation"));const Ci=`z${se}`;this.stats[Ci]=(this.stats[Ci]||0)+1,this.total++}if(An.source=ee,Ie==null){if(se===at.indexMaxZoom||An.numPoints<=at.indexMaxPoints)continue}else{if(se===at.maxZoom||se===Ie)continue;if(Ie!=null){const Ci=Ie-se;if(we!==Pe>>Ci||Fe!==nt>>Ci)continue}}if(An.source=null,ee.length===0)continue;Bt>1&&console.time("clipping");const Nn=.5*at.buffer/at.extent,hi=.5-Nn,kn=.5+Nn,Qn=1+Nn;let Mi=null,oi=null,Ui=null,Er=null,so=zi(ee,At,we-Nn,we+kn,0,An.minX,An.maxX,at),tr=zi(ee,At,we+hi,we+Qn,0,An.minX,An.maxX,at);ee=null,so&&(Mi=zi(so,At,Fe-Nn,Fe+kn,1,An.minY,An.maxY,at),oi=zi(so,At,Fe+hi,Fe+Qn,1,An.minY,An.maxY,at),so=null),tr&&(Ui=zi(tr,At,Fe-Nn,Fe+kn,1,An.minY,An.maxY,at),Er=zi(tr,At,Fe+hi,Fe+Qn,1,An.minY,An.maxY,at),tr=null),Bt>1&&console.timeEnd("clipping"),Ge.push(Mi||[],se+1,2*we,2*Fe),Ge.push(oi||[],se+1,2*we,2*Fe+1),Ge.push(Ui||[],se+1,2*we+1,2*Fe),Ge.push(Er||[],se+1,2*we+1,2*Fe+1)}}getTile(ee,se,we){ee=+ee,se=+se,we=+we;const Fe=this.options,{extent:Ie,debug:Pe}=Fe;if(ee<0||ee>24)return null;const nt=1<<ee,Ge=Uo(ee,se=se+nt&nt-1,we);if(this.tiles[Ge])return us(this.tiles[Ge],Ie);Pe>1&&console.log("drilling down to z%d-%d-%d",ee,se,we);let at,Bt=ee,At=se,dn=we;for(;!at&&Bt>0;)Bt--,At>>=1,dn>>=1,at=this.tiles[Uo(Bt,At,dn)];return at&&at.source?(Pe>1&&(console.log("found parent tile z%d-%d-%d",Bt,At,dn),console.time("drilling down")),this.splitTile(at.source,Bt,At,dn,ee,se,we),Pe>1&&console.timeEnd("drilling down"),this.tiles[Ge]?us(this.tiles[Ge],Ie):null):null}}function Uo(Xe,ee,se){return 32*((1<<Xe)*se+ee)+Xe}function Po(Xe,ee){const se=Xe.tileID.canonical;if(!this._geoJSONIndex)return void ee(null,null);const we=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!we)return void ee(null,null);const Fe=at=>at.tags&&"3d_elevation_id"in at.tags&&"source"in at.tags&&at.tags.source==="elevation",Ie=we.features.filter((at=>Fe(at)));let Pe={_geojsonTileLayer:we.features};Ie.length>0&&(Pe={_geojsonTileLayer:we.features.filter((at=>!Fe(at))),hd_road_elevation:Ie});const nt=new _e(Pe),Ge=(function(at){const Bt=new r.bt;for(const At of Object.keys(at))Bt.writeMessage(3,qe,{name:At,features:at[At]});return Bt.finish()})(Pe).buffer;ee(null,{vectorTile:nt,rawData:Ge})}class Mt extends K{constructor(ee,se,we,Fe,Ie,Pe,nt){super(ee,se,we,Fe,Ie,Po,nt),Pe&&(this.loadGeoJSON=Pe),this._dynamicIndex=new xe}loadData(ee,se){const we=ee&&ee.request,Fe=we&&we.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ee,((Ie,Pe)=>{if(Ie||!Pe)return se(Ie);if(typeof Pe!="object")return se(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{try{if(ee.filter){const Ge=r.U(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map((at=>`${at.key}: ${at.message}`)).join(", "));Pe.features=Pe.features.filter((at=>Ge.value.evaluate({zoom:0},at)))}ee.dynamic?(Pe.type==="Feature"&&(Pe={type:"FeatureCollection",features:[Pe]}),ee.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Pe.features,this.loaded),ee.cluster&&(Pe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ee.cluster?new Rt((function({superclusterOptions:Ge,clusterProperties:at}){if(!at||!Ge)return Ge;const Bt={},At={},dn={accumulated:null,zoom:0},An={properties:null},Nn=Object.keys(at);for(const hi of Nn){const[kn,Qn]=at[hi],Mi=r.U(Qn),oi=r.U(typeof kn=="string"?[kn,["accumulated"],["get",hi]]:kn);Bt[hi]=Mi.value,At[hi]=oi.value}return Ge.map=hi=>{An.properties=hi;const kn={};for(const Qn of Nn)kn[Qn]=Bt[Qn].evaluate(dn,An);return kn},Ge.reduce=(hi,kn)=>{An.properties=kn;for(const Qn of Nn)dn.accumulated=hi[Qn],hi[Qn]=At[Qn].evaluate(dn,An)},Ge})(ee)).load(Pe.features):ee.dynamic?this._dynamicIndex:(function(Ge,at){return new Xo(Ge,at)})(Pe,ee.geojsonVtOptions)}catch(Ge){return se(Ge)}const nt={};if(Fe){const Ge=I(we);Ge&&(nt.resourceTiming={},nt.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Ge)))}se(null,nt)}}))}reloadTile(ee,se){const we=this.loaded;return we&&we[ee.uid]?ee.partial?se(null,void 0):super.reloadTile(ee,se):this.loadTile(ee,se)}loadGeoJSON(ee,se){if(ee.request)r.m(ee.request,se);else{if(typeof ee.data!="string")return se(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return se(null,JSON.parse(ee.data))}catch{return se(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(ee,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(we){se(we)}}getClusterChildren(ee,se){try{se(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(we){se(we)}}getClusterLeaves(ee,se){try{se(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(we){se(we)}}}class fo{constructor(ee,se,we){this.tileID=new r.aO(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ee.projection,this.brightness=se,this.worldview=we}parse(ee,se,we,Fe){this.status="parsing";const Ie=new r.aO(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),Pe=[],nt=se.familiesBySource[we.source],Ge=new r.fe(Ie,we.promoteId);Ge.bucketLayerIDs=[],Ge.is3DTile=!0,r.ft(ee).then((at=>{if(!at)return Fe(new Error("Could not parse tile"));const Bt=at.json.extensionsUsed&&at.json.extensionsUsed.includes("MAPBOX_mesh_features")||at.json.asset.extras&&at.json.asset.extras.MAPBOX_mesh_features,At=at.json.extensionsUsed&&at.json.extensionsUsed.includes("EXT_meshopt_compression"),dn=new r.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const An in nt)for(const Nn of nt[An]){const hi=Nn[0];Ge.bucketLayerIDs.push(Nn.map((Mi=>r.B(Mi.id,Mi.scope)))),hi.recalculate(dn,[]);const kn=r.fu(at,1/r.d6(we.tileID.canonical)),Qn=new r.fv(Nn,kn,Ie,Bt,At,this.brightness,Ge,this.worldview);Bt||(Qn.needsUpload=!0),Pe.push(Qn),Qn.evaluate(hi)}this.status="done",Fe(null,{buckets:Pe,featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((at=>Fe(new Error(at.message))))}}class Yo{constructor(ee,se,we,Fe,Ie,Pe,nt,Ge){this.actor=ee,this.layerIndex=se,this.availableImages=we,this.availableModels=Fe,this.brightness=nt,this.loading={},this.loaded={},this.worldview=Ge}loadTile(ee,se){const we=ee.uid,Fe=this.loading[we]=new fo(ee,this.brightness,this.worldview);r.bu(ee.request,((Ie,Pe)=>{const nt=!this.loading[we];return delete this.loading[we],nt||Ie?(Fe.status="done",nt||(this.loaded[we]=Fe),se(Ie)):Pe&&Pe.byteLength!==0?void Fe.parse(Pe,this.layerIndex,ee,((Ge,at)=>{Fe.status="done",this.loaded=this.loaded||{},this.loaded[we]=Fe,Ge||!at?se(Ge):se(null,at)})):(Fe.status="done",this.loaded[we]=Fe,se())}))}reloadTile(ee,se){const we=this.loaded,Fe=ee.uid;if(we&&we[Fe]){const Ie=we[Fe];Ie.projection=ee.projection,Ie.brightness=ee.brightness;const Pe=(nt,Ge)=>{Ie.reloadCallback&&(delete Ie.reloadCallback,this.loadTile(ee,se)),se(nt,Ge)};Ie.status==="parsing"?Ie.reloadCallback=Pe:Ie.status==="done"&&this.loadTile(ee,se)}}abortTile(ee,se){const we=ee.uid;this.loading[we]&&delete this.loading[we],se()}removeTile(ee,se){const we=this.loaded,Fe=ee.uid;we&&we[Fe]&&delete we[Fe],se()}}class jo{constructor(ee){this.self=ee,this.actor=new r.fx(ee,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.cl({name:"mercator"}),this.workerSourceTypes={vector:K,geojson:Mt,"raster-dem":Y,"raster-array":oe,"batched-model":Yo},this.workerSources={},this.self.registerWorkerSource=(se,we)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=we},this.self.registerRTLTextPlugin=se=>{if(r.fy.isParsed())throw new Error("RTL text plugin already registered.");r.fy.setState({pluginStatus:r.fz.parsed,pluginURL:r.fy.getPluginURL()}),r.fy.applyArabicShaping=se.applyArabicShaping,r.fy.processBidirectionalText=se.processBidirectionalText,r.fy.processStyledBidirectionalText=se.processStyledBidirectionalText;for(const we of this.rtlPluginParsingListeners)we(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ee,se,we){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.availableModels[ee],delete this.workerSources[ee],we()}checkIfReady(ee,se,we){we()}setReferrer(ee,se){this.referrer=se}spriteLoaded(ee,se){this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={});const{scope:we,isLoaded:Fe}=se;if(this.isSpriteLoaded[ee][we]=Fe,this.workerSources[ee]&&this.workerSources[ee][we])for(const Ie in this.workerSources[ee][we]){const Pe=this.workerSources[ee][we][Ie];for(const nt in Pe){const Ge=Pe[nt];Ge instanceof K&&(Ge.isSpriteLoaded=Fe,Ge.fire(new r.z("isSpriteLoaded")))}}}setImages(ee,se,we){this.availableImages[ee]||(this.availableImages[ee]={});const{scope:Fe,images:Ie}=se;if(this.availableImages[ee][Fe]=Ie,this.workerSources[ee]&&this.workerSources[ee][Fe]){for(const Pe in this.workerSources[ee][Fe]){const nt=this.workerSources[ee][Fe][Pe];for(const Ge in nt)nt[Ge].availableImages=Ie}we()}else we()}setModels(ee,{scope:se,models:we},Fe){if(this.availableModels[ee]||(this.availableModels[ee]={}),this.availableModels[ee][se]=we,this.workerSources[ee]&&this.workerSources[ee][se]){for(const Ie in this.workerSources[ee][se]){const Pe=this.workerSources[ee][se][Ie];for(const nt in Pe)Pe[nt].availableModels=we}Fe()}else Fe()}setProjection(ee,se){this.projections[ee]=r.cl(se)}setBrightness(ee,se,we){this.brightness=se,we()}setWorldview(ee,se,we){this.worldview=se,we()}setLayers(ee,se,we){this.getLayerIndex(ee,se.scope).replace(se.layers,se.options),we()}updateLayers(ee,se,we){this.getLayerIndex(ee,se.scope).update(se.layers,se.removedIds,se.options),we()}loadTile(ee,se,we){se.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,se.type,se.source,se.scope).loadTile(se,we)}decodeRasterArray(ee,se,we){this.getWorkerSource(ee,se.type,se.source,se.scope).decodeRasterArray(se,we)}reloadTile(ee,se,we){se.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,se.type,se.source,se.scope).reloadTile(se,we)}abortTile(ee,se,we){this.getWorkerSource(ee,se.type,se.source,se.scope).abortTile(se,we)}removeTile(ee,se,we){this.getWorkerSource(ee,se.type,se.source,se.scope).removeTile(se,we)}removeSource(ee,se,we){if(!(this.workerSources[ee]&&this.workerSources[ee][se.scope]&&this.workerSources[ee][se.scope][se.type]&&this.workerSources[ee][se.scope][se.type][se.source]))return;const Fe=this.workerSources[ee][se.scope][se.type][se.source];delete this.workerSources[ee][se.scope][se.type][se.source],Fe.removeSource!==void 0?Fe.removeSource(se,we):we()}loadWorkerSource(ee,se,we){try{this.self.importScripts(se.url),we()}catch(Fe){we(Fe.toString())}}syncRTLPluginState(ee,se,we){if(r.fy.isParsed())we(null,!0);else if(r.fy.isParsing())this.rtlPluginParsingListeners.push(we);else try{r.fy.setState(se);const Fe=r.fy.getPluginURL();!r.fy.isLoaded()||r.fy.isParsed()||r.fy.isParsing()||Fe==null||(r.fy.setState({pluginStatus:r.fz.parsing,pluginURL:r.fy.getPluginURL()}),this.self.importScripts(Fe),r.fy.isParsed()?we(null,!0):this.rtlPluginParsingListeners.push(we))}catch(Fe){we(Fe.toString())}}setDracoUrl(ee,se){this.dracoUrl=se}getAvailableImages(ee,se){this.availableImages[ee]||(this.availableImages[ee]={});let we=this.availableImages[ee][se];return we||(we=[]),we}getAvailableModels(ee,se){this.availableModels[ee]||(this.availableModels[ee]={});let we=this.availableModels[ee][se];return we||(we={}),we}getLayerIndex(ee,se){this.layerIndexes[ee]||(this.layerIndexes[ee]={});let we=this.layerIndexes[ee][se];return we||(we=this.layerIndexes[ee][se]=new R,we.scope=se),we}getWorkerSource(ee,se,we,Fe){const Ie=this.workerSources;return Ie[ee]||(Ie[ee]={}),Ie[ee][Fe]||(Ie[ee][Fe]={}),Ie[ee][Fe][se]||(Ie[ee][Fe][se]={}),this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),Ie[ee][Fe][se][we]||(Ie[ee][Fe][se][we]=new this.workerSourceTypes[se]({send:(Pe,nt,Ge,at,Bt,At)=>this.actor.send(Pe,nt,Ge,ee,Bt,At),scheduler:this.actor.scheduler},this.getLayerIndex(ee,Fe),this.getAvailableImages(ee,Fe),this.getAvailableModels(ee,Fe),this.isSpriteLoaded[ee][Fe],void 0,this.brightness,this.worldview)),Ie[ee][Fe][se][we]}rasterizeImagesWorker(ee,se,we){const Fe=new Map;for(const[Ie,{image:Pe,imageVariant:nt}]of se.tasks.entries()){const Ge=this.imageRasterizer.rasterize(nt,Pe,se.scope,ee);Fe.set(Ie,Ge)}we(void 0,Fe)}removeRasterizedImages(ee,se,we){this.imageRasterizer.removeImagesFromCacheByIds(se.imageIds,se.scope,ee),we()}enforceCacheSizeLimit(ee,se){r.fA(se)}getWorkerPerformanceMetrics(ee,se,we){we(void 0,void 0)}}return r.fw(self)&&(self.worker=new jo(self)),jo})),x(["./shared"],(function(r){var I="3.15.0";const k={create:"create",load:"load",fullLoad:"fullLoad"},P={mark(d){performance.mark(d)},measure(d,t,a){performance.measure(d,t,a)}};function R(d){const t=d.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var F,V={},W=(function(){if(F)return V;function d(h){return!t(h)}function t(h){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,S=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(S);try{b=new Worker(M),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(M),y})()?(function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var S=b.getImageData(0,0,1,1);return S&&S.width===y.width})()?(a[g=h&&h.failIfMajorPerformanceCaveat]===void 0&&(a[g]=(function(y){var b,S=(function(M){var D=document.createElement("canvas"),O=Object.create(d.webGLContextAttributes);return O.failIfMajorPerformanceCaveat=M,D.getContext("webgl2",O)})(y);if(!S)return!1;try{b=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!b||S.isContextLost())&&(S.shaderSource(b,"void main() {}"),S.compileShader(b),S.getShaderParameter(b,S.COMPILE_STATUS)===!0)})(g)),a[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}F=1,V.supported=d,V.notSupportedReason=t;var a={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},V})();function G(d,t,a){const h=document.createElement(d);return t!=null&&(h.className=t),a&&a.appendChild(h),h}function K(d,t,a){const h=document.createElementNS("http://www.w3.org/2000/svg",d);for(const g of Object.keys(t))h.setAttributeNS(null,g,String(t[g]));return a&&a.appendChild(h),h}const Y=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ne=Y&&Y.userSelect!==void 0?"userSelect":"WebkitUserSelect";let oe;function ce(){Y&&ne&&(oe=Y[ne],Y[ne]="none")}function me(){Y&&ne&&(Y[ne]=oe)}function ue(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",ue,!0)}function _e(){window.addEventListener("click",ue,!0),window.setTimeout((()=>{window.removeEventListener("click",ue,!0)}),0)}function te(d,t){const a=d.getBoundingClientRect();return de(d,a,t)}function ie(d,t){const a=d.getBoundingClientRect(),h=[];for(let g=0;g<t.length;g++)h.push(de(d,a,t[g]));return h}function xe(d){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&d.button===2&&d.ctrlKey?0:d.button}function de(d,t,a){const h=d.offsetWidth===t.width?1:d.offsetWidth/t.width;return new r.P((a.clientX-t.left)*h,(a.clientY-t.top)*h)}const Te="01",De="NO_ACCESS_TOKEN";class Be{constructor(t,a,h){this._transformRequestFn=t,this._customAccessToken=a,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){const t=(function(){let a="";for(let h=0;h<10;h++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Te,a].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeStyleURL(t,a){if(!r.h(t))return t;const h=Ne(t);return h.params.push(`sdk=js-${I}`),h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||a)}normalizeGlyphsURL(t,a){if(!r.h(t))return t;const h=Ne(t);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||a)}normalizeModelURL(t,a){if(!r.h(t))return t;const h=Ne(t);return h.path=`/models/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||a)}normalizeSourceURL(t,a,h,g){if(!r.h(t))return t;const y=Ne(t);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),h&&y.params.push(`language=${h}`),g&&y.params.push(`worldview=${g}`),this._makeAPIURL(y,this._customAccessToken||a)}normalizeIconsetURL(t,a){const h=Ne(t);return r.h(t)?(h.path=`/styles/v1${h.path}/iconset.pbf`,this._makeAPIURL(h,this._customAccessToken||a)):it(h)}normalizeSpriteURL(t,a,h,g){const y=Ne(t);return r.h(t)?(y.path=`/styles/v1${y.path}/sprite${a}${h}`,this._makeAPIURL(y,this._customAccessToken||g)):(y.path+=`${a}${h}`,it(y))}normalizeTileURL(t,a,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.h(t))return t;const g=Ne(t);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||h&&g.authority!=="raster"&&h===512?"@2x":""}${r.k.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${r.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${r.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${r.e.TILE_URL_VERSION}${g.path}`);const y=this._customAccessToken||(function(b){for(const S of b){const M=S.match(/^access_token=(.*)$/);if(M)return M[1]}return null})(g.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,y)}canonicalizeTileURL(t,a){const h=Ne(t);if(!h.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!h.path.match(/\.[\w]+$/))return t;let g="mapbox://";h.path.match(/^\/raster\/v1\//)?g+=`raster/${h.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:h.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${h.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${h.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let y=h.params;return a&&(y=y.filter((b=>!b.match(/^access_token=/)))),y.length&&(g+=`?${y.join("&")}`),g}canonicalizeTileset(t,a){const h=!!a&&r.h(a),g=[];for(const y of t.tiles||[])r.j(y)?g.push(this.canonicalizeTileURL(y,h)):g.push(y);return g}_makeAPIURL(t,a){const h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=Ne(r.e.API_URL);if(t.protocol=g.protocol,t.authority=g.authority,t.protocol==="http"){const y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(g.path!=="/"&&(t.path=`${g.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return it(t);if(a=a||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return t.params=t.params.filter((y=>y.indexOf("access_token")===-1)),t.params.push(`access_token=${a||""}`),it(t)}}const Se=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ne(d){const t=d.match(Se);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function it(d){const t=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${t}`}const qe="mapbox.eventData";function ft(d){if(!d)return null;const t=d.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.l(t[1]))}catch{return null}}class St{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const a=ft(r.e.ACCESS_TOKEN);let h="";return h=a&&a.u?r.f(a.u):r.e.ACCESS_TOKEN||"",t?`${qe}.${t}:${h}`:`${qe}:${h}`}fetchEventData(){const t=r.s("localStorage"),a=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{const g=localStorage.getItem(a);g&&(this.eventData=JSON.parse(g));const y=localStorage.getItem(h);y&&(this.anonId=y)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const t=r.s("localStorage"),a=this.getStorageKey(),h=this.getStorageKey("uuid"),g=this.anonId;if(t&&g)try{localStorage.setItem(h,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,a,h,g){if(!r.e.EVENTS_URL)return;const y=Ne(r.e.EVENTS_URL);y.params.push(`access_token=${g||r.e.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(t).toISOString()},S=a?Object.assign(b,a):b,M={url:it(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=r.p(M,(D=>{this.pendingRequest=null,h(D),this.saveEventData(),this.processRequests(g)}))}queueRequest(t,a){this.queue.push(t),this.processRequests(a)}}const Dt=new class extends St{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some((a=>r.h(a)||r.j(a)))&&this.queueRequest(Date.now(),t)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=ft(r.e.ACCESS_TOKEN),a=t?t.u:r.e.ACCESS_TOKEN;let h=a!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),h=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),b=new Date(g),S=(g-this.eventData.lastSuccess)/864e5;h=h||S>=1||S<-1||y.getDate()!==b.getDate()}else h=!0;h?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:Te,"enabled.telemetry":!1,userId:this.anonId},(y=>{y||(this.eventData.lastSuccess=g,this.eventData.tokenU=a)}),d):this.processRequests()}},Kt=Dt.postTurnstileEvent.bind(Dt),et=new class extends St{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,t,a,h){this.skuToken=t,this.errorCb=h,r.e.EVENTS_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(De)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:Te,skuToken:this.skuToken,userId:this.anonId},(h=>{h?this.errorCb(h):t&&(this.success[t]=!0)}),d))}remove(){this.errorCb=null}},Qe=et.postMapLoadEvent.bind(et),st=new class extends St{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let t=this.mapInstanceIdMap.get(d);return t||(t=r.u(),this.mapInstanceIdMap.set(d,t)),t}getEventId(d){const t=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,t+1),t}postStyleLoadEvent(d,t){const{map:a,style:h,importedStyles:g}=t;if(!r.e.EVENTS_URL||!d&&!r.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(a),b={mapInstanceId:y,eventId:this.getEventId(y),style:h};g.length&&(b.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:b},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:a}=this.queue.shift();this.postEvent(t,a,(()=>{}),d)}},tt=st.postStyleLoadEvent.bind(st),gt=new class extends St{constructor(){super("gljs.performance")}postPerformanceEvent(d,t){r.e.EVENTS_URL&&(d||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:a}=this.queue.shift(),h=(function(g){const y=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),S=(function(q){const H={};if(q){for(const Z in q)if(Z!=="other")for(const re of q[Z]){const $=`${Z}ResolveRangeMin`,ae=`${Z}ResolveRangeMax`,pe=`${Z}RequestCount`,ye=`${Z}RequestCachedCount`;H[$]=Math.min(H[$]||1/0,re.startTime),H[ae]=Math.max(H[ae]||-1/0,re.responseEnd);const Ce=Ae=>{H[Ae]===void 0&&(H[Ae]=0),++H[Ae]};re.transferSize!==void 0&&re.transferSize===0&&Ce(ye),Ce(pe)}}return H})((function(q,H){const Z={};if(q)for(const re of q){const $=H(re);Z[$]===void 0&&(Z[$]=[]),Z[$].push(re)}return Z})(y,R)),M=window.devicePixelRatio,D=navigator.connection||navigator.mozConnection||navigator.webkitConnection,O=D?D.effectiveType:void 0,j={counters:[],metadata:[],attributes:[]},B=(q,H,Z)=>{Z!=null&&q.push({name:H,value:Z.toString()})};for(const q in S)B(j.counters,q,S[q]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(B(j.counters,"interactionRangeMin",g.interactionRange[0]),B(j.counters,"interactionRangeMax",g.interactionRange[1])),b)for(const q of Object.keys(k)){const H=k[q],Z=b.find((re=>re.name===H));Z&&B(j.counters,H,Z.startTime)}return B(j.counters,"visibilityHidden",g.visibilityHidden),B(j.attributes,"style",(function(q){if(q)for(const H of q){const Z=H.name.split("?")[0];if(r.i(Z)){const re=Z.split("/").slice(-2);if(re.length===2)return`mapbox://styles/${re[0]}/${re[1]}`}}})(y)),B(j.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),B(j.attributes,"fogEnabled",g.fogEnabled?"true":"false"),B(j.attributes,"projection",g.projection),B(j.attributes,"zoom",g.zoom),B(j.metadata,"devicePixelRatio",M),B(j.metadata,"connectionEffectiveType",O),B(j.metadata,"navigatorUserAgent",navigator.userAgent),B(j.metadata,"screenWidth",window.screen.width),B(j.metadata,"screenHeight",window.screen.height),B(j.metadata,"windowWidth",window.innerWidth),B(j.metadata,"windowHeight",window.innerHeight),B(j.metadata,"mapWidth",g.width/M),B(j.metadata,"mapHeight",g.height/M),B(j.metadata,"webglRenderer",g.renderer),B(j.metadata,"webglVendor",g.vendor),B(j.metadata,"sdkVersion",I),B(j.metadata,"sdkIdentifier","mapbox-gl-js"),j})(a);for(const g of h.metadata);for(const g of h.counters);for(const g of h.attributes);this.postEvent(t,h,(()=>{}),d)}},Lt=gt.postPerformanceEvent.bind(gt),_t=new class extends St{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,t,a,h){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const g=Ne(r.e.API_URL+r.e.SESSION_PATH);g.params.push(`sku=${t||""}`),g.params.push(`access_token=${h||r.e.ACCESS_TOKEN||""}`);const y={url:it(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(y,(b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(h)}))}getSessionAPI(d,t,a,h){this.skuToken=t,this.errorCb=h,r.e.SESSION_PATH&&r.e.API_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(De)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||this.getSession(a,this.skuToken,(h=>{h?this.errorCb(h):t&&(this.success[t]=!0)}),d)}remove(){this.errorCb=null}},Je=_t.getSessionAPI.bind(_t),Rt=new Set;function ut(d,t){t?Rt.add(d):Rt.delete(d)}class cn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,a){this._updatedSourceCaches[t]=a,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const a=t.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(t.id),this.setDirty()}removeLayer(t){const a=t.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][t.id]=t,this._updatedLayers[a].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const a in this._updatedLayers)t[a]=t[a]||{},t[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)t[a]=t[a]||{},t[a].removedIds=Object.keys(this._removedLayers[a]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(r.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function on(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class Jt extends r.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.r()&&(this.imageRasterizerDispatcher=new r.D(r.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new r.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const a=this.atlasTexture.get(t);a&&(a.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(t.id,t)}removeImageProvider(t,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(t)}getPendingImageProviders(){const t=[];for(const a of this.imageProviders.values())for(const h of a.values())h.hasPendingRequests()&&t.push(h);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,a){if(this.loaded.get(a)!==t&&(this.loaded.set(a,t),t)){for(const{ids:h,callback:g}of this.requestors)this._notify(h,a,g);this.requestors=[]}}hasImage(t,a){return!!this.getImage(t,a)}getImage(t,a){return this.images.get(a).get(t.toString())}addImage(t,a,h){this._validate(t,h)&&this.images.get(a).set(t.toString(),h)}_validate(t,a){let h=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),h=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),h=!1),this._validateContent(a.content,a)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "content" value`))),h=!1),h}_validateStretch(t,a){if(!t)return!0;let h=0;for(const g of t){if(g[0]<h||g[1]<g[0]||a<g[1])return!1;h=g[1]}return!0}_validateContent(t,a){return t?t.length!==4||!a.usvg&&(t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,a,h){const g=this.images.get(a).get(t.toString());h.version=g.version+1,this.images.get(a).set(t.toString(),h),this.updatedImages.get(a).add(t),this.removeFromImageRasterizerCache(t,a)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,a){this.spriteFormat!=="raster"&&(r.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([t],a))}removeImage(t,a){const h=this.images.get(a),g=h.get(t.toString());h.delete(t.toString()),this.patterns.get(a).delete(t.toString()),this.removeFromImageRasterizerCache(t,a),g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((a=>r.I.from(a)))}getImages(t,a,h){const g=[],y=[],b=this.imageProviders.get(a);for(const O of t){if(!O.iconsetId){g.push(O);continue}const j=b.get(O.iconsetId);j&&(this.getImage(O,a)?y.push(O):j.addPendingRequest(O))}if(g.length===0)return void this._notify(y,a,h);let S=!0;const M=!!this.loaded.get(a),D=this.images.get(a);if(!M)for(const O of g)D.has(O.toString())||(S=!1);M||S?this._notify(g,a,h):this.requestors.push({ids:g,scope:a,callback:h})}rasterizeImages(t,a){const h=new Map,{tasks:g,scope:y}=t;for(const[b,S]of g.entries()){const M=this.getImage(S.id,y);M&&h.set(b,{image:M,imageVariant:S})}this._rasterizeImages(y,h,a)}_rasterizeImages(t,a,h){if(r.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:t},h);else{const g=new Map;for(const[y,{image:b,imageVariant:S}]of a.entries())g.set(y,this.imageRasterizer.rasterize(S,b,t,0));h(void 0,g)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,a,h){const g=this.images.get(a),y=new Map;for(const b of t){if(!g.get(b.toString())){if(b.iconsetId)continue;this.fire(new r.z("styleimagemissing",{id:b.name}))}const S=g.get(b.toString());if(!S){r.w(`Image "${b.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const M={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)};S.usvg&&Object.assign(M,{width:S.icon.usvg_tree.width,height:S.icon.usvg_tree.height}),y.set(r.I.toString(b),M)}h(null,y)}getPixelSize(t){const{width:a,height:h}=this.atlasImage.get(t);return{width:a,height:h}}getPattern(t,a,h){const g=t.toString(),y=this.patterns.get(a),b=y.get(g),S=this.getImage(t,a);if(!S)return null;if(b){if(b.position.version===S.version)return b.position;b.position.version=S.version}else{if(S.usvg&&!S.data){const M=this.getPatternInFlightId(g,a);if(this.patternsInFlight.has(M))return null;this.patternsInFlight.add(M);const D=new r.A(t).scaleSelf(r.o.devicePixelRatio),O=new Map([[D.toString(),{image:S,imageVariant:D}]]);return this._rasterizeImages(a,O,((j,B)=>this.storePatternImage(D,a,S,h,B))),null}this.storePattern(t,a,S)}return this._updatePatternAtlas(a,h),y.get(g).position}getPatternInFlightId(t,a){return r.B(t,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,a,h,g,y){const b=t.toString(),S=y?y.get(b):void 0;S&&(h.data=S,this.storePattern(t.id,a,h),this._updatePatternAtlas(a,g),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),a)))}storePattern(t,a,h){const g={w:h.data.width+2*r.C,h:h.data.height+2*r.C,x:0,y:0},y=new r.F(g,h,r.C);this.patterns.get(a).set(t.toString(),{bin:g,position:y})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,a){const h=t.gl;let g=this.atlasTexture.get(a);g?this.dirty&&(g.update(this.atlasImage.get(a)),this.dirty=!1):(g=new r.T(t,this.atlasImage.get(a),h.RGBA8),this.atlasTexture.set(a,g)),g.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(t,a){const h=this.patterns.get(t),g=Array.from(h.values()).map((({bin:D})=>D)),{w:y,h:b}=r.G(g),S=this.atlasImage.get(t);S.resize({width:y||1,height:b||1});const M=this.images.get(t);for(const[D,{bin:O,position:j}]of h.entries()){let B=j.padding;const q=O.x+B,H=O.y+B,Z=M.get(D).data,re=Z.width,$=Z.height;B=B>1?B-1:B,r.q.copy(Z,S,{x:0,y:0},{x:q,y:H},{width:re,height:$},a),r.q.copy(Z,S,{x:0,y:$-B},{x:q,y:H-B},{width:re,height:B},a),r.q.copy(Z,S,{x:0,y:0},{x:q,y:H+$},{width:re,height:B},a),r.q.copy(Z,S,{x:re-B,y:0},{x:q-B,y:H},{width:B,height:$},a),r.q.copy(Z,S,{x:0,y:0},{x:q+re,y:H},{width:B,height:$},a),r.q.copy(Z,S,{x:re-B,y:$-B},{x:q-B,y:H-B},{width:B,height:B},a),r.q.copy(Z,S,{x:0,y:$-B},{x:q+re,y:H-B},{width:B,height:B},a),r.q.copy(Z,S,{x:0,y:0},{x:q+re,y:H+$},{width:B,height:B},a),r.q.copy(Z,S,{x:re-B,y:0},{x:q-B,y:H+$},{width:B,height:B},a)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,a){const h=this.images.get(a);for(const g of t){if(this.callbackDispatchedThisFrame.get(a).has(g.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(g.toString());const y=h.get(g.toString());on(y)&&this.updateImage(g,a,y)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function vt(d){const t=d.value,a=d.valueSpec,h=d.style,g=d.styleSpec,y=d.key,b=d.arrayElementValidator||rr;if(!Array.isArray(t))return[new r.V(y,t,`array expected, ${r.K(t)} found`)];if(a.length&&t.length!==a.length)return[new r.V(y,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new r.V(y,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let S={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};g.$version<7&&(S.function=a.function),r.H(a.value)&&(S=a.value);let M=[];for(let D=0;D<t.length;D++)M=M.concat(b({array:t,arrayIndex:D,value:t[D],valueSpec:S,style:h,styleSpec:g,key:`${y}[${D}]`},!0));return M}function zt(d){const t=d.key,a=d.value,h=d.valueSpec;if(!r.L(a))return[new r.V(t,a,`number expected, ${r.K(a)} found`)];if(a!=a)return[new r.V(t,a,"number expected, NaN found")];if("minimum"in h){let g=h.minimum;if(Array.isArray(h.minimum)&&(g=h.minimum[d.arrayIndex]),a<g)return[new r.V(t,a,`${a} is less than the minimum value ${g}`)]}if("maximum"in h){let g=h.maximum;if(Array.isArray(h.maximum)&&(g=h.maximum[d.arrayIndex]),a>g)return[new r.V(t,a,`${a} is greater than the maximum value ${g}`)]}return[]}function fn(d){const t=d.key,a=d.value;if(!r.H(a))return[new r.V(t,a,`object expected, ${r.K(a)} found`)];const h=d.valueSpec,g=r.J(a.type);let y,b,S,M={};const D=g!=="categorical"&&a.property===void 0,O=!D,j=(function(Z){const re=Z.stops;return Array.isArray(re)&&Array.isArray(re[0])&&r.H(re[0][0])})(a),B=ar({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(Z){if(g==="identity")return[new r.V(Z.key,Z.value,'identity function may not have a "stops" property')];let re=[];const $=Z.value;return re=re.concat(vt({key:Z.key,value:$,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:q})),Array.isArray($)&&$.length===0&&re.push(new r.V(Z.key,$,"array must have at least one stop")),re},default:function(Z){return rr({key:Z.key,value:Z.value,valueSpec:h,style:Z.style,styleSpec:Z.styleSpec})}}});return g==="identity"&&D&&B.push(new r.V(d.key,d.value,'missing required property "property"')),g==="identity"||a.stops||B.push(new r.V(d.key,d.value,'missing required property "stops"')),g==="exponential"&&h.expression&&!r.M(h)&&B.push(new r.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(O&&!r.N(h)?B.push(new r.V(d.key,d.value,"property functions not supported")):D&&!r.O(h)&&B.push(new r.V(d.key,d.value,"zoom functions not supported"))),g!=="categorical"&&!j||a.property!==void 0||B.push(new r.V(d.key,d.value,'"property" property is required')),B;function q(Z){let re=[];const $=Z.value,ae=Z.key;if(!Array.isArray($))return[new r.V(ae,$,`array expected, ${r.K($)} found`)];if($.length!==2)return[new r.V(ae,$,`array length 2 expected, length ${$.length} found`)];if(j){if(!r.H($[0]))return[new r.V(ae,$,`object expected, ${r.K($[0])} found`)];const pe=$[0];if(pe.zoom===void 0)return[new r.V(ae,$,"object stop key must have zoom")];if(pe.value===void 0)return[new r.V(ae,$,"object stop key must have value")];const ye=r.J(pe.zoom);if(typeof ye!="number")return[new r.V(ae,pe.zoom,"stop zoom values must be numbers")];if(S&&S>ye)return[new r.V(ae,pe.zoom,"stop zoom values must appear in ascending order")];ye!==S&&(S=ye,b=void 0,M={}),re=re.concat(ar({key:`${ae}[0]`,value:$[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:zt,value:H}}))}else re=re.concat(H({key:`${ae}[0]`,value:$[0],style:Z.style,styleSpec:Z.styleSpec},$));return r.Q(r.S($[1]))?re.concat([new r.V(`${ae}[1]`,$[1],"expressions are not allowed in function stops.")]):re.concat(rr({key:`${ae}[1]`,value:$[1],valueSpec:h,style:Z.style,styleSpec:Z.styleSpec}))}function H(Z,re){const $=r.K(Z.value),ae=r.J(Z.value),pe=Z.value!==null?Z.value:re;if(y){if($!==y)return[new r.V(Z.key,pe,`${$} stop domain type must match previous stop domain type ${y}`)]}else y=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof ae!="number"&&typeof ae!="string"&&typeof ae!="boolean")return[new r.V(Z.key,pe,"stop domain value must be a number, string, or boolean")];if($!=="number"&&g!=="categorical"){let ye=`number expected, ${$} found`;return r.N(h)&&g===void 0&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(Z.key,pe,ye)]}return g!=="categorical"||$!=="number"||typeof ae=="number"&&isFinite(ae)&&Math.floor(ae)===ae?g!=="categorical"&&$==="number"&&typeof ae=="number"&&typeof b=="number"&&b!==void 0&&ae<b?[new r.V(Z.key,pe,"stop domain values must appear in ascending order")]:(b=ae,g==="categorical"&&ae in M?[new r.V(Z.key,pe,"stop domain values must be unique")]:(M[ae]=!0,[])):[new r.V(Z.key,pe,`integer expected, found ${String(ae)}`)]}}function Gn(d){const t=(d.expressionContext==="property"?r.W:r.U)(r.S(d.value),d.valueSpec);if(t.result==="error")return t.value.map((h=>new r.V(`${d.key}${h.key}`,d.value,h.message)));const a=t.value.expression||t.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!a.outputDefined())return[new r.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!r.Z(a))return[new r.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Wn(a,d);if(d.expressionContext==="appearance")return ti(a,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!r.X(a,["zoom","feature-state"]))return[new r.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!r.Y(a))return[new r.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wn(d,t){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const g of t.valueSpec.expression.parameters)a.delete(g);if(a.size===0)return[];const h=[];return d instanceof r._&&a.has(d.name)?[new r.V(t.key,t.value,`["${d.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(d.eachChild((g=>{h.push(...Wn(g,t))})),h)}function ti(d,t){const a=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const g of t.valueSpec.expression.parameters)a.add(g);if(a.size===0)return[];const h=[];return d instanceof r._&&!a.has(d.name)?[new r.V(t.key,t.value,`["${d.name}"] is not an allowed parameter`)]:(d.eachChild((g=>{h.push(...ti(g,t))})),h)}function yi(d){const t=d.key,a=d.value,h=d.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(r.J(a))===-1&&g.push(new r.V(t,a,`expected one of [${h.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(h.values).indexOf(r.J(a))===-1&&g.push(new r.V(t,a,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function Ri(d){return r.a2(r.S(d.value))?Gn(Object.assign({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):ur(d)}function ur(d){const t=d.value,a=d.key;if(!Array.isArray(t))return[new r.V(a,t,`array expected, ${r.K(t)} found`)];if(t.length<1)return[new r.V(a,t,"filter array must have at least 1 element")];const h=d.styleSpec;let g=yi({key:`${a}[0]`,value:t[0],valueSpec:h.filter_operator});switch(r.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.J(t[1])==="$type"&&g.push(new r.V(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new r.V(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r.a0(t[1])||g.push(new r.V(`${a}[1]`,t[1],`string expected, ${r.K(t[1])} found`)));for(let y=2;y<t.length;y++)r.J(t[1])==="$type"?g=g.concat(yi({key:`${a}[${y}]`,value:t[y],valueSpec:h.geometry_type})):r.a0(t[y])||r.L(t[y])||r.$(t[y])||g.push(new r.V(`${a}[${y}]`,t[y],`string, number, or boolean expected, ${r.K(t[y])} found.`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)g=g.concat(ur({key:`${a}[${y}]`,value:t[y],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":t.length!==2?g.push(new r.V(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):r.a0(t[1])||g.push(new r.V(`${a}[1]`,t[1],`string expected, ${r.K(t[1])} found`))}return g}function wi(d,t){const a=d.key,h=d.style,g=d.layer,y=d.styleSpec,b=d.value,S=d.objectKey,M=y[`${t}_${d.layerType}`];if(!M)return[];const D=S.match(/^(.*)-use-theme$/);if(D&&M[D[1]])return r.Q(b)?[].concat(rr({key:d.key,value:b,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:h,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:S})):rr({key:a,value:b,valueSpec:{type:"string"},style:h,styleSpec:y});const O=S.match(/^(.*)-transition$/);if(t==="paint"&&O&&M[O[1]]&&M[O[1]].transition)return rr({key:a,value:b,valueSpec:y.transition,style:h,styleSpec:y});const j=d.valueSpec||M[S];if(!j)return[new r.a3(a,b,`unknown property "${S}"`)];let B;if(r.a0(b)&&r.N(j)&&!j.tokens&&(B=/^{([^}]+)}$/.exec(b))){const H=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new r.V(a,b,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${H}.`)]}const q=[];if(d.layerType==="symbol")S!=="text-field"||!h||h.glyphs||h.imports||q.push(new r.V(a,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&r.a4(r.S(b))&&r.J(b.type)==="identity"&&q.push(new r.V(a,b,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&t==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&r.N(j)&&(r.a5(j)||r.O(j))){const H=r.W(r.S(b),j),Z=H.value.expression||H.value._styleExpression.expression;Z&&!r.X(Z,["measure-light"])&&(S==="model-emissive-strength"&&r.Y(Z)&&r.Z(Z)||q.push(new r.V(a,b,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(rr({key:d.key,value:b,valueSpec:j,style:h,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:S}))}function Oi(d){return wi(d,"paint")}function zi(d){return wi(d,"layout")}function qi(d){let t=[];const a=d.value,h=d.key,g=d.style,y=d.styleSpec;if(!r.H(a))return[new r.V(h,a,"object expected")];a.type||a.ref||t.push(new r.V(h,a,'either "type" or "ref" is required'));let b=r.J(a.type);const S=r.J(a.ref);if(a.id){const M=r.J(a.id);for(let D=0;D<d.arrayIndex;D++){const O=g.layers[D];r.J(O.id)===M&&t.push(new r.V(h,a.id,`duplicate layer id "${M}", previously used at line ${O.id.__line__}`))}}if("ref"in a){let M;["type","source","source-layer","filter","layout"].forEach((D=>{D in a&&t.push(new r.V(h,a[D],`"${D}" is prohibited for ref layers`))})),g.layers.forEach((D=>{r.J(D.id)===S&&(M=D)})),M?M.ref?t.push(new r.V(h,a.ref,"ref cannot reference another ref layer")):b=r.J(M.type):typeof S=="string"&&t.push(new r.V(h,a.ref,`ref layer "${S}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(a.source)if(r.a0(a.source)){const M=g.sources&&g.sources[a.source],D=M&&r.J(M.type);M?D==="vector"&&b==="raster"?t.push(new r.V(h,a.source,`layer "${a.id}" requires a raster source`)):D==="raster"&&b!=="raster"?t.push(new r.V(h,a.source,`layer "${a.id}" requires a vector source`)):D!=="vector"||a["source-layer"]?D==="raster-dem"&&b!=="hillshade"?t.push(new r.V(h,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(b)?b==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&D==="geojson"&&!M.lineMetrics?t.push(new r.V(h,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):b==="raster-particle"&&D!=="raster-array"&&t.push(new r.V(h,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):t.push(new r.V(h,a.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(h,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new r.V(h,a.source,`source "${a.source}" not found`))}else t.push(new r.V(`${h}.source`,a.source,'"source" must be a string'));else t.push(new r.V(h,a,'missing required property "source"'));return t=t.concat(ar({key:h,value:a,valueSpec:y.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>rr({key:`${h}.type`,value:a.type,valueSpec:y.layer.type,style:d.style,styleSpec:d.styleSpec,object:a,objectKey:"type"}),filter:M=>Ri(Object.assign({layerType:b},M)),layout:M=>ar({layer:a,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":D=>zi(Object.assign({layerType:b},D))}}),paint:M=>ar({layer:a,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":D=>Oi(Object.assign({layerType:b,layer:a},D))}}),appearances(M){const D=vt({key:M.key,value:M.value,valueSpec:M.valueSpec,style:M.style,styleSpec:M.styleSpec,arrayElementValidator:B=>(function(q){const{key:H,layer:Z,layerType:re}=q,$=r.J(q.value),ae=r.J($.name),pe=r.J($.condition),ye=ar({key:H,value:$,valueSpec:q.styleSpec.appearance,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{condition:Ce=>(function(Ae){const ke=[];return ke.push(...Gn({key:Ae.key,value:Ae.object.condition,valueSpec:r.a6.appearance.condition,expressionContext:"appearance"})),ke})(Object.assign({layer:Z,layerType:re},Ce)),properties:Ce=>(function(Ae){const ke=[],{styleSpec:Me,layer:Ee,layerType:ze}=Ae,ot=Me[`paint_${ze}`],Ze=Me[`layout_${ze}`],mt=Ae.object[Ae.objectKey];for(const $e in mt){const pt=$e in ot?"paint":$e in Ze?"layout":void 0;if(!pt){ke.push(new r.V(Ae.key,$e,`unknown property "${$e}" for layer type "${ze}"`));continue}const Ht=Object.assign({},Ae,{key:`${Ae.key}.${$e}`,object:mt,objectKey:$e,layer:Ee,layerType:ze,value:mt[$e],valueSpec:pt==="paint"?ot[$e]:Ze[$e]});ke.push(...wi(Ht,pt))}return ke})(Object.assign({layer:Z,layerType:re},Ce))}});return ae==="hidden"||pe||ye.push(new r.V(q.key,"name",'Appearance with name different than "hidden" must have a condition')),ye})(Object.assign({layerType:b,layer:a},B))}),O=Array.isArray(M.value)?M.value:[],j=new Set;return O.forEach(((B,q)=>{const H=r.J(B.name);if(H)if(j.has(H)){const Z=r.J(a.id);D.push(new r.V(M.key,H,`Duplicated appearance name "${H}" for layer "${Z}"`))}else j.add(H)})),D}}})),t}function ir({key:d,value:t}){return r.a0(t)?[]:[new r.V(d,t,`string expected, ${r.K(t)} found`)]}const $r={promoteId:function d({key:t,value:a}){if(r.a0(a))return ir({key:t,value:a});if(Array.isArray(a)){const g=[],y=r.S(a),b=r.U(y);return b.result==="error"&&b.value.forEach((S=>{g.push(new r.V(`${t}${S.key}`,null,`${S.message}`))})),r.X(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||g.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),g}if(!r.H(a))return[new r.V(t,a,`string, expression or object expected, "${r.K(a)}" found`)];const h=[];for(const g in a)h.push(...d({key:`${t}.${g}`,value:a[g]}));return h}};function lr(d){const t=d.value,a=d.key,h=d.styleSpec,g=d.style;if(!r.H(t))return[new r.V(a,t,`object expected, ${r.K(t)} found`)];if(!("type"in t))return[new r.V(a,t,'"type" is required')];const y=r.J(t.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&("url"in t||"tiles"in t||b.push(new r.a3(a,t,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(ar({key:a,value:t,valueSpec:h[`source_${y.replace("-","_")}`],style:d.style,styleSpec:h,objectElementValidators:$r})),b;case"geojson":if(b=ar({key:a,value:t,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:$r}),"cluster"in t&&"clusterProperties"in t){if(!r.H(t.clusterProperties))return[new r.V(`${a}.clusterProperties`,t,`object expected, ${r.K(t)} found`)];for(const S in t.clusterProperties){const M=t.clusterProperties[S];if(!Array.isArray(M))return[new r.V(`${a}.clusterProperties.${S}`,M,"array expected")];const[D,O]=M,j=typeof D=="string"?[D,["accumulated"],["get",S]]:D;b.push(...Gn({key:`${a}.${S}.map`,value:O,expressionContext:"cluster-map"})),b.push(...Gn({key:`${a}.${S}.reduce`,value:j,expressionContext:"cluster-reduce"}))}}return b;case"video":return ar({key:a,value:t,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return ar({key:a,value:t,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new r.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yi({key:`${a}.type`,value:t.type,valueSpec:{values:hr(h)}})}}function hr(d){return d.source.reduce(((t,a)=>{const h=d[a];return h.type.type==="enum"&&(t=t.concat(Object.keys(h.type.values))),t}),[])}function uo(d){const t=d.value,a=d.styleSpec,h=a.light,g=d.style;if(t===void 0)return[];if(!r.H(t))return[new r.V("light",t,`object expected, ${r.K(t)} found`)];let y=[];for(const b in t){const S=b.match(/^(.*)-transition$/),M=b.match(/^(.*)-use-theme$/);y=y.concat(M&&h[M[1]]?rr({key:b,value:t[b],valueSpec:{type:"string"},style:g,styleSpec:a}):S&&h[S[1]]&&h[S[1]].transition?rr({key:b,value:t[b],valueSpec:a.transition,style:g,styleSpec:a}):h[b]?rr({key:b,value:t[b],valueSpec:h[b],style:g,styleSpec:a}):[new r.V(b,t[b],`unknown property "${b}"`)])}return y}function oo(d){const t=d.value;if(!t)return[];const a=d.key;if(!r.H(t))return[new r.V(a,t,`object expected, ${r.K(t)} found`)];let h=[];const g=d.styleSpec,y=g["light-3d"],b=d.style,S=d.style.lights;for(const O of["type","id"])if(!(O in t))return h=h.concat([new r.V(a,t,`missing property "${O}"`)]),h;if(!r.a0(t.type))return h=h.concat([new r.V(`${a}.type`,t.type,"string expected")]),h;if(S)for(let O=0;O<d.arrayIndex;O++){const j=r.J(t.type),B=S[O];r.J(B.type)===j&&h.push(new r.V(a,t.id,`duplicate light type "${t.type}", previously defined at line ${B.id.__line__}`))}const M=`properties_light_${t.type}`;if(!(M in g))return h=h.concat([new r.V(`${a}.type`,t,`Invalid light type ${t.type}`)]),h;const D=g[M];for(const O in t)if(O==="properties"){const j=t[O];if(!r.H(j))return h=h.concat([new r.V("properties",j,`object expected, ${r.K(j)} found`)]),h;for(const B in j){const q=B.match(/^(.*)-transition$/),H=B.match(/^(.*)-use-theme$/);h=h.concat(H&&D[H[1]]?rr({key:O,value:j[B],valueSpec:{type:"string"},style:b,styleSpec:g}):q&&D[q[1]]&&D[q[1]].transition?rr({key:O,value:t[O],valueSpec:g.transition,style:b,styleSpec:g}):D[B]?rr({key:B,value:j[B],valueSpec:D[B],style:b,styleSpec:g}):[new r.a3(d.key,j[B],`unknown property "${B}"`)])}}else h=h.concat(y[O]?rr({key:O,value:t[O],valueSpec:y[O],style:b,styleSpec:g}):[new r.a3(O,t[O],`unknown property "${O}"`)]);return h}function ho(d){const t=d.value,a=d.key,h=d.style,g=d.styleSpec,y=g.terrain;if(t==null)return[];if(!r.H(t))return[new r.V("terrain",t,`object expected, ${r.K(t)} found`)];let b=[];for(const S in t){const M=S.match(/^(.*)-transition$/),D=S.match(/^(.*)-use-theme$/);b=b.concat(D&&y[D[1]]?rr({key:S,value:t[S],valueSpec:{type:"string"},style:h,styleSpec:g}):M&&y[M[1]]&&y[M[1]].transition?rr({key:S,value:t[S],valueSpec:g.transition,style:h,styleSpec:g}):y[S]?rr({key:S,value:t[S],valueSpec:y[S],style:h,styleSpec:g}):[new r.a3(S,t[S],`unknown property "${S}"`)])}if(t.source)if(r.a0(t.source)){const S=h.sources&&h.sources[t.source],M=S&&r.J(S.type);S?M!=="raster-dem"&&b.push(new r.V(`${a}.source`,t.source,`terrain cannot be used with a source of type ${M}, it only be used with a "raster-dem" source type`)):b.push(new r.V(`${a}.source`,t.source,`source "${t.source}" not found`))}else b.push(new r.V(`${a}.source`,t.source,"source must be a string"));else b.push(new r.V(a,t,'terrain is missing required property "source"'));return b}function Co(d){const t=d.value,a=d.style,h=d.styleSpec,g=h.fog;if(t===void 0)return[];if(!r.H(t))return[new r.V("fog",t,`object expected, ${r.K(t)} found`)];let y=[];for(const b in t){const S=b.match(/^(.*)-transition$/),M=b.match(/^(.*)-use-theme$/);y=y.concat(M&&g[M[1]]?rr({key:b,value:t[b],valueSpec:{type:"string"},style:a,styleSpec:h}):S&&g[S[1]]&&g[S[1]].transition?rr({key:b,value:t[b],valueSpec:h.transition,style:a,styleSpec:h}):g[b]?rr({key:b,value:t[b],valueSpec:g[b],style:a,styleSpec:h}):[new r.a3(b,t[b],`unknown property "${b}"`)])}return y}const us={"*":()=>[],array:vt,boolean:function(d){const t=d.value,a=d.key;return r.$(t)?[]:[new r.V(a,t,`boolean expected, ${r.K(t)} found`)]},number:zt,color:function({key:d,value:t}){return r.a0(t)?r.a1.parseCSSColor(t)===null?[new r.V(d,t,`color expected, "${t}" found`)]:[]:[new r.V(d,t,`color expected, ${r.K(t)} found`)]},enum:yi,filter:Ri,function:fn,layer:qi,object:ar,source:lr,model:r.a7,light:uo,"light-3d":oo,terrain:ho,fog:Co,string:ir,formatted:function(d){return ir(d).length===0?[]:Gn(d)},resolvedImage:function(d){return ir(d).length===0?[]:Gn(d)},projection:function(d){const t=d.value,a=d.styleSpec,h=a.projection,g=d.style;if(r.H(t)){let y=[];for(const b in t)y=y.concat(rr({key:b,value:t[b],valueSpec:h[b],style:g,styleSpec:a}));return y}return r.a0(t)?[]:[new r.V("projection",t,`object or string expected, ${r.K(t)} found`)]},import:function(d){const t=d.key,{value:a,styleSpec:h}=d;if(!r.H(a))return[new r.V(t,a,"import must be an object")];const{data:g,...y}=a;Object.defineProperty(y,"__line__",{value:a.__line__,enumerable:!1});let b=ar(Object.assign({},d,{value:y,valueSpec:h.import}));return r.J(y.id)===""&&b.push(new r.V(`${d.key}.id`,y,"import id can't be an empty string")),g&&(b=b.concat(to(g,h,{key:`${d.key}.data`}))),b},iconset:function(d){const t=d.value,a=d.key,h=d.styleSpec,g=d.style;if(!r.H(t))return[new r.V(a,t,"object expected")];if(!t.type)return[new r.V(a,t,'"type" is required')];const y=r.J(t.type);let b=[];if(b=b.concat(ar({key:a,value:t,valueSpec:h[`iconset_${y}`],style:g,styleSpec:h})),(function(S,M){return!(S!=="source"||!M.source)})(y,t)){const S=g.sources&&g.sources[t.source],M=S&&r.J(S.type);S?M!=="raster-array"&&b.push(new r.V(a,t.source,`iconset cannot be used with a source of type ${String(M)}, it only be used with a "raster-array" source type`)):b.push(new r.V(a,t.source,`source "${t.source}" not found`))}return b}};function rr(d,t=!1){const a=d.value,h=d.valueSpec,g=d.styleSpec;if(h.expression){if(r.a4(r.J(a)))return fn(d);if(r.Q(r.S(a)))return Gn(d)}if(h.type&&us[h.type]){const y=us[h.type](d);return t===!0&&y.length>0&&Array.isArray(d.value)?Gn(d):y}return ar(Object.assign({},d,{valueSpec:h.type?g[h.type]:h}))}function ar(d){const t=d.key,a=d.value,h=d.valueSpec||{},g=d.objectElementValidators||{},y=d.style,b=d.styleSpec;if(!r.H(a))return[new r.V(t,a,`object expected, ${r.K(a)} found`)];let S=[];for(const M in a){const D=M.split(".")[0];let O;g[D]?O=g[D]:h[D]?O=rr:g["*"]?O=g["*"]:h["*"]&&(O=rr),O?S=S.concat(O({key:(t&&`${t}.`)+M,value:a[M],valueSpec:h[D]||h["*"],style:y,styleSpec:b,object:a,objectKey:M},a)):S.push(new r.a3(t,a[M],`unknown property "${M}"`))}for(const M in h)g[M]||h[M].required&&h[M].default===void 0&&a[M]===void 0&&S.push(new r.V(t,a,`missing required property "${M}"`));return S}function Zo({key:d,value:t}){const a=ir({key:d,value:t});if(a.length)return a;const h=t;return h.indexOf("{fontstack}")===-1&&a.push(new r.V(d,t,'"glyphs" url must include a "{fontstack}" token')),h.indexOf("{range}")===-1&&a.push(new r.V(d,t,'"glyphs" url must include a "{range}" token')),a}function to(d,t=r.a6,a={}){return ar({key:a.key||"",value:d,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:d,objectElementValidators:{glyphs:Zo}})}function qr(d,t=r.a6){return Ie(to(d,t))}const Xo=d=>Ie(lr(d)),Uo=d=>Ie(uo(d)),Po=d=>Ie(oo(d)),Mt=d=>Ie(ho(d)),fo=d=>Ie(Co(d)),Yo=d=>Ie((function(t){const a=t.value,h=t.style,g=t.styleSpec,y=g.snow;if(a===void 0)return[];if(!r.H(a))return[new r.V("snow",a,`object expected, ${r.K(a)} found`)];let b=[];for(const S in a){const M=S.match(/^(.*)-transition$/);b=b.concat(M&&y[M[1]]&&y[M[1]].transition?rr({key:S,value:a[S],valueSpec:g.transition,style:h,styleSpec:g}):y[S]?rr({key:S,value:a[S],valueSpec:y[S],style:h,styleSpec:g}):[new r.a3(S,a[S],`unknown property "${S}"`)])}return b})(d)),jo=d=>Ie((function(t){const a=t.value,h=t.style,g=t.styleSpec,y=g.rain;if(a===void 0)return[];if(!r.H(a))return[new r.V("rain",a,`object expected, ${r.K(a)} found`)];let b=[];for(const S in a){const M=S.match(/^(.*)-transition$/);b=b.concat(M&&y[M[1]]&&y[M[1]].transition?rr({key:S,value:a[S],valueSpec:g.transition,style:h,styleSpec:g}):y[S]?rr({key:S,value:a[S],valueSpec:y[S],style:h,styleSpec:g}):[new r.a3(S,a[S],`unknown property "${S}"`)])}return b})(d)),Xe=d=>Ie(qi(d)),ee=d=>Ie(Ri(d)),se=d=>Ie(Oi(d)),we=d=>Ie(zi(d)),Fe=d=>Ie(r.a7(d));function Ie(d){return d.slice().sort(((t,a)=>t.line&&a.line?t.line-a.line:0))}function Pe(d,t){let a=!1;if(t&&t.length)for(const h of t)h instanceof r.a3?r.w(h.message):(d.fire(new r.y(new Error(h.message))),a=!0);return a}let nt;class Ge extends r.E{constructor(t,a="flat"){super(),this._transitionable=new r.a8(nt||(nt=new r.a9({anchor:new r.aa(r.a6.light.anchor),position:new r.ab(r.a6.light.position),color:new r.aa(r.a6.light.color),intensity:new r.aa(r.a6.light.intensity)}))),this.setLight(t,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a,h={}){this._validate(Uo,t,h)||(this._transitionable.setTransitionOrValue(t),this.id=a)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,h){return(!h||h.validate!==!1)&&Pe(this,t.call(qr,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let at=class extends r.E{constructor(d,t,a,h,g){super(),this.scope=a,this._transitionable=new r.a8(new r.a9({source:new r.aa(r.a6.terrain.source),exaggeration:new r.aa(r.a6.terrain.exaggeration)}),a,h),this._transitionable.setTransitionOrValue(d,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=g}get(){return this._transitionable.serialize()}set(d,t){this._transitionable.setTransitionOrValue(d,t)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new r.ac(d,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const t=d.value.expression;if(!t)return null;let a=-1,h=-1,g=1;for(const y of t.zoomStops)g=t.evaluate(new r.ac(y,{worldview:this.worldview})),g>.01?(a=y,h=-1):h=y;return g<.01&&a>0&&h>a?[a,h]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof r.ad}};const Bt=45,At=65,dn=.05;function An(d,t,a,h){const g=r.ah(Bt,At,a),[y,b]=Nn(d,h);let S=1-Math.min(1,Math.exp((t-y)/(b-y)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*g*d.alpha}function Nn(d,t){const a=.5/Math.tan(.5*t);return[d.range[0]+a,d.range[1]+a]}function hi(d,t,a,h,g){const y=r.af([],[t,a,h],g.mercatorFogMatrix);return An(d,r.ag(y),g.pitch,g._fov)}function kn(d,t,a,h,g,y,b){const S=[[a,h,0],[g,h,0],[g,y,0],[a,y,0]];let M=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const O of S){const j=r.af([],O,t),B=r.ag(j);M=Math.min(M,B),D=Math.max(D,B)}return[An(d,M,b.pitch,b._fov),An(d,D,b.pitch,b._fov)]}class Qn extends r.E{constructor(t,a,h,g){super();const y=new r.a9({range:new r.aa(r.a6.fog.range),color:new r.aa(r.a6.fog.color),"color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.aa(r.a6.fog["high-color"]),"high-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.aa(r.a6.fog["space-color"]),"space-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.aa(r.a6.fog["horizon-blend"]),"star-intensity":new r.aa(r.a6.fog["star-intensity"]),"vertical-range":new r.aa(r.a6.fog["vertical-range"])});this._transitionable=new r.a8(y,h,new Map(g)),this.set(t,g),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new r.ai(y),this.scope=h}get state(){const t=this._transform,a=t.projection.name==="globe",h=r.aj(t.zoom),g=this.properties.get("range"),y=[.5,3];return{range:a?[r.ak(y[0],g[0],h),r.ak(y[1],g[1],h)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a,h={}){if(this._validate(fo,t,h))return;const g=Object.assign({},t);for(const y of Object.keys(r.a6.fog))g[y]===void 0&&(g[y]=r.a6.fog[y].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ah(Bt,At,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?(function(h,g,y){const b=r.ae.fromLngLat(g),S=y.elevation?y.elevation.getAtPointOrZero(b):0;return hi(h,b.x,b.y,S,y)})(this.state,t,a):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(t.toUnwrapped());return kn(this.state,a,0,0,r.al,r.al,this._transform)}getOpacityForBounds(t,a,h,g,y){return this._transform.projection.supportsFog?kn(this.state,t,a,h,g,y,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Nn(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const h of a){const g=t.points[h];let y;if(g[2]>=0)y=g;else{const b=t.points[h-4];y=r.am(b,g,b[2]/(b[2]-g[2]))}if(hi(this.state,y[0],y[1],0,this._transform)>=dn)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,h){return(!h||h.validate!==!1)&&Pe(this,t.call(qr,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let Mi,oi,Ui,Er,so=class extends r.E{constructor(d,t,a,h){super();const g=Mi||(Mi=new r.a9({density:new r.aa(r.a6.snow.density),intensity:new r.aa(r.a6.snow.intensity),color:new r.aa(r.a6.snow.color),opacity:new r.aa(r.a6.snow.opacity),vignette:new r.aa(r.a6.snow.vignette),"vignette-color":new r.aa(r.a6.snow["vignette-color"]),"center-thinning":new r.aa(r.a6.snow["center-thinning"]),direction:new r.aa(r.a6.snow.direction),"flake-size":new r.aa(r.a6.snow["flake-size"])}));this._transitionable=new r.a8(g,a,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(g),this.scope=a}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),h=r.an(a[0]),g=-Math.max(r.an(a[1]),.01),y=[Math.cos(h)*Math.cos(g),Math.sin(h)*Math.cos(g),Math.sin(g)],b=this.properties.get("vignette"),S=this.properties.get("vignette-color");return S.a=b,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(t.r,t.g,t.b,t.a*d),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(d,t,a={}){if(this._validate(Yo,d,a))return;const h=Object.assign({},d);for(const g of Object.keys(r.a6.snow))h[g]===void 0&&(h[g]=r.a6.snow[g].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,a){return(!a||a.validate!==!1)&&Pe(this,d.call(qr,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}},tr=class extends r.E{constructor(d,t,a,h){super();const g=oi||(oi=new r.a9({density:new r.aa(r.a6.rain.density),intensity:new r.aa(r.a6.rain.intensity),color:new r.aa(r.a6.rain.color),opacity:new r.aa(r.a6.rain.opacity),vignette:new r.aa(r.a6.rain.vignette),"vignette-color":new r.aa(r.a6.rain["vignette-color"]),"center-thinning":new r.aa(r.a6.rain["center-thinning"]),direction:new r.aa(r.a6.rain.direction),"droplet-size":new r.aa(r.a6.rain["droplet-size"]),"distortion-strength":new r.aa(r.a6.rain["distortion-strength"])}));this._transitionable=new r.a8(g,a,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(g),this.scope=a}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),h=r.an(a[0]),g=-Math.max(r.an(a[1]),.01),y=[Math.cos(h)*Math.cos(g),Math.sin(h)*Math.cos(g),Math.sin(g)],b=this.properties.get("vignette-color");return b.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(t.r,t.g,t.b,t.a*d),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(d,t,a={}){if(this._validate(jo,d,a))return;const h=Object.assign({},d);for(const g of Object.keys(r.a6.rain))h[g]===void 0&&(h[g]=r.a6.rain[g].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,a){return(!a||a.validate!==!1)&&Pe(this,d.call(qr,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}};class Ci extends r.E{constructor(t,a,h,g){super(),this.scope=h,this._options=t,this.properties=new r.ai(a),this._transitionable=new r.a8(a,h,new Map(g)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,a){this._options=t,this._transitionable.setTransitionOrValue(t.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Vr{constructor(t,a,h){this.screenBounds=t,this.cameraPoint=h.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,h)}static createFromScreenPoints(t,a){let h,g;if(t instanceof r.P||typeof t[0]=="number"){const y=r.P.convert(t);h=[y],g=a.isPointAboveHorizon(y)}else{const y=r.P.convert(t[0]),b=r.P.convert(t[1]),S=y.add(b)._div(2);h=[y,b],g=r.aq(y,b).every((M=>a.isPointAboveHorizon(M)))&&a.isPointAboveHorizon(S)}return new Vr(h,g,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],g=r.aq(a,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<h.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),r.ar(g,t)}bufferedCameraGeometryGlobe(t){const a=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],g=r.aq(a,h,t),y=this.cameraPoint.clone();switch(3*((y.y>a.y)+(y.y>h.y))+((y.x>a.x)+(y.x>h.x))){case 0:g[0]=y,g[4]=y.clone();break;case 1:g.splice(1,0,y);break;case 2:g[1]=y;break;case 3:g.splice(4,0,y);break;case 5:g.splice(2,0,y);break;case 6:g[3]=y;break;case 7:g.splice(3,0,y);break;case 8:g[2]=y}return g}containsTile(t,a,h,g=0){const y=t.queryPadding/a._pixelsPerMercatorPixel+1,b=h?this._bufferedCameraMercator(y,a):this._bufferedScreenMercator(y,a);let S=t.tileID.wrap+(b.unwrapped?g:0);const M=b.polygon.map((re=>r.as(t.tileTransform,re,S)));if(!r.at(M,0,0,r.al,r.al))return;S=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const D=this.screenGeometryMercator.polygon.map((re=>r.au(t.tileTransform,re,S))),O=D.map((re=>new r.P(re[0],re[1]))),j=a.getFreeCameraOptions().position||new r.ae(0,0,0),B=r.au(t.tileTransform,j,S),q=D.map((re=>{const $=r.av(re,re,B);return r.aw($,$),new r.ax(B,$)})),H=r.ay(t,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:q,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(Z=r.az(M),Z.min.x=r.aA(Z.min.x,0,r.al),Z.min.y=r.aA(Z.min.y,0,r.al),Z.max.x=r.aA(Z.max.x,0,r.al),Z.max.y=r.aA(Z.max.y,0,r.al),Z),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:H};var Z}_bufferedScreenMercator(t,a){const h=So(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map((y=>a.pointCoordinate3D(y))),unwrapped:!0},this._screenRaycastCache[h]=g,g}}_bufferedCameraMercator(t,a){const h=So(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map((y=>a.pointCoordinate3D(y))),unwrapped:!0},this._cameraRaycastCache[h]=g,g}}_projectAndResample(t,a){const h=(function(y,b){const S=r.aB([],b.pixelMatrix,b.globeMatrix),M=[0,-r.aD,0,1],D=[0,r.aD,0,1],O=[0,0,0,1];r.aC(M,M,S),r.aC(D,D,S),r.aC(O,O,S);const j=new r.P(M[0]/M[3],M[1]/M[3]),B=new r.P(D[0]/D[3],D[1]/D[3]),q=r.aE(y,j)&&M[3]<O[3],H=r.aE(y,B)&&D[3]<O[3];if(!q&&!H)return null;const Z=(function(ke,Me,Ee){for(let ze=1;ze<ke.length;ze++){const ot=mr(Me.pointCoordinate3D(ke[ze-1]).x),Ze=mr(Me.pointCoordinate3D(ke[ze]).x);if(Ee<0){if(ot<Ze)return{idx:ze,t:-ot/(Ze-1-ot)}}else if(Ze<ot)return{idx:ze,t:(1-ot)/(Ze+1-ot)}}return null})(y,b,q?-1:1);if(!Z)return null;const{idx:re,t:$}=Z;let ae=re>1?zr(y.slice(0,re),b):[],pe=re<y.length?zr(y.slice(re),b):[];ae=ae.map((ke=>new r.P(mr(ke.x),ke.y))),pe=pe.map((ke=>new r.P(mr(ke.x),ke.y)));const ye=[...ae];ye.length===0&&ye.push(pe[pe.length-1]);const Ce=r.ak(ye[ye.length-1].y,(pe.length===0?ae[0]:pe[0]).y,$);let Ae;return Ae=q?[new r.P(0,Ce),new r.P(0,0),new r.P(1,0),new r.P(1,Ce)]:[new r.P(1,Ce),new r.P(1,1),new r.P(0,1),new r.P(0,Ce)],ye.push(...Ae),pe.length===0?ye.push(ae[0]):ye.push(...pe),{polygon:ye.map((ke=>new r.ae(ke.x,ke.y))),unwrapped:!1}})(t,a);if(h)return h;const g=(function(y,b){let S=!1,M=-1/0,D=0;for(let j=0;j<y.length-1;j++)y[j].x>M&&(M=y[j].x,D=j);for(let j=0;j<y.length-1;j++){const B=(D+j)%(y.length-1),q=y[B],H=y[B+1];Math.abs(q.x-H.x)>.5&&(q.x<H.x?(q.x+=1,B===0&&(y[y.length-1].x+=1)):(H.x+=1,B+1===y.length-1&&(y[0].x+=1)),S=!0)}const O=r.aF(b.center.lng);return S&&O<Math.abs(O-1)&&y.forEach((j=>{j.x-=1})),{polygon:y,unwrapped:S}})(zr(t,a).map((y=>new r.P(mr(y.x),y.y))),a);return{polygon:g.polygon.map((y=>new r.ae(y.x,y.y))),unwrapped:g.unwrapped}}}function zr(d,t){return r.aG(d,(a=>{const h=t.pointCoordinate3D(a);a.x=h.x,a.y=h.y}),1/256)}function mr(d){return d<0?1+d%1:d%1}function So(d){return 100*d|0}function is(d,t,a,h,g){const y=function(S,M){if(S)return g(S);if(M){if(d.url&&M.tiles&&d.tiles&&delete d.tiles,M.variants){if(!Array.isArray(M.variants))return g(new Error("variants must be an array"));for(const O of M.variants){if(O==null||typeof O!="object"||O.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(O.capabilities))return g(new Error("capabilities must be an array"));if(O.capabilities.length===1&&O.capabilities[0]==="meshopt"){M=Object.assign(M,O);break}}}const D=r.aH(Object.assign({},M,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);D.tiles=t.canonicalizeTileset(D,d.url),g(null,D)}},b=(function(S,M,D){if(!S)return null;if(!M&&!D)return S;D=D||S.worldview_default;const O=Object.values(S.language||{});if(O.length===0)return null;const j=Object.values(S.worldview||{});if(j.length===0)return null;const B=O.every((H=>H===M)),q=j.every((H=>H===D));return B&&q?S:M in(S.language_options||{})||D in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null})(d.data,a,h);return b?r.o.frame((()=>y(null,b))):d.url?r.m(t.transformRequest(t.normalizeSourceURL(d.url,null,a,h),r.R.Source),y):r.o.frame((()=>{const{data:S,...M}=d;y(null,M)}))}function rs(d,t){const a=Math.pow(2,t.z),h=Math.floor(r.aF(d.getWest())*a),g=Math.floor(r.aJ(d.getNorth())*a),y=Math.ceil(r.aF(d.getEast())*a),b=Math.ceil(r.aJ(d.getSouth())*a);return t.x>=h&&t.x<y&&t.y>=g&&t.y<b}class Ma{constructor(t,a,h){this.bounds=t?r.aI.convert(this.validateBounds(t)):null,this.minzoom=a||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const a of t)this.extraBounds.push(r.aI.convert(this.validateBounds(a)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!rs(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if(rs(a,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const a=new Ma(t.bounds,t.minzoom,t.maxzoom);return a.addExtraBounds(t.extra_bounds),a}}class Fo extends r.E{constructor(t,a,h,g){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,r.aH(a,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new r.aK}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=is(this._options,this.map._requestManager,a,h,((g,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),h&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new r.y(g));else if(y){if(Object.assign(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const b of y.vector_layers)this.vectorLayerIds.push(b.id),y.worldview&&y.worldview[b.source]&&this.localizableLayerIds.add(b.id)}this.tileBounds=Ma.fromTileJSON(y),Kt(y.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(g)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,a){const h=t.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(h),y=this.map._requestManager.transformRequest(g,r.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,S=b?{image:b.image.clone()}:null,M={request:y,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:S,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&r.h(h)&&(M.localizableLayerIds=this.localizableLayerIds),M.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",M,D.bind(this));else if(t.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",M,D.bind(this),void 0,!0);else{const O=r.aL.call({deduped:this._deduped},M,((j,B)=>{j||!B?D.call(this,j):(M.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},t.actor&&t.actor.send("loadTile",M,D.bind(this),void 0,!0))}),!0);t.request={cancel:O}}function D(O,j){return delete t.request,t.aborted?a(null):O&&O.status!==404?a(O):(j&&j.resourceTiming&&(t.resourceTiming=j.resourceTiming),this.map._refreshExpiredTiles&&j&&t.setExpiryData(j),t.loadVectorData(j,this.map.painter),r.aM(this.dispatcher),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class wl extends r.E{constructor(t,a,h,g){super(),this.id=t,this.dispatcher=h,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},a),Object.assign(this,r.aH(a,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const a=this.map.getWorldview();this._tileJSONRequest=is(this._options,this.map._requestManager,null,a,((h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new r.y(h)):g&&(Object.assign(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map((y=>y.id))),this.tileBounds=Ma.fromTileJSON(g),Kt(g.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(h)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const h=r.o.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=r.n(this.map._requestManager.transformRequest(g,r.R.Tile),((y,b,S,M)=>(delete t.request,t.aborted?(t.state="unloaded",a(null)):y?(t.state="errored",a(y)):b?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:M}),t.setTexture(b,this.map.painter),t.state="loaded",r.aM(this.dispatcher),void a(null)):a(null))))}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a&&a()}unloadTile(t,a){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function A_([d,t],a,h,{scaled:g=!0}={}){const{tileSize:y,buffer:b}=h,{x:S,y:M,z:D}=a;if(!isFinite(S)||!isFinite(M)||!isFinite(D))throw new Error("Invalid MRT header");const O=2**D,j=O*r.aF(d),B=O*r.aJ(t);return(function([q,H],Z,{scaled:re=!0}={}){if(!Z)throw new Error("bandView is undefined");const{data:$,tileSize:ae,buffer:pe,offset:ye,scale:Ce,dimension:Ae}=Z;if(q<-pe||q>ae+pe||H<-pe||H>ae+pe)throw new Error(`Point (${q}, ${H}) out of bounds for tileSize=${ae}, buffer=${pe}`);const ke=(H+pe)*(ae+2*pe)+(q+pe);if(new Uint32Array($.buffer)[ke]===4294967295)return null;let Me=[];Me=re?[]:new Z.data.constructor(Ae);for(let Ee=0;Ee<Ae;Ee++)Me[Ee]=Math.round(1e12*($[Ae*ke+Ee]*Ce+ye))/1e12;return Me})([Math.min(Math.max(-b,Math.floor((j-S)*y)),y-1+b),Math.min(Math.max(-b,Math.floor((B-M)*y)),y-1+b)],h,{scaled:g})}class Tl extends wl{constructor(t,a,h,g){super(t,a,h,g),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},a)}triggerRepaint(t){const a=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);a&&a.enabled&&h&&a._clearRenderCacheForTile(h.id,t.tileID),this.map.triggerRepaint()}loadTile(t,a){const h=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(h,r.R.Tile),y={request:g,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=g,t.actor||(t.actor=this.dispatcher.getActor());const b=(S,M,D,O)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(S)return S.name==="AbortError"?void 0:(t.state="errored",a(S));if(this.map._refreshExpiredTiles&&M&&t.setExpiryData({cacheControl:D,expires:O}),this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!M)return a(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=M}a(null)};t.request=this.partial?t.fetchHeader(void 0,b.bind(this)):t.actor.send("loadTile",y,b.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){const h=t.texturePerLayer;if(t.flushAllQueues(),h.size){t.destroy(!0);for(const g of h.values())this.map.painter.saveTileTexture(g)}else t.destroy()}prepareTile(t,a,h,g){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(a,h,g,((y,b)=>{if(y)return t.state="errored",this.fire(new r.y(y)),void this.triggerRepaint(t);b&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(h,b,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find((({id:y})=>y===t)),h=a&&a.fields,g=h&&h.bands&&h.bands;return g?g[0]:0}getTextureDescriptor(t,a,h){if(!t)return;const g=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let y=null;a instanceof r.aP?y=a.paint.get("raster-array-band"):a instanceof r.aQ&&(y=a.paint.get("raster-particle-array-band"));const b=y||this.getInitialBand(g);if(b==null)return;if(!t.textureDescriptorPerLayer.get(a.id))return void this.prepareTile(t,g,a.id,b);if(t.updateNeeded(a.id,b)&&!h)return;const S=t.textureDescriptorPerLayer.get(a.id);return Object.assign({},S,{texture:t.texturePerLayer.get(a.id)})}getImages(t,a){const h=new Map;for(const g of t)for(const y of a){const[b,S]=y.split("/"),M=g.getLayer(b);if(!M||!M.hasBand(S)||!M.hasDataForBand(S))continue;const{bytes:D,tileSize:O,buffer:j}=M.getBandView(S),B=O+2*j,q={data:new r.q({width:B,height:B},D),pixelRatio:2,sdf:!1,usvg:!1,version:0};h.set(y,q)}return h}queryRasterArrayValueByBandId(t,a,h){const g=a._mrt;return new Promise((y=>{const b={},S=new Set;for(const[M,D]of Object.entries(g.layers)){if(h.layerName&&M!==h.layerName)continue;const O={};b[M]=O;for(const{bands:j}of D.dataIndex)for(const B of j)h.bands&&!h.bands.includes(B)||(S.add(r.B(M,B)),a.fetchBand(M,null,B,(q=>{r.o.frame((()=>{O[B]=q?null:A_([t.lng,t.lat],g,D.getBandView(B)),S.delete(r.B(M,B)),S.size===0&&y(b)}))}),!1))}S.size===0&&y(b)}))}_loadTileForQuery(t,a){if(this._loadTileLoaded[t.uid])return void a(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(a);this._loadTilePending[t.uid]=[a];const h=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(h,r.R.Tile);t.actor.send("loadTile",{request:g,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((y,b,S,M)=>y?(this._loadTilePending[t.uid].forEach((D=>D(y,null))),void delete this._loadTilePending[t.uid]):b?(this.map._refreshExpiredTiles&&b&&t.setExpiryData({cacheControl:S,expires:M}),t._mrt=b,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((D=>D(null,b))),this._loadTileLoaded[t.uid]=!0,void delete this._loadTilePending[t.uid]):(this._loadTilePending[t.uid].forEach((D=>D(null,null))),void delete this._loadTilePending[t.uid])),void 0,!0)}queryRasterArrayValueByAllBands(t,a,h){return new Promise(((g,y)=>{this._loadTileForQuery(a,((b,S)=>{b?y(b):g(S?this.queryRasterArrayValueByBandId(t,a,h):null)}))}))}queryRasterArrayValue(t,a){const h=r.aR.convert(t),g=this.findLoadedParent(h);return g&&g._mrt?a.bands||!this.partial?this.queryRasterArrayValueByBandId(h,g,a):this.queryRasterArrayValueByAllBands(h,g,a):Promise.resolve(null)}findLoadedParent(t){const a=r.ae.fromLngLat(t,this.map.transform.tileSize),h=this.maxzoom+1,g=1<<h,y=Math.floor(a.x),b=Math.floor((a.x-y)*g),S=Math.floor(a.y*g),M=this.map.style.getSourceCache(this.id),D=new r.aO(h,y,h,b,S);return M.findLoadedParent(D,this.minzoom)}}const $c={vector:Fo,raster:wl,"raster-dem":class extends wl{constructor(d,t,a,h){super(d,t,a,h),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(d,t){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(g,y){g&&(d.state="errored",t(g)),y&&(d.dem=y,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",t(null))}d.request=r.n(this.map._requestManager.transformRequest(a,r.R.Tile),(function(g,y,b,S){if(delete d.request,d.aborted)d.state="unloaded",t(null);else if(g)d.state="errored",t(g);else if(y){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:b,expires:S});const M=ImageBitmap&&y instanceof ImageBitmap&&r.r(),D=1-(y.width-r.aN(y.width))/2;D<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const O=M?y:r.o.getImageData(y,D),j={uid:d.uid,tileID:d.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:D};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadTile",j,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const t=d.canonical,a=Math.pow(2,t.z),h=(t.x-1+a)%a,g=t.x===0?d.wrap-1:d.wrap,y=(t.x+1+a)%a,b=t.x+1===a?d.wrap+1:d.wrap,S={};return S[new r.aO(d.overscaledZ,g,t.z,h,t.y).key]={backfilled:!1},S[new r.aO(d.overscaledZ,b,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(S[new r.aO(d.overscaledZ,g,t.z,h,t.y-1).key]={backfilled:!1},S[new r.aO(d.overscaledZ,d.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new r.aO(d.overscaledZ,b,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<a&&(S[new r.aO(d.overscaledZ,g,t.z,h,t.y+1).key]={backfilled:!1},S[new r.aO(d.overscaledZ,d.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new r.aO(d.overscaledZ,b,t.z,y,t.y+1).key]={backfilled:!1}),S}},"raster-array":Tl,geojson:class extends r.E{constructor(d,t,a,h){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(h),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const g=r.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*g,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*g,extent:r.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*g,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const a of this._data.features)t.set(a.id,a);for(const a of d.features)t.set(a.id,a);this._data.features=[...t.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterChildren(d,t){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterLeaves(d,t,a,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:t,offset:a},h),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:d},this.workerOptions);t.scope=this.scope;const a=this._data;typeof a=="string"?(t.request=this.map._requestManager.transformRequest(r.o.resolveURL(a),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((h,g)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new r.y(h));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(y.resourceTiming=g.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new r.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const d=r.B(this.id,this.scope);this.map.style.clearSource(d),this._updateWorkerData()}loadTile(d,t){const a=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const h=this.map.style?this.map.style.getLut(this.scope):null,g=h?{image:h.image.clone()}:null,y=this._partialReload,b={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:d.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview()};d.request=this.actor.send(a,b,((S,M)=>y&&!M?(d.state="loaded",t(null)):(delete d.request,d.destroy(),d.aborted?t(null):S?t(S):(d.loadVectorData(M,this.map.painter,a==="reloadTile"),t(null)))),void 0,a==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,t){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aS{constructor(d,t,a,h){super(d,t,a,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const t of d.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aT(this.urls,((t,a)=>{this._loaded=!0,t?this.fire(new r.y(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const t=this.video.seekable;d<t.start(0)||d>t.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,t=d.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(d,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aS,model:class extends r.E{constructor(d,t,a,h){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const d=[];for(const t in this._options.models){const a=this._options.models[t],h=r.aV(this.map._requestManager.transformRequest(a.uri,r.R.Model).url).then((g=>{if(!g)return;const y=r.aW(g),b=new r.aX(t,a.position,a.orientation,y);b.computeBoundsAndApplyParent(),this.models.push(b)})).catch((g=>{this.fire(new r.y(new Error(`Could not load model ${t} from ${a.uri}: ${g.message}`)))}));d.push(h)}Promise.allSettled(d).then((()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((t=>{this._loaded=!0,this.fire(new r.y(new Error(`Could not load models: ${t.message}`)))}))}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,t){}serialize(){return this._options}},"batched-model":class extends r.E{constructor(d,t,a,h){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(d)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(d){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=is(this._options,this.map._requestManager,t,a,((h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new r.y(h))):g&&(Object.assign(this,g),g.bounds&&(this.tileBounds=new Ma(g.bounds,this.minzoom,this.maxzoom)),Kt(g.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),d&&d(h)}))}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,t){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(a,r.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.o.devicePixelRatio,promoteId:this.promoteId};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=t;else{if(d.buckets){const y=Object.values(d.buckets);for(const b of y)b.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",h,g.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",h,g.bind(this),void 0,!0);function g(y,b){return d.aborted?t(null):y&&y.status!==404?t(y):(this.map._refreshExpiredTiles&&b&&d.setExpiryData(b),d.loadModelData(b,this.map.painter),d.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends r.aS{constructor(d,t,a,h){super(d,t,a,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((g=>!Array.isArray(g)||g.length!==2||g.some((y=>typeof y!="number"))))||this.fire(new r.y(new r.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${d}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof r.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends r.E{constructor(d,t,a,h){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ma(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,r.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:t,y:a,z:h}=d.canonical;return this._implementation.hasTile({x:t,y:a,z:h})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,t){const{x:a,y:h,z:g}=d.tileID.canonical,y=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:a,y:h,z:g},{signal:y.signal})).then((function(b){return delete d.request,d.aborted?(d.state="unloaded",t(null)):b===void 0?(d.state="errored",t(null)):b===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",t(null)):(function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement})(b)?(this.loadTileData(d,b),d.state="loaded",void t(null)):(d.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((b=>{b.name!=="AbortError"&&(d.state="errored",t(b))})),d.request.cancel=()=>y.abort()}loadTileData(d,t){d.setTexture(t,this.map.painter)}unloadTile(d,t){if(d.texture&&d.texture instanceof r.T?(d.destroy(!0),d.texture&&d.texture instanceof r.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:a,y:h,z:g}=d.tileID.canonical;this._implementation.unloadTile({x:a,y:h,z:g})}t&&t()}abortTile(d,t){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z})))}_clearTiles(){const d=r.B(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},th=function(d,t,a,h){const g=new $c[t.type](d,t,a,h);if(g.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${g.id}`);return r.aY(["load","abort","unload","serialize","prepare"],g),g};function nh(d,t,a=""){return`${a}:${t.id||""}:${t.layer.id}:${(function(h){if("layerId"in h)return`layer:${h.layerId}`;{const{featuresetId:g,importId:y}=h;return`featureset:${g}${y?`:import:${y}`:""}`}})(d.target)}`}function Sl(d,t,a,h=""){if(d.uniqueFeatureID){const g=nh(d,t,h);if(a.has(g))return!0;a.add(g)}return!1}function ih(d,t,a,h,g=!1){const y=t.sourceCache.transform,b=t.sourceCache.tilesIn(d,t.has3DLayers,g);b.sort(Pp);const S=[];for(const M of b){const D=M.tile.queryRenderedFeatures(t,M,a,h,y,g);Object.keys(D).length&&S.push({wrappedTileID:M.tile.tileID.wrapped().key,queryResults:D})}return S.length===0?{}:(function(M){const D={},O={};for(const j of M){const B=j.queryResults,q=j.wrappedTileID,H=O[q]=O[q]||{};for(const Z in B){const re=B[Z],$=H[Z]=H[Z]||{},ae=D[Z]=D[Z]||[];for(const pe of re)$[pe.featureIndex]||($[pe.featureIndex]=!0,ae.push(pe))}}return D})(S)}function Cp(d,t,a,h,g,y){const b={},S=h.queryRenderedSymbols(d),M=[];for(const D of Object.keys(S).map(Number))M.push(g[D]);M.sort(Pp);for(const D of M){const O=D.featureIndex.lookupSymbolFeatures(S[D.bucketInstanceId],D.bucketIndex,D.sourceLayerIndex,t,a,y);for(const j in O){const B=b[j]=b[j]||[],q=O[j];q.sort(((H,Z)=>{const re=D.featureSortOrder;if(re){const $=re.indexOf(H.featureIndex);return re.indexOf(Z.featureIndex)-$}return Z.featureIndex-H.featureIndex}));for(const H of q)B.push(H)}}return b}function Ca(d,t){const a=d.getRenderableIds().map((y=>d.getTileByID(y))),h=[],g={};for(let y=0;y<a.length;y++){const b=a[y],S=b.tileID.canonical.key;g[S]||(g[S]=!0,b.querySourceFeatures(h,t))}return h}function Pp(d,t){const a=d.tileID,h=t.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}function pd(d,t){const a={};if(!t)return a;for(const h of d){const g=h.layerIds.map((y=>t.getLayer(y))).filter(Boolean);if(g.length!==0){h.layers=g,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map((y=>g.filter((b=>b.id===y))[0])));for(const y of g)a[y.fqid]=h}}return a}const Fs=32,pa=33,Ka=new Uint16Array(8184);for(let d=0;d<2046;d++){let t=d+2,a=0,h=0,g=0,y=0,b=0,S=0;for(1&t?g=y=b=Fs:a=h=S=Fs;(t>>=1)>1;){const D=a+g>>1,O=h+y>>1;1&t?(g=a,y=h,a=b,h=S):(a=g,h=y,g=b,y=S),b=D,S=O}const M=4*d;Ka[M+0]=a,Ka[M+1]=h,Ka[M+2]=g,Ka[M+3]=y}const ma=new Uint16Array(2178),hs=new Uint8Array(1089),ac=new Uint16Array(1089);function kp(d){return d===0?-.03125:d===32?.03125:0}const rh={type:2,extent:r.al,loadGeometry:()=>[[new r.P(0,0),new r.P(r.al+1,0),new r.P(r.al+1,r.al+1),new r.P(0,r.al+1),new r.P(0,0)]]};class El{constructor(t,a,h,g,y,b){this.tileID=t,this.uid=r.b2(),this.uses=0,this.tileSize=a,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection),this.worldview=b}registerFadeDuration(t){const a=t+this.timeAdded;a<r.o.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,a,h){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=pd(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const y=this.buckets[g];if(y instanceof r.b4){if(this.hasSymbolBuckets=!0,!h)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const y=this.buckets[g];if(y instanceof r.b4&&y.hasRTLText){this.hasRTLText=!0,r.b5();break}}this.queryPadding=0;for(const g in this.buckets){const y=this.buckets[g],b=a.style.getOwnLayer(g);if(!b)continue;const S=b.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,S)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,a,h){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,pd(t.buckets,a.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const g in this.buckets){const y=this.buckets[g];y.uploadPending()&&y.upload(t)}const a=t.gl,h=this.imageAtlas;h&&!h.uploaded&&(this.imageAtlasTexture=new r.T(t,h.image,a.RGBA8,{useMipmap:!!h.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(t,a,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,h),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=a.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==g),this._lastUpdatedBrightness=g))}queryRenderedFeatures(t,a,h,g,y,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const S=(function(M,D){const O=r.bq([],[.5*M.width,.5*-M.height,1]);return r.br(O,O,[1,-1,0]),r.aB(O,O,M.calculateProjMatrix(D.toUnwrapped())),Float32Array.from(O)})(y,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:a,pixelPosMatrix:S,transform:g,availableImages:h,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,a){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const g=h.loadVTLayers(),y=a?a.sourceLayer:"",b=g._geojsonTileLayer||g[y];if(!b)return;const S=r.b6(a&&a.filter),{z:M,x:D,y:O}=this.tileID.canonical,j={z:M,x:D,y:O};for(let B=0;B<b.length;B++){const q=b.feature(B);if(S.needGeometry){const re=r.b7(q,!0);if(!S.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),re,this.tileID.canonical))continue}else if(!S.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),q))continue;const H=h.getId(q,y),Z=new r.b8(q,M,D,O,H);Z.tile=j,t.push(Z)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const h=r.b9(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let g=!1;if(this.expirationTime>h)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{const y=this.expirationTime-a;y?this.expirationTime=h+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,a){if(!this.latestFeatureIndex||!t.style)return;const h=this.latestFeatureIndex.loadVTLayers(),g=t.style.listImages(),y=t.style.getBrightness();for(const b in this.buckets){if(!t.style.hasLayer(b))continue;const S=this.buckets[b],M=S.layers[0],D=M.sourceLayer||"_geojsonTileLayer",O=h[D],j=t.style.getLayerSourceCache(M);let B={};j&&(B=j._state.getState(D,void 0));const q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},H=Object.keys(B).length>0&&!a;(H&&S.stateDependentLayers.length!==0||a)&&S.update(B,O,g,q,H?S.stateDependentLayers:S.layers,a,y),(S instanceof r.ba||S instanceof r.bb)&&t._terrain&&t._terrain.enabled&&j&&S.uploadPending()&&t._terrain._clearRenderCacheForTile(j.id,this.tileID);const Z=t&&t.style&&t.style.getOwnLayer(b);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.o.now()+t}setTexture(t,a){const h=a.context,g=h.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(h,t,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(t,a){const h={};for(const g of a)h[g]=!0;this.dependencies[t]=h}hasDependency(t,a){for(const h of t){const g=this.dependencies[h];if(g){for(const y of a)if(g[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const h=r.bc(rh,this.tileID.canonical,this.tileTransform)[0],g=new r.bd,y=new r.be;for(let b=0;b<h.length;b++){const{x:S,y:M}=h[b];g.emplaceBack(S,M),y.emplaceBack(b)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(g,r.bf.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,g.length,y.length)}_makeTileBoundsBuffers(t,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const h=r.bc(rh,this.tileID.canonical,this.tileTransform)[0];let g,y;if(this.isRaster){const b=(function(S,M){const D=r.aZ(S,M),O=Math.pow(2,S.z);for(let re=0;re<pa;re++)for(let $=0;$<pa;$++){const ae=r.a_((S.x+($+kp($))/Fs)/O),pe=r.a$((S.y+(re+kp(re))/Fs)/O),ye=M.project(ae,pe),Ce=re*pa+$;ma[2*Ce+0]=Math.round((ye.x*D.scale-D.x)*r.al),ma[2*Ce+1]=Math.round((ye.y*D.scale-D.y)*r.al)}hs.fill(0),ac.fill(0);for(let re=2045;re>=0;re--){const $=4*re,ae=Ka[$+0],pe=Ka[$+1],ye=Ka[$+2],Ce=Ka[$+3],Ae=ae+ye>>1,ke=pe+Ce>>1,Me=Ae+ke-pe,Ee=ke+ae-Ae,ze=pe*pa+ae,ot=Ce*pa+ye,Ze=ke*pa+Ae,mt=Math.hypot((ma[2*ze+0]+ma[2*ot+0])/2-ma[2*Ze+0],(ma[2*ze+1]+ma[2*ot+1])/2-ma[2*Ze+1])>=16;hs[Ze]=hs[Ze]||(mt?1:0),re<1022&&(hs[Ze]=hs[Ze]||hs[(pe+Ee>>1)*pa+(ae+Me>>1)]||hs[(Ce+Ee>>1)*pa+(ye+Me>>1)])}const j=new r.b0,B=new r.b1;let q=0;function H(re,$){const ae=$*pa+re;return ac[ae]===0&&(j.emplaceBack(ma[2*ae+0],ma[2*ae+1],re*r.al/Fs,$*r.al/Fs),ac[ae]=++q),ac[ae]-1}function Z(re,$,ae,pe,ye,Ce){const Ae=re+ae>>1,ke=$+pe>>1;if(Math.abs(re-ye)+Math.abs($-Ce)>1&&hs[ke*pa+Ae])Z(ye,Ce,re,$,Ae,ke),Z(ae,pe,ye,Ce,Ae,ke);else{const Me=H(re,$),Ee=H(ae,pe),ze=H(ye,Ce);B.emplaceBack(Me,Ee,ze)}}return Z(0,0,Fs,Fs,Fs,0),Z(Fs,Fs,0,0,0,Fs),{vertices:j,indices:B}})(this.tileID.canonical,a);g=b.vertices,y=b.indices}else{g=new r.b0,y=new r.b1;for(const{x:S,y:M}of h)g.emplaceBack(S,M,0,0);const b=r.bh(g.int16.subarray(0,4*g.length),void 0,4);for(let S=0;S<b.length;S+=3)y.emplaceBack(b[S],b[S+1],b[S+2])}this._tileBoundsBuffer=t.createVertexBuffer(g,r.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=r.bg.simpleSegment(0,0,g.length,y.length)}_makeGlobeTileDebugBuffers(t,a){const h=a.projection;if(!h||h.name!=="globe"||a.freezeTileCoverage)return;const g=this.tileID.canonical,y=r.bj(g,a),b=r.bk(y),S=r.aj(a.zoom);let M;S>0&&(M=r.bl(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,g,a,b,M,S),this._makeGlobeTileDebugTextBuffer(t,g,a,b,M,S)}_globePoint(t,a,h,g,y,b,S){let M=r.bm(t,a,h);if(b){const D=1<<h.z,O=r.aF(g.center.lng),j=r.aJ(g.center.lat),B=(h.x+.5)/D-O;let q=0;B>.5?q=-1:B<-.5&&(q=1);let H=(t/r.al+h.x)/D+q,Z=(a/r.al+h.y)/D;H=(H-O)*g._pixelsPerMercatorPixel+O,Z=(Z-j)*g._pixelsPerMercatorPixel+j;const re=[H*g.worldSize,Z*g.worldSize,0];r.af(re,re,b),M=r.bn(M,re,S)}return r.af(M,M,y)}_makeGlobeTileDebugBorderBuffer(t,a,h,g,y,b){const S=new r.bd,M=new r.be,D=new r.bo,O=(B,q,H,Z,re)=>{const $=(H-B)/(re-1),ae=(Z-q)/(re-1),pe=S.length;for(let ye=0;ye<re;ye++){const Ce=B+ye*$,Ae=q+ye*ae;S.emplaceBack(Ce,Ae);const ke=this._globePoint(Ce,Ae,a,h,g,y,b);D.emplaceBack(ke[0],ke[1],ke[2]),M.emplaceBack(pe+ye)}},j=r.al;O(0,0,j,0,16),O(j,0,j,j,16),O(j,j,0,j,16),O(0,j,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(M),this._tileDebugBuffer=t.createVertexBuffer(S,r.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(D,r.bp.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,S.length,M.length)}_makeGlobeTileDebugTextBuffer(t,a,h,g,y,b){const S=r.al/4,M=new r.bd,D=new r.b1,O=new r.bo,j=25;D.reserve(32),M.reserve(j),O.reserve(j);const B=(q,H)=>j*q+H;for(let q=0;q<j;q++){const H=q*S;for(let Z=0;Z<j;Z++){const re=Z*S;M.emplaceBack(re,H);const $=this._globePoint(re,H,a,h,g,y,b);O.emplaceBack($[0],$[1],$[2])}}for(let q=0;q<4;q++)for(let H=0;H<4;H++){const Z=B(q,H),re=B(q,H+1),$=B(q+1,H),ae=B(q+1,H+1);D.emplaceBack(Z,re,$),D.emplaceBack($,re,ae)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(D),this._tileDebugTextBuffer=t.createVertexBuffer(M,r.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(O,r.bp.members),this._tileDebugTextSegments=r.bg.simpleSegment(0,0,j,32)}destroy(t=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bs.setPbf(r.bt);class oh extends El{constructor(t,a,h,g,y){super(t,a,h,g,y),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,a,h){const g=h.context,y=g.gl;let b=this.texturePerLayer.get(t)||h.getTileTexture(a.width);b&&b instanceof r.T?b.update(a,{premultiply:!1}):b=new r.T(g,a,y.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,b)}flushQueues(t){const a=this._workQueuePerLayer.get(t)||[],h=this._fetchQueuePerLayer.get(t)||[];for(;a.length;)a.pop()();for(;h.length;)h.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const a=this._workQueuePerLayer.get(t)||[];for(;a.length;)a.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const a=this._fetchQueuePerLayer.get(t)||[];for(;a.length;)a.pop()()}}fetchHeader(t=16384,a){const h=this._mrt=new r.bs(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.bu(g,((y,b,S,M)=>{if(y)a(y);else try{const D=h.getHeaderLength(b);if(D>t)return void(this.request=this.fetchHeader(D,a));h.parseHeader(b),this._isHeaderLoaded=!0;let O=0;for(const j of Object.values(h.layers))O=Math.max(O,j.dataIndex[j.dataIndex.length-1].lastByte);b.byteLength>=O&&(this.entireBuffer=b),a(null,this.entireBuffer||b,S,M)}catch(D){a(D)}})),this.request}fetchBandForRender(t,a,h,g){this.fetchBand(t,a,h,(y=>{if(y)return void g(y);this.updateTextureDescriptor(t,a,h);const b=this.textureDescriptorPerLayer.get(a);g(null,b?b.img:null)}))}fetchBand(t,a,h,g,y=!0){const b=this._mrt;if(!this._isHeaderLoaded||!b)return void g(new Error("Tile header is not ready"));const S=this.actor;if(!S)return void g(new Error("Can't fetch tile band without an actor"));let M;const D=r.B(String(h),r.B(this.tileID.key,t));let O=this._taskQueue.get(D);O?O.add(g):(O=new Set,O.add(g),this._taskQueue.set(D,O));const j=(Z,re)=>{M.complete(Z,re),Z?g(Z):(O.values().forEach(($=>$(null,re))),this._taskQueue.delete(D))},B=(Z,re)=>{if(Z)return g(Z);const $=S.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:re,task:M},j,void 0,!0);if(a!==null){const ae=this._workQueuePerLayer.get(a)||[];ae.push((()=>{$&&$.cancel(),M.cancel()})),this._workQueuePerLayer.has(a)||this._workQueuePerLayer.set(a,ae)}};let q;try{q=b.getLayer(t)}catch(Z){if(this.state==="reloading")return;throw Z}if(!q)return void g(new Error(`Unknown sourceLayer "${t}"`));if(q.hasDataForBand(h))return O.values().forEach((Z=>Z(null,null))),void this._taskQueue.delete(D);const H=q.getDataRange([h]);if(M=b.createDecodingTask(H),!M||M.tasks.length)if(a!==null&&this.flushQueues(a),this.entireBuffer)B(null,this.entireBuffer.slice(H.firstByte,H.lastByte+1));else{const Z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${H.firstByte}-${H.lastByte}`}}),re=r.bu(Z,B);if(a!==null){const $=this._fetchQueuePerLayer.get(a)||[];$.push((()=>{re.cancel(),M.cancel()})),this._fetchQueuePerLayer.has(a)||this._fetchQueuePerLayer.set(a,$)}}}updateNeeded(t,a){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==a||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,a,h){if(!this._mrt)return;const g=this._mrt.getLayer(t);if(!g||!g.hasBand(h)||!g.hasDataForBand(h))return;const{bytes:y,tileSize:b,buffer:S,offset:M,scale:D}=g.getBandView(h),O=b+2*S,j=new r.q({width:O,height:O},y),B=this.texturePerLayer.get(a);B&&B instanceof r.T&&B.update(j,{premultiply:!1}),this.textureDescriptorPerLayer.set(a,{layer:t,band:h,img:j,buffer:S,offset:M,tileSize:b,format:g.pixelFormat,mix:[D,256*D,65536*D,16777216*D]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const a of this.texturePerLayer.values())a&&a instanceof r.T&&a.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class sh{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,h){const g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const y={value:a,timeout:void 0};if(h!==void 0&&(y.timeout=setTimeout((()=>{this.remove(t,y)}),h)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const h=t.wrapped().key,g=a===void 0?0:this.data[h].indexOf(a),y=this.data[h][g];return this.data[h].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(y.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const h in this.data)for(const g of this.data[h])t(g.value)||a.push(g);for(const h of a)this.remove(h.value.tileID,h)}}class eu{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,h){const g=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},Object.assign(this.stateChanges[t][g],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==g&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(const y in this.state[t][g])h[y]||(this.deletedStates[t][g][y]=null)}else for(const y in h)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][y]===null&&delete this.deletedStates[t][g][y]}removeFeatureState(t,a,h){if(this.deletedStates[t]===null)return;const g=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&a!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][h]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(h in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][h]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,a){const h=this.state[t]||{},g=this.stateChanges[t]||{},y=this.deletedStates[t];if(y===null)return{};if(a!==void 0){const S=String(a),M=Object.assign({},h[S],g[S]);if(y){const D=y[a];if(D===null)return{};for(const O in D)delete M[O]}return M}const b=Object.assign({},h,g);if(y)for(const S in y)delete b[S];return b}initializeTileState(t,a){t.refreshFeatureState(a)}coalesceChanges(t,a){const h={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const y={};for(const b in this.stateChanges[g])this.state[g][b]||(this.state[g][b]={}),Object.assign(this.state[g][b],this.stateChanges[g][b]),y[b]=this.state[g][b];h[g]=y}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const y={};if(this.deletedStates[g]===null)for(const b in this.state[g])y[b]={},this.state[g][b]={};else for(const b in this.deletedStates[g]){if(this.deletedStates[g][b]===null)this.state[g][b]={};else if(this.state[g][b])for(const S of Object.keys(this.deletedStates[g][b]))delete this.state[g][b][S];y[b]=this.state[g][b]}h[g]=h[g]||{},Object.assign(h[g],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const g in t)t[g].refreshFeatureState(a)}}class Bs extends r.E{constructor(t,a,h){super(),this.id=t,this._onlySymbols=h,a.on("data",(g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),a.on("error",(()=>{this._sourceErrored=!0})),this._source=a,this._tiles={},this._cache=new sh(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new eu,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,a){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const h=this._tiles[a];h.upload(t),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(Rp).map((t=>t.key))}getRenderableIds(t,a){const h=[];for(const g in this._tiles)this._isIdRenderable(+g,t,a)&&h.push(this._tiles[g]);return t?h.sort(((g,y)=>{const b=g.tileID,S=y.tileID,M=new r.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),D=new r.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-S.overscaledZ||D.y-M.y||D.x-M.x})).map((g=>g.tileID.key)):h.map((g=>g.tileID)).sort(Rp).map((g=>g.key))}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())&&(h||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,a){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=a),this._loadTile(h,this._tileLoaded.bind(this,h,t,a)))}_tileLoaded(t,a,h,g){if(g)if(t.state="errored",g.status!==404)this._source.fire(new r.y(g,{tile:t}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=r.o.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const a=this.getRenderableIds();for(let g=0;g<a.length;g++){const y=a[g];if(t.neighboringTiles&&t.neighboringTiles[y]){const b=this.getTileByID(y);h(t,b),h(b,t)}}function h(g,y){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let b=y.tileID.canonical.x-g.tileID.canonical.x;const S=y.tileID.canonical.y-g.tileID.canonical.y,M=Math.pow(2,g.tileID.canonical.z),D=y.tileID.key;b===0&&S===0||Math.abs(S)>1||(Math.abs(b)>1&&(Math.abs(b+M)===1?b+=M:Math.abs(b-M)===1&&(b-=M)),y.dem&&g.dem&&(g.dem.backfillBorder(y.dem,b,S),g.neighboringTiles&&g.neighboringTiles[D]&&(g.neighboringTiles[D].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,h,g){for(const y in this._tiles){let b=this._tiles[y];if(g[y]||!b.hasData()||b.tileID.overscaledZ<=a||b.tileID.overscaledZ>h)continue;let S=b.tileID;for(;b&&b.tileID.overscaledZ>a+1;){const D=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[D.key],b&&b.hasData()&&(S=D)}let M=S;for(;M.overscaledZ>a;)if(M=M.scaledTo(M.overscaledZ-1),t[M.key]){g[S.key]=S;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=a?h:null}for(let h=t.overscaledZ-1;h>=a;h--){const g=t.scaledTo(h),y=this._getLoadedTile(g);if(y)return y}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,a){a=a||this._source.tileSize;const h=Math.ceil(t.width/a)+1,g=Math.ceil(t.height/a)+1,y=Math.floor(h*g*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(S)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const h={};for(const g in this._tiles){const y=this._tiles[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),h[y.tileID.key]=y}this._tiles=h;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(t,a,h,g,y){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;this.updateCacheSize(t,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let S,M=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const B=D.attenuationRange()[0],q=Math.floor(B)-Math.log2(D.getDemUpscale());M>q&&(M=q)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((B=>new r.aO(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y)));else if(this.tileCoverLift!==0){const B=t.clone();B.tileCoverLift=this.tileCoverLift,S=B.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&t.projection.name==="globe"&&(S.push(new r.aO(1,0,1,0,0)),S.push(new r.aO(1,0,1,1,0)),S.push(new r.aO(1,0,1,0,1)),S.push(new r.aO(1,0,1,1,1)))}else if(S=t.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);S=S.filter((q=>B(q)))}}else S=[];if(S.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!md(this._source.type)){const B=t.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),q=Math.min(B,this._source.maxzoom);if(b){const H=t.extendTileCover(S,q);for(const Z of H)S.push(Z)}else if(y){const H=t.extendTileCoverToNearPlane(S,this.transform.getFrustum(q),q);for(const Z of H)S.push(Z)}else if(this.castsShadows&&g){const H=t.extendTileCover(S,q,g);for(const Z of H)this._shadowCasterTiles[Z.key]=!0,S.push(Z)}}const O=this._updateRetainedTiles(S);if(md(this._source.type)&&S.length!==0){const B={},q={},H=Object.keys(O);for(const re of H){const $=O[re],ae=this._tiles[re];if(!ae||ae.fadeEndTime&&ae.fadeEndTime<=r.o.now())continue;const pe=this.findLoadedParent($,Math.max($.overscaledZ-Bs.maxOverzooming,this._source.minzoom));pe&&(this._addTile(pe.tileID),B[pe.tileID.key]=pe.tileID),q[re]=$}const Z=S[S.length-1].overscaledZ;for(const re in this._tiles){const $=this._tiles[re];if(O[re]||!$.hasData())continue;let ae=$.tileID;for(;ae.overscaledZ>Z;){ae=ae.scaledTo(ae.overscaledZ-1);const pe=this._tiles[ae.key];if(pe&&pe.hasData()&&q[ae.key]){O[re]=$.tileID;break}}}for(const re in B)O[re]||(this._coveredTiles[re]=!0,O[re]=B[re])}for(const B in O)this._tiles[B].clearFadeHold();const j=r.bv(this._tiles,O);for(const B of j){const q=this._tiles[B];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const a={};if(t.length===0)return a;const h={},g=t.reduce(((D,O)=>Math.min(D,O.overscaledZ)),1/0),y=t[0].overscaledZ,b=Math.max(y-Bs.maxOverzooming,this._source.minzoom),S=Math.max(y+Bs.maxUnderzooming,this._source.minzoom),M={};for(const D of t){const O=this._addTile(D);a[D.key]=D,O.hasData()||g<this._source.maxzoom&&(M[D.key]=D)}this._retainLoadedChildren(M,g,S,a);for(const D of t){let O=this._tiles[D.key];if(O.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const B=D.children(this._source.maxzoom)[0],q=this.getTile(B);if(q&&q.hasData()){a[B.key]=B;continue}}else{const B=D.children(this._source.maxzoom);if(a[B[0].key]&&a[B[1].key]&&a[B[2].key]&&a[B[3].key])continue}let j=O.wasRequested();for(let B=D.overscaledZ-1;B>=b;--B){const q=D.scaledTo(B);if(h[q.key]||(h[q.key]=!0,O=this.getTile(q),!O&&j&&(O=this._addTile(q)),O&&(a[q.key]=q,j=O.wasRequested(),O.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let h,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){h=this._loadedParentTiles[g.key];break}a.push(g.key);const y=g.scaledTo(g.overscaledZ-1);if(h=this._getLoadedTile(y),h)break;g=y}for(const y of a)this._loadedParentTiles[y]=h}}_addTile(t){let a=this._tiles[t.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const h=!!a;if(!h){const g=this.map?this.map.painter:null,y=this._source.tileSize*t.overscaleFactor();a=this._source.type==="raster-array"?new oh(t,y,this.transform.tileZoom,g,this._isRaster):new El(t,y,this.transform.tileZoom,g,this._isRaster,this._source.worldview),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))}return a.uses++,this._tiles[t.key]=a,h||this._source.fire(new r.z("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=a.getExpiryTimeout();h&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),h))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,a,h){const g=[],y=this.transform;if(!y)return g;const b=y.projection.name==="globe",S=r.aF(y.center.lng);for(const M in this._tiles){const D=this._tiles[M];if(h&&D.clearQueryDebugViz(),D.holdingForFade())continue;let O;if(b){const j=D.tileID.canonical;if(j.z===0){const B=[Math.abs(r.aA(S,...tu(j,-1))-S),Math.abs(r.aA(S,...tu(j,1))-S)];O=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(r.aA(S,...tu(j,-1))-S),Math.abs(r.aA(S,...tu(j,0))-S),Math.abs(r.aA(S,...tu(j,1))-S)];O=[B.indexOf(Math.min(...B))-1]}}else O=[0];for(const j of O){const B=t.containsTile(D,y,a,j);B&&g.push(B)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,a){const h=this.getRenderableIds(t,a).map((y=>this._tiles[y].tileID)),g=this.transform.projection.name==="globe";for(const y of h)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=g?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return h}sortCoordinatesByDistance(t){const a=t.slice(),h=this.transform._camera.position,g=this.transform._camera.forward(),y={};for(const b of a){const S=1/(1<<b.canonical.z);y[b.key]=((b.canonical.x+.5)*S+b.wrap-h[0])*g[0]+((b.canonical.y+.5)*S-h[1])*g[1]-h[2]*g[2]}return a.sort(((b,S)=>y[b.key]-y[S.key])),a}hasTransition(){if(this._source.hasTransition())return!0;if(md(this._source.type))for(const t in this._tiles){const a=this._tiles[t];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=r.o.now())return!0}return!1}setFeatureState(t,a,h){this._state.updateState(t=t||"_geojsonTileLayer",a,h)}removeFeatureState(t,a,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,h)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,h){const g=this._tiles[t];g&&g.setDependencies(a,h)}reloadTilesForDependencies(t,a){for(const h in this._tiles)this._tiles[h].hasDependency(t,a)&&this._reloadTile(+h,"reloading");this._cache.filter((h=>!h.hasDependency(t,a)))}_preloadTiles(t,a){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(t,a))};return void this._source.on("data",M)}const h=new Map,g=Array.isArray(t)?t:[t],y=this.map.painter.terrain,b=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const M of g){const D=M.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const O of D)h.set(O.key,O);this.usedForTerrain&&M.updateElevation(!1)}const S=Array.from(h.values());r.bw(S,((M,D)=>{const O=new El(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(O,(j=>{this._source.type==="raster-dem"&&O.dem&&this._backfillDEM(O),D(j,O)}))}),a)}}function Rp(d,t){const a=Math.abs(2*d.wrap)-+(d.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||h-a||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function md(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function tu(d,t){const a=1<<d.z;return[d.x/a+t,(d.x+1)/a+t]}Bs.maxOverzooming=10,Bs.maxUnderzooming=3;class gd{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,a=!1;for(const h in this.style._mergedLayers){const g=this.style._mergedLayers[h];if(g.type==="fill-extrusion"||g.type==="building")this.layers.push({layer:g,visible:t,visibilityChanged:a});else if(g.type==="model"){const y=this.style.getLayerSource(g);y&&y.type==="batched-model"&&this.layers.push({layer:g,visible:t,visibilityChanged:a})}}}onNewFrame(t){this.layersGotHidden=!1;for(const a of this.layers){const h=a.layer;let g=!1;h.type==="fill-extrusion"?g=!h.isHidden(t)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="building"?g=!h.isHidden(t)&&h.paint.get("building-opacity")>0:h.type==="model"&&(g=!h.isHidden(t)&&h.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!g&&a.visible,a.visible=g}}updateZOffset(t,a){this.currentBuildingBuckets=[];for(const g of this.layers){const y=g.layer,b=this.style.getLayerSourceCache(y);let S=1;y.type==="fill-extrusion"?S=g.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(S=g.visible?y.paint.get("building-vertical-scale"):0);let M=b?b.getTile(a):null;if(!M&&b)for(const D in b._tiles){const O=b._tiles[D];if(a.canonical.isChildOf(O.tileID.canonical)){M=O;break}}this.currentBuildingBuckets.push({bucket:M?M.getBucket(y):null,tileID:M?M.tileID:a,verticalScale:S})}t.hasAnyZOffset=!1;let h=!1;for(let g=0;g<t.symbolInstances.length;g++){const y=t.symbolInstances.get(g),b=y.zOffset,S=this._getHeightAtTileOffset(a,y.tileAnchorX,y.tileAnchorY);y.zOffset=S!==Number.NEGATIVE_INFINITY?S:b,h||b===y.zOffset||(h=!0),t.hasAnyZOffset||y.zOffset===0||(t.hasAnyZOffset=!0)}h&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,a,h,g){let y=a,b=h;if(t.canonical.z!==g.canonical.z){const S=g.canonical,M=1/(1<<t.canonical.z-S.z);y=(a+t.canonical.x*r.al)*M-S.x*r.al|0,b=(h+t.canonical.y*r.al)*M-S.y*r.al|0}return{tileX:y,tileY:b}}_getHeightAtTileOffset(t,a,h){let g,y;for(let b=0;b<this.layers.length;++b){const S=this.layers[b].layer;if(S.type!=="fill-extrusion"&&S.type!=="building")continue;const{bucket:M,tileID:D,verticalScale:O}=this.currentBuildingBuckets[b];if(!M)continue;const{tileX:j,tileY:B}=this._mapCoordToOverlappingTile(t,a,h,D),q=M.getHeightAtTileCoord(j,B);q&&q.height!==void 0&&(q.hidden?g=q.height:y=Math.max(q.height*O,y||0))}if(y!==void 0)return y;for(let b=0;b<this.layers.length;++b){const S=this.layers[b];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:M,tileID:D}=this.currentBuildingBuckets[b];if(!M)continue;const{tileX:O,tileY:j}=this._mapCoordToOverlappingTile(t,a,h,D),B=M.getHeightAtTileCoord(O,j);if(B&&!B.hidden)return B.height===void 0&&g!==void 0?Math.min(B.maxHeight,g)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function zp(d,t){const a={};for(const h in d)h!=="ref"&&(a[h]=d[h]);return r.bx.forEach((h=>{h in t&&(a[h]=t[h])})),a}function _d(d){d=d.slice();const t=Object.create(null);for(let a=0;a<d.length;a++)t[d[a].id]=d[a];for(let a=0;a<d.length;a++)"ref"in d[a]&&(d[a]=zp(d[a],t[d[a].ref]));return d}const Ei={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function nu(d,t,a){a.push({command:Ei.addSource,args:[d,t[d]]})}function I_(d,t,a){t.push({command:Ei.removeSource,args:[d]}),a[d]=!0}function M_(d,t,a,h){I_(d,a,h),nu(d,t,a)}function yd(d,t,a){let h;for(h in d[a])if(d[a].hasOwnProperty(h)&&h!=="data"&&!r.by(d[a][h],t[a][h]))return!1;for(h in t[a])if(t[a].hasOwnProperty(h)&&h!=="data"&&!r.by(d[a][h],t[a][h]))return!1;return!0}function Al(d,t,a,h,g,y){let b;for(b in t=t||{},d=d||{})d.hasOwnProperty(b)&&(r.by(d[b],t[b])||a.push({command:y,args:[h,b,t[b],g]}));for(b in t)t.hasOwnProperty(b)&&!d.hasOwnProperty(b)&&(r.by(d[b],t[b])||a.push({command:y,args:[h,b,t[b],g]}))}function iu(d){return d.id}function ah(d,t){return d[t.id]=t,d}function vd(d,t,a){const h=t.createTileMatrix(d,d.worldSize,a.toUnwrapped());return r.aB(new Float32Array(16),d.projMatrix,h)}function C_(d,t,a){if(t.projection.name===a.projection.name)return d.projMatrix;const h=a.clone();return h.setProjection(t.projection),vd(h,t.getProjection(),d)}function lc(d,t,a){return t.name===a.projection.name?d.projMatrix:vd(a,t,d)}class P_{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.aA(t,0,1);let a=1,h=this._distances[a];const g=t*this.paddedLength+this.padding;for(;h<g&&a<this._distances.length;)h=this._distances[++a];const y=a-1,b=this._distances[y],S=h-b,M=S>0?(g-b)/S:0;return this.points[y].mult(1-M).add(this.points[a].mult(M))}}class Dp{constructor(t,a,h){const g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(a/h);for(let b=0;b<this.xCellCount*this.yCellCount;b++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,h,g,y){this._forEachCell(a,h,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(t,a,h,g){this._forEachCell(a-g,h-g,a+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(h),this.circles.push(g)}_insertBoxCell(t,a,h,g,y,b){this.boxCells[y].push(b)}_insertCircleCell(t,a,h,g,y,b){this.circleCells[y].push(b)}_query(t,a,h,g,y,b){if(h<0||t>this.width||g<0||a>this.height)return!y&&[];const S=[];if(t<=0&&a<=0&&this.width<=h&&this.height<=g){if(y)return!0;for(let M=0;M<this.boxKeys.length;M++)S.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const D=this.circles[3*M],O=this.circles[3*M+1],j=this.circles[3*M+2];S.push({key:this.circleKeys[M],x1:D-j,y1:O-j,x2:D+j,y2:O+j})}return b?S.filter(b):S}return this._forEachCell(t,a,h,g,this._queryCell,S,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?S.length>0:S}_queryCircle(t,a,h,g,y){const b=t-h,S=t+h,M=a-h,D=a+h;if(S<0||b>this.width||D<0||M>this.height)return!g&&[];const O=[];return this._forEachCell(b,M,S,D,this._queryCellCircle,O,{hitTest:g,circle:{x:t,y:a,radius:h},seenUids:{box:{},circle:{}}},y),g?O.length>0:O}query(t,a,h,g,y){return this._query(t,a,h,g,!1,y)}hitTest(t,a,h,g,y){return this._query(t,a,h,g,!0,y)}hitTestCircle(t,a,h,g){return this._queryCircle(t,a,h,!0,g)}_queryCell(t,a,h,g,y,b,S,M){const D=S.seenUids,O=this.boxCells[y];if(O!==null){const B=this.bboxes;for(const q of O)if(!D.box[q]){D.box[q]=!0;const H=4*q;if(t<=B[H+2]&&a<=B[H+3]&&h>=B[H+0]&&g>=B[H+1]&&(!M||M(this.boxKeys[q]))){if(S.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[q],x1:B[H],y1:B[H+1],x2:B[H+2],y2:B[H+3]})}}}const j=this.circleCells[y];if(j!==null){const B=this.circles;for(const q of j)if(!D.circle[q]){D.circle[q]=!0;const H=3*q;if(this._circleAndRectCollide(B[H],B[H+1],B[H+2],t,a,h,g)&&(!M||M(this.circleKeys[q]))){if(S.hitTest)return b.push(!0),!0;{const Z=B[H],re=B[H+1],$=B[H+2];b.push({key:this.circleKeys[q],x1:Z-$,y1:re-$,x2:Z+$,y2:re+$})}}}}}_queryCellCircle(t,a,h,g,y,b,S,M){const D=S.circle,O=S.seenUids,j=this.boxCells[y];if(j!==null){const q=this.bboxes;for(const H of j)if(!O.box[H]){O.box[H]=!0;const Z=4*H;if(this._circleAndRectCollide(D.x,D.y,D.radius,q[Z+0],q[Z+1],q[Z+2],q[Z+3])&&(!M||M(this.boxKeys[H])))return b.push(!0),!0}}const B=this.circleCells[y];if(B!==null){const q=this.circles;for(const H of B)if(!O.circle[H]){O.circle[H]=!0;const Z=3*H;if(this._circlesCollide(q[Z],q[Z+1],q[Z+2],D.x,D.y,D.radius)&&(!M||M(this.circleKeys[H])))return b.push(!0),!0}}}_forEachCell(t,a,h,g,y,b,S,M){const D=this._convertToXCellCoord(t),O=this._convertToYCellCoord(a),j=this._convertToXCellCoord(h),B=this._convertToYCellCoord(g);for(let q=D;q<=j;q++)for(let H=O;H<=B;H++)if(y.call(this,t,a,h,g,this.xCellCount*H+q,b,S,M))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,h,g,y,b){const S=g-t,M=y-a,D=h+b;return D*D>S*S+M*M}_circleAndRectCollide(t,a,h,g,y,b,S){const M=(b-g)/2,D=Math.abs(t-(g+M));if(D>M+h)return!1;const O=(S-y)/2,j=Math.abs(a-(y+O));if(j>O+h)return!1;if(D<=M||j<=O)return!0;const B=D-M,q=j-O;return B*B+q*q<=h*h}}const ru={unknown:0,flipRequired:1,flipNotRequired:2},xd=Math.tan(85*Math.PI/180);function ga(d,t,a,h,g,y,b){const S=r.bC();if(a)if(y.name==="globe"){const M=r.bD(g,t);r.aB(S,S,M)}else{const M=r.bE([],b);S[0]=M[0],S[1]=M[1],S[4]=M[2],S[5]=M[3],h||r.bB(S,S,g.angle)}else r.aB(S,g.labelPlaneMatrix,d);return S}function lh(d,t,a,h,g,y,b){const S=ga(d,t,a,h,g,y,b);return y.name==="globe"&&a||(S[2]=S[6]=S[10]=S[14]=0),S}function bd(d,t,a,h,g,y,b){if(a){if(y.name==="globe"){const S=ga(d,t,a,h,g,y,b);return r.bl(S,S),r.aB(S,d,S),S}{const S=r.bz(d),M=r.bA([]);return M[0]=b[0],M[1]=b[1],M[4]=b[2],M[5]=b[3],r.aB(S,S,M),h||r.bB(S,S,-g.angle),S}}return g.glCoordMatrix}function Ns(d,t,a,h){const g=[d,t,a,1];a?r.aC(g,g,h):Bp(g,g,h);const y=g[3];return g[0]/=y,g[1]/=y,g[2]/=y,g}function cc(d,t){return Math.min(.5+d/t*.5,1.5)}function Vs(d,t){const a=d[0]/d[3],h=d[1]/d[3];return a>=-t[0]&&a<=t[0]&&h>=-t[1]&&h<=t[1]}function Lp(d,t,a,h,g,y,b,S,M,D){const O=a.transform,j=h?d.textSizeData:d.iconSizeData,B=r.bK(j,a.transform.zoom),q=O.projection.name==="globe",H=[256/a.width*2+1,256/a.height*2+1],Z=h?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Z.clear();let re=null;q&&(re=h?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const $=d.lineVertexArray,ae=h?d.text.placedSymbolArray:d.icon.placedSymbolArray,pe=a.transform.width/a.transform.height;let ye,Ce=!1;for(let Ae=0;Ae<ae.length;Ae++){const ke=ae.get(Ae),{numGlyphs:Me,writingMode:Ee}=ke;if(Ee!==r.bL.vertical||Ce||ye===r.bL.horizontal||(Ce=!0),ye=Ee,(ke.hidden||Ee===r.bL.vertical)&&!Ce){Rn(Me,Z);continue}Ce=!1;const ze=new r.P(ke.tileAnchorX,ke.tileAnchorY);let{x:ot,y:Ze,z:mt}=O.projection.projectTilePoint(ze.x,ze.y,D.canonical);if(M){const[Ot,vn,gn]=M(ze);ot+=Ot,Ze+=vn,mt+=gn}const $e=[ot,Ze,mt,1];if(r.aC($e,$e,t),!Vs($e,H)){Rn(Me,Z);continue}const pt=$e[3],Ht=cc(a.transform.getCameraToCenterDistance(O.projection),pt),rt=r.bM(j,B,ke),Ue=b?rt/Ht:rt*Ht,xt=Ns(ot,Ze,mt,g);if(xt[3]<=0){Rn(Me,Z);continue}let ct={};const Ct=r.an(d.layers[0].layout.get("text-max-angle")),qt=Math.cos(Ct),nn=b?null:M,Vt=Hi(ke,Ue,!1,S,t,g,y,d.glyphOffsetArray,$,Z,re,xt,ze,ct,pe,nn,O.projection,D,b,qt);Ce=Vt.useVertical,nn&&Vt.needsFlipping&&(ct={}),(Vt.notEnoughRoom||Ce||Vt.needsFlipping&&Hi(ke,Ue,!0,S,t,g,y,d.glyphOffsetArray,$,Z,re,xt,ze,ct,pe,nn,O.projection,D,b,qt).notEnoughRoom)&&Rn(Me,Z)}h?(d.text.dynamicLayoutVertexBuffer.updateData(Z),re&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(re)):(d.icon.dynamicLayoutVertexBuffer.updateData(Z),re&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(re))}function wd(d,t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z,re){const{lineStartIndex:$,glyphStartIndex:ae,segment:pe}=S,ye=ae+S.numGlyphs,Ce=$+S.lineLength,Ae=t.getoffsetX(ae),ke=t.getoffsetX(ye-1),Me=Td(d*Ae,a,h,g,y,b,pe,$,Ce,M,D,O,j,B,!0,q,H,Z,re);if(!Me)return null;const Ee=Td(d*ke,a,h,g,y,b,pe,$,Ce,M,D,O,j,B,!0,q,H,Z,re);return Ee?{first:Me,last:Ee}:null}function Op(d,t,a,h){return d===r.bL.horizontal&&Math.abs(h)>Math.abs(a)?{useVertical:!0}:d===r.bL.vertical?h>0?{needsFlipping:!0}:null:t!==ru.unknown&&(function(g,y){return g===0||Math.abs(y/g)>xd})(a,h)?t===ru.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Hi(d,t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z,re,$,ae,pe){const ye=t/24,Ce=d.lineOffsetX*ye,Ae=d.lineOffsetY*ye,{lineStartIndex:ke,glyphStartIndex:Me,numGlyphs:Ee,segment:ze,writingMode:ot,flipState:Ze}=d,mt=ke+d.lineLength,$e=pt=>{if(O){const[xt,ct,Ct]=pt.up,qt=D.length;r.bN(O,qt+0,xt,ct,Ct),r.bN(O,qt+1,xt,ct,Ct),r.bN(O,qt+2,xt,ct,Ct),r.bN(O,qt+3,xt,ct,Ct)}const[Ht,rt,Ue]=pt.point;r.bO(D,Ht,rt,Ue,pt.angle)};if(Ee>1){const pt=wd(ye,S,Ce,Ae,a,j,B,d,M,y,q,Z,!1,re,$,ae,pe);if(!pt)return{notEnoughRoom:!0};if(h&&!a){let[Ht,rt,Ue]=pt.first.point,[xt,ct,Ct]=pt.last.point;[Ht,rt]=Ns(Ht,rt,Ue,b),[xt,ct]=Ns(xt,ct,Ct,b);const qt=Op(ot,Ze,(xt-Ht)*H,ct-rt);if(d.flipState=qt&&qt.needsFlipping?ru.flipRequired:ru.flipNotRequired,qt)return qt}$e(pt.first);for(let Ht=Me+1;Ht<Me+Ee-1;Ht++){const rt=Td(ye*S.getoffsetX(Ht),Ce,Ae,a,j,B,ze,ke,mt,M,y,q,Z,!1,!1,re,$,ae,pe);if(!rt)return D.length-=4*(Ht-Me),{notEnoughRoom:!0};$e(rt)}$e(pt.last)}else{if(h&&!a){const Ht=Ns(B.x,B.y,0,g),rt=ke+ze+1,Ue=new r.P(M.getx(rt),M.gety(rt)),xt=Ns(Ue.x,Ue.y,0,g),ct=xt[3]>0?xt:k_(B,Ue,Ht,1,g,void 0,re,$.canonical),Ct=Op(ot,Ze,(ct[0]-Ht[0])*H,ct[1]-Ht[1]);if(d.flipState=Ct&&Ct.needsFlipping?ru.flipRequired:ru.flipNotRequired,Ct)return Ct}const pt=Td(ye*S.getoffsetX(Me),Ce,Ae,a,j,B,ze,ke,mt,M,y,q,Z,!1,!1,re,$,ae,pe);if(!pt)return{notEnoughRoom:!0};$e(pt)}return{}}function Fp(d,t,a,h,g){const{x:y,y:b,z:S}=h.projectTilePoint(d.x,d.y,t);if(!g)return Ns(y,b,S,a);const[M,D,O]=g(d);return Ns(y+M,b+D,S+O,a)}function k_(d,t,a,h,g,y,b,S){const M=Fp(d.sub(t)._unit()._add(d),S,g,b,y);return r.av(M,a,M),r.aw(M,M),r.bH(M,a,M,h)}function Td(d,t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z,re,$,ae){const pe=h?d-t:d+t;let ye=pe>0?1:-1,Ce=0;h&&(ye*=-1,Ce=Math.PI),ye<0&&(Ce+=Math.PI);let Ae=S+b+(ye>0?0:1)|0,ke=g,Me=g,Ee=0,ze=0;const ot=Math.abs(pe),Ze=[],mt=[];let $e=y,pt=$e,Ht=r.bF([]);const rt=()=>k_(pt,$e,Me,ot-Ee+1,O,B,Z,re.canonical);for(;Ee+ze<=ot;){if(Ae+=ye,Ae<S||Ae>=M)return null;if(Me=ke,pt=$e,Ze.push(Me),q&&mt.push(pt),$e=new r.P(D.getx(Ae),D.gety(Ae)),ke=j[Ae],!ke){const gn=Fp($e,re.canonical,O,Z,B);ke=gn[3]>0?j[Ae]=gn:rt()}Ee+=ze;const Ot=r.av([],ke,Me),vn=r.bG(Me,ke);if(a&&vn>0&&ze>0&&r.bJ(Ht,Ot)/(ze*vn)<ae)return null;ze=vn,Ht=Ot}H&&B&&(j[Ae]&&(ke=rt(),ze=r.bG(Me,ke),Ht=r.av([],ke,Me)),j[Ae]=ke);const Ue=(ot-Ee)/ze,xt=$e.sub(pt)._mult(Ue)._add(pt),ct=r.bH([],Me,Ht,Ue);let Ct=[0,0,1],qt=Ht[0],nn=Ht[1];if($&&(Ct=Z.upVector(re.canonical,xt.x,xt.y),Ct[0]!==0||Ct[1]!==0||Ct[2]!==1)){const Ot=[Ct[2],0,-Ct[0]],vn=r.bI([],Ct,Ot);r.aw(Ot,Ot),r.aw(vn,vn),qt=r.bJ(Ht,Ot),nn=r.bJ(Ht,vn)}if(a){const Ot=r.bI([],Ct,Ht);r.aw(Ot,Ot),r.bH(ct,ct,Ot,a*ye)}const Vt=Ce+Math.atan2(nn,qt);return Ze.push(ct),q&&mt.push(xt),{point:ct,angle:Vt,path:Ze,tilePath:mt,up:Ct}}function Rn(d,t){const a=t.length,h=a+4*d;t.resize(h),t.float32.fill(-1/0,4*a,4*h)}function Bp(d,t,a){const h=t[0],g=t[1];return d[0]=a[0]*h+a[4]*g+a[12],d[1]=a[1]*h+a[5]*g+a[13],d[3]=a[3]*h+a[7]*g+a[15],d}const Us=100;class _a{constructor(t,a,h=new Dp(t.width+200,t.height+200,25),g=new Dp(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=g,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Us,this.screenBottomBoundary=t.height+Us,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,h,g,y,b,S,M,D,O,j){let B=h.projectedAnchorX,q=h.projectedAnchorY,H=h.projectedAnchorZ;const Z=h.tileAnchorX,re=h.tileAnchorY,$=h.elevation,ae=h.tileID,pe=t.getProjection();if($&&ae){const[mt,$e,pt]=pe.upVector(ae.canonical,h.tileAnchorX,h.tileAnchorY),Ht=pe.upVectorScale(ae.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=mt*$*Ht,q+=$e*$*Ht,H+=pt*$*Ht}const ye=t.projection.name==="globe",Ce=t.projection.name==="globe"?r.aj(this.transform.zoom):0;if(ae&&ye&&Ce<1&&!b){const mt=1<<ae.canonical.z,$e=r.bP(Z,re);r.bQ($e,$e,1/r.al),r.bR($e,$e,r.bP(ae.canonical.x,ae.canonical.y)),r.bQ($e,$e,1/mt),r.bS($e,$e,r.bP(g[0],g[1])),$e[0]=r.bT($e[0],-.5,.5),r.bQ($e,$e,r.al);const pt=r.bU($e[0],$e[1],r.al/(2*Math.PI),1);r.aC(pt,pt,y),B=r.ak(B,pt[0],Ce),q=r.ak(q,pt[1],Ce),H=r.ak(H,pt[2],Ce)}const Ae=this.projectAndGetPerspectiveRatio(O,B,q,H,h.tileID,pe.name==="globe"||!!$||this.transform.pitch>0,pe),ke=D*Ae.perspectiveRatio,Me=(h.x1*a+S.x-h.padding)*ke+Ae.point.x,Ee=(h.y1*a+S.y-h.padding)*ke+Ae.point.y,ze=(h.x2*a+S.x+h.padding)*ke+Ae.point.x,ot=(h.y2*a+S.y+h.padding)*ke+Ae.point.y,Ze=Ae.perspectiveRatio<=.55||Ae.occluded;return!this.isInsideGrid(Me,Ee,ze,ot)||!M&&this.grid.hitTest(Me,Ee,ze,ot,j)||Ze?{box:[],offscreen:!1,occluded:Ae.occluded}:{box:[Me,Ee,ze,ot],offscreen:this.isOffscreen(Me,Ee,ze,ot),occluded:!1}}placeCollisionCircles(t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z){const re=[],$=this.transform.elevation,ae=t.getProjection(),pe=$?$.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,ae):null,ye=new r.P(h.tileAnchorX,h.tileAnchorY);let{x:Ce,y:Ae,z:ke}=ae.projectTilePoint(ye.x,ye.y,Z.canonical);if(pe){const[Ct,qt,nn]=pe(ye);Ce+=Ct,Ae+=qt,ke+=nn}const Me=ae.name==="globe",Ee=this.projectAndGetPerspectiveRatio(S,Ce,Ae,ke,Z,Me||!!$||this.transform.pitch>0,ae),{perspectiveRatio:ze}=Ee,ot=(j?b/ze:b*ze)/r.bX,Ze=Ns(Ce,Ae,ke,M),mt=h.lineOffsetX*ot,$e=h.lineOffsetY*ot,pt=r.an(t.layers[0].layout.get("text-max-angle")),Ht=Math.cos(pt),rt=Ee.signedDistanceFromCamera>0?wd(ot,y,mt,$e,!1,Ze,ye,h,g,M,{},$&&!j?pe:null,j&&!!$,ae,Z,j,Ht):null;let Ue=!1,xt=!1,ct=!0;if(rt&&!Ee.occluded){const Ct=.5*q*ze+H,qt=new r.P(-100,-100),nn=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Vt=new P_,{first:Ot,last:vn}=rt,gn=Ot.path.length;let yn=[];for(let ii=gn-1;ii>=1;ii--)yn.push(Ot.path[ii]);for(let ii=1;ii<vn.path.length;ii++)yn.push(vn.path[ii]);const mn=2.5*Ct;D&&(yn=yn.map((([ii,ai,Xi],Jn)=>(pe&&!Me&&(Xi=pe(Jn<gn-1?Ot.tilePath[gn-1-Jn]:vn.tilePath[Jn-gn+2])[2]),Ns(ii,ai,Xi,D)))),yn.some((ii=>ii[3]<=0))&&(yn=[]));let qn=[];if(yn.length>0){let ii=1/0,ai=-1/0,Xi=1/0,Jn=-1/0;for(const Pi of yn)ii=Math.min(ii,Pi[0]),Xi=Math.min(Xi,Pi[1]),ai=Math.max(ai,Pi[0]),Jn=Math.max(Jn,Pi[1]);ai>=qt.x&&ii<=nn.x&&Jn>=qt.y&&Xi<=nn.y&&(qn=[yn.map((Pi=>new r.P(Pi[0],Pi[1])))],(ii<qt.x||ai>nn.x||Xi<qt.y||Jn>nn.y)&&(qn=r.bV(qn,qt.x,qt.y,nn.x,nn.y)))}for(const ii of qn){Vt.reset(ii,.25*Ct);let ai=0;ai=Vt.length<=.5*Ct?1:Math.ceil(Vt.paddedLength/mn)+1;for(let Xi=0;Xi<ai;Xi++){const Jn=Xi/Math.max(ai-1,1),Pi=Vt.lerp(Jn),ji=Pi.x+Us,wr=Pi.y+Us;re.push(ji,wr,Ct,0);const ri=ji-Ct,Fi=wr-Ct,Di=ji+Ct,Ni=wr+Ct;if(ct=ct&&this.isOffscreen(ri,Fi,Di,Ni),xt=xt||this.isInsideGrid(ri,Fi,Di,Ni),!a&&this.grid.hitTestCircle(ji,wr,Ct,B)&&(Ue=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Ue,occluded:!1}}}}return{circles:!O&&Ue||!xt?[]:re,offscreen:ct,collisionDetected:Ue,occluded:Ee.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let h=1/0,g=1/0,y=-1/0,b=-1/0;for(const O of t){const j=new r.P(O.x+Us,O.y+Us);h=Math.min(h,j.x),g=Math.min(g,j.y),y=Math.max(y,j.x),b=Math.max(b,j.y),a.push(j)}const S=this.grid.query(h,g,y,b).concat(this.ignoredGrid.query(h,g,y,b)),M={},D={};for(const O of S){const j=O.key;if(M[j.bucketInstanceId]===void 0&&(M[j.bucketInstanceId]={}),M[j.bucketInstanceId][j.featureIndex])continue;const B=[new r.P(O.x1,O.y1),new r.P(O.x2,O.y1),new r.P(O.x2,O.y2),new r.P(O.x1,O.y2)];r.bW(a,B)&&(M[j.bucketInstanceId][j.featureIndex]=!0,D[j.bucketInstanceId]===void 0&&(D[j.bucketInstanceId]=[]),D[j.bucketInstanceId].push(j.featureIndex))}return D}insertCollisionBox(t,a,h,g,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,h,g,y){const b=a?this.ignoredGrid:this.grid,S={bucketInstanceId:h,featureIndex:g,collisionGroupID:y};for(let M=0;M<t.length;M+=4)b.insertCircle(S,t[M],t[M+1],t[M+2])}projectAndGetPerspectiveRatio(t,a,h,g,y,b,S){const M=[a,h,g,1];let D=!1;g||this.transform.pitch>0?(r.aC(M,M,t),this.fogState&&y&&S.name!=="globe"&&(D=(function(B,q,H,Z,re,$){const ae=$.calculateFogTileMatrix(re),pe=[q,H,Z];return r.af(pe,pe,ae),An(B,r.ag(pe),$.pitch,$._fov)})(this.fogState,a,h,g,y.toUnwrapped(),this.transform)>.9)):Bp(M,M,t);const O=M[3];return{point:new r.P((M[0]/O+1)/2*this.transform.width+Us,(-M[1]/O+1)/2*this.transform.height+Us),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/O*.5,1.5),signedDistanceFromCamera:O,occluded:b&&M[2]>O||D}}isOffscreen(t,a,h,g){return h<Us||t>=this.screenRightBoundary||g<Us||a>this.screenBottomBoundary}isInsideGrid(t,a,h,g){return h>=0&&t<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=r.bA([]);return r.br(t,t,[-100,-100,0]),t}}class Sd{constructor(t,a,h,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):g&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Pa{constructor(t,a,h,g,y,b=!1){this.text=new Sd(t?t.text:null,a,h,y),this.icon=new Sd(t?t.icon:null,a,g,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class bn{constructor(t,a,h,g=!1){this.text=t,this.icon=a,this.skipFade=h,this.clipped=g}}class Zi{constructor(){this.invProjMatrix=r.bC(),this.viewportMatrix=r.bC(),this.circles=[]}}class Ji{constructor(t,a,h,g,y){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=y}}class As{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:h=>h.collisionGroupID===a}}return this.collisionGroups[t]}}function uc(d,t,a,h,g){const{horizontalAlign:y,verticalAlign:b}=r.c0(d),S=-(y-.5)*t,M=-(b-.5)*a,D=r.c1(d,h);return new r.P(S+D[0]*g,M+D[1]*g)}function Bi(d,t,a,h,g){const y=new r.P(d,t);return a&&y._rotate(h?g:-g),y}class Ed{constructor(t,a,h,g,y,b){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new _a(this.transform,y),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new As(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,h,g,y=1){const b=h.getBucket(a),S=h.latestFeatureIndex;if(!b||!S||a.fqid!==b.layerIds[0])return;const M=b.layers[0].layout,D=b.layers[0].paint,O=h.collisionBoxArray,j=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),B=h.tileSize/r.al,q=h.tileID.toUnwrapped();this.transform.setProjection(b.projection);const H=(Z=h.tileID,re=b.getProjection(),$=this.transform,re.name===this.projection?$.calculateProjMatrix(Z.toUnwrapped()):vd($,re,Z));var Z,re,$;const ae=M.get("text-pitch-alignment")==="map",pe=M.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const ye=a.dynamicFilter(),Ce=a.dynamicFilterNeedsFeature(),Ae=this.transform.calculatePixelsToTileUnitsMatrix(h),ke=lh(H,h.tileID.canonical,ae,pe,this.transform,b.getProjection(),Ae);let Me=null;const Ee=b.getProjection().createInversionMatrix(this.transform,h.tileID.canonical);if(ae){const Ue=bd(H,h.tileID.canonical,ae,pe,this.transform,b.getProjection(),Ae);Me=r.aB([],this.transform.labelPlaneMatrix,Ue)}let ze=null;ye&&h.latestFeatureIndex&&(ze={unwrappedTileID:q,dynamicFilter:ye,dynamicFilterNeedsFeature:Ce}),this.retainedQueryData[b.bucketInstanceId]=new Ji(b.bucketInstanceId,S,b.sourceLayerIndex,b.index,h.tileID);const[ot,Ze]=b.layers[0].layout.get("text-size-scale-range"),mt=r.aA(y,ot,Ze),[$e,pt]=M.get("icon-size-scale-range"),Ht=r.aA(y,$e,pt),rt={bucket:b,layout:M,paint:D,posMatrix:H,invMatrix:Ee,mercatorCenter:[r.aF(this.transform.center.lng),r.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ke,labelToScreenMatrix:Me,clippingData:ze,scale:j,textPixelRatio:B,holdingForFade:h.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:r.bK(b.textSizeData,this.transform.zoom,mt),partiallyEvaluatedIconSize:r.bK(b.iconSizeData,this.transform.zoom,Ht),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:h.latestFeatureIndex};if(g)for(const Ue of b.sortKeyRanges){const{sortKey:xt,symbolInstanceStart:ct,symbolInstanceEnd:Ct}=Ue;t.push({sortKey:xt,symbolInstanceStart:ct,symbolInstanceEnd:Ct,parameters:rt})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:rt})}attemptAnchorPlacement(t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z,re,$,ae,pe,ye,Ce){const{textOffset0:Ae,textOffset1:ke,crossTileID:Me}=Z,Ee=[Ae,ke],ze=uc(t,b,S,Ee,M),ot=this.collisionIndex.placeCollisionBox($,M,a,h,g,y,Bi(ze.x,ze.y,D,O,this.transform.angle),H,j,B,q.predicate);if(pe){const Ze=$.getSymbolInstanceIconSize(Ce,this.transform.zoom,Z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox($,Ze,pe,h,g,y,Bi(ze.x,ze.y,D,O,this.transform.angle),H,j,B,q.predicate).box.length===0)return}if(ot.box.length>0){let Ze;return this.prevPlacement&&this.prevPlacement.variableOffsets[Me]&&this.prevPlacement.placements[Me]&&this.prevPlacement.placements[Me].text&&(Ze=this.prevPlacement.variableOffsets[Me].anchor),this.variableOffsets[Me]={textOffset:Ee,width:b,height:S,anchor:t,textScale:M,prevAnchor:Ze},this.markUsedJustification($,t,Z,ae),$.allowVerticalPlacement&&(this.markUsedOrientation($,ae,Z),this.placedOrientations[Me]=ae),{shift:ze,placedGlyphBoxes:ot}}}placeLayerBucketPart(t,a,h,g,y=1){const{bucket:b,layout:S,paint:M,posMatrix:D,textLabelPlaneMatrix:O,labelToScreenMatrix:j,clippingData:B,textPixelRatio:q,mercatorCenter:H,invMatrix:Z,holdingForFade:re,collisionBoxArray:$,partiallyEvaluatedTextSize:ae,partiallyEvaluatedIconSize:pe,collisionGroup:ye,latestFeatureIndex:Ce}=t.parameters,Ae=S.get("text-optional"),ke=S.get("icon-optional"),Me=S.get("text-allow-overlap"),Ee=S.get("icon-allow-overlap"),ze=S.get("text-rotation-alignment")==="map",ot=S.get("icon-rotation-alignment")==="map",Ze=S.get("text-pitch-alignment")==="map",mt=M.get("symbol-z-offset"),$e=S.get("symbol-elevation-reference")==="sea",pt=S.get("symbol-placement"),[Ht,rt]=S.get("text-size-scale-range"),[Ue,xt]=S.get("icon-size-scale-range"),ct=r.aA(y,Ht,rt),Ct=r.aA(y,Ue,xt),qt=S.get("text-variable-anchor"),nn=ze&&pt!=="point",Vt=ot&&pt!=="point",Ot=qt&&b.hasTextData(),vn=b.hasIconTextFit()&&Ot&&b.hasIconData();this.transform.setProjection(b.projection);const gn=Ot||nn,yn=Vt||vn;let mn=Me&&(Ee||!b.hasIconData()||ke),qn=Ee&&(Me||!b.hasTextData()||Ae);const ii=!mt.isConstant();!b.collisionArrays&&$&&b.deserializeCollisionBoxes($),h&&g&&b.updateCollisionDebugBuffers(this.transform.zoom,$,ct,Ct);const ai=(Jn,Pi,ji)=>{const{crossTileID:wr,numVerticalGlyphVertices:ri}=Jn;let Fi=null;if(B&&B.dynamicFilterNeedsFeature||ii){const Hr=this.retainedQueryData[b.bucketInstanceId];Fi=Ce.loadFeature({featureIndex:Jn.featureIndex,bucketIndex:Hr.bucketIndex,sourceLayerIndex:Hr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Fi,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new r.P(Jn.tileAnchorX,Jn.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[wr]=new bn(!1,!1,!1,!0),void a.add(wr);const Di=mt.evaluate(Fi,{});if(a.has(wr))return;if(re)return void(this.placements[wr]=new bn(!1,!1,!1));let Ni=!1,Ar=!1,Yr=!0,Ro=!1,Ir=!1,li=null,Fn={box:null,offscreen:null,occluded:null},Yi={box:null},jr=null,Dr=null,lo=null,Bo=0,qs=0,Hs=0;ji.textFeatureIndex?Bo=ji.textFeatureIndex:Jn.useRuntimeCollisionCircles&&(Bo=Jn.featureIndex),ji.verticalTextFeatureIndex&&(qs=ji.verticalTextFeatureIndex);const Ms=Hr=>{Hr.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Kr=this.transform.elevation;Hr.elevation=$e?Di:Di+(Kr?Kr.getAtTileOffset(Hr.tileID,Hr.tileAnchorX,Hr.tileAnchorY):0),Hr.elevation+=Jn.zOffset},Cs=ji.textBox;if(Cs){Ms(Cs);const Hr=Lr=>{let xo=r.bL.horizontal;if(b.allowVerticalPlacement&&!Lr&&this.prevPlacement){const zo=this.prevPlacement.placedOrientations[wr];zo&&(this.placedOrientations[wr]=zo,xo=zo,this.markUsedOrientation(b,xo,Jn))}return xo},Kr=(Lr,xo)=>{if(b.allowVerticalPlacement&&ri>0&&ji.verticalTextBox){for(const zo of b.writingModes)if(zo===r.bL.vertical?(Fn=xo(),Yi=Fn):Fn=Lr(),Fn&&Fn.box&&Fn.box.length)break}else Fn=Lr()};if(qt){let Lr=qt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[wr]){const io=this.prevPlacement.variableOffsets[wr];Lr.indexOf(io.anchor)>0&&(Lr=Lr.filter((Ko=>Ko!==io.anchor)),Lr.unshift(io.anchor))}const xo=(io,Ko,Oa)=>{const nl=b.getSymbolInstanceTextSize(ae,Jn,this.transform.zoom,Pi),Sa=(io.x2-io.x1)*nl+2*io.padding,Wl=(io.y2-io.y1)*nl+2*io.padding,ql=Jn.hasIconTextFit&&!Ee?Ko:null;ql&&Ms(ql);let Fa={box:[],offscreen:!1,occluded:!1};const ku=Me?2*Lr.length:Lr.length;for(let il=0;il<ku;++il){const Ba=this.attemptAnchorPlacement(Lr[il%Lr.length],io,H,Z,gn,Sa,Wl,nl,ze,Ze,q,D,ye,il>=Lr.length,Jn,Pi,b,Oa,ql,ae,pe);if(Ba&&(Fa=Ba.placedGlyphBoxes,Fa&&Fa.box&&Fa.box.length)){Ni=!0,li=Ba.shift;break}}return Fa};Kr((()=>xo(Cs,ji.iconBox,r.bL.horizontal)),(()=>{const io=ji.verticalTextBox;return io&&Ms(io),b.allowVerticalPlacement&&!(Fn&&Fn.box&&Fn.box.length)&&ri>0&&io?xo(io,ji.verticalIconBox,r.bL.vertical):{box:null,offscreen:null,occluded:null}})),Fn&&(Ni=Fn.box,Yr=Fn.offscreen,Ro=Fn.occluded);const zo=Hr(!(!Fn||!Fn.box));if(!Ni&&this.prevPlacement){const io=this.prevPlacement.variableOffsets[wr];io&&(this.variableOffsets[wr]=io,this.markUsedJustification(b,io.anchor,Jn,zo))}}else{const Lr=(xo,zo)=>{const io=b.getSymbolInstanceTextSize(ae,Jn,this.transform.zoom,Pi),Ko=this.collisionIndex.placeCollisionBox(b,io,xo,H,Z,gn,new r.P(0,0),Me,q,D,ye.predicate);return Ko&&Ko.box&&Ko.box.length&&(this.markUsedOrientation(b,zo,Jn),this.placedOrientations[wr]=zo),Ko};Kr((()=>Lr(Cs,r.bL.horizontal)),(()=>{const xo=ji.verticalTextBox;return b.allowVerticalPlacement&&ri>0&&xo?(Ms(xo),Lr(xo,r.bL.vertical)):{box:null,offscreen:null,occluded:null}})),Hr(!!(Fn&&Fn.box&&Fn.box.length))}}if(jr=Fn,Ni=jr&&jr.box&&jr.box.length>0,Yr=jr&&jr.offscreen,Ro=jr&&jr.occluded,Jn.useRuntimeCollisionCircles){const Hr=b.text.placedSymbolArray.get(Jn.centerJustifiedTextSymbolIndex>=0?Jn.centerJustifiedTextSymbolIndex:Jn.verticalPlacedTextSymbolIndex),Kr=r.bM(b.textSizeData,ae,Hr),Lr=S.get("text-padding");Dr=this.collisionIndex.placeCollisionCircles(b,Me,Hr,b.lineVertexArray,b.glyphOffsetArray,Kr,D,O,j,h,Ze,ye.predicate,Jn.collisionCircleDiameter*Kr/r.bX,Lr,this.retainedQueryData[b.bucketInstanceId].tileID),Ni=Me||Dr.circles.length>0&&!Dr.collisionDetected,Yr=Yr&&Dr.offscreen,Ro=Dr.occluded}if(ji.iconFeatureIndex&&(Hs=ji.iconFeatureIndex),ji.iconBox){const Hr=Kr=>{Ms(Kr);const Lr=Jn.hasIconTextFit&&li?Bi(li.x,li.y,ze,Ze,this.transform.angle):new r.P(0,0),xo=b.getSymbolInstanceIconSize(pe,this.transform.zoom,Jn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,xo,Kr,H,Z,yn,Lr,Ee,q,D,ye.predicate)};Yi&&Yi.box&&Yi.box.length&&ji.verticalIconBox?(lo=Hr(ji.verticalIconBox),Ar=lo.box.length>0):(lo=Hr(ji.iconBox),Ar=lo.box.length>0),Yr=Yr&&lo.offscreen,Ir=lo.occluded}const ms=Ae||Jn.numHorizontalGlyphVertices===0&&ri===0,sa=ke||Jn.numIconVertices===0;if(ms||sa?sa?ms||(Ar=Ar&&Ni):Ni=Ar&&Ni:Ar=Ni=Ar&&Ni,Ni&&jr&&jr.box&&this.collisionIndex.insertCollisionBox(jr.box,S.get("text-ignore-placement"),b.bucketInstanceId,Yi&&Yi.box&&qs?qs:Bo,ye.ID),Ar&&lo&&this.collisionIndex.insertCollisionBox(lo.box,S.get("icon-ignore-placement"),b.bucketInstanceId,Hs,ye.ID),Dr&&(Ni&&this.collisionIndex.insertCollisionCircles(Dr.circles,S.get("text-ignore-placement"),b.bucketInstanceId,Bo,ye.ID),h)){const Hr=b.bucketInstanceId;let Kr=this.collisionCircleArrays[Hr];Kr===void 0&&(Kr=this.collisionCircleArrays[Hr]=new Zi);for(let Lr=0;Lr<Dr.circles.length;Lr+=4)Kr.circles.push(Dr.circles[Lr+0]),Kr.circles.push(Dr.circles[Lr+1]),Kr.circles.push(Dr.circles[Lr+2]),Kr.circles.push(Dr.collisionDetected?1:0)}const Ta=b.projection.name!=="globe";mn=mn&&(Ta||!Ro),qn=qn&&(Ta||!Ir),this.placements[wr]=new bn(Ni||mn,Ar||qn,Yr||b.justReloaded),a.add(wr)},Xi=this.retainedQueryData[b.bucketInstanceId].tileID;if(b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,Xi),b.elevationType==="road"&&b.updateRoadElevation(Xi.canonical),b.updateZOffset(),b.sortFeaturesByY){const Jn=b.getSortedSymbolIndexes(this.transform.angle);for(let Pi=Jn.length-1;Pi>=0;--Pi){const ji=Jn[Pi];ai(b.symbolInstances.get(ji),ji,b.collisionArrays[ji])}b.hasAnyZOffset&&r.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){const Jn=b.getSortedIndexesByZOffset();for(let Pi=0;Pi<Jn.length;++Pi){const ji=Jn[Pi];ai(b.symbolInstances.get(ji),ji,b.collisionArrays[ji])}}else for(let Jn=t.symbolInstanceStart;Jn<t.symbolInstanceEnd;Jn++)ai(b.symbolInstances.get(Jn),Jn,b.collisionArrays[Jn]);if(h&&b.bucketInstanceId in this.collisionCircleArrays){const Jn=this.collisionCircleArrays[b.bucketInstanceId];r.bl(Jn.invProjMatrix,D),Jn.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(t,a,h,g){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:M,crossTileID:D}=h,O=r.c2(a),j=g===r.bL.vertical?M:O==="left"?y:O==="center"?b:O==="right"?S:-1;y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=j>=0&&y!==j?0:D),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=j>=0&&b!==j?0:D),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=j>=0&&S!==j?0:D),M>=0&&(t.text.placedSymbolArray.get(M).crossTileID=j>=0&&M!==j?0:D)}markUsedOrientation(t,a,h){const g=a===r.bL.horizontal||a===r.bL.horizontalOnly?a:0,y=a===r.bL.vertical?a:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:D}=h,O=t.text.placedSymbolArray;b>=0&&(O.get(b).placedOrientation=g),S>=0&&(O.get(S).placedOrientation=g),M>=0&&(O.get(M).placedOrientation=g),D>=0&&(O.get(D).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let h=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(t):1,y=a?a.opacities:{},b=a?a.variableOffsets:{},S=a?a.placedOrientations:{};for(const M in this.placements){const D=this.placements[M],O=y[M];O?(this.opacities[M]=new Pa(O,g,D.text,D.icon,null,D.clipped),h=h||D.text!==O.text.placed||D.icon!==O.icon.placed):(this.opacities[M]=new Pa(null,g,D.text,D.icon,D.skipFade,D.clipped),h=h||D.text||D.icon)}for(const M in y){const D=y[M];if(!this.opacities[M]){const O=new Pa(D,g,!1,!1);O.isHidden()||(this.opacities[M]=O,h=h||D.text.placed||D.icon.placed)}}for(const M in b)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=b[M]);for(const M in S)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=S[M]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a,h,g){const y=new Set;for(const b of a){const S=b.getBucket(t);S&&b.latestFeatureIndex&&t.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,y,b,b.collisionBoxArray,h,g,b.tileID,t.scope),S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,b.tileID),S.elevationType==="road"&&S.updateRoadElevation(b.tileID.canonical),S.updateZOffset())}}updateBucketOpacities(t,a,h,g,y,b,S,M){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const D=t.layers[0].layout,O=t.layers[0].paint,j=!!t.layers[0].dynamicFilter(),B=new Pa(null,0,!1,!1,!0),q=D.get("text-allow-overlap"),H=D.get("icon-allow-overlap"),Z=D.get("text-variable-anchor"),re=D.get("text-rotation-alignment")==="map",$=D.get("text-pitch-alignment")==="map",ae=O.get("symbol-z-offset"),pe=D.get("symbol-elevation-reference")==="sea",ye=!ae.isConstant(),Ce=new Pa(null,0,q&&(H||!t.hasIconData()||D.get("icon-optional")),H&&(q||!t.hasTextData()||D.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);const Ae=(Me,Ee,ze)=>{for(let ot=0;ot<Ee/4;ot++)Me.opacityVertexArray.emplaceBack(ze)};let ke=0;b&&t.updateReplacement(S,b);for(let Me=0;Me<t.symbolInstances.length;Me++){const Ee=t.symbolInstances.get(Me),{numHorizontalGlyphVertices:ze,numVerticalGlyphVertices:ot,crossTileID:Ze,numIconVertices:mt,tileAnchorX:$e,tileAnchorY:pt}=Ee;let Ht=null;const rt=this.retainedQueryData[t.bucketInstanceId];ye&&Ee&&rt&&(Ht=h.latestFeatureIndex.loadFeature({featureIndex:Ee.featureIndex,bucketIndex:rt.bucketIndex,sourceLayerIndex:rt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ue=ae.evaluate(Ht,{}),xt=a.has(Ze);let ct=this.opacities[Ze];xt?ct=B:ct||(ct=Ce,this.opacities[Ze]=ct),a.add(Ze);const Ct=ze>0||ot>0,qt=mt>0,nn=this.placedOrientations[Ze],Vt=nn===r.bL.vertical,Ot=nn===r.bL.horizontal||nn===r.bL.horizontalOnly;!Ct&&!qt||ct.isHidden()||ke++;let vn=!1;if((Ct||qt)&&b)for(const gn of t.activeReplacements){if(r.bY(gn,y,r.bZ.Symbol,M)||gn.min.x>$e||$e>gn.max.x||gn.min.y>pt||pt>gn.max.y)continue;const yn=r.b_($e,pt,S.canonical,gn.footprintTileId.canonical);if(vn=r.b$(yn,gn.footprint),vn)break}if(Ct){const gn=vn?Ml:dh(ct.text);Ae(t.text,ze,Vt?Ml:gn),Ae(t.text,ot,Ot?Ml:gn);const yn=ct.text.isHidden(),{leftJustifiedTextSymbolIndex:mn,centerJustifiedTextSymbolIndex:qn,rightJustifiedTextSymbolIndex:ii,verticalPlacedTextSymbolIndex:ai}=Ee,Xi=t.text.placedSymbolArray,Jn=yn||Vt?1:0;mn>=0&&(Xi.get(mn).hidden=Jn),qn>=0&&(Xi.get(qn).hidden=Jn),ii>=0&&(Xi.get(ii).hidden=Jn),ai>=0&&(Xi.get(ai).hidden=yn||Ot?1:0);const Pi=this.variableOffsets[Ze];Pi&&this.markUsedJustification(t,Pi.anchor,Ee,nn);const ji=this.placedOrientations[Ze];ji&&(this.markUsedJustification(t,"left",Ee,ji),this.markUsedOrientation(t,ji,Ee))}if(qt){const gn=vn?Ml:dh(ct.icon),{placedIconSymbolIndex:yn,verticalPlacedIconSymbolIndex:mn}=Ee,qn=t.icon.placedSymbolArray,ii=ct.icon.isHidden()?1:0;yn>=0&&(Ae(t.icon,mt,Vt?Ml:gn),qn.get(yn).hidden=ii),mn>=0&&(Ae(t.icon,Ee.numVerticalIconVertices,Ot?Ml:gn),qn.get(mn).hidden=ii)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const gn=t.collisionArrays[Me];if(gn){let yn=new r.P(0,0),mn=!0;if(gn.textBox||gn.verticalTextBox){if(Z){const ii=this.variableOffsets[Ze];ii?(yn=uc(ii.anchor,ii.width,ii.height,ii.textOffset,ii.textScale),re&&yn._rotate($?this.transform.angle:-this.transform.angle)):mn=!1}j&&(mn=!ct.clipped),gn.textBox&&Il(t.textCollisionBox.collisionVertexArray,ct.text.placed,!mn||Vt,Ue,pe,yn.x,yn.y),gn.verticalTextBox&&Il(t.textCollisionBox.collisionVertexArray,ct.text.placed,!mn||Ot,Ue,pe,yn.x,yn.y)}const qn=mn&&!!(!Ot&&gn.verticalIconBox);gn.iconBox&&Il(t.iconCollisionBox.collisionVertexArray,ct.icon.placed,qn,Ue,pe,Ee.hasIconTextFit?yn.x:0,Ee.hasIconTextFit?yn.y:0),gn.verticalIconBox&&Il(t.iconCollisionBox.collisionVertexArray,ct.icon.placed,!qn,Ue,pe,Ee.hasIconTextFit?yn.x:0,Ee.hasIconTextFit?yn.y:0)}}}if(t.fullyClipped=ke===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Me.invProjMatrix,t.placementViewportMatrix=Me.viewportMatrix,t.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const h=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function Il(d,t,a,h,g,y,b){d.emplaceBack(t?1:0,a?1:0,y||0,b||0,h,g?1:0),d.emplaceBack(t?1:0,a?1:0,y||0,b||0,h,g?1:0),d.emplaceBack(t?1:0,a?1:0,y||0,b||0,h,g?1:0),d.emplaceBack(t?1:0,a?1:0,y||0,b||0,h,g?1:0)}const ch=Math.pow(2,25),os=Math.pow(2,24),yo=Math.pow(2,17),vx=Math.pow(2,16),uh=Math.pow(2,9),Np=Math.pow(2,8),hh=Math.pow(2,1);function dh(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,a=Math.floor(127*d.opacity);return a*ch+t*os+a*yo+t*vx+a*uh+t*Np+a*hh+t}const Ml=0;class Ad{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,a,h,g,y,b){const S=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(S,g,t[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(((M,D)=>M.sortKey-D.sortKey)));this._currentPartIndex<S.length;){const M=S[this._currentPartIndex];if(a.placeLayerBucketPart(M,this._seenCrossTileIDs,h,M.symbolInstanceStart===0,b),this._currentPartIndex++,y())return!0}return!1}}class ds{constructor(t,a,h,g,y,b,S,M,D){this.placement=new Ed(t,y,b,S,M,D),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,a,h,g,y){const b=r.o.now(),S=()=>{const M=r.o.now()-b;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=a[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=D)&&(!M.maxzoom||M.maxzoom>D)){const O=M,j=O.layout.get("symbol-z-elevate"),B=O.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=O.layout.get("symbol-z-order"),H=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&B),Z=O.layout.get("text-allow-overlap")||O.layout.get("icon-allow-overlap")||O.layout.get("text-ignore-placement")||O.layout.get("icon-ignore-placement"),re=H&&Z,$=this._inProgressLayer=this._inProgressLayer||new Ad(O),ae=r.B(M.source,M.scope);if($.continuePlacement(j||re?g[ae]:h[ae],this.placement,this._showCollisionBoxes,M,S,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ya=512/r.al/2;class ws{constructor(t,a,h){this.tileID=t,this.bucketInstanceId=h,this.index=new r.c3(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=t.canonical.x*r.al,y=t.canonical.y*r.al;for(let b=0;b<a.length;b++){const{key:S,crossTileID:M,tileAnchorX:D,tileAnchorY:O}=a.get(b),j=Math.floor((g+D)*ya),B=Math.floor((y+O)*ya);this.index.add(j,B),this.keys.push(S),this.crossTileIDs.push(M)}this.index.finish()}findMatches(t,a,h){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),y=ya/Math.pow(2,a.canonical.z-this.tileID.canonical.z),b=a.canonical.x*r.al,S=a.canonical.y*r.al;for(let M=0;M<t.length;M++){const D=t.get(M);if(D.crossTileID)continue;const{key:O,tileAnchorX:j,tileAnchorY:B}=D,q=Math.floor((b+j)*y),H=Math.floor((S+B)*y),Z=this.index.range(q-g,H-g,q+g,H+g).sort(((re,$)=>re-$));for(const re of Z){const $=this.crossTileIDs[re];if(this.keys[re]===O&&!h.has($)){h.add($),D.crossTileID=$;break}}}}}class R_{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ou{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const h in this.indexes){const g=this.indexes[h],y={};for(const b in g){const S=g[b];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+a),y[S.tileID.key]=S}this.indexes[h]=y}this.lng=t}addBucket(t,a,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<a.symbolInstances.length;y++)a.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const g=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>t.overscaledZ)for(const S in b){const M=b[S];M.tileID.isChildOf(t)&&M.findMatches(a.symbolInstances,t,g)}else{const S=b[t.scaledTo(Number(y)).key];S&&S.findMatches(a.symbolInstances,t,g)}}for(let y=0;y<a.symbolInstances.length;y++){const b=a.symbolInstances.get(y);b.crossTileID||(b.crossTileID=h.generate(),g.add(b.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ws(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const h of a.crossTileIDs)this.usedCrossTileIDs[t].delete(h)}removeStaleBuckets(t){let a=!1;for(const h in this.indexes){const g=this.indexes[h];for(const y in g)t[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[y]),delete g[y],a=!0)}return a}}class ko{constructor(){this.layerIndexes={},this.crossTileIDs=new R_,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,h,g){let y=this.layerIndexes[t.fqid];y===void 0&&(y=this.layerIndexes[t.fqid]=new ou);let b=!1;const S={};g.name!=="globe"&&y.handleWrapJump(h);for(const M of a){const D=M.getBucket(t);D&&t.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(M.tileID,D,this.crossTileIDs)&&(b=!0),S[D.bucketInstanceId]=!0)}return y.removeStaleBuckets(S)&&(b=!0),b}pruneUnusedLayers(t){const a={};t.forEach((h=>{a[h]=!0}));for(const h in this.layerIndexes)a[h]||delete this.layerIndexes[h]}}const Ts=771;class si{constructor(t,a,h,g){this.blendFunction=t,this.blendColor=a.toNonPremultipliedRenderColor(null),this.mask=h,this.blendEquation=g}}si.Replace=[1,0,1,0],si.disabled=new si(si.Replace,r.ao.transparent,[!1,!1,!1,!1]),si.unblended=new si(si.Replace,r.ao.transparent,[!0,!0,!0,!0]),si.alphaBlended=new si([1,Ts,1,Ts],r.ao.transparent,[!0,!0,!0,!0]),si.alphaBlendedNonPremultiplied=new si([770,Ts,770,Ts],r.ao.transparent,[!0,!0,!0,!0]),si.multiply=new si([774,0,774,0],r.ao.transparent,[!0,!0,!0,!0]);class an{constructor(t,a,h){this.func=t,this.mask=a,this.range=h}}an.ReadOnly=!1,an.ReadWrite=!0,an.disabled=new an(519,an.ReadOnly,[0,1]);const fh=7680;class On{constructor(t,a,h,g,y,b){this.test=t,this.ref=a,this.mask=h,this.fail=g,this.depthFail=y,this.pass=b}}On.disabled=new On({func:519,mask:0},0,0,fh,fh,fh);const hc=1029,su=2305;class jn{constructor(t,a,h){this.enable=t,this.mode=a,this.frontFace=h}}function Vp(d,t){const a=r.c9(d,3);r.cb(d,t),r.cf(d,3,a)}function ph(d,t){const a=r.c6([]);return r.c7(a,a,-t),r.c8(a,a,-d),a}function mh(d,t){const a=[d[0],d[1],0],h=[t[0],t[1],0];if(r.ag(a)>=1e-15){const b=r.aw([],a);r.c4(h,b,r.bJ(h,b)),t[0]=h[0],t[1]=h[1]}const g=r.bI([],t,d);if(r.c5(g)<1e-15)return null;const y=Math.atan2(-g[1],g[0]);return ph(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),y)}jn.disabled=new jn(!1,hc,su),jn.backCCW=new jn(!0,hc,su),jn.backCW=new jn(!0,hc,2304),jn.frontCW=new jn(!0,1028,2304),jn.frontCCW=new jn(!0,1028,su);class Up{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){const a=t instanceof r.ae?t:new r.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=r.bT(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a){if(this.orientation=null,!this.position)return;const h=this.position,g=this._elevation?this._elevation.getAtPointOrZero(r.ae.fromLngLat(t)):0,y=r.ae.fromLngLat(t,g),b=[y.x-h.x,y.y-h.y,y.z-h.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=mh(b,a)}setPitchBearing(t,a){this.orientation=ph(r.an(t),r.an(-a))}}class Id{constructor(t,a){this._transform=r.bA([]),this.orientation=a,this.position=t}get mercatorPosition(){const t=this.position;return new r.ae(t[0],t[1],t[2])}get position(){const t=r.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&r.cf(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.c6([]),t&&Vp(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=ph(t,a),Vp(this._transform,this._orientation)}forward(){const t=r.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const h=new Float64Array(16);return r.bl(h,this.getWorldToCamera(t,a)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,a,h){const g=this.position;r.c4(g,g,-t);const y=new Float64Array(16);return r.bq(y,[h,h,h]),r.br(y,y,g),y[10]*=a,y}getWorldToCamera(t,a){const h=new Float64Array(16),g=new Float64Array(4),y=this.position;return r.ca(g,this._orientation),r.c4(y,y,-t),r.cb(h,g),r.br(h,h,y),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=a,h[9]*=a,h[10]*=a,h[11]*=a,h}getCameraToClipPerspective(t,a,h,g){const y=new Float64Array(16);return r.cc(y,t,a,h,g),y}getCameraToClipOrthographic(t,a,h,g,y,b){const S=new Float64Array(16);return r.cd(S,t,a,h,g,y,b),S}getDistanceToElevation(t,a=!1){const h=t===0?0:r.ce(t,a?r.a$(this.position[1]):this.position[1]),g=this.forward();return(h-this.position[2])/g[2]}clone(){return new Id([...this.position],[...this.orientation])}}const ao={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class jp{constructor(t=0,a=0,h=0,g=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=h,this.right=g}interpolate(t,a,h){return a.top!=null&&t.top!=null&&(this.top=r.ak(t.top,a.top,h)),a.bottom!=null&&t.bottom!=null&&(this.bottom=r.ak(t.bottom,a.bottom,h)),a.left!=null&&t.left!=null&&(this.left=r.ak(t.left,a.left,h)),a.right!=null&&t.right!=null&&(this.right=r.ak(t.right,a.right,h)),this}getCenter(t,a){const h=r.aA((this.left+t-this.right)/2,0,t),g=r.aA((this.top+a-this.bottom)/2,0,a);return new r.P(h,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new jp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ja=15;class fs{constructor(t,a,h,g,y,b,S){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=h??0,this._maxPitch=g??60,this.setProjection(b),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new r.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new jp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Id,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new fs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ja}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,a=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(t||h)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return r.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=r.cl(this.projectionOptions);const h=this.getProjection(),g=!r.by(a,h);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.cl({name:"mercator"});const a=t!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=r.cm(),r.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=r.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let g=0,y=0;for(let b=0;b<a.length;b++){const S=new r.P(a[b][0]*this.width,h+a[b][1]*(this.height-h)),M=t.pointCoordinate(S);if(!M)continue;const D=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);g+=M[3]*D,y+=D}return y===0?NaN:g/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(g-h,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const g=r.ag(r.av([],this._camera.position,h));return r.aA(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!r.co(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];r.cp(h,this._camera.position)||(this._setCameraPosition(h),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new Up;return a.position=new r.ae(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!r.cq(t))return!1;r.cr(t,t);const a=r.cs([],[0,0,-1],t),h=r.cs([],[0,-1,0],t);if(h[2]<0)return!1;const g=mh(a,h);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;t[2]=r.aA(t[2],g/h,g/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,h){this._unmodified=!1,this._edgeInsets.interpolate(t,a,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new r.ct(0,t)];if(this.renderWorldCopies){const h=this.pointCoordinate(new r.P(0,0)),g=this.pointCoordinate(new r.P(this.width,0)),y=this.pointCoordinate(new r.P(this.width,this.height)),b=this.pointCoordinate(new r.P(0,this.height)),S=Math.floor(Math.min(h.x,g.x,y.x,b.x)),M=Math.floor(Math.max(h.x,g.x,y.x,b.x)),D=1;for(let O=S-D;O<=M+D;O++)O!==0&&a.push(new r.ct(O,t))}return a}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,a,h){let g=[];const y=h!=null,b=!y;if(b&&this.zoom<a||y&&h[0]===0&&h[1]===0)return g;const S=new Set,M=(O,j,B,q,H)=>{const Z=r.cX(j,O,B,q,H);S.has(Z)||(g.push(new r.aO(O,j,B,q,H)),S.add(Z))};for(let O=0;O<t.length;O++){const j=t[O];if(b&&j.canonical.z!==a)continue;const B=j.canonical,q=j.overscaledZ,H=j.wrap,Z=1<<B.z,re=B.x+1<Z,$=B.x>0,ae=B.y+1<Z,pe=B.y>0,ye=j.wrap-($?0:1),Ce=j.wrap+(re?0:1),Ae=$?B.x-1:Z-1,ke=re?B.x+1:0;if(y)h[0]<0?(M(q,Ce,B.z,ke,B.y),h[1]<0&&ae&&(M(q,H,B.z,B.x,B.y+1),M(q,Ce,B.z,ke,B.y+1)),h[1]>0&&pe&&(M(q,H,B.z,B.x,B.y-1),M(q,Ce,B.z,ke,B.y-1))):h[0]>0?(M(q,ye,B.z,Ae,B.y),h[1]<0&&ae&&(M(q,H,B.z,B.x,B.y+1),M(q,ye,B.z,Ae,B.y+1)),h[1]>0&&pe&&(M(q,H,B.z,B.x,B.y-1),M(q,ye,B.z,Ae,B.y-1))):h[1]<0&&ae?M(q,H,B.z,B.x,B.y+1):pe&&M(q,H,B.z,B.x,B.y-1);else{const Me=j.visibleQuadrants;1&Me&&(M(q,ye,B.z,Ae,B.y),pe&&(M(q,H,B.z,B.x,B.y-1),M(q,ye,B.z,Ae,B.y-1))),2&Me&&(M(q,Ce,B.z,ke,B.y),pe&&(M(q,H,B.z,B.x,B.y-1),M(q,Ce,B.z,ke,B.y-1))),4&Me&&(M(q,ye,B.z,Ae,B.y),ae&&(M(q,H,B.z,B.x,B.y+1),M(q,ye,B.z,Ae,B.y+1))),8&Me&&(M(q,Ce,B.z,ke,B.y),ae&&(M(q,H,B.z,B.x,B.y+1),M(q,Ce,B.z,ke,B.y+1)))}}const D=[];for(const O of g)g.some((j=>O.isChildOf(j)))||D.push(O);if(g=D.filter((O=>!t.some((j=>!!(O.overscaledZ<a&&j.isChildOf(O))||O.equals(j)||O.isChildOf(j))))),b){const O=1<<a,j=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[O*j.x,O*j.y],q=4,H=q*q;g=g.filter((Z=>{const re=Z.canonical.x+.5-B[0],$=Z.canonical.y+.5-B[1];return re*re+$*$<H}))}return g}extendTileCoverToNearPlane(t,a,h){const g=[],y=new Set;for(const ae of t)y.add(ae.key);const b=(ae,pe,ye,Ce,Ae)=>{const ke=r.cX(pe,ae,ye,Ce,Ae);y.has(ke)||(g.push(new r.aO(ae,pe,ye,Ce,Ae)),y.add(ke))},S=t.reduce(((ae,pe)=>Math.max(ae,pe.overscaledZ)),h),M=1<<h,D=[new r.P(0,0),new r.P(r.al,0),new r.P(r.al,r.al),new r.P(0,r.al)],O=new r.P(0,0),j=new r.P(0,0),B=(ae,pe)=>{const ye=Math.floor(ae[0]),Ce=Math.floor(ae[1]),Ae=(ae[0]-ye)*r.al,ke=(ae[1]-Ce)*r.al,Me=Math.floor(pe[0]),Ee=Math.floor(pe[1]),ze=(pe[0]-Me)*r.al,ot=(pe[1]-Ee)*r.al;for(let Ze=-1;Ze<=1;Ze++){const mt=ye+Ze;if(!(mt<0||mt>=M)){O.x=Ae-Ze*r.al,j.x=ze-(mt-Me)*r.al;for(let $e=-1;$e<=1;$e++){const pt=Ce+$e;O.y=ke-$e*r.al,j.y=ot-(pt-Ee)*r.al,r.cY(O,j,D)&&b(S,0,h,mt,pt)}}}},q=a.points,H=q[r.cu],Z=q[r.cv],re=this._projectToGround(H,q[r.cw]),$=this._projectToGround(Z,q[r.cx]);return B(H,re),B(Z,$),g}_projectToGround(t,a){return r.cy(r.cz(),t,a,t[2]/(t[2]-a[2]))}coveringTiles(t){let a=this.coveringZoomLevel(t);const h=a,g=this.elevation&&this.elevation.exaggeration(),y=g&&!t.isTerrainDEM,b=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);const S=this.locationCoordinate(this.center),M=this.center.lat,D=1<<a,O=[D*S.x,D*S.y,0],j=this.projection.name==="globe",B=!j,q=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,B),H=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=D*r.ce(1,this.center.lat),re=this._camera.position[2]/r.ce(1,this.center.lat),$=[D*H.x,D*H.y,re*(B?1:Z)],ae=j||g,pe=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ye=this.isLODDisabled(!0)?a:0;let Ce;if(this._elevation&&t.isTerrainDEM)Ce=1e4*this._elevation.exaggeration();else if(this._elevation){const Ue=this._elevation.getMinMaxForVisibleTiles();Ce=Ue?Ue.max:this._centerAltitude}else Ce=this._centerAltitude;const Ae=t.isTerrainDEM?-Ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,ke=this.projection.isReprojectedInTileSpace?r.cB(this):1,Me=Ue=>{const ct=new r.ae(Ue.x+25e-6,Ue.y,Ue.z),Ct=new r.ae(Ue.x,Ue.y+25e-6,Ue.z),qt=Ue.toLngLat(),nn=ct.toLngLat(),Vt=Ct.toLngLat(),Ot=this.locationCoordinate(qt),vn=this.locationCoordinate(nn),gn=this.locationCoordinate(Vt),yn=Math.hypot(vn.x-Ot.x,vn.y-Ot.y),mn=Math.hypot(gn.x-Ot.x,gn.y-Ot.y);return Math.sqrt(yn*mn)*ke/25e-6},Ee=Ue=>{const xt=Ce,ct=Ae;return{aabb:r.cE(this,D,0,0,0,Ue,ct,xt,this.projection),zoom:0,x:0,y:0,minZ:ct,maxZ:xt,wrap:Ue,fullyVisible:!1}},ze=[];let ot=[];const Ze=a,mt=t.reparseOverscaled?h:a,$e=(re-this._centerAltitude)*Z,pt=Ue=>{if(!this._elevation||!Ue.tileID||!b)return;const xt=this._elevation.getMinMaxForTile(Ue.tileID),ct=Ue.aabb;xt?(ct.min[2]=xt.min,ct.max[2]=xt.max,ct.center[2]=(ct.min[2]+ct.max[2])/2):(Ue.shouldSplit=rt(Ue),Ue.shouldSplit||(ct.min[2]=ct.max[2]=ct.center[2]=this._centerAltitude))},Ht=(Ue,xt)=>{if(.707*xt<Ue)return 1;const ct=xt/Ue;return ct/(1.4144271570014144+(Math.pow(1.1,ct-1.4144271570014144+1)-1)/(1.1-1)-1)},rt=Ue=>{if(Ue.zoom<ye)return!0;if(Ue.zoom===Ze)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const xt=Ue.aabb.distanceX($),ct=Ue.aabb.distanceY($);let Ct=$e,qt=1;if(j){Ct=Ue.aabb.distanceZ($);const mn=Math.pow(2,Ue.zoom),qn=r.a$((Ue.y+1)/mn),ii=r.a$(Ue.y/mn),ai=Math.min(Math.max(M,qn),ii),Xi=r.d0(ai)/r.d0(M);if(qt=ai===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Xi/this._mercatorScaleRatio),this.zoom<=r.cZ&&Ue.zoom===Ze-1&&Xi>=.9)return!0}else if(y&&(Ct=Ue.aabb.distanceZ($)*Z),this.projection.isReprojectedInTileSpace&&h<=5){const mn=Math.pow(2,Ue.zoom),qn=Me(new r.ae((Ue.x+.5)/mn,(Ue.y+.5)/mn));qt=qn>.85?1:qn}if(!b){const mn=Math.sqrt(xt*xt+ct*ct+Ct*Ct);let qn=(1<<Ze-Ue.zoom)*pe*qt;return qn*=Ht(Math.max(Ct,$e),mn),mn<qn}let nn=Number.MAX_VALUE,Vt=0;const Ot=Ue.aabb.getCorners(),vn=[];for(const mn of Ot){r.av(vn,mn,$),j||(y?vn[2]*=Z:vn[2]=$e);const qn=r.bJ(vn,this._camera.forward());qn<nn&&(nn=qn,Vt=Math.abs(vn[2]))}let gn=(1<<Ze-Ue.zoom)*pe*qt;if(gn*=Ht(Math.max(Vt,$e),nn),nn<gn)return!0;const yn=Ue.aabb.closestPoint(O);return yn[0]===O[0]&&yn[1]===O[1]};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)ze.push(Ee(-Ue)),ze.push(Ee(Ue));for(ze.push(Ee(0));ze.length>0;){const Ue=ze.pop(),xt=Ue.x,ct=Ue.y;let Ct=Ue.fullyVisible;const qt=()=>this.projection.name==="globe"&&(Ue.y===0||Ue.y===(1<<Ue.zoom)-1);if(!Ct){let nn=ae?Ue.aabb.intersects(q):Ue.aabb.intersectsFlat(q);if(nn===0&&qt()){const Vt=new r.cC(Ue.zoom,xt,ct);nn=r.cD(this,D,Vt,!0).intersects(q)}if(nn===0)continue;Ct=nn===2}if(Ue.zoom!==Ze&&rt(Ue))for(let nn=0;nn<4;nn++){const Vt=(xt<<1)+nn%2,Ot=(ct<<1)+(nn>>1),vn={aabb:b?Ue.aabb.quadrant(nn):r.cE(this,D,Ue.zoom+1,Vt,Ot,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:Vt,y:Ot,wrap:Ue.wrap,fullyVisible:Ct,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};y&&!j&&(vn.tileID=new r.aO(Ue.zoom+1===Ze?mt:Ue.zoom+1,Ue.wrap,Ue.zoom+1,Vt,Ot),pt(vn)),ze.push(vn)}else{const nn=Ue.zoom===Ze?mt:Ue.zoom;if(t.minzoom&&t.minzoom>nn)continue;let Vt=0;if(!Ct){let yn=ae?Ue.aabb.intersectsPrecise(q):Ue.aabb.intersectsPreciseFlat(q);if(yn===0&&qt()){const mn=new r.cC(Ue.zoom,xt,ct);yn=r.cD(this,D,mn,!0).intersectsPrecise(q)}if(yn===0)continue;if(t.calculateQuadrantVisibility)if(q.containsPoint(Ue.aabb.center))Vt=15;else for(let mn=0;mn<4;mn++)Ue.aabb.quadrant(mn).intersects(q)!==0&&(Vt|=1<<mn)}const Ot=O[0]-(.5+xt+(Ue.wrap<<Ue.zoom))*(1<<a-Ue.zoom),vn=O[1]-.5-ct,gn=Ue.tileID?Ue.tileID:new r.aO(nn,Ue.wrap,Ue.zoom,xt,ct);t.calculateQuadrantVisibility&&(gn.visibleQuadrants=Vt),ot.push({tileID:gn,distanceSq:Ot*Ot+vn*vn})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,xt=this.horizonLineFromTop();ot=ot.filter((ct=>{const Ct=[0,0,0,1],qt=[r.al,r.al,0,1],nn=this.calculateFogTileMatrix(ct.tileID.toUnwrapped());r.aC(Ct,Ct,nn),r.aC(qt,qt,nn);const Vt=r.cF([],Ct,qt),Ot=r.cG([],Ct,qt),vn=r.c_(Vt,Ot);if(vn===0)return!0;let gn=!1;const yn=this._elevation;if(yn&&vn>Ue&&xt!==0){const mn=this.calculateProjMatrix(ct.tileID.toUnwrapped());let qn;t.isTerrainDEM||(qn=yn.getMinMaxForTile(ct.tileID)),qn||(qn={min:Ae,max:Ce});const ii=r.cH(this.rotation),ai=[ii[0]*r.al,ii[1]*r.al,qn.max];r.af(ai,ai,mn),gn=(1-ai[1])*this.height*.5<xt}return vn<Ue||gn}))}return ot.sort(((Ue,xt)=>Ue.distanceSq-xt.distanceSq)).map((Ue=>Ue.tileID))}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const a=r.aA(t.lat,-r.cI,r.cI),h=this.projection.project(t.lng,a);return new r.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,a){let h,g;const y=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;h=(a.x-y.x)/S,g=(a.y-y.y)/S}else{const S=this.pointCoordinate(a),M=this.pointCoordinate(y);h=S.x-M.x,g=S.y-M.y}const b=this.locationCoordinate(t);this.setLocation(new r.ae(b.x-h,b.y-g))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,a){return this.projection.locationPoint(this,t,a)}locationPoint3D(t,a){return this.projection.locationPoint(this,t,a,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,a){return this.coordinateLocation(this.pointCoordinate3D(t,a))}locationCoordinate(t,a){const h=a?r.ce(a,t.lat):void 0,g=this.projection.project(t.lng,t.lat);return new r.ae(g.x,g.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const h=a??this._centerAltitude,g=[t.x,t.y,0,1],y=[t.x,t.y,1,1];r.aC(g,g,this.pixelMatrixInverse),r.aC(y,y,this.pixelMatrixInverse);const b=y[3];r.cJ(g,g,1/g[3]),r.cJ(y,y,1/b);const S=g[2],M=y[2];return{p0:g,p1:y,t:S===M?0:(h-S)/(M-S)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return r.aC(a,a,this.pixelMatrixInverse),r.aC(h,h,this.pixelMatrixInverse),r.cJ(a,a,1/a[3]),r.cJ(h,h,1/h[3]),a[2]=r.ce(a[2],this._center.lat)*this.worldSize,h[2]=r.ce(h[2],this._center.lat)*this.worldSize,r.cJ(a,a,1/this.worldSize),r.cJ(h,h,1/this.worldSize),new r.ax([a[0],a[1],a[2]],r.aw([],r.av([],h,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:h,t:g}=t,y=r.ce(a[2],this._center.lat),b=r.ce(h[2],this._center.lat);return new r.ae(r.ak(a[0],h[0],g)/this.worldSize,r.ak(a[1],h[1],g)/this.worldSize,r.ak(y,b,g))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t,a){if(!this.elevation)return this.pointCoordinate(t,a);let h=this.projection.pointCoordinate3D(this,t.x,t.y);if(h)return new r.ae(h[0],h[1],h[2]);let g=0,y=this.horizonLineFromTop();if(t.y>y)return this.pointCoordinate(t,a);const b=.02*y,S=t.clone();for(let M=0;M<10&&y-g>b;M++){S.y=r.ak(g,y,.66);const D=this.projection.pointCoordinate3D(this,S.x,S.y);D?(y=S.y,h=D):g=S.y}return h?new r.ae(h[0],h[1],h[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.cK)return!this.isPointAboveHorizon(t);const a=this.pointCoordinate(t);return a.y>=0&&a.y<=1}_coordinatePoint(t,a){const h=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,g=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return r.aC(g,g,this.pixelMatrix),g[3]>0?new r.P(g[0]/g[3],g[1]/g[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:a}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,y=this.pointLocation3D(new r.P(a,t)),b=this.pointLocation3D(new r.P(g,t)),S=this.pointLocation3D(new r.P(g,h)),M=this.pointLocation3D(new r.P(a,h));let D=Math.min(y.lng,b.lng,S.lng,M.lng),O=Math.max(y.lng,b.lng,S.lng,M.lng),j=Math.min(y.lat,b.lat,S.lat,M.lat),B=Math.max(y.lat,b.lat,S.lat,M.lat);const q=Math.pow(2,-this.zoom)/16*270,H=this.projection.name==="globe"?1:4,Z=(re,$,ae,pe,ye)=>{const Ce=(re+ae)/2,Ae=($+pe)/2,ke=new r.P(Ce,Ae),{lng:Me,lat:Ee}=this.pointLocation3D(ke),ze=Math.max(0,D-Me,j-Ee,Me-O,Ee-B);D=Math.min(D,Me),O=Math.max(O,Me),j=Math.min(j,Ee),B=Math.max(B,Ee),(ye<H||ze>q)&&(Z(re,$,Ce,Ae,ye+1),Z(Ce,Ae,ae,pe,ye+1))};if(Z(a,t,g,t,1),Z(g,t,g,h,1),Z(g,h,a,h,1),Z(a,h,a,t,1),this.projection.name==="globe"){const[re,$]=r.cL(this);re?(B=90,O=180,D=-180):$&&(j=-90,O=180,D=-180)}return new r.aI(new r.aR(D,j),new r.aR(O,B))}_getBoundsRectangular(t,a){const{top:h,left:g}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,S=new r.P(g,h),M=new r.P(b,h),D=new r.P(b,y),O=new r.P(g,y);let j=this.pointCoordinate(S,t),B=this.pointCoordinate(M,t);const q=this.pointCoordinate(D,a),H=this.pointCoordinate(O,a),Z=(re,$)=>($.y-re.y)/($.x-re.x);return j.y>1&&B.y>=0?j=new r.ae((1-H.y)/Z(H,j)+H.x,1):j.y<0&&B.y<=1&&(j=new r.ae(-H.y/Z(H,j)+H.x,0)),B.y>1&&j.y>=0?B=new r.ae((1-q.y)/Z(q,B)+q.x,1):B.y<0&&j.y<=1&&(B=new r.ae(-q.y/Z(q,B)+q.x,0)),new r.aI().extend(this.coordinateLocation(j)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=t.visibleDemTiles.reduce(((h,g)=>{if(g.dem){const y=g.dem.tree;h.min=Math.min(h.min,y.minimums[0]),h.max=Math.max(h.max,y.maximums[0])}return h}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-r.cI,this.maxLat=r.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aF(this.minLng)*this.tileSize,this.worldMaxX=r.aF(this.maxLng)*this.tileSize,this.worldMinY=r.aJ(this.maxLat)*this.tileSize,this.worldMaxY=r.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){const a=t.key,h=this._distanceTileDataCache;if(h[a])return h[a];const g=t.canonical,y=1/this.height,b=this.cameraWorldSize,S=b/this.zoomScale(g.z),M=(g.x+Math.pow(2,g.z)*t.wrap)*S,D=g.y*S,O=this.point;O.x*=b/this.worldSize,O.y*=b/this.worldSize;const j=this.angle,B=Math.sin(-j),q=-Math.cos(-j);return h[a]={bearing:[B,q],center:[(O.x-M)*y,(O.y-D)*y],scale:S/r.al*y},h[a]}calculateFogTileMatrix(t){const a=t.key,h=this._fogTileMatrixCache;if(h[a])return h[a];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.aB(g,this.worldToFogMatrix,g),h[a]=new Float32Array(g),h[a]}calculateProjMatrix(t,a=!1,h=!1){const g=t.key;let y;if(y=h?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,y[g])return y[g];const b=this.calculatePosMatrix(t,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,r.aB(b,S,b),y[g]=new Float32Array(b),y[g]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[a])return h[a];const g=r.cM(t,this);return h[a]=g,h[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,a=r.bq([],[t,t,t]);return r.aB(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const a=r.ce(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(a),g=this._camera.forward(),y=r.ce(1,this._center.lat);h[2]/=y,g[2]/=y,r.aw(g,g);const b=t.raycast(h,g,t.exaggeration());if(b){const S=r.bH([],h,g,b),M=new r.ae(S[0],S[1],r.ce(S[2],r.a$(S[1]))),D=(M.z+r.ag([M.x-h[0],M.y-h[1],M.z-h[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const a=this._elevation,h=r.ce(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),y=a.getAtPointOrZero(new r.ae(...g)),b=this.pixelsPerMeter/this.worldSize*y,S=this._minimumHeightOverTerrain(),M=g[2]-b;if(M<=S)if(M<0||t){const D=this.locationCoordinate(this._center,this._centerAltitude),O=[g[0],g[1],D.z-g[2]],j=r.ag(O);O[2]-=(S-M)/this._pixelsPerMercatorPixel;const B=r.ag(O);if(B===0)return;r.c4(O,O,j/B*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],D.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=r.aA(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=r.aA(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const a=this._unmodified,{x:h,y:g}=this.point;let y=0,b=h,S=g;const M=this.width/2,D=this.height/2,O=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(g-D<O&&(S=O+D),g+D>j&&(S=j-D),j-O<this.height&&(y=Math.max(y,this.height/(j-O)),S=(j+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,H=this.worldSize/2-(B+q)/2;b=(h+H+this.worldSize)%this.worldSize-H,b-M<B&&(b=B+M),b+M>q&&(b=q-M),q-B<this.width&&(y=Math.max(y,this.width/(q-B)),b=(q+B)/2)}b===h&&S===g||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(b,S))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ce(1,this.center.lat)/r.ce(1,r.d1));const g=r.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?h:1,b=this._camera.getWorldToCamera(this.worldSize,y);let S;const M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-t.x/this.width,M[9]=2*t.y/this.height,this.isOrthographic){let Ee=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ze=Ee*this.aspect,ot=-ze,Ze=-Ee;ze-=t.x,ot-=t.x,Ee+=t.y,Ze+=t.y,S=this._camera.getCameraToClipOrthographic(ot,ze,Ze,Ee,this._nearZ,this._farZ),((mt,$e,pt,Ht)=>{for(let rt=0;rt<16;rt++)mt[rt]=r.ak($e[rt],pt[rt],Ht)})(S,S,M,r.c$(this.pitch>=Ja?1:this.pitch/Ja))}else S=M;const D=r.cO([],M,b);let O=r.cO([],S,b);if(this.projection.isReprojectedInTileSpace){const Ee=this.locationCoordinate(this.center),ze=r.bA([]);r.br(ze,ze,[Ee.x*this.worldSize,Ee.y*this.worldSize,0]),r.aB(ze,ze,r.cP(this)),r.br(ze,ze,[-Ee.x*this.worldSize,-Ee.y*this.worldSize,0]),r.aB(O,O,ze),r.aB(D,D,ze),this.inverseAdjustmentMatrix=r.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cR([],O,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=O,this.invProjMatrix=r.bl(new Float64Array(16),this.projMatrix),a){const Ee=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ee[8]=2*-t.x/this.width,Ee[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.cO([],Ee,b)}else this.expandedFarZProjMatrix=this.projMatrix;const j=r.bl([],S);this.frustumCorners=r.cS.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const B=new Float32Array(16);r.bA(B),r.cR(B,B,[1,-1,1]),r.cT(B,B,this._pitch),r.bB(B,B,this.angle);const q=r.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bz(q);const H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-t.x/this.width,q[9]=2*(t.y+H)/this.height,this.skyboxMatrix=r.aB(B,q,B);const Z=this.point,re=Z.x,$=Z.y,ae=this.width%2/2,pe=this.height%2/2,ye=Math.cos(this.angle),Ce=Math.sin(this.angle),Ae=re-Math.round(re)+ye*ae+Ce*pe,ke=$-Math.round($)+ye*pe+Ce*ae,Me=new Float64Array(O);if(r.br(Me,Me,[Ae>.5?Ae-1:Ae,ke>.5?ke-1:ke,0]),this.alignedProjMatrix=Me,O=r.bC(),r.cR(O,O,[this.width/2,-this.height/2,1]),r.br(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=r.bC(),r.cR(O,O,[1,-1,1]),r.br(O,O,[-1,-1,0]),r.cR(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=r.aB(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},O=r.bl(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cU(this);const Ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.af(Ee,Ee,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,h=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,y=[t,t,a];r.c4(y,y,g),r.c4(h,h,-1),r.cV(h,h,y);const b=r.bC();r.br(b,b,h),r.cR(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,g)}_computeCameraPosition(t){const a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),g=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-h[0]*y,g.y/this.worldSize-h[1]*y,t/this.worldSize*this._centerAltitude-h[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],g=t[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(y=Math.min((a-h)/g,1)),this._camera.position=r.bH([],this._camera.position,t,y),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:h,bearing:g}=this._camera.getPitchBearing(),y=r.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.an(this._maxPitch)),S=Math.max((t[2]-y)/Math.cos(h),b),M=this._zoomFromMercatorZ(S);r.bH(t,t,a,S),this._pitch=r.aA(h,r.an(this.minPitch),r.an(this.maxPitch)),this.angle=r.bT(g,-Math.PI,Math.PI),this._setZoom(r.aA(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let a=0,h=r.cK,g=0,y=1/0;for(;h-a>1e-6&&h>a;){const b=a+.5*(h-a),S=this.tileSize*Math.pow(2,b),M=this.getCameraToCenterDistance(this.projection,b,S),D=this.scaleZoom(M/(Math.max(0,t)*this.tileSize)),O=Math.abs(b-D);O<y&&(y=O,g=b),b<D?a=b:h=b}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){const h=Math.min(t.x,a.x),g=Math.max(t.x,a.x),y=Math.min(t.y,a.y),b=Math.max(t.y,a.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new r.P(h,y),new r.P(g,b),new r.P(h,b),new r.P(g,y)],M=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const O of S){const j=this.pointRayIntersection(O);if(j.t<0)return!0;const B=this.rayIntersectionCoordinate(j);if(B.x<M||B.y<0||B.x>D||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,a){const h=r.ag(r.av([],this._camera.position,t)),g=this._zoomFromMercatorZ(h)+a;return h-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([a,h,g],y){const b=[a,h,g,1];r.aC(b,b,y);const S=b[3]=Math.max(b[3],1e-6);return b[0]/=S,b[1]/=S,b[2]/=S,b})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,a=this.zoom,h=this.worldSize){const g=r.cN(t,a,this.width,this.height,1024),y=t.pixelSpaceConversion(this.center.lat,h,g);let b=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(b=r.ak(1,b,r.c$(this.pitch>=Ja?1:this.pitch/Ja))),b}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.aB(t,t,this.globeMatrix),t}getFrustum(t){return r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Cl=(d,t)=>{if(t>0&&d.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=d.transform,h=Math.max(Math.abs(a._zoom-(d.minCutoffZoom-1)),1),g=a.isLODDisabled(!1)?r.ah(60,45,a.pitch):r.ah(30,15,a.pitch),y=a._farZ-a._nearZ,b=t*a.height,S=((1-(M=g))*a.cameraToCenterDistance+M*(a._farZ+b))*h;var M;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(S-a._nearZ)/y,(S-b-a._nearZ)/y]}}},Go={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class z_{constructor(t,a){this.aabb=t,this.lastCascade=a}}class gh{add(t,a){const h=this.receivers[t.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],a.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],a.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],a.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],a.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],a.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],a.max[2])):this.receivers[t.key]=new z_(a,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,a,h){const g=r.d8.fromPoints(t.points);let y=0;for(const b in this.receivers){const S=this.receivers[b];if(!S||!g.intersectsAabb(S.aabb))continue;S.aabb.min=g.closestPoint(S.aabb.min),S.aabb.max=g.closestPoint(S.aabb.max);const M=S.aabb.getCorners();for(let D=0;D<h.length;D++){let O=!0;for(const j of M){const B=[j[0]*a,j[1]*a,j[2]];if(r.af(B,B,h[D].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){O=!1;break}}if(S.lastCascade=D,y=Math.max(y,D),O)break}}return y+1}}class xx{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new gh,this._depthMode=new an(t.context.gl.LEQUAL,an.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),t.tp.registerParameter(Go,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Go,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Go,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,a){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const g=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||g<=0||(this._shadowLayerCount=h.style.order.reduce(((H,Z)=>{const re=h.style._mergedLayers[Z];return H+(re.hasShadowPass()&&!re.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=h.context,b=Go.shadowMapResolution,S=Go.shadowMapResolution;if(this._cascades.length===0||Go.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let H=0;H<Go.cascadeCount;++H){const Z=h._shadowMapDebug,re=y.gl,$=y.createFramebuffer(b,S,Z,"texture"),ae=new r.T(y,{width:b,height:S,data:null},re.DEPTH_COMPONENT16);if($.depthAttachment.set(ae.texture),Z){const pe=new r.T(y,{width:b,height:S,data:null},re.RGBA8);$.colorAttachment.set(pe.texture)}this._cascades.push({framebuffer:$,texture:ae,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cA,scale:0})}}this.shadowDirection=au(a);let M=0;if(t.elevation){const H=t.elevation,Z=[1e4,-1e4];H.visibleDemTiles.filter((re=>re.dem)).forEach((re=>{const $=re.dem.tree;Z[0]=Math.min(Z[0],$.minimums[0]),Z[1]=Math.max(Z[1],$.maximums[0])})),Z[0]!==1e4&&(M=(Z[1]-Z[0])*H.exaggeration())}const D=1.5*t.cameraToCenterDistance,O=3*D,j=new Float64Array(16);for(let H=0;H<this._cascades.length;++H){const Z=this._cascades[H];let re=t.height/50,$=1;Go.cascadeCount===1?$=O:H===0?$=D:(re=D,$=O);const[ae,pe]=bx(t,this.shadowDirection,re,$,Go.shadowMapResolution,M);Z.scale=t.scale,Z.matrix=ae,Z.boundingSphereRadius=pe,r.bl(j,Z.matrix),Z.frustum=r.cA.fromInvProjectionMatrix(j,1,0,!0),Z.far=$}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Go.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Go.shadowMapResolution,this._uniformValues.u_shadowmap_0=ao.ShadowMap0,this._uniformValues.u_shadowmap_1=ao.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=h.transform.elevation;for(const H of this._groundShadowTiles){let Z={min:0,max:0};if(q){const re=q.getMinMaxForTile(H);re&&(Z=re)}this.addShadowReceiver(H.toUnwrapped(),Z.min,Z.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,a){if(!this.enabled)return;const h=this.painter,g=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),g.viewport.set([0,0,Go.shadowMapResolution,Go.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){h.currentShadowCascade=y,g.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),g.clear({color:r.ao.white,depth:1});for(const b of t.order){const S=t._mergedLayers[b];if(!S.hasShadowPass()||S.isHidden(h.transform.zoom))continue;const M=t.getLayerSourceCache(S),D=M?a[M.id]:void 0;(S.type==="model"||D&&D.length)&&h.renderLayer(h,M,S,D)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,a=t.style,h=t.context,g=h.gl,y=a.directionalLight,b=a.ambientLight;if(!y||!b)return;const S=[],M=Cl(t,t.longestCutoffRange);M.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const D=va(a,y,b),O=new an(g.LEQUAL,an.ReadOnly,t.depthRangeFor3D),j=new On({func:g.EQUAL,mask:255},0,255,g.KEEP,g.KEEP,g.KEEP);for(const B of this._groundShadowTiles){const q=B.toUnwrapped(),H=t.isTileAffectedByFog(B),Z=t.getOrCreateProgram("groundShadow",{defines:S,overrideFog:H});this.setupShadows(q,Z),t.uploadCommonUniforms(h,Z,q,null,M);const re={u_matrix:t.transform.calculateProjMatrix(q),u_ground_shadow_factor:D};Z.draw(t,g.TRIANGLES,O,j,si.multiply,jn.disabled,re,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?si.unblended:si.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const a=this.painter.transform,h=a.calculatePosMatrix(t,a.worldSize);return r.aB(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(t){return r.aB(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,a,h){if(!this.enabled)return;const g=this.painter.transform,y=this.painter.context,b=y.gl,S=this._uniformValues,M=new Float64Array(16),D=g.calculatePosMatrix(t,g.worldSize);for(let O=0;O<this._cascades.length;O++)r.aB(M,this._cascades[O].matrix,D),S[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),y.activeTexture.set(b.TEXTURE0+ao.ShadowMap0+O),this._cascades[O].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=!!h,this.useNormalOffset){const O=r.d6(t.canonical),j=2/g.tileSize*r.al/Go.shadowMapResolution,B=j*this._cascades[0].boundingSphereRadius,q=j*this._cascades[this._cascades.length-1].boundingSphereRadius,H=(h==="vector-tile"?1:3)*(function(Z,re,$,ae,pe){const ye=r.aA((Z-22)/-22,0,1);return .125*(1-ye)+4*ye})(g.zoom);S.u_shadow_normal_offset=[O,B*H,q*H],S.u_shadow_bias=[1e-4,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(y,S)}setupShadowsFromMatrix(t,a,h=!1){if(!this.enabled)return;const g=this.painter.context,y=g.gl,b=this._uniformValues,S=new Float64Array(16);for(let M=0;M<Go.cascadeCount;M++)r.aB(S,this._cascades[M].matrix,t),b[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),g.activeTexture.set(y.TEXTURE0+ao.ShadowMap0+M),this._cascades[M].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);if(this.useNormalOffset=h,h){const M=Go.normalOffset;b.u_shadow_normal_offset=[1,M,M],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(g,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,a,h,g){if(g[2]>=0)return{};const y=(function(M,D,O){const j=O/(1<<M.canonical.z);return new r.d8([M.canonical.x*j+M.wrap*O,M.canonical.y*j+M.wrap*O,0],[(M.canonical.x+1)*j+M.wrap*O,(M.canonical.y+1)*j+M.wrap*O,D])})(t,a,h).getCorners(),b=a/-g[2];g[0]<0?(r.d7(y[0],y[0],[g[0]*b,0,0]),r.d7(y[3],y[3],[g[0]*b,0,0])):g[0]>0&&(r.d7(y[1],y[1],[g[0]*b,0,0]),r.d7(y[2],y[2],[g[0]*b,0,0])),g[1]<0?(r.d7(y[0],y[0],[0,g[1]*b,0]),r.d7(y[1],y[1],[0,g[1]*b,0])):g[1]>0&&(r.d7(y[2],y[2],[0,g[1]*b,0]),r.d7(y[3],y[3],[0,g[1]*b,0]));const S={};return S.vertices=y,S.planes=[Md(y[1],y[0],y[4]),Md(y[2],y[1],y[5]),Md(y[3],y[2],y[6]),Md(y[0],y[3],y[7])],S}addShadowReceiver(t,a,h){this._receivers.add(t,r.d8.fromTileIdAndHeight(t,a,h))}getMaxCascadeForTile(t){const a=this._receivers.get(t);return a&&a.lastCascade?a.lastCascade:0}}function Md(d,t,a){const h=r.av([],a,t),g=r.av([],d,t),y=r.bI([],h,g),b=r.ag(y);return b===0?[0,0,1,0]:(r.c4(y,y,1/b),[y[0],y[1],y[2],-r.bJ(y,t)])}function au(d){const t=d.properties.get("direction"),a=r.d3(t.x,t.y,t.z);a[2]=r.aA(a[2],0,75);const h=r.d5([a[0],a[1],a[2]]);return r.d4(h.x,h.y,h.z)}function va(d,t,a){const h=t.properties.get("color-use-theme")==="none",g=t.properties.get("color"),y=t.properties.get("intensity"),b=t.properties.get("direction"),S=[b.x,b.y,b.z],M=a.properties.get("color-use-theme")==="none",D=a.properties.get("color"),O=a.properties.get("intensity"),j=Math.max(r.bJ([0,0,1],S),0),B=[0,0,0];r.c4(B,D.toPremultipliedRenderColor(M?null:d.getLut(t.scope)).toArray01Linear().slice(0,3),O);const q=[0,0,0];return r.c4(q,g.toPremultipliedRenderColor(h?null:d.getLut(a.scope)).toArray01Linear().slice(0,3),j*y),r.da([B[0]>0?B[0]/(B[0]+q[0]):0,B[1]>0?B[1]/(B[1]+q[1]):0,B[2]>0?B[2]/(B[2]+q[2]):0])}function bx(d,t,a,h,g,y){const b=d.zoom,S=d.scale,M=d.worldSize,D=1/M,O=d.aspect,j=Math.sqrt(1+O*O)*Math.tan(.5*d.fovX),B=j*j,q=h-a,H=h+a;let Z,re;B>q/H?(Z=h,re=h*j):(Z=.5*H*(1+B),re=.5*Math.sqrt(q*q+2*(h*h+a*a)*B+H*H*B*B));const $=d.projection.pixelsPerMeter(d.center.lat,M),ae=d._camera.getCameraToWorldMercator(),pe=[0,0,-Z*D];r.af(pe,pe,ae);let ye=re*D;const Ce=d._edgeInsets;if(!(Ce.left===0&&Ce.top===0&&Ce.right===0&&Ce.bottom===0||Ce.left===Ce.right&&Ce.top===Ce.bottom)){const Ct=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?$:1),qt=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,a,h);qt[8]=2*-d.centerOffset.x/d.width,qt[9]=2*d.centerOffset.y/d.height;const nn=new Float64Array(16);r.cO(nn,qt,Ct);const Vt=new Float64Array(16);r.bl(Vt,nn);const Ot=r.cA.fromInvProjectionMatrix(Vt,M,b,!0);for(const vn of Ot.points){const gn=((Ae=vn)[0]/=S,Ae[1]/=S,Ae[2]=r.ce(Ae[2],d._center.lat),Ae);ye=Math.max(ye,r.c5(r.d9([],pe,gn)))}}var Ae;ye*=g/(g-1);const ke=Math.acos(t[2]),Me=Math.atan2(-t[0],-t[1]),Ee=new Id;Ee.position=pe,Ee.setPitchBearing(ke,Me);const ze=Ee.getWorldToCamera(M,$),ot=ye*M,Ze=Math.min(d._mercatorZfromZoom(17)*M*-2,-2*ot),mt=Ee.getCameraToClipOrthographic(-ot,ot,-ot,ot,Ze,(ot+y*$)/t[2]),$e=new Float64Array(16);r.aB($e,mt,ze);const pt=r.d4(Math.floor(1e6*pe[0])/1e6*M,Math.floor(1e6*pe[1])/1e6*M,0),Ht=.5*g,rt=[0,0,0];r.af(rt,pt,$e),r.c4(rt,rt,Ht);const Ue=[Math.floor(rt[0]),Math.floor(rt[1]),Math.floor(rt[2])],xt=[0,0,0];r.av(xt,rt,Ue),r.c4(xt,xt,-1/Ht);const ct=new Float64Array(16);return r.bA(ct),r.br(ct,ct,xt),r.aB($e,ct,$e),[$e,ot]}class lu extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,a){return r.aV(this.requestManager.transformRequest(a,r.R.Model).url).then((h=>{if(!h)return;const g=r.aW(h),y=new r.aX(t,void 0,void 0,g);return y.computeBoundsAndApplyParent(),y})).catch((h=>{if(h&&h.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${t} from ${a}: ${h.message}`)))}))}load(t,a,h={forceReload:!1}){this.models[a]||(this.models[a]={});const g=Object.keys(t),y=[],b=[];for(const S of g){const M=t[S];this.hasURLBeenRequested(M)&&!h.forceReload||(this.modelByURL[M]={modelId:S,scope:a},y.push(this.loadModel(S,M)),b.push(S)),this.models[a][S]||(this.models[a][S]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+b.length,Promise.allSettled(y).then((S=>{for(let M=0;M<S.length;M++){const{status:D}=S[M];if(D==="rejected")continue;const{value:O}=S[M];this.models[a][b[M]]||(this.models[a][b[M]]={model:null,numReferences:1}),this.models[a][b[M]].model=O}this.numModelsLoading[a]-=b.length,this.fire(new r.z("data",{dataType:"style"}))})).catch((S=>{this.fire(new r.y(new Error(`Could not load models: ${S.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,a,h={exactIdMatch:!1}){return!!(h.exactIdMatch?this.getModel(t,a):this.getModelByURL(this.modelUris[a][t]))}getModel(t,a){return this.models[a]||(this.models[a]={}),this.models[a][t]?this.models[a][t].model:void 0}getModelByURL(t){if(!t)return null;const a=this.modelByURL[t];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(t,a){return this.models[a]&&this.models[a][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,a,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const g=this.requestManager.normalizeModelURL(a);if((this.hasModel(t,h,{exactIdMatch:!0})||this.hasModelBeenAdded(t,h))&&this.modelUris[h][t]===g)this.models[h][t].numReferences++;else if(this.hasURLBeenRequested(g)){const{scope:y,modelId:b}=this.modelByURL[g];this.models[y][b].numReferences++}else this.modelUris[h][t]=g,this.load({[t]:this.modelUris[h][t]},h)}addModelURLs(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const h=this.modelUris[a];for(const g in t)h[g]=this.requestManager.normalizeModelURL(t[g])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const h={};for(const g of t)this.hasModel(g,a,{exactIdMatch:!0})||this.hasURLBeenRequested(g)?this.models[a][g].numReferences++:this.modelUris[a][g]&&!this.hasURLBeenRequested(g)?h[g]=this.modelUris[a][g]:!this.hasURLBeenRequested(g)&&r.db(g,!1)&&(this.modelUris[a][g]=this.requestManager.normalizeModelURL(g),h[g]=this.modelUris[a][g]);this.load(h,a)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,a,h=!1,g=!1){if(this.models[a]&&this.models[a][t]&&(this.models[a][t].numReferences--,this.models[a][t].numReferences===0||g)){const y=this.modelUris[a][t];h||delete this.modelUris[a][t],delete this.modelByURL[y];const b=this.models[a][t].model;if(!b)return;delete this.models[a][t],b.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const a of Object.keys(this.models[t])){const h=this.models[t][a].model;delete this.models[t][a],h&&h.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,a){this.models[a]||(this.models[a]={});for(const h in this.models[a])this.models[a][h].model&&this.models[a][h].model.upload(t.context)}}const D_=new r.a9({data:new r.aa(r.a6.colorTheme.data)});function Cd(d){if(!d.metadata||!d.metadata.content_area)return;const t=r.o.devicePixelRatio,{left:a,top:h,width:g,height:y}=d.metadata.content_area,b=a*t,S=h*t;return[b,S,b+g*t,S+y*t]}function Pd(d){if(d)return d.map((([t,a])=>[t*r.o.devicePixelRatio,a*r.o.devicePixelRatio]))}class Pl{constructor(t,a,h){this.id=t,this.scope=a,this.sourceCache=h,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return t;const h=this.sourceCache.getSource();if(!(h instanceof Tl))return t;const g=a.map((b=>this.sourceCache.getTile(b))),y=h.getImages(g,Array.from(this.pendingRequests));for(const[b,S]of y)t.set(r.I.from({name:b,iconsetId:this.id}),S),this.pendingRequests.delete(b);for(const b of this.pendingRequests)this.missingRequests.add(b);return this.pendingRequests.clear(),t}}const dc=(d,t)=>Pe(d,t&&t.filter((a=>a.identifier!=="source.canvas"))),wx=r.aH(Ei,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Tx=r.aH(Ei,["setCenter","setZoom","setBearing","setPitch"]),kd=new Set(["background","sky","slot","custom"]),L_={version:8,layers:[],sources:{}},Rd={duration:300,delay:0};class ra extends r.E{constructor(t,a={}){super(),this.map=t,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=Object.assign({},Rd),this._buildingIndex=new gd(this),this.crossTileSymbolIndex=new ko,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new cn,this.dispatcher=a.dispatcher?a.dispatcher:new r.D(r.dd(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new Jt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new r.de(t._requestManager,a.localFontFamily?r.df.all:a.localIdeographFontFamily?r.df.ideographs:r.df.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new lu(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",r.dg());const h=this;this._rtlTextPluginCallback=ra.registerForPluginStateChange((g=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},((y,b)=>{if(r.dh(y),b&&b.every((S=>S)))for(const S in h._sourceCaches){const M=h._sourceCaches[S],D=M.getSource().type;D!=="vector"&&D!=="geojson"||M.reload()}}))})),this.on("data",(g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const y=this.getOwnSource(g.sourceId);if(y&&y.vectorLayerIds)for(const b in this._layers){const S=this._layers[b];S.source===y.id&&this._validateLayer(S)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.h(t))return t;const a=r.di(t);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${r.dj(JSON.stringify(t))}`}_diffStyle(t,a,h){this.globalId=this._getGlobalId(t);const g=(y,b)=>{try{b(null,this.setState(y,h))}catch(S){b(S,!1)}};if(typeof t=="string"){const y=this.map._requestManager.normalizeStyleURL(t),b=this.map._requestManager.transformRequest(y,r.R.Style);r.m(b,((S,M)=>{S?this.fire(new r.y(S)):M&&g(M,a)}))}else typeof t=="object"&&g(t,a)}loadURL(t,a={}){this.fire(new r.z("dataloading",{dataType:"style"}));const h=typeof a.validate=="boolean"?a.validate:!r.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,a.accessToken),this.resolvedImports.add(t);const g=this.importsCache.get(t);if(g)return this._load(g,h);const y=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.m(y,((b,S)=>{if(this._request=null,b)this.fire(new r.y(b));else if(S)return this.importsCache.set(t,S),this._load(S,h)}))}loadJSON(t,a={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.o.frame((()=>{this._request=null,this._load(t,a.validate!==!1)}))}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(L_,!1)}_loadImports(t,a,h){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const y of t){const b=this._createFragmentStyle(y),S=new Promise((O=>{b.once("style.import.load",O),b.once("error",O)})).then((()=>this.mergeAll()));if(g.push(S),this.resolvedImports.has(y.url)){b.loadEmpty();continue}const M=y.data||this.importsCache.get(y.url);M?(b.loadJSON(M,{validate:a}),this._isInternalStyle(M)&&(b.globalId=null)):y.url?b.loadURL(y.url,{validate:a}):b.loadEmpty();const D={style:b,id:y.id,config:y.config};if(h){const O=this.fragments.findIndex((({id:j})=>j===h));this.fragments=this.fragments.slice(0,O).concat(D).concat(this.fragments.slice(O))}else this.fragments.push(D)}return Promise.allSettled(g)}getImportGlobalIds(t=this,a=new Set){for(const h of t.fragments)h.style.globalId&&a.add(h.style.globalId),this.getImportGlobalIds(h.style,a);return[...a.values()]}_createFragmentStyle(t){const a=this.scope?r.B(t.id,this.scope):t.id;let h;const g=this._initialConfig&&this._initialConfig[a];(t.config||g)&&(h=Object.assign({},t.config,g));const y=new ra(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:h,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,a){if(this._isInternalStyle(t)){const y=Object.assign({},L_,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(y,a)}if(this.updateConfig(this._config,t.schema),a&&dc(this,qr(t)))return;this._loaded=!0,this.stylesheet=r.dk(t);const h=()=>{for(const M in t.sources)this.addSource(M,t.sources[M],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const M in t.iconsets)this.addIconset(M,t.iconsets[M]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const y=_d(this.stylesheet.layers);if(this._order=y.map((M=>M.id)),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const M=this.stylesheet.lights[0];this.light=new Ge(M.properties,M.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ge(this.stylesheet.light)),this._layers={};for(const M of y){const D=r.dq(M,this.scope,this._styleColorTheme.lut,this.options);D.configDependencies.size!==0&&this._configDependentLayers.add(D.fqid),D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D;const O=this.getOwnLayerSourceCache(D),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&D.canCastShadows()&&j&&(O.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const b=this.stylesheet.terrain;b&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(b,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const S=this.isRootStyle();t.imports?this._loadImports(t.imports,a).then((()=>{this._reloadImports(),this.fire(new r.z(S?"style.load":"style.import.load"))})).catch((M=>{this.fire(new r.y(new Error("Failed to load imports",M))),this.fire(new r.z(S?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new r.z(S?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const y=this._evaluateColorThemeData(g);this._loadColorTheme(y).then((()=>{h()})).catch((b=>{r.w(`Couldn't load color theme from the stylesheet: ${b}`),h()}))}else this._styleColorTheme.lut=null,h()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,a,h,g,y,b,S,M,D,O;const j={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((B=>{if(B.stylesheet){if(B.light!=null&&(t=B.light),B.stylesheet.lights)for(const q of B.stylesheet.lights)q.type==="ambient"&&B.ambientLight!=null&&(a=B.ambientLight),q.type==="directional"&&B.directionalLight!=null&&(h=B.directionalLight);g=this._prioritizeTerrain(g,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(y=B.fog),B.stylesheet.snow&&B.snow!=null&&(b=B.snow),B.stylesheet.rain&&B.rain!=null&&(S=B.rain),B.stylesheet.camera!=null&&(O=B.stylesheet.camera),B.stylesheet.projection!=null&&(M=B.stylesheet.projection),B.stylesheet.transition!=null&&(D=B.stylesheet.transition),j[B.scope]=B._styleColorTheme}})),this.light=t,this.ambientLight=a,this.directionalLight=h,this.fog=y,this.snow=b,this.rain=S,this._styleColorThemeForScope=j,g===null?delete this.terrain:this.terrain=g,this.camera=O||{"camera-projection":"perspective"},this.projection=M||{name:"mercator"},this.transition=Object.assign({},Rd,D),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const a=h=>{for(const g of h.fragments)a(g.style);t(h)};a(this)}_prioritizeTerrain(t,a,h){const g=t&&t.drapeRenderMode===0;return h===null?a&&a.drapeRenderMode===0?a:g?t:null:a!=null&&(!t||g||a&&a.drapeRenderMode===1)?a:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((a=>{t=this._prioritizeTerrain(t,a.terrain,a.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((a=>{a.stylesheet.projection!=null&&(t=a.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},a={},h={};this.forEachFragmentStyle((g=>{for(const y in g._sourceCaches){const b=r.B(y,g.scope);t[b]=g._sourceCaches[y]}for(const y in g._otherSourceCaches){const b=r.B(y,g.scope);a[b]=g._otherSourceCaches[y]}for(const y in g._symbolSourceCaches){const b=r.B(y,g.scope);h[b]=g._symbolSourceCaches[y]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=h}mergeLayers(){const t={},a=[],h={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((b=>{for(const S of b._order){const M=b._layers[S];if(M.type==="slot"){const D=r.dl(S);if(t[D])continue;t[D]=[]}M.slot&&t[M.slot]?t[M.slot].push(M):a.push(M)}})),this._mergedOrder=[];let g=-1;const y=(b=[])=>{for(const S of b)if(S.type==="slot"){const M=r.dl(S.id);t[M]&&y(t[M]),this._mergedSlots.push(M)}else{const M=r.B(S.id,S.scope);this._mergedOrder.push(M),h[M]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0,g=this._mergedOrder.length-1),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};if(y(a),this._has3DLayers){const b={};for(let S=0;S<this._mergedOrder.length;++S){const M=this._mergedOrder[S];b[M]=S===g?1:S<g?h[M].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((S,M)=>b[S]-b[M]))}this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(a,h,g,y){const b=Object.assign({},h);for(const M of Object.keys(r.a6.colorTheme))b[M]===void 0&&(b[M]=r.a6.colorTheme[M].default);const S=new r.a8(D_,a,new Map(g));return S.setTransitionOrValue(b,g),S.untransitioned().possiblyEvaluate(new r.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((h,g)=>{const y="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();let b=t;b.startsWith(y)||(b=y+b);const S=r.I.from("mapbox-reserved-lut"),M=new Image;M.src=b,M.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},M.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void h();this._styleColorTheme.lutLoading=!1;const{width:D,height:O,data:j}=r.o.getImageData(M);if(O>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(D!==O*O)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new r.q({width:D,height:O},j),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(S,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},h()):g(new Error("Missing LUT image."))}}))}getLut(t){const a=this._styleColorThemeForScope[t];return a?a.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(a,h,g){let y,b,S;const M=r.o.devicePixelRatio>1?"@2x":"";let D=r.m(h.transformRequest(h.normalizeSpriteURL(a,M,".json"),r.R.SpriteJSON),((B,q)=>{D=null,S||(S=B,y=q,j())})),O=r.n(h.transformRequest(h.normalizeSpriteURL(a,M,".png"),r.R.SpriteImage),((B,q)=>{O=null,S||(S=B,b=q,j())}));function j(){if(S)g(S);else if(y&&b){const B=r.o.getImageData(b),q={};for(const H in y){const{width:Z,height:re,x:$,y:ae,sdf:pe,pixelRatio:ye,stretchX:Ce,stretchY:Ae,content:ke}=y[H],Me=new r.q({width:Z,height:re});r.q.copy(B,Me,{x:$,y:ae},{x:0,y:0},{width:Z,height:re},null),q[H]={data:Me,pixelRatio:ye!==void 0?ye:1,sdf:pe!==void 0&&pe,stretchX:Ce,stretchY:Ae,content:ke,usvg:!1,version:0}}g(null,q)}}return{cancel(){D&&(D.cancel(),D=null),O&&(O.cancel(),O=null)}}})(t,this.map._requestManager,((a,h)=>{if(this._spriteRequest=null,a)this.fire(new r.y(a));else if(h){const g=new Map;for(const y in h)g.set(r.I.from(y),h[y]);this.addImages(g)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))}))}addIconset(t,a){if(a.type==="sprite")return void this._loadSprite(a.url);const h=this.getOwnSourceCache(a.source);if(!h)return void this.fire(new r.y(new Error(`Source "${a.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const g=h.getSource();if(g.type!=="raster-array")return void this.fire(new r.y(new Error(`Source "${a.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));g.partial=!1;const y=new Pl(t,this.scope,h);this.imageManager.addImageProvider(y,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!r.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const a=this.map._spriteFormat==="auto";var h,g;this._spriteRequest=(g=(y,b)=>{if(this._spriteRequest=null,y)a?this._loadSprite(t):this.fire(new r.y(y));else if(b){const S=new Map;for(const M in b)S.set(r.I.from(M),b[M]);this.addImages(S)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bu((h=this.map._requestManager).transformRequest(h.normalizeIconsetURL(t),r.R.Iconset),((y,b)=>{if(y)return void g(y);const S={},M=r.dc(new r.bt(b));for(const D of M.icons){const O={version:1,pixelRatio:r.o.devicePixelRatio,content:Cd(D),stretchX:D.metadata?Pd(D.metadata.stretch_x_areas):void 0,stretchY:D.metadata?Pd(D.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:D};S[D.name]=O}g(null,S)})))}_validateLayer(t){const a=this.getOwnSource(t.source);if(!a)return;const h=t.sourceLayer;h&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(h)===-1)&&this.fire(new r.y(new Error(`Source layer "${h}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,a)=>{const h=this.fragments[a];return h&&h.style&&(t.data=h.style.serialize()),t}))}_serializeSources(){const t={};for(const a in this._sourceCaches){const h=this._sourceCaches[a].getSource();t[h.id]||(t[h.id]=h.serialize())}return t}_serializeLayers(t){const a=[];for(const h of t){const g=this._layers[h];g&&g.type!=="custom"&&a.push(g.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const a=this.getOwnLayer(t);if(a)return a;this.fire(new r.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const a=this.getOwnSource(t);if(a)return a;this.fire(new r.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,a){const h=this.map.painter;if(h)for(let g=t.minzoom||0;g<(t.maxzoom||25.5);g++){const y=t.getProgramIds();if(y)for(const b of y){const S=t.getDefaultProgramParams(b,a.zoom,this._styleColorTheme.lut);S&&(h.style=this,this.fog&&(h._fogVisible=!0,S.overrideFog=!0,h.getOrCreateProgram(b,S)),h._fogVisible=!1,S.overrideFog=!1,h.getOrCreateProgram(b,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,h.getOrCreateProgram(b,S)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const a=this.calculateLightsBrightness();t.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const h=this._changes.isDirty();let g=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const M in S){const{updatedIds:D,removedIds:O}=S[M];(D||O)&&(this._updateWorkerLayers(M,D,O),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const y={};for(const S in this._mergedSourceCaches){const M=this._mergedSourceCaches[S];y[S]=M.used,M.used=!1,M.tileCoverLift=0}for(const S of this._mergedOrder){const M=this._mergedLayers[S];if(M.recalculate(t,this._availableImages),!M.isHidden(t.zoom)){const D=this.getLayerSourceCache(M);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(M,t)})):this.precompilePrograms(M,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();const b=this.imageManager.getPendingImageProviders();for(const S of b)S.sourceCache.used=!0;for(const S in y){const M=this._mergedSourceCaches[S];y[S]!==M.used&&M.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),h&&this.fire(new r.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const a of t){const h=a.resolvePendingRequests(),g=this.getFragmentStyle(a.scope);g&&g.addImages(h)}}_updateTilesForChangedImages(){const t={};for(const a in this._mergedSourceCaches){const h=this._mergedSourceCaches[a].getSource().scope;t[h]=t[h]||this._changes.getUpdatedImages(h),t[h].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t[h])}for(const a in t)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(t,a,h){const g=this.getFragmentStyle(t);g&&this.dispatcher.broadcast("updateLayers",{layers:a?g._serializeLayers(a):[],scope:t,removedIds:h||[],options:g.options})}setState(t,a){if(this._checkLoaded(),dc(this,qr(t)))return!1;(t=r.dk(t)).layers=_d(t.layers);const h=(function(b,S){if(!b)return[{command:Ei.setStyle,args:[S]}];let M=[];try{if(!r.by(b.version,S.version))return[{command:Ei.setStyle,args:[S]}];if(r.by(b.center,S.center)||M.push({command:Ei.setCenter,args:[S.center]}),r.by(b.zoom,S.zoom)||M.push({command:Ei.setZoom,args:[S.zoom]}),r.by(b.bearing,S.bearing)||M.push({command:Ei.setBearing,args:[S.bearing]}),r.by(b.pitch,S.pitch)||M.push({command:Ei.setPitch,args:[S.pitch]}),r.by(b.sprite,S.sprite)||M.push({command:Ei.setSprite,args:[S.sprite]}),r.by(b.glyphs,S.glyphs)||M.push({command:Ei.setGlyphs,args:[S.glyphs]}),r.by(b.imports,S.imports)||(function(q=[],H=[],Z){H=H||[];const re=(q=q||[]).map(iu),$=H.map(iu),ae=q.reduce(ah,{}),pe=H.reduce(ah,{}),ye=re.slice();let Ce,Ae,ke,Me;for(Ce=0,Ae=0;Ce<re.length;Ce++)ke=re[Ce],pe.hasOwnProperty(ke)?Ae++:(Z.push({command:Ei.removeImport,args:[ke]}),ye.splice(ye.indexOf(ke,Ae),1));for(Ce=0,Ae=0;Ce<$.length;Ce++)ke=$[$.length-1-Ce],ye[ye.length-1-Ce]!==ke&&(ae.hasOwnProperty(ke)?(Z.push({command:Ei.removeImport,args:[ke]}),ye.splice(ye.lastIndexOf(ke,ye.length-Ae),1)):Ae++,Me=ye[ye.length-Ce],Z.push({command:Ei.addImport,args:[pe[ke],Me]}),ye.splice(ye.length-Ce,0,ke));for(const Ee of H){const ze=ae[Ee.id];ze&&(delete ze.data,r.by(ze,Ee)||Z.push({command:Ei.updateImport,args:[Ee.id,Ee]}))}})(b.imports,S.imports,M),r.by(b.transition,S.transition)||M.push({command:Ei.setTransition,args:[S.transition]}),r.by(b.light,S.light)||M.push({command:Ei.setLight,args:[S.light]}),r.by(b.fog,S.fog)||M.push({command:Ei.setFog,args:[S.fog]}),r.by(b.snow,S.snow)||M.push({command:Ei.setSnow,args:[S.snow]}),r.by(b.rain,S.rain)||M.push({command:Ei.setRain,args:[S.rain]}),r.by(b.projection,S.projection)||M.push({command:Ei.setProjection,args:[S.projection]}),r.by(b.lights,S.lights)||M.push({command:Ei.setLights,args:[S.lights]}),r.by(b.camera,S.camera)||M.push({command:Ei.setCamera,args:[S.camera]}),r.by(b.iconsets,S.iconsets)||(function(q,H,Z){let re;for(re in H=H||{},q=q||{})q.hasOwnProperty(re)&&(H.hasOwnProperty(re)||Z.push({command:Ei.removeIconset,args:[re]}));for(re in H){if(!H.hasOwnProperty(re))continue;const $=H[re];q.hasOwnProperty(re)?r.by(q[re],$)||(Z.push({command:Ei.removeIconset,args:[re]}),Z.push({command:Ei.addIconset,args:[re,$]})):Z.push({command:Ei.addIconset,args:[re,$]})}})(b.iconsets,S.iconsets,M),!r.by(b["color-theme"],S["color-theme"]))return[{command:Ei.setStyle,args:[S]}];const D={},O=[];(function(q,H,Z,re){let $;for($ in H=H||{},q=q||{})q.hasOwnProperty($)&&(H.hasOwnProperty($)||I_($,Z,re));for($ in H){if(!H.hasOwnProperty($))continue;const ae=H[$];q.hasOwnProperty($)?r.by(q[$],ae)||(q[$].type==="geojson"&&ae.type==="geojson"&&yd(q,H,$)?Z.push({command:Ei.setGeoJSONSourceData,args:[$,ae.data]}):M_($,H,Z,re)):nu($,H,Z)}})(b.sources,S.sources,O,D);const j=[];b.layers&&b.layers.forEach((q=>{q.source&&D[q.source]?M.push({command:Ei.removeLayer,args:[q.id]}):j.push(q)}));let B=b.terrain;B&&D[B.source]&&(M.push({command:Ei.setTerrain,args:[void 0]}),B=void 0),M=M.concat(O),r.by(B,S.terrain)||M.push({command:Ei.setTerrain,args:[S.terrain]}),(function(q,H,Z){H=H||[];const re=(q=q||[]).map(iu),$=H.map(iu),ae=q.reduce(ah,{}),pe=H.reduce(ah,{}),ye=re.slice(),Ce=Object.create(null);let Ae,ke,Me,Ee,ze,ot,Ze;for(Ae=0,ke=0;Ae<re.length;Ae++)Me=re[Ae],pe.hasOwnProperty(Me)?ke++:(Z.push({command:Ei.removeLayer,args:[Me]}),ye.splice(ye.indexOf(Me,ke),1));for(Ae=0,ke=0;Ae<$.length;Ae++)Me=$[$.length-1-Ae],ye[ye.length-1-Ae]!==Me&&(ae.hasOwnProperty(Me)?(Z.push({command:Ei.removeLayer,args:[Me]}),ye.splice(ye.lastIndexOf(Me,ye.length-ke),1)):ke++,ot=ye[ye.length-Ae],Z.push({command:Ei.addLayer,args:[pe[Me],ot]}),ye.splice(ye.length-Ae,0,Me),Ce[Me]=!0);for(Ae=0;Ae<$.length;Ae++)if(Me=$[Ae],Ee=ae[Me],ze=pe[Me],!Ce[Me]&&!r.by(Ee,ze))if(r.by(Ee.source,ze.source)&&r.by(Ee["source-layer"],ze["source-layer"])&&r.by(Ee.type,ze.type)){for(Ze in Al(Ee.layout,ze.layout,Z,Me,null,Ei.setLayoutProperty),Al(Ee.paint,ze.paint,Z,Me,null,Ei.setPaintProperty),r.by(Ee.slot,ze.slot)||Z.push({command:Ei.setSlot,args:[Me,ze.slot]}),r.by(Ee.filter,ze.filter)||Z.push({command:Ei.setFilter,args:[Me,ze.filter]}),r.by(Ee.minzoom,ze.minzoom)&&r.by(Ee.maxzoom,ze.maxzoom)||Z.push({command:Ei.setLayerZoomRange,args:[Me,ze.minzoom,ze.maxzoom]}),Ee)Ee.hasOwnProperty(Ze)&&Ze!=="layout"&&Ze!=="paint"&&Ze!=="filter"&&Ze!=="metadata"&&Ze!=="minzoom"&&Ze!=="maxzoom"&&Ze!=="slot"&&(Ze.indexOf("paint.")===0?Al(Ee[Ze],ze[Ze],Z,Me,Ze.slice(6),Ei.setPaintProperty):r.by(Ee[Ze],ze[Ze])||Z.push({command:Ei.setLayerProperty,args:[Me,Ze,ze[Ze]]}));for(Ze in ze)ze.hasOwnProperty(Ze)&&!Ee.hasOwnProperty(Ze)&&Ze!=="layout"&&Ze!=="paint"&&Ze!=="filter"&&Ze!=="metadata"&&Ze!=="minzoom"&&Ze!=="maxzoom"&&Ze!=="slot"&&(Ze.indexOf("paint.")===0?Al(Ee[Ze],ze[Ze],Z,Me,Ze.slice(6),Ei.setPaintProperty):r.by(Ee[Ze],ze[Ze])||Z.push({command:Ei.setLayerProperty,args:[Me,Ze,ze[Ze]]}))}else Z.push({command:Ei.removeLayer,args:[Me]}),ot=ye[ye.lastIndexOf(Me)+1],Z.push({command:Ei.addLayer,args:[ze,ot]})})(j,S.layers,M)}catch(D){console.warn("Unable to compute style diff:",D),M=[{command:Ei.setStyle,args:[S]}]}return M})(this.serialize(),t).filter((b=>!(b.command in Tx)));if(h.length===0)return!1;const g=h.filter((b=>!(b.command in wx)));if(g.length>0)throw new Error(`Unimplemented: ${g.map((b=>b.command)).join(", ")}.`);const y=[];return h.forEach((b=>{y.push(this[b.command](...b.args))})),a&&Promise.all(y).then(a).catch(a),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[a,h]of t.entries()){if(this.getImage(a))return this.fire(new r.y(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,h),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this}addImage(t,a){return this.getImage(t)?this.fire(new r.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,a),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this)}updateImage(t,a,h=!1){this.imageManager.updateImage(t,this.scope,a),h&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new r.z("data",{dataType:"style"})),this}addModel(t,a,h={}){return this._checkLoaded(),this._validate(Fe,`models.${t}`,a,null,h)||(this.modelManager.addModel(t,a,this.scope),this.fire(new r.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,a,h={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(Xo,`sources.${t}`,a,null,h))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=th(t,a,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id})));const y=b=>{const S=(b?"symbol:":"other:")+g.id,M=r.B(S,this.scope),D=this._sourceCaches[S]=new Bs(M,g,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=D,D.onAdd(this.map)};y(!1),a.type!=="vector"&&a.type!=="geojson"||y(!0),g.onAdd&&g.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const a=this.getOwnSource(t);if(!a)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const g=Object.entries(this.stylesheet.iconsets).find((([y,b])=>b.type==="source"&&b.source===t));if(g)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while iconset "${g[0]}" is using it.`)))}const h=this.getOwnSourceCaches(t);for(const g of h){const y=r.dl(g.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(g.id),g.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getOwnSource(t).setData(a),this._changes.setDirty()}getOwnSource(t){const a=this.getOwnSourceCache(t);return a&&a.getSource()}getOwnSources(){const t=[];for(const a in this._otherSourceCaches){const h=this.getOwnSourceCache(a);h&&t.push(h.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const a in t){const h=t[a]._tiles;for(const g in h){const y=h[g];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const y of t){if(this._validate(Po,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(y),b.updateTransitions(a)}else this.ambientLight=new Ci(y,Ui||(Ui=new r.a9({color:new r.aa(r.a6.properties_light_ambient.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(y),b.updateTransitions(a)}else this.directionalLight=new Ci(y,Er||(Er=new r.a9({direction:new r.ap(r.a6.properties_light_directional.direction),color:new r.aa(r.a6.properties_light_directional.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_directional.intensity),"cast-shadows":new r.aa(r.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new r.aa(r.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.aa(r.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const h=Object.assign(a,{worldview:this.map.getWorldview()}),g=new r.ac(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,a=this.ambientLight;if(!t||!a)return;const h=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),g=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=t.properties.get("intensity"),b=t.properties.get("direction"),S=1-r.d3(b.x,b.y,b.z)[2]/90,M=h(g)*y*S,D=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),O=a.properties.get("intensity"),j=h(D)*O;return Number(((M+j)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(r.dm(t)){const a=r.dn(t),h=this.fragments.find((({id:y})=>y===a));if(!h)return;const g=r.dl(t);return h.style.getFragmentStyle(g)}{const a=this.fragments.find((({id:h})=>h===t));return a?a.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const a={},h=(g,y="")=>`${g}::${y}`;this._featuresetSelectors={};for(const g in t){const y=this._featuresetSelectors[g]=[];for(const b of t[g].selectors){if(b.featureNamespace){const M=this.getOwnLayer(b.layer);if(!M){r.w(`Layer is undefined for selector: ${b.layer}`);continue}const D=h(M.source,M.sourceLayer);if(D in a&&a[D]!==b.featureNamespace){r.w(`"featureNamespace ${b.featureNamespace} of featureset ${g}'s selector is not associated to the same source, skip this selector`);continue}a[D]=b.featureNamespace}let S;if(b.properties)for(const M in b.properties){const D=r.U(b.properties[M]);D.result==="success"&&(S=S||{},S[M]=D.value)}y.push({layerId:b.layer,namespace:b.featureNamespace,properties:S,uniqueFeatureID:b._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const a=this.getFragmentStyle(t);if(!a||!a.stylesheet.featuresets)return[];const h=[];for(const g in a.stylesheet.featuresets)h.push({featuresetId:g,importId:a.scope?a.scope:void 0});return h}getFeaturesetLayers(t,a){const h=this.getFragmentStyle(a),g=h.stylesheet.featuresets;if(!g||!g[t])return this.fire(new r.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const b of g[t].selectors){const S=h.getOwnLayer(b.layer);S&&y.push(S)}return y}getConfigProperty(t,a){const h=this.getFragmentStyle(t);if(!h)return null;const g=r.B(a,h.scope),y=h.options.get(g),b=y?y.value||y.default:null;return b?b.serialize():null}setConfigProperty(t,a,h){const g=this.getFragmentStyle(t);if(!g)return;const y=g.stylesheet.schema;if(!y||!y[a])return;const b=r.U(h);if(b.result!=="success")return void dc(this,b.value);const S=b.value.expression,M=r.B(a,g.scope),D=g.options.get(M);if(!D)return;let O;const{minValue:j,maxValue:B,stepValue:q,type:H,values:Z}=y[a],re=r.U(y[a].default);re.result==="success"&&(O=re.value.expression),O?(this.options.set(M,Object.assign({},D,{value:S,default:O,minValue:j,maxValue:B,stepValue:q,type:H,values:Z})),this.updateConfigDependencies(a)):this.fire(new r.y(new Error(`No schema defined for the config option "${a}" in the "${t}" fragment.`)))}getConfig(t){const a=this.getFragmentStyle(t);if(!a)return null;const h=a.stylesheet.schema;if(!h)return null;const g={};for(const y in h){const b=r.B(y,a.scope),S=a.options.get(b),M=S?S.value||S.default:null;g[y]=M?M.serialize():null}return g}setConfig(t,a){const h=this.getFragmentStyle(t);h&&(h.updateConfig(a,h.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const a=this.getFragmentStyle(t);return a?a.stylesheet.schema:null}setSchema(t,a){const h=this.getFragmentStyle(t);h&&(h.stylesheet.schema=a,h.updateConfig(h._config,a),this.updateConfigDependencies())}updateConfig(t,a){if(this._config=t,t||a)if(a)for(const h in a){let g,y;const b=r.U(a[h].default);if(b.result==="success"&&(g=b.value.expression),t&&t[h]!==void 0){const B=r.U(t[h]);B.result==="success"&&(y=B.value.expression)}const{minValue:S,maxValue:M,stepValue:D,type:O,values:j}=a[h];if(g){const B=r.B(h,this.scope);this.options.set(B,{default:g,value:y,minValue:S,maxValue:M,stepValue:D,type:O,values:j})}else this.fire(new r.y(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const a of this._configDependentLayers){const h=this.getLayer(a);if(h){if(t&&!h.configDependencies.has(t))continue;h.possiblyEvaluateVisibility(),this._updateLayer(h)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((a=>{const h=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(h){const g=a._evaluateColorThemeData(h);(!a._styleColorTheme.lut&&g!==""||a._styleColorTheme.lut&&g!==a._styleColorTheme.lut.data)&&a.setColorTheme(h)}})),this._changes.setDirty()}addLayer(t,a,h={}){this._checkLoaded();const g=t.id;if(this._layers[g])return void this.fire(new r.y(new Error(`Layer with id "${g}" already exists on this map`)));let y;if(t.type==="custom"){if(dc(this,r.dp(t)))return;y=r.dq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(g,t.source),t=r.dk(t),t=Object.assign(t,{source:g})),this._validate(Xe,`layers.${g}`,t,{arrayIndex:-1},h))return;y=r.dq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let b=this._order.length;if(a){const O=this._order.indexOf(a);if(O===-1)return void this.fire(new r.y(new Error(`Layer with id "${a}" does not exist on this map.`)));y.slot===this._layers[a].slot?b=O:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,g),this._layerOrderChanged=!0,this._layers[g]=y;const S=this.getOwnLayerSourceCache(y),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&y.canCastShadows()&&M&&(S.castsShadows=!0);const D=this._changes.getRemovedLayer(y);if(D&&y.source&&S&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const O=r.B(y.source,y.scope);D.type!==y.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),S.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(t,a){this._checkLoaded();const h=this._checkLayer(t);if(!h||t===a)return;const g=this._order.indexOf(t);this._order.splice(g,1);let y=this._order.length;if(a){const b=this._order.indexOf(a);if(b===-1)return void this.fire(new r.y(new Error(`Layer with id "${a}" does not exist on this map.`)));h.slot===this._layers[a].slot?y=b:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const a=this._checkLayer(t);if(!a)return;a.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const g=this.getOwnLayerSourceCache(a);if(g&&g.castsShadows){let y=!1;for(const b in this._layers)if(this._layers[b].source===a.source&&this._layers[b].canCastShadows()){y=!0;break}g.castsShadows=y}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,h){this._checkLoaded();const g=this._checkLayer(t);g&&(g.minzoom===a&&g.maxzoom===h||(a!=null&&(g.minzoom=a),h!=null&&(g.maxzoom=h),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,a){this._checkLoaded();const h=this._checkLayer(t);h&&h.slot!==a&&(h.slot=a,this._updateLayer(h))}setFilter(t,a,h={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!r.by(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(ee,`layers.${g.id}.filter`,a,{layerType:g.type},h)||(g.filter=r.dk(a),this._updateLayer(g)))}getFilter(t){const a=this._checkLayer(t);if(a)return r.dk(a.filter)}setLayoutProperty(t,a,h,g={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!r.by(y.getLayoutProperty(a),h)){if(h!=null&&(!g||g.validate!==!1)&&dc(y,we.call(qr,{key:`layers.${t}.layout.${a}`,layerType:y.type,objectKey:a,value:h,styleSpec:r.a6,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(a,h),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(t,a){const h=this._checkLayer(t);if(h)return h.getLayoutProperty(a)}setPaintProperty(t,a,h,g={}){this._checkLoaded();const y=this._checkLayer(t);if(!y||r.by(y.getPaintProperty(a),h)||h!=null&&(!g||g.validate!==!1)&&dc(y,se.call(qr,{key:`layers.${t}.paint.${a}`,layerType:y.type,objectKey:a,value:h,styleSpec:r.a6})))return;const b=y.setPaintProperty(a,h);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),b&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(t,a){const h=this._checkLayer(t);if(h)return h.getPaintProperty(a)}setFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:M,importId:D}=t.target,O=this.getFragmentStyle(D),j=O.getFeaturesetLayers(M);for(const{source:B,sourceLayer:q}of j)O.setFeatureState({id:t.id,source:B,sourceLayer:q},a)}else if("layerId"in t.target){const{layerId:M}=t.target,D=this.getLayer(M);this.setFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},a)}return}const h=t.source,g=t.sourceLayer,y=this._checkSource(h);if(!y)return;const b=y.type;if(b==="geojson"&&g)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!g)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(h);for(const M of S)M.setFeatureState(g,t.id,a)}removeFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:M,importId:D}=t.target,O=this.getFragmentStyle(D),j=O.getFeaturesetLayers(M);for(const{source:B,sourceLayer:q}of j)O.removeFeatureState({id:t.id,source:B,sourceLayer:q},a)}else if("layerId"in t.target){const{layerId:M}=t.target,D=this.getLayer(M);this.removeFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},a)}return}const h=t.source,g=this._checkSource(h);if(!g)return;const y=g.type,b=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!b)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(h);for(const M of S)M.removeFeatureState(b,t.id,a)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let y;if("featuresetId"in t.target){const{featuresetId:b,importId:S}=t.target,M=this.getFragmentStyle(S),D=M.getFeaturesetLayers(b);for(const{source:O,sourceLayer:j}of D){const B=M.getFeatureState({id:t.id,source:O,sourceLayer:j});if(B&&!y)y=B;else if(!r.by(y,B))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:b}=t.target,S=this.getLayer(b);y=this.getFeatureState({id:t.id,source:S.source,sourceLayer:S.sourceLayer})}return y}const a=t.source,h=t.sourceLayer,g=this._checkSource(a);if(g){if(g.type!=="vector"||h)return t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(h,t.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),a=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(h=>h!==void 0))}_updateFilteredLayers(t){for(const a of Object.values(this._mergedLayers))t(a)&&this._updateLayer(a)}_updateLayer(t){this._changes.updateLayer(t);const a=this.getLayerSourceCache(t),h=r.B(t.source,t.scope),g=this._changes.getUpdatedSourceCaches();t.source&&!g[h]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),a.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=S=>this._mergedLayers[S].is3D(!!this.terrain),h=this.order,g={},y=[];for(let S=h.length-1;S>=0;S--){const M=h[S];if(a(M)){g[M]=S;for(const D of t){const O=D[M];if(O)for(const j of O)y.push(j)}}}y.sort(((S,M)=>M.intersectionZ-S.intersectionZ));const b=[];for(let S=h.length-1;S>=0;S--){const M=h[S];if(a(M))for(let D=y.length-1;D>=0;D--){const O=y[D].feature;if(O.layer&&g[O.layer.id]<S)break;b.push(O),y.pop()}else for(const D of t){const O=D[M];if(O)for(const j of O)b.push(j.feature)}}return b}queryRasterValue(t,a,h){const g=this.getOwnSource(t);return g?g.type!=="raster-array"?(this.fire(new r.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):g.queryRasterArrayValue(a,h):(this.fire(new r.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,a,h){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(ee,"queryRenderedFeatures.filter",a.filter,null,a),g=r.b6(a.filter));const y={},b=O=>{if(kd.has(O.type))return;const j=this.getOwnLayerSourceCache(O),B=y[j.id]=y[j.id]||{sourceCache:j,layers:{},has3DLayers:!1};O.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[O.fqid]=B.layers[O.fqid]||{styleLayer:O,targets:[]},B.layers[O.fqid].targets.push({filter:g})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const O of a.layers){const j=this._layers[O];if(!j)return this.fire(new r.y(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];b(j)}}else for(const O in this._layers)b(this._layers[O]);const S=this._queryRenderedFeatures(t,y,h),M=this._flattenAndSortRenderedFeatures(S),D=[];for(const O of M)r.ds(O.layer.id)===this.scope&&D.push(O);return D}queryRenderedFeatureset(t,a,h){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(ee,"queryRenderedFeatures.filter",a.filter,null,a),g=r.b6(a.filter));const y="mock",b=[];if(a&&a.target)b.push(Object.assign({},a,{targetId:y,filter:g}));else{const O=this.getFeaturesetDescriptors();for(const j of O)b.push({targetId:y,filter:g,target:j});for(const{style:j}of this.fragments){const B=j.getFeaturesetDescriptors();for(const q of B)b.push({targetId:y,filter:g,target:q})}}const S=this.queryRenderedTargets(t,b,h),M=[],D=new Set;for(const O of S)for(const j of O.variants[y])Sl(j,O,D)||M.push(new r.dt(O,j));return M}queryRenderedTargets(t,a,h){const g={},y=(S,M,D,O)=>{const j=g[M.id]=g[M.id]||{sourceCache:M,layers:{},has3DLayers:!1};if(j.layers[S.fqid]=j.layers[S.fqid]||{styleLayer:S,targets:[]},S.is3D(!!this.terrain)&&(j.has3DLayers=!0),!O)return D.uniqueFeatureID=!1,void j.layers[S.fqid].targets.push(D);j.layers[S.fqid].targets.push(Object.assign({},D,{namespace:O.namespace,properties:O.properties,uniqueFeatureID:O.uniqueFeatureID}))};for(const S of a)if("featuresetId"in S.target){const{featuresetId:M,importId:D}=S.target,O=this.getFragmentStyle(D);if(!O||!O._featuresetSelectors)continue;const j=O._featuresetSelectors[M];if(!j){this.fire(new r.y(new Error(`The featureset '${M}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of j){const q=O.getOwnLayer(B.layerId);q&&!kd.has(q.type)&&y(q,O.getOwnLayerSourceCache(q),S,B)}}else if("layerId"in S.target){const{layerId:M}=S.target,D=this.getLayer(M);if(!D||kd.has(D.type))continue;y(D,this.getLayerSourceCache(D),S)}const b=this._queryRenderedFeatures(t,g,h);return this._flattenAndSortRenderedFeatures(b)}_queryRenderedFeatures(t,a,h){const g=[],y=!!this.map._showQueryGeometry,b=Vr.createFromScreenPoints(t,h);for(const S in a){const M=ih(b,a[S],this._availableImages,h,y);Object.keys(M).length&&g.push(M)}if(this.placement)for(const S in a){if(!a[S].sourceCache._onlySymbols)continue;const M=Cp(b.screenGeometry,a[S],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(M).length&&g.push(M)}return g}querySourceFeatures(t,a){const h=a&&a.filter;h&&this._validate(ee,"querySourceFeatures.filter",h,null,a);let g=[];const y=this.getOwnSourceCaches(t);for(const b of y)g=g.concat(Ca(b,a));return g}addSourceType(t,a,h){return ra.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(ra.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,a,h={}){this._checkLoaded();const g=this.light.getLight();let y=!1;for(const S in t)if(!r.by(t[S],g[S])){y=!0;break}if(!y)return;const b=this._getTransitionParameters();this.light.setLight(t,a,h),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,a=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let h=t;const g=t.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof h.source=="object"){const S="terrain-dem-src";this.addSource(S,h.source),h=r.dk(h),h=Object.assign(h,{source:S})}const y=Object.assign({},h),b={};if(this.terrain&&g){y.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(b.style=S.serialize())}if(this._validate(Mt,"terrain",y,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&a!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,a),this.fire(new r.z("data",{dataType:"style"}))}else{const y=this.terrain,b=y.get();for(const S of Object.keys(r.a6.terrain))!h.hasOwnProperty(S)&&r.a6.terrain[S].default&&(h[S]=r.a6.terrain[S].default);for(const S in t)if(!r.by(t[S],b[S])){y.set(t,this.options),this.stylesheet.terrain=t;const M=this._getTransitionParameters({duration:0});y.updateTransitions(M),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const a=this.fog=new Qn(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}_createSnow(t){const a=this.snow=new so(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}_createRain(t){const a=this.rain=new tr(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!r.by(a.get(),t)){a.set(t,this.options),this.stylesheet.fog=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!r.by(a.get(),t)){a.set(t,this.options),this.stylesheet.snow=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!r.by(a.get(),t)){a.set(t,this.options),this.stylesheet.rain=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(const g in this._sourceCaches)this._sourceCaches[g].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void t();const h=this._evaluateColorThemeData(a);this._loadColorTheme(h).then((()=>{this.fire(new r.z("colorthemeset")),t()})).catch((g=>{r.w(`Couldn't set color theme: ${g}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,a){const h=this.getFragmentStyle(t);h&&(h._styleColorTheme.colorThemeOverride=a,h._reloadColorTheme())}_getTransitionParameters(t){return{now:r.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],a=[];for(const h of this._mergedOrder)this.isLayerDraped(this._mergedLayers[h])?t.push(h):a.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){const h=this.terrain=new at(t,a,this.scope,this.options,this.map.getWorldview());a===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="symbol"&&this._updateLayer(a)}}_validate(t,a,h,g,y={}){if(y&&y.validate===!1)return!1;const b=Object.assign({},this.serialize());return dc(this,t.call(qr,Object.assign({key:a,style:b,value:h,styleSpec:r.a6},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const a=this.getSourceCaches(t);for(const h of a)h.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const a=this._mergedLayers[t];a._clear&&a._clear()}}reloadSource(t){const a=this.getSourceCaches(t);for(const h of a)h.resume(),h.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let a;this.directionalLight&&(a=au(this.directionalLight));const h=new Set;for(const g in this._mergedLayers){const y=this._mergedLayers[g];y.hasElevation()&&!h.has(y.source)&&h.add(y.source)}for(const g in this._mergedSourceCaches){const y=this._mergedSourceCaches[g],b=h.has(y._source.id);y.update(t,void 0,void 0,a,b)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,h,g,y,b,S=!1){let M=!1,D=!1;const O={},j={};for(const B of this._mergedOrder){const q=this._mergedLayers[B];if(q.type!=="symbol")continue;const H=r.B(q.source,q.scope);let Z=O[H];if(!Z){const $=this.getLayerSourceCache(q);if(!$)continue;const ae=$.getRenderableIds(!0).map((pe=>$.getTileByID(pe)));j[H]=ae.slice(),Z=O[H]=ae.sort(((pe,ye)=>ye.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(ye.tileID)?-1:1)))}const re=this.crossTileSymbolIndex.addLayer(q,Z,a.center.lng,a.projection);M=M||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.o.now(),a.zoom))&&(this.pauseablePlacement=new ds(a,this._mergedOrder,S,h,g,y,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,O,j,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.o.now()),D=!0),M&&this.pauseablePlacement.placement.setStale()),D||M){this._buildingIndex.onNewFrame(a.zoom);for(let B=0;B<this._mergedOrder.length;B++){const q=this._mergedLayers[this._mergedOrder[B]];if(q.type!=="symbol")continue;const H=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,O[r.B(q.source,q.scope)],B,H?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,a){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex((({id:y})=>y===t.id))!==-1)return void this.fire(new r.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!a)return h.push(t),this._loadImports([t],!0);const g=h.findIndex((({id:y})=>y===a));return g===-1&&this.fire(new r.y(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=h.slice(0,g).concat(t).concat(h.slice(g)),this._loadImports([t],!0,a)}updateImport(t,a){this._checkLoaded();const h=this.stylesheet.imports||[],g=this.getImportIndex(t);return g===-1?this:typeof a=="string"?(this.setImportUrl(t,a),this):(a.url&&a.url!==h[g].url&&this.setImportUrl(t,a.url),r.by(a.config,h[g].config)||this.setImportConfig(t,a.config,a.data.schema),r.by(a.data,h[g].data)||this.setImportData(t,a.data),this)}moveImport(t,a){this._checkLoaded();let h=this.stylesheet.imports||[];const g=this.getImportIndex(t);if(g===-1)return this;const y=this.getImportIndex(a);if(y===-1)return this;const b=h[g],S=this.fragments[g];return h=h.filter((({id:M})=>M!==t)),this.fragments=this.fragments.filter((({id:M})=>M!==t)),this.stylesheet.imports=h.slice(0,y).concat(b).concat(h.slice(y)),this.fragments=this.fragments.slice(0,y).concat(S).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(t,a){this._checkLoaded();const h=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;h[g].url=a;const y=this.fragments[g];return y.style=this._createFragmentStyle(h[g]),y.style.on("style.import.load",(()=>this.mergeAll())),y.style.loadURL(a),this}setImportData(t,a){this._checkLoaded();const h=this.getImportIndex(t),g=this.stylesheet.imports||[];return h===-1?this:a?(this.fragments[h].style.setState(a),this._reloadImports(),this):(delete g[h].data,this.setImportUrl(t,g[h].url))}setImportConfig(t,a,h){this._checkLoaded();const g=this.getImportIndex(t),y=this.stylesheet.imports||[];if(g===-1)return this;a?y[g].config=a:delete y[g].config;const b=this.fragments[g];h&&b.style.stylesheet&&(b.style.stylesheet.schema=h);const S=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=a,b.style.updateConfig(a,S),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const a=this.stylesheet.imports||[],h=this.getImportIndex(t);h!==-1&&(a.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports())}getImportIndex(t){const a=(this.stylesheet.imports||[]).findIndex((h=>h.id===t));return a===-1&&this.fire(new r.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),a}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const a in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[a];h&&t.push(h.getSource())}return t}getSource(t,a){const h=this.getSourceCache(t,a);return h&&h.getSource()}getLayerSource(t){const a=this.getLayerSourceCache(t);return a&&a.getSource()}getSourceCache(t,a){const h=r.B(t,a);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(t){const a=r.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[t]&&a.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&a.push(this._mergedSymbolSourceCaches[t]),a}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const a in t){const h=t[a];h==="reload"?this.reloadSource(a):h==="clear"&&this.clearSource(a)}}updateLayers(t){const a=this._changes.getUpdatedPaintProperties();for(const h of a){const g=this.getLayer(h);g&&g.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,a,h){this.imageManager.getImages(a.images,a.scope,h),this._updateTilesForChangedImages();const g=b=>{if(b){const S=a.images.map((M=>r.I.toString(M)));b.setDependencies(a.tileID.key,a.type,S)}},y=r.B(a.source,a.scope);g(this._mergedOtherSourceCaches[y]),g(this._mergedSymbolSourceCaches[y]),a.images.some((b=>b.iconsetId))&&this.fire(new r.z("data",{dataType:"style"}))}rasterizeImages(t,a,h){this.imageManager.rasterizeImages(a,h)}getGlyphs(t,a,h){this.glyphManager.getGlyphs(a.stacks,h)}getResource(t,a,h){return r.dv(a,h)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){const a=this.getOwnSourceCaches(t);return a.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${t}'`))),!1):a.every((h=>h.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,a){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const h=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),g=t.type==="building";if(t.is3D(!!this.terrain)){if(h||g||a&&a.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ra.getSourceType=function(d){return $c[d]},ra.setSourceType=function(d,t){$c[d]=t},ra.registerForPluginStateChange=r.dw;class O_{execute(t){const a=this._makeBuildingsQueryArea(t),h=this._makeFloorsQueryArea(t),g=t.queryRenderedFeatures(a).reduce(((D,O)=>{const j=O.properties.id;return O.properties.type!=="building"||D.some((B=>B.properties.id===j))||D.push(O),D}),[]),y=t.queryRenderedFeatures(h).reduce(((D,O)=>{const j=O.properties.id;return O.properties.type!=="floor"||D.some((B=>B.properties.id===j))||D.push(O),D}),[]),b=[t.getCenter().lng,t.getCenter().lat],S=this._findBuildingAtCenter(b,g),M=g.length>0?g[0]:null;return{floors:y.map((D=>({id:D.properties.id,name:D.properties.name,isDefault:D.properties.is_default,zIndex:D.properties.z_index,connectedFloorIds:D.properties.connected_floor_ids,conflictedFloorIds:D.properties.conflicted_floor_ids,buildingIds:D.properties.building_ids}))),building:S?{id:S.properties.id,name:S.properties.name}:{id:M.properties.id,name:M.properties.name}}}_makeBuildingsQueryArea(t){const a=t.transform.width,h=t.transform.height,g=Math.min(a,h)*(1/8),y=.5*(a-g),b=.5*(h-g);return[new r.P(y,b),new r.P(y+g,b+g)]}_makeFloorsQueryArea(t){const a=t.transform.width,h=t.transform.height;return[new r.P(0,0),new r.P(a,h)]}_findBuildingAtCenter(t,a){for(const h of a)if(h.geometry.type==="Polygon"&&this._pointInPolygon(t,h.geometry.coordinates[0]))return h;return null}_pointInPolygon(t,a){let h=!1;for(let g=0,y=a.length-1;g<a.length;y=g++){const b=a[g][0],S=a[g][1],M=a[y][1];S>t[1]!=M>t[1]&&t[0]<(a[y][0]-b)*(t[1]-S)/(M-S)+b&&(h=!h)}return h}}class F_{constructor(){this._floors=new Map,this._buildings=new Map}append(t){const a=t.building;let h=!1;if(a){const g=a.id;g&&(this._buildings.set(g,a),h||this._buildings.has(g)||(h=!0))}return t.floors.forEach((g=>{const y=g.id;h||this._floors.has(y)||(h=!0),this._floors.set(y,g)})),h}clear(){this._floors.clear(),this._buildings.clear()}getFloors(t=null){const a=Array.from(this._floors.values());return t?a.filter((h=>{const g=h.buildingIds;return!!g&&g.split(";").includes(t)})):a}}class B_{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new F_}setIndoorData(t){const a=this._featuresStorage.append(t);return this._selectedBuildingId=t.building?t.building.id:null,a}setFloorId(t){const a=this._selectedFloorId!==t;return a&&(this._selectedFloorId=t),a}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const t=this._featuresStorage.getFloors(this._selectedBuildingId),a=this.getActiveFloors().find((h=>{const g=h.buildingIds;if(!g)return!1;const y=g.split(";");return!!this._selectedBuildingId&&y.includes(this._selectedBuildingId)}));return{selectedFloorId:a?a.id:null,floors:t}}getActiveFloors(t=!1){const a=this._featuresStorage.getFloors(),h=a.find((M=>M.id===this._selectedFloorId)),g=a.filter((M=>M.isDefault===!0));let y=[];if(h)return y=this._calculateCurrentActiveFloors(a,h,g,t),y;if(g.length===0){const M=this._featuresStorage.getFloors(this._selectedBuildingId);y=M.length>0?[M[0]]:[]}else y=g;const b=this._getNonConflictingLastActiveFloors(y),S=[...y,...b];return this._lastActiveFloors=S,S}hasBuildingChanged(t){return this._selectedBuildingId!==(t.building?t.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(t,a,h,g){if(!a)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,h);const y=this._getConnectedFloors(a,t);return g?this._buildExplicitSelectionFloors(a,y,h):this._buildImplicitSelectionFloors(y,h)}_getConnectedFloors(t,a){const h=t.connectedFloorIds;if(!h)return[];const g=new Set(h.split(";"));return a.filter((y=>g.has(y.id)))}_buildExplicitSelectionFloors(t,a,h){const g=[t,...a],y=this._getNonConflictingLastActiveFloors(g),b=[...g,...y],S=this._deduplicateFloors(b),M=this._getConflictingFloorIdsFrom(S),D=h.filter((j=>!M.has(j.id))),O=[...S,...D];return this._lastActiveFloors=O,O}_buildImplicitSelectionFloors(t,a){const h=this._getConflictingFloorIdsFrom(this._lastActiveFloors),g=a.filter((b=>!h.has(b.id))),y=this._deduplicateFloors([...this._lastActiveFloors,...g]);return this._lastActiveFloors=y,y}_getNonConflictingDefaultFloors(t,a){const h=this._getConflictingFloorIdsFrom(t),g=a.filter((b=>!h.has(b.id))),y=this._deduplicateFloors([...t,...g]);return this._lastActiveFloors=y,y}_deduplicateFloors(t){const a=new Set;return t.filter((h=>{const g=h.id;return!a.has(g)&&(a.add(g),!0)}))}_getConflictingFloorIdsFrom(t){const a=new Set;return t.forEach((h=>{const g=h.conflictedFloorIds;g&&g.split(";").forEach((y=>a.add(y)))})),a}_getNonConflictingLastActiveFloors(t){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const a=new Set(t.map((g=>g.id))),h=this._getConflictingFloorIdsFrom(t);return this._lastActiveFloors.filter((g=>{const y=g.id;return!a.has(y)&&!h.has(y)}))}_isFloorConflicted(t,a){const h=t.id;return a.some((g=>{const y=g.conflictedFloorIds;return!!y&&y.split(";").includes(h)}))}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class fc extends r.E{constructor(t){super(),r.aY(["_onLoad","_onMove"],this),this._map=t,this._floorSelectionState=new B_,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(t){this._floorSelectionState.setFloorId(t)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle((t=>{t.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=t.scope,this._indoorDataQuery=new O_))})),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const t=this._indoorDataQuery.execute(this._map);if(!t||t.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(t)){if(!t.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(t),t.building&&this._updateIndoorSelector()}else this._setIndoorData(t)}_setIndoorData(t){this._floorSelectionState.setIndoorData(t)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const t=this._floorSelectionState.getCurrentBuildingSelection(),a=t.floors.map((h=>({id:h.id,name:h.name,shortName:h.zIndex.toString(),levelOrder:h.zIndex})));this.fire(new r.z("indoorupdate",{selectedFloorId:t.selectedFloorId,floors:a}))}_updateIndoorConfig(t=!1){const a=this._floorSelectionState.getActiveFloors(t).map((h=>h.id))||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",a])}}var _h=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Gp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Wp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,cu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",uu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,qp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,zd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,js=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Dd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Yt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Hp=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const hu=[];oa(_h,hu),oa(Wp,hu),oa(Gp,hu);const du={"_prelude_fog.vertex.glsl":qp,"_prelude_terrain.vertex.glsl":uu,"_prelude_shadow.vertex.glsl":Yt,"_prelude_fog.fragment.glsl":zd,"_prelude_shadow.fragment.glsl":Hp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":js,"_prelude_raster_particle.glsl":Dd},yh={};vi("",uu),vi(zd,qp),vi(Hp,Yt),vi(js,""),vi(Dd,"");const vh=vi(Gp,Wp),ka=_h;var Ld={background:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:vi(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:vi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:vi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:vi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:vi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:vi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:vi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:vi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:vi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:vi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:vi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:vi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:vi(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:vi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:vi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:vi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:vi(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:vi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:vi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,cu),skyboxGradient:vi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,cu),skyboxCapture:vi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:vi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:vi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:vi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:vi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:vi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:vi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:vi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function oa(d,t){const a=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of a)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=h.split(" ");for(const y of g)t.includes(y)||t.push(y)}}function vi(d,t){const a=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,g={},y=[],b=[];if(d=d.replace(a,((M,D)=>(b.push(D),""))),(t=t.replace(a,((M,D)=>(y.push(D),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...hu];oa(d,S),oa(t,S);for(const M of[...y,...b])du[M]||console.error(`Undefined include: ${M}`),yh[M]||(yh[M]=[],oa(du[M],yh[M])),S=[...S,...yh[M]];return{fragmentSource:d=d.replace(h,((M,D,O,j,B)=>(g[B]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${O} ${j} ${B};
#else
uniform ${O} ${j} u_${B};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${B}
    ${O} ${j} ${B} = u_${B};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${O} ${j} ${B};
#endif
`:D==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(h,((M,D,O,j,B)=>{const q=j==="float"?"vec2":j,H=B.match(/color/)?"color":q;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${B}
in ${O} ${j} a_${B};
#endif
`:g[B]?D==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${O} ${q} a_${B};
out ${O} ${j} ${B};
#else
uniform ${O} ${j} u_${B};
#endif
`:D==="initialize"?H==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${O} ${j} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${H}(a_${B}, u_${B}_t);
#else
    ${O} ${j} ${B} = u_${B};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${O} ${j} a_${B};
    out ${O} ${j} ${B};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${B} = a_${B};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${O} ${q} a_${B};
#else
uniform ${O} ${j} u_${B};
#endif
`:D==="define-instanced"?H==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${B}0;
in vec4 a_${B}1;
in vec4 a_${B}2;
in vec4 a_${B}3;
#else
uniform ${O} ${j} u_${B};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${q} a_${B};
#else
uniform ${O} ${j} u_${B};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${O} ${j} ${B} = a_${B};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${O} ${j} ${B} = a_${B};
#else
    ${O} ${j} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${O} ${j} ${B} = unpack_mix_${H}(a_${B}, u_${B}_t);
#else
    ${O} ${j} ${B} = u_${B};
#endif
`})),usedDefines:S,vertexIncludes:y,fragmentIncludes:b}}class fu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,a,h,g,y,b,S,M){this.context=t;let D=this.boundPaintVertexBuffers.length!==g.length;for(let j=0;!D&&j<g.length;j++)this.boundPaintVertexBuffers[j]!==g[j]&&(D=!0);let O=this.boundDynamicVertexBuffers.length!==S.length;for(let j=0;!O&&j<S.length;j++)this.boundDynamicVertexBuffers[j]!==S[j]&&(O=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==h||D||O||this.boundIndexBuffer!==y||this.boundVertexOffset!==b)this.freshBind(a,h,g,y,b,S,M);else{t.bindVertexArrayOES.set(this.vao);for(const j of S)j&&(j.bind(),M&&j.instanceCount&&j.setVertexAttribDivisor(t.gl,a,M));y&&y.dynamicDraw&&y.bind()}}freshBind(t,a,h,g,y,b,S){const M=this.context,D=M.gl;this.vao&&this.destroy(),this.vao=M.gl.createVertexArray(),M.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=b,a.enableAttributes(D,t),a.bind(),a.setVertexAttribPointers(D,t,y);for(const O of h)O.enableAttributes(D,t),O.bind(),O.setVertexAttribPointers(D,t,y);for(const O of b)O&&(O.enableAttributes(D,t),O.bind(),O.setVertexAttribPointers(D,t,y),S&&O.instanceCount&&O.setVertexAttribDivisor(D,t,S));g&&g.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Sx(d,t){const a=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new r.ae(0,h/a).toLngLat().lat,new r.ae(0,(h+1)/a).toLngLat().lat]}function Ex(d,t,a,h,g,y,b){const S=d.context,M=S.gl,D=a.hillshadeFBO;if(!D)return;d.prepareDrawTile();const O=d.isTileAffectedByFog(t),j=d.getOrCreateProgram("hillshade",{overrideFog:O});S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,D.colorAttachment.get());const B=((re,$,ae,pe)=>{const ye=ae.paint.get("hillshade-shadow-color"),Ce=ae.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ae=ae.paint.get("hillshade-highlight-color"),ke=ae.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Me=ae.paint.get("hillshade-accent-color"),Ee=ae.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ze=ae.paint.get("hillshade-emissive-strength");let ot=r.an(ae.paint.get("hillshade-illumination-direction"));if(ae.paint.get("hillshade-illumination-anchor")==="viewport")ot-=re.transform.angle;else if(re.style&&re.style.enable3dLights()&&re.style.directionalLight){const mt=re.style.directionalLight.properties.get("direction"),$e=r.d3(mt.x,mt.y,mt.z);ot=r.an($e[1])}const Ze=!re.options.moving;return{u_matrix:pe||re.transform.calculateProjMatrix($.tileID.toUnwrapped(),Ze),u_image:0,u_latrange:Sx(0,$.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),ot],u_shadow:ye.toPremultipliedRenderColor(Ce?null:ae.lut),u_highlight:Ae.toPremultipliedRenderColor(ke?null:ae.lut),u_emissive_strength:ze,u_accent:Me.toPremultipliedRenderColor(Ee?null:ae.lut)}})(d,a,h,d.terrain?t.projMatrix:null);d.uploadCommonUniforms(S,j,t.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:H,tileBoundsSegments:Z}=d.getTileBoundsBuffers(a);j.draw(d,M.TRIANGLES,g,y,b,jn.disabled,B,h.id,q,H,Z)}function Od(d,t,a){if(!t.needsDEMTextureUpload)return;const h=d.context,g=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(a.stride);const y=a.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new r.T(h,y,g.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Ax(d,t,a){const h=d.context,g=h.gl;if(!t.dem)return;const y=t.dem;if(h.activeTexture.set(g.TEXTURE1),Od(d,t,y),!t.demTexture)return;t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const b=y.dim;h.activeTexture.set(g.TEXTURE0);let S=t.hillshadeFBO;if(!S){const B=new r.T(h,{width:b,height:b,data:null},g.RGBA8);B.bind(g.LINEAR,g.CLAMP_TO_EDGE),S=t.hillshadeFBO=h.createFramebuffer(b,b,!0,"renderbuffer"),S.colorAttachment.set(B.texture)}h.bindFramebuffer.set(S.framebuffer),h.viewport.set([0,0,b,b]);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:D,tileBoundsSegments:O}=d.getMercatorTileBoundsBuffers(),j=[];d.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:j}).draw(d,g.TRIANGLES,an.disabled,On.disabled,si.unblended,jn.disabled,((B,q)=>{const H=q.stride,Z=r.bC();return r.cd(Z,0,r.al,-r.al,0,0,1),r.br(Z,Z,[0,-r.al,0]),{u_matrix:Z,u_image:1,u_dimension:[H,H],u_zoom:B.overscaledZ}})(t.tileID,y),a.id,M,D,O),t.needsHillshadePrepare=!1}class Or{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class N_ extends Or{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Zp extends Or{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ix extends Or{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Mx extends Or{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Cx extends Or{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Px extends Or{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class V_ extends Or{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class kx extends Or{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Fd extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Rx extends Or{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class U_ extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Xp extends Or{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Bd extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Yp extends Or{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pc extends Or{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class pu extends Or{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Nd extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Vd extends Or{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class mu extends Or{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let j_=class extends Or{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Kp extends Or{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class G_ extends Or{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class gu extends Or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ud extends Or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class jd extends Or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Jp extends Or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Gd extends Or{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class xh extends Or{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class W_ extends Or{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class q_ extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class H_ extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class kl extends Or{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Z_ extends kl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class X_ extends kl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class zx extends kl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Dx extends X_{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Qp=(d,t,a)=>({u_matrix:d,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:a}),Wd=(d,t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:y,u_image0:0,u_frustum_tl:b,u_frustum_tr:S,u_frustum_br:M,u_frustum_bl:D,u_globe_pos:O,u_globe_radius:j,u_viewport:B,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:H});function qd(d,t){return d!=null&&t!=null&&!(!d.hasData()||!t.hasData())&&d.demTexture!=null&&t.demTexture!=null&&d.tileID.key!==t.tileID.key}const Rl=new class{constructor(){this.operations={}}newMorphing(d,t,a,h,g){if(d in this.operations){const y=this.operations[d];y.to.tileID.key!==a.tileID.key&&(y.queued=a)}else this.operations[d]={startTime:h,phase:0,duration:g,from:t,to:a,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const t=this.operations[d];return{from:t.from,to:t.to,phase:t.phase}}update(d){for(const t in this.operations){const a=this.operations[t];for(a.phase=(d-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,d)){delete this.operations[t];break}}}_nextOp(d,t){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=t,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},$p={0:null,1:"TERRAIN_VERTEX_MORPHING"};function em(d,t,a){if(t===0)return 0;const h=t<1&&a===514?.25/t:1;return 6*Math.pow(1.5,22-d)*Math.max(t,1)*h}function Lx(d,t){const a=1<<d.z;return!t&&(d.x===0||d.x===a-1)||d.y===0||d.y===a-1}const mc=d=>({u_matrix:d});function gc(d,t,a,h,g){if(g>0){const y=r.o.now(),b=(y-d.timeAdded)/g,S=t?(y-t.timeAdded)/g:-1,M=a.getSource(),D=h.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),O=!t||Math.abs(t.tileID.overscaledZ-D)>Math.abs(d.tileID.overscaledZ-D),j=O&&d.refreshedUponExpiration?1:r.aA(O?b:1-S,0,1);return t?{opacity:1,mix:1-j,isFading:b<1}:{opacity:j,mix:0,isFading:b<1}}return{opacity:1,mix:0,isFading:!1}}class Y_ extends Bs{constructor(t){const a=th("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class Gs extends Bs{constructor(t){const a=th("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,h){if(t.freezeTileCoverage)return;this.transform=t;const g=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){const S=new El(b,this._source.tileSize*b.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);S.state="loaded",this._tiles[b.key]=S}return y}),{});for(const y in this._tiles)y in g||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){const a=this.proxyCachedFBO[t];if(a!==void 0){const h=Object.values(a);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Hd extends r.aO{constructor(t,a,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=h}}class bh extends r.dH{constructor(t,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,g,y]=(function(M){const D=new r.bd,O=new r.b1,j=131;D.reserve(17161),O.reserve(33800);const B=r.al/128,q=r.al+B/2,H=q+B;for(let re=-B;re<H;re+=B)for(let $=-B;$<H;$+=B){const ae=$<0||$>q||re<0||re>q?24575:0,pe=r.aA(Math.round($),0,r.al),ye=r.aA(Math.round(re),0,r.al);D.emplaceBack(pe+ae,ye)}const Z=(re,$)=>{const ae=$*j+re;O.emplaceBack(ae+1,ae,ae+j),O.emplaceBack(ae+j,ae+j+1,ae+1)};for(let re=1;re<129;re++)for(let $=1;$<129;$++)Z($,re);return[0,129].forEach((re=>{for(let $=0;$<130;$++)Z($,re),Z(re,$)})),[D,O,32768]})(),b=t.context;this.gridBuffer=b.createVertexBuffer(h,r.bf.members),this.gridIndexBuffer=b.createIndexBuffer(g),this.gridSegments=r.bg.simpleSegment(0,0,h.length,g.length),this.gridNoSkirtSegments=r.bg.simpleSegment(0,0,h.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Gs(a.map),this.orthoMatrix=r.bC(),r.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.al,0,r.al,0,1);const S=b.gl;this._overlapStencilMode=new On({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Y_(a.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,a,h){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const g=t.terrain.properties,y=t.terrain.drapeRenderMode===0,b=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.o.now();const S=t.terrain&&t.terrain.scope,M=g.get("source"),D=y?this._mockSourceCache:t.getSourceCache(M,S);if(!D)return void r.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=D,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(a):g.get("exaggeration"),!a.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const O=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(a,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),a.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const a=this._previousCameraAltitude,h=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=h;const g=a!=null?h-a:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const y=t.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(y);let S=y-this._previousZoom;const M=this._previousUpdateTimestamp;let D=y;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(y-D)>.5&&(S=.5*(y-D+S)),S*g<0&&(D+=S)),this._evaluationZoom=D;const O=b.getExaggeration(D),j=O===b.getExaggeration(Math.max(0,D-.1));if(j&&Math.abs(O-this._exaggeration)<.01)return O;let B=Math.min(.1,.00375*(this._updateTimestamp-M));return(j||O<.1||Math.abs(S)<1e-4)&&(B=Math.min(.2,4*B)),r.ak(this._exaggeration,O,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(r.ae.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=a.getIds().map((M=>{const D=a.getTileByID(M).tileID;return D.projMatrix=h.calculateProjMatrix(D.toUnwrapped()),D}));(function(M,D){const O=D.transform.pointCoordinate(D.transform.getCameraPoint()),j=new r.P(O.x,O.y);M.sort(((B,q)=>{if(q.overscaledZ-B.overscaledZ)return q.overscaledZ-B.overscaledZ;const H=new r.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),Z=new r.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),re=j.mult(1<<B.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(H)-re.distSqr(Z)}))})(g,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},g.forEach((M=>{this.proxyToSource[M.key]={}})),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const M in b){const D=b[M];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,t[M],y),D.usedForTerrain))continue;const O=t[M];D.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[a.id]=g.map((M=>new Hd(M,M.key,this.orthoMatrix))),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const D=this.terrainTileForTile[M.key];if(!D)continue;const O=D.tileID.key;O in S||(this._visibleDemTiles.push(D),S[O]=O)}}_assignTerrainTiles(t){this._initializing||t.forEach((a=>{if(this.terrainTileForTile[a.key])return;const h=this._findTileCoveringTileID(a,this.sourceCache);h&&(this.terrainTileForTile[a.key]=h)}))}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const h in this.terrainTileForTile){const g=this.terrainTileForTile[h],y=g.dem;!y||g.demTexture&&!g.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),Od(this.painter,g,y))}}_prepareDemTileUniforms(t,a,h,g){if(!a||a.demTexture==null)return!1;const y=t.tileID.canonical,b=Math.pow(2,a.tileID.canonical.z-y.z),S=g||"";return h[`u_dem_tl${S}`]=[y.x*b%1,y.y*b%1],h[`u_dem_scale${S}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const a=this._visibleDemTiles.reduce(((h,g)=>{if(!g.dem)return h;const y=g.dem.tree.minimums[0];return y>0&&t++,h+y}),0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const h=this._getLoadedAreaMinimum(),g=new r.dI({width:1,height:1},new Float32Array([h]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(g,{premultiply:!1}):y=this._emptyDEMTexture=new r.T(t,g,a.R32F,{premultiply:!1}),y}setupElevationDraw(t,a,h){const g=this.painter.context,y=g.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let S=null,M=null,D=1;if(h&&h.morphing&&this._useVertexMorphing){const q=h.morphing.srcDemTile,H=h.morphing.dstDemTile;D=h.morphing.phase,q&&H&&(this._prepareDemTileUniforms(t,q,b,"_prev")&&(M=q),this._prepareDemTileUniforms(t,H,b)&&(S=H))}const O=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let j=null;var B;if(this.enabled?M&&S?(j=S.demTexture,g.activeTexture.set(y.TEXTURE4),M.demTexture.bind(O(M),y.CLAMP_TO_EDGE),b.u_dem_lerp=D):(S=this.terrainTileForTile[t.tileID.key],j=this._prepareDemTileUniforms(t,S,b)?S.demTexture:this.emptyDEMTexture):j=this.emptyDEMTexture,g.activeTexture.set(y.TEXTURE2),j&&(b.u_dem_size=(B=j).size[0]===1?1:B.size[0]-2,j.bind(O(S),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(h&&h.useDepthForOcclusion,a,b),h&&h.useMeterToDem&&S){const q=(1<<S.tileID.canonical.z)*r.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=q}if(h&&h.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),a.setTerrainUniformValues(g,b),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,t.tileID.canonical,h&&h.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,q)}}globeUniformValues(t,a,h){const g=t.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,r.al,0),u_tile_br_up:g.upVector(a,r.al,r.al),u_tile_bl_up:g.upVector(a,0,r.al),u_tile_up_scale:h?r.dJ(1):g.upVectorScale(a,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const a=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(g,y,b,S,M){if(g.transform.projection.name==="globe")(function(D,O,j,B,q){const H=D.context,Z=H.gl;let re,$;const ae=D.transform,pe=r.dA(D,H,ae),ye=(mt,$e)=>{if($===$e)return;const pt=[$p[$e],"PROJECTION_GLOBE_VIEW"];pe&&pt.push("CUSTOM_ANTIALIASING");const Ht=D.isTileAffectedByFog(mt);re=D.getOrCreateProgram("globeRaster",{defines:pt,overrideFog:Ht}),$=$e},Ce=D.colorModeForRenderPass(),Ae=new an(Z.LEQUAL,an.ReadWrite,D.depthRangeFor3D);Rl.update(q);const ke=r.dB(ae),Me=[r.aF(ae.center.lng),r.aJ(ae.center.lat)],Ee=D.globeSharedBuffers,ze=[ae.width*r.o.devicePixelRatio,ae.height*r.o.devicePixelRatio],ot=Float32Array.from(ae.globeMatrix),Ze={useDenormalizedUpVectorScale:!0};{const mt=D.transform,$e=em(mt.zoom,O.exaggeration(),O.sourceCache._source.tileSize);$=-1;const pt=Z.TRIANGLES;for(const Ht of B){const rt=j.getTile(Ht),Ue=On.disabled,xt=O.prevTerrainTileForTile[Ht.key],ct=O.terrainTileForTile[Ht.key];qd(xt,ct)&&Rl.newMorphing(Ht.key,xt,ct,q,250),H.activeTexture.set(Z.TEXTURE0),rt.texture&&rt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const Ct=Rl.getMorphValuesForProxy(Ht.key),qt=Ct?1:0;Ct&&Object.assign(Ze,{morphing:{srcDemTile:Ct.from,dstDemTile:Ct.to,phase:r.dz(Ct.phase)}});const nn=r.dC(Ht.canonical),Vt=r.dD(nn.getCenter().lat),Ot=r.dE(Ht.canonical,nn,Vt,mt.worldSize/mt._pixelsPerMercatorPixel),vn=r.bk(r.dF(Ht.canonical)),gn=Wd(mt.expandedFarZProjMatrix,ot,ke,vn,r.aj(mt.zoom),Me,mt.frustumCorners.TL,mt.frustumCorners.TR,mt.frustumCorners.BR,mt.frustumCorners.BL,mt.globeCenterInViewSpace,mt.globeRadius,ze,$e,mt._farZ,Ot);if(ye(Ht,qt),re&&(O.setupElevationDraw(rt,re,Ze),D.uploadCommonUniforms(H,re,Ht.toUnwrapped()),Ee)){const[yn,mn,qn]=Ee.getGridBuffers(Vt,$e!==0);re.draw(D,pt,Ae,Ue,Ce,jn.backCCW,gn,"globe_raster",yn,mn,qn)}}}if(Ee&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const mt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&mt.push("CUSTOM_ANTIALIASING"),re=D.getOrCreateProgram("globeRaster",{defines:mt});for(const $e of B){const{x:pt,y:Ht,z:rt}=$e.canonical,Ue=Ht===0,xt=Ht===(1<<rt)-1,[ct,Ct,qt,nn]=Ee.getPoleBuffers(rt,!1);if(nn&&(Ue||xt)){const Vt=j.getTile($e);H.activeTexture.set(Z.TEXTURE0),Vt.texture&&Vt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let Ot=r.dG(rt,pt,ae);const vn=r.bk(r.dF($e.canonical)),gn=(yn,mn)=>yn.draw(D,Z.TRIANGLES,Ae,On.disabled,Ce,jn.disabled,Wd(ae.expandedFarZProjMatrix,Ot,Ot,vn,0,Me,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,ze,0,ae._farZ),"globe_pole_raster",mn,qt,nn);O.setupElevationDraw(Vt,re,Ze),D.uploadCommonUniforms(H,re,$e.toUnwrapped()),Ue&&D.renderDefaultNorthPole&&gn(re,ct),xt&&D.renderDefaultSouthPole&&(Ot=r.cR(r.bC(),Ot,[1,-1,1]),gn(re,Ct))}}}})(g,y,b,S,M);else{const D=g.context,O=D.gl;let j,B;const q=g.shadowRenderer,H=Cl(g,g.longestCutoffRange),Z=Ce=>{if(B===Ce)return;const Ae=[];Ae.push($p[Ce]),H.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),q&&(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&Ae.push("NORMAL_OFFSET")),j=g.getOrCreateProgram("terrainRaster",{defines:Ae}),B=Ce},re=g.colorModeForRenderPass(),$=new an(O.LEQUAL,an.ReadWrite,g.depthRangeFor3D);Rl.update(M);const ae=g.transform,pe=em(ae.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let ye=[0,0,0];if(q){const Ce=g.style.directionalLight,Ae=g.style.ambientLight;Ce&&Ae&&(ye=va(g.style,Ce,Ae))}{B=-1;const Ce=O.TRIANGLES,[Ae,ke]=[y.gridIndexBuffer,y.gridSegments];for(const Me of S){const Ee=b.getTile(Me),ze=On.disabled,ot=y.prevTerrainTileForTile[Me.key],Ze=y.terrainTileForTile[Me.key];qd(ot,Ze)&&Rl.newMorphing(Me.key,ot,Ze,M,250),D.activeTexture.set(O.TEXTURE0),Ee.texture&&Ee.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const mt=Rl.getMorphValuesForProxy(Me.key),$e=mt?1:0;let pt;mt&&(pt={morphing:{srcDemTile:mt.from,dstDemTile:mt.to,phase:r.dz(mt.phase)}});const Ht=Qp(Me.projMatrix,Lx(Me.canonical,ae.renderWorldCopies)?pe/10:pe,ye);if(Z($e),!j)continue;y.setupElevationDraw(Ee,j,pt);const rt=Me.toUnwrapped();q&&q.setupShadows(rt,j),g.uploadCommonUniforms(D,j,rt,null,H),j.draw(g,Ce,$,ze,re,jn.backCCW,Ht,"terrain_raster",y.gridBuffer,Ae,ke)}}}})(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const a=this.painter,h=this.painter.context,g=this.proxySourceCache,y=this.proxiedCoords[g.id],b=this._drapedRenderBatches.shift(),S=a.style.order,M=[];let D=0;for(const O of y){const j=g.getTileByID(O.proxyTileKey),B=g.proxyCachedFBO[O.key]?g.proxyCachedFBO[O.key][t]:void 0,q=B!==void 0?g.renderCache[B]:this.pool[D++],H=B!==void 0;if(j.texture=q.tex,H&&!q.dirty){M.push(j.tileID);continue}let Z;h.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(h.clear({color:r.ao.transparent,stencil:0}),q.dirty=!1);for(let re=b.start;re<=b.end;++re){const $=a.style._mergedLayers[S[re]];if($.isHidden(a.transform.zoom))continue;const ae=a.style.getLayerSourceCache($),pe=ae?this.proxyToSource[O.key][ae.id]:[O];if(!pe)continue;const ye=pe;h.viewport.set([0,0,q.fb.width,q.fb.height]),Z!==(ae?ae.id:null)&&(this._setupStencil(q,pe,$,ae),Z=ae?ae.id:null),a.renderLayer(a,ae,$,ye)}if(this._drapedRenderBatches.length===0)for(const re of this._pendingGroundEffectLayers){const $=a.style._mergedLayers[S[re]];if($.isHidden(a.transform.zoom))continue;const ae=a.style.getLayerSourceCache($),pe=ae?this.proxyToSource[O.key][ae.id]:[O];if(!pe)continue;const ye=pe;h.viewport.set([0,0,q.fb.width,q.fb.height]),Z!==(ae?ae.id:null)&&(this._setupStencil(q,pe,$,ae),Z=ae?ae.id:null),a.renderLayer(a,ae,$,ye)}this.renderedToTile?(q.dirty=!0,M.push(j.tileID)):H||--D,D===5&&(D=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),b.end+1}postRender(){}isLayerOrderingCorrect(t){const a=t.order.length;let h=-1,g=a;for(let y=0;y<a;++y)this._style.isLayerDraped(t._mergedLayers[t.order[y]])?h=Math.max(h,y):g=Math.min(g,y);return g>h}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((a=>a.dem)).forEach((a=>{t=Math.min(t,a.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,a,h){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter((y=>y.dem)).map((y=>{const b=y.tileID,S=1<<b.overscaledZ,{x:M,y:D}=b.canonical,O=M/S,j=(M+1)/S,B=D/S,q=(D+1)/S;return{minx:O,miny:B,maxx:j,maxy:q,t:y.dem.tree.raycastRoot(O,B,j,q,t,a,h),tile:y}}));g.sort(((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE)));for(const y of g){if(y.t==null)return null;const b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,a,h);if(b!=null)return b}return null}_createFBO(){const t=this.painter.context,a=t.gl,h=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const g=new r.T(t,{width:h[0],height:h[1],data:null},a.RGBA8);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);const y=t.createFramebuffer(h[0],h[1],!0,null);return y.colorAttachment.set(g.texture),y.depthAttachment=new Dx(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const a=this._style._mergedLayers[t],h=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!h&&a.shouldRedrape():!h&&a.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const h of this._style.getSources())if(h instanceof Fo){t=!0;break}if(!t)return;const a={};for(let h=0;h<this._style.order.length;++h){const g=this._style._mergedLayers[this._style.order[h]],y=this._style.getLayerSourceCache(g);if(y&&!a[y.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof r.ad){a[y.id]=!0;for(const b of this.proxyCoords){const S=this.proxyToSource[b.key][y.id];if(S)for(const M of S)this._clearRenderCacheForTile(y.id,M)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof wl){t=!0;break}if(!t)return;const a={};for(let h=0;h<this._style.order.length;++h){const g=this._style._mergedLayers[this._style.order[h]],y=this._style.getLayerSourceCache(g);if(!y||a[y.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const b=g.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const M=this.proxyToSource[S.key][y.id];if(M)for(const D of M){const O=gc(y.getTile(D),y.findLoadedParent(D,0),y,this.painter.transform,b);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(y.id,D)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,a=t.length;if(a===0)return;const h=[];this._pendingGroundEffectLayers=[];let g,y=0,b=this._style._mergedLayers[t[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<a;)b=this._style._mergedLayers[t[y]];for(;y<a;++y){const S=this._style._mergedLayers[t[y]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?g===void 0&&(g=y):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),g!==void 0&&(h.push({start:g,end:y-1}),g=void 0)))}if(g!==void 0&&h.push({start:g,end:y-1}),h.length!==0){const S=h[h.length-1];this._pendingGroundEffectLayers.every((M=>M>S.end))||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const b=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let S=0;S<b.length;++S){const M=Object.values(b[S]);a.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,g=this._tilesDirty;for(let b=h.length-1;b>=0;b--){const S=h[b];if(a.getTileByID(S.key),a.proxyCachedFBO[S.key]!==void 0){const M=t[S.key],D=this.proxyToSource[S.key];let O=0;for(const j in D){const B=D[j],q=M[j];if(!q||q.length!==B.length||B.some(((H,Z)=>H!==q[Z]||g[j]&&g[j].hasOwnProperty(H.key)))){O=-1;break}++O}for(const j in a.proxyCachedFBO[S.key])a.renderCache[a.proxyCachedFBO[S.key][j]].dirty=O<0||O!==Object.values(M).length}}const y=[...this._drapedRenderBatches];y.sort(((b,S)=>S.end-S.start-(b.end-b.start)));for(const b of y)for(const S of h){if(a.proxyCachedFBO[S.key])continue;let M=a.renderCachePool.pop();M===void 0&&a.renderCache.length<50&&(M=a.renderCache.length,a.renderCache.push(this._createFBO())),M!==void 0&&(a.proxyCachedFBO[S.key]={},a.proxyCachedFBO[S.key][b.start]=M,a.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,h,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,b=y.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let S;if(h.isTileClipped())S=a.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):On.disabled}_renderTileClippingMasks(t,a){const h=this.painter,g=this.painter.context,y=g.gl;h._tileClippingMaskIDs={},g.setColorMode(si.disabled),g.setDepthMode(an.disabled);const b=h.getOrCreateProgram("clippingMask");for(const S of t){const M=h._tileClippingMaskIDs[S.key]=--a;b.draw(h,y.TRIANGLES,an.disabled,new On({func:y.ALWAYS,mask:0},M,255,y.KEEP,y.KEEP,y.REPLACE),si.disabled,jn.disabled,mc(S.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const h=[t.x,t.y,1,1];r.aC(h,h,a.pixelMatrixInverse),r.cJ(h,h,1/h[3]),h[0]/=a.worldSize,h[1]/=a.worldSize;const g=a._camera.position,y=r.ce(1,a.center.lat),b=[g[0],g[1],g[2]/y,0],S=r.d9([],h.slice(0,3),b);r.aw(S,S);const M=this.raycast(b,S,this._exaggeration);return M!==null&&M?(r.bH(b,b,S,M),b[3]=b[2],b[2]*=y,b):null}_setupProxiedCoordsForOrtho(t,a,h){if(t.getSource()instanceof r.aS)return this._setupProxiedCoordsForImageSource(t,a,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const g=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let M=0;M<y.length;M++){const D=y[M],O=this._findTileCoveringTileID(D,t);if(O){const j=this._createProxiedId(D,O,h[D.key]&&h[D.key][t.id]);g.push(j),this.proxyToSource[D.key][t.id]=[j]}}let b=!1;const S=new Set;for(let M=0;M<a.length;M++){const D=t.getTile(a[M]);if(!D||!D.hasData())continue;const O=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==D.tileID.canonical.z){const j=this.proxyToSource[O.tileID.key][t.id],B=this._createProxiedId(O.tileID,D,h[O.tileID.key]&&h[O.tileID.key][t.id]);j?j.splice(j.length-1,0,B):this.proxyToSource[O.tileID.key][t.id]=[B];const q=this.proxyToSource[O.tileID.key][t.id];S.has(q)||S.add(q),g.push(B),b=!0}}if(this._sourceTilesOverlap[t.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const M of S)M.sort(((D,O)=>O.overscaledZ-D.overscaledZ))}_setupProxiedCoordsForImageSource(t,a,h){if(!t.getSource().loaded())return;const g=this.proxiedCoords[t.id]=[],y=this.proxyCoords,b=t.getSource(),S=b.tileID;if(!S)return;const M=new r.P(S.x,S.y)._div(1<<S.z),D=b.coordinates.map(r.ae.fromLngLat).reduce(((j,B)=>(j.min.x=Math.min(j.min.x,B.x-M.x),j.min.y=Math.min(j.min.y,B.y-M.y),j.max.x=Math.max(j.max.x,B.x-M.x),j.max.y=Math.max(j.max.y,B.y-M.y),j)),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(j,B)=>{const q=j.wrap+j.canonical.x/(1<<j.canonical.z),H=j.canonical.y/(1<<j.canonical.z),Z=r.al/(1<<j.canonical.z),re=B.wrap+B.canonical.x/(1<<B.canonical.z),$=B.canonical.y/(1<<B.canonical.z);return q+Z<re+D.min.x||q>re+D.max.x||H+Z<$+D.min.y||H>$+D.max.y};for(let j=0;j<y.length;j++){const B=y[j];for(let q=0;q<a.length;q++){const H=t.getTile(a[q]);if(!H||!H.hasData()||O(B,H.tileID))continue;const Z=this._createProxiedId(B,H,h[B.key]&&h[B.key][t.id]),re=this.proxyToSource[B.key][t.id];re?re.push(Z):this.proxyToSource[B.key][t.id]=[Z],g.push(Z)}}}_createProxiedId(t,a,h){let g=this.orthoMatrix;if(h){const y=h.find((b=>b.key===a.tileID.key));if(y)return y}if(a.tileID.key!==t.key){const y=t.canonical.z-a.tileID.canonical.z;let b,S,M;g=r.bC();const D=a.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(b=r.al>>y,S=b*((a.tileID.canonical.x<<y)-t.canonical.x+D),M=b*((a.tileID.canonical.y<<y)-t.canonical.y)):(b=r.al<<-y,S=r.al*(a.tileID.canonical.x-(t.canonical.x+D<<-y)),M=r.al*(a.tileID.canonical.y-(t.canonical.y<<-y))),r.cd(g,0,b,0,b,0,1),r.br(g,g,[S,M,0])}return new Hd(a.tileID,t.key,g)}_findTileCoveringTileID(t,a){let h=a.getTile(t);if(h&&h.hasData())return h;const g=this._findCoveringTileCache[a.id],y=g[t.key];if(h=y?a.getTileByID(y):null,h&&h.hasData()||y===null)return h;let b=h?h.tileID:t,S=b.overscaledZ;const M=a.getSource().minzoom,D=[];if(!y){const j=a.getSource().maxzoom;if(t.canonical.z>=j){const B=t.canonical.z-j;a.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,a.transform.tileZoom),b=new r.aO(S,t.wrap,j,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(S=j,b=new r.aO(S,t.wrap,j,t.canonical.x>>B,t.canonical.y>>B))}b.key!==t.key&&(D.push(b.key),h=a.getTile(b))}const O=j=>{D.forEach((B=>{g[B]=j})),D.length=0};for(S-=1;S>=M&&(!h||!h.hasData());S--){h&&O(h.tileID.key);const j=b.calculateScaledKey(S);if(h=a.getTileByID(j),h&&h.hasData())break;const B=g[j];if(B===null)break;B===void 0?D.push(j):h=a.getTileByID(B)}return O(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[a.key]=!0}}function Zd(d,t,a){const h=(function(S,M,D){const O=r.bJ(M,S),j=r.bJ(D,[.2126,.7152,.0722]),B=(H,Z,re)=>(1-re)*H+re*Z,q=B(1-.3*Math.min(j,1),1,Math.min(O+1,1));return B(.92,1,Math.asin(r.aA(M[2],-1,1))/Math.PI+.5)*q})(d,[0,0,1],t),g=[0,0,0];r.c4(g,a.slice(0,3),h);const y=[0,0,0];r.c4(y,t.slice(0,3),d[2]);const b=[0,0,0];return r.d7(b,g,y),r.da(b)}const tm=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],nm=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Xd{static cacheKey(t,a,h,g){let y=`${a}${g?g.cacheKey:""}`;for(const b of h)t.usedDefines.includes(b)&&(y+=`/${b}`);return y}constructor(t,a,h,g,y,b){const S=t.gl;this.program=S.createProgram(),this.configuration=g,this.name=a,this.fixedDefines=[...b];let M=g?g.defines():[];M=M.concat(b.map((H=>`#define ${H}`)));const D=`#version 300 es
`;let O=D+M.concat("precision mediump float;",ka,vh.fragmentSource).join(`
`);for(const H of h.fragmentIncludes)O+=`
${du[H]}`;O+=`
${h.fragmentSource}`;let j=D+M.concat("precision highp float;",ka,vh.vertexSource).join(`
`);for(const H of h.vertexIncludes)j+=`
${du[H]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&h.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(j+=`
uniform int u_instanceID;
`),j+=`
${h.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(j=j.replaceAll("gl_InstanceID","u_instanceID"));const B=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(B,O),S.compileShader(B),S.attachShader(this.program,B);const q=S.createShader(S.VERTEX_SHADER);S.isContextLost()?this.failedToCreate=!0:(S.shaderSource(q,j),S.compileShader(q),S.attachShader(this.program,q),this.attributes={},S.linkProgram(this.program),S.deleteShader(q),S.deleteShader(B),this.fixedUniforms=y(t),this.binderUniforms=g?g.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(H=>({u_instanceID:new r.cg(H)}))(t)),(b.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(H=>({u_dem:new r.cg(H),u_dem_prev:new r.cg(H),u_dem_tl:new r.cj(H),u_dem_scale:new r.ci(H),u_dem_tl_prev:new r.cj(H),u_dem_scale_prev:new r.ci(H),u_dem_size:new r.ci(H),u_dem_lerp:new r.ci(H),u_exaggeration:new r.ci(H),u_depth:new r.cg(H),u_depth_size_inv:new r.cj(H),u_depth_range_unpack:new r.cj(H),u_occluder_half_size:new r.ci(H),u_occlusion_depth_offset:new r.ci(H),u_meter_to_dem:new r.ci(H),u_label_plane_matrix_inv:new r.ck(H)}))(t)),b.includes("GLOBE")&&(this.globeUniforms=(H=>({u_tile_tl_up:new r.ch(H),u_tile_tr_up:new r.ch(H),u_tile_br_up:new r.ch(H),u_tile_bl_up:new r.ch(H),u_tile_up_scale:new r.ci(H)}))(t)),b.includes("FOG")&&(this.fogUniforms=(H=>({u_fog_matrix:new r.ck(H),u_fog_range:new r.cj(H),u_fog_color:new r.d2(H),u_fog_horizon_blend:new r.ci(H),u_fog_vertical_limit:new r.cj(H),u_fog_temporal_offset:new r.ci(H),u_frustum_tl:new r.ch(H),u_frustum_tr:new r.ch(H),u_frustum_br:new r.ch(H),u_frustum_bl:new r.ch(H),u_globe_pos:new r.ch(H),u_globe_radius:new r.ci(H),u_globe_transition:new r.ci(H),u_is_globe:new r.cg(H),u_viewport:new r.cj(H)}))(t)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(H=>({u_cutoff_params:new r.d2(H)}))(t)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(H=>({u_lighting_ambient_color:new r.ch(H),u_lighting_directional_dir:new r.ch(H),u_lighting_directional_color:new r.ch(H),u_ground_radiance:new r.ch(H)}))(t)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(H=>({u_light_matrix_0:new r.ck(H),u_light_matrix_1:new r.ck(H),u_fade_range:new r.cj(H),u_shadow_normal_offset:new r.ch(H),u_shadow_intensity:new r.ci(H),u_shadow_texel_size:new r.ci(H),u_shadow_map_resolution:new r.ci(H),u_shadow_direction:new r.ch(H),u_shadow_bias:new r.ch(H),u_shadowmap_0:new r.cg(H),u_shadowmap_1:new r.cg(H)}))(t)))}getAttributeLocation(t,a){let h=this.attributes[a];return h===void 0&&(h=this.attributes[a]=t.getAttribLocation(this.program,a)),h}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)h[g]&&h[g].set(this.program,g,a[g])}}setGlobeUniformValues(t,a){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)h[g]&&h[g].set(this.program,g,a[g])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}}setCutoffUniformValues(t,a){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}}setLightsUniformValues(t,a){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}}setShadowUniformValues(t,a){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;t.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}_drawDebugWireframe(t,a,h,g,y,b,S,M,D,O){const j=t.options.wireframe;if(j.terrain===!1&&j.layers2D===!1&&j.layers3D===!1)return;const B=t.context;if(!(!(!j.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!j.layers2D||t._terrain&&t._terrain.renderingToTexture||!tm.includes(this.name))||!(!j.layers3D||!nm.includes(this.name))))return;const q=B.gl,H=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,y,B);if(!H)return;const Z=[...this.fixedDefines];Z.push("DEBUG_WIREFRAME");const re=t.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});B.program.set(re.program);const $=(ye,Ce,Ae)=>{if(Ce[ye]&&Ae[ye])for(const ke in Ce[ye])Ae[ye][ke]&&Ae[ye][ke].set(Ae.program,ke,Ce[ye][ke].current)};D&&D.setUniforms(re.program,B,re.binderUniforms,S,{zoom:M}),$("fixedUniforms",this,re),$("terrainUniforms",this,re),$("globeUniforms",this,re),$("fogUniforms",this,re),$("lightsUniforms",this,re),$("shadowUniforms",this,re),H.bind(),B.setColorMode(new si([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],r.ao.transparent,[!0,!0,!0,!1])),B.setDepthMode(new an(a.func===q.LESS?q.LEQUAL:a.func,an.ReadOnly,a.range)),B.setStencilMode(On.disabled);const ae=3*b.primitiveLength*2,pe=3*b.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ye=O||1;for(let Ce=0;Ce<ye;++Ce)re.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ce),q.drawElements(q.LINES,ae,q.UNSIGNED_SHORT,pe)}else O&&O>1?q.drawElementsInstanced(q.LINES,ae,q.UNSIGNED_SHORT,pe,O):q.drawElements(q.LINES,ae,q.UNSIGNED_SHORT,pe);y.bind(),B.program.set(this.program),B.setDepthMode(a),B.setStencilMode(h),B.setColorMode(g)}checkUniforms(t,a,h){if(this.fixedDefines.includes(a)){for(const g of Object.keys(h))if(!h[g].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${g} not set but required by ${a} being defined`)}}draw(t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z,re){const $=t.context,ae=$.gl;if(this.failedToCreate)return;$.program.set(this.program),$.setDepthMode(h),$.setStencilMode(g),$.setColorMode(y),$.setCullFace(b);for(const Ce of Object.keys(this.fixedUniforms))this.fixedUniforms[Ce].set(this.program,Ce,S[Ce]);H&&H.setUniforms(this.program,$,this.binderUniforms,B,{zoom:q});const pe={[ae.POINTS]:1,[ae.LINES]:2,[ae.TRIANGLES]:3,[ae.LINE_STRIP]:1}[a];this.checkUniforms(M,"RENDER_SHADOWS",this.shadowUniforms);const ye=re&&re>0?1:void 0;for(const Ce of j.get()){const Ae=Ce.vaos||(Ce.vaos={});if((Ae[M]||(Ae[M]=new fu)).bind($,this,D,H?H.getPaintVertexBuffers():[],O,Ce.vertexOffset,Z||[],ye),this.forceManualRenderingForInstanceIDShaders){const ke=re||1;for(let Me=0;Me<ke;++Me)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Me),O?ae.drawElements(a,Ce.primitiveLength*pe,ae.UNSIGNED_SHORT,Ce.primitiveOffset*pe*2):ae.drawArrays(a,Ce.vertexOffset,Ce.vertexLength)}else re&&re>1?ae.drawElementsInstanced(a,Ce.primitiveLength*pe,ae.UNSIGNED_SHORT,Ce.primitiveOffset*pe*2,re):O?ae.drawElements(a,Ce.primitiveLength*pe,ae.UNSIGNED_SHORT,Ce.primitiveOffset*pe*2):ae.drawArrays(a,Ce.vertexOffset,Ce.vertexLength);a===ae.TRIANGLES&&O&&this._drawDebugWireframe(t,h,g,y,O,Ce,B,q,H,re)}}}function wh(d,t,a=0){const h=Math.pow(2,t.tileID.overscaledZ),g=t.tileSize*Math.pow(2,d.transform.tileZoom)/h,y=g*(t.tileID.canonical.x+t.tileID.wrap*h),b=g*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(t,1,d.transform.tileZoom),u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b],u_pattern_transition:a}}const _u={terrain:0,flat:1},im=r.bC(),Th=(d,t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z,re,$)=>{const ae=t.style.light,pe=ae.properties.get("position"),ye=[pe.x,pe.y,pe.z],Ce=r.dL();ae.properties.get("anchor")==="viewport"&&(r.dM(Ce,-t.transform.angle),r.dN(ye,ye,Ce));const Ae=ae.properties.get("color").toPremultipliedRenderColor(null),ke=t.transform,Me={u_matrix:d,u_lightpos:ye,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+a,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:im,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:_u[D],u_base_type:_u[O],u_ao:g,u_edge_radius:y,u_width_scale:b,u_flood_light_color:H,u_vertical_scale:Z,u_flood_light_intensity:re,u_ground_shadow_factor:$};return ke.projection.name==="globe"&&(Me.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],Me.u_zoom_transition=j,Me.u_inv_rot_matrix=q,Me.u_merc_center=B,Me.u_up_dir=ke.projection.upVector(new r.cC(0,0,0),B[0]*r.al,B[1]*r.al),Me.u_height_lift=M),Me},rm=(d,t,a,h,g,y)=>({u_matrix:d,u_edge_radius:t,u_width_scale:a,u_vertical_scale:h,u_height_type:_u[g],u_base_type:_u[y]}),K_=(d,t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z,re,$)=>{const ae=Th(d,t,a,h,g,y,b,S,D,O,j,B,q,H,Z,re,1,[0,0,0]),pe={u_height_factor:-Math.pow(2,S.overscaledZ)/M.tileSize/8};return Object.assign(ae,wh(t,M,$),pe)},om=(d,t,a)=>({u_matrix:d,u_emissive_strength:t,u_ground_shadow_factor:a}),_c=(d,t,a,h,g,y=0)=>Object.assign(om(d,t,g),wh(a,h,y)),Ox=(d,t,a,h)=>({u_matrix:d,u_world:a,u_emissive_strength:t,u_ground_shadow_factor:h}),Fx=(d,t,a,h,g,y,b=0)=>Object.assign(_c(d,t,a,h,y,b),{u_world:g}),Bx=(d,t)=>({u_matrix:d,u_ground_shadow_factor:t}),Yd=(d,t,a,h,g)=>({u_matrix:d,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:a,u_height_scale:h,u_reset_depth:g}),Nx=(d,t,a,h,g,y,b)=>({u_matrix:d,u_normal_matrix:t,u_opacity:a,u_faux_facade_ao_intensity:h,u_camera_pos:g,u_tile_to_meter:y,u_facade_emissive_chance:b}),Vx=d=>({u_matrix:d}),sm=d=>({u_matrix:d}),am=(d,t,a,h,g,y,b,S)=>{const M=r.al/y.tileSize;return{u_matrix:d,u_inv_rot_matrix:t,u_camera_to_center_distance:a.getCameraToCenterDistance(S),u_extrude_scale:[a.pixelsToGLUnits[0]/M,a.pixelsToGLUnits[1]/M],u_zoom_transition:h,u_tile_id:b,u_merc_center:g}},lm=(d,t,a=1)=>({u_matrix:d,u_color:t,u_overlay:0,u_overlay_scale:a}),yu=r.bC(),J_=(d,t,a,h,g,y,b)=>{const S=d.transform,M=S.projection.name==="globe",D=M?r.dO(S.zoom,t.canonical)*S._pixelsPerMercatorPixel:r.ay(a,1,y),O={u_matrix:t.projMatrix,u_extrude_scale:D,u_intensity:b,u_inv_rot_matrix:yu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){O.u_inv_rot_matrix=h,O.u_merc_center=g,O.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],O.u_zoom_transition=r.aj(S.zoom);const j=g[0]*r.al,B=g[1]*r.al;O.u_up_dir=S.projection.upVector(new r.cC(0,0,0),j,B)}return O};function cm(d,[t,a,h,g],[y,b]){if(y===b)return[0,0,0,0];const S=255*(d-1)/(d*(b-y));return[t*S,a*S,h*S,g*S]}function um(d,t,[a,h]){return a===h?0:.5/d+(t-a)*(d-1)/(d*(h-a))}const Kd=(d,t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z,re,$,ae,pe,ye)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:h,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:D,u_fade_t:O.mix,u_opacity:O.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:r.dQ(j.paint.get("raster-saturation")),u_contrast_factor:r.dP(j.paint.get("raster-contrast")),u_spin_weights:yc(j.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:q,u_zoom_transition:b,u_merc_center:S,u_cutoff_params:M,u_colorization_mix:cm(r.dR,Z,$),u_colorization_offset:um(r.dR,re,$),u_color_ramp:H,u_texture_offset:[pe/(ae+2*pe),ae/(ae+2*pe)],u_texture_res:[ae+2*pe,ae+2*pe],u_emissive_strength:ye});function yc(d){d*=Math.PI/180;const t=Math.sin(d),a=Math.cos(d);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const vc=.05,zl=(d,t,a,h,g,y,b,S,M,D,O,j)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:h,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:D,u_fade_t:O.mix,u_opacity:O.opacity,u_image0:0,u_image1:1,u_raster_elevation:j,u_zoom_transition:b,u_merc_center:S,u_cutoff_params:M}),hm=(d,t,a,h,g,y,b,S,M,D)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_tile_offset:a,u_velocity:h,u_color_ramp:y,u_velocity_res:g,u_max_speed:b,u_uv_offset:S,u_data_scale:[255*M[0],255*M[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[vc,vc]}),Jd=(d,t,a,h,g,y,b,S,M,D)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_velocity:a,u_velocity_res:h,u_max_speed:g,u_speed_factor:y,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*M[0],255*M[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[vc,vc]}),dm=r.bC(),fm=(d,t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z,re,$,ae,pe,ye,Ce,Ae,ke)=>{const Me=g.transform,Ee={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Me.getCameraToCenterDistance(ae),u_rotate_symbol:+a,u_aspect_ratio:Me.width/Me.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:S,u_is_text:+D,u_elevation_from_sea:M?1:0,u_pitch_with_map:+h,u_texsize:O,u_texsize_icon:j,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:dm,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:dm,u_up_vector:[0,-1,0],u_color_adj_mat:Ce,u_icon_transition:Ae||0,u_gamma_scale:h?g.transform.getCameraToCenterDistance(ae)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:r.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ke||1,u_ground_shadow_factor:pe,u_inv_matrix:r.bl(r.bC(),b),u_normal_scale:ye,u_lutTexture:ao.LUT};return ae.name==="globe"&&(Ee.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],Ee.u_zoom_transition=H,Ee.u_inv_rot_matrix=re,Ee.u_merc_center=Z,Ee.u_camera_forward=Me._camera.forward(),Ee.u_ecef_origin=r.dS(Me.globeMatrix,q.toUnwrapped()),Ee.u_tile_matrix=Float32Array.from(Me.globeMatrix),Ee.u_up_vector=$),Ee},Qd=(d,t,a,h)=>({u_matrix:d,u_emissive_strength:t,u_opacity:a,u_color:h}),$d=(d,t,a,h,g,y,b,S,M)=>Object.assign((function(D,O,j,B,q,H){const{width:Z,height:re}=B.imageManager.getPixelSize(O),$=Math.pow(2,H.tileID.overscaledZ),ae=H.tileSize*Math.pow(2,B.transform.tileZoom)/$,pe=ae*(H.tileID.canonical.x+H.tileID.wrap*$),ye=ae*H.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[Z,re],u_pattern_size:j.displaySize,u_pattern_units_to_pixels:q?[B.transform.width,-1*B.transform.height]:[1/r.ay(H,1,B.transform.tileZoom),1/r.ay(H,1,B.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,ye>>16],u_pixel_coord_lower:[65535&pe,65535&ye]}})(0,y,b,h,S,M),{u_matrix:d,u_emissive_strength:t,u_opacity:a}),pm=new Float32Array(r.bA([])),ef=(d,t,a,h,g,y,b,S,M,D,O,j,B,q=[0,0,0],H)=>{const Z=g.style.light,re=Z.properties.get("position"),$=[-re.x,-re.y,re.z],ae=r.dL();Z.properties.get("anchor")==="viewport"&&(r.dM(ae,-g.transform.angle),r.dN($,$,ae));const pe=O.alphaMode==="MASK",ye=Z.properties.get("color").toNonPremultipliedRenderColor(null),Ce=B.paint.get("model-ambient-occlusion-intensity"),Ae=B.paint.get("model-color").constantOr(r.ao.white).toNonPremultipliedRenderColor(null);return Ae.a=B.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:d,u_lighting_matrix:t,u_normal_matrix:a,u_node_matrix:h||pm,u_lightpos:$,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_camera_pos:q,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+pe,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:b.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:M,u_roughnessFactor:D,u_baseColorTexture:ao.BaseColor,u_metallicRoughnessTexture:ao.MetallicRoughness,u_normalTexture:ao.Normal,u_occlusionTexture:ao.Occlusion,u_emissionTexture:ao.Emission,u_lutTexture:ao.LUT,u_color_mix:Ae.toArray01(),u_aoIntensity:Ce,u_emissive_strength:j,u_occlusionTextureTransform:H||[0,0,0,0]}},vu=(d,t=pm,a=pm)=>({u_matrix:d,u_instance:t,u_node_matrix:a}),Ux={fillExtrusion:d=>({u_matrix:new r.ck(d),u_lightpos:new r.ch(d),u_lightintensity:new r.ci(d),u_lightcolor:new r.ch(d),u_vertical_gradient:new r.ci(d),u_opacity:new r.ci(d),u_edge_radius:new r.ci(d),u_width_scale:new r.ci(d),u_ao:new r.cj(d),u_height_type:new r.cg(d),u_base_type:new r.cg(d),u_tile_id:new r.ch(d),u_zoom_transition:new r.ci(d),u_inv_rot_matrix:new r.ck(d),u_merc_center:new r.cj(d),u_up_dir:new r.ch(d),u_height_lift:new r.ci(d),u_flood_light_color:new r.ch(d),u_vertical_scale:new r.ci(d),u_flood_light_intensity:new r.ci(d),u_ground_shadow_factor:new r.ch(d)}),fillExtrusionDepth:d=>({u_matrix:new r.ck(d),u_edge_radius:new r.ci(d),u_width_scale:new r.ci(d),u_vertical_scale:new r.ci(d),u_height_type:new r.cg(d),u_base_type:new r.cg(d)}),fillExtrusionPattern:d=>({u_matrix:new r.ck(d),u_lightpos:new r.ch(d),u_lightintensity:new r.ci(d),u_lightcolor:new r.ch(d),u_vertical_gradient:new r.ci(d),u_height_factor:new r.ci(d),u_edge_radius:new r.ci(d),u_width_scale:new r.ci(d),u_ao:new r.cj(d),u_height_type:new r.cg(d),u_base_type:new r.cg(d),u_tile_id:new r.ch(d),u_zoom_transition:new r.ci(d),u_inv_rot_matrix:new r.ck(d),u_merc_center:new r.cj(d),u_up_dir:new r.ch(d),u_height_lift:new r.ci(d),u_image:new r.cg(d),u_texsize:new r.cj(d),u_pixel_coord_upper:new r.cj(d),u_pixel_coord_lower:new r.cj(d),u_tile_units_to_pixels:new r.ci(d),u_opacity:new r.ci(d),u_pattern_transition:new r.ci(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new r.ck(d),u_opacity:new r.ci(d),u_ao_pass:new r.ci(d),u_meter_to_tile:new r.ci(d),u_ao:new r.cj(d),u_flood_light_intensity:new r.ci(d),u_flood_light_color:new r.ch(d),u_attenuation:new r.ci(d),u_edge_radius:new r.ci(d),u_fb:new r.cg(d),u_fb_size:new r.ci(d),u_dynamic_offset:new r.ci(d)}),fill:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_ground_shadow_factor:new r.ch(d)}),fillPattern:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_image:new r.cg(d),u_texsize:new r.cj(d),u_pixel_coord_upper:new r.cj(d),u_pixel_coord_lower:new r.cj(d),u_tile_units_to_pixels:new r.ci(d),u_ground_shadow_factor:new r.ch(d),u_pattern_transition:new r.ci(d)}),fillOutline:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_world:new r.cj(d),u_ground_shadow_factor:new r.ch(d)}),fillOutlinePattern:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_world:new r.cj(d),u_image:new r.cg(d),u_texsize:new r.cj(d),u_pixel_coord_upper:new r.cj(d),u_pixel_coord_lower:new r.cj(d),u_tile_units_to_pixels:new r.ci(d),u_ground_shadow_factor:new r.ch(d),u_pattern_transition:new r.ci(d)}),building:d=>({u_matrix:new r.ck(d),u_normal_matrix:new r.ck(d),u_opacity:new r.ci(d),u_faux_facade_ao_intensity:new r.ci(d),u_camera_pos:new r.ch(d),u_tile_to_meter:new r.ci(d),u_facade_emissive_chance:new r.ci(d)}),buildingBloom:d=>({u_matrix:new r.ck(d)}),buildingDepth:d=>({u_matrix:new r.ck(d)}),elevatedStructuresDepth:d=>({u_matrix:new r.ck(d),u_depth_bias:new r.ci(d)}),elevatedStructures:d=>({u_matrix:new r.ck(d),u_ground_shadow_factor:new r.ch(d)}),elevatedStructuresDepthReconstruct:d=>({u_matrix:new r.ck(d),u_camera_pos:new r.ch(d),u_depth_bias:new r.ci(d),u_height_scale:new r.ci(d),u_reset_depth:new r.ci(d)}),circle:r.dV,collisionBox:d=>({u_matrix:new r.ck(d),u_inv_rot_matrix:new r.ck(d),u_camera_to_center_distance:new r.ci(d),u_extrude_scale:new r.cj(d),u_zoom_transition:new r.ci(d),u_merc_center:new r.cj(d),u_tile_id:new r.ch(d)}),collisionCircle:d=>({u_matrix:new r.ck(d),u_inv_matrix:new r.ck(d),u_camera_to_center_distance:new r.ci(d),u_viewport_size:new r.cj(d)}),debug:d=>({u_color:new r.dx(d),u_matrix:new r.ck(d),u_overlay:new r.cg(d),u_overlay_scale:new r.ci(d)}),clippingMask:d=>({u_matrix:new r.ck(d)}),heatmap:d=>({u_extrude_scale:new r.ci(d),u_intensity:new r.ci(d),u_matrix:new r.ck(d),u_inv_rot_matrix:new r.ck(d),u_merc_center:new r.cj(d),u_tile_id:new r.ch(d),u_zoom_transition:new r.ci(d),u_up_dir:new r.ch(d)}),heatmapTexture:d=>({u_image:new r.cg(d),u_color_ramp:new r.cg(d),u_opacity:new r.ci(d)}),hillshade:d=>({u_matrix:new r.ck(d),u_image:new r.cg(d),u_latrange:new r.cj(d),u_light:new r.cj(d),u_shadow:new r.dx(d),u_highlight:new r.dx(d),u_emissive_strength:new r.ci(d),u_accent:new r.dx(d)}),hillshadePrepare:d=>({u_matrix:new r.ck(d),u_image:new r.cg(d),u_dimension:new r.cj(d),u_zoom:new r.ci(d)}),line:r.dU,linePattern:r.dT,raster:d=>({u_matrix:new r.ck(d),u_normalize_matrix:new r.ck(d),u_globe_matrix:new r.ck(d),u_merc_matrix:new r.ck(d),u_grid_matrix:new r.dy(d),u_tl_parent:new r.cj(d),u_scale_parent:new r.ci(d),u_fade_t:new r.ci(d),u_opacity:new r.ci(d),u_image0:new r.cg(d),u_image1:new r.cg(d),u_brightness_low:new r.ci(d),u_brightness_high:new r.ci(d),u_saturation_factor:new r.ci(d),u_contrast_factor:new r.ci(d),u_spin_weights:new r.ch(d),u_perspective_transform:new r.cj(d),u_raster_elevation:new r.ci(d),u_zoom_transition:new r.ci(d),u_merc_center:new r.cj(d),u_cutoff_params:new r.d2(d),u_colorization_mix:new r.d2(d),u_colorization_offset:new r.ci(d),u_color_ramp:new r.cg(d),u_texture_offset:new r.cj(d),u_texture_res:new r.cj(d),u_emissive_strength:new r.ci(d)}),rasterParticle:d=>({u_matrix:new r.ck(d),u_normalize_matrix:new r.ck(d),u_globe_matrix:new r.ck(d),u_merc_matrix:new r.ck(d),u_grid_matrix:new r.dy(d),u_tl_parent:new r.cj(d),u_scale_parent:new r.ci(d),u_fade_t:new r.ci(d),u_opacity:new r.ci(d),u_image0:new r.cg(d),u_image1:new r.cg(d),u_raster_elevation:new r.ci(d),u_zoom_transition:new r.ci(d),u_merc_center:new r.cj(d),u_cutoff_params:new r.d2(d)}),rasterParticleTexture:d=>({u_texture:new r.cg(d),u_opacity:new r.ci(d)}),rasterParticleDraw:d=>({u_particle_texture:new r.cg(d),u_particle_texture_side_len:new r.ci(d),u_tile_offset:new r.cj(d),u_velocity:new r.cg(d),u_color_ramp:new r.cg(d),u_velocity_res:new r.cj(d),u_max_speed:new r.ci(d),u_uv_offset:new r.cj(d),u_data_scale:new r.cj(d),u_data_offset:new r.ci(d),u_particle_pos_scale:new r.ci(d),u_particle_pos_offset:new r.cj(d)}),rasterParticleUpdate:d=>({u_particle_texture:new r.cg(d),u_particle_texture_side_len:new r.ci(d),u_velocity:new r.cg(d),u_velocity_res:new r.cj(d),u_max_speed:new r.ci(d),u_speed_factor:new r.ci(d),u_reset_rate:new r.ci(d),u_rand_seed:new r.ci(d),u_uv_offset:new r.cj(d),u_data_scale:new r.cj(d),u_data_offset:new r.ci(d),u_particle_pos_scale:new r.ci(d),u_particle_pos_offset:new r.cj(d)}),symbol:d=>({u_is_size_zoom_constant:new r.cg(d),u_is_size_feature_constant:new r.cg(d),u_size_t:new r.ci(d),u_size:new r.ci(d),u_camera_to_center_distance:new r.ci(d),u_rotate_symbol:new r.cg(d),u_aspect_ratio:new r.ci(d),u_fade_change:new r.ci(d),u_matrix:new r.ck(d),u_label_plane_matrix:new r.ck(d),u_coord_matrix:new r.ck(d),u_is_text:new r.cg(d),u_elevation_from_sea:new r.cg(d),u_pitch_with_map:new r.cg(d),u_texsize:new r.cj(d),u_texsize_icon:new r.cj(d),u_texture:new r.cg(d),u_texture_icon:new r.cg(d),u_gamma_scale:new r.ci(d),u_device_pixel_ratio:new r.ci(d),u_tile_id:new r.ch(d),u_zoom_transition:new r.ci(d),u_inv_rot_matrix:new r.ck(d),u_merc_center:new r.cj(d),u_camera_forward:new r.ch(d),u_tile_matrix:new r.ck(d),u_up_vector:new r.ch(d),u_ecef_origin:new r.ch(d),u_is_halo:new r.cg(d),u_icon_transition:new r.ci(d),u_color_adj_mat:new r.ck(d),u_scale_factor:new r.ci(d),u_ground_shadow_factor:new r.ch(d),u_inv_matrix:new r.ck(d),u_normal_scale:new r.ci(d),u_lutTexture:new r.cg(d)}),background:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_opacity:new r.ci(d),u_color:new r.dx(d)}),backgroundPattern:d=>({u_matrix:new r.ck(d),u_emissive_strength:new r.ci(d),u_opacity:new r.ci(d),u_image:new r.cg(d),u_pattern_tl:new r.cj(d),u_pattern_br:new r.cj(d),u_texsize:new r.cj(d),u_pattern_size:new r.cj(d),u_pixel_coord_upper:new r.cj(d),u_pixel_coord_lower:new r.cj(d),u_pattern_units_to_pixels:new r.cj(d)}),terrainRaster:d=>({u_matrix:new r.ck(d),u_image0:new r.cg(d),u_skirt_height:new r.ci(d),u_ground_shadow_factor:new r.ch(d)}),skybox:d=>({u_matrix:new r.ck(d),u_sun_direction:new r.ch(d),u_cubemap:new r.cg(d),u_opacity:new r.ci(d),u_temporal_offset:new r.ci(d)}),skyboxGradient:d=>({u_matrix:new r.ck(d),u_color_ramp:new r.cg(d),u_center_direction:new r.ch(d),u_radius:new r.ci(d),u_opacity:new r.ci(d),u_temporal_offset:new r.ci(d)}),skyboxCapture:d=>({u_matrix_3f:new r.dy(d),u_sun_direction:new r.ch(d),u_sun_intensity:new r.ci(d),u_color_tint_r:new r.d2(d),u_color_tint_m:new r.d2(d),u_luminance:new r.ci(d)}),globeRaster:d=>({u_proj_matrix:new r.ck(d),u_globe_matrix:new r.ck(d),u_normalize_matrix:new r.ck(d),u_merc_matrix:new r.ck(d),u_zoom_transition:new r.ci(d),u_merc_center:new r.cj(d),u_image0:new r.cg(d),u_grid_matrix:new r.dy(d),u_skirt_height:new r.ci(d),u_far_z_cutoff:new r.ci(d),u_frustum_tl:new r.ch(d),u_frustum_tr:new r.ch(d),u_frustum_br:new r.ch(d),u_frustum_bl:new r.ch(d),u_globe_pos:new r.ch(d),u_globe_radius:new r.ci(d),u_viewport:new r.cj(d)}),globeAtmosphere:d=>({u_frustum_tl:new r.ch(d),u_frustum_tr:new r.ch(d),u_frustum_br:new r.ch(d),u_frustum_bl:new r.ch(d),u_horizon:new r.ci(d),u_transition:new r.ci(d),u_fadeout_range:new r.ci(d),u_atmosphere_fog_color:new r.d2(d),u_high_color:new r.d2(d),u_space_color:new r.d2(d),u_temporal_offset:new r.ci(d),u_horizon_angle:new r.ci(d)}),model:d=>({u_matrix:new r.ck(d),u_lighting_matrix:new r.ck(d),u_normal_matrix:new r.ck(d),u_node_matrix:new r.ck(d),u_lightpos:new r.ch(d),u_lightintensity:new r.ci(d),u_lightcolor:new r.ch(d),u_camera_pos:new r.ch(d),u_opacity:new r.ci(d),u_baseColorFactor:new r.d2(d),u_emissiveFactor:new r.d2(d),u_metallicFactor:new r.ci(d),u_roughnessFactor:new r.ci(d),u_baseTextureIsAlpha:new r.cg(d),u_alphaMask:new r.cg(d),u_alphaCutoff:new r.ci(d),u_baseColorTexture:new r.cg(d),u_metallicRoughnessTexture:new r.cg(d),u_normalTexture:new r.cg(d),u_occlusionTexture:new r.cg(d),u_emissionTexture:new r.cg(d),u_lutTexture:new r.cg(d),u_color_mix:new r.d2(d),u_aoIntensity:new r.ci(d),u_emissive_strength:new r.ci(d),u_occlusionTextureTransform:new r.d2(d)}),modelDepth:d=>({u_matrix:new r.ck(d),u_instance:new r.ck(d),u_node_matrix:new r.ck(d)}),groundShadow:d=>({u_matrix:new r.ck(d),u_ground_shadow_factor:new r.ch(d)}),stars:d=>({u_matrix:new r.ck(d),u_up:new r.ch(d),u_right:new r.ch(d),u_intensity_multiplier:new r.ci(d)}),snowParticle:d=>({u_modelview:new r.ck(d),u_projection:new r.ck(d),u_time:new r.ci(d),u_cam_pos:new r.ch(d),u_velocityConeAperture:new r.ci(d),u_velocity:new r.ci(d),u_horizontalOscillationRadius:new r.ci(d),u_horizontalOscillationRate:new r.ci(d),u_boxSize:new r.ci(d),u_billboardSize:new r.ci(d),u_simpleShapeParameters:new r.cj(d),u_screenSize:new r.cj(d),u_thinningCenterPos:new r.cj(d),u_thinningShape:new r.ch(d),u_thinningAffectedRatio:new r.ci(d),u_thinningParticleOffset:new r.ci(d),u_particleColor:new r.d2(d),u_direction:new r.ch(d)}),rainParticle:d=>({u_modelview:new r.ck(d),u_projection:new r.ck(d),u_time:new r.ci(d),u_cam_pos:new r.ch(d),u_texScreen:new r.cg(d),u_velocityConeAperture:new r.ci(d),u_velocity:new r.ci(d),u_boxSize:new r.ci(d),u_rainDropletSize:new r.cj(d),u_distortionStrength:new r.ci(d),u_rainDirection:new r.ch(d),u_color:new r.d2(d),u_screenSize:new r.cj(d),u_thinningCenterPos:new r.cj(d),u_thinningShape:new r.ch(d),u_thinningAffectedRatio:new r.ci(d),u_thinningParticleOffset:new r.ci(d),u_shapeDirectionalPower:new r.ci(d),u_shapeNormalPower:new r.ci(d),u_mode:new r.ci(d)}),vignette:d=>({u_vignetteShape:new r.ch(d),u_vignetteColor:new r.d2(d)}),occlusion:d=>({u_matrix:new r.ck(d),u_anchorPos:new r.ch(d),u_screenSizePx:new r.cj(d),u_occluderSizePx:new r.cj(d),u_color:new r.d2(d)})};class Dl{constructor(t,a,h,g){this.id=Dl.uniqueIdxCounter,Dl.uniqueIdxCounter++,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||g||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Dl.uniqueIdxCounter,Dl.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Dl.uniqueIdxCounter=0;const Q_={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jx{constructor(t,a,h,g,y,b){this.length=a.length,this.attributes=h,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.instanceCount=b,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||y||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let h=0;h<this.attributes.length;h++){const g=a.getAttributeLocation(t,this.attributes[h].name);g!==-1&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,a,h){for(let g=0;g<this.attributes.length;g++){const y=this.attributes[g],b=a.getAttributeLocation(t,y.name);b!==-1&&t.vertexAttribPointer(b,y.components,t[Q_[y.type]],!1,this.itemSize,y.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(t,a,h){for(let g=0;g<this.attributes.length;g++){const y=a.getAttributeLocation(t,this.attributes[g].name);y!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(y,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class tf{constructor(t,a,h,g,y){this.context=t,this.width=a,this.height=h;const b=this.framebuffer=t.gl.createFramebuffer();g&&(this.colorAttachment=new Z_(t,b)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new X_(t,b):new zx(t,b))}destroy(){const t=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&t.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&t.deleteTexture(a)}t.deleteFramebuffer(this.framebuffer)}}class mm{constructor(t,a){this.gl=t,this.clearColor=new N_(this),this.clearDepth=new Zp(this),this.clearStencil=new Ix(this),this.colorMask=new Mx(this),this.depthMask=new Cx(this),this.stencilMask=new Px(this),this.stencilFunc=new V_(this),this.stencilOp=new kx(this),this.stencilTest=new Fd(this),this.depthRange=new Rx(this),this.depthTest=new U_(this),this.depthFunc=new Xp(this),this.blend=new Bd(this),this.blendFunc=new Yp(this),this.blendColor=new pc(this),this.blendEquation=new pu(this),this.cullFace=new Nd(this),this.cullFaceSide=new Vd(this),this.frontFace=new mu(this),this.program=new j_(this),this.activeTexture=new Kp(this),this.viewport=new G_(this),this.bindFramebuffer=new gu(this),this.bindRenderbuffer=new Ud(this),this.bindTexture=new jd(this),this.bindVertexBuffer=new Jp(this),this.bindElementBuffer=new Gd(this),this.bindVertexArrayOES=new xh(this),this.pixelStoreUnpack=new W_(this),this.pixelStoreUnpackPremultiplyAlpha=new q_(this),this.pixelStoreUnpackFlipY=new H_(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a,h){return new Dl(this,t,a,h)}createVertexBuffer(t,a,h,g,y){return new jx(this,t,a,h,g,y)}createRenderbuffer(t,a,h){const g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,t,a,h),this.bindRenderbuffer.set(null),y}createFramebuffer(t,a,h,g){return new tf(this,t,a,h,g)}clear({color:t,depth:a,stencil:h,colorMask:g}){const y=this.gl;let b=0;t&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(g||[!0,!0,!0,!0])),a!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),y.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.by(t.blendFunction,si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ra;function Sh(d,t,a,h,g,y,b){const S=d.context,M=S.gl,D=d.transform,O=[r.aF(D.center.lng),r.aJ(D.center.lat)],j=a.layout.get("symbol-placement"),B=a.layout.get("text-variable-anchor"),q=a.layout.get("icon-rotation-alignment")==="map",H=a.layout.get("text-rotation-alignment")==="map",Z=j!=="point",re=[];let $=0,ae=0;for(let Ee=0;Ee<h.length;Ee++){const ze=h[Ee],ot=t.getTile(ze),Ze=ot.getBucket(a);if(!Ze)continue;const mt=Ze.getProjection().createInversionMatrix(D,ze.canonical),$e=[],pt=C_(ze,Ze,D),Ht=!b&&q&&Z,rt=b&&H&&Z,Ue=B&&Ze.hasTextData(),xt=Ze.hasIconTextFit()&&Ue&&Ze.hasIconData(),ct=Ht||rt||b&&Ue||xt,Ct=Ze.projection.name==="globe",qt=Ct?r.aj(D.zoom):0;Ct&&($e.push("PROJECTION_GLOBE_VIEW"),ct&&$e.push("PROJECTED_POS_ON_VIEWPORT"));const nn=d.getOrCreateProgram("collisionBox",{defines:$e});let Vt=pt;g[0]===0&&g[1]===0||(Vt=d.translatePosMatrix(pt,ot,g,y));const Ot=b?Ze.textCollisionBox:Ze.iconCollisionBox,vn=Ze.collisionCircleArray;if(vn.length>0){const yn=r.bC(),mn=Vt;r.cO(yn,Ze.placementInvProjMatrix,D.glCoordMatrix),r.cO(yn,yn,Ze.placementViewportMatrix),re.push({circleArray:vn,circleOffset:ae,transform:mn,invTransform:yn,projection:Ze.getProjection()}),$+=vn.length/4,ae=$}if(!Ot)continue;d.terrain&&d.terrain.setupElevationDraw(ot,nn);const gn=Ct?[ze.canonical.x,ze.canonical.y,1<<ze.canonical.z]:[0,0,0];nn.draw(d,M.LINES,an.disabled,On.disabled,d.colorModeForRenderPass(),jn.disabled,am(Vt,mt,D,qt,O,ot,gn,Ze.getProjection()),a.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,null,D.zoom,null,[Ot.collisionVertexBuffer,Ot.collisionVertexBufferExt])}if(!b||!re.length)return;const pe=d.getOrCreateProgram("collisionCircle"),ye=new r.dW;ye.resize(4*$),ye._trim();let Ce=0;for(const Ee of re)for(let ze=0;ze<Ee.circleArray.length/4;ze++){const ot=4*ze,Ze=Ee.circleArray[ot+0],mt=Ee.circleArray[ot+1],$e=Ee.circleArray[ot+2],pt=Ee.circleArray[ot+3];ye.emplace(Ce++,Ze,mt,$e,pt,0),ye.emplace(Ce++,Ze,mt,$e,pt,1),ye.emplace(Ce++,Ze,mt,$e,pt,2),ye.emplace(Ce++,Ze,mt,$e,pt,3)}(!Ra||Ra.length<2*$)&&(Ra=(function(Ee){const ze=2*Ee,ot=new r.b1;ot.resize(ze),ot._trim();for(let Ze=0;Ze<ze;Ze++){const mt=6*Ze;ot.uint16[mt+0]=4*Ze+0,ot.uint16[mt+1]=4*Ze+1,ot.uint16[mt+2]=4*Ze+2,ot.uint16[mt+3]=4*Ze+2,ot.uint16[mt+4]=4*Ze+3,ot.uint16[mt+5]=4*Ze+0}return ot})($));const Ae=S.createIndexBuffer(Ra,!0),ke=S.createVertexBuffer(ye,r.dX.members,!0);for(const Ee of re){const ze={u_matrix:Ee.transform,u_inv_matrix:Ee.invTransform,u_camera_to_center_distance:(Me=D).getCameraToCenterDistance(Ee.projection),u_viewport_size:[Me.width,Me.height]};pe.draw(d,M.TRIANGLES,an.disabled,On.disabled,d.colorModeForRenderPass(),jn.disabled,ze,a.id,ke,Ae,r.bg.simpleSegment(0,2*Ee.circleOffset,Ee.circleArray.length,Ee.circleArray.length/2),null,D.zoom)}var Me;ke.destroy(),Ae.destroy()}const Ll=r.bC();function gm(d){const t=d._camera.getWorldToCamera(d.worldSize,1),a=r.aB([],t,d.globeMatrix);r.bl(a,a);const h=[0,0,0],g=[0,1,0,0];return r.aC(g,g,a),h[0]=g[0],h[1]=g[1],h[2]=g[2],r.aw(h,h),h}function nf({width:d,height:t,anchor:a,textOffset:h,textScale:g},y){const{horizontalAlign:b,verticalAlign:S}=r.c0(a),M=-(b-.5)*d,D=-(S-.5)*t,O=r.c1(a,h);return new r.P((M/g+O[0])*y,(D/g+O[1])*y)}function rf(d,t,a,h,g,y,b,S,M,D){const O=d.text.placedSymbolArray,j=d.text.dynamicLayoutVertexArray,B=d.icon.dynamicLayoutVertexArray,q={},H=d.getProjection(),Z=lc(b,H,g),re=g.elevation,$=H.upVectorScale(b.canonical,g.center.lat,g.worldSize).metersToTile;j.clear();for(let ae=0;ae<O.length;ae++){const pe=O.get(ae),{tileAnchorX:ye,tileAnchorY:Ce,numGlyphs:Ae}=pe,ke=pe.hidden||!pe.crossTileID||d.allowVerticalPlacement&&!pe.placedOrientation?null:h[pe.crossTileID];if(ke){let Me=0,Ee=0,ze=0;if(re){const xt=re?re.getAtTileOffset(b,ye,Ce):0,[ct,Ct,qt]=H.upVector(b.canonical,ye,Ce);Me=xt*ct*$,Ee=xt*Ct*$,ze=xt*qt*$}let[ot,Ze,mt,$e]=Ns(pe.projectedAnchorX+Me,pe.projectedAnchorY+Ee,pe.projectedAnchorZ+ze,a?Z:y);const pt=cc(g.getCameraToCenterDistance(H),$e);let Ht=r.bM(d.textSizeData,M,pe)*pt/r.bX;a&&(Ht*=d.tilePixelRatio/S);const rt=nf(ke,Ht);a?({x:ot,y:Ze,z:mt}=H.projectTilePoint(ye+rt.x,Ce+rt.y,b.canonical),[ot,Ze,mt]=Ns(ot+Me,Ze+Ee,mt+ze,y)):(t&&rt._rotate(-g.angle),ot+=rt.x,Ze+=rt.y,mt=0);const Ue=d.allowVerticalPlacement&&pe.placedOrientation===r.bL.vertical?Math.PI/2:0;for(let xt=0;xt<Ae;xt++)r.bO(j,ot,Ze,mt,Ue);D&&pe.associatedIconIndex>=0&&(q[pe.associatedIconIndex]={x:ot,y:Ze,z:mt,angle:Ue})}else Rn(Ae,j)}if(D){B.clear();const ae=d.icon.placedSymbolArray;for(let pe=0;pe<ae.length;pe++){const ye=ae.get(pe),{numGlyphs:Ce}=ye,Ae=q[pe];if(ye.hidden||!Ae)Rn(Ce,B);else{const{x:ke,y:Me,z:Ee,angle:ze}=Ae;for(let ot=0;ot<Ce;ot++)r.bO(B,ke,Me,Ee,ze)}}d.icon.dynamicLayoutVertexBuffer.updateData(B)}d.text.dynamicLayoutVertexBuffer.updateData(j)}function Eh(d,t,a,h,g,y,b={}){const S=a.paint.get("icon-translate"),M=a.paint.get("text-translate"),D=a.paint.get("icon-translate-anchor"),O=a.paint.get("text-translate-anchor"),j=a.layout.get("icon-rotation-alignment"),B=a.layout.get("text-rotation-alignment"),q=a.layout.get("icon-pitch-alignment"),H=a.layout.get("text-pitch-alignment"),Z=a.layout.get("icon-keep-upright"),re=a.layout.get("text-keep-upright"),$=a.paint.get("icon-color-saturation"),ae=a.paint.get("icon-color-contrast"),pe=a.paint.get("icon-color-brightness-min"),ye=a.paint.get("icon-color-brightness-max"),Ce=a.layout.get("symbol-elevation-reference")==="sea",Ae=a.layout.get("icon-image-use-theme")==="none",ke=d.context,Me=ke.gl,Ee=d.transform,ze=j==="map",ot=B==="map",Ze=q==="map",mt=H==="map",$e=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pt=!1;const Ht=d.depthModeForSublayer(0,an.ReadOnly),rt=new an(d.context.gl.LEQUAL,an.ReadOnly,d.depthRangeFor3D),Ue=[r.aF(Ee.center.lng),r.aJ(Ee.center.lat)],xt=a.layout.get("text-variable-anchor"),ct=Ee.projection.name==="globe",Ct=[],qt=[0,-1,0];for(const nn of h){const Vt=t.getTile(nn),Ot=Vt.getBucket(a);if(!Ot||Ot.projection.name==="mercator"&&ct||Ot.fullyClipped)continue;const vn=Ot.projection.name==="globe",gn=vn?r.aj(Ee.zoom):0,yn=lc(nn,Ot.getProjection(),Ee),mn=Ee.calculatePixelsToTileUnitsMatrix(Vt),qn=xt&&Ot.hasTextData(),ii=Ot.hasIconTextFit()&&qn&&Ot.hasIconData(),ai=Ot.getProjection().createInversionMatrix(Ee,nn.canonical),Xi=(1<<Vt.tileID.canonical.z)*r.al/d.transform.worldSize,Jn=Ir=>{let li=[0,0,0];if(Ir){const Fn=d.style.directionalLight,Yi=d.style.ambientLight;Fn&&Yi&&(li=va(d.style,Fn,Yi))}return li},Pi=Ir=>{Ee.depthOcclusionForSymbolsAndCircles&&(a.hasOcclusionOpacityProperties||d.terrain)&&(Ir.push("DEPTH_D24"),Ir.push("DEPTH_OCCLUSION"))},ji=Ir=>{a.lut&&!Ae&&(a.lut.texture||(a.lut.texture=new r.dY(d.context,a.lut.image,[a.lut.image.height,a.lut.image.height,a.lut.image.height],ke.gl.RGBA8)),ke.activeTexture.set(ke.gl.TEXTURE0+ao.LUT),a.lut.texture&&a.lut.texture.bind(ke.gl.LINEAR,ke.gl.CLAMP_TO_EDGE),Ir.push("APPLY_LUT_ON_GPU"))},wr=()=>{const Ir=ze&&a.layout.get("symbol-placement")!=="point",li=[];Pi(li),ji(li);const Fn=Ir||ii,Yi=Ot.elevationType==="road",jr=d.shadowRenderer,Dr=Yi&&Ze&&!!jr&&jr.enabled,lo=Jn(Dr),Bo=Yi&&Ze&&!d.terrain?rt:Ht,qs=a.paint.get("icon-image-cross-fade");d.terrainRenderModeElevated()&&Ze&&li.push("PITCH_WITH_MAP_TERRAIN"),vn&&(li.push("PROJECTION_GLOBE_VIEW"),Fn&&li.push("PROJECTED_POS_ON_VIEWPORT")),qs>0&&Ot.hasAnySecondaryIcon&&li.push("ICON_TRANSITION"),!Ot.icon.zOffsetVertexBuffer||Yi&&d.terrain||li.push("Z_OFFSET"),$===0&&ae===0&&pe===0&&ye===1||li.push("COLOR_ADJUSTMENT"),Ot.sdfIcons&&li.push("RENDER_SDF"),Dr&&li.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Yi&&Ze&&!d.terrain&&Ot.icon.orientationVertexBuffer&&li.push("ELEVATED_ROADS");const Hs=Ot.icon.programConfigurations.get(a.id),Ms=d.getOrCreateProgram("symbol",{config:Hs,defines:li}),Cs=Vt.imageAtlasTexture?Vt.imageAtlasTexture.size:[0,0],ms=Ot.iconSizeData,sa=r.bK(ms,Ee.zoom),Ta=Ze||!Ee.isOrthographic,Hr=ga(yn,Vt.tileID.canonical,Ze,ze,Ee,Ot.getProjection(),mn),Kr=bd(yn,Vt.tileID.canonical,Ze,ze,Ee,Ot.getProjection(),mn),Lr=d.translatePosMatrix(Kr,Vt,S,D,!0),xo=d.translatePosMatrix(yn,Vt,S,D),zo=Fn?Ll:Hr,io=ze&&!Ze&&!Ir;let Ko=qt;!ct&&!Ee.mercatorFromTransition||ze||(Ko=gm(Ee));const Oa=vn?Ko:qt,nl=a.getColorAdjustmentMatrix($,ae,pe,ye),Sa=fm(ms.kind,sa,io,Ze,d,xo,zo,Lr,Ce,!1,Cs,[0,0],0,nn,gn,Ue,ai,Oa,Ot.getProjection(),lo,Xi,nl,qs,null),Wl=Vt.imageAtlasTexture?Vt.imageAtlasTexture:null,ql=a.layout.get("icon-size").constantOr(0)!==1||Ot.iconsNeedLinear,Fa=Ot.sdfIcons||d.options.rotating||d.options.zooming||ql||Ta?Me.LINEAR:Me.NEAREST,ku=Ot.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,il=d.terrain&&Ze&&Ir?r.bl(r.bC(),Hr):Ll;if(Ir&&Ot.icon){const Ba=Ee.elevation,rl=Ba?Ba.getAtTileOffsetFunc(nn,Ee.center.lat,Ee.worldSize,Ot.getProjection()):null,Ef=lh(yn,Vt.tileID.canonical,Ze,ze,Ee,Ot.getProjection(),mn);Lp(Ot,yn,d,!1,Ef,Kr,Ze,Z,rl,nn)}return{program:Ms,buffers:Ot.icon,uniformValues:Sa,atlasTexture:Wl,atlasTextureIcon:null,atlasInterpolation:Fa,atlasInterpolationIcon:null,isSDF:Ot.sdfIcons,hasHalo:ku,depthMode:Bo,tile:Vt,renderWithShadows:Dr,labelPlaneMatrixInv:il}},ri=()=>{const Ir=ot&&a.layout.get("symbol-placement")!=="point",li=[],Fn=Ir||xt||ii,Yi=Ot.elevationType==="road",jr=d.shadowRenderer,Dr=Yi&&mt&&!!jr&&jr.enabled,lo=Jn(Dr),Bo=Yi&&mt&&!d.terrain?rt:Ht;d.terrainRenderModeElevated()&&mt&&li.push("PITCH_WITH_MAP_TERRAIN"),vn&&(li.push("PROJECTION_GLOBE_VIEW"),Fn&&li.push("PROJECTED_POS_ON_VIEWPORT")),!Ot.text.zOffsetVertexBuffer||Yi&&d.terrain||li.push("Z_OFFSET"),Ot.iconsInText&&li.push("RENDER_TEXT_AND_SYMBOL"),li.push("RENDER_SDF"),Dr&&li.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Yi&&mt&&!d.terrain&&Ot.text.orientationVertexBuffer&&li.push("ELEVATED_ROADS"),Pi(li);const qs=Ot.text.programConfigurations.get(a.id),Hs=d.getOrCreateProgram("symbol",{config:qs,defines:li});let Ms,Cs=[0,0],ms=null;const sa=Ot.textSizeData;Ot.iconsInText&&(Cs=Vt.imageAtlasTexture?Vt.imageAtlasTexture.size:[0,0],ms=Vt.imageAtlasTexture?Vt.imageAtlasTexture:null,Ms=mt||!Ee.isOrthographic||d.options.rotating||d.options.zooming||sa.kind==="composite"||sa.kind==="camera"?Me.LINEAR:Me.NEAREST);const Ta=Vt.glyphAtlasTexture?Vt.glyphAtlasTexture.size:[0,0],Hr=a.layout.get("text-size-scale-range"),Kr=r.aA(d.scaleFactor,Hr[0],Hr[1]),Lr=r.bK(sa,Ee.zoom,Kr),xo=ga(yn,Vt.tileID.canonical,mt,ot,Ee,Ot.getProjection(),mn),zo=bd(yn,Vt.tileID.canonical,mt,ot,Ee,Ot.getProjection(),mn),io=d.translatePosMatrix(zo,Vt,M,O,!0),Ko=d.translatePosMatrix(yn,Vt,M,O),Oa=Fn?Ll:xo,nl=ot&&!mt&&!Ir;let Sa=qt;!ct&&!Ee.mercatorFromTransition||ot||(Sa=gm(Ee));const Wl=fm(sa.kind,Lr,nl,mt,d,Ko,Oa,io,Ce,!0,Ta,Cs,0,nn,gn,Ue,ai,vn?Sa:qt,Ot.getProjection(),lo,Xi,null,null,Kr),ql=Vt.glyphAtlasTexture?Vt.glyphAtlasTexture:null,Fa=Me.LINEAR,ku=a.paint.get("text-halo-width").constantOr(1)!==0,il=d.terrain&&mt&&Ir?r.bl(r.bC(),xo):Ll;if(Ir&&Ot.text){const Ba=Ee.elevation,rl=Ba?Ba.getAtTileOffsetFunc(nn,Ee.center.lat,Ee.worldSize,Ot.getProjection()):null,Ef=lh(yn,Vt.tileID.canonical,mt,ot,Ee,Ot.getProjection(),mn);Lp(Ot,yn,d,!0,Ef,zo,mt,re,rl,nn)}return{program:Hs,buffers:Ot.text,uniformValues:Wl,atlasTexture:ql,atlasTextureIcon:ms,atlasInterpolation:Fa,atlasInterpolationIcon:Ms,isSDF:!0,hasHalo:ku,depthMode:Bo,tile:Vt,renderWithShadows:Dr,labelPlaneMatrixInv:il}},Fi=Ot.icon.segments.get().length,Di=Ot.text.segments.get().length,Ni=Fi&&!b.onlyText?wr():null,Ar=Di&&!b.onlyIcons?ri():null,Yr=a.paint.get("icon-opacity").constantOr(1),Ro=a.paint.get("text-opacity").constantOr(1);if($e&&Ot.canOverlap){pt=!0;const Ir=Yr&&!b.onlyText?Ot.icon.segments.get():[],li=Ro&&!b.onlyIcons?Ot.text.segments.get():[];for(const Fn of Ir)Ct.push({segments:new r.bg([Fn]),sortKey:Fn.sortKey,state:Ni});for(const Fn of li)Ct.push({segments:new r.bg([Fn]),sortKey:Fn.sortKey,state:Ar})}else b.onlyText||Ct.push({segments:Yr?Ot.icon.segments:new r.bg([]),sortKey:0,state:Ni}),b.onlyIcons||Ct.push({segments:Ro?Ot.text.segments:new r.bg([]),sortKey:0,state:Ar})}pt&&Ct.sort(((nn,Vt)=>nn.sortKey-Vt.sortKey));for(const nn of Ct){const Vt=nn.state;if(Vt)if(d.terrain?d.terrain.setupElevationDraw(Vt.tile,Vt.program,{useDepthForOcclusion:Ee.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Vt.labelPlaneMatrixInv}):d.setupDepthForOcclusion(Ee.depthOcclusionForSymbolsAndCircles,Vt.program),ke.activeTexture.set(Me.TEXTURE0),Vt.atlasTexture&&Vt.atlasTexture.bind(Vt.atlasInterpolation,Me.CLAMP_TO_EDGE,!0),Vt.atlasTextureIcon&&(ke.activeTexture.set(Me.TEXTURE1),Vt.atlasTextureIcon&&Vt.atlasTextureIcon.bind(Vt.atlasInterpolationIcon,Me.CLAMP_TO_EDGE,!0)),Vt.renderWithShadows&&d.shadowRenderer.setupShadows(Vt.tile.tileID.toUnwrapped(),Vt.program,"vector-tile"),d.uploadCommonLightUniforms(d.context,Vt.program),Vt.hasHalo){const Ot=Vt.uniformValues;Ot.u_is_halo=1,of(Vt.buffers,nn.segments,a,d,Vt.program,Vt.depthMode,g,y,Ot,2),Ot.u_is_halo=0}else{if(Vt.isSDF){const Ot=Vt.uniformValues;Vt.hasHalo&&(Ot.u_is_halo=1,of(Vt.buffers,nn.segments,a,d,Vt.program,Vt.depthMode,g,y,Ot,1)),Ot.u_is_halo=0}of(Vt.buffers,nn.segments,a,d,Vt.program,Vt.depthMode,g,y,Vt.uniformValues,1)}}}function of(d,t,a,h,g,y,b,S,M,D){const O=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer,d.orientationVertexBuffer];g.draw(h,h.context.gl.TRIANGLES,y,b,S,jn.disabled,M,a.id,d.layoutVertexBuffer,d.indexBuffer,t,a.paint,h.transform.zoom,d.programConfigurations.get(a.id),O,D)}function $_(d,t){const a=1<<d.canonical.z,h=(t.x*a-d.canonical.x-d.wrap*a)*r.al,g=(t.y*a-d.canonical.y)*r.al,y=r.e5(t.z,t.y);return r.d4(h,g,y)}function xc(d,t,a,h,g){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const y=d.context.gl,b=new an(d.context.gl.LEQUAL,an.ReadWrite,d.depthRangeFor3D),S=new an(d.context.gl.GREATER,an.ReadWrite,d.depthRangeFor3D),M=(function(q){let H=.01;return q.isOrthographic&&(H=r.ak(1e-4,H,r.c$(q.pitch>=Ja?1:q.pitch/Ja))),2*H})(d.transform),D=d.transform.getFreeCameraOptions().position,O="elevatedStructuresDepthReconstruct",j=d.getOrCreateProgram(O,{defines:["DEPTH_RECONSTRUCTION"]}),B=d.getOrCreateProgram(O);for(const q of h){const H=t.getTile(q),Z=H.getBucket(a);if(!Z)continue;const re=Z.elevatedStructures;if(!re)continue;const $=Z.elevationBufferData.heightRange,ae=$_(q.toUnwrapped(),D),pe=d.translatePosMatrix(q.projMatrix,H,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let ye,Ce,Ae,ke;if(g==="initialize"){if(!$||$.min>=1||re.depthSegments.segments[0].primitiveLength===0)continue;ye=Yd(pe,ae,M,1,0),Ce=b,Ae=re.depthSegments,ke=j}else if(g==="reset"){if(!$||$.min>=0||re.maskSegments.segments[0].primitiveLength===0)continue;ye=Yd(pe,ae,0,0,1),Ce=S,Ae=re.maskSegments,ke=j}else if(g==="geometry"){if(re.depthSegments.segments[0].primitiveLength===0)continue;ye=Yd(pe,ae,M,1,0),Ce=b,Ae=re.depthSegments,ke=B}ke.draw(d,y.TRIANGLES,Ce,On.disabled,si.disabled,jn.disabled,ye,a.id,re.vertexBuffer,re.indexBuffer,Ae,a.paint,d.transform.zoom)}}function xu(d,t,a){const{painter:h,sourceCache:g,layer:y,coords:b,colorMode:S,elevationType:M,terrainEnabled:D,pass:O}=d,j=h.context.gl,B=y.paint.get("fill-pattern"),q=y.paint.get("fill-pattern-cross-fade"),H=B.constantOr(null);let Z=M;M!=="road"||t&&!D||(Z="none");const re=Z==="road",$=d.painter.shadowRenderer,ae=re&&!!$&&$.enabled,pe=new an(h.context.gl.LEQUAL,an.ReadOnly,h.depthRangeFor3D);let ye=[0,0,0];if(ae){const ke=h.style.directionalLight,Me=h.style.ambientLight;ke&&Me&&(ye=va(h.style,ke,Me))}const Ce=B&&B.constantOr(1),Ae=(ke,Me)=>{let Ee,ze,ot,Ze,mt;Me?(Ee=Ce&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ot=j.LINES):(Ee=Ce?"fillPattern":"fill",ot=j.TRIANGLES);for(const $e of b){const pt=g.getTile($e);if(Ce&&!pt.patternsLoaded())continue;const Ht=pt.getBucket(y);if(!Ht)continue;const rt=t?Ht.elevationBufferData:Ht.bufferData;if(rt.isEmpty())continue;h.prepareDrawTile();const Ue=rt.programConfigurations.get(y.id),xt=h.isTileAffectedByFog($e),ct=[],Ct=[];re&&(ct.push("ELEVATED_ROADS"),Ct.push(rt.elevatedLayoutVertexBuffer)),ae&&ct.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ce&&(h.context.activeTexture.set(j.TEXTURE0),pt.imageAtlasTexture&&pt.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Ue.updatePaintBuffers());let qt=!1;if(H&&pt.imageAtlas){const gn=pt.imageAtlas,yn=r.e0.from(H),mn=yn.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),qn=yn.getSecondary(),ii=gn.patternPositions.get(mn),ai=qn?gn.patternPositions.get(qn.scaleSelf(r.o.devicePixelRatio).toString()):null;qt=!!ii&&!!ai,ii&&Ue.setConstantPatternPositions(ii,ai)}q>0&&(qt||Ue.getPatternTransitionVertexBuffer("fill-pattern"))&&ct.push("FILL_PATTERN_TRANSITION");const nn=h.getOrCreateProgram(Ee,{config:Ue,overrideFog:xt,defines:ct}),Vt=h.translatePosMatrix($e.projMatrix,pt,y.paint.get("fill-translate"),y.paint.get("fill-translate-anchor"));ae&&$.setupShadows(pt.tileID.toUnwrapped(),nn,"vector-tile");const Ot=y.paint.get("fill-emissive-strength");if(Me){Ze=rt.lineIndexBuffer,mt=rt.lineSegments;const gn=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[j.drawingBufferWidth,j.drawingBufferHeight];ze=Ee==="fillOutlinePattern"&&Ce?Fx(Vt,Ot,h,pt,gn,ye,q):Ox(Vt,Ot,gn,ye)}else Ze=rt.indexBuffer,mt=rt.triangleSegments,ze=Ce?_c(Vt,Ot,h,pt,ye,q):om(Vt,Ot,ye);h.uploadCommonUniforms(h.context,nn,$e.toUnwrapped());let vn=ke;(M==="road"&&!D||M==="offset")&&(vn=pe),nn.draw(h,ot,vn,a||h.stencilModeForClipping($e),S,jn.disabled,ze,y.id,rt.layoutVertexBuffer,Ze,mt,y.paint,h.transform.zoom,Ue,Ct)}};h.renderPass===O&&Ae(h.depthModeForSublayer(1,h.renderPass==="opaque"?an.ReadWrite:an.ReadOnly),!1),Z==="none"&&h.renderPass==="translucent"&&y.paint.get("fill-antialias")&&Ae(h.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,an.ReadOnly),!0)}function ln(d,t,a,h,g,y,b,S){a.resetLayerRenderingStats(d);const M=d.context,D=M.gl,O=d.transform,j=a.paint.get("fill-extrusion-pattern"),B=a.paint.get("fill-extrusion-pattern-cross-fade"),q=j.constantOr(null),H=j.constantOr(1),Z=a.paint.get("fill-extrusion-opacity"),re=d.style.enable3dLights(),$=a.paint.get(re&&!H?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ae=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),$],pe=a.layout.get("fill-extrusion-edge-radius"),ye=pe>0&&!a.paint.get("fill-extrusion-rounded-roof"),Ce=ye?0:pe,Ae=O.projection.name==="globe"?r.e8():0,ke=O.projection.name==="globe",Me=ke?r.aj(O.zoom):0,Ee=[r.aF(O.center.lng),r.aJ(O.center.lat)],ze=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ot=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ze?null:a.lut).toArray01().slice(0,3),Ze=a.paint.get("fill-extrusion-flood-light-intensity"),mt=a.paint.get("fill-extrusion-vertical-scale"),$e=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,pt=a.paint.get("fill-extrusion-height-alignment"),Ht=a.paint.get("fill-extrusion-base-alignment"),rt=Cl(d,a.paint.get("fill-extrusion-cutoff-fade-range")),Ue=[];let xt;ke&&Ue.push("PROJECTION_GLOBE_VIEW"),ae[0]>0&&Ue.push("FAUX_AO"),ye&&Ue.push("ZERO_ROOF_RADIUS"),S&&Ue.push("HAS_CENTROID"),Ze>0&&Ue.push("FLOOD_LIGHT"),rt.shouldRenderCutoff&&Ue.push("RENDER_CUTOFF"),$e&&Ue.push("RENDER_WALL_MODE");const ct=d.renderPass==="shadow",Ct=d.shadowRenderer,qt=ct&&!!Ct,nn=ct?jn.disabled:jn.backCCW;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let Vt=[0,0,0];if(Ct){const gn=d.style.directionalLight,yn=d.style.ambientLight;gn&&yn&&(Vt=va(d.style,gn,yn)),ct||(Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ct.useNormalOffset&&Ue.push("NORMAL_OFFSET")),xt=Ue.concat(["SHADOWS_SINGLE_CASCADE"])}const Ot=qt?"fillExtrusionDepth":H?"fillExtrusionPattern":"fillExtrusion",vn=a.getLayerRenderingStats();for(const gn of h){const yn=t.getTile(gn),mn=yn.getBucket(a);if(!mn||mn.projection.name!==O.projection.name)continue;let qn=!1;Ct&&(qn=Ct.getMaxCascadeForTile(gn.toUnwrapped())===0);const ii=d.isTileAffectedByFog(gn),ai=mn.programConfigurations.get(a.id);let Xi=!1;if(q&&yn.imageAtlas){const Di=yn.imageAtlas,Ni=r.e0.from(q),Ar=Ni.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Yr=Ni.getSecondary(),Ro=Di.patternPositions.get(Ar),Ir=Yr?Di.patternPositions.get(Yr.scaleSelf(r.o.devicePixelRatio).toString()):null;Xi=!!Ro&&!!Ir,Ro&&ai.setConstantPatternPositions(Ro,Ir)}B>0&&(Xi||ai.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ue.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Jn=d.getOrCreateProgram(Ot,{config:ai,defines:qn?xt:Ue,overrideFog:ii});if(d.terrain&&d.terrain.setupElevationDraw(yn,Jn,{useMeterToDem:!0}),!mn.centroidVertexBuffer){const Di=Jn.getAttributeLocation(D,"a_centroid_pos");Di!==-1&&D.vertexAttrib2f(Di,0,0)}!ct&&Ct&&Ct.setupShadows(yn.tileID.toUnwrapped(),Jn,"vector-tile"),H&&(d.context.activeTexture.set(D.TEXTURE0),yn.imageAtlasTexture&&yn.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),ai.updatePaintBuffers());const Pi=a.paint.get("fill-extrusion-vertical-gradient"),ji=1/mn.tileToMeter;let wr;if(ct&&Ct){if(ey(yn.tileID,mn.maxHeight,d))continue;const Di=Ct.calculateShadowPassMatrixFromTile(yn.tileID.toUnwrapped());wr=rm(Di,Ce,ji,mt,pt,Ht)}else{const Di=d.translatePosMatrix(gn.expandedProjMatrix,yn,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ni=O.projection.createInversionMatrix(O,gn.canonical);wr=H?K_(Di,d,Pi,Z,ae,Ce,ji,gn,yn,Ae,pt,Ht,Me,Ee,Ni,ot,mt,B):Th(Di,d,Pi,Z,ae,Ce,ji,gn,Ae,pt,Ht,Me,Ee,Ni,ot,mt,Ze,Vt)}d.uploadCommonUniforms(M,Jn,gn.toUnwrapped(),null,rt);let ri=mn.segments;if(O.projection.name==="mercator"&&!ct&&(ri=mn.getVisibleSegments(yn.tileID,d.terrain,d.transform.getFrustum(0)),!ri.get().length))continue;if(vn)if(ct)for(const Di of ri.get())vn.numRenderedVerticesInShadowPass+=Di.primitiveLength;else for(const Di of ri.get())vn.numRenderedVerticesInTransparentPass+=Di.primitiveLength;const Fi=[];(d.terrain||S)&&Fi.push(mn.centroidVertexBuffer),ke&&Fi.push(mn.layoutVertexExtBuffer),$e&&Fi.push(mn.wallVertexBuffer),Jn.draw(d,M.gl.TRIANGLES,g,y,b,nn,wr,a.id,mn.layoutVertexBuffer,mn.indexBuffer,ri,a.paint,d.transform.zoom,ai,Fi)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}class _m{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Qa(d,t,a,h,g,y,b,S,M,D,O,j,B,q,H,Z,re,$,ae,pe){const ye=t.context,Ce=ye.gl,Ae=t.transform,ke=t.transform.zoom,Me=[],Ee=d.translate,ze=d.translateAnchor,ot=d.edgeRadius,Ze=Cl(t,d.cutoffFadeRange);O==="clear"?(Me.push("CLEAR_SUBPASS"),pe&&(Me.push("CLEAR_FROM_TEXTURE"),ye.activeTexture.set(Ce.TEXTURE0),pe.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE))):O==="sdf"&&Me.push("SDF_SUBPASS"),$&&Me.push("HAS_CENTROID"),Ze.shouldRenderCutoff&&Me.push("RENDER_CUTOFF");const mt=($e,pt,Ht,rt,Ue)=>{const xt=pt.programConfigurations.get(h.id),ct=t.isTileAffectedByFog($e),Ct=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:xt,defines:Me,overrideFog:ct}),qt=((Vt,Ot,vn,gn,yn,mn,qn,ii,ai,Xi,Jn)=>({u_matrix:Ot,u_opacity:vn,u_ao_pass:gn?1:0,u_meter_to_tile:yn,u_ao:mn,u_flood_light_intensity:qn,u_flood_light_color:ii,u_attenuation:ai,u_edge_radius:Xi,u_fb:0,u_fb_size:Jn,u_dynamic_offset:1}))(0,rt,j,D,Ue,[B,q*Ue],H,Z,re,ke>=17?0:ot*Ue,pe?pe.size[0]:0),nn=[];$&&nn.push(pt.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(ye,Ct,$e.toUnwrapped(),null,Ze),Ct.draw(t,ye.gl.TRIANGLES,y,b,S,M,qt,h.id,pt.vertexBuffer,pt.indexBuffer,Ht,h.paint,ke,xt,nn)};for(const $e of g){const pt=a.getTile($e),Ht=pt.getBucket(h);if(!Ht||Ht.projection.name!==Ae.projection.name||!Ht.groundEffect||Ht.groundEffect&&!Ht.groundEffect.hasData())continue;const rt=Ht.groundEffect,Ue=1/Ht.tileToMeter;{const xt=t.translatePosMatrix($e.projMatrix,pt,Ee,ze),ct=rt.getDefaultSegment();mt($e,rt,ct,xt,Ue)}if(ae)for(let xt=0;xt<4;xt++){const ct=r.e6[xt]($e),Ct=a.getTile(ct);if(!Ct)continue;const qt=Ct.getBucket(h);if(!qt||qt.projection.name!==Ae.projection.name||!qt.groundEffect||qt.groundEffect&&!qt.groundEffect.hasData())continue;const nn=qt.groundEffect;let Vt,Ot;xt===0?(Vt=[-r.al,0,0],Ot=1):xt===1?(Vt=[r.al,0,0],Ot=0):xt===2?(Vt=[0,-r.al,0],Ot=3):(Vt=[0,r.al,0],Ot=2);const vn=nn.regionSegments[Ot];if(!vn)continue;const gn=new Float32Array(16);r.br(gn,$e.projMatrix,Vt),mt($e,nn,vn,t.translatePosMatrix(gn,pt,Ee,ze),Ue)}}}function Ol(d,t,a,h,g,y,b){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const S=y?y.findDEMTileFor(a):null;if(!(S&&S.dem||b))return;y&&S&&S.dem&&h.selfDEMTileTimestamp!==S.dem._timestamp&&(h.borderDoneWithNeighborZ=[-1,-1,-1,-1],h.selfDEMTileTimestamp=S.dem._timestamp);const M=$=>new r.P(Math.ceil(($+r.ea)*r.eb),0),D=$=>{const ae=t.getSource().minzoom,pe=Ce=>{const Ae=t.getTileByID(Ce);if(Ae&&Ae.hasData())return Ae.getBucket(g)},ye=[0,-1,1];for(const Ce of ye){if($.overscaledZ+Ce<ae)continue;const Ae=pe($.calculateScaledKey($.overscaledZ+Ce));if(Ae)return Ae}},O=[0,0,0],j=($,ae)=>(O[0]=Math.min($.min.y,ae.min.y),O[1]=Math.max($.max.y,ae.max.y),O[2]=r.al-ae.min.x>$.max.x?ae.min.x-r.al:$.max.x,O),B=($,ae)=>(O[0]=Math.min($.min.x,ae.min.x),O[1]=Math.max($.max.x,ae.max.x),O[2]=r.al-ae.min.y>$.max.y?ae.min.y-r.al:$.max.y,O),q=[($,ae)=>j($,ae),($,ae)=>j(ae,$),($,ae)=>B($,ae),($,ae)=>B(ae,$)],H=($,ae,pe,ye,Ce,Ae,ke)=>{if(!y)return 0;const Me=[[Ae?pe:$,Ae?$:pe,0],[Ae?pe:ae,Ae?ae:pe,0]],Ee=ke<0?r.al+ke:ke,ze=[Ae?Ee:($+ae)/2,Ae?($+ae)/2:Ee,0];return pe===0&&ke<0||pe!==0&&ke>0?y.getForTilePoints(Ce,[ze],!0,ye):Me.push(ze),y.getForTilePoints(a,Me,!0,S),Math.max(Me[0][2],Me[1][2],ze[2])/y.exaggeration()};for(let $=0;$<4;$++){const ae=h.borderFeatureIndices[$];if(ae.length===0)continue;const pe=r.e6[$](a),ye=D(pe);if(!(ye&&ye instanceof r.e7))continue;const Ce=y?y.findDEMTileFor(pe):null;if(!(Ce&&Ce.dem||b)||(y&&Ce&&Ce.dem&&h.borderDEMTileTimestamp[$]!==Ce.dem._timestamp&&(h.borderDoneWithNeighborZ[$]=-1,h.borderDEMTileTimestamp[$]=Ce.dem._timestamp),h.borderDoneWithNeighborZ[$]===ye.canonical.z))continue;ye.centroidVertexArray.length===0&&ye.createCentroidsBuffer();const Ae=($<2?1:5)-$,ke=ye.borderDoneWithNeighborZ[Ae]!==h.canonical.z,Me=ye.borderFeatureIndices[Ae];let Ee=0;if(h.canonical.z!==ye.canonical.z){for(const ze of ae)h.showCentroid(h.featuresOnBorder[ze]);if(ke)for(const ze of Me)ye.showCentroid(ye.featuresOnBorder[ze]);h.borderDoneWithNeighborZ[$]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ae]=h.canonical.z}for(const ze of ae){const ot=h.featuresOnBorder[ze],Ze=h.centroidData[ot.centroidDataIndex],mt=ot.borders[$];let $e;for(;Ee<Me.length;){$e=ye.featuresOnBorder[Me[Ee]];const pt=$e.borders[Ae];if(pt[1]>mt[0]+3||pt[0]>mt[0]-3)break;ye.showCentroid($e),Ee++}if($e&&Ee<Me.length){const pt=Ee;let Ht=0;for(;!($e.borders[Ae][0]>mt[1]-3)&&(Ht++,++Ee!==Me.length);)$e=ye.featuresOnBorder[Me[Ee]];$e=ye.featuresOnBorder[Me[pt]];let rt=!1;if(Ht>=1){const ct=$e.borders[Ae];Math.abs(mt[0]-ct[0])<3&&Math.abs(mt[1]-ct[1])<3&&(Ht=1,rt=!0,Ee=pt+1)}else if(Ht===0){h.showCentroid(ot);continue}const Ue=ye.centroidData[$e.centroidDataIndex];b&&rt&&(((Z=Ze).flags|(re=Ue).flags)&r.e9?(Z.flags|=r.e9,re.flags|=r.e9):(Z.flags&=~r.e9,re.flags&=~r.e9));const xt=ot.intersectsCount()>1||$e.intersectsCount()>1;if(Ht>1)Ee=pt,Ze.centroidXY=Ue.centroidXY=new r.P(0,0);else if(Ce&&Ce.dem&&!xt){const ct=q[$](Ze,Ue),Ct=$%2?r.al-1:0,qt=H(ct[0],Math.min(r.al-1,ct[1]),Ct,Ce,pe,$<2,ct[2]);Ze.centroidXY=Ue.centroidXY=M(qt)}else xt?Ze.centroidXY=Ue.centroidXY=new r.P(0,0):(Ze.centroidXY=h.encodeBorderCentroid(ot),Ue.centroidXY=ye.encodeBorderCentroid($e));h.writeCentroidToBuffer(Ze),ye.writeCentroidToBuffer(Ue)}else h.showCentroid(ot)}h.borderDoneWithNeighborZ[$]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ae]=h.canonical.z}var Z,re;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(d)}const Fl=[1,0,0],Pn=[0,1,0],ym=[0,0,1];function ey(d,t,a){const h=a.transform,g=a.shadowRenderer;if(!g)return!0;const y=d.toUnwrapped(),b=h.tileSize*g._cascades[a.currentShadowCascade].scale;let S=t;if(h.elevation){const Z=h.elevation.getMinMaxForTile(d);Z&&(S+=Z.max)}const M=[...g.shadowDirection];M[2]=-M[2];const D=g.computeSimplifiedTileShadowVolume(y,S,b,M);if(!D)return!1;const O=[Fl,Pn,ym,M,[M[0],0,M[2]],[0,M[1],M[2]]],j=h.projection.name==="globe",B=h.scaleZoom(b),q=r.cA.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,B,!j),H=g.getCurrentCascadeFrustum();return q.intersectsPrecise(D.vertices,D.planes,O)===0||H.intersectsPrecise(D.vertices,D.planes,O)===0}function sf(d){const{painter:t,source:a,layer:h,coords:g}=d;let y=d.defines;const b=t.context,S=t.renderPass==="shadow",M=t.renderPass==="light-beam",D=t.shadowRenderer,O=r.ec(t.transform.center.lat,t.transform.zoom),j=Cl(t,h.paint.get("building-cutoff-fade-range"));j.shouldRenderCutoff&&(y=y.concat("RENDER_CUTOFF"));for(const B of g){const q=a.getTile(B),H=q.getBucket(h);if(!H)continue;D&&D.getMaxCascadeForTile(B.toUnwrapped())===0&&(y=y.concat("SHADOWS_SINGLE_CASCADE"));const Z=H.programConfigurations.get(h.id);let re,$,ae,pe=t.translatePosMatrix(B.expandedProjMatrix,q,[0,0],"map");if(pe=r.cR(r.bC(),pe,[1,1,d.verticalScale]),S&&D){if(ey(q.tileID,H.maxHeight*O,t))continue;let Ce=D.calculateShadowPassMatrixFromTile(q.tileID.toUnwrapped());Ce=r.cR(r.bC(),Ce,[1,1,d.verticalScale]),ae=sm(Ce),re=$=t.getOrCreateProgram("buildingDepth",{config:Z,defines:y,overrideFog:!1})}else if(M)re=$=t.getOrCreateProgram("buildingBloom",{config:Z,defines:y,overrideFog:!1}),ae=Vx(pe);else{const Ce=t.transform.calculatePosMatrix(B.toUnwrapped(),t.transform.worldSize);r.cR(Ce,Ce,[1,1,d.verticalScale]);const Ae=r.bC();r.cR(Ae,Ce,[1,-1,1/O]),r.bl(Ae,Ae),r.ed(Ae,Ae);const ke=t.transform.getFreeCameraOptions().position,Me=1<<B.canonical.z;ae=Nx(pe,Ae,d.opacity,d.facadeAOIntensity,[((ke.x-B.wrap)*Me-B.canonical.x)*r.al,(ke.y*Me-B.canonical.y)*r.al,ke.z*Me*r.al],H.tileToMeter,d.facadeEmissiveChance),$=t.getOrCreateProgram("building",{config:Z,defines:y,overrideFog:!1});const Ee=y.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);re=t.getOrCreateProgram("building",{config:Z,defines:Ee,overrideFog:!1}),D&&(D.setupShadowsFromMatrix(Ce,$,!0),D.setupShadowsFromMatrix(Ce,re,!0))}const ye=(Ce,Ae)=>{if(M){const ke=Ce.entranceBloom;Ae.draw(t,b.gl.TRIANGLES,d.depthMode,On.disabled,d.blendMode,jn.disabled,ae,h.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segmentsBucket,h.paint,t.transform.zoom,Z,[ke.layoutAttenuationBuffer,ke.layoutColorBuffer])}else{const ke=Ce.segmentsBucket;let Me=[Ce.layoutNormalBuffer,Ce.layoutCentroidBuffer,Ce.layoutColorBuffer];Ce.layoutFacadePaintBuffer&&(Me=Me.concat([Ce.layoutFacadeDataBuffer,Ce.layoutFacadeVerticalRangeBuffer,Ce.layoutFacadePaintBuffer])),Ae.draw(t,b.gl.TRIANGLES,d.depthMode,On.disabled,d.blendMode,S?jn.disabled:jn.backCW,ae,h.id,Ce.layoutVertexBuffer,Ce.indexBuffer,ke,h.paint,t.transform.zoom,Z,Me)}};t.uploadCommonUniforms(b,$,B.toUnwrapped(),null,j),H.buildingWithoutFacade&&ye(H.buildingWithoutFacade,$),re!==$&&t.uploadCommonUniforms(b,re,B.toUnwrapped(),null,j),H.buildingWithFacade&&ye(H.buildingWithFacade,re)}}function af(d){return[d[0]*r.ee,d[1]*r.ee,d[2]*r.ee,0]}function lf(d,t,a,h,g,y,b,S,M){const D=h.getSource(),O=a.globeSharedBuffers;if(!O)return;let j,B,q;if(t&&(j=h.getTile(t)),D instanceof r.aS?(B=D.texture,q=r.dG(0,0,a.transform)):j&&t&&(B=j.texture,q=r.dG(t.canonical.z,t.canonical.x,a.transform)),!B||!q)return;d||(q=r.cR(r.bC(),q,[1,-1,1]));const H=a.context,Z=H.gl,re=g.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,$=a.colorModeForDrapableLayerRenderPass(y),ae=b.defines;ae.push("GLOBE_POLES");const pe=new an(Z.LEQUAL,an.ReadWrite,a.depthRangeFor3D),ye=Float32Array.from(a.transform.expandedFarZProjMatrix),Ce=Float32Array.from(r.bk(r.dF(new r.cC(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),H.activeTexture.set(Z.TEXTURE0),B.bind(re,Z.CLAMP_TO_EDGE),H.activeTexture.set(Z.TEXTURE1),B.bind(re,Z.CLAMP_TO_EDGE),"useMipmap"in B&&H.extTextureFilterAnisotropic&&a.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const[Ae,ke,Me,Ee]=t?O.getPoleBuffers(t.canonical.z,!1):O.getPoleBuffers(0,!0),ze=g.paint.get("raster-elevation");let ot;d?(ot=Ae,a.renderDefaultNorthPole=ze!==0):(ot=ke,a.renderDefaultSouthPole=ze!==0);const Ze=af(b.mix),mt=((pt,Ht,rt,Ue,xt,ct,Ct,qt,nn,Vt,Ot,vn,gn)=>Kd(pt,Ht,rt,new Float32Array(16),new Float32Array(9),[0,0],Ue,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ct,[0,0],qt,2,Vt,Ot,vn,1,0,gn))(ye,Ce,q,r.aj(a.transform.zoom),0,g,0,ze,0,Ze,b.offset,b.range,y),$e=a.getOrCreateProgram("raster",{defines:ae});a.uploadCommonUniforms(H,$e,null),$e.draw(a,Z.TRIANGLES,pe,M,$,S,mt,g.id,ot,Me,Ee)}function Gx(d){const t=d._nearZ,a=d.projection.farthestPixelDistance(d),h=a-t,g=.2*d.height,y=t+g;return[t,a,(y-g-t)/h,(y-t)/h]}function ty(d,t,a,h){if(d)return t instanceof Tl&&d instanceof oh?t.getTextureDescriptor(d,a,!0):{texture:d.texture,mix:af(h.mix),offset:h.offset,buffer:0,tileSize:1}}var Wx=r.ef([{name:"a_index",type:"Int16",components:1}]);class qx{constructor(t,a,h,g){const y={width:h[0],height:h[1],data:null},b=t.gl;this.targetColorTexture=new r.T(t,y,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,y,b.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(a,g),this.lastInvalidatedAt=0}updateParticleTexture(t,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const h=this.context.gl,g=a.width*a.height;this.particleTexture0=new r.T(this.context,a,h.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,a,h.RGBA8,{premultiply:!1,useMipmap:!1});const y=new r.eg;y.reserve(g);for(let b=0;b<g;b++)y.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(y,Wx.members,!0),this.particleSegment=r.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Is(d,t,a){if(!d)return null;const h=t.getTextureDescriptor(d,a,!0);if(!h)return null;let{texture:g,mix:y,offset:b,tileSize:S,buffer:M,format:D}=h;if(!g||!D)return null;let O=!1;return D==="uint32"&&(O=!0,y[3]=0,y=cm(r.eh,y,[0,a.paint.get("raster-particle-max-speed")]),b=um(r.eh,b,[0,a.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[M/(S+2*M),S/(S+2*M)],tileSize:S,scalarData:O,scale:y,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function vm(d){const t=d._nearZ,a=d.projection.farthestPixelDistance(d),h=a-t,g=.2*d.height,y=t+g;return[t,a,(y-g-t)/h,(y-t)/h]}const ps=new r.ao(1,0,0,1),Bl=new r.ao(0,1,0,1),ny=new r.ao(0,0,1,1),xm=new r.ao(1,0,1,1),bm=new r.ao(0,1,1,1);function cf(d,t,a,h,g,y){for(let b=0;b<a.length;b++)if(g){const D=new r.ao(h.r*.8,h.g*.8,h.b*.8,1);bc(d,t,a[b],h,-1,-1,y),bc(d,t,a[b],h,-1,1,y),bc(d,t,a[b],h,1,1,y),bc(d,t,a[b],h,1,-1,y),bc(d,t,a[b],D,0,0,y)}else bc(d,t,a[b],h,0,0,y)}function bc(d,t,a,h,g,y,b){const S=d.context,M=d.transform,D=S.gl,O=M.projection.name==="globe",j=O?["PROJECTION_GLOBE_VIEW"]:[];let B=r.bz(a.projMatrix);if(O&&r.aj(M.zoom)>0){const Ze=r.bj(a.canonical,M),mt=r.ei(Ze);B=r.aB(new Float32Array(16),M.globeMatrix,mt),r.aB(B,M.projMatrix,B)}const q=r.bC();q[12]+=2*g/(r.o.devicePixelRatio*M.width),q[13]+=2*y/(r.o.devicePixelRatio*M.height),r.aB(B,q,B);const H=d.getOrCreateProgram("debug",{defines:j}),Z=t.getTileByID(a.key);d.terrain&&d.terrain.setupElevationDraw(Z,H);const re=an.disabled,$=On.disabled,ae=d.colorModeForRenderPass(),pe="$debug";S.activeTexture.set(D.TEXTURE0),d.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),O?Z._makeGlobeTileDebugBuffers(d.context,M):Z._makeDebugTileBoundsBuffers(d.context,M.projection);const ye=Z._tileDebugBuffer||d.debugBuffer,Ce=Z._tileDebugIndexBuffer||d.debugIndexBuffer,Ae=Z._tileDebugSegments||d.debugSegments;if(H.draw(d,D.LINE_STRIP,re,$,ae,jn.disabled,lm(B,h.toPremultipliedRenderColor(null)),pe,ye,Ce,Ae,null,null,null,[Z._globeTileDebugBorderBuffer]),b){const Ze=Z.latestRawTileData,mt=Math.floor((Ze&&Ze.byteLength||0)/1024);let $e=a.canonical.toString();a.overscaledZ!==a.canonical.z&&($e+=` => ${a.overscaledZ}`),$e+=` ${Z.state}`,$e+=` ${mt}kb`,(function(pt,Ht){pt.initDebugOverlayCanvas();const rt=pt.debugOverlayCanvas,Ue=pt.context.gl,xt=pt.debugOverlayCanvas.getContext("2d");xt.clearRect(0,0,rt.width,rt.height),xt.shadowColor="white",xt.shadowBlur=2,xt.lineWidth=1.5,xt.strokeStyle="white",xt.textBaseline="top",xt.font="bold 36px Open Sans, sans-serif",xt.fillText(Ht,5,5),xt.strokeText(Ht,5,5),pt.debugOverlayTexture.update(rt),pt.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)})(d,$e)}const ke=t.getTile(a).tileSize,Me=512/Math.min(ke,512)*(a.overscaledZ/M.zoom)*.5,Ee=Z._tileDebugTextBuffer||d.debugBuffer,ze=Z._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,ot=Z._tileDebugTextSegments||d.debugSegments;H.draw(d,D.TRIANGLES,re,$,si.alphaBlended,jn.disabled,lm(B,r.ao.transparent.toPremultipliedRenderColor(null),Me),pe,Ee,ze,ot,null,null,null,[Z._globeTileDebugTextBuffer])}function za(d,t,a,h){wc(d,0,t+a/2,d.transform.width,a,h)}function dr(d,t,a,h){wc(d,t-a/2,0,a,d.transform.height,h)}function wc(d,t,a,h,g,y){const b=d.context,S=b.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*r.o.devicePixelRatio,a*r.o.devicePixelRatio,h*r.o.devicePixelRatio,g*r.o.devicePixelRatio),b.clear({color:y}),S.disable(S.SCISSOR_TEST)}const wm=r.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:iy}=wm;function $a(d,t,a,h){d.emplaceBack(t,a,h)}class Tm{constructor(t){this.vertexArray=new r.ej,this.indices=new r.b1,$a(this.vertexArray,-1,-1,1),$a(this.vertexArray,1,-1,1),$a(this.vertexArray,-1,1,1),$a(this.vertexArray,1,1,1),$a(this.vertexArray,-1,-1,-1),$a(this.vertexArray,1,-1,-1),$a(this.vertexArray,-1,1,-1),$a(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,iy),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.bg.simpleSegment(0,0,36,12)}}function Tc(d,t,a,h,g,y){const b=d.context.gl,S=t.paint.get("sky-atmosphere-color"),M=t.paint.get("sky-atmosphere-halo-color"),D=t.paint.get("sky-atmosphere-sun-intensity"),O=((j,B,q,H,Z)=>({u_matrix_3f:j,u_sun_direction:B,u_sun_intensity:q,u_color_tint_r:[H.r,H.g,H.b,H.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(r.el(r.dL(),h),g,D,S.toPremultipliedRenderColor(null),M.toPremultipliedRenderColor(null));b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),a.draw(d,b.TRIANGLES,an.disabled,On.disabled,si.unblended,jn.frontCW,O,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Sc=r.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ec{constructor(t){const a=new r.em;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const h=new r.b1;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,Sc.members),this.indexBuffer=t.createIndexBuffer(h),this.segments=r.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Wt=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class tn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class bu{constructor(t){this.colorModeAlphaBlendedWriteRGB=new si([1,Ts,1,Ts],r.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new si([1,0,1,0],r.ao.transparent,[!1,!1,!1,!0]),this.params=new tn,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const a=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ec(a);const h=this.params.sizeRange,g=this.params.intensityRange,y=(function(O){const j=r.eo(30),B=[];for(let q=0;q<O;++q){const H=2*Math.PI*j(),Z=Math.acos(1-2*j())-.5*Math.PI;B.push(r.d4(Math.cos(Z)*Math.cos(H),Math.cos(Z)*Math.sin(H),Math.sin(Z)))}return B})(this.params.starsCount),b=r.eo(300),S=new r.en,M=new r.b1;let D=0;for(let O=0;O<y.length;++O){const j=r.c4([],y[O],200),B=Math.max(0,1+.01*h*(1*b()-.5)),q=Math.max(0,1+.01*g*(1*b()-.5));S.emplaceBack(j[0],j[1],j[2],-1,-1,B,q),S.emplaceBack(j[0],j[1],j[2],1,-1,B,q),S.emplaceBack(j[0],j[1],j[2],1,1,B,q),S.emplaceBack(j[0],j[1],j[2],-1,1,B,q),M.emplaceBack(D+0,D+1,D+2),M.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=a.createVertexBuffer(S,Wt.members),this.starsIdx=a.createIndexBuffer(M),this.starsSegments=r.bg.simpleSegment(0,0,S.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,a){const h=t.context,g=h.gl,y=t.transform,b=new an(g.LEQUAL,an.ReadOnly,[0,1]),S=r.aj(y.zoom),M=t.style.getLut(a.scope),D=a.properties.get("color-use-theme")==="none",O=a.properties.get("color").toNonPremultipliedRenderColor(D?null:M),j=a.properties.get("high-color-use-theme")==="none",B=a.properties.get("high-color").toNonPremultipliedRenderColor(j?null:M),q=a.properties.get("space-color-use-theme")==="none",H=a.properties.get("space-color").toNonPremultipliedRenderColor(q?null:M),Z=5e-4,re=r.ep(a.properties.get("horizon-blend"),0,1,Z,.25),$=r.dA(t,h,y)&&re===Z?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,ae=t.frameCounter/1e3%1,pe=r.ag(y.globeCenterInViewSpace),ye=Math.sqrt(Math.pow(pe,2)-Math.pow($,2)),Ce=Math.acos(ye/pe),Ae=ke=>{const Me=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ke&&Me.push("ALPHA_PASS");const Ee=t.getOrCreateProgram("globeAtmosphere",{defines:Me}),ze=((Ze,mt,$e,pt,Ht,rt,Ue,xt,ct,Ct,qt,nn)=>({u_frustum_tl:Ze,u_frustum_tr:mt,u_frustum_br:$e,u_frustum_bl:pt,u_horizon:Ht,u_transition:rt,u_fadeout_range:Ue,u_atmosphere_fog_color:xt.toArray01(),u_high_color:ct.toArray01(),u_space_color:Ct.toArray01(),u_temporal_offset:qt,u_horizon_angle:nn}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,S,re,O,B,H,ae,Ce);t.uploadCommonUniforms(h,Ee);const ot=this.atmosphereBuffer;ot&&Ee.draw(t,g.TRIANGLES,b,On.disabled,ke?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,jn.backCW,ze,ke?"atmosphere_glow_alpha":"atmosphere_glow",ot.vertexBuffer,ot.indexBuffer,ot.segments)};Ae(!1),Ae(!0)}drawStars(t,a){const h=r.aA(a.properties.get("star-intensity"),0,1);if(h===0)return;const g=t.context,y=g.gl,b=t.transform,S=t.getOrCreateProgram("stars"),M=r.c6([]);r.c8(M,M,-b._pitch),r.c7(M,M,-b.angle),r.c8(M,M,r.an(b._center.lat)),r.eq(M,M,-r.an(b._center.lng));const D=r.cb(new Float32Array(16),M),O=r.aB([],b.starsProjMatrix,D),j=r.el([],D),B=r.er([],j),q=[0,1,0];r.dN(q,q,B),r.c4(q,q,this.params.sizeMultiplier);const H=[1,0,0];r.dN(H,H,B),r.c4(H,H,this.params.sizeMultiplier);const Z=(re=q,$=H,ae=h,{u_matrix:Float32Array.from(O),u_up:re,u_right:$,u_intensity_multiplier:ae});var re,$,ae;t.uploadCommonUniforms(g,S),this.starsVx&&this.starsIdx&&S.draw(t,y.TRIANGLES,an.disabled,On.disabled,this.colorModeAlphaBlendedWriteRGB,jn.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Ur{constructor(){this.visibleTiles=[]}updateBorders(t,a){const h=[],g=[],y=t._getRenderableCoordinates(!1,!0);for(const M of y){const D=t.getTile(M);if(!D.hasData())continue;const O=D.getBucket(a);O&&(O.isEmpty()||(h.push(M.key),g.push({bucket:O,tileID:M.canonical})))}let b=h.length!==this.visibleTiles.length;if(!b){h.sort();for(let M=0;M<h.length;M++)if(h[M]!==this.visibleTiles[M]){b=!0;break}}if(!b)return;const S=new Set;this.visibleTiles=h,g.sort(((M,D)=>M.tileID.z-D.tileID.z||M.tileID.x-D.tileID.x||M.tileID.y-D.tileID.y));for(const M of g){const D=new Array,O=new Array,j=M.bucket;for(const B of j.featuresOnBorder)S.has(B.featureId)?O.push(B.footprintIndex):(S.add(B.featureId),D.push(B.footprintIndex));j.updateFootprintHiddenFlags(D,r.es,!1),j.updateFootprintHiddenFlags(O,r.es,!0)}}}function Ye(d,t){const a=[...d],h=t.cameraWorldSizeForFog/t.worldSize,g=r.bA([]);return r.cR(g,g,[h,h,1]),r.aB(a,g,a),r.aB(a,t.worldToFogMatrix,a),a}function uf(d,t,a,h,g){const y=a.material,b=h.context,{baseColorTexture:S,metallicRoughnessTexture:M}=y.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:O,emissionTexture:j}=y;function B(H,Z,re){if(H&&(d.push(Z),b.activeTexture.set(b.gl.TEXTURE0+re),H.gfxTexture)){const{minFilter:$,magFilter:ae,wrapS:pe,wrapT:ye}=H.sampler;H.gfxTexture.bindExtraParam($,ae,pe,ye)}}B(S,"HAS_TEXTURE_u_baseColorTexture",ao.BaseColor),B(M,"HAS_TEXTURE_u_metallicRoughnessTexture",ao.MetallicRoughness),B(D,"HAS_TEXTURE_u_normalTexture",ao.Normal),B(O,"HAS_TEXTURE_u_occlusionTexture",ao.Occlusion),B(j,"HAS_TEXTURE_u_emissionTexture",ao.Emission),g&&(g.texture||(g.texture=new r.dY(h.context,g.image,[g.image.height,g.image.height,g.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+ao.LUT),g.texture&&g.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(a.texcoordBuffer)),a.colorBuffer&&(d.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(a.colorBuffer)),a.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(a.normalBuffer)),a.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(a.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||d.push("DIFFUSE_SHADED");const q=h.shadowRenderer;q&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&d.push("NORMAL_OFFSET"))}function Ac(d,t,a,h,g,y){const b=a.paint.get("model-opacity").constantOr(1),S=t.context,M=new an(t.context.gl.LEQUAL,an.ReadWrite,t.depthRangeFor3D),D=t.transform,O=d.mesh,j=O.material,B=j.pbrMetallicRoughness,q=t.style.fog;let H;H=t.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:r.aB([],h.zScaleMatrix,d.nodeModelMatrix),r.aB(H,h.negCameraPosMatrix,H);const Z=r.bl([],H);r.ed(Z,Z);const re=a.paint.get("model-color-use-theme").constantOr("default")==="none",$=a.paint.get("model-emissive-strength").constantOr(0),ae=ef(new Float32Array(d.worldViewProjection),new Float32Array(H),new Float32Array(Z),null,t,b,B.baseColorFactor,j.emissiveFactor,B.metallicFactor,B.roughnessFactor,j,$,a),pe={defines:[]},ye=[],Ce=t.shadowRenderer;Ce&&(Ce.useNormalOffset=!1),uf(pe.defines,ye,O,t,re?null:a.lut);let Ae=null;if(q){const Ee=Ye(d.nodeModelMatrix,t.transform);if(Ae=new Float32Array(Ee),D.projection.name!=="globe"){const ze=O.aabb.min,ot=O.aabb.max,[Ze,mt]=q.getOpacityForBounds(Ee,ze[0],ze[1],ot[0],ot[1]);pe.overrideFog=Ze>=dn||mt>=dn}}const ke=Cl(t,a.paint.get("model-cutoff-fade-range"));ke.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const Me=t.getOrCreateProgram("model",pe);t.uploadCommonUniforms(S,Me,null,Ae,ke),t.renderPass!=="shadow"&&Ce&&Ce.setupShadowsFromMatrix(d.nodeModelMatrix,Me),Me.draw(t,S.gl.TRIANGLES,M,g,y,O.material.doubleSided?jn.disabled:jn.backCCW,ae,a.id,O.vertexBuffer,O.indexBuffer,O.segments,a.paint,t.transform.zoom,void 0,ye)}function hf(d,t,a,h,g,y,b){let S;S=d.projection.name==="globe"?r.eu(a,d):[...a],r.aB(S,S,t.matrix);const M=r.aB([],h,S);if(t.meshes)for(const D of t.meshes){if(D.material.alphaMode!=="BLEND"){b.push({mesh:D,depth:0,modelIndex:g,worldViewProjection:M,nodeModelMatrix:S});continue}const O=r.af([],D.centroid,M);!d.isOrthographic&&O[2]<=0||y.push({mesh:D,depth:O[2],modelIndex:g,worldViewProjection:M,nodeModelMatrix:S})}if(t.children)for(const D of t.children)hf(d,D,a,h,g,y,b)}function Ah(d,t,a,h){const g=a.shadowRenderer;if(!g)return;const y=g.getShadowPassDepthMode(),b=g.getShadowPassColorMode(),S=g.calculateShadowPassMatrixFromMatrix(t),M=vu(S);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,y,On.disabled,b,jn.backCCW,M,h.id,d.vertexBuffer,d.indexBuffer,d.segments,h.paint,a.transform.zoom,void 0,void 0)}function ry(d,t,a){const h=t.updateZoomBasedPaintProperties(),g=(function(y,b,S){let M,D,O,j=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&j>0){const B=y.terrain,q=B.findDEMTileFor(S);q&&q.dem?M=r.ew.create(B,S,q):j=0}if(j===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),j===b.validForExaggeration&&(j===0||M&&M._demTile&&M._demTile.tileID===b.validForDEMTile.id&&M._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const B in b.instancesPerModel){const q=b.instancesPerModel[B];for(let H=0;H<q.instancedDataArray.length;++H){const Z=(M?j*M.getElevationAt(0|q.instancedDataArray.float32[16*H],0|q.instancedDataArray.float32[16*H+1],!0,!0):0)+q.instancesEvaluatedElevation[H];q.instancedDataArray.float32[16*H+6]=Z,D=D?Math.min(b.terrainElevationMin,Z):Z,O=O?Math.max(b.terrainElevationMax,Z):Z}}return b.terrainElevationMin=D||0,b.terrainElevationMax=O||0,b.validForExaggeration=j,b.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0})(d,t,a);(h||g)&&(t.uploaded=!1,t.upload(d.context))}const xa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.d8([0,0,0],[r.al,r.al,0])};function wu(d,t){const a=1<<d.canonical.z,h=t.getFreeCameraOptions().position,g=t.elevation,y=d.canonical.x/a,b=(d.canonical.x+1)/a,S=d.canonical.y/a,M=(d.canonical.y+1)/a;let D=t._centerAltitude;if(g){const q=g.getMinMaxForTile(d);q&&q.max>D&&(D=q.max)}const O=r.aA(h.x,y,b)-h.x,j=r.aA(h.y,S,M)-h.y,B=r.ce(D,t.center.lat)-h.z;return t._zoomFromMercatorZ(Math.sqrt(O*O+j*j+B*B))}function oy(d,t,a,h,g,y,b){const S=d.context,M=d.renderPass==="shadow",D=d.shadowRenderer,O=M&&D?D.getShadowPassDepthMode():new an(S.gl.LEQUAL,an.ReadWrite,d.depthRangeFor3D),j=d.isTileAffectedByFog(y);if(a.meshes)for(const B of a.meshes){const q=["MODEL_POSITION_ON_GPU"],H=[];let Z,re,$;h.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const ae=Cl(d,t.paint.get("model-cutoff-fade-range"));if(ae.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),M&&D)Z=d.getOrCreateProgram("modelDepth",{defines:q}),re=vu(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(a.matrix)),$=D.getShadowPassColorMode();else{uf(q,H,B,d,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),Z=d.getOrCreateProgram("model",{defines:q,overrideFog:j});const ye=B.material,Ce=ye.pbrMetallicRoughness,Ae=t.paint.get("model-opacity").constantOr(1),ke=t.paint.get("model-emissive-strength").constantOr(0);re=ef(y.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,d,Ae,Ce.baseColorFactor,ye.emissiveFactor,Ce.metallicFactor,Ce.roughnessFactor,ye,ke,t,g),D&&(b.shadowUniformsInitialized?Z.setShadowUniformValues(S,D.getShadowUniformValues()):(D.setupShadows(y.toUnwrapped(),Z,"model-tile"),b.shadowUniformsInitialized=!0)),$=ae.shouldRenderCutoff||Ae<1||ye.alphaMode!=="OPAQUE"?si.alphaBlended:si.unblended}d.uploadCommonUniforms(S,Z,y.toUnwrapped(),null,ae);const pe=B.material.doubleSided?jn.disabled:jn.backCCW;if(h.instancedDataArray.length>20)H.push(h.instancedDataBuffer),Z.draw(d,S.gl.TRIANGLES,O,On.disabled,$,pe,re,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,d.transform.zoom,void 0,H,h.instancedDataArray.length);else{const ye=M?"u_instance":"u_normal_matrix";for(let Ce=0;Ce<h.instancedDataArray.length;++Ce)re[ye]=new Float32Array(h.instancedDataArray.arrayBuffer,64*Ce,16),Z.draw(d,S.gl.TRIANGLES,O,On.disabled,$,pe,re,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,d.transform.zoom,void 0,H)}}if(a.children)for(const B of a.children)oy(d,t,B,h,g,y,b)}const Hx=[1,-1,1];function sy(d,t,a,h){if(!a.modelManager)return!0;const g=a.modelManager;if(!a.shadowRenderer)return!0;const y=a.shadowRenderer,b=t.aabb;let S=!0,M=d.maxHeight;if(M===0){let O=0;for(const j in d.instancesPerModel){const B=g.getModel(j,h);B?O=Math.max(O,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):S=!1}M=d.maxScale*O*1.41+d.maxVerticalOffset,S&&(d.maxHeight=M)}b.max[2]=M,b.min[2]+=d.terrainElevationMin,b.max[2]+=d.terrainElevationMax,r.af(b.min,b.min,t.tileMatrix),r.af(b.max,b.max,t.tileMatrix);const D=b.intersects(y.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=D===2),D===0}function df(d,t){const a=d.uniformValues.u_cutoff_params[0],h=d.uniformValues.u_cutoff_params[1],g=d.uniformValues.u_cutoff_params[2],y=d.uniformValues.u_cutoff_params[3];return h===a||y===g?1:r.aA(((t-a)/(h-a)-g)/(y-g),0,1)}function Sm(d,t,a,h){if(t.pitch<20)return 1;const g=t.getWorldToCameraMatrix();r.aB(g,g,d);const y=r.bU(a.min[0],a.min[1],a.min[2],1);let b=r.aC(r.ex(),y,g),S=b,M=b;y[1]=a.max[1],b=r.aC(r.ex(),y,g),S=b[1]<S[1]?b:S,M=b[1]>M[1]?b:M,y[0]=a.max[0],b=r.aC(r.ex(),y,g),S=b[1]<S[1]?b:S,M=b[1]>M[1]?b:M,y[1]=a.min[1],b=r.aC(r.ex(),y,g),S=b[1]<S[1]?b:S,M=b[1]>M[1]?b:M;const D=r.aA(h[0],0,1),O=100*t.pixelsPerMeter*r.aA(h[1],0,1),j=r.aA(h[2],0,1),B=r.ey(r.ex(),S,M,D),q=Math.tan(.5*t.fovX),H=-B[2]*q;if(O===0)return B[1]<-Math.abs(H)?j:1;const Z=(-Math.abs(H)-B[1])/O,re=(ae,pe,ye)=>(1-ye)*ae+ye*pe,$=r.aA(re(1,j,Z),j,1);return re(1,$,r.aA((t.pitch-20)/20,0,1))}class ay{}class ly{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,a,h){{const j=this._storage.get(a.id);if(j)return j.lastUsedFrameIdx=t,j.buf}const g=h.gl,y=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),b=new ArrayBuffer(y),S=new Int16Array(b);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const M=new r.eA;for(let j=0;j<y/2;j+=3){const B=S[j],q=S[j+1],H=S[j+2];M.emplaceBack(B,q),M.emplaceBack(q,H),M.emplaceBack(H,B)}const D=h.bindVertexArrayOES.current,O=new ay;return O.buf=new Dl(h,M),O.lastUsedFrameIdx=t,this._storage.set(a.id,O),h.bindVertexArrayOES.set(D),O.buf}update(t){for(const[a,h]of this._storage)t-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(a))}destroy(){for(const[t,a]of this._storage)a.buf.destroy(),this._storage.delete(t)}}class ff{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ih=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Tu{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Em{constructor(t,a){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const cy=r.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class Zx{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,a){const h=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const b=new r.eB,S=new r.b1;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(1,1),b.emplaceBack(-1,1),S.emplaceBack(0,1,2),S.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(b,cy.members),this.vignetteIdx=t.context.createIndexBuffer(S)}const g=r.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,h);const b={u_vignetteShape:(y={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};h.draw(t,t.context.gl.TRIANGLES,an.disabled,On.disabled,si.alphaBlended,jn.disabled,b,"vignette",this.vignetteVx,this.vignetteIdx,g)}var y}}class uy{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,a){const h=t.getFreeCameraOptions().position,g=h.toAltitude(),y=h.toLngLat(),b=r.an(y.lng),S=r.an(y.lat),M=t.pixelsPerMeter/a,D=b*r.eD,O=r.eD*Math.log(Math.tan(Math.PI/4+S/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const j=-this._offsetYPrev+O,B=-this._elevationPrev+g;this._accumulatedOffsetX+=(-this._offsetXPrev+D)*M,this._accumulatedOffsetY+=j*M,this._accumulatedElevation+=B*M,this._offsetXPrev=D,this._offsetYPrev=O,this._elevationPrev=g}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function hy(d,t){return[-(d[0]-Math.floor(d[0]/t)*t),-(d[1]-Math.floor(d[1]/t)*t),-(d[2]-Math.floor(d[2]/t)*t)]}function ss(d){const t=r.eo(1323123451230),a=[];for(let h=0;h<d;++h){const g=2*t()-1,y=2*t()-1,b=2*t()-1;a.push(r.d4(g,y,b))}return a}function Nl(d,t,a,h,g){const y=r.aA((g-a)/(h-a),0,1);return(1-y)*d+y*t}class Su{constructor(t){this._movement=new uy,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Zx,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,a){const h=t.transform;this._movement.update(h,this._ppmScaleFactor);const g=h.starsProjMatrix,y=r.c6([]);r.c8(y,y,r.an(90)-h._pitch),r.c7(y,y,-h.angle);const b=r.cb(new Float32Array(16),y),S=r.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),M=r.ed([],S),D=r.aB([],M,b),O=Date.now()/1e3;return this._accumulatedTimeFromStart+=(O-this._prevTime)*a,this._prevTime=O,{projectionMatrix:g,modelviewMatrix:D}}}class br extends Su{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Em(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const h=ss(this.particlesCount),g=new r.eE,y=new r.b1;let b=0;const S=r.eo(1323123451230);for(let M=0;M<h.length;++M){const D=h[M],O=[2*S()-1,S(),S(),S()];g.emplaceBack(D[0],D[1],D[2],-1,-1,...O),g.emplaceBack(D[0],D[1],D[2],1,-1,...O),g.emplaceBack(D[0],D[1],D[2],1,1,...O),g.emplaceBack(D[0],D[1],D[2],-1,1,...O),y.emplaceBack(b+0,b+1,b+2),y.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=a.createVertexBuffer(g,Ih.members),this.particlesIdx=a.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},h=t.transform.zoom;if(a.revealStart>h)return;const g=Nl(0,1,a.revealStart,a.revealStart+a.revealRange,h);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let b=[-y.direction.x,y.direction.y,-100];r.aw(b,b);const S=structuredClone(this._vignetteParams);S.strength*=g,y.overrideStyleParameters||(y.intensity=t.style.rain.state.density,y.timeFactor=t.style.rain.state.intensity,y.color=structuredClone(t.style.rain.state.color),b=structuredClone(t.style.rain.state.direction),y.screenThinning.intensity=t.style.rain.state.centerThinning,y.dropletSizeX=t.style.rain.state.dropletSize[0],y.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],y.distortionStrength=100*t.style.rain.state.distortionStrength,S.strength=1,S.color=structuredClone(t.style.rain.state.vignetteColor));const M=this.updateOnRender(t,y.timeFactor),D=t.context,O=D.gl,j=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(D,{width:t.width,height:t.height,data:null},O.RGBA8)),y.distortionStrength>0&&(D.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),O.copyTexSubImage2D(O.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const B=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(D,B),D.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const q=[y.color.r,y.color.g,y.color.b,y.color.a],H=(Z,re)=>{const $=hy(this._movement.getPosition(),Z),ae=y.dropletSizeX,pe=y.dropletSizeX*y.dropletSizeYScale,ye=t.width/2,Ce=t.height/2,Ae=Nl(0,y.screenThinning.start,0,1,y.screenThinning.intensity),ke=Nl(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),Me=Nl(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),Ee=(ze={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:$,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:Z,rainDropletSize:[ae,pe],distortionStrength:y.distortionStrength,rainDirection:b,color:q,screenSize:[j.width,j.height],thinningCenterPos:[ye,Ce],thinningShape:[Ae,ke,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:Me,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:re?0:1},{u_modelview:Float32Array.from(ze.modelview),u_projection:Float32Array.from(ze.projection),u_time:ze.time,u_cam_pos:ze.camPos,u_texScreen:0,u_velocityConeAperture:ze.velocityConeAperture,u_velocity:ze.velocity,u_boxSize:ze.boxSize,u_rainDropletSize:ze.rainDropletSize,u_distortionStrength:ze.distortionStrength,u_rainDirection:ze.rainDirection,u_color:ze.color,u_screenSize:ze.screenSize,u_thinningCenterPos:ze.thinningCenterPos,u_thinningShape:ze.thinningShape,u_thinningAffectedRatio:ze.thinningAffectedRatio,u_thinningParticleOffset:ze.thinningParticleOffset,u_shapeDirectionalPower:ze.shapeDirectionalPower,u_shapeNormalPower:ze.shapeNormalPower,u_mode:ze.mode});var ze;const ot=Math.round(y.intensity*this.particlesCount),Ze=r.bg.simpleSegment(0,0,4*ot,2*ot);B.draw(t,O.TRIANGLES,an.disabled,On.disabled,si.alphaBlended,jn.disabled,Ee,"rain_particles",this.particlesVx,this.particlesIdx,Ze)};y.distortionStrength>0&&H(y.boxSize,!0),H(y.boxSize,!1),this._vignette.draw(t,S)}}const xi=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class dy extends Su{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Em(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const h=ss(this.particlesCount),g=new r.eF,y=new r.b1;let b=0;const S=r.eo(1323123451230);for(let M=0;M<h.length;++M){const D=h[M],O=S(),j=S(),B=S(),q=[M/h.length,O,j,B],H=[S(),S()];g.emplaceBack(D[0],D[1],D[2],-1,-1,...q,...H),g.emplaceBack(D[0],D[1],D[2],1,-1,...q,...H),g.emplaceBack(D[0],D[1],D[2],1,1,...q,...H),g.emplaceBack(D[0],D[1],D[2],-1,1,...q,...H),y.emplaceBack(b+0,b+1,b+2),y.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=a.createVertexBuffer(g,xi.members),this.particlesIdx=a.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const a=structuredClone(this._params);let h=[-a.direction.x,a.direction.y,-100];r.aw(h,h);const g=structuredClone(this._vignetteParams),y=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=t.transform.zoom;if(y.revealStart>b)return;const S=Nl(0,1,y.revealStart,y.revealStart+y.revealRange,b);g.strength*=S,a.overrideStyleParameters||(a.intensity=t.style.snow.state.density,a.timeFactor=t.style.snow.state.intensity,a.color=structuredClone(t.style.snow.state.color),h=structuredClone(t.style.snow.state.direction),a.screenThinning.intensity=t.style.snow.state.centerThinning,a.billboardSize=2.79*t.style.snow.state.flakeSize,g.strength=1,g.color=structuredClone(t.style.snow.state.vignetteColor));const M=this.updateOnRender(t,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const D=t.context,O=D.gl,j=t.transform,B=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(D,B),((q,H,Z)=>{const re=hy(this._movement.getPosition(),q),$=j.width/2,ae=j.height/2,pe=Nl(0,Z.screenThinning.start,0,1,Z.screenThinning.intensity),ye=Nl(.001,Z.screenThinning.range,0,1,Z.screenThinning.intensity),Ce=Nl(0,Z.screenThinning.particleOffset,0,1,Z.screenThinning.intensity),Ae=(ke={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:re,velocityConeAperture:Z.velocityConeAperture,velocity:Z.velocity,horizontalOscillationRadius:Z.horizontalOscillationRadius,horizontalOscillationRate:Z.horizontalOscillationRate,boxSize:q,billboardSize:1*Z.billboardSize,simpleShapeParameters:[Z.shapeFadeStart,Z.shapeFadePower],screenSize:[j.width,j.height],thinningCenterPos:[$,ae],thinningShape:[pe,ye,Math.pow(10,Z.screenThinning.fadePower)],thinningAffectedRatio:Z.screenThinning.affectedRatio,thinningParticleOffset:Ce,color:[Z.color.r,Z.color.g,Z.color.b,Z.color.a],direction:h},{u_modelview:Float32Array.from(ke.modelview),u_projection:Float32Array.from(ke.projection),u_time:ke.time,u_cam_pos:ke.camPos,u_velocityConeAperture:ke.velocityConeAperture,u_velocity:ke.velocity,u_horizontalOscillationRadius:ke.horizontalOscillationRadius,u_horizontalOscillationRate:ke.horizontalOscillationRate,u_boxSize:ke.boxSize,u_billboardSize:ke.billboardSize,u_simpleShapeParameters:ke.simpleShapeParameters,u_screenSize:ke.screenSize,u_thinningCenterPos:ke.thinningCenterPos,u_thinningShape:ke.thinningShape,u_thinningAffectedRatio:ke.thinningAffectedRatio,u_thinningParticleOffset:ke.thinningParticleOffset,u_particleColor:ke.color,u_direction:ke.direction});var ke;const Me=Math.round(Z.intensity*this.particlesCount),Ee=r.bg.simpleSegment(0,0,4*Me,2*Me);this.particlesVx&&this.particlesIdx&&B.draw(t,O.TRIANGLES,an.disabled,On.disabled,si.alphaBlended,jn.disabled,Ae,"snow_particles",this.particlesVx,this.particlesIdx,Ee)})(a.boxSize,0,a),this._vignette.draw(t,g)}}const Vl={symbol:function(d,t,a,h,g){if(d.renderPass!=="translucent")return;const y=On.disabled,b=d.colorModeForRenderPass(),S=a.layout.get("text-variable-anchor"),M=a.layout.get("text-size-scale-range"),D=r.aA(d.scaleFactor,M[0],M[1]);S&&(function(B,q,H,Z,re,$,ae,pe){const ye=q.transform,Ce=re==="map",Ae=$==="map";for(const ke of B){const Me=Z.getTile(ke),Ee=Me.getBucket(H);if(!Ee||!Ee.text||!Ee.text.segments.get().length)continue;const ze=r.bK(Ee.textSizeData,ye.zoom,pe),ot=lc(ke,Ee.getProjection(),ye),Ze=ye.calculatePixelsToTileUnitsMatrix(Me),mt=ga(ot,Me.tileID.canonical,Ae,Ce,ye,Ee.getProjection(),Ze),$e=Ee.hasIconTextFit()&&Ee.hasIconData();ze&&rf(Ee,Ce,Ae,ae,ye,mt,ke,Math.pow(2,ye.zoom-Me.tileID.overscaledZ),ze,$e)}})(h,d,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g,D);const O=a.paint.get("icon-opacity").constantOr(1)!==0,j=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(O||j)?Eh(d,t,a,h,y,b):(O&&Eh(d,t,a,h,y,b,{onlyIcons:!0}),j&&Eh(d,t,a,h,y,b,{onlyText:!0})),t.map.showCollisionBoxes&&(Sh(d,t,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Sh(d,t,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,a,h){if(d.renderPass!=="translucent")return;const g=a.paint.get("circle-opacity"),y=a.paint.get("circle-stroke-width"),b=a.paint.get("circle-stroke-opacity"),S=a.layout.get("circle-sort-key").constantOr(1)!==void 0,M=a.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const D=d.context,O=D.gl,j=d.transform,B=!(!d.terrain||!d.terrain.enabled),q=a.layout.get("circle-elevation-reference"),H=d.depthModeForSublayer(0,an.ReadOnly),Z=new an(d.context.gl.LEQUAL,an.ReadOnly,d.depthRangeFor3D),re=q==="none"||B?H:Z,$=On.disabled,ae=d.colorModeForDrapableLayerRenderPass(M),pe=j.projection.name==="globe",ye=[r.aF(j.center.lng),r.aJ(j.center.lat)],Ce=[];for(let ke=0;ke<h.length;ke++){const Me=h[ke],Ee=t.getTile(Me),ze=Ee.getBucket(a);if(!ze||ze.projection.name!==j.projection.name)continue;const ot=ze.programConfigurations.get(a.id),Ze=ze.layoutVertexBuffer,mt=ze.globeExtVertexBuffer,$e=ze.indexBuffer,pt=r.dZ(a),Ht=[mt],rt=d.isTileAffectedByFog(Me);pe&&pt.push("PROJECTION_GLOBE_VIEW"),pt.push("DEPTH_D24"),d.terrain&&j.depthOcclusionForSymbolsAndCircles&&pt.push("DEPTH_OCCLUSION"),ze.hasElevation&&!d.terrain&&(pt.push("ELEVATED_ROADS"),Ht.push(ze.elevatedLayoutVertexBuffer));const Ue=d.getOrCreateProgram("circle",{config:ot,defines:pt,overrideFog:rt}),xt=j.projection.createInversionMatrix(j,Me.canonical),ct={programConfiguration:ot,program:Ue,layoutVertexBuffer:Ze,dynamicBuffers:Ht,indexBuffer:$e,uniformValues:r.d_(d,Me,Ee,xt,ye,a),tile:Ee};if(S){const Ct=ze.segments.get();for(const qt of Ct)Ce.push({segments:new r.bg([qt]),sortKey:qt.sortKey,state:ct})}else Ce.push({segments:ze.segments,sortKey:0,state:ct})}S&&Ce.sort(((ke,Me)=>ke.sortKey-Me.sortKey));const Ae={useDepthForOcclusion:j.depthOcclusionForSymbolsAndCircles};for(const ke of Ce){const{programConfiguration:Me,program:Ee,layoutVertexBuffer:ze,dynamicBuffers:ot,indexBuffer:Ze,uniformValues:mt,tile:$e}=ke.state,pt=ke.segments;d.terrain&&d.terrain.setupElevationDraw($e,Ee,Ae),d.uploadCommonUniforms(D,Ee,$e.tileID.toUnwrapped()),Ee.draw(d,O.TRIANGLES,re,$,ae,jn.disabled,mt,a.id,ze,Ze,pt,a.paint,j.zoom,Me,ot)}},heatmap:function(d,t,a,h){if(a.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const g=d.context,y=g.gl,b=On.disabled,S=new si([y.ONE,y.ONE,y.ONE,y.ONE],r.ao.transparent,[!0,!0,!0,!0]);(function(q,H,Z,re){const $=q.gl,ae=H.width*re,pe=H.height*re;q.activeTexture.set($.TEXTURE1),q.viewport.set([0,0,ae,pe]);let ye=Z.heatmapFbo;if(!ye||ye&&(ye.width!==ae||ye.height!==pe)){ye&&ye.destroy();const Ce=$.createTexture();$.bindTexture($.TEXTURE_2D,Ce),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),ye=Z.heatmapFbo=q.createFramebuffer(ae,pe,!0,null),(function(Ae,ke,Me,Ee,ze,ot){const Ze=Ae.gl;Ze.texImage2D(Ze.TEXTURE_2D,0,Ae.extRenderToTextureHalfFloat?Ze.RGBA16F:Ze.RGBA,ze,ot,0,Ze.RGBA,Ae.extRenderToTextureHalfFloat?Ze.HALF_FLOAT:Ze.UNSIGNED_BYTE,null),Ee.colorAttachment.set(Me)})(q,0,Ce,ye,ae,pe)}else $.bindTexture($.TEXTURE_2D,ye.colorAttachment.get()),q.bindFramebuffer.set(ye.framebuffer)})(g,d,a,d.transform.projection.name==="globe"?.5:.25),g.clear({color:r.ao.transparent});const M=d.transform,D=M.projection.name==="globe",O=D?["PROJECTION_GLOBE_VIEW"]:[],j=D?jn.frontCCW:jn.disabled,B=[r.aF(M.center.lng),r.aJ(M.center.lat)];for(let q=0;q<h.length;q++){const H=h[q];if(t.hasRenderableParent(H))continue;const Z=t.getTile(H),re=Z.getBucket(a);if(!re||re.projection.name!==M.projection.name)continue;const $=d.isTileAffectedByFog(H),ae=re.programConfigurations.get(a.id),pe=d.getOrCreateProgram("heatmap",{config:ae,defines:O,overrideFog:$}),{zoom:ye}=d.transform;d.terrain&&d.terrain.setupElevationDraw(Z,pe),d.uploadCommonUniforms(g,pe,H.toUnwrapped());const Ce=M.projection.createInversionMatrix(M,H.canonical);pe.draw(d,y.TRIANGLES,an.disabled,b,S,j,J_(d,H,Z,Ce,B,ye,a.paint.get("heatmap-intensity")),a.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,a.paint,d.transform.zoom,ae,D?[re.globeExtVertexBuffer]:null)}g.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),(function(g,y){const b=g.context,S=b.gl,M=y.heatmapFbo;if(!M)return;b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,M.colorAttachment.get()),b.activeTexture.set(S.TEXTURE1);let D=y.colorRampTexture;D||(D=y.colorRampTexture=new r.T(b,y.colorRamp,S.RGBA8)),D.bind(S.LINEAR,S.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,S.TRIANGLES,an.disabled,On.disabled,g.colorModeForRenderPass(),jn.disabled,((O,j,B,q)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,y),y.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,y.paint,g.transform.zoom)})(d,a))},line:function(d,t,a,h){if(d.renderPass!=="translucent")return;const g=a.paint.get("line-opacity"),y=a.paint.get("line-width");if(g.constantOr(1)===0||y.constantOr(1)===0)return;const b=a.paint.get("line-emissive-strength"),S=a.paint.get("line-occlusion-opacity"),M=a.layout.get("line-elevation-reference"),D=a.layout.get("line-width-unit")==="meters",O=M==="sea",j=!(!d.terrain||!d.terrain.enabled),B=d.context,q=B.gl;if(a.hasElevatedBuckets&&d.transform.projection.name==="globe")return;const H=a.layout.get("line-cross-slope"),Z=H!==void 0,re=H<1,$=d.colorModeForDrapableLayerRenderPass(b),ae=d.terrain&&d.terrain.renderingToTexture,pe=ae?1:r.o.devicePixelRatio,ye=a.paint.get("line-dasharray"),Ce=ye.constantOr(1),Ae=a.layout.get("line-cap"),ke=ye.constantOr(null),Me=Ae.constantOr(null),Ee=a.paint.get("line-pattern"),ze=Ee.constantOr(1),ot=a.paint.get("line-pattern-cross-fade"),Ze=Ee.constantOr(null),mt=a.paint.get("line-opacity").constantOr(1);let $e=!ze&&mt!==1||d.depthOcclusion&&S>0&&S<1;const pt=a.paint.get("line-gradient"),Ht=ze?"linePattern":"line",rt=r.d$(a);let Ue;if(ae&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&($e=!1),S!==0&&d.depthOcclusion){const qt=a.paint._values["line-opacity"];qt&&qt.value&&qt.value.kind==="constant"?Ue=qt.value:r.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&rt.push("VARIABLE_LINE_WIDTH");const xt=(qt,nn,Vt,Ot,vn,gn)=>{for(const yn of qt){const mn=t.getTile(yn);if(ze&&!mn.patternsLoaded())continue;const qn=mn.getBucket(a);if(!qn||qn.elevationType!=="none"&&!vn||qn.elevationType==="none"&&vn)continue;d.prepareDrawTile();const ii=[...nn],ai=d.shadowRenderer,Xi=qn.elevationType==="road"&&!!ai&&ai.enabled;let Jn=[0,0,0];if(Xi){const li=d.style.directionalLight,Fn=d.style.ambientLight;li&&Fn&&(Jn=va(d.style,li,Fn)),ii.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Pi=qn.programConfigurations.get(a.id);let ji=!1;if(Ze&&mn.imageAtlas){const li=r.e0.from(Ze),Fn=li.getPrimary().scaleSelf(pe).toString(),Yi=mn.imageAtlas.patternPositions.get(Fn),jr=li.getSecondary(),Dr=jr?mn.imageAtlas.patternPositions.get(jr.scaleSelf(pe).toString()):null;ji=!!Yi&&!!Dr,Yi&&Pi.setConstantPatternPositions(Yi,Dr)}ot>0&&(ji||Pi.getPatternTransitionVertexBuffer("line-pattern"))&&ii.push("LINE_PATTERN_TRANSITION");const wr=d.isTileAffectedByFog(yn),ri=d.getOrCreateProgram(Ht,{config:Pi,defines:ii,overrideFog:wr});if(!ze&&ke&&Me&&mn.lineAtlas){const li=mn.lineAtlas.getDash(ke,Me);li&&Pi.setConstantPatternPositions(li)}Xi&&ai.setupShadows(mn.tileID.toUnwrapped(),ri,"vector-tile");let[Fi,Di]=a.paint.get("line-trim-offset");(Me==="round"||Me==="square")&&Fi!==Di&&(Fi===0&&(Fi-=1),Di===1&&(Di+=1));const Ni=ae?yn.projMatrix:null,Ar=D?1/qn.tileToMeter/r.ay(mn,1,d.transform.zoom):1,Yr=D?1/qn.tileToMeter/r.ay(mn,1,Math.floor(d.transform.zoom)):1,Ro=ze?r.e1(d,mn,a,Ni,pe,Ar,Yr,[Fi,Di],Jn,ot):r.e2(d,mn,a,Ni,qn.lineClipsArray.length,pe,Ar,Yr,[Fi,Di],Jn);if(pt){const li=qn.gradients[a.id];let Fn=li.texture;if(a.gradientVersion!==li.version){let Yi=256;if(a.stepInterpolant){const jr=t.getSource().maxzoom,Dr=yn.canonical.z===jr?Math.ceil(1<<d.transform.maxZoom-yn.canonical.z):1;Yi=r.aA(r.e3(qn.maxLineLength/r.al*1024*Dr),256,B.maxTextureSize)}li.gradient=r.e4({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Yi,image:li.gradient||void 0,clips:qn.lineClipsArray}),li.texture?li.texture.update(li.gradient):li.texture=new r.T(B,li.gradient,q.RGBA8),li.version=a.gradientVersion,Fn=li.texture}B.activeTexture.set(q.TEXTURE1),Fn.bind(a.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}Ce&&(B.activeTexture.set(q.TEXTURE0),mn.lineAtlasTexture&&mn.lineAtlasTexture.bind(q.LINEAR,q.REPEAT),Pi.updatePaintBuffers()),ze&&(B.activeTexture.set(q.TEXTURE0),mn.imageAtlasTexture&&mn.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Pi.updatePaintBuffers()),vn&&!O&&d.terrain.setupElevationDraw(mn,ri),d.uploadCommonUniforms(B,ri,yn.toUnwrapped());const Ir=li=>{Ue!=null&&(Ue.value=mt*S),ri.draw(d,q.TRIANGLES,Vt,li,$,jn.disabled,Ro,a.id,qn.layoutVertexBuffer,qn.indexBuffer,qn.segments,a.paint,d.transform.zoom,Pi,[qn.layoutVertexBuffer2,qn.patternVertexBuffer,qn.zOffsetVertexBuffer]),Ue!=null&&(Ue.value=mt)};if($e&&!vn){const li=d.stencilModeForClipping(yn).ref;li===0&&ae&&B.clear({stencil:0});const Fn={func:q.EQUAL,mask:255};Ro.u_alpha_discard_threshold=.8,Ir(new On(Fn,li,255,q.KEEP,q.KEEP,q.INVERT)),Ro.u_alpha_discard_threshold=0,Ir(new On(Fn,li,255,q.KEEP,q.KEEP,q.KEEP))}else Ro.u_alpha_discard_threshold=$e&&vn&&gn?.8:0,Ir(vn?Ot:d.stencilModeForClipping(yn))}};let ct=d.depthModeForSublayer(0,an.ReadOnly);const Ct=new an(d.depthOcclusion?q.GREATER:q.LEQUAL,an.ReadOnly,d.depthRangeFor3D);if(a.hasNonElevatedBuckets){const qt=!ae&&d.terrain;S!==0&&qt?r.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):qt?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):xt(h,rt,ct,On.disabled,!1,!0)}if(a.hasElevatedBuckets){M==="hd-road-markup"?j||(ct=Ct,rt.push("ELEVATED_ROADS")):(rt.push("ELEVATED"),ct=Ct,Z&&rt.push(re?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),O&&rt.push("ELEVATION_REFERENCE_SEA"));const qt=$e?d.stencilModeFor3D():On.disabled;d.forceTerrainMode=!0,xt(h,rt,ct,qt,!0,!0),$e&&xt(h,rt,ct,qt,!0,!1),d.forceTerrainMode=!1}$e&&(d.resetStencilClippingMasks(),ae&&B.clear({stencil:0})),S===0||d.depthOcclusion||ae||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,t,a,h){const g=a.paint.get("fill-color"),y=a.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=a.paint.get("fill-emissive-strength"),S=d.colorModeForDrapableLayerRenderPass(b),M=a.paint.get("fill-pattern"),D=d.opaquePassEnabledForLayer()&&!M.constantOr(1)&&g.constantOr(r.ao.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";let O="none";a.layout.get("fill-elevation-reference")!=="none"?O="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(O="offset");const j=!(!d.terrain||!d.terrain.enabled),B={painter:d,sourceCache:t,layer:a,coords:h,colorMode:S,elevationType:O,terrainEnabled:j,pass:D};if(d.renderPass!=="shadow")if(O!=="offset"){if(xu(B,!1),O==="road"){const q=!j&&d.renderPass==="translucent";q&&xc(d,t,a,h,"geometry"),xu(B,!0,On.disabled),q&&(function(H){const{painter:Z,sourceCache:re,layer:$,coords:ae,colorMode:pe}=H,ye=Z.context.gl,Ce=H.painter.shadowRenderer,Ae=!!Ce&&Ce.enabled,ke=new an(Z.context.gl.LEQUAL,an.ReadOnly,Z.depthRangeFor3D);let Me=[0,0,0];if(Ae){const ze=Z.style.directionalLight,ot=Z.style.ambientLight;ze&&ot&&(Me=va(Z.style,ze,ot))}const Ee=ze=>{for(const ot of ae){const Ze=re.getTile(ot),mt=Ze.getBucket($);if(!mt)continue;const $e=mt.elevatedStructures;if(!$e)continue;let pt,Ht;if(ze?(pt=$e.renderableBridgeSegments,Ht=$e.bridgeProgramConfigurations.get($.id)):(pt=$e.renderableTunnelSegments,Ht=$e.tunnelProgramConfigurations.get($.id)),!pt||pt.segments[0].primitiveLength===0)continue;Ht.updatePaintBuffers(),Z.prepareDrawTile();const rt=Z.isTileAffectedByFog(ot),Ue=[];Ae&&Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const xt=Z.getOrCreateProgram("elevatedStructures",{config:Ht,overrideFog:rt,defines:Ue}),ct=Z.translatePosMatrix(ot.projMatrix,Ze,$.paint.get("fill-translate"),$.paint.get("fill-translate-anchor"));Ae&&Ce.setupShadows(Ze.tileID.toUnwrapped(),xt,"vector-tile");const Ct=Bx(ct,Me);Z.uploadCommonUniforms(Z.context,xt,ot.toUnwrapped()),xt.draw(Z,ye.TRIANGLES,ke,On.disabled,pe,jn.backCCW,Ct,$.id,$e.vertexBuffer,$e.indexBuffer,pt,$.paint,Z.transform.zoom,Ht,[$e.vertexBufferNormal])}};Ee(!0),Ee(!1)})(B)}}else xu(B,!1,d.stencilModeFor3D());else d.shadowRenderer&&O==="road"&&!j&&(function(q){const{painter:H,sourceCache:Z,layer:re,coords:$}=q,ae=H.context.gl,pe=q.painter.shadowRenderer;for(const ye of $){const Ce=Z.getTile(ye),Ae=Ce.getBucket(re);if(!Ae)continue;const ke=Ae.elevatedStructures;if(!ke||!ke.shadowCasterSegments||ke.shadowCasterSegments.segments[0].primitiveLength===0)continue;H.prepareDrawTile();const Me=Ae.bufferData.programConfigurations.get(re.id),Ee=H.isTileAffectedByFog(ye),ze=H.getOrCreateProgram("elevatedStructuresDepth",{config:Me,overrideFog:Ee}),ot=pe.calculateShadowPassMatrixFromTile(Ce.tileID.toUnwrapped());H.uploadCommonUniforms(H.context,ze,ye.toUnwrapped());const Ze={u_matrix:ot,u_depth_bias:0};ze.draw(H,ae.TRIANGLES,pe.getShadowPassDepthMode(),On.disabled,pe.getShadowPassColorMode(),jn.disabled,Ze,re.id,ke.vertexBuffer,ke.indexBuffer,ke.shadowCasterSegments,re.paint,H.transform.zoom,Me)}})(B)},"fill-extrusion":function(d,t,a,h){const g=a.paint.get("fill-extrusion-opacity"),y=d.context,b=y.gl,S=d.terrain,M=S&&S.renderingToTexture;if(g===0)return;const D=d.conflationActive&&d.style.isLayerClipped(a,t.getSource()),O=d.style.order.indexOf(a.fqid);if(D&&(function(j,B,q,H,Z){for(const re of H){const $=B.getTile(re).getBucket(q);$&&($.updateReplacement(re,j.replacementSource,Z),$.uploadCentroid(j.context))}})(d,t,a,h,O),S||D)for(const j of h){const B=t.getTile(j).getBucket(a);B&&Ol(d.context,t,j,B,a,S,D)}if(d.renderPass==="shadow"&&d.shadowRenderer){const j=d.shadowRenderer;if(S&&g<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ad)return;const B=j.getShadowPassDepthMode(),q=j.getShadowPassColorMode();ln(d,t,a,h,B,On.disabled,q,D)}else if(d.renderPass==="translucent"){const j=!a.paint.get("fill-extrusion-pattern").constantOr(1),B=a.paint.get("fill-extrusion-color").constantOr(r.ao.white);if(!M&&B.a!==0){const q=new an(d.context.gl.LEQUAL,an.ReadWrite,d.depthRangeFor3D);g===1&&j?ln(d,t,a,h,q,On.disabled,si.unblended,D):(ln(d,t,a,h,q,On.disabled,si.disabled,D),ln(d,t,a,h,q,d.stencilModeFor3D(),d.colorModeForRenderPass(),D),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&j&&(!S&&d.transform.projection.name!=="globe"||M)){const q=a.paint.get("fill-extrusion-opacity"),H=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),re=a.paint.get("fill-extrusion-flood-light-intensity"),$=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ae=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor($?null:a.lut).toArray01().slice(0,3),pe=H>0&&Z>0,ye=re>0,Ce=(Me,Ee,ze)=>(1-ze)*Me+ze*Ee,Ae=new _m;Ae.translate=a.paint.get("fill-extrusion-translate"),Ae.translateAnchor=a.paint.get("fill-extrusion-translate-anchor"),Ae.edgeRadius=a.layout.get("fill-extrusion-edge-radius"),Ae.cutoffFadeRange=a.paint.get("fill-extrusion-cutoff-fade-range");const ke=Me=>{const Ee=d.depthModeForSublayer(1,an.ReadOnly,b.LEQUAL,!0),ze=a.paint.get(Me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ot=Ce(.1,3,ze),Ze=d._showOverdrawInspector;if(!Ze){const mt=new On({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),$e=new si([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!1,!1,!1,!0],b.MIN);Qa(Ae,d,t,a,h,Ee,mt,$e,jn.disabled,Me,"sdf",q,H,Z,re,ae,ot,D,!1)}{const mt=Ze?On.disabled:new On({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),$e=Ze?d.colorModeForRenderPass():new si([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],r.ao.transparent,[!0,!0,!0,!0]);Qa(Ae,d,t,a,h,Ee,mt,$e,jn.disabled,Me,"color",q,H,Z,re,ae,ot,D,!1)}};if(M){const Me=(Ee,ze,ot)=>{const Ze=d.depthModeForSublayer(1,an.ReadOnly,b.LEQUAL,!1),mt=a.paint.get(Ee?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),$e=Ce(.1,3,mt);{const pt=new si([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!1,!1,!1,!0]);Qa(Ae,d,t,a,h,Ze,On.disabled,pt,jn.disabled,Ee,"clear",q,H,Z,re,ae,$e,D,ze)}{const pt=new On({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ht=new si([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!1,!1,!1,!0],b.MIN);Qa(Ae,d,t,a,h,Ze,pt,Ht,jn.disabled,Ee,"sdf",q,H,Z,re,ae,$e,D,ze)}{const pt=Ee?b.ZERO:b.ONE_MINUS_DST_ALPHA,Ht=new On({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),rt=new si([pt,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],r.ao.transparent,[!0,!0,!0,!0]);Qa(Ae,d,t,a,h,Ze,Ht,rt,jn.disabled,Ee,"color",q,H,Z,re,ae,$e,D,ze)}{const pt=new si([b.ONE,b.ONE,b.ONE,Ee?b.ZERO:b.ONE],r.ao.transparent,[!1,!1,!1,!0],Ee?b.FUNC_ADD:b.MAX);Qa(Ae,d,t,a,h,Ze,On.disabled,pt,jn.disabled,Ee,"clear",q,H,Z,re,ae,$e,D,ze,ot)}};if(pe||ye){let Ee;if(d.prepareDrawTile(),S){const ze=S.drapeBufferSize[0],ot=S.drapeBufferSize[1];Ee=S.framebufferCopyTexture,Ee&&(!Ee||Ee.size[0]===ze&&Ee.size[1]===ot)||(Ee&&Ee.destroy(),Ee=S.framebufferCopyTexture=new r.T(y,new r.q({width:ze,height:ot}),b.RGBA8)),Ee.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,ze,ot)}pe&&Me(!0,!1,Ee),ye&&Me(!1,!0,Ee)}}else pe&&ke(!0),ye&&ke(!1),(pe||ye)&&d.resetStencilClippingMasks()}}},building:function(d,t,a,h){d.currentLayer<d.firstLightBeamLayer&&(d.firstLightBeamLayer=d.currentLayer);const g=a.paint.get("building-ambient-occlusion-ground-intensity"),y=a.paint.get("building-ambient-occlusion-ground-radius"),b=a.paint.get("building-ambient-occlusion-ground-attenuation"),S=a.paint.get("building-opacity");if(S<=0)return;let M=g>0&&y>0,D=!0;const O=a.paint.get("building-vertical-scale");(!d.shadowRenderer||O<1)&&(D=!1);const j=d.conflationActive&&d.style.isLayerClipped(a,t.getSource()),B=d.style.order.indexOf(a.fqid);if((function(q,H,Z,re,$,ae){for(const pe of ae){const ye=H.getTile(pe).getBucket(Z);ye&&($&&ye.updateReplacement(pe,q.replacementSource,re),ye.uploadUpdatedIndexBuffer(q.context))}})(d,t,a,B,j,h),(function(q,H,Z,re){for(const $ of re){const ae=H.getTile($).getBucket(Z);ae&&ae.needsEvaluation()&&ae.uploadUpdatedColorBuffer(q.context)}})(d,t,a,h),a.resetLayerRenderingStats(d),d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0),d.renderPass==="shadow"&&d.shadowRenderer){const q=d.shadowRenderer,H=[],Z=q.getShadowPassDepthMode();sf({painter:d,source:t,layer:a,coords:h,defines:H,blendMode:q.getShadowPassColorMode(),depthMode:Z,opacity:S,verticalScale:O,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(d.renderPass==="translucent"){let q=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];D&&(q=q.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),d.shadowRenderer&&d.shadowRenderer.useNormalOffset&&(q=q.concat("NORMAL_OFFSET"));const H=a.paint.get("building-facade-emissive-chance"),Z=a.paint.get("building-ambient-occlusion-intensity"),re=new an(d.context.gl.LEQUAL,an.ReadWrite,d.depthRangeFor3D);S<1&&sf({painter:d,source:t,layer:a,coords:h,defines:q,blendMode:si.disabled,depthMode:re,opacity:S,verticalScale:O,facadeEmissiveChance:H,facadeAOIntensity:Z});const $=d.colorModeForRenderPass();sf({painter:d,source:t,layer:a,coords:h,defines:q,blendMode:$,depthMode:re,opacity:S,verticalScale:O,facadeEmissiveChance:H,facadeAOIntensity:Z}),M&&(function(ae,pe,ye,Ce,Ae,ke,Me,Ee,ze,ot,Ze,mt,$e){const pt=ae.context.gl,Ht=ae.depthModeForSublayer(1,an.ReadOnly,pt.LEQUAL,!0),rt=.1*(1-(Ue=Ze))+3*Ue;var Ue;const xt=ae._showOverdrawInspector,ct=mt,Ct=new _m;xt||Qa(Ct,ae,pe,ye,Ce,Ht,new On({func:pt.ALWAYS,mask:255},255,255,pt.KEEP,pt.KEEP,pt.REPLACE),new si([pt.ONE,pt.ONE,pt.ONE,pt.ONE],r.ao.transparent,[!1,!1,!1,!0],pt.MIN),jn.disabled,Ae,"sdf",ke,Me,Ee,0,ot,rt,ct,!1);{const qt=xt?On.disabled:new On({func:pt.EQUAL,mask:255},255,255,pt.KEEP,pt.DECR,pt.DECR),nn=xt?ae.colorModeForRenderPass():new si([pt.ONE_MINUS_DST_ALPHA,pt.DST_ALPHA,pt.ONE,pt.ONE],r.ao.transparent,[!0,!0,!0,!0]);Qa(Ct,ae,pe,ye,Ce,Ht,qt,nn,jn.disabled,Ae,"color",ke,Me,Ee,0,ot,rt,ct,!1)}})(d,t,a,h,!0,S,g,y,0,[0,0,0],b,j)}else if(d.renderPass==="light-beam"){const q=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],H=new an(d.context.gl.LEQUAL,an.ReadOnly,d.depthRangeFor3D);sf({painter:d,source:t,layer:a,coords:h,defines:q,blendMode:si.alphaBlended,depthMode:H,opacity:S,verticalScale:O,facadeEmissiveChance:0,facadeAOIntensity:0})}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1),d.resetStencilClippingMasks()},hillshade:function(d,t,a,h){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const g=d.context,y=d.terrain&&d.terrain.renderingToTexture,[b,S]=d.renderPass!=="translucent"||y?[{},h]:d.stencilConfigForOverlap(h);for(const M of S){const D=t.getTile(M);if(D.needsHillshadePrepare&&d.renderPass==="offscreen")Ax(d,D,a);else if(d.renderPass==="translucent"){const O=d.depthModeForSublayer(0,an.ReadOnly),j=a.paint.get("hillshade-emissive-strength"),B=d.colorModeForDrapableLayerRenderPass(j),q=y&&d.terrain?d.terrain.stencilModeForRTTOverlap(M):b[M.overscaledZ];Ex(d,M,D,a,O,q,B)}}g.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,t,a,h,g,y){if(d.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const b=d.transform.projection.name==="globe",S=a.paint.get("raster-elevation")!==0,M=S&&b;if(d.renderElevatedRasterBackface&&!M)return;const D=d.context,O=D.gl,j=t.getSource(),B=(function(Ae,ke,Me,Ee){const ze=ke.paint.get("raster-color"),ot=Ae.type==="raster-array",Ze=[],mt=ke.paint.get("raster-resampling"),$e=ke.paint.get("raster-color-mix");let pt=ke.paint.get("raster-color-range");const Ht=[$e[0],$e[1],$e[2],0],rt=$e[3];let Ue=mt==="nearest"?Ee.NEAREST:Ee.LINEAR;if(ot&&(Ze.push("RASTER_ARRAY"),ze||Ze.push("RASTER_COLOR"),mt==="linear"&&Ze.push("RASTER_ARRAY_LINEAR"),Ue=Ee.NEAREST,!pt&&Ae.rasterLayers)){const xt=Ae.rasterLayers.find((({id:ct})=>ct===ke.sourceLayer));xt&&xt.fields&&xt.fields.range&&(pt=xt.fields.range)}if(pt=pt||[0,1],ze){Ze.push("RASTER_COLOR"),Me.activeTexture.set(Ee.TEXTURE2),ke.updateColorRamp(pt);let xt=ke.colorRampTexture;xt||(xt=ke.colorRampTexture=new r.T(Me,ke.colorRamp,Ee.RGBA8)),xt.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}return{mix:Ht,range:pt,offset:rt,defines:Ze,resampling:Ue}})(j,a,D,O);if(j instanceof r.aS&&!h.length&&!b)return;const q=a.paint.get("raster-emissive-strength"),H=d.colorModeForDrapableLayerRenderPass(q),Z=d.terrain&&d.terrain.renderingToTexture,re=!d.options.moving,$=a.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;if(j instanceof r.aS&&!h.length&&(j.onNorthPole||j.onSouthPole)){const Ae=S?d.stencilModeFor3D():On.disabled;return void lf(!!j.onNorthPole,null,d,t,a,q,B,jn.disabled,Ae)}if(!h.length)return;const[ae,pe]=j instanceof r.aS||Z?[{},h]:d.stencilConfigForOverlap(h),ye=pe[pe.length-1].overscaledZ;M&&B.defines.push("PROJECTION_GLOBE_VIEW"),S&&B.defines.push("RENDER_CUTOFF");const Ce=(Ae,ke,Me)=>{for(const Ee of Ae){const ze=Ee.toUnwrapped(),ot=t.getTile(Ee);if(Z&&(!ot||!ot.hasData()))continue;D.activeTexture.set(O.TEXTURE0);const Ze=ty(ot,j,a,B);if(!Ze||!Ze.texture)continue;const{texture:mt,mix:$e,offset:pt,tileSize:Ht,buffer:rt}=Ze;let Ue,xt;Z?(Ue=an.disabled,xt=Ee.projMatrix):S?(Ue=new an(O.LEQUAL,an.ReadWrite,d.depthRangeFor3D),xt=b?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(ze,re)):(Ue=d.depthModeForSublayer(Ee.overscaledZ-ye,a.paint.get("raster-opacity")===1?an.ReadWrite:an.ReadOnly,O.LESS),xt=d.transform.calculateProjMatrix(ze,re));const ct=d.terrain&&Z?d.terrain.stencilModeForRTTOverlap(Ee):ae[Ee.overscaledZ],Ct=y?0:a.paint.get("raster-fade-duration");ot.registerFadeDuration(Ct);const qt=t.findLoadedParent(Ee,0),nn=gc(ot,qt,t,d.transform,Ct);let Vt,Ot;!nn.isFading&&ot.refreshedUponExpiration&&(ot.refreshedUponExpiration=!1),d.terrain&&d.terrain.prepareDrawTile(),D.activeTexture.set(O.TEXTURE0),mt.bind($,O.CLAMP_TO_EDGE),D.activeTexture.set(O.TEXTURE1),qt?(qt.texture&&qt.texture.bind($,O.CLAMP_TO_EDGE),Vt=Math.pow(2,qt.tileID.overscaledZ-ot.tileID.overscaledZ),Ot=[ot.tileID.canonical.x*Vt%1,ot.tileID.canonical.y*Vt%1]):mt.bind($,O.CLAMP_TO_EDGE),"useMipmap"in mt&&D.extTextureFilterAnisotropic&&d.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const vn=d.transform;let gn;const yn=S?Gx(vn):[0,0,0,0];let mn,qn,ii,ai,Xi,Jn=0;if(M&&j instanceof r.aS&&j.coordinates.length>3)mn=Float32Array.from(r.bk(r.dF(new r.cC(0,0,0)))),qn=Float32Array.from(vn.globeMatrix),ii=Float32Array.from(r.dB(vn)),ai=[r.aF(vn.center.lng),r.aJ(vn.center.lat)],gn=j.elevatedGlobePerspectiveTransform,Xi=j.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){const ri=r.dC(Ee.canonical);Jn=r.dD(ri.getCenter().lat),mn=Float32Array.from(r.bk(r.dF(Ee.canonical))),qn=Float32Array.from(vn.globeMatrix),ii=Float32Array.from(r.dB(vn)),ai=[r.aF(vn.center.lng),r.aJ(vn.center.lat)],gn=[0,0],Xi=Float32Array.from(r.dE(Ee.canonical,ri,Jn,vn.worldSize/vn._pixelsPerMercatorPixel))}else gn=j instanceof r.aS?j.perspectiveTransform:[0,0],mn=new Float32Array(16),qn=new Float32Array(9),ii=new Float32Array(16),ai=[0,0],Xi=new Float32Array(9);const Pi=Kd(xt,mn,qn,ii,Xi,Ot||[0,0],r.aj(d.transform.zoom),ai,yn,Vt||1,nn,a,gn,S?a.paint.get("raster-elevation"):0,2,$e,pt,B.range,Ht,rt,q),ji=d.isTileAffectedByFog(Ee),wr=d.getOrCreateProgram("raster",{defines:B.defines,overrideFog:ji});if(d.uploadCommonUniforms(D,wr,ze),j instanceof r.aS){const ri=j.elevatedGlobeVertexBuffer,Fi=j.elevatedGlobeIndexBuffer;if(Z||!b)j.boundsBuffer&&j.boundsSegments&&wr.draw(d,O.TRIANGLES,Ue,On.disabled,H,jn.disabled,Pi,a.id,j.boundsBuffer,d.quadTriangleIndexBuffer,j.boundsSegments);else if(ri&&Fi){const Di=vn.zoom<=r.cZ?j.elevatedGlobeSegments:j.getSegmentsForLongitude(vn.center.lng);Di&&wr.draw(d,O.TRIANGLES,Ue,On.disabled,H,ke,Pi,a.id,ri,Fi,Di)}}else if(M){Ue=new an(O.LEQUAL,an.ReadOnly,d.depthRangeFor3D);const ri=d.globeSharedBuffers;if(ri){const[Fi,Di,Ni]=ri.getGridBuffers(Jn,!1);wr.draw(d,O.TRIANGLES,Ue,Me||ct,d.colorModeForRenderPass(),ke,Pi,a.id,Fi,Di,Ni)}}else{const{tileBoundsBuffer:ri,tileBoundsIndexBuffer:Fi,tileBoundsSegments:Di}=d.getTileBoundsBuffers(ot);wr.draw(d,O.TRIANGLES,Ue,ct,H,jn.disabled,Pi,a.id,ri,Fi,Di)}}if(!(j instanceof r.aS)&&M)for(const Ee of Ae){const ze=Ee.canonical.y===(1<<Ee.canonical.z)-1;Ee.canonical.y===0&&lf(!0,Ee,d,t,a,q,B,ke,Me||On.disabled),ze&&lf(!1,Ee,d,t,a,q,B,ke===jn.frontCW?jn.backCW:jn.frontCW,Me||On.disabled)}};M?Ce(pe,d.renderElevatedRasterBackface?jn.backCW:jn.frontCW,d.stencilModeFor3D()):Ce(pe,jn.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,t,a,h,g,y){d.renderPass==="offscreen"&&(function(b,S,M,D){if(!D.length)return;const O=b.context,j=O.gl,B=S.getSource();if(!(B instanceof Tl))return;const q=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count")));let H=M.particlePositionRGBAImage;if(!H||H.width!==q){const pe=(function(ye){const Ce=ye*ye,Ae=new Uint8Array(4*Ce),ke=function(Ee){return Ee|=0,Ee=Math.imul(2747636419^Ee,2654435769),Ee=Math.imul(Ee^Ee>>>16,2654435769),((Ee=Math.imul(Ee^Ee>>>16,2654435769))>>>0)/4294967296},Me=1/1.1;for(let Ee=0;Ee<Ce;Ee++){const ze=Me*(ke(2*Ee+0)+vc),ot=Me*(ke(2*Ee+1)+vc),Ze=255*ze%1,mt=255*ot%1,$e=Ze,pt=ot-mt/255,Ht=mt;Ae[4*Ee+0]=255*(ze-Ze/255),Ae[4*Ee+1]=255*$e,Ae[4*Ee+2]=255*pt,Ae[4*Ee+3]=255*Ht}return Ae})(q);H=M.particlePositionRGBAImage=new r.q({width:q,height:q},pe)}let Z=M.particleFramebuffer;Z?Z.width!==q&&(Z.destroy(),Z=M.particleFramebuffer=O.createFramebuffer(q,q,!0,null)):Z=M.particleFramebuffer=O.createFramebuffer(q,q,!0,null);const re=[];for(const pe of D){const ye=S.getTile(pe);if(!(ye instanceof oh))continue;const Ce=Is(ye,B,M);if(!Ce)continue;const Ae=[ye.tileSize,ye.tileSize];let ke=M.tileFramebuffer;ke||(ke=M.tileFramebuffer=O.createFramebuffer(Ae[0],Ae[1],!0,null));let Me=ye.rasterParticleState;Me||(Me=ye.rasterParticleState=new qx(O,pe,Ae,H));const Ee=Me.update(M.lastInvalidatedAt);Me.particleTextureDimension!==q&&Me.updateParticleTexture(pe,H);const ze=Me.targetColorTexture;Me.targetColorTexture=Me.backgroundColorTexture,Me.backgroundColorTexture=ze;const ot=Me.particleTexture0;Me.particleTexture0=Me.particleTexture1,Me.particleTexture1=ot,re.push([pe,Ce,Me,Ee])}if(re.length===0)return;const $=r.o.now(),ae=M.previousDrawTimestamp?.001*($-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=$,M.hasColorMap()){O.activeTexture.set(j.TEXTURE0+2);let pe=M.colorRampTexture;pe||(pe=M.colorRampTexture=new r.T(O,M.colorRamp,j.RGBA8)),pe.bind(j.LINEAR,j.CLAMP_TO_EDGE)}O.bindFramebuffer.set(M.tileFramebuffer.framebuffer),(function(pe,ye,Ce){const Ae=pe.context,ke=Ae.gl,Me=ye.tileFramebuffer;Ae.activeTexture.set(ke.TEXTURE0);const Ee={u_texture:0,u_opacity:1.05*(ot=ye.paint.get("raster-particle-fade-opacity-factor"))/(ot+.05)},ze=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ot;for(const Ze of Ce){const[,,mt,$e]=Ze;Me.colorAttachment.set(mt.targetColorTexture.texture),Ae.viewport.set([0,0,Me.width,Me.height]),Ae.clear({color:r.ao.transparent}),$e&&(mt.backgroundColorTexture.bind(ke.NEAREST,ke.CLAMP_TO_EDGE),ze.draw(pe,ke.TRIANGLES,an.disabled,On.disabled,si.alphaBlended,jn.disabled,Ee,ye.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}})(b,M,re),(function(pe,ye,Ce,Ae){const ke=pe.context,Me=ke.gl,Ee=Ce.tileFramebuffer,ze=pe.transform.projection.name==="globe",ot=Ce.paint.get("raster-particle-max-speed");for(const Ze of Ae){const[mt,$e,pt]=Ze;ke.activeTexture.set(Me.TEXTURE0+0),$e.texture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),Ee.colorAttachment.set(pt.targetColorTexture.texture);const Ht=pe.getOrCreateProgram("rasterParticleDraw",{defines:$e.defines,overrideFog:!1});ke.activeTexture.set(Me.TEXTURE0+1);const rt=$e.scalarData?[]:[0,1,2,3].map((ct=>r.e6[ct](mt)));rt.push(mt);const Ue=mt.canonical.x,xt=mt.canonical.y;for(const ct of rt){const Ct=ye.getTile(ze?ct.wrapped():ct);if(!Ct)continue;const qt=Ct.rasterParticleState;if(!qt)continue;const nn=ct.canonical.x+(1<<ct.canonical.z)*(ct.wrap-mt.wrap),Vt=ct.canonical.y;qt.particleTexture0.bind(Me.NEAREST,Me.CLAMP_TO_EDGE);const Ot=hm(1,qt.particleTexture0.size[0],[nn-Ue,Vt-xt],0,$e.texture.size,2,ot,$e.textureOffset,$e.scale,$e.offset);Ht.draw(pe,Me.POINTS,an.disabled,On.disabled,si.alphaBlended,jn.disabled,Ot,Ce.id,qt.particleIndexBuffer,void 0,qt.particleSegment)}}})(b,S,M,re),O.bindFramebuffer.set(M.particleFramebuffer.framebuffer),(function(pe,ye,Ce,Ae){const ke=pe.context,Me=ke.gl,Ee=ye.paint.get("raster-particle-max-speed"),ze=Ae*ye.paint.get("raster-particle-speed-factor")*.15,ot=(function(mt){return Math.pow(mt,6)})(.01+1*ye.paint.get("raster-particle-reset-rate-factor")),Ze=ye.particleFramebuffer;ke.viewport.set([0,0,Ze.width,Ze.height]);for(const mt of Ce){const[,$e,pt]=mt;ke.activeTexture.set(Me.TEXTURE0+0),$e.texture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),ke.activeTexture.set(Me.TEXTURE0+1);const Ht=pt.particleTexture0;Ht.bind(Me.NEAREST,Me.CLAMP_TO_EDGE);const rt=Jd(1,Ht.size[0],0,$e.texture.size,Ee,ze,ot,$e.textureOffset,$e.scale,$e.offset);Ze.colorAttachment.set(pt.particleTexture1.texture),ke.clear({color:r.ao.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:$e.defines}).draw(pe,Me.TRIANGLES,an.disabled,On.disabled,si.unblended,jn.disabled,rt,ye.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}})(b,M,re,ae)})(d,t,a,h),d.renderPass==="translucent"&&((function(b,S,M,D,O){const j=b.context,B=j.gl,q=S.getSource().tileSize,H=5*(1-r.ah(r.cK,r.cK+1,b.transform.zoom))*q+M.paint.get("raster-particle-elevation"),Z=!b.options.moving,re=b.transform.projection.name==="globe";if(!D.length)return;const[$,ae]=b.stencilConfigForOverlap(D),pe=[];re&&pe.push("PROJECTION_GLOBE_VIEW");const ye=b.stencilModeFor3D();for(const Ce of ae){const Ae=Ce.toUnwrapped(),ke=S.getTile(Ce);if(!ke.rasterParticleState)continue;const Me=ke.rasterParticleState,Ee=100;ke.registerFadeDuration(Ee);const ze=S.findLoadedParent(Ce,0),ot=gc(ke,ze,S,b.transform,Ee);let Ze,mt;b.terrain&&b.terrain.prepareDrawTile(),j.activeTexture.set(B.TEXTURE0),Me.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),j.activeTexture.set(B.TEXTURE1),ze&&ze.rasterParticleState?(ze.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ze=Math.pow(2,ze.tileID.overscaledZ-ke.tileID.overscaledZ),mt=[ke.tileID.canonical.x*Ze%1,ke.tileID.canonical.y*Ze%1]):Me.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const $e=re?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(Ae,Z),pt=b.transform,Ht=vm(pt),rt=r.dC(Ce.canonical),Ue=r.dD(rt.getCenter().lat);let xt,ct,Ct,qt,nn;re?(xt=Float32Array.from(r.bk(r.dF(Ce.canonical))),ct=Float32Array.from(pt.globeMatrix),Ct=Float32Array.from(r.dB(pt)),qt=[r.aF(pt.center.lng),r.aJ(pt.center.lat)],nn=Float32Array.from(r.dE(Ce.canonical,rt,Ue,pt.worldSize/pt._pixelsPerMercatorPixel))):(xt=new Float32Array(16),ct=new Float32Array(9),Ct=new Float32Array(16),qt=[0,0],nn=new Float32Array(9));const Vt=zl($e,xt,ct,Ct,nn,mt||[0,0],r.aj(b.transform.zoom),qt,Ht,Ze||1,ot,H),Ot=b.isTileAffectedByFog(Ce),vn=b.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:Ot});if(b.uploadCommonUniforms(j,vn,Ae),re){const gn=new an(B.LEQUAL,an.ReadOnly,b.depthRangeFor3D),yn=0,mn=b.globeSharedBuffers;if(mn){const[qn,ii,ai]=mn.getGridBuffers(Ue,yn!==0);vn.draw(b,B.TRIANGLES,gn,ye,si.alphaBlended,b.renderElevatedRasterBackface?jn.frontCCW:jn.backCCW,Vt,M.id,qn,ii,ai)}}else{const gn=b.depthModeForSublayer(0,an.ReadOnly),yn=$[Ce.overscaledZ],{tileBoundsBuffer:mn,tileBoundsIndexBuffer:qn,tileBoundsSegments:ii}=b.getTileBoundsBuffers(ke);vn.draw(b,B.TRIANGLES,gn,yn,si.alphaBlended,jn.disabled,Vt,M.id,mn,qn,ii)}}b.resetStencilClippingMasks()})(d,t,a,h),d.style.map.triggerRepaint())},background:function(d,t,a,h){const g=a.paint.get("background-color"),y=a.paint.get("background-color-use-theme").constantOr("default")==="none",b=a.paint.get("background-opacity"),S=a.paint.get("background-emissive-strength"),M=a.paint.get("background-pitch-alignment")==="viewport";if(b===0)return;const D=d.context,O=D.gl,j=d.transform,B=j.tileSize,q=a.paint.get("background-pattern");let H;if(q!==void 0&&(q===null||(H=d.imageManager.getPattern(r.I.from(q.toString()),a.scope,d.style.getLut(a.scope)),!H)))return;const Z=!q&&g.a===1&&b===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==Z)return;const re=On.disabled,$=d.depthModeForSublayer(0,Z==="opaque"?an.ReadWrite:an.ReadOnly),ae=d.colorModeForDrapableLayerRenderPass(S),pe=q?"backgroundPattern":"background";let ye,Ce=h;if(Ce||(ye=d.getBackgroundTiles(),Ce=Object.values(ye).map((Ae=>Ae.tileID))),q&&(D.activeTexture.set(O.TEXTURE0),d.imageManager.bind(d.context,a.scope)),M){const Ae=d.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0}),ke=new Float32Array(r.bA([])),Me=new r.aO(0,0,0,0,0),Ee=q?$d(ke,S,b,d,0,a.scope,H,M,{tileID:Me,tileSize:B}):Qd(ke,S,b,g.toPremultipliedRenderColor(y?null:a.lut));Ae.draw(d,O.TRIANGLES,$,re,ae,jn.disabled,Ee,a.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const Ae of Ce){const ke=d.isTileAffectedByFog(Ae),Me=d.getOrCreateProgram(pe,{overrideFog:ke}),Ee=Ae.toUnwrapped(),ze=h?Ae.projMatrix:d.transform.calculateProjMatrix(Ee);d.prepareDrawTile();const ot=t?t.getTile(Ae):ye?ye[Ae.key]:new El(Ae,B,j.zoom,d),Ze=q?$d(ze,S,b,d,0,a.scope,H,M,{tileID:Ae,tileSize:B}):Qd(ze,S,b,g.toPremultipliedRenderColor(y?null:a.lut));d.uploadCommonUniforms(D,Me,Ee);const{tileBoundsBuffer:mt,tileBoundsIndexBuffer:$e,tileBoundsSegments:pt}=d.getTileBoundsBuffers(ot);Me.draw(d,O.TRIANGLES,$,re,ae,jn.disabled,Ze,a.id,mt,$e,pt)}},sky:function(d,t,a){const h=d._atmosphere?r.aj(d.transform.zoom):1,g=a.paint.get("sky-opacity")*h;if(g===0)return;const y=d.context,b=a.paint.get("sky-type"),S=new an(y.gl.LEQUAL,an.ReadOnly,[0,1]),M=d.frameCounter/1e3%1;b==="atmosphere"?d.renderPass==="offscreen"?a.needsSkyboxCapture(d)&&((function(D,O,j,B){const q=D.context,H=q.gl;let Z=O.skyboxFbo;if(!Z){Z=O.skyboxFbo=q.createFramebuffer(32,32,!0,null),O.skyboxGeometry=new Tm(q),O.skyboxTexture=q.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,O.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let pe=0;pe<6;++pe)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(Z.framebuffer),q.viewport.set([0,0,32,32]);const re=O.getCenter(D,!0),$=D.getOrCreateProgram("skyboxCapture"),ae=new Float64Array(16);r.bA(ae),r.ek(ae,ae,.5*-Math.PI),Tc(D,O,$,ae,re,0),r.bA(ae),r.ek(ae,ae,.5*Math.PI),Tc(D,O,$,ae,re,1),r.bA(ae),r.cT(ae,ae,.5*-Math.PI),Tc(D,O,$,ae,re,2),r.bA(ae),r.cT(ae,ae,.5*Math.PI),Tc(D,O,$,ae,re,3),r.bA(ae),Tc(D,O,$,ae,re,4),r.bA(ae),r.ek(ae,ae,Math.PI),Tc(D,O,$,ae,re,5),q.viewport.set([0,0,D.width,D.height])})(d,a),a.markSkyboxValid(d)):d.renderPass==="sky"&&(function(D,O,j,B,q){const H=D.context,Z=H.gl,re=D.transform,$=D.getOrCreateProgram("skybox");H.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,O.skyboxTexture);const ae=((pe,ye,Ce,Ae,ke)=>({u_matrix:pe,u_sun_direction:ye,u_cubemap:0,u_opacity:Ae,u_temporal_offset:ke}))(re.skyboxMatrix,O.getCenter(D,!1),0,B,q);D.uploadCommonUniforms(H,$),$.draw(D,Z.TRIANGLES,j,On.disabled,D.colorModeForRenderPass(),jn.backCW,ae,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)})(d,a,S,g,M):b==="gradient"&&d.renderPass==="sky"&&(function(D,O,j,B,q){const H=D.context,Z=H.gl,re=D.transform,$=D.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new Tm(H)),H.activeTexture.set(Z.TEXTURE0);let ae=O.colorRampTexture;ae||(ae=O.colorRampTexture=new r.T(H,O.colorRamp,Z.RGBA8)),ae.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const pe=((ye,Ce,Ae,ke,Me)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:Ce,u_radius:r.an(Ae),u_opacity:ke,u_temporal_offset:Me}))(re.skyboxMatrix,O.getCenter(D,!1),O.paint.get("sky-gradient-radius"),B,q);D.uploadCommonUniforms(H,$),$.draw(D,Z.TRIANGLES,j,On.disabled,D.colorModeForRenderPass(),jn.backCW,pe,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)})(d,a,S,g,M)},custom:function(d,t,a,h){const g=d.context,y=a.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&a.isDraped(t)){if(d.renderPass==="offscreen"){const b=y.prerender;if(b){if(d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const S=d.transform.pointMerc;b.call(y,g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.aj(d.transform.zoom),[S.x,S.y],d.transform.pixelsPerMeterRatio)}else b.call(y,g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const S=y.renderToTile;if(S){const M=h[0].canonical,D={x:M.x+h[0].wrap*(y.wrapTileId?0:1<<M.z),y:M.y,z:M.z};g.setDepthMode(an.disabled),g.setStencilMode(On.disabled),g.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),S.call(y,g.gl,D),g.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),g.setStencilMode(On.disabled);const b=y.renderingMode==="3d"?new an(d.context.gl.LEQUAL,an.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,an.ReadOnly);if(g.setDepthMode(b),d.transform.projection.name==="globe"){const S=d.transform.pointMerc;y.render(g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.aj(d.transform.zoom),[S.x,S.y],d.transform.pixelsPerMeterRatio)}else y.render(g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState(),g.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,t,a,h){if(d.renderPass==="opaque")return;const g=a.paint.get("model-opacity").constantOr(1);if(g===0)return;const y=a.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!y||d.terrain&&g<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof r.ad))return;const b=d.shadowRenderer,S=a.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,S||(b.enabled=!1));const M=()=>{b&&(b.useNormalOffset=!0,S||(b.enabled=!0))},D=t.getSource();if(d.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return(function($,ae,pe,ye,Ce){const Ae=$.transform;if(Ae.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${Ae.projection.name} projection is not yet implemented`);const ke=Ae.getFreeCameraOptions().position;if(!$.modelManager)return;const Me=$.modelManager;pe.modelManager=Me;const Ee=$.shadowRenderer;if(!pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ze=pe._unevaluatedLayout._values["model-id"],ot=Object.assign({},pe.layout.get("model-id").parameters),Ze=$.style.order.indexOf(pe.fqid);for(const mt of ye){const $e=ae.getTile(mt).getBucket(pe);if(!$e||$e.projection.name!==Ae.projection.name)continue;const pt=$e.getModelUris();pt&&!$e.modelsRequested&&(Me.addModelsFromBucket(pt,Ce),$e.modelsRequested=!0);const Ht=wu(mt,Ae);ot.zoom=Ht;const rt=ze.possiblyEvaluate(ot);if(ry($,$e,mt),xa.shadowUniformsInitialized=!1,xa.useSingleShadowCascade=!!Ee&&Ee.getMaxCascadeForTile(mt.toUnwrapped())===0,$.renderPass==="shadow"&&Ee){if($.currentShadowCascade===1&&$e.isInsideFirstShadowMapFrustum)continue;const ct=Ae.calculatePosMatrix(mt.toUnwrapped(),Ae.worldSize);if(xa.tileMatrix.set(ct),xa.shadowTileMatrix=Float32Array.from(Ee.calculateShadowPassMatrixFromMatrix(ct)),xa.aabb.min=[0,0,0],xa.aabb.max[0]=xa.aabb.max[1]=r.al,xa.aabb.max[2]=0,sy($e,xa,$,pe.scope))continue}const Ue=1<<mt.canonical.z,xt=[((ke.x-mt.wrap)*Ue-mt.canonical.x)*r.al,(ke.y*Ue-mt.canonical.y)*r.al,ke.z*Ue*r.al];$.conflationActive&&Object.keys($e.instancesPerModel).length>0&&$.style.isLayerClipped(pe,ae.getSource())&&$e.updateReplacement(mt,$.replacementSource,Ze,Ce)&&($e.uploaded=!1,$e.upload($.context));for(let ct in $e.instancesPerModel){const Ct=$e.instancesPerModel[ct];Ct.features.length>0&&(ct=rt.evaluate(Ct.features[0].feature,{}));const qt=Me.getModel(ct,Ce);if(qt||Me.hasURLBeenRequested(ct)||$e.modelUris.includes(ct)||($e.modelUris.push(ct),$e.modelsRequested=!1),qt&&qt.uploaded)for(const nn of qt.nodes)oy($,pe,nn,Ct,xt,mt,xa)}}})(d,t,a,h,D.type==="vector"?a.scope:""),void M();if(!D.loaded())return;if(D.type==="batched-model")return(function($,ae,pe,ye){pe.resetLayerRenderingStats($);const Ce=$.context,Ae=$.transform,ke=$.style.fog,Me=$.shadowRenderer;if(Ae.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Ae.projection.name} projection is not yet implemented`);const Ee=$.transform.getFreeCameraOptions().position,ze=r.c4([],[Ee.x,Ee.y,Ee.z],$.transform.worldSize),ot=r.et([],ze),Ze=r.bA([]),mt=r.ec(Ae.center.lat,Ae.zoom),$e=r.bq([],[1,1,1/mt]);r.br(Ze,Ze,ot);const pt=pe.paint.get("model-opacity").constantOr(1),Ht=new an(Ce.gl.LEQUAL,an.ReadWrite,$.depthRangeFor3D),rt=new an(Ce.gl.LEQUAL,an.ReadOnly,$.depthRangeFor3D),Ue=new r.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),xt=$.renderPass==="shadow",ct=xt&&Me?Me.getCurrentCascadeFrustum():Ae.getFrustum(Ae.scaleZoom(Ae.worldSize)),Ct=pe.paint.get("model-front-cutoff"),qt=Ct[2]<1,nn=Cl($,pe.paint.get("model-cutoff-fade-range")),Vt=pe.getLayerRenderingStats();(function(Ot,vn,gn,yn){const mn=Ot.terrain?Ot.terrain.exaggeration():0,qn=Ot.transform.zoom;for(const ii of yn){const ai=vn.getTile(ii).getBucket(gn);ai&&(ai.setFilter(gn.filter),Ot.conflationActive&&ai.updateReplacement(ii,Ot.replacementSource),ai.evaluateTransform(Ot,gn),Ot.terrain&&mn>0&&ai.elevationUpdate(Ot.terrain,mn,ii,gn.source),ai.needsReEvaluation(Ot,qn,gn)&&ai.evaluate(gn))}})($,ae,pe,ye),(function(){let Ot,vn,gn;qt?(Ot=ye.length-1,vn=-1,gn=-1):(Ot=0,vn=ye.length,gn=1);const yn=new Float64Array(16),mn=r.cz(),qn=new r.P(0,0);for(let ii=Ot;ii!==vn;ii+=gn){const ai=ye[ii],Xi=ae.getTile(ai).getBucket(pe);if(!Xi||!Xi.uploaded)continue;let Jn=!1;Me&&(Jn=Me.getMaxCascadeForTile(ai.toUnwrapped())===0);const Pi=Ae.calculatePosMatrix(ai.toUnwrapped(),Ae.worldSize),ji=Xi.modelTraits;!xt&&qt&&(r.bl(yn,Pi),r.af(mn,ze,yn),qn.x=mn[0],qn.y=mn[1]);const wr=[];Xi.setFilter(pe.filter);for(const ri of Xi.getNodesInfo()){if(ri.hiddenByReplacement||!ri.node.meshes)continue;const Fi=ri.node;let Di=0;$.terrain&&Fi.elevation&&(Di=Fi.elevation*$.terrain.exaggeration());const Ni=(()=>{const Bo=ri.aabb;return Ue.min=[...Bo.min],Ue.max=[...Bo.max],Ue.min[2]+=Di,Ue.max[2]+=Di,r.af(Ue.min,Ue.min,Pi),r.af(Ue.max,Ue.max,Pi),Ue})(),Ar=ri.evaluatedScale;if(Ar[0]<=1&&Ar[1]<=1&&Ar[2]<=1&&Ni.intersects(ct)===0)continue;if(!xt&&qt){const Bo=.16666666666666666;ri.cameraCollisionOpacity=ze[0]>Ni.min[0]&&ze[0]<Ni.max[0]&&ze[1]>Ni.min[1]&&ze[1]<Ni.max[1]&&ze[2]*mt<Ni.max[2]&&Fi.footprint&&r.b$(qn,Fi.footprint)?Math.max(ri.cameraCollisionOpacity-Bo,0):Math.min(1,ri.cameraCollisionOpacity+Bo)}const Yr=[...Pi],Ro=1/r.d6(ai.canonical),Ir=Fi.anchor?Fi.anchor[0]:0,li=Fi.anchor?Fi.anchor[1]:0;r.br(Yr,Yr,[Ir*(Ar[0]-1)+ri.evaluatedTranslation[0]*Ro,li*(Ar[1]-1)+ri.evaluatedTranslation[1]*Ro,Di+ri.evaluatedTranslation[2]]),r.cp(Ar,r.ev)||r.cR(Yr,Yr,Ar);const Fn=r.aB([],Yr,Fi.matrix),Yi=r.aB([],Ae.expandedFarZProjMatrix,Fn),jr=r.aB([],Ae.expandedFarZProjMatrix,Yr),Dr=r.aC([],[Ir,li,Di,1],Yi)[2];Fi.hidden=!1;let lo=pt;xt||(qt&&(lo*=ri.cameraCollisionOpacity,lo*=Sm(Yr,Ae,ri.aabb,Ct)),lo*=df(nn,Dr)),lo!==0?wr.push({nodeInfo:ri,depth:Dr,opacity:lo,wvpForNode:Yi,wvpForTile:jr,nodeModelMatrix:Fn,tileModelMatrix:Yr}):Fi.hidden=!0}xt||wr.sort(((ri,Fi)=>!qt||ri.opacity===1&&Fi.opacity===1?ri.depth<Fi.depth?-1:1:ri.opacity===1?-1:Fi.opacity===1?1:ri.depth>Fi.depth?-1:1));for(const ri of wr){const Fi=ri.nodeInfo,Di=Fi.node;let Ni=r.aB([],$e,ri.tileModelMatrix);r.aB(Ni,Ze,Ni);const Ar=r.bl([],Ni);r.ed(Ar,Ar),r.cR(Ar,Ar,Hx),Ni=r.aB(Ni,Ni,Di.matrix);const Yr=$.renderPass==="light-beam",Ro=pe.paint.get("model-color-use-theme").constantOr("default")==="none",Ir=ji&r.ez.HasMapboxMeshFeatures,li=Ir?0:Fi.evaluatedRMEA[0][2];for(let Fn=0;Fn<Di.meshes.length;++Fn){const Yi=Di.meshes[Fn],jr=Fn===Di.lightMeshIndex;let Dr=ri.wvpForNode;if(jr){if(!Yr&&!$.terrain&&$.shadowRenderer){$.currentLayer<$.firstLightBeamLayer&&($.firstLightBeamLayer=$.currentLayer);continue}Dr=ri.wvpForTile}else if(Yr)continue;const lo={defines:[]},Bo=[];if(!xt&&Me&&(Me.useNormalOffset=!!Yi.normalBuffer),uf(lo.defines,Bo,Yi,$,Ro?null:pe.lut),Ir||lo.defines.push("DIFFUSE_SHADED"),Jn&&lo.defines.push("SHADOWS_SINGLE_CASCADE"),Vt&&(xt?Vt.numRenderedVerticesInShadowPass+=Yi.vertexArray.length:Vt.numRenderedVerticesInTransparentPass+=Yi.vertexArray.length),xt){Ah(Yi,ri.nodeModelMatrix,$,pe);continue}let qs=null;if(ke){const Ta=Ye(ri.nodeModelMatrix,$.transform);if(qs=new Float32Array(Ta),Ae.projection.name!=="globe"){const Hr=Yi.aabb.min,Kr=Yi.aabb.max,[Lr,xo]=ke.getOpacityForBounds(Ta,Hr[0],Hr[1],Kr[0],Kr[1]);lo.overrideFog=Lr>=dn||xo>=dn}}const Hs=Yi.material;let Ms;Hs.occlusionTexture&&Hs.occlusionTexture.offsetScale&&(Ms=Hs.occlusionTexture.offsetScale,lo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Cs=$.getOrCreateProgram("model",lo);!xt&&Me&&Me.setupShadowsFromMatrix(ri.tileModelMatrix,Cs,Me.useNormalOffset),$.uploadCommonUniforms(Ce,Cs,null,qs);const ms=Hs.pbrMetallicRoughness;ms.metallicFactor=.9,ms.roughnessFactor=.5;const sa=ef(new Float32Array(Dr),new Float32Array(Ni),new Float32Array(Ar),new Float32Array(Di.matrix),$,ri.opacity,ms.baseColorFactor,Hs.emissiveFactor,ms.metallicFactor,ms.roughnessFactor,Hs,li,pe,[0,0,0],Ms);!jr&&(Fi.hasTranslucentParts||ri.opacity<1)&&Cs.draw($,Ce.gl.TRIANGLES,Ht,On.disabled,si.disabled,jn.backCCW,sa,pe.id,Yi.vertexBuffer,Yi.indexBuffer,Yi.segments,pe.paint,$.transform.zoom,void 0,Bo),Cs.draw($,Ce.gl.TRIANGLES,jr?rt:Ht,On.disabled,jr||ri.opacity<1||Fi.hasTranslucentParts?si.alphaBlended:si.unblended,jn.backCCW,sa,pe.id,Yi.vertexBuffer,Yi.indexBuffer,Yi.segments,pe.paint,$.transform.zoom,void 0,Bo)}}}})()})(d,t,a,h),void M();if(D.type!=="model")return;const O=D.getModels(),j=[],B=d.transform.getFreeCameraOptions().position,q=r.c4([],[B.x,B.y,B.z],d.transform.worldSize);r.et(q,q);const H=[],Z=[];let re=0;for(const $ of O){const ae=a.paint.get("model-rotation").constantOr(null),pe=a.paint.get("model-scale").constantOr(null),ye=a.paint.get("model-translation").constantOr(null);$.computeModelMatrix(d,ae,pe,ye,!0,!0,!1);const Ce=r.bA([]),Ae=r.ec($.position.lat,d.transform.zoom),ke=r.bq([],[1,1,1/Ae]);r.br(Ce,Ce,q),j.push({zScaleMatrix:ke,negCameraPosMatrix:Ce});for(const Me of $.nodes)hf(d.transform,Me,$.matrix,d.transform.expandedFarZProjMatrix,re,H,Z);re++}if(H.sort((($,ae)=>ae.depth-$.depth)),d.renderPass!=="shadow"){if(g===1)for(const $ of Z)Ac($,d,a,j[$.modelIndex],On.disabled,d.colorModeForRenderPass());else{for(const $ of Z)Ac($,d,a,j[$.modelIndex],On.disabled,si.disabled);for(const $ of Z)Ac($,d,a,j[$.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const $ of H)Ac($,d,a,j[$.modelIndex],On.disabled,d.colorModeForRenderPass());M()}else{for(const $ of Z)Ah($.mesh,$.nodeModelMatrix,d,a);for(const $ of H)Ah($.mesh,$.nodeModelMatrix,d,a);M()}}},Ic={line:function(d,t,a){if(d.hasElevatedBuckets=!1,d.hasNonElevatedBuckets=!1,d._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||d._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const h=t.getVisibleCoordinates();for(const g of h){const y=t.getTile(g).getBucket(d);if(y&&(y.elevationType!=="none"?d.hasElevatedBuckets=!0:d.hasNonElevatedBuckets=!0,d.hasElevatedBuckets&&d.hasNonElevatedBuckets))break}}}else d.hasNonElevatedBuckets=!0},model:function(d,t,a){const h=t.getSource();if(!h.loaded())return;if(h.type==="vector"||h.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,h.type==="vector"?d.scope:""));if(h.type==="batched-model"||h.type!=="model")return;const g=h.getModels();for(const y of g)y.upload(a.context)},raster:function(d,t,a){const h=t.getSource();if(!(h instanceof Tl&&h.loaded()))return;const g=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!g)return;const y=d.paint.get("raster-array-band")||h.getInitialBand(g);if(y==null)return;const b=t.getIds().map((S=>t.getTileByID(S)));for(const S of b)S.updateNeeded(d.id,y)&&h.prepareTile(S,g,d.id,y)},"raster-particle":function(d,t,a){const h=t.getSource();if(!(h instanceof Tl&&h.loaded()))return;const g=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!g)return;const y=d.paint.get("raster-particle-array-band")||h.getInitialBand(g);if(y==null)return;const b=t.getIds().map((S=>t.getTileByID(S)));for(const S of b)S.updateNeeded(d.id,y)&&h.prepareTile(S,g,d.id,y)}},Mc={fill:xc},Ul={fill:function(d,t,a,h){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const g=d.context.gl,y=new an(g.LEQUAL,an.ReadOnly,d.depthRangeFor3D),b=new On({func:g.ALWAYS,mask:255},255,255,g.KEEP,g.KEEP,g.REPLACE),S=d.transform.getFreeCameraOptions().position,M=d.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const D of h){const O=t.getTile(D),j=O.getBucket(a);if(!j)continue;const B=j.elevatedStructures;if(!B||B.depthSegments.segments[0].primitiveLength===0)continue;const q=$_(D.toUnwrapped(),S),H=d.translatePosMatrix(D.projMatrix,O,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),Z=Yd(H,q,0,1,0);M.draw(d,g.TRIANGLES,y,b,si.disabled,jn.disabled,Z,a.id,B.vertexBuffer,B.indexBuffer,B.depthSegments,a.paint,d.transform.zoom)}}};class Am{constructor(t,a,h,g,y,b){this.context=new mm(t,a),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=r.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const D of S)this._debugParams.enabledLayers[D]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const D of S)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],D);this.occlusionParams=new ff(y),this.setup(),this.numSublayers=Bs.maxUnderzooming+Bs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new xx(this),this._wireframeDebugCache=new ly,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const M=new r.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,M,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g,this.worldview=b}updateTerrain(t,a){const h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new bh(this,t));const g=this._terrain;this.transform.elevation=h?g:null,g.update(t,this.transform,a),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(t){const a=t.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,g]=a.getFovAdjustedRange(this.transform._fov);if(h>g)return void(this.transform.fogCullDistSq=null);const y=h+.78*(g-h);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new bh(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,a){if(this.width=t*r.o.devicePixelRatio,this.height=a*r.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const t=this.context,a=new r.bd;a.emplaceBack(0,0),a.emplaceBack(r.al,0),a.emplaceBack(0,r.al),a.emplaceBack(r.al,r.al),this.tileExtentBuffer=t.createVertexBuffer(a,r.bf.members),this.tileExtentSegments=r.bg.simpleSegment(0,0,4,2);const h=new r.bd;h.emplaceBack(0,0),h.emplaceBack(r.al,0),h.emplaceBack(0,r.al),h.emplaceBack(r.al,r.al),this.debugBuffer=t.createVertexBuffer(h,r.bf.members),this.debugSegments=r.bg.simpleSegment(0,0,4,5);const g=new r.bd;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,r.bf.members),this.viewportSegments=r.bg.simpleSegment(0,0,4,2);const y=new r.b0;y.emplaceBack(0,0,0,0),y.emplaceBack(r.al,0,r.al,0),y.emplaceBack(0,r.al,0,r.al),y.emplaceBack(r.al,r.al,r.al,r.al),this.mercatorBoundsBuffer=t.createVertexBuffer(y,r.bi.members),this.mercatorBoundsSegments=r.bg.simpleSegment(0,0,4,2);const b=new r.b1;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const S=new r.be;for(const D of[0,1,3,2,0])S.emplaceBack(D);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new r.T(t,new r.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.bC();const M=this.context.gl;this.stencilClearMode=new On({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,an.disabled,this.stencilClearMode,si.disabled,jn.disabled,mc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,h){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const M of h)if(this._tileClippingMaskIDs[M.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=a.id;const g=this.context,y=g.gl;this.nextStencilID+h.length>256&&this.clearStencil(),g.setColorMode(si.disabled),g.setDepthMode(an.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of h){const M=a.getTile(S),D=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:j,tileBoundsSegments:B}=this.getTileBoundsBuffers(M);b.draw(this,y.TRIANGLES,an.disabled,new On({func:y.ALWAYS,mask:0},D,255,y.KEEP,y.KEEP,y.REPLACE),si.disabled,jn.disabled,mc(S.projMatrix),"$clipping",O,j,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new On({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new On({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,h=t.sort(((b,S)=>S.overscaledZ-b.overscaledZ)),g=h[h.length-1].overscaledZ,y=h[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let S=0;S<y;S++)b[S+g]=new On({func:a.GEQUAL,mask:255},S+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=y,[b,h]}return[{[g]:On.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new si([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?si.unblended:si.alphaBlended}colorModeForDrapableLayerRenderPass(t){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new si([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new r.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,a,h,g=!1){if(this.depthOcclusion)return new an(this.context.gl.GREATER,an.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return an.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new an(h||this.context.gl.LEQUAL,a,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,a=Math.ceil(this.width),h=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),y=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===h||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&h!==0&&(this.depthFBO=new tf(this.context,a,h,!1,"texture"),this.depthTexture=new r.T(this.context,{width:a,height:h,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),t.bindTexture(t.TEXTURE_2D,y),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,a,h,0,0,a,h,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,a)=>t+a/this._fpsHistory.length),0))}render(t,a){const h=r.o.now();this._dt=h-this._timeStamp,this._timeStamp=h,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=a;const g=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),b=()=>this.style._getOrder(y).filter((rt=>{const Ue=g[rt];return!(Ue.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ue.type]}));let S=b(),M=!1,D=!1,O=null;for(const rt of S){const Ue=g[rt];Ue.type==="circle"?M=!0:Ue.type==="building"?O=Ue:Ue.type==="symbol"&&(Ue.hasOcclusionOpacityProperties?D=!0:M=!0)}let j=S.map((rt=>g[rt]));const B=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.o.now()),this.imageManager.beginFrame();let q=0,H=!1;for(const rt in B){const Ue=B[rt];Ue.used&&(Ue.prepare(this.context),Ue.getSource().usedInConflation&&++q)}let Z=!1;for(const rt of j)rt.isHidden(this.transform.zoom)||(rt.type==="clip"&&(Z=!0),this.prepareLayer(rt));const re={},$={},ae={},pe={},ye={};for(const rt in B){const Ue=B[rt];re[rt]=Ue.getVisibleCoordinates(),$[rt]=re[rt].slice().reverse(),ae[rt]=Ue.getVisibleCoordinates(!0).reverse(),pe[rt]=Ue.getShadowCasterCoordinates(),ye[rt]=Ue.sortCoordinatesByDistance(re[rt])}const Ce=rt=>{const Ue=this.style.getLayerSourceCache(rt);return Ue&&Ue.used?Ue.getSource():null};if(q||Z||this._clippingActiveLastFrame){const rt=[],Ue=[];let xt=0;for(const ct of j)this.isSourceForClippingOrConflation(ct,Ce(ct))&&(rt.push(ct),Ue.push(xt)),xt++;if(rt&&(Z||rt.length>1)||this._clippingActiveLastFrame){Z=!1;const ct=[];for(let Ct=0;Ct<rt.length;Ct++){const qt=rt[Ct],nn=Ue[Ct],Vt=this.style.getLayerSourceCache(qt);if(!Vt||!Vt.used||!Vt.getSource().usedInConflation&&qt.type!=="clip"&&qt.type!=="building")continue;let Ot=r.eH,vn=r.bZ.None;const gn=[];let yn=!0;if(qt.type==="building")Ot=r.eJ;else if(qt.type==="clip"){Ot=nn;for(const mn of qt.layout.get("clip-layer-types"))vn|=mn==="model"?r.bZ.Model:mn==="symbol"?r.bZ.Symbol:r.bZ.FillExtrusion;for(const mn of qt.layout.get("clip-layer-scope"))gn.push(mn);qt.isHidden(this.transform.zoom)?yn=!1:Z=!0}yn&&ct.push({layer:qt.fqid,cache:Vt,order:Ot,clipMask:vn,clipScope:gn})}this.replacementSource.setSources(ct),H=!0}}this._clippingActiveLastFrame=Z,H||this.replacementSource.clear(),this.conflationActive=H,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let rt=0;rt<j.length;rt++){const Ue=j[rt],xt=Ue.cutoffRange();if(this.longestCutoffRange=Math.max(xt,this.longestCutoffRange),xt>0){const ct=Ce(Ue);ct&&(this.minCutoffZoom=Math.max(ct.minzoom,this.minCutoffZoom)),Ue.minzoom&&(this.minCutoffZoom=Math.max(Ue.minzoom,this.minCutoffZoom))}Ue.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=rt),this._lastOcclusionLayer=rt)}const Ae=this.style&&this.style.fog;Ae?(this._fogVisible=Ae.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ae),this.opaquePassCutoff=0,S=b(),j=S.map((rt=>g[rt])));const ke=this._shadowRenderer;if(ke){ke.updateShadowParameters(this.transform,this.style.directionalLight);for(const rt in B)for(const Ue of re[rt]){let xt={min:0,max:0};this.terrain&&(xt=this.terrain.getMinMaxForTile(Ue)||xt),ke.addShadowReceiver(Ue.toUnwrapped(),xt.min,xt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new bu(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Ee=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Me&&!this._snow&&(this._snow=new dy(this)),!Me&&this._snow&&(this._snow.destroy(),delete this._snow),Ee&&!this._rain&&(this._rain=new br(this)),!Ee&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),O){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Ur);const rt=this.style.getLayerSourceCache(O);this.buildingTileBorderManager.updateBorders(rt,O)}if(!Rt.has(this.context.gl))return;this.renderPass="offscreen";for(const rt of j){const Ue=t.getLayerSourceCache(rt);if(!rt.hasOffscreenPass()||rt.isHidden(this.transform.zoom))continue;const xt=Ue?$[Ue.id]:void 0;(rt.type==="custom"||rt.type==="raster"||rt.type==="raster-particle"||rt.isSky()||xt&&xt.length)&&this.renderLayer(this,Ue,rt,xt)}this.depthRangeFor3D=[0,1-(j.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,pe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ze=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ot=(()=>{if(a.showOverdrawInspector)return r.ao.black;const rt=this.style.fog;if(rt&&this.transform.projection.supportsFog){const Ue=this.style.getLut(rt.scope);if(!ze){const xt=rt.properties.get("color-use-theme")==="none",ct=rt.properties.get("color").toNonPremultipliedRenderColor(xt?null:Ue).toArray01();return new r.ao(...ct)}if(ze){const xt=rt.properties.get("space-color-use-theme")==="none",ct=rt.properties.get("space-color").toNonPremultipliedRenderColor(xt?null:Ue).toArray01();return new r.ao(...ct)}}return r.ao.transparent})();if(this.context.clear({color:ot,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ze&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const rt=j[this.currentLayer],Ue=t.getLayerSourceCache(rt);if(rt.isSky())continue;const xt=Ue?(rt.is3D(y)?ye:$)[Ue.id]:void 0;this._renderTileClippingMasks(rt,Ue,xt),this.renderLayer(this,Ue,rt,xt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ze&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const rt=j[this.currentLayer],Ue=t.getLayerSourceCache(rt);rt.isSky()&&this.renderLayer(this,Ue,rt,Ue?$[Ue.id]:void 0)}function Ze(rt,Ue){let xt;return Ue&&(xt=(rt.type==="symbol"?ae:rt.is3D(y)?ye:$)[Ue.id]),xt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){const rt=j[this.currentLayer];if(rt.type==="raster"||rt.type==="raster-particle"){const Ue=t.getLayerSourceCache(rt);this.renderLayer(this,Ue,rt,Ze(rt,Ue))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let mt=0;ke&&(mt=ke.getShadowCastingLayerCount());let $e=!1,pt=-1;for(let rt=0;rt<S.length;++rt){const Ue=j[rt];Ue.isHidden(this.transform.zoom)||Ue.is3D(y)&&(pt=rt)}D&&pt===-1&&(M=!0);let Ht=!1;for(;this.currentLayer<S.length;){const rt=j[this.currentLayer],Ue=t.getLayerSourceCache(rt);if(rt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(rt)){if(rt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ht&&rt.is3D(y)&&!y){const xt=this.currentLayer,ct=Ct=>{for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const qt=j[this.currentLayer];if(Mc[qt.type]){const nn=this.style.getLayerSourceCache(qt);Mc[qt.type](this,nn,qt,Ze(qt,nn),Ct)}}};ct("initialize"),ct("reset"),this.currentLayer=xt,Ht=!0}if(M&&!$e&&this.terrain&&!this.transform.isOrthographic&&($e=!0,this.blitDepth()),D&&pt!==-1&&this.currentLayer===pt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(rt,Ue,Ue?re[Ue.id]:void 0),this.renderLayer(this,Ue,rt,Ze(rt,Ue)),!this.terrain&&ke&&mt>0&&rt.hasShadowPass()&&--mt==0){{this.clearStencil(),this.resetStencilClippingMasks();const xt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const ct=j[this.currentLayer];if(Ul[ct.type]){const Ct=this.style.getLayerSourceCache(ct);Ul[ct.type](this,Ct,ct,Ze(ct,Ct))}}this.currentLayer=xt}if(ke.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const xt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=xt;this.currentLayer++){const ct=j[this.currentLayer];if(!ct.hasLightBeamPass())continue;const Ct=t.getLayerSourceCache(ct);this.renderLayer(this,Ct,ct,Ct?$[Ct.id]:void 0)}this.currentLayer=xt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const xt=this.currentLayer;this.depthOcclusion=!0;for(const ct of this.layersWithOcclusionOpacity){this.currentLayer=ct;const Ct=j[this.currentLayer],qt=t.getLayerSourceCache(Ct),nn=qt?$[qt.id]:void 0;this.terrain||this._renderTileClippingMasks(Ct,qt,qt?re[qt.id]:void 0),this.renderLayer(this,qt,Ct,nn)}this.depthOcclusion=!1,this.currentLayer=xt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let rt=null;j.forEach((Ue=>{const xt=t.getLayerSourceCache(Ue);xt&&!Ue.isHidden(this.transform.zoom)&&xt.getVisibleCoordinates().length&&(!rt||rt.getSource().maxzoom<xt.getSource().maxzoom)&&(rt=xt)})),rt&&this.options.showTileBoundaries&&cf(this,rt,rt.getVisibleCoordinates(),r.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&cf(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(rt){const Ue=rt.transform.padding;za(rt,rt.transform.height-(Ue.top||0),3,ps),za(rt,Ue.bottom||0,3,Bl),dr(rt,Ue.left||0,3,ny),dr(rt,rt.transform.width-(Ue.right||0),3,xm);const xt=rt.transform.centerPoint;(function(ct,Ct,qt,nn){wc(ct,Ct-1,qt-10,2,20,nn),wc(ct,Ct-10,qt-1,20,2,nn)})(rt,xt.x,rt.transform.height-xt.y,bm)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),H||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:a}=this.transform.projection,h=!a||!a.includes(t.type);if(Ic[t.type]&&(h||this.terrain&&t.type==="custom")){const g=this.style.getLayerSourceCache(t);Ic[t.type](t,g,this)}this.gpuTimingEnd()}renderLayer(t,a,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||g&&g.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)&&(!t.terrain||h.type!=="custom")||h.type==="clip"||Vl[h.type](t,a,h,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,h=this.context.gl;let g=this.gpuTimers[t.id];g||(g=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:h.createQuery()}),g.calls++,h.beginQuery(a.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,a=this.context.gl,h=a.createQuery();this.deferredRenderGpuTimeQueries.push(h),a.beginQuery(t.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const a={};for(const h in t){const g=t[h],y=this.context.extTimerQuery,b=y.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(g.query),a[h]=b}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let h=0;for(const g of t)h+=a.getQueryParameter(g,a.QUERY_RESULT)/1e6,a.deleteQuery(g);return h}translatePosMatrix(t,a,h,g,y){if(!h[0]&&!h[1])return t;const b=y?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(b){const D=Math.sin(b),O=Math.cos(b);h=[h[0]*O-h[1]*D,h[0]*D+h[1]*O]}const S=[y?h[0]:r.ay(a,h[0],this.transform.zoom),y?h[1]:r.ay(a,h[1],this.transform.zoom),0],M=new Float32Array(16);return r.br(M,t,S),M}saveTileTexture(t){if(t.context!==this.context)return;const a=t.size[0],h=this._tileTextures[a];h?h.push(t):this._tileTextures[a]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,a,h){const g=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,y=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||g||a!==void 0&&!a||y.push("FOG","FOG_DITHERING"),g&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(t,a){this.cache=this.cache||{};const h=a&&a.defines||[],g=a&&a.config,y=this.currentGlobalDefines(t,a&&a.overrideFog,a&&a.overrideRtt).concat(h),b=Xd.cacheKey(Ld[t],t,y,g);return this.cache[b]||(this.cache[b]=new Xd(this.context,t,Ld[t],g,Ux[t],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,a){if(this.style.enable3dLights()){const h=this.style.directionalLight,g=this.style.ambientLight;if(h&&g){const y=((b,S,M)=>{const D=b.properties.get("direction"),O=b.properties.get("color-use-theme")==="none",j=b.properties.get("color").toNonPremultipliedRenderColor(O?null:M.getLut(b.scope)).toArray01(),B=b.properties.get("intensity"),q=S.properties.get("color-use-theme")==="none",H=S.properties.get("color").toNonPremultipliedRenderColor(q?null:M.getLut(S.scope)).toArray01(),Z=S.properties.get("intensity"),re=[D.x,D.y,D.z],$=r.dK(H,Z),ae=r.dK(j,B);return{u_lighting_ambient_color:$,u_lighting_directional_dir:re,u_lighting_directional_color:ae,u_ground_radiance:Zd(re,ae,$)}})(h,g,this.style);a.setLightsUniformValues(t,y)}}}uploadCommonUniforms(t,a,h,g,y){if(this.uploadCommonLightUniforms(t,a),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const S=b.getOpacity(this.transform.pitch),M=((D,O,j,B,q,H,Z,re,$,ae,pe,ye)=>{const Ce=D.transform,Ae=O.properties.get("color-use-theme")==="none",ke=O.properties.get("color").toNonPremultipliedRenderColor(Ae?null:D.style.getLut(O.scope)).toArray01();ke[3]=B;const Me=D.frameCounter/1e3%1,[Ee,ze]=O.properties.get("vertical-range");return{u_fog_matrix:j?Ce.calculateFogTileMatrix(j):ye||D.identityMat,u_fog_range:O.getFovAdjustedRange(Ce._fov),u_fog_color:ke,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ee,ze),ze],u_fog_temporal_offset:Me,u_frustum_tl:q,u_frustum_tr:H,u_frustum_br:Z,u_frustum_bl:re,u_globe_pos:$,u_globe_radius:ae,u_viewport:pe,u_globe_transition:r.aj(Ce.zoom),u_is_globe:+(Ce.projection.name==="globe")}})(this,b,h,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.o.devicePixelRatio,this.transform.height*r.o.devicePixelRatio],g);a.setFogUniformValues(t,M)}y&&a.setCutoffUniformValues(t,y.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const g of h)a[g.key]=t[g.key]||new El(g,512,this.transform.tileZoom,this,void 0,this.worldview);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,a){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[t.key];return a||(this._cachedTileFogOpacities[t.key]=a=this.style.fog.getOpacityForTile(t)),a[0]>=dn||a[1]>=dn}setupDepthForOcclusion(t,a,h){const g=this.context,y=g.gl,b=!!h;var S;h||(h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(y.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),h.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],h.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],h.u_occluder_half_size=.5*this.occlusionParams.occluderSize,h.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),g.activeTexture.set(y.TEXTURE0),b||a.setTerrainUniformValues(g,h)}}function pf(d,t){let a=!1,h=null;const g=()=>{h=null,a&&(d(),h=setTimeout(g,t),a=!1)};return()=>(a=!0,h||g(),h)}class Im{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=pf(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const a=mf(t);if(this._hashName){const h=this._hashName;let g=!1;const y=location.hash.slice(1).split("&").map((b=>{const S=b.split("=")[0];return S===h?(g=!0,`${S}=${a}`):b})).filter((b=>b));return g||y.push(`${h}=${a}`),`#${y.join("&")}`}return`#${a}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map((h=>h.split("="))).forEach((h=>{h[0]===this._hashName&&(a=h)})),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some((h=>isNaN(Number(h))))){const h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:h,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function mf(d,t){const a=d.getCenter(),h=Math.round(100*d.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),b=Math.round(a.lng*y)/y,S=Math.round(a.lat*y)/y,M=d.getBearing(),D=d.getPitch();let O=t?`/${b}/${S}/${h}`:`${h}/${S}/${b}`;return(M||D)&&(O+="/"+Math.round(10*M)/10),D&&(O+=`/${Math.round(D)}`),O}const Ss={linearity:.3,easing:r.eK(0,0,.3,1)},jl=Object.assign({deceleration:2500,maxSpeed:1400},Ss),Eu=Object.assign({deceleration:20,maxSpeed:1400},Ss),gf=Object.assign({deceleration:1e3,maxSpeed:360},Ss),Mm=Object.assign({deceleration:1e3,maxSpeed:90},Ss);class Cm{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=r.o.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)a.zoom+=y.zoomDelta||0,a.bearing+=y.bearingDelta||0,a.pitch+=y.pitchDelta||0,y.panDelta&&a.pan._add(y.panDelta),y.around&&(a.around=y.around),y.pinchAround&&(a.pinchAround=y.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const y=Au(a.pan.mag(),h,Object.assign({},jl,t||{}));g.offset=a.pan.mult(y.amount/a.pan.mag()),g.center=this._map.transform.center,ba(g,y)}if(a.zoom){const y=Au(a.zoom,h,Eu);g.zoom=this._map.transform.zoom+y.amount,ba(g,y)}if(a.bearing){const y=Au(a.bearing,h,gf);g.bearing=this._map.transform.bearing+r.aA(y.amount,-179,179),ba(g,y)}if(a.pitch){const y=Au(a.pitch,h,Mm);g.pitch=this._map.transform.pitch+y.amount,ba(g,y)}if(g.zoom||g.bearing){const y=a.pinchAround===void 0?a.around:a.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function ba(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function Au(d,t,a){const{maxSpeed:h,linearity:g,deceleration:y}=a,b=r.aA(d*g/(t/1e3),-h,h),S=Math.abs(b)/(y*g);return{easing:a.easing,duration:1e3*S,amount:b*(S/2)}}class vo extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,h,g={}){const y=te(a.getCanvasContainer(),h),b=a.unproject(y);super(t,Object.assign({point:y,lngLat:b,originalEvent:h},g)),this._defaultPrevented=!1,this.target=a}}class Iu extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,h){const g=t==="touchend"?h.changedTouches:h.touches,y=ie(a.getCanvasContainer(),g),b=y.map((M=>a.unproject(M))),S=y.reduce(((M,D,O,j)=>M.add(D.div(j.length))),new r.P(0,0));super(t,{points:y,point:S,lngLats:b,lngLat:a.unproject(S),originalEvent:h}),this._defaultPrevented=!1}}class _f extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class Pm{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new _f(this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new vo(t.type,this._map,t))}mouseup(t){this._map.fire(new vo(t.type,this._map,t))}preclick(t){const a=new MouseEvent("preclick",t);this._map.fire(new vo(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new vo(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new vo(t.type,this._map,t))}mouseover(t){this._map.fire(new vo(t.type,this._map,t))}mouseout(t){this._map.fire(new vo(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Iu(t.type,this._map,t))}touchmove(t){this._map.fire(new Iu(t.type,this._map,t))}touchend(t){this._map.fire(new Iu(t.type,this._map,t))}touchcancel(t){this._map.fire(new Iu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class km{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new vo(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new vo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new vo(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eo{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(ce(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const h=a,g=this._startPos,y=this._lastPos;if(!g||!y||y.equals(h)||!this._box&&h.dist(g)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=G("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(g.x,h.x),S=Math.max(g.x,h.x),M=Math.min(g.y,h.y),D=Math.max(g.y,h.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${b}px,${M}px)`,this._box.style.width=S-b+"px",this._box.style.height=D-M+"px")}))}mouseupWindow(t,a){if(!this._active)return;const h=this._startPos,g=a;if(h&&t.button===0){if(this.reset(),_e(),h.x!==g.x||h.y!==g.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(h,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),me(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new r.z(t,{originalEvent:a}))}}function Mh(d,t){const a={};for(let h=0;h<d.length;h++)a[d[h].identifier]=t[h];return a}class Rm{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=(function(g){const y=new r.P(0,0);for(const b of g)y._add(b);return y.div(g.length)})(a),this.touches=Mh(h,a)))}touchmove(t,a,h){if(this.aborted||!this.centroid)return;const g=Mh(h,a);for(const y in this.touches){const b=g[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,a,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Ch{constructor(t){this.singleTap=new Rm(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,h){this.singleTap.touchstart(t,a,h)}touchmove(t,a,h){this.singleTap.touchmove(t,a,h)}touchend(t,a,h){const g=this.singleTap.touchend(t,a,h);if(g){const y=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(g)<30;if(y&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Cc{constructor(){this._zoomIn=new Ch({numTouches:1,numTaps:2}),this._zoomOut=new Ch({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,h){this._zoomIn.touchstart(t,a,h),this._zoomOut.touchstart(t,a,h)}touchmove(t,a,h){this._zoomIn.touchmove(t,a,h),this._zoomOut.touchmove(t,a,h)}touchend(t,a,h){const g=this._zoomIn.touchend(t,a,h),y=this._zoomOut.touchend(t,a,h);return g?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(g)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const zm={0:1,2:2},yf={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Ph{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const h=xe(t);this._correctButton(t,h)&&(this._lastPoint=a,this._eventButton=h)}mousemoveWindow(t,a){const h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&(function(g,y){const b=zm[y];return g.buttons===void 0||(g.buttons&b)!==b})(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(h,a)}}mouseupWindow(t){this._lastPoint&&xe(t)===this._eventButton&&(this._moved&&_e(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mu extends Ph{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class vf extends Ph{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?yf[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const h=.8*(a.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class xf extends Ph{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?yf[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const h=-.5*(a.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Dm{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),r.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,a,h){return this._calculateTransform(t,a,h)}touchmove(t,a,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!r.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,a,h)}}touchend(t,a,h){this._calculateTransform(t,a,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,h){h.length>0&&(this._active=!0);const g=Mh(h,a),y=new r.P(0,0),b=new r.P(0,0);let S=0;for(const D in g){const O=g[D],j=this._touches[D];j&&(y._add(O),b._add(O.sub(j)),S++,g[D]=O)}if(this._touches=g,S<this._minTouches||!b.mag())return;const M=b.div(S);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Cu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,h){return{}}touchstart(t,a,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,h){const g=this._firstTwoTouches;if(!g)return;t.preventDefault();const[y,b]=g,S=Pu(h,a,y),M=Pu(h,a,b);if(!S||!M)return;const D=this._aroundCenter?null:S.add(M).div(2);return this._move([S,M],D,t)}touchend(t,a,h){if(!this._firstTwoTouches)return;const[g,y]=this._firstTwoTouches,b=Pu(h,a,g),S=Pu(h,a,y);b&&S||(this._active&&_e(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pu(d,t,a){for(let h=0;h<d.length;h++)if(d[h].identifier===a)return t[h]}function bf(d,t){return Math.log2(d/t)}class fy extends Cu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(bf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bf(this._distance,h),pinchAround:a}}}function Lm(d,t){return 180*d.angleWith(t)/Math.PI}class py extends Cu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const h=this._vector;if(this._vector=t[0].sub(t[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Lm(this._vector,h),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const g=Lm(t,h);return Math.abs(g)<a}}function wf(d){return Math.abs(d.y)>Math.abs(d.x)}class my extends Cu{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,wf(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,h){const g=this._lastPoints;if(!g)return;const y=t[0].sub(g[0]),b=t[1].sub(g[1]);return this._map._cooperativeGestures&&!r.eL()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(y,b,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5})}gestureBeginsVertically(t,a,h){if(this._valid!==void 0)return this._valid;const g=t.mag()>=2,y=a.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const b=t.y>0==a.y>0;return wf(t)&&wf(a)&&b}}const gy={panStep:100,bearingStep:15,pitchStep:10};class _y{constructor(){const t=gy;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,h=0,g=0,y=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:S=>{const M=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:yy,zoom:a?Math.round(M)+a*(t.shiftKey?2:1):M,bearing:S.getBearing()+h*this._bearingStep,pitch:S.getPitch()+g*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function yy(d){return d*(2-d)}const Om=4.000244140625,vy=1/450;class xy{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=vy,r.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=r.o.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,a!==0&&a%Om==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=te(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>Om?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&O!==0&&(O=1/O);const j=a(),B=Math.pow(2,j),q=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(q*O))),this._type==="wheel"&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:a(),g=this._startZoom,y=this._easing;let b,S=!1;if(this._type==="wheel"&&g&&y){const D=Math.min((r.o.now()-this._lastWheelEventTime)/200,1),O=y(D);b=r.ak(g,h,O),D<1?this._frameId||(this._frameId=!0):S=!0}else b=h,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let M=b-a();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=r.eM;if(this._prevEase){const h=this._prevEase,g=(r.o.now()-h.start)/h.duration,y=h.easing(g+.01)-h.easing(g),b=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-b*b);a=r.eK(b,S,.25,1)}return this._prevEase={start:r.o.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class by{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wy{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xx{constructor(){this._tap=new Ch({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=a[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,a,h))}touchmove(t,a,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const g=a[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,a,h)}touchend(t,a,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,a,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yx{constructor(t,a,h){this._el=t,this._mousePan=a,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Kx{constructor(t,a,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fr{constructor(t,a,h,g){this._el=t,this._touchZoom=a,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const kh=d=>d.zoom||d.drag||d.pitch||d.rotate;class Jx extends r.z{}class Qx{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const h=r.av([],a,t);this.radius=r.ag(h[2]<0?r.eO([],h,this.constants):[h[0],h[1],0])}projectRay(t){r.eO(t,t,this.constants),r.aw(t,t),r.eP(t,t,this.constants);const a=r.c4([],t,this.radius);if(a[2]>0){const h=r.c4([],[0,0,1],r.bJ(a,[0,0,1])),g=r.c4([],r.aw([],[a[0],a[1],0]),this.radius),y=r.d7([],a,r.c4([],r.av([],r.d7([],g,h),a),2));a[0]=y[0],a[1]=y[1]}return a}}function Tf(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Rh{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cm(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Qx,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),r.aY(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,y,b]of this._listeners){const S=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(y,S,b)}}destroy(){for(const[t,a,h]of this._listeners){const g=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(a,g,h)}}_addDefaultHandlers(t){const a=this._map,h=a.getCanvasContainer();this._add("mapEvent",new Pm(a,t));const g=a.boxZoom=new Eo(a,t);this._add("boxZoom",g);const y=new Cc,b=new wy;a.doubleClickZoom=new by(b,y),this._add("tapZoom",y),this._add("clickZoom",b);const S=new Xx;this._add("tapDragZoom",S);const M=a.touchPitch=new my(a);this._add("touchPitch",M);const D=new vf(t),O=new xf(t);a.dragRotate=new Kx(t,D,O),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const j=new Mu(t),B=new Dm(a,t);a.dragPan=new Yx(h,j,B),this._add("mousePan",j),this._add("touchPan",B,["touchZoom","touchRotate"]);const q=new py,H=new fy;a.touchZoomRotate=new Fr(h,H,q,S),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new km(a));const Z=a.scrollZoom=new xy(a,this);this._add("scrollZoom",Z,["mousePan"]);const re=a.keyboard=new _y;this._add("keyboard",re);for(const $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[$]&&a[$].enable(t[$])}_add(t,a,h){this._handlers.push({handlerName:t,handler:a,allowed:h}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!kh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,a,h){for(const g in t)if(g!==h&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const h of t)this._el.contains(h.target)&&a.push(h);return a}handleEvent(t,a){this._updatingCamera=!0;const h=t.type==="renderFrame",g=h?void 0:t,y={needsRenderFrame:!1},b={},S={},M=t.touches?this._getMapTouches(t.touches):void 0,D=M?ie(this._el,M):h?void 0:te(this._el,t);for(const{handlerName:B,handler:q,allowed:H}of this._handlers){if(!q.isEnabled())continue;let Z;this._blockedByActive(S,H,B)?q.reset():q[a||t.type]&&(Z=q[a||t.type](t,D,M),this.mergeHandlerResult(y,b,Z,B,g),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||q.isActive())&&(S[B]=q)}const O={};for(const B in this._previousActiveHandlers)S[B]||(O[B]=g);this._previousActiveHandlers=S,(Object.keys(O).length||Tf(y))&&(this._changes.push([y,b,O]),this._triggerRenderFrame()),(Object.keys(S).length||Tf(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=y;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(t,a,h,g,y){if(!h)return;Object.assign(t,h);const b={handlerName:g,originalEvent:h.originalEvent||y};h.zoomDelta!==void 0&&(a.zoom=b),h.panDelta!==void 0&&(a.drag=b),h.pitchDelta!==void 0&&(a.pitch=b),h.bearingDelta!==void 0&&(a.rotate=b)}_applyChanges(){const t={},a={},h={};for(const[g,y,b]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.aroundCoord!==void 0&&(t.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),Object.assign(a,y),Object.assign(h,b);this._updateMapTransform(t,a,h),this._changes=[]}_updateMapTransform(t,a,h){const g=this._map,y=g.transform,b=ae=>[ae.x,ae.y,ae.z];if((ae=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!Tf(t)){const ae=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),ae!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&g._stop(!0),!Tf(t))return void this._fireEvents(a,h,!0);let{panDelta:S,zoomDelta:M,bearingDelta:D,pitchDelta:O,around:j,aroundCoord:B,pinchAround:q}=t;y._isCameraConstrained&&(M>0&&(M=0),y._isCameraConstrained=!1),q!==void 0&&(j=q),(M||(ae=>a[ae]&&!this._eventsInProgress[ae])("drag"))&&j&&(this._dragOrigin=b(y.pointCoordinate3D(j)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",g._stop(!0),j=j||g.transform.centerPoint,D&&(y.bearing+=D),O&&(y.pitch+=O),y._updateCameraState();const H=[0,0,0];if(S)if(y.projection.name==="mercator"){const ae=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(j).dir),pe=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(j.sub(S)).dir);H[0]=pe[0]-ae[0],H[1]=pe[1]-ae[1]}else{const ae=y.pointCoordinate(j);if(y.projection.name==="globe"){S=S.rotate(-y.angle);const pe=y._pixelsPerMercatorPixel/y.worldSize;H[0]=-S.x*r.eN(r.a$(ae.y))*pe,H[1]=-S.y*r.eN(y.center.lat)*pe}else{const pe=y.pointCoordinate(j.sub(S));ae&&pe&&(H[0]=pe.x-ae.x,H[1]=pe.y-ae.y)}}const Z=y.zoom,re=[0,0,0];if(M){const ae=b(B||y.pointCoordinate3D(j)),pe={dir:r.aw([],r.av([],ae,y._camera.position))};if(pe.dir[2]<0){const ye=y.zoomDeltaToMovement(ae,M);r.c4(re,pe.dir,ye)}}const $=r.d7(H,H,re);y._translateCameraConstrained($),M&&Math.abs(y.zoom-Z)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,h,!0)}_fireEvents(t,a,h){const g=kh(this._eventsInProgress),y=kh(t),b={};for(const O in t){const{originalEvent:j}=t[O];this._eventsInProgress[O]||(b[`${O}start`]=j),this._eventsInProgress[O]=t[O]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(const O in b)this._fireEvent(O,b[O]);y&&this._fireEvent("move",y.originalEvent);for(const O in t){const{originalEvent:j}=t[O];this._fireEvent(O,j)}const S={};let M;for(const O in this._eventsInProgress){const{handlerName:j,originalEvent:B}=this._eventsInProgress[O];this._handlersById[j].isActive()||(delete this._eventsInProgress[O],M=a[j]||B,S[`${O}end`]=M)}for(const O in S)this._fireEvent(O,S[O]);const D=kh(this._eventsInProgress);if(h&&(g||y)&&!D){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;O?(j(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:M})):(this._map.fire(new r.z("moveend",{originalEvent:M})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new r.z(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new Jx("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Fm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Bm extends r.E{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,r.aY(["_renderFrameCallback"],this)}getCenter(){return new r.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,h){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},a),h)}panTo(t,a,h){return this.easeTo(Object.assign({center:t},a),h)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,h){return this.easeTo(Object.assign({zoom:t},a),h)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,h){return this.easeTo(Object.assign({bearing:t},a),h)}resetNorth(t,a){return this.rotateTo(0,Object.assign({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=r.aI.convert(t);const h=a&&a.bearing||0,g=a&&a.pitch||0,y=t.getNorthWest(),b=t.getSouthEast();return this._cameraForBounds(this.transform,y,b,h,g,a)}_extendPadding(t){const a={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},a,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},a,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,a){const h=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return h/g>t.aspect?h/(2*Math.tan(.5*t.fovX)*t.aspect):g/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,a,h,g,y,b){const S=t.clone(),M=this._extendCameraOptions(b);S.bearing=g,S.pitch=y;const D=r.aR.convert(a),O=r.aR.convert(h),j=.5*(D.lat+O.lat),B=.5*(D.lng+O.lng),q=r.eQ(j,B),H=r.aw([],q),Z=r.aw([],r.bI([],H,[0,1,0])),re=r.bI([],Z,H),$=[Z[0],Z[1],Z[2],0,re[0],re[1],re[2],0,H[0],H[1],H[2],0,0,0,0,1],ae=[q,r.eQ(D.lat,D.lng),r.eQ(O.lat,D.lng),r.eQ(O.lat,O.lng),r.eQ(D.lat,O.lng),r.eQ(j,D.lng),r.eQ(j,O.lng),r.eQ(D.lat,B),r.eQ(O.lat,B)];let pe=r.d8.fromPoints(ae.map((ct=>[r.bJ(Z,ct),r.bJ(re,ct),r.bJ(H,ct)])));const ye=r.af([],pe.center,$);r.eR(ye)===0&&r.eS(ye,0,0,1),r.aw(ye,ye),r.c4(ye,ye,r.aD),S.center=r.eT(ye);const Ce=S.getWorldToCameraMatrix(),Ae=r.bl(new Float64Array(16),Ce);pe=r.d8.applyTransform(pe,r.aB([],Ce,$));const ke=this._extendAABB(pe,S,M,g);if(!ke)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=ke,r.af(ye,ye,Ce);const Me=.5*(pe.max[2]-pe.min[2]),Ee=this._minimumAABBFrustumDistance(S,pe),ze=r.c4([],[0,0,1],Me),ot=r.d7(ze,ye,ze),Ze=Ee+(S.pitch===0?0:r.bG(ye,ot)),mt=S.globeCenterInViewSpace,$e=r.av([],ye,[mt[0],mt[1],mt[2]]);r.aw($e,$e),r.c4($e,$e,Ze);const pt=r.d7([],ye,$e);r.af(pt,pt,Ae);const Ht=r.eD/r.aD,rt=r.ag(pt),Ue=r.ce(Math.max(rt*Ht-r.eD,Number.EPSILON),0),xt=Math.min(S.zoomFromMercatorZAdjusted(Ue),M.maxZoom);return xt>.5*(r.cZ+r.cK)?(S.setProjection({name:"mercator"}),S.zoom=xt,this._cameraForBounds(S,a,h,g,y,b)):{center:S.center,zoom:xt,bearing:g,pitch:y}}_extendAABB(t,a,h,g){const y=.5*((h.padding.left||0)+(h.padding.right||0)),b=.5*((h.padding.top||0)+(h.padding.bottom||0)),S=b,M=y,D=y,O=b,j=a.width-(M+D),B=a.height-(S+O),q=r.av([],t.max,t.min),H=Math.min(j/q[0],B/q[1]),Z=Math.min(a.scaleZoom(a.scale*H),h.maxZoom);if(isNaN(Z))return null;const re=a.scale/a.zoomScale(Z),$=new r.d8([t.min[0]-M*re,t.min[1]-O*re,t.min[2]],[t.max[0]+D*re,t.max[1]+S*re,t.max[2]]),ae=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new r.P(h.offset.x,h.offset.y):r.P.convert(h.offset)).rotate(-r.an(g));return $.center[0]-=ae.x*re,$.center[1]+=ae.y*re,$}queryTerrainElevation(t,a){const h=this.transform.elevation;return h?(a=Object.assign({},{exaggerated:!0},a),h.getAtPoint(r.ae.fromLngLat(t),null,a.exaggerated)):null}_cameraForBounds(t,a,h,g,y,b){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,a,h,g,y,b);const S=t.clone(),M=this._extendCameraOptions(b);S.bearing=g,S.pitch=y;const D=r.aR.convert(a),O=r.aR.convert(h),j=new r.aR(D.lng,O.lat),B=new r.aR(O.lng,D.lat),q=S.project(D),H=S.project(O),Z=this.queryTerrainElevation(D),re=this.queryTerrainElevation(O),$=this.queryTerrainElevation(j),ae=this.queryTerrainElevation(B),pe=[[q.x,q.y,Math.min(Z||0,re||0,$||0,ae||0)],[H.x,H.y,Math.max(Z||0,re||0,$||0,ae||0)]];let ye=r.d8.fromPoints(pe);const Ce=S.getWorldToCameraMatrix(),Ae=r.bl(new Float64Array(16),Ce);ye=r.d8.applyTransform(ye,Ce);const ke=this._extendAABB(ye,S,M,g);if(!ke)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=ke;const Me=.5*r.av([],ye.max,ye.min)[2],Ee=this._minimumAABBFrustumDistance(S,ye),ze=[0,0,1,0];r.aC(ze,ze,Ce),r.eU(ze,ze);const ot=r.c4([],ze,Ee+Me),Ze=r.d7([],ye.center,ot);r.af(ye.center,ye.center,Ae),r.af(Ze,Ze,Ae);const mt=S.unproject(new r.P(ye.center[0],ye.center[1])),$e=r.eV(S.projection,mt),pt=Math.pow(2,$e),Ht=Math.min(S._zoomFromMercatorZ(Ze[2]*S.pixelsPerMeter*pt/S.worldSize),M.maxZoom);return S.mercatorFromTransition&&Ht<.5*(r.cZ+r.cK)?(S.setProjection({name:"globe"}),S.zoom=Ht,this._cameraForBounds(S,a,h,g,y,b)):{center:mt,zoom:Ht,bearing:g,pitch:y}}fitBounds(t,a,h){const g=this.cameraForBounds(t,a);return this._fitInternal(g,a,h)}fitScreenCoordinates(t,a,h,g,y){const b=r.P.convert(t),S=r.P.convert(a),M=new r.P(Math.min(b.x,S.x),Math.min(b.y,S.y)),D=new r.P(Math.max(b.x,S.x),Math.max(b.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,S))return this;const O=this.transform.pointLocation3D(M),j=this.transform.pointLocation3D(D),B=this.transform.pointLocation3D(new r.P(M.x,D.y)),q=this.transform.pointLocation3D(new r.P(D.x,M.y)),H=[Math.min(O.lng,j.lng,B.lng,q.lng),Math.min(O.lat,j.lat,B.lat,q.lat)],Z=[Math.max(O.lng,j.lng,B.lng,q.lng),Math.max(O.lat,j.lat,B.lat,q.lat)],re=g&&g.pitch?g.pitch:this.getPitch(),$=this._cameraForBounds(this.transform,H,Z,h,re,g);return this._fitInternal($,g,y)}_fitInternal(t,a,h){return t?(a=Object.assign(t,a)).linear?this.easeTo(a,h):this.flyTo(a,h):this}jumpTo(t,a){this.stop();const h=t.preloadOnly?this.transform.clone():this.transform;let g=!1,y=!1,b=!1;"zoom"in t&&h.zoom!==+t.zoom&&(g=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=r.aR.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(y=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(b=!0,h.pitch=+t.pitch);const S=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!h.isPaddingEqual(S))if(t.retainPadding===!1){const M=h.clone();M.padding=S,h.setLocationAtPoint(h.center,M.centerPoint)}else h.padding=S;return t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new r.z("movestart",a)).fire(new r.z("move",a)),g&&this.fire(new r.z("zoomstart",a)).fire(new r.z("zoom",a)).fire(new r.z("zoomend",a)),y&&this.fire(new r.z("rotatestart",a)).fire(new r.z("rotate",a)).fire(new r.z("rotateend",a)),b&&this.fire(new r.z("pitchstart",a)).fire(new r.z("pitch",a)).fire(new r.z("pitchend",a)),this.fire(new r.z("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Fm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const h=this.transform;if(!h.projection.supportsFreeCamera)return r.w(Fm),this;this.stop();const g=h.zoom,y=h.pitch,b=h.bearing;h.setFreeCameraOptions(t);const S=g!==h.zoom,M=y!==h.pitch,D=b!==h.bearing;return this.fire(new r.z("movestart",a)).fire(new r.z("move",a)),S&&this.fire(new r.z("zoomstart",a)).fire(new r.z("zoom",a)).fire(new r.z("zoomend",a)),D&&this.fire(new r.z("rotatestart",a)).fire(new r.z("rotate",a)).fire(new r.z("rotateend",a)),M&&this.fire(new r.z("pitchstart",a)).fire(new r.z("pitch",a)).fire(new r.z("pitchend",a)),this.fire(new r.z("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:r.eM},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const h=this.transform,g=this.getZoom(),y=this.getBearing(),b=this.getPitch(),S=this.getPadding(),M="zoom"in t?+t.zoom:g,D="bearing"in t?this._normalizeBearing(t.bearing,y):y,O="pitch"in t?+t.pitch:b,j=this._extendPadding(t.padding),B=r.P.convert(t.offset);let q,H,Z;if(h.projection.name==="globe"){const ze=r.ae.fromLngLat(h.center),ot=B.rotate(-h.angle);ze.x+=ot.x/h.worldSize,ze.y+=ot.y/h.worldSize;const Ze=ze.toLngLat(),mt=r.aR.convert(t.center||Ze);this._normalizeCenter(mt),q=h.centerPoint.add(ot),H=new r.P(ze.x,ze.y).mult(h.worldSize),Z=new r.P(r.aF(mt.lng),r.aJ(mt.lat)).mult(h.worldSize).sub(H)}else{q=h.centerPoint.add(B);const ze=h.pointLocation(q),ot=r.aR.convert(t.center||ze);this._normalizeCenter(ot),H=h.project(ze),Z=h.project(ot).sub(H)}const re=h.zoomScale(M-g);let $,ae;t.around&&($=r.aR.convert(t.around),ae=h.locationPoint($));const pe=this._zooming||M!==g,ye=this._rotating||y!==D,Ce=this._pitching||O!==b,Ae=!h.isPaddingEqual(j),ke=t.retainPadding===!1?h.clone():h,Me=ze=>ot=>{if(pe&&(ze.zoom=r.ak(g,M,ot)),ye&&(ze.bearing=r.ak(y,D,ot)),Ce&&(ze.pitch=r.ak(b,O,ot)),Ae&&(ke.interpolatePadding(S,j,ot),q=ke.centerPoint.add(B)),$)ze.setLocationAtPoint($,ae);else{const Ze=ze.zoomScale(ze.zoom-g),mt=M>g?Math.min(2,re):Math.max(.5,re),$e=Math.pow(mt,1-ot),pt=ze.unproject(H.add(Z.mult(ot*$e)).mult(Ze));ze.setLocationAtPoint(ze.renderWorldCopies?pt.wrap():pt,q)}return t.preloadOnly||this._fireMoveEvents(a),ze};if(t.preloadOnly){const ze=this._emulate(Me,t.duration,h);return this._preloadTiles(ze),this}const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=ye,this._pitching=Ce,this._padding=Ae,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Ee),this._ease(Me(h),(ze=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(a,ze)}),t),this}_prepareEase(t,a,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||h.moving||this.fire(new r.z("movestart",t)),this._zooming&&!h.zooming&&this.fire(new r.z("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new r.z("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new r.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.z("move",t)),this._zooming&&this.fire(new r.z("zoom",t)),this._rotating&&this.fire(new r.z("rotate",t)),this._pitching&&this.fire(new r.z("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,g=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new r.z("zoomend",t)),g&&this.fire(new r.z("rotateend",t)),y&&this.fire(new r.z("pitchend",t)),this.fire(new r.z("moveend",t))}flyTo(t,a){if(this._prefersReducedMotion(t)){const ct=r.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ct,a)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:r.eM},t);const h=this.transform,g=this.getZoom(),y=this.getBearing(),b=this.getPitch(),S=this.getPadding(),M="zoom"in t?r.aA(+t.zoom,h.minZoom,h.maxZoom):g,D="bearing"in t?this._normalizeBearing(t.bearing,y):y,O="pitch"in t?+t.pitch:b,j=this._extendPadding(t.padding),B=h.zoomScale(M-g),q=r.P.convert(t.offset);let H=h.centerPoint.add(q);const Z=h.pointLocation(H),re=r.aR.convert(t.center||Z);this._normalizeCenter(re);const $=h.project(Z),ae=h.project(re).sub($);let pe=t.curve;const ye=Math.max(h.width,h.height),Ce=ye/B,Ae=ae.mag();if("minZoom"in t){const ct=r.aA(Math.min(t.minZoom,g,M),h.minZoom,h.maxZoom),Ct=ye/h.zoomScale(ct-g);pe=Math.sqrt(Ct/Ae*2)}const ke=pe*pe;function Me(ct){const Ct=(Ce*Ce-ye*ye+(ct?-1:1)*ke*ke*Ae*Ae)/(2*(ct?Ce:ye)*ke*Ae);return Math.log(Math.sqrt(Ct*Ct+1)-Ct)}function Ee(ct){return(Math.exp(ct)-Math.exp(-ct))/2}function ze(ct){return(Math.exp(ct)+Math.exp(-ct))/2}const ot=Me(0);let Ze=function(ct){return ze(ot)/ze(ot+pe*ct)},mt=function(ct){return ye*((ze(ot)*(Ee(Ct=ot+pe*ct)/ze(Ct))-Ee(ot))/ke)/Ae;var Ct},$e=(Me(1)-ot)/pe;if(Math.abs(Ae)<1e-6||!isFinite($e)){if(Math.abs(ye-Ce)<1e-6)return this.easeTo(t,a);const ct=Ce<ye?-1:1;$e=Math.abs(Math.log(Ce/ye))/pe,mt=function(){return 0},Ze=function(Ct){return Math.exp(ct*pe*Ct)}}t.duration="duration"in t?+t.duration:1e3*$e/("screenSpeed"in t?+t.screenSpeed/pe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const pt=y!==D,Ht=O!==b,rt=!h.isPaddingEqual(j),Ue=t.retainPadding===!1?h.clone():h,xt=ct=>Ct=>{const qt=Ct*$e,nn=1/Ze(qt);ct.zoom=Ct===1?M:g+ct.scaleZoom(nn),pt&&(ct.bearing=r.ak(y,D,Ct)),Ht&&(ct.pitch=r.ak(b,O,Ct)),rt&&(Ue.interpolatePadding(S,j,Ct),H=Ue.centerPoint.add(q));const Vt=Ct===1?re:ct.unproject($.add(ae.mult(mt(qt))).mult(nn));return ct.setLocationAtPoint(ct.renderWorldCopies?Vt.wrap():Vt,H),ct._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),ct};if(t.preloadOnly){const ct=this._emulate(xt,t.duration,h);return this._preloadTiles(ct),this}return this._zooming=!0,this._rotating=pt,this._pitching=Ht,this._padding=rt,this._prepareEase(a,!1),this._ease(xt(h),(()=>this._afterEase(a)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,a)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,a,h){h.animate===!1||h.duration===0?(t(1),a()):(this._easeStart=r.o.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.o.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=r.bT(t,-180,180);const h=Math.abs(t-a);return Math.abs(t-360-a)<h&&(t-=360),Math.abs(t+360-a)<h&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const h=t.lng-a.center.lng;t.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,a,h){const g=Math.ceil(15*a/1e3),y=[],b=t(h.clone());for(let S=0;S<=g;S++){const M=b(S/g);y.push(M.clone())}return y}_preloadTiles(t,a){}}class zh{constructor(t={}){this.options=t,r.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact,h=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",h);const g=G("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",h),this._innerContainer=G("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const h=a.reduce(((g,y,b)=>(y.value&&(g+=`${y.key}=${y.value}${b<a.length-1?"&":""}`),g)),"?");t.href=`${r.e.FEEDBACK_URL}/${h}#${mf(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style._mergedSourceCaches;for(const g in a){const y=a[g];if(y.used){const b=y.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t.sort(((g,y)=>g.length-y.length)),t=t.filter(((g,y)=>{for(let b=y+1;b<t.length;b++)if(t[b].indexOf(g)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Da{constructor(){r.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=G("div","mapboxgl-ctrl");const a=G("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const a in t){const h=t[a].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Dh{constructor(){r.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",(a=>this._onIndoorUpdate({selectedFloorId:a.selectedFloorId,floors:a.floors}))),this._container}_createButton(t,a){const h=G("button",t,this._container);return h.type="button",h.addEventListener("click",a),h}_createSeparator(){return G("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,a){this._map&&(t.setAttribute("aria-label",a),t.textContent=a)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return void(this._container.style.display="none");const a=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const h=t.floors.sort(((g,y)=>y.levelOrder-g.levelOrder));a?(Array.from(this._container.children).forEach((g=>g.remove())),this.addCurrentFloors(h)):this.addCurrentFloors(h)}addCurrentFloors(t){for(let a=0;a<t.length;a++){const h=t[a],g=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(h.id),this._model&&(this._model.selectedFloorId=h.id),Array.from(this._container.children).forEach((y=>{y.classList.contains("mapboxgl-ctrl-level-button")&&y.classList.remove("mapboxgl-ctrl-level-button-selected")})),g.classList.add("mapboxgl-ctrl-level-button-selected")}));this._setButtonTitle(g,h.shortName),this._model&&h.id===this._model.selectedFloorId&&g.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(g),a<t.length-1&&this._createSeparator()}}}class no{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,h=a?this._queue.concat(a):this._queue;for(const g of h)if(g.id===t)return void(g.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const h of a)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class La{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=r.dz((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,h){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+h}}const Lh={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Oh extends r.z{constructor(t,a,h,g){const{point:y,lngLat:b,originalEvent:S,target:M}=t;super(t.type,{point:y,lngLat:b,originalEvent:S,target:M}),this.preventDefault=()=>{t.preventDefault()},this.id=a,this.interaction=h,this.feature=g}}class Ty{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,a){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const h=a.filter;let g=a.type;h&&this.filters.set(t,r.b6(h)),g==="mouseover"&&(g="mouseenter"),g==="mouseout"&&(g="mouseleave");const y=this.interactionsByType.get(g)||new Map;g==="mouseenter"||g==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,a)):y.size===0&&this.map.on(g,this.handleType),y.size===0&&this.interactionsByType.set(g,y),y.set(t,a),this.typeById.set(t,g)}get(t){const a=this.typeById.get(t);if(!a)return;const h=this.interactionsByType.get(a);return h?h.get(t):void 0}remove(t){const a=this.typeById.get(t);if(!a)return;this.typeById.delete(t),this.filters.delete(t);const h=this.interactionsByType.get(a);h&&(h.delete(t),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):h.size===0&&this.map.off(a,this.handleType))}queryTargets(t,a){const h=[];for(const[g,y]of a)y.target&&h.push({targetId:g,target:y.target,filter:this.filters.get(g)});return this.map.style.queryRenderedTargets(t,h,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());a.length&&(t.type="mouseenter",this.handleType(t,a));const h=new Map;for(const[g,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(g)||h.set(y.id,y);h.size&&(t.type="mouseleave",this.handleType(t,Array.from(h.values())))}handleOut(t){const a=Array.from(this.hoveredFeatures.values()).map((({feature:h})=>h));a.length&&(t.type="mouseleave",this.handleType(t,a)),this.hoveredFeatures.clear()}handleType(t,a){const h=t.type==="mouseenter";if(h&&!this.interactionsByType.has(t.type))return void r.w("mouseenter interaction required for mouseleave to work.");const g=Array.from(this.interactionsByType.get(t.type)).reverse(),y=!!a;a=a||this.queryTargets(t.point,g);let b=!1;const S=new Set;for(const M of a){for(const[D,O]of g){if(!O.target)continue;const j=M.variants?M.variants[D]:null;if(j){for(const B of j){if(Sl(B,M,S,D))continue;const q=new r.dt(M,B),H=nh(B,M,D);y&&(q.state=this.map.getFeatureState(q));const Z=h?this.prevHoveredFeatures.get(H):null,re=new Oh(t,D,O,q),$=Z?Z.stop:O.handler(re);if(h&&this.hoveredFeatures.set(H,{feature:M,stop:$}),$!==!1){b=!0;break}}if(b)break}}if(b)break}if(!b)for(const[M,D]of g){const{handler:O,target:j}=D;if(!j&&O(new Oh(t,M,D,null))!==!1)break}}}function $x(d,t){if(Array.isArray(d)&&Array.isArray(t)){const a=new Set(d),h=new Set(t);return a.size===h.size&&d.every((g=>h.has(g)))}return r.by(d,t)}const Fh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},e1={showCompass:!0,showZoom:!0,visualizePitch:!1};class t1{constructor(t,a,h=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new vf({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new xf({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),ce()}move(t,a){const h=this.map,g=this.mouseRotate.mousemoveWindow(t,a),y=g&&g.bearingDelta;if(y&&h.setBearing(h.getBearing()+y),this.mousePitch){const b=this.mousePitch.mousemoveWindow(t,a),S=b&&b.pitchDelta;S&&h.setPitch(h.getPitch()+S)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){me(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),te(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,te(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ie(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ie(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Sf(d,t,a){if(d=new r.aR(d.lng,d.lat),t){const h=new r.aR(d.lng-360,d.lat),g=new r.aR(d.lng+360,d.lat),y=360*Math.ceil(Math.abs(d.lng-a.center.lng)/360),b=a.locationPoint3D(d).distSqr(t),S=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint3D(h).distSqr(t)<b&&(S||Math.abs(h.lng-a.center.lng)<y)?d=h:a.locationPoint3D(g).distSqr(t)<b&&(S||Math.abs(g.lng-a.center.lng)<y)&&(d=g)}for(;Math.abs(d.lng-a.center.lng)>180;){const h=a.locationPoint3D(d);if(h.x>=0&&h.y>=0&&h.x<=a.width&&h.y<=a.height)break;d.lng>a.center.lng?d.lng-=360:d.lng+=360}return d}const Bh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ws={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Pc extends r.E{constructor(t,a){super(),(t instanceof HTMLElement||a)&&(t=Object.assign({element:t},a)),r.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:h="center",color:g="#3FB1CE",scale:y=1,draggable:b=!1,clickTolerance:S=0,rotation:M=Ws.rotation,rotationAlignment:D=Ws.rotationAlignment,pitchAlignment:O=Ws.pitchAlignment,occludedOpacity:j=Ws.occludedOpacity,altitude:B=Ws.altitude}=t||{};this._anchor=h,this._color=g,this._scale=y,this._draggable=b,this._clickTolerance=S,this._rotation=M,this._rotationAlignment=D,this._pitchAlignment=O,this._occludedOpacity=j,this._altitude=B,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(Z=>{Z.preventDefault()})),this._element.addEventListener("mousedown",(Z=>{Z.preventDefault()}));const q=this._element.classList;for(const Z in Bh)q.remove(`mapboxgl-marker-anchor-${Z}`);q.add(`mapboxgl-marker-anchor-${this._anchor}`);const H=t&&t.className?t.className.trim().split(/\s+/):[];q.add(...H),this._popup=null}_createDefaultMarker(){const t=G("div"),a=K("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const h=K("radialGradient",{id:"shadowGradient"},K("defs",{},a));K("stop",{offset:"10%","stop-opacity":.4},h),K("stop",{offset:"100%","stop-opacity":.05},h),K("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return K("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),K("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),K("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.aR.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Ws.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,h=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,h=this._element;this._popup&&(a===h||h.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,a=this._pos;if(!t||!a)return!1;const h=t.unproject(a,this._altitude),g=t.getFreeCameraOptions();if(!g.position)return!1;const y=g.position.toLngLat();return y.distanceTo(h)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();const h=t.unproject(a,this._altitude);let g;t._showingGlobe()&&r.eY(t.transform,this._lngLat)?g=0:(g=1-t._queryFogOpacity(h),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Bh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const t=this._pos,a=this._map,h=this.getPitchAlignment();if(!a||!t||h!=="map")return"";if(!a._showingGlobe()){const M=a.getPitch();return M?`rotateX(${M}deg)`:""}const g=r.cW(r.eZ(a.transform,this._lngLat)),y=t.sub(r.e_(a.transform)),b=Math.abs(y.x)+Math.abs(y.y);if(b===0)return"";const S=g/b;return`rotateX(${-y.y*S}deg) rotateY(${y.x*S}deg)`}_calculateZTransform(){const t=this._pos,a=this._map;if(!a||!t)return"";let h=0;const g=this.getRotationAlignment();if(g==="map")if(a._showingGlobe()){const y=a.project(new r.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),b=a.project(new r.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);h=r.cW(Math.atan2(b.y,b.x))-90}else h=-a.getBearing();else if(g==="horizon"){const y=r.ah(4,6,a.getZoom()),b=r.e_(a.transform);b.y+=y*a.transform.height;const S=t.sub(b),M=r.cW(Math.atan2(S.y,S.x));h=(M>90?M-270:M+90)*(1-y)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Sf(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),a._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const a=this._map;if(!a)return;const h=this._pointerdownPos,g=this._positionDelta;if(h&&g){if(!this._isDragging){const y=this._clickTolerance||a._clickTolerance;if(t.point.dist(h)<y)return;this._isDragging=!0}this._pos=t.point.sub(g),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(t){const a=this._map,h=this._pos;a&&h&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(h),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Ws.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Ws.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Ws.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Ws.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Gl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},el={maxWidth:100,unit:"metric"},tl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},kc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},wa=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sy(d=new r.P(0,0),t="bottom"){if(typeof d=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(t){case"top":return new r.P(0,d);case"top-left":return new r.P(a,a);case"top-right":return new r.P(-a,a);case"bottom":return new r.P(0,-d);case"bottom-left":return new r.P(a,-a);case"bottom-right":return new r.P(-a,-a);case"left":return new r.P(d,0);case"right":return new r.P(-d,0)}return new r.P(0,0)}return d instanceof r.P||Array.isArray(d)?r.P.convert(d):r.P.convert(d[t]||[0,0])}return{version:I,supported:W.supported,setRTLTextPlugin:r.f2,getRTLTextPluginStatus:r.f1,Map:class extends Bm{constructor(d){P.mark(k.create);const t=d;if((d=Object.assign({},Fh,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&r.eW(window)&&(d.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new fs(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies,null,null),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new no,this._domRenderTaskQueue=new no,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.b2(),this._locale=Object.assign({},Lh,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new La(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new Be(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Object.assign({},d.contextCreateOptions):{},typeof d.container=="string"){const a=document.getElementById(d.container);if(!a)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=a}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),this._spriteFormat=d.spriteFormat,r.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Tu),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Rh(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||r.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this.indoor=new fc(this),d.hash&&(this._hash=new Im(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const a=d.bounds;a&&(this.resize(),this.fitBounds(a,Object.assign({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new zh({customAttribution:d.customAttribution})),this._logoControl=new Da,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(a=>{this._update(a.dataType==="style"),this.fire(new r.z(`${a.dataType}data`,a))})),this.on("dataloading",(a=>{this.fire(new r.z(`${a.dataType}dataloading`,a))})),this._interactions=new Ty(this)}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=d.onAdd(this);this._controls.push(d);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(a,h.firstChild):h.appendChild(a),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.z("movestart",d)).fire(new r.z("move",d)),this.fire(new r.z("resize",d)),t&&this.fire(new r.z("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(r.aI.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map((t=>t==="auto"?navigator.language:t)):d}setLanguage(d){const t=this._parseLanguage(d);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,t=d.projection.name;let a;t==="globe"&&d.zoom>=r.cK?(d.setMercatorFromTransition(),a=!0):t==="mercator"&&d.zoom<r.cK&&(d.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(d,t){return this._updateProjection(d||t||{name:"mercator"})}_updateProjection(d){let t;return t=d.name==="globe"&&this.transform.zoom>=r.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d,t){return this.transform.locationPoint3D(r.aR.convert(d),t)}unproject(d,t){return this.transform.pointLocation3D(r.P.convert(d),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,t,a){const h=g=>{let y=[];if(Array.isArray(t)){const b=t.filter((S=>this.getLayer(S)));y=b.length?this.queryRenderedFeatures(g,{layers:b}):[]}else y=this.queryRenderedFeatures(g,{target:t});return y};if(d==="mouseenter"||d==="mouseover"){let g=!1;return{listener:a,targets:t,delegates:{mousemove:b=>{const S=h(b.point);S.length?g||(g=!0,a.call(this,new vo(d,this,b.originalEvent,{features:S}))):g=!1},mouseout:()=>{g=!1}}}}if(d==="mouseleave"||d==="mouseout"){let g=!1;return{listener:a,targets:t,delegates:{mousemove:S=>{h(S.point).length?g=!0:g&&(g=!1,a.call(this,new vo(d,this,S.originalEvent)))},mouseout:S=>{g&&(g=!1,a.call(this,new vo(d,this,S.originalEvent)))}}}}{const g=y=>{const b=h(y.point);b.length&&(y.features=b,a.call(this,y),delete y.features)};return{listener:a,targets:t,delegates:{[d]:g}}}}on(d,t,a){if(typeof t=="function"||a===void 0)return super.on(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(d,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(h);for(const g in h.delegates)this.on(g,h.delegates[g]);return this}once(d,t,a){if(typeof t=="function"||a===void 0)return super.once(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(d,t,a);for(const g in h.delegates)this.once(g,h.delegates[g]);return this}off(d,t,a){if(typeof t=="function"||a===void 0)return super.off(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._delegatedListeners?this._delegatedListeners[d]:void 0;return h&&(g=>{for(let y=0;y<g.length;y++){const b=g[y];if(b.listener===a&&$x(b.targets,t)){for(const S in b.delegates)this.off(S,b.delegates[S]);return g.splice(y,1),this}}})(h),this}queryRenderedFeatures(d,t){if(!this.style)return[];if(d===void 0||d instanceof r.P||Array.isArray(d)||t!==void 0||(t=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],!t){const y=this.style.queryRenderedFeatures(d,void 0,this.transform),b=this.style.queryRenderedFeatureset(d,void 0,this.transform);return y.concat(b)}let a=!0;if(t.target&&(a=this._isTargetValid(t.target),a&&!t.layers))return this.style.queryRenderedFeatureset(d,t,this.transform);let h=!0;if(t.layers&&Array.isArray(t.layers)){for(const y of t.layers)if(!this._isValidId(y)){h=!1;break}if(h&&!t.target)return this.style.queryRenderedFeatures(d,t,this.transform)}let g=[];return h&&(g=g.concat(this.style.queryRenderedFeatures(d,t,this.transform))),a&&(g=g.concat(this.style.queryRenderedFeatureset(d,t,this.transform))),g}querySourceFeatures(d,t){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,t)}queryRasterValue(d,t,a){return this._isValidId(d)?this.style.queryRasterValue(d,t,a):Promise.resolve(null)}isPointOnSurface(d){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(d))}addInteraction(d,t){return this._interactions.add(d,t),this}removeInteraction(d){return this._interactions.remove(d),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this}setStyle(d,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&d&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(d,((a,h)=>{if(a){const g=typeof a=="string"?a:a instanceof Error?a.message:a.error;r.w(`Unable to perform style diff: ${g}. Rebuilding the style from scratch.`),this._updateStyle(d,t)}else h&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(d,t))}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const a=Object.assign({},t);t&&t.config&&(a.initialConfig=t.config,delete a.config),this.style=new ra(this,a).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ra(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.dm(d)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isTargetValid(d){return"featuresetId"in d?this._isValidId("importId"in d?d.importId:d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const t of d)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(d)}addSource(d,t){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,a)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,t,{pixelRatio:a=1,sdf:h=!1,stretchX:g,stretchY:y,content:b}={}){this._lazyInitEmptyStyle();const S=r.I.from(d);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:M,height:D,data:O}=r.o.getImageData(t);this.style.addImage(S,{data:new r.q({width:M,height:D},O),pixelRatio:a,stretchX:g,stretchY:y,content:b,sdf:h,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:D}=t,O=t;this.style.addImage(S,{data:new r.q({width:M,height:D},new Uint8Array(O.data)),pixelRatio:a,stretchX:g,stretchY:y,content:b,sdf:h,usvg:!1,version:0,userImage:O}),O.onAdd&&O.onAdd(this,d)}}updateImage(d,t){this._lazyInitEmptyStyle();const a=r.I.from(d),h=this.style.getImage(a);if(!h)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.o.getImageData(t):t,{width:y,height:b,data:S}=g;if(y===void 0||b===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(h.usvg?h.icon.usvg_tree.width:h.data.width)||b!==(h.usvg?h.icon.usvg_tree.height:h.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${y}, ${b})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const M=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let D=!1;h.usvg?(h.data=new r.q({width:y,height:b},new Uint8Array(S)),h.usvg=!1,h.icon=void 0,D=!0):h.data.replace(S,M),this.style.updateImage(a,h,D)}hasImage(d){return d?!!this.style&&!!this.style.getImage(r.I.from(d)):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(r.I.from(d))}loadImage(d,t){r.n(this._requestManager.transformRequest(d,r.R.Image),((a,h)=>{t(a,h instanceof HTMLImageElement?r.o.getImageData(h):h)}))}listImages(){return this.style.listImages().map((d=>d.name))}addModel(d,t){this._lazyInitEmptyStyle(),this.style.addModel(d,t)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,t){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)):this}getSlot(d){const t=this.getLayer(d);return t&&t.slot||null}setSlot(d,t){return this.style.setSlot(d,t),this.style.mergeLayers(),this._update(!0)}addImport(d,t){return this.style.addImport(d,t).catch((a=>this.fire(new r.y(new Error("Failed to add import",a))))),this}updateImport(d,t){return typeof t!="string"&&t.id!==d?(this.removeImport(d),this.addImport(t)):(this.style.updateImport(d,t),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,t){return this.style.moveImport(d,t),this._update(!0)}moveLayer(d,t){return this._isValidId(d)?(this.style.moveLayer(d,t),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const t=this.style.getOwnLayer(d);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,t,a){return this._isValidId(d)?(this.style.setLayerZoomRange(d,t,a),this._update(!0)):this}setFilter(d,t,a={}){return this._isValidId(d)?(this.style.setFilter(d,t,a),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,t,a,h={}){return this._isValidId(d)?(this.style.setPaintProperty(d,t,a,h),this._update(!0)):this}getPaintProperty(d,t){return this._isValidId(d)?this.style.getPaintProperty(d,t):null}setLayoutProperty(d,t,a,h={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,t,a,h),this._update(!0)):this}getLayoutProperty(d,t){return this._isValidId(d)?this.style.getLayoutProperty(d,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(d){return this.style.setGlyphsUrl(d),this._update(!0)}getSchema(d){return this.style.getSchema(d)}setSchema(d,t){return this.style.setSchema(d,t),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,t){return this.style.setConfig(d,t),this._update(!0)}getConfigProperty(d,t){return this.style.getConfigProperty(d,t)}setConfigProperty(d,t,a){return this.style.setConfigProperty(d,t,a),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const t=d[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(d){return this._lazyInitEmptyStyle(),this.style.setSnow(d),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(d){return this._lazyInitEmptyStyle(),this.style.setRain(d),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setImportColorTheme(d,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(d,t),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aR.convert(d),this.transform):0}setFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,t),this._update())}removeFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,t),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_selectIndoorFloor(d){this.indoor.selectFloor(d)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Dh),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let a,h,g,y=this._container;for(;y&&(!h||!g);){const b=window.getComputedStyle(y).transform;b&&b!=="none"&&(a=b.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(h=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(g=a[3])),y=y.parentElement}this._containerWidth=h?Math.abs(d/h):d,this._containerHeight=g?Math.abs(t/g):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=G("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=G("div","mapboxgl-canvas-container",d);this._canvas=G("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=G("div","mapboxgl-control-container",d),h=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((g=>{h[g]=G("div",`mapboxgl-ctrl-${g}`,a)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t){const a=r.o.devicePixelRatio||1;this._canvas.width=a*Math.ceil(d),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const t=this._markers.indexOf(d);t!==-1&&this._markers.splice(t,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const t=this._popups.indexOf(d);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const d=Object.assign({},W.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",d);t?(ut(t,!0),this.painter=new Am(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),r.k.testSupport(t)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let t;this.fire(new r.z("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,h=r.o.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=g.createQuery(),g.beginQuery(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,O=this.transform.pitch,j=r.o.now(),B=new r.ac(D,{now:j,fadeDuration:y,pitch:O,transition:this.style.transition,worldview:this._worldview});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(h),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(h);const S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,P.mark(k.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const D=r.o.now()-h;g.endQuery(a.TIME_ELAPSED_EXT),setTimeout((()=>{const O=g.getQueryParameter(t,g.QUERY_RESULT)/1e6;g.deleteQuery(t),this.fire(new r.z("gpu-timing-frame",{cpuTime:D,gpuTime:O}))}),50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout((()=>{const O=this.painter.queryGpuTimers(D);this.fire(new r.z("gpu-timing-layer",{layerTimes:O}))}),50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const O=this.painter.queryGpuTimeDeferredRender(D);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:O}))}),50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(M||this._repaint)this.triggerRepaint();else{const D=this.idle();if(D&&(b=this._updateAverageElevation(h,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,P.mark(k.fullLoad),this._performanceMetricsCollection&&Lt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const t of this._markers)d&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!d||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(d,t=!1){const a=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(t||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const g=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=d;const b=Math.abs(g-y);if(b>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(y),a(y);this._averageElevation.easeTo(y,d,300)}else if(b>1e-4)return this._averageElevation.jumpTo(y),a(y)}return!!this._averageElevation.isEasing(d)&&a(this._averageElevation.getValue(d))}_authenticate(){Je(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(d=>{if(d&&(d.message===De||d.status===401)){const t=this.painter.context.gl;ut(t,!1),this._logoControl instanceof Da&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),Qe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&tt(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,h=a.createFramebuffer();function g(y){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,y,0);const b=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,b),b}return a.bindFramebuffer(a.FRAMEBUFFER,h),this._canvasPixelComparison(g(d),t.canvasCopies.map(g),t.timeStamps)}_canvasPixelComparison(d,t,a){let h=a[1]-a[0];const g=d.length/4;for(let y=0;y<t.length;y++){const b=t[y];let S=0;for(let M=0;M<b.length;M+=4)b[M]===d[M]&&b[M+1]===d[M+1]&&b[M+2]===d[M+2]&&b[M+3]===d[M+3]&&(S+=1);h+=(a[y+2]-a[y+1])*(1-S/g)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Rt.delete(this.painter.context.gl),_t.remove(),et.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=r.o.frame((t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)})))}_preloadTiles(d){const t=this.style?this.style.getSourceCaches():[];return r.bw(t,((a,h)=>a._preloadTiles(d,h)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,t){r.eX(d,t)}get version(){return I}},NavigationControl:class{constructor(d={}){this.options=Object.assign({},e1,d),this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(r.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),G("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),G("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))})),this._compassIcon=G("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const t=d.getZoom(),a=t===d.getMaxZoom(),h=t===d.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new t1(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,t){const a=G("button",d,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(d,t){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${t}`);d.setAttribute("aria-label",a),d.firstElementChild&&d.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends r.E{constructor(d={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},Gl,d),r.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=pf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const t=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,d(a)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((a=>t(a.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),a=d.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",d)),this._finish()}}_updateCamera(d){const t=new r.aR(d.coords.longitude,d.coords.latitude),a=d.coords.accuracy,h=this._map.getBearing(),g=Object.assign({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),g,{geolocateSource:!0})}_updateMarker(d){if(d){const t=new r.aR(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,t=r.ce(1,d._center.lat)*d.worldSize,a=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=G("button","mapboxgl-ctrl-geolocate",this._container),G("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G("div","mapboxgl-user-location"),this._dotElement.appendChild(G("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(G("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Pc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=G("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))}))}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&d()})).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:zh,ScaleControl:class{constructor(d={}){this.options=Object.assign({},el,d),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),r.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,t=this._map,a=t._containerHeight/2,h=t._containerWidth/2-d/2,g=t.unproject([h,a]),y=t.unproject([h+d,a]),b=g.distanceTo(y);if(this.options.unit==="imperial"){const S=3.2808*b;S>5280?this._setScale(d,S/5280,"mile"):this._setScale(d,S,"foot")}else this.options.unit==="nautical"?this._setScale(d,b/1852,"nautical-mile"):b>=1e3?this._setScale(d,b/1e3,"kilometer"):this._setScale(d,b,"meter")}_setScale(d,t,a){this._map._requestDomTask((()=>{const h=(function(y){const b=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/b;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:(function(M){const D=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*D)/D})(S),b*S})(t),g=h/t;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(h):`${h}&nbsp;${tl[a]}`,this._container.style.width=d*g+"px"}))}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:r.w("Full screen control 'container' must be a DOM element.")),r.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=G("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Dh,Popup:class extends r.E{constructor(d){super(),this.options=Object.assign(Object.create(kc),d),this._altitude=this.options.altitude,r.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=r.aR.convert(d),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(d){return this._altitude=d,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),a=document.createElement("body");let h;for(a.innerHTML=d;h=a.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=G("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(d),this.options.closeButton){const a=this._closeButton=G("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let t;return this._classList.delete(d)?t=!1:(this._classList.add(d),t=!0),this._updateClassList(),t}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const t=this._map,a=this._container,h=this._pos;if(!t||!a||!h)return"bottom";const g=a.offsetWidth,y=a.offsetHeight,b=h.x<g/2,S=h.x>t.transform.width-g/2;if(h.y+d<y)return b?"top-left":S?"top-right":"top";if(h.y>t.transform.height-y){if(b)return"bottom-left";if(S)return"bottom-right"}return b?"left":S?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),d.className=t.join(" ")}_update(d){const t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let h=this._container;if(h||(h=this._container=G("div","mapboxgl-popup",t.getContainer()),this._tip=G("div","mapboxgl-popup-tip",h),h.appendChild(a)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Sf(this._lngLat,this._pos,t.transform)),!this._trackPointer||d){const g=this._pos=this._trackPointer&&d instanceof r.P?d:t.project(this._lngLat,this._altitude),y=Sy(this.options.offset),b=this._anchor=this._getAnchor(y.y),S=Sy(this.options.offset,b),M=g.add(S).round();t._requestDomTask((()=>{this._container&&b&&(this._container.style.transform=`${Bh[b]} translate(${M.x}px,${M.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const g=r.eY(t.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(wa);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Pc,Style:ra,LngLat:r.aR,LngLatBounds:r.aI,Point:r.P,MercatorCoordinate:r.ae,FreeCameraOptions:Up,Evented:r.E,config:r.e,prewarm:r.f0,clearPrewarmedResources:r.e$,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(d){r.e.ACCESS_TOKEN=d},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(d){r.e.API_URL=d},get workerCount(){return r.f9.workerCount},set workerCount(d){r.f9.workerCount=d},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){r.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){r.f8(d)},get workerUrl(){return r.f7.workerUrl},set workerUrl(d){r.f7.workerUrl=d},get workerClass(){return r.f7.workerClass},set workerClass(d){r.f7.workerClass=d},get workerParams(){return r.f7.workerParams},set workerParams(d){r.f7.workerParams=d},get dracoUrl(){return r.f6()},set dracoUrl(d){r.f5(d)},get meshoptUrl(){return r.f4()},set meshoptUrl(d){r.f3(d)},setNow:r.o.setNow,restoreNow:r.o.restoreNow}}));var T=_;return T}))})(Qv)),Qv.exports}var VB=NB();const xR=yR(VB),bR="pk.eyJ1Ijoic3V0YW5lbnVtcyIsImEiOiJjbWgxdWl5cHYwNmM1MmxzN2FpMDFrcWV2In0.ScPz2ljFqodXbFe3LFGvKw";function Ku(s,n,c={}){const m={type:"Feature"};return(c.id===0||c.id)&&(m.id=c.id),c.bbox&&(m.bbox=c.bbox),m.properties=n||{},m.geometry=s,m}function UB(s,n,c={}){if(!s)throw new Error("coordinates is required");if(!Array.isArray(s))throw new Error("coordinates must be an Array");if(s.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!mM(s[0])||!mM(s[1]))throw new Error("coordinates must contain numbers");return Ku({type:"Point",coordinates:s},n,c)}function jB(s,n,c={}){for(const _ of s){if(_.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(_[_.length-1].length!==_[0].length)throw new Error("First and last Position are not equivalent.");for(let x=0;x<_[_.length-1].length;x++)if(_[_.length-1][x]!==_[0][x])throw new Error("First and last Position are not equivalent.")}return Ku({type:"Polygon",coordinates:s},n,c)}function GB(s,n,c={}){if(s.length<2)throw new Error("coordinates must be an array of two or more positions");return Ku({type:"LineString",coordinates:s},n,c)}function a0(s,n={}){const c={type:"FeatureCollection"};return n.id&&(c.id=n.id),n.bbox&&(c.bbox=n.bbox),c.features=s,c}function WB(s,n,c={}){return Ku({type:"MultiLineString",coordinates:s},n,c)}function mM(s){return!isNaN(s)&&s!==null&&!Array.isArray(s)}function qB(s){if(!s)throw new Error("coord is required");if(!Array.isArray(s)){if(s.type==="Feature"&&s.geometry!==null&&s.geometry.type==="Point")return[...s.geometry.coordinates];if(s.type==="Point")return[...s.coordinates]}if(Array.isArray(s)&&s.length>=2&&!Array.isArray(s[0])&&!Array.isArray(s[1]))return[...s];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function tx(s){return s.type==="Feature"?s.geometry:s}function wR(s,n,c){if(s!==null)for(var m,_,x,T,r,I,k,P=0,R=0,F,V=s.type,W=V==="FeatureCollection",G=V==="Feature",K=W?s.features.length:1,Y=0;Y<K;Y++){k=W?s.features[Y].geometry:G?s.geometry:s,F=k?k.type==="GeometryCollection":!1,r=F?k.geometries.length:1;for(var ne=0;ne<r;ne++){var oe=0,ce=0;if(T=F?k.geometries[ne]:k,T!==null){I=T.coordinates;var me=T.type;switch(P=0,me){case null:break;case"Point":if(n(I,R,Y,oe,ce)===!1)return!1;R++,oe++;break;case"LineString":case"MultiPoint":for(m=0;m<I.length;m++){if(n(I[m],R,Y,oe,ce)===!1)return!1;R++,me==="MultiPoint"&&oe++}me==="LineString"&&oe++;break;case"Polygon":case"MultiLineString":for(m=0;m<I.length;m++){for(_=0;_<I[m].length-P;_++){if(n(I[m][_],R,Y,oe,ce)===!1)return!1;R++}me==="MultiLineString"&&oe++,me==="Polygon"&&ce++}me==="Polygon"&&oe++;break;case"MultiPolygon":for(m=0;m<I.length;m++){for(ce=0,_=0;_<I[m].length;_++){for(x=0;x<I[m][_].length-P;x++){if(n(I[m][_][x],R,Y,oe,ce)===!1)return!1;R++}ce++}oe++}break;case"GeometryCollection":for(m=0;m<T.geometries.length;m++)if(wR(T.geometries[m],n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function HB(s,n){var c,m,_,x,T,r,I,k,P,R,F=0,V=s.type==="FeatureCollection",W=s.type==="Feature",G=V?s.features.length:1;for(c=0;c<G;c++){for(r=V?s.features[c].geometry:W?s.geometry:s,k=V?s.features[c].properties:W?s.properties:{},P=V?s.features[c].bbox:W?s.bbox:void 0,R=V?s.features[c].id:W?s.id:void 0,I=r?r.type==="GeometryCollection":!1,T=I?r.geometries.length:1,_=0;_<T;_++){if(x=I?r.geometries[_]:r,x===null){if(n(null,F,k,P,R)===!1)return!1;continue}switch(x.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(x,F,k,P,R)===!1)return!1;break}case"GeometryCollection":{for(m=0;m<x.geometries.length;m++)if(n(x.geometries[m],F,k,P,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}F++}}function l0(s,n){HB(s,function(c,m,_,x,T){var r=c===null?null:c.type;switch(r){case null:case"Point":case"LineString":case"Polygon":return n(Ku(c,_,{bbox:x,id:T}),m,0)===!1?!1:void 0}var I;switch(r){case"MultiPoint":I="Point";break;case"MultiLineString":I="LineString";break;case"MultiPolygon":I="Polygon";break}for(var k=0;k<c.coordinates.length;k++){var P=c.coordinates[k],R={type:I,coordinates:P};if(n(Ku(R,_),m,k)===!1)return!1}})}function ZB(s,n={}){if(s.bbox!=null&&n.recompute!==!0)return s.bbox;const c=[1/0,1/0,-1/0,-1/0];return wR(s,m=>{c[0]>m[0]&&(c[0]=m[0]),c[1]>m[1]&&(c[1]=m[1]),c[2]<m[0]&&(c[2]=m[0]),c[3]<m[1]&&(c[3]=m[1])}),c}function XB(s,n={}){const c=Number(s[0]),m=Number(s[1]),_=Number(s[2]),x=Number(s[3]);if(s.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const T=[c,m];return jB([[T,[_,m],[_,x],[c,x],T]],n.properties,{bbox:s,id:n.id})}const Gc=11102230246251565e-32,Rs=134217729,YB=(3+8*Gc)*Gc;function Tb(s,n,c,m,_){let x,T,r,I,k=n[0],P=m[0],R=0,F=0;P>k==P>-k?(x=k,k=n[++R]):(x=P,P=m[++F]);let V=0;if(R<s&&F<c)for(P>k==P>-k?(T=k+x,r=x-(T-k),k=n[++R]):(T=P+x,r=x-(T-P),P=m[++F]),x=T,r!==0&&(_[V++]=r);R<s&&F<c;)P>k==P>-k?(T=x+k,I=T-x,r=x-(T-I)+(k-I),k=n[++R]):(T=x+P,I=T-x,r=x-(T-I)+(P-I),P=m[++F]),x=T,r!==0&&(_[V++]=r);for(;R<s;)T=x+k,I=T-x,r=x-(T-I)+(k-I),k=n[++R],x=T,r!==0&&(_[V++]=r);for(;F<c;)T=x+P,I=T-x,r=x-(T-I)+(P-I),P=m[++F],x=T,r!==0&&(_[V++]=r);return(x!==0||V===0)&&(_[V++]=x),V}function KB(s,n){let c=n[0];for(let m=1;m<s;m++)c+=n[m];return c}function g_(s){return new Float64Array(s)}const JB=(3+16*Gc)*Gc,QB=(2+12*Gc)*Gc,$B=(9+64*Gc)*Gc*Gc,Wf=g_(4),gM=g_(8),_M=g_(12),yM=g_(16),Ys=g_(4);function e5(s,n,c,m,_,x,T){let r,I,k,P,R,F,V,W,G,K,Y,ne,oe,ce,me,ue,_e,te;const ie=s-_,xe=c-_,de=n-x,Te=m-x;ce=ie*Te,F=Rs*ie,V=F-(F-ie),W=ie-V,F=Rs*Te,G=F-(F-Te),K=Te-G,me=W*K-(ce-V*G-W*G-V*K),ue=de*xe,F=Rs*de,V=F-(F-de),W=de-V,F=Rs*xe,G=F-(F-xe),K=xe-G,_e=W*K-(ue-V*G-W*G-V*K),Y=me-_e,R=me-Y,Wf[0]=me-(Y+R)+(R-_e),ne=ce+Y,R=ne-ce,oe=ce-(ne-R)+(Y-R),Y=oe-ue,R=oe-Y,Wf[1]=oe-(Y+R)+(R-ue),te=ne+Y,R=te-ne,Wf[2]=ne-(te-R)+(Y-R),Wf[3]=te;let De=KB(4,Wf),Be=QB*T;if(De>=Be||-De>=Be||(R=s-ie,r=s-(ie+R)+(R-_),R=c-xe,k=c-(xe+R)+(R-_),R=n-de,I=n-(de+R)+(R-x),R=m-Te,P=m-(Te+R)+(R-x),r===0&&I===0&&k===0&&P===0)||(Be=$B*T+YB*Math.abs(De),De+=ie*P+Te*r-(de*k+xe*I),De>=Be||-De>=Be))return De;ce=r*Te,F=Rs*r,V=F-(F-r),W=r-V,F=Rs*Te,G=F-(F-Te),K=Te-G,me=W*K-(ce-V*G-W*G-V*K),ue=I*xe,F=Rs*I,V=F-(F-I),W=I-V,F=Rs*xe,G=F-(F-xe),K=xe-G,_e=W*K-(ue-V*G-W*G-V*K),Y=me-_e,R=me-Y,Ys[0]=me-(Y+R)+(R-_e),ne=ce+Y,R=ne-ce,oe=ce-(ne-R)+(Y-R),Y=oe-ue,R=oe-Y,Ys[1]=oe-(Y+R)+(R-ue),te=ne+Y,R=te-ne,Ys[2]=ne-(te-R)+(Y-R),Ys[3]=te;const Se=Tb(4,Wf,4,Ys,gM);ce=ie*P,F=Rs*ie,V=F-(F-ie),W=ie-V,F=Rs*P,G=F-(F-P),K=P-G,me=W*K-(ce-V*G-W*G-V*K),ue=de*k,F=Rs*de,V=F-(F-de),W=de-V,F=Rs*k,G=F-(F-k),K=k-G,_e=W*K-(ue-V*G-W*G-V*K),Y=me-_e,R=me-Y,Ys[0]=me-(Y+R)+(R-_e),ne=ce+Y,R=ne-ce,oe=ce-(ne-R)+(Y-R),Y=oe-ue,R=oe-Y,Ys[1]=oe-(Y+R)+(R-ue),te=ne+Y,R=te-ne,Ys[2]=ne-(te-R)+(Y-R),Ys[3]=te;const Ne=Tb(Se,gM,4,Ys,_M);ce=r*P,F=Rs*r,V=F-(F-r),W=r-V,F=Rs*P,G=F-(F-P),K=P-G,me=W*K-(ce-V*G-W*G-V*K),ue=I*k,F=Rs*I,V=F-(F-I),W=I-V,F=Rs*k,G=F-(F-k),K=k-G,_e=W*K-(ue-V*G-W*G-V*K),Y=me-_e,R=me-Y,Ys[0]=me-(Y+R)+(R-_e),ne=ce+Y,R=ne-ce,oe=ce-(ne-R)+(Y-R),Y=oe-ue,R=oe-Y,Ys[1]=oe-(Y+R)+(R-ue),te=ne+Y,R=te-ne,Ys[2]=ne-(te-R)+(Y-R),Ys[3]=te;const it=Tb(Ne,_M,4,Ys,yM);return yM[it-1]}function t5(s,n,c,m,_,x){const T=(n-x)*(c-_),r=(s-_)*(m-x),I=T-r,k=Math.abs(T+r);return Math.abs(I)>=JB*k?I:-e5(s,n,c,m,_,x,k)}function n5(s,n){var c,m,_=0,x,T,r,I,k,P,R,F=s[0],V=s[1],W=n.length;for(c=0;c<W;c++){m=0;var G=n[c],K=G.length-1;if(P=G[0],P[0]!==G[K][0]&&P[1]!==G[K][1])throw new Error("First and last coordinates in a ring must be the same");for(T=P[0]-F,r=P[1]-V,m;m<K;m++){if(R=G[m+1],I=R[0]-F,k=R[1]-V,r===0&&k===0){if(I<=0&&T>=0||T<=0&&I>=0)return 0}else if(k>=0&&r<=0||k<=0&&r>=0){if(x=t5(T,I,r,k,0,0),x===0)return 0;(x>0&&k>0&&r<=0||x<0&&k<=0&&r>0)&&_++}P=R,r=k,T=I}}return _%2!==0}function Jg(s,n,c={}){if(!s)throw new Error("point is required");if(!n)throw new Error("polygon is required");const m=qB(s),_=tx(n),x=_.type,T=n.bbox;let r=_.coordinates;if(T&&i5(m,T)===!1)return!1;x==="Polygon"&&(r=[r]);let I=!1;for(var k=0;k<r.length;++k){const P=n5(m,r[k]);if(P===0)return!c.ignoreBoundary;P&&(I=!0)}return I}function i5(s,n){return n[0]<=s[0]&&n[1]<=s[1]&&n[2]>=s[0]&&n[3]>=s[1]}class TR{constructor(n=[],c=r5){if(this.data=n,this.length=this.data.length,this.compare=c,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:c,compare:m}=this,_=c[n];for(;n>0;){const x=n-1>>1,T=c[x];if(m(_,T)>=0)break;c[n]=T,n=x}c[n]=_}_down(n){const{data:c,compare:m}=this,_=this.length>>1,x=c[n];for(;n<_;){let T=(n<<1)+1,r=c[T];const I=T+1;if(I<this.length&&m(c[I],r)<0&&(T=I,r=c[I]),m(r,x)>=0)break;c[n]=r,n=T}c[n]=x}}function r5(s,n){return s<n?-1:s>n?1:0}function SR(s,n){return s.p.x>n.p.x?1:s.p.x<n.p.x?-1:s.p.y!==n.p.y?s.p.y>n.p.y?1:-1:1}function o5(s,n){return s.rightSweepEvent.p.x>n.rightSweepEvent.p.x?1:s.rightSweepEvent.p.x<n.rightSweepEvent.p.x?-1:s.rightSweepEvent.p.y!==n.rightSweepEvent.p.y?s.rightSweepEvent.p.y<n.rightSweepEvent.p.y?1:-1:1}let vM=class{constructor(n,c,m,_){this.p={x:n[0],y:n[1]},this.featureId=c,this.ringId=m,this.eventId=_,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(n){return this.p.x===n.p.x&&this.p.y===n.p.y}};function s5(s,n){if(s.type==="FeatureCollection"){const c=s.features;for(let m=0;m<c.length;m++)xM(c[m],n)}else xM(s,n)}let bv=0,wv=0,Tv=0;function xM(s,n){const c=s.type==="Feature"?s.geometry:s;let m=c.coordinates;(c.type==="Polygon"||c.type==="MultiLineString")&&(m=[m]),c.type==="LineString"&&(m=[[m]]);for(let _=0;_<m.length;_++)for(let x=0;x<m[_].length;x++){let T=m[_][x][0],r=null;wv=wv+1;for(let I=0;I<m[_][x].length-1;I++){r=m[_][x][I+1];const k=new vM(T,bv,wv,Tv),P=new vM(r,bv,wv,Tv+1);k.otherEvent=P,P.otherEvent=k,SR(k,P)>0?(P.isLeftEndpoint=!0,k.isLeftEndpoint=!1):(k.isLeftEndpoint=!0,P.isLeftEndpoint=!1),n.push(k),n.push(P),T=r,Tv=Tv+1}}bv=bv+1}class a5{constructor(n){this.leftSweepEvent=n,this.rightSweepEvent=n.otherEvent}}function l5(s,n){if(s===null||n===null||s.leftSweepEvent.ringId===n.leftSweepEvent.ringId&&(s.rightSweepEvent.isSamePoint(n.leftSweepEvent)||s.rightSweepEvent.isSamePoint(n.leftSweepEvent)||s.rightSweepEvent.isSamePoint(n.rightSweepEvent)||s.leftSweepEvent.isSamePoint(n.leftSweepEvent)||s.leftSweepEvent.isSamePoint(n.rightSweepEvent)))return!1;const c=s.leftSweepEvent.p.x,m=s.leftSweepEvent.p.y,_=s.rightSweepEvent.p.x,x=s.rightSweepEvent.p.y,T=n.leftSweepEvent.p.x,r=n.leftSweepEvent.p.y,I=n.rightSweepEvent.p.x,k=n.rightSweepEvent.p.y,P=(k-r)*(_-c)-(I-T)*(x-m),R=(I-T)*(m-r)-(k-r)*(c-T),F=(_-c)*(m-r)-(x-m)*(c-T);if(P===0)return!1;const V=R/P,W=F/P;if(V>=0&&V<=1&&W>=0&&W<=1){const G=c+V*(_-c),K=m+V*(x-m);return[G,K]}return!1}function c5(s,n){n=n||!1;const c=[],m=new TR([],o5);for(;s.length;){const _=s.pop();if(_.isLeftEndpoint){const x=new a5(_);for(let T=0;T<m.data.length;T++){const r=m.data[T];if(n&&r.leftSweepEvent.featureId===_.featureId)continue;const I=l5(x,r);I!==!1&&c.push(I)}m.push(x)}else _.isLeftEndpoint===!1&&m.pop()}return c}function u5(s,n){const c=new TR([],SR);return s5(s,c),c5(c,n)}var h5=u5;function sT(s,n,c={}){const{removeDuplicates:m=!0,ignoreSelfIntersections:_=!0}=c;let x=[];s.type==="FeatureCollection"?x=x.concat(s.features):s.type==="Feature"?x.push(s):(s.type==="LineString"||s.type==="Polygon"||s.type==="MultiLineString"||s.type==="MultiPolygon")&&x.push(Ku(s)),n.type==="FeatureCollection"?x=x.concat(n.features):n.type==="Feature"?x.push(n):(n.type==="LineString"||n.type==="Polygon"||n.type==="MultiLineString"||n.type==="MultiPolygon")&&x.push(Ku(n));const T=h5(a0(x),_);let r=[];if(m){const I={};T.forEach(k=>{const P=k.join(",");I[P]||(I[P]=!0,r.push(k))})}else r=T;return a0(r.map(I=>UB(I)))}function qw(s,n={}){const c=tx(s);switch(!n.properties&&s.type==="Feature"&&(n.properties=s.properties),c.type){case"Polygon":return d5(c,n);case"MultiPolygon":return f5(c,n);default:throw new Error("invalid poly")}}function d5(s,n={}){const m=tx(s).coordinates,_=n.properties?n.properties:s.type==="Feature"?s.properties:{};return ER(m,_)}function f5(s,n={}){const m=tx(s).coordinates,_=n.properties?n.properties:s.type==="Feature"?s.properties:{},x=[];return m.forEach(T=>{x.push(ER(T,_))}),a0(x)}function ER(s,n){return s.length>1?WB(s,n):GB(s[0],n)}function p5(s,n,{ignoreSelfIntersections:c=!0}={ignoreSelfIntersections:!0}){let m=!0;return l0(s,_=>{l0(n,x=>{if(m===!1)return!1;m=m5(_.geometry,x.geometry,c)})}),m}function m5(s,n,c){switch(s.type){case"Point":switch(n.type){case"Point":return!v5(s.coordinates,n.coordinates);case"LineString":return!bM(n,s);case"Polygon":return!Jg(s,n)}break;case"LineString":switch(n.type){case"Point":return!bM(s,n);case"LineString":return!g5(s,n,c);case"Polygon":return!wM(n,s,c)}break;case"Polygon":switch(n.type){case"Point":return!Jg(n,s);case"LineString":return!wM(s,n,c);case"Polygon":return!_5(n,s,c)}}return!1}function bM(s,n){for(let c=0;c<s.coordinates.length-1;c++)if(y5(s.coordinates[c],s.coordinates[c+1],n.coordinates))return!0;return!1}function g5(s,n,c){return sT(s,n,{ignoreSelfIntersections:c}).features.length>0}function wM(s,n,c){for(const _ of n.coordinates)if(Jg(_,s))return!0;return sT(n,qw(s),{ignoreSelfIntersections:c}).features.length>0}function _5(s,n,c){for(const _ of s.coordinates[0])if(Jg(_,n))return!0;for(const _ of n.coordinates[0])if(Jg(_,s))return!0;return sT(qw(s),qw(n),{ignoreSelfIntersections:c}).features.length>0}function y5(s,n,c){const m=c[0]-s[0],_=c[1]-s[1],x=n[0]-s[0],T=n[1]-s[1];return m*T-_*x!==0?!1:Math.abs(x)>=Math.abs(T)?x>0?s[0]<=c[0]&&c[0]<=n[0]:n[0]<=c[0]&&c[0]<=s[0]:T>0?s[1]<=c[1]&&c[1]<=n[1]:n[1]<=c[1]&&c[1]<=s[1]}function v5(s,n){return s[0]===n[0]&&s[1]===n[1]}function TM(s,n,{ignoreSelfIntersections:c=!0}={}){let m=!1;return l0(s,_=>{l0(n,x=>{if(m===!0)return!0;m=!p5(_.geometry,x.geometry,{ignoreSelfIntersections:c})})}),m}const SM={mousemove:s=>{const[n,c]=[s.lngLat.lng,s.lngLat.lat],m=xr.MapApp?.map?.getZoom();m&&(xr.location=[m,n,c])},move:()=>{const s=xr.MapApp?.map?.getZoom();s&&(xr.location[0]=s)},click:s=>{const[n,c]=[s.lngLat.lng,s.lngLat.lat],m="mapbox/driving",_=`${n},${c}`,x={contours_minutes:"3",access_token:bR,polygons:"true"},T=new URLSearchParams(x).toString(),I=`${`https://api.mapbox.com/isochrone/v1/${m}/${_}`}?${T}`;if(xr.isochrone){xr.isochrone=!1;let k=xr.MapApp?.map?.getSource("isochrone");k.setData({type:"FeatureCollection",features:[]}),k=xr.MapApp?.map?.getSource("bboxScope"),k.setData({type:"FeatureCollection",features:[]}),k=xr.MapApp?.map?.getSource("trafficLightScope"),k.setData({type:"FeatureCollection",features:[]}),xr.highlightedTrafficLights=[],xr.MapApp?.map?.setFilter("bus-routes",["to-boolean",!1]),xr.affectedBusRoutes=[]}else fetch(I).then(k=>{k.ok&&k.json().then(P=>{let R=xr.MapApp?.map?.getSource("isochrone");R.setData(P);const F=ZB(P,{recompute:!0}),V=XB(F);R=xr.MapApp?.map?.getSource("bboxScope"),R.setData(V),xr.isochrone=!0;const[W,G,K,Y]=F;console.log([[W,G],[K,Y]]);const ne=xr.MapApp?.map?.project([W,G]),oe=xr.MapApp?.map?.project([K,Y]);if(ne&&oe){const ce=xr.MapApp?.map?.queryRenderedFeatures([ne,oe],{layers:["traffic-signal"]});if(ce){const ue=[];for(const ie of ce)TM(P,ie)&&ue.push(ie);console.log("total bbox:",ce);const _e=a0(ue);console.log("within Collection:",_e),(xr.MapApp?.map?.getSource("trafficLightScope")).setData(_e),xr.highlightedTrafficLights=ue}const me=xr.MapApp?.map?.queryRenderedFeatures([ne,oe],{layers:["bus-routes-base"]});if(me){const ue=[];for(const ie of me)TM(P,ie)&&ue.push(ie);console.log("total busRoutes:",me);const _e=ue.map(ie=>ie.properties?ie.properties.SERVICENUM:null).filter(ie=>ie!==null).filter(ie=>ie!==void 0),te=[...new Set(_e)];xr.affectedBusRoutes=te,console.log("unique service num",te),console.log("filter:",["in",["get","SERVICENUM"],...te]),te.length>0&&xr.MapApp?.map?.setFilter("bus-routes",["in",["get","SERVICENUM"],["literal",te]])}}})})}},EM={traffic_signals:{type:"vector",tiles:["http://localhost:5173/traffic_signals/data/{z}/{x}/{y}.pbf"],minzoom:11,maxzoom:13},leeds_bus_routes:{type:"vector",tiles:["http://localhost:5173/leeds_bus_routes/data/{z}/{x}/{y}.pbf"],minzoom:11,maxzoom:13},isochrone:{type:"geojson",data:{type:"FeatureCollection",features:[]}},bboxScope:{type:"geojson",data:{type:"FeatureCollection",features:[]}},trafficLightScope:{type:"geojson",data:{type:"FeatureCollection",features:[]}}};function x5(s){let n=2166136261;for(let m=0;m<s.length;m++)n^=s.charCodeAt(m),n=Math.imul(n,16777619);return`hsl(${Math.abs(n)%360}, 65%, 50%)`}const b5=["10","644","112","412","323","643","74A","108","900","100","966","120","933","964","598","937","351","862","873","6","256","2","72","4","4G","1","936","308","PR1","PR2","64","83A","84","28","N1","349","629","649","X84","X85","84A","874","435","436","437","X49","16A","66A","9","14","X14","9A","938","56","205","49","306","36","51","202","200","203","52","7","576","503","15","X40","X43","3","97","ZAP","840","843","7A","X7","13","13A","104","105","271","436A","437A","X36","11","35","86","87","163","168","91","607","671","60","901","634","965","409","K5","599","597","66","410","B3","B2","K6","K7","K9","K3","677","680","262","301","302","411","737","747","280","K17","K19","65","630","560","X58","633","536","561","614","613","X98","X99","232","166","353","612","611","493","257","21","231","26","103","101","427","119","N10","X32","K1","24","20A","700","533","546","PH15","286","821","328","16","8","363","X63","5","201","181","183","186","396","TK2","TK1","30","825","48","47","67","261","28C","59","59A","335","146","128","7S","635","387","393","185","X70","327","352","H5","213","75","370","600","241","539","12","X11","X6","23","371","T4","406","WCB","K11","923","197","287","39","496","903","523","907","18X","258","408","175","167","316","FTB","619","622","SW1","19M","K10","679","226","579","X1","563A","360A","402","175A","407","29B","36A","36B","X60","C68","485","595","M2","X22","147A","M3","940","107","110S","532","658","962","38A","DTB","X62","678","395","22","80","126","116","11A","228","19X","L74","378","321","159","156","500","153","324","499","154","212","212A","3A","X26","X27","377","660","62","31","521","48A","303","184","534","343","662","948","32","675","624A","384","394","385","174","174A","605","81","M","E3","E5","249","T3","71","78A","535","61A","389","20","360","40","476","263","319","281","254","255","254A","128A","X25","233","375","676","96A","94","T1","H3","T6","T8","201A","781","594","X41","342","341","501","N9","229","446","74","H1","T2","268","1B","317","HSB","592","884","645","571","399","19","19A","X4","96","596","33","34","1A","H7","621","42","681","682","372","50","356","537","481","X10","50A","444","526","562","497","563","388","H6","757","574","10A","2A","547","425","577","911","H2","504","FLX","354","355","374","259","61","304","X56","606","358","309","81A","X50","589","564","E7","ML1","K8","ML2","B1","25","525","29","X52","217","653","610","350","K2","173A","223","420","440","902","527","687","616","618","617","110","636","640","637","641","688","147","109","111","102","620","127","117","189","686","510","542","522","113","149","541","310","M4","148A","148","187","177","188","55C","195","283","196","314","144","55","K13","K14","K12","K15","K16","77","656","548","590","626","608","508","125","54","549","615"],w5=b5.flatMap(s=>[s,x5(s)]),T5=[{id:"bus-routes-base",type:"line",source:"leeds_bus_routes","source-layer":"leeds_bus_routes",paint:{"line-width":1,"line-opacity":0}},{id:"bus-routes",type:"line",source:"leeds_bus_routes","source-layer":"leeds_bus_routes",paint:{"line-width":3,"line-color":["match",["to-string",["get","SERVICENUM"]],...w5,"#888"]},filter:["to-boolean",!1]},{id:"isochrone-fill",type:"fill",source:"isochrone",paint:{"fill-color":"#2bb6c1","fill-opacity":["interpolate",["linear"],["zoom"],0,.35,8,.45,12,.55,16,.65]}},{id:"traffic-signal",type:"circle",source:"traffic_signals","source-layer":"traffic_signals",paint:{"circle-color":"#088","circle-opacity":0}},{id:"traffic-signal-highlight",type:"circle",source:"trafficLightScope",paint:{"circle-color":"rgba(195, 4, 4, 1)","circle-opacity":.95}}];class S5{map;mapdiv;constructor(){}initialiseMap(n){this.map=new xR.Map({container:n,style:"mapbox://styles/mapbox/navigation-night-v1",bounds:[-1.6385751592559075,53.74561587609992,-1.440918500568415,53.84393303110457],maxBounds:[-1.6385751592559075,53.74561587609992,-1.440918500568415,53.84393303110457],minZoom:6}),this.map.on("load",()=>{for(const c of Object.keys(EM)){const m=EM[c];m&&this.map?.addSource(c,m)}for(const c of T5)this.map?.addLayer(c);for(const c of Object.keys(SM)){const m=SM[c];m&&this.map?.on(c,m)}})}resize(){this.map?.resize()}}const xr=Ya({location:[0,0,0],isochrone:!1,highlightedTrafficLights:[],affectedBusRoutes:[]});/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const E5={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var A5=sr("<svg><!><!></svg>");function __(s,n){Yn(n,!0);const c=Re(n,"color",3,"currentColor"),m=Re(n,"size",3,24),_=Re(n,"strokeWidth",3,2),x=Re(n,"absoluteStrokeWidth",3,!1),T=Re(n,"iconNode",19,()=>[]),r=bi(n,["$$slots","$$events","$$legacy","name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","children"]);var I=A5();Ii(I,R=>({...E5,...r,width:m(),height:m(),stroke:c(),"stroke-width":R,class:["lucide-icon lucide",n.name&&`lucide-${n.name}`,n.class]}),[()=>x()?Number(_())*24/Number(m()):_()]);var k=Xn(I);ro(k,17,T,cs,(R,F)=>{var V=fe(()=>TB(A(F),2));let W=()=>A(V)[0],G=()=>A(V)[1];var K=Gt(),Y=yt(K);gR(Y,W,!0,(ne,oe)=>{Ii(ne,()=>({...G()}))}),je(R,K)});var P=Tn(k);Dn(P,()=>n.children??Si),Ln(I),je(s,I),Kn()}function I5(s,n){Yn(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let c=bi(n,["$$slots","$$events","$$legacy"]);const m=[["circle",{cx:"9",cy:"12",r:"1"}],["circle",{cx:"9",cy:"5",r:"1"}],["circle",{cx:"9",cy:"19",r:"1"}],["circle",{cx:"15",cy:"12",r:"1"}],["circle",{cx:"15",cy:"5",r:"1"}],["circle",{cx:"15",cy:"19",r:"1"}]];__(s,Hn({name:"grip-vertical"},()=>c,{get iconNode(){return m},children:(_,x)=>{var T=Gt(),r=yt(T);Dn(r,()=>n.children??Si),je(_,T)},$$slots:{default:!0}})),Kn()}function M5(s,n){Yn(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let c=bi(n,["$$slots","$$events","$$legacy"]);const m=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"}]];__(s,Hn({name:"moon"},()=>c,{get iconNode(){return m},children:(_,x)=>{var T=Gt(),r=yt(T);Dn(r,()=>n.children??Si),je(_,T)},$$slots:{default:!0}})),Kn()}function C5(s,n){Yn(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let c=bi(n,["$$slots","$$events","$$legacy"]);const m=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}],["path",{d:"M9 3v18"}]];__(s,Hn({name:"panel-left"},()=>c,{get iconNode(){return m},children:(_,x)=>{var T=Gt(),r=yt(T);Dn(r,()=>n.children??Si),je(_,T)},$$slots:{default:!0}})),Kn()}function P5(s,n){Yn(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let c=bi(n,["$$slots","$$events","$$legacy"]);const m=[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]];__(s,Hn({name:"sun"},()=>c,{get iconNode(){return m},children:(_,x)=>{var T=Gt(),r=yt(T);Dn(r,()=>n.children??Si),je(_,T)},$$slots:{default:!0}})),Kn()}function k5(s,n){Yn(n,!0);/**
 * @license @lucide/svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let c=bi(n,["$$slots","$$events","$$legacy"]);const m=[["path",{d:"M16 7h6v6"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17"}]];__(s,Hn({name:"trending-up"},()=>c,{get iconNode(){return m},children:(_,x)=>{var T=Gt(),r=yt(T);Dn(r,()=>n.children??Si),je(_,T)},$$slots:{default:!0}})),Kn()}const AR=typeof window<"u"?window:void 0;function R5(s){let n=s.activeElement;for(;n?.shadowRoot;){const c=n.shadowRoot.activeElement;if(c===n)break;n=c}return n}var z5=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],D5=["difference","intersection","symmetricDifference","union"],AM=!1;class c0 extends Set{#t=new Map;#e=Mn(0);#i=Mn(0);#n=hM||-1;constructor(n){if(super(),n){for(var c of n)super.add(c);this.#i.v=super.size}AM||this.#o()}#r(n){return hM===this.#n?Mn(n):Uw(n)}#o(){AM=!0;var n=c0.prototype,c=Set.prototype;for(const m of z5)n[m]=function(..._){return A(this.#e),c[m].apply(this,_)};for(const m of D5)n[m]=function(..._){A(this.#e);var x=c[m].apply(this,_);return new c0(x)}}has(n){var c=super.has(n),m=this.#t,_=m.get(n);if(_===void 0){if(!c)return A(this.#e),!1;_=this.#r(!0),m.set(n,_)}return A(_),c}add(n){return super.has(n)||(super.add(n),rn(this.#i,super.size),vb(this.#e)),this}delete(n){var c=super.delete(n),m=this.#t,_=m.get(n);return _!==void 0&&(m.delete(n),rn(_,!1)),c&&(rn(this.#i,super.size),vb(this.#e)),c}clear(){if(super.size!==0){super.clear();var n=this.#t;for(var c of n.values())rn(c,!1);n.clear(),rn(this.#i,0),vb(this.#e)}}keys(){return this.values()}values(){return A(this.#e),super.values()}entries(){return A(this.#e),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return A(this.#i)}}class L5{#t;#e;constructor(n,c){this.#t=n,this.#e=ld(c)}get current(){return this.#e(),this.#t()}}const O5=/\(.+\)/,F5=new Set(["all","print","screen","and","or","not","only"]);class cl extends L5{constructor(n,c){let m=O5.test(n)||n.split(/[\s,]+/).some(x=>F5.has(x.trim()))?n:`(${n})`;const _=window.matchMedia(m);super(()=>_.matches,x=>vs(_,"change",x))}}let B5=class{#t;#e;constructor(n={}){const{window:c=AR,document:m=c?.document}=n;c!==void 0&&(this.#t=m,this.#e=ld(_=>{const x=vs(c,"focusin",_),T=vs(c,"focusout",_);return()=>{x(),T()}}))}get current(){return this.#e?.(),this.#t?R5(this.#t):null}};new B5;function N5(s,n){switch(s){case"post":Os(n);break;case"pre":ki(n);break}}function IR(s,n,c,m={}){const{lazy:_=!1}=m;let x=!_,T=Array.isArray(s)?[]:void 0;N5(n,()=>{const r=Array.isArray(s)?s.map(k=>k()):s();if(!x){x=!0,T=r;return}const I=Ia(()=>c(r,T));return T=r,I})}function aT(s,n,c){IR(s,"post",n,c)}function V5(s,n,c){IR(s,"pre",n,c)}aT.pre=V5;function U5(s,n){switch(s){case"local":return n.localStorage;case"session":return n.sessionStorage}}class MR{#t;#e;#i;#n;#r;#o=Mn(0);constructor(n,c,m={}){const{storage:_="local",serializer:x={serialize:JSON.stringify,deserialize:JSON.parse},syncTabs:T=!0,window:r=AR}=m;if(this.#t=c,this.#e=n,this.#i=x,r===void 0)return;const I=U5(_,r);this.#n=I;const k=I.getItem(n);k!==null?this.#t=this.#a(k):this.#l(c),T&&_==="local"&&(this.#r=ld(()=>vs(r,"storage",this.#s)))}get current(){this.#r?.(),A(this.#o);const n=this.#a(this.#n?.getItem(this.#e))??this.#t,c=new WeakMap,m=_=>{if(_===null||_?.constructor.name==="Date"||typeof _!="object")return _;let x=c.get(_);return x||(x=new Proxy(_,{get:(T,r)=>(A(this.#o),m(Reflect.get(T,r))),set:(T,r,I)=>(rn(this.#o,A(this.#o)+1),Reflect.set(T,r,I),this.#l(n),!0)}),c.set(_,x)),x};return m(n)}set current(n){this.#l(n),rn(this.#o,A(this.#o)+1)}#s=n=>{n.key!==this.#e||n.newValue===null||(this.#t=this.#a(n.newValue),rn(this.#o,A(this.#o)+1))};#a(n){try{return this.#i.deserialize(n)}catch(c){console.error(`Error when parsing "${n}" from persisted store "${this.#e}"`,c);return}}#l(n){try{n!=null&&this.#n?.setItem(this.#e,this.#i.serialize(n))}catch(c){console.error(`Error when writing value from persisted store "${this.#e}" to ${this.#n}`,c)}}}function IM(s){return s.filter(n=>n.length>0)}const CR={getItem:s=>null,setItem:(s,n)=>{}},y_=typeof document<"u";function j5(s){return typeof s=="function"}function G5(s){return s!==null&&typeof s=="object"}const Qg=Symbol("box"),lT=Symbol("is-writable");function W5(s){return G5(s)&&Qg in s}function q5(s){return es.isBox(s)&&lT in s}function es(s){let n=Mn(Ya(s));return{[Qg]:!0,[lT]:!0,get current(){return A(n)},set current(c){rn(n,c,!0)}}}function H5(s,n){const c=fe(s);return n?{[Qg]:!0,[lT]:!0,get current(){return A(c)},set current(m){n(m)}}:{[Qg]:!0,get current(){return s()}}}function Z5(s){return es.isBox(s)?s:j5(s)?es.with(s):es(s)}function X5(s){return Object.entries(s).reduce((n,[c,m])=>es.isBox(m)?(es.isWritableBox(m)?Object.defineProperty(n,c,{get(){return m.current},set(_){m.current=_}}):Object.defineProperty(n,c,{get(){return m.current}}),n):Object.assign(n,{[c]:m}),{})}function Y5(s){return es.isWritableBox(s)?{[Qg]:!0,get current(){return s.current}}:s}es.from=Z5;es.with=H5;es.flatten=X5;es.readonly=Y5;es.isBox=W5;es.isWritableBox=q5;var Sb,MM;function K5(){if(MM)return Sb;MM=1;var s=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,n=/\n/g,c=/^\s*/,m=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,_=/^:\s*/,x=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,T=/^[;\s]*/,r=/^\s+|\s+$/g,I=`
`,k="/",P="*",R="",F="comment",V="declaration";Sb=function(G,K){if(typeof G!="string")throw new TypeError("First argument must be a string");if(!G)return[];K=K||{};var Y=1,ne=1;function oe(De){var Be=De.match(n);Be&&(Y+=Be.length);var Se=De.lastIndexOf(I);ne=~Se?De.length-Se:ne+De.length}function ce(){var De={line:Y,column:ne};return function(Be){return Be.position=new me(De),te(),Be}}function me(De){this.start=De,this.end={line:Y,column:ne},this.source=K.source}me.prototype.content=G;function ue(De){var Be=new Error(K.source+":"+Y+":"+ne+": "+De);if(Be.reason=De,Be.filename=K.source,Be.line=Y,Be.column=ne,Be.source=G,!K.silent)throw Be}function _e(De){var Be=De.exec(G);if(Be){var Se=Be[0];return oe(Se),G=G.slice(Se.length),Be}}function te(){_e(c)}function ie(De){var Be;for(De=De||[];Be=xe();)Be!==!1&&De.push(Be);return De}function xe(){var De=ce();if(!(k!=G.charAt(0)||P!=G.charAt(1))){for(var Be=2;R!=G.charAt(Be)&&(P!=G.charAt(Be)||k!=G.charAt(Be+1));)++Be;if(Be+=2,R===G.charAt(Be-1))return ue("End of comment missing");var Se=G.slice(2,Be-2);return ne+=2,oe(Se),G=G.slice(Be),ne+=2,De({type:F,comment:Se})}}function de(){var De=ce(),Be=_e(m);if(Be){if(xe(),!_e(_))return ue("property missing ':'");var Se=_e(x),Ne=De({type:V,property:W(Be[0].replace(s,R)),value:Se?W(Se[0].replace(s,R)):R});return _e(T),Ne}}function Te(){var De=[];ie(De);for(var Be;Be=de();)Be!==!1&&(De.push(Be),ie(De));return De}return te(),Te()};function W(G){return G?G.replace(r,R):R}return Sb}var J5=K5();const Q5=yR(J5);function $5(s,n){let c=null;if(!s||typeof s!="string")return c;const m=Q5(s),_=typeof n=="function";return m.forEach(x=>{if(x.type!=="declaration")return;const{property:T,value:r}=x;_?n(T,r,x):r&&(c=c||{},c[T]=r)}),c}function eN(s,n){const c=RegExp(s,"g");return m=>{if(typeof m!="string")throw new TypeError(`expected an argument of type string, but got ${typeof m}`);return m.match(c)?m.replace(c,n):m}}const tN=eN(/[A-Z]/,s=>`-${s.toLowerCase()}`);function nN(s){if(!s||typeof s!="object"||Array.isArray(s))throw new TypeError(`expected an argument of type object, but got ${typeof s}`);return Object.keys(s).map(n=>`${tN(n)}: ${s[n]};`).join(`
`)}function iN(s={}){return nN(s).replace(`
`," ")}const rN={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};iN(rN);const oN=typeof window<"u"?window:void 0;function sN(s){let n=s.activeElement;for(;n?.shadowRoot;){const c=n.shadowRoot.activeElement;if(c===n)break;n=c}return n}let aN=class{#t;#e;constructor(n={}){const{window:c=oN,document:m=c?.document}=n;c!==void 0&&(this.#t=m,this.#e=ld(_=>{const x=vs(c,"focusin",_),T=vs(c,"focusout",_);return()=>{x(),T()}}))}get current(){return this.#e?.(),this.#t?sN(this.#t):null}};new aN;const Yh=es("mode-watcher-mode"),Kh=es("mode-watcher-theme"),lN=["dark","light","system"];function Hw(s){return typeof s!="string"?!1:lN.includes(s)}class cN{#t="system";#e=y_?localStorage:CR;#i=this.#e.getItem(Yh.current);#n=Hw(this.#i)?this.#i:this.#t;#r=Mn(Ya(this.#o()));#o(n=this.#n){return new MR(Yh.current,n,{serializer:{serialize:c=>c,deserialize:c=>Hw(c)?c:this.#t}})}constructor(){m_(()=>aT.pre(()=>Yh.current,(n,c)=>{const m=A(this.#r).current;rn(this.#r,this.#o(m),!0),c&&localStorage.removeItem(c)}))}get current(){return A(this.#r).current}set current(n){A(this.#r).current=n}}class uN{#t=void 0;#e=!0;#i=Mn(Ya(this.#t));#n=typeof window<"u"&&typeof window.matchMedia=="function"?new cl("prefers-color-scheme: light"):{current:!1};query(){y_&&rn(this.#i,this.#n.current?"light":"dark",!0)}tracking(n){this.#e=n}constructor(){m_(()=>{ki(()=>{this.#e&&this.query()})}),this.query=this.query.bind(this),this.tracking=this.tracking.bind(this)}get current(){return A(this.#i)}}const u0=new cN,Zw=new uN;class hN{#t=y_?localStorage:CR;#e=this.#t.getItem(Kh.current);#i=this.#e===null||this.#e===void 0?"":this.#e;#n=Mn(Ya(this.#r()));#r(n=this.#i){return new MR(Kh.current,n,{serializer:{serialize:c=>typeof c!="string"?"":c,deserialize:c=>c}})}constructor(){m_(()=>aT.pre(()=>Kh.current,(n,c)=>{const m=A(this.#n).current;rn(this.#n,this.#r(m),!0),c&&localStorage.removeItem(c)}))}get current(){return A(this.#n).current}set current(n){A(this.#n).current=n}}const $v=new hN;let CM,PM,kM=!1,Tg=null;function dN(){return Tg||(Tg=document.createElement("style"),Tg.appendChild(document.createTextNode(`* {
		-webkit-transition: none !important;
		-moz-transition: none !important;
		-o-transition: none !important;
		-ms-transition: none !important;
		transition: none !important;
	}`)),Tg)}function PR(s,n=!1){if(typeof document>"u")return;if(!kM){kM=!0,s();return}if(typeof window<"u"&&window.__vitest_worker__){s();return}clearTimeout(CM),clearTimeout(PM);const m=dN(),_=()=>document.head.appendChild(m),x=()=>{m.parentNode&&document.head.removeChild(m)};function T(){s(),window.requestAnimationFrame(x)}if(typeof window.requestAnimationFrame<"u"){_(),n?T():window.requestAnimationFrame(()=>{T()});return}_(),CM=window.setTimeout(()=>{s(),PM=window.setTimeout(x,16)},16)}const Wu=es(void 0),h0=es(!0),d0=es(!1),Xw=es([]),Yw=es([]);function fN(){const s=fe(()=>{if(!y_)return;const n=u0.current==="system"?Zw.current:u0.current,c=IM(Xw.current),m=IM(Yw.current);function _(){const x=document.documentElement,T=document.querySelector('meta[name="theme-color"]');n==="light"?(c.length&&x.classList.remove(...c),m.length&&x.classList.add(...m),x.style.colorScheme="light",T&&Wu.current&&T.setAttribute("content",Wu.current.light)):(m.length&&x.classList.remove(...m),c.length&&x.classList.add(...c),x.style.colorScheme="dark",T&&Wu.current&&T.setAttribute("content",Wu.current.dark))}return h0.current?PR(_,d0.current):_(),n});return{get current(){return A(s)}}}function pN(){const s=fe(()=>{if($v.current,!y_)return;function n(){document.documentElement.setAttribute("data-theme",$v.current)}return h0.current?PR(n,Ia(()=>d0.current)):n(),$v.current});return{get current(){return A(s)}}}const kR=fN(),mN=pN();function gN(){u0.current=kR.current==="dark"?"light":"dark"}function _N(s){u0.current=s}function yN(s){$v.current=s}function vN({defaultMode:s="system",themeColors:n,darkClassNames:c=["dark"],lightClassNames:m=[],defaultTheme:_="",modeStorageKey:x="mode-watcher-mode",themeStorageKey:T="mode-watcher-theme"}){const r=document.documentElement,I=localStorage.getItem(x)??s,k=localStorage.getItem(T)??_,P=I==="light"||I==="system"&&window.matchMedia("(prefers-color-scheme: light)").matches;if(P?(c.length&&r.classList.remove(...c.filter(Boolean)),m.length&&r.classList.add(...m.filter(Boolean))):(m.length&&r.classList.remove(...m.filter(Boolean)),c.length&&r.classList.add(...c.filter(Boolean))),r.style.colorScheme=P?"light":"dark",n){const R=document.querySelector('meta[name="theme-color"]');R&&R.setAttribute("content",I==="light"?n.light:n.dark)}k&&(r.setAttribute("data-theme",k),localStorage.setItem(T,k)),localStorage.setItem(x,I)}var xN=Un('<meta name="theme-color"/>');function bN(s,n){Yn(n,!0);var c=Gt(),m=yt(c);{var _=x=>{var T=xN();Vi(()=>Gi(T,"content",n.themeColors.dark)),je(x,T)};Zt(m,x=>{n.themeColors&&x(_)})}je(s,c),Kn()}var wN=Un('<meta name="theme-color"/>'),TN=Un("<!> <!>",1);function SN(s,n){Yn(n,!0);let c=Re(n,"trueNonce",3,"");SB(m=>{var _=TN(),x=yt(_);{var T=I=>{var k=wN();Vi(()=>Gi(k,"content",n.themeColors.dark)),je(I,k)};Zt(x,I=>{n.themeColors&&I(T)})}var r=Tn(x,2);RB(r,()=>`<script${c()?` nonce=${c()}`:""}>(`+vN.toString()+")("+JSON.stringify(n.initConfig)+");<\/script>"),je(m,_)}),Kn()}function EN(s,n){Yn(n,!0);let c=Re(n,"track",3,!0),m=Re(n,"defaultMode",3,"system"),_=Re(n,"disableTransitions",3,!0),x=Re(n,"darkClassNames",19,()=>["dark"]),T=Re(n,"lightClassNames",19,()=>[]),r=Re(n,"defaultTheme",3,""),I=Re(n,"nonce",3,""),k=Re(n,"themeStorageKey",3,"mode-watcher-theme"),P=Re(n,"modeStorageKey",3,"mode-watcher-mode"),R=Re(n,"disableHeadScriptInjection",3,!1),F=Re(n,"synchronousModeChanges",3,!1);Yh.current=P(),Kh.current=k(),Xw.current=x(),Yw.current=T(),h0.current=_(),Wu.current=n.themeColors,d0.current=F(),ki(()=>{d0.current=F()}),ki(()=>{h0.current=_()}),ki(()=>{Wu.current=n.themeColors}),ki(()=>{Xw.current=x()}),ki(()=>{Yw.current=T()}),ki(()=>{Yh.current=P()}),ki(()=>{Kh.current=k()}),ki(()=>{kR.current,Yh.current,Kh.current,mN.current}),bp(()=>{Zw.tracking(c()),Zw.query();const oe=localStorage.getItem(Yh.current);_N(Hw(oe)?oe:m());const ce=localStorage.getItem(Kh.current);yN(ce||r())});const V={defaultMode:m(),themeColors:n.themeColors,darkClassNames:x(),lightClassNames:T(),defaultTheme:r(),modeStorageKey:P(),themeStorageKey:k()},W=fe(()=>typeof window>"u"?I():"");var G=Gt(),K=yt(G);{var Y=oe=>{bN(oe,{get themeColors(){return Wu.current}})},ne=oe=>{SN(oe,{get trueNonce(){return A(W)},get initConfig(){return V},get themeColors(){return Wu.current}})};Zt(K,oe=>{R()?oe(Y):oe(ne,!1)})}je(s,G),Kn()}function AN(s){return typeof s=="function"}function cT(s){return s!==null&&typeof s=="object"}const IN=["string","number","bigint","boolean"];function Kw(s){return s==null||IN.includes(typeof s)?!0:Array.isArray(s)?s.every(n=>Kw(n)):typeof s=="object"?Object.getPrototypeOf(s)===Object.prototype:!1}const $g=Symbol("box"),uT=Symbol("is-writable");function MN(s){return cT(s)&&$g in s}function CN(s){return Sr.isBox(s)&&uT in s}function Sr(s){let n=Mn(Ya(s));return{[$g]:!0,[uT]:!0,get current(){return A(n)},set current(c){rn(n,c,!0)}}}function PN(s,n){const c=fe(s);return n?{[$g]:!0,[uT]:!0,get current(){return A(c)},set current(m){n(m)}}:{[$g]:!0,get current(){return s()}}}function kN(s){return Sr.isBox(s)?s:AN(s)?Sr.with(s):Sr(s)}function RN(s){return Object.entries(s).reduce((n,[c,m])=>Sr.isBox(m)?(Sr.isWritableBox(m)?Object.defineProperty(n,c,{get(){return m.current},set(_){m.current=_}}):Object.defineProperty(n,c,{get(){return m.current}}),n):Object.assign(n,{[c]:m}),{})}function zN(s){return Sr.isWritableBox(s)?{[$g]:!0,get current(){return s.current}}:s}Sr.from=kN;Sr.with=PN;Sr.flatten=RN;Sr.readonly=zN;Sr.isBox=MN;Sr.isWritableBox=CN;function DN(...s){return function(n){for(const c of s)if(c){if(n.defaultPrevented)return;typeof c=="function"?c.call(this,n):c.current?.call(this,n)}}}const LN=/\d/,ON=["-","_","/","."];function FN(s=""){if(!LN.test(s))return s!==s.toLowerCase()}function BN(s){const n=[];let c="",m,_;for(const x of s){const T=ON.includes(x);if(T===!0){n.push(c),c="",m=void 0;continue}const r=FN(x);if(_===!1){if(m===!1&&r===!0){n.push(c),c=x,m=r;continue}if(m===!0&&r===!1&&c.length>1){const I=c.at(-1);n.push(c.slice(0,Math.max(0,c.length-1))),c=I+x,m=r;continue}}c+=x,m=r,_=T}return n.push(c),n}function RR(s){return s?BN(s).map(n=>VN(n)).join(""):""}function NN(s){return UN(RR(s||""))}function VN(s){return s?s[0].toUpperCase()+s.slice(1):""}function UN(s){return s?s[0].toLowerCase()+s.slice(1):""}function Sv(s){if(!s)return{};const n={};function c(m,_){if(m.startsWith("-moz-")||m.startsWith("-webkit-")||m.startsWith("-ms-")||m.startsWith("-o-")){n[RR(m)]=_;return}if(m.startsWith("--")){n[m]=_;return}n[NN(m)]=_}return $5(s,c),n}function zR(...s){return(...n)=>{for(const c of s)typeof c=="function"&&c(...n)}}function jN(s,n,c,m){const _=Array.isArray(n)?n:[n];return _.forEach(x=>s.addEventListener(x,c,m)),()=>{_.forEach(x=>s.removeEventListener(x,c,m))}}function GN(s,n){const c=RegExp(s,"g");return m=>{if(typeof m!="string")throw new TypeError(`expected an argument of type string, but got ${typeof m}`);return m.match(c)?m.replace(c,n):m}}const WN=GN(/[A-Z]/,s=>`-${s.toLowerCase()}`);function qN(s){if(!s||typeof s!="object"||Array.isArray(s))throw new TypeError(`expected an argument of type object, but got ${typeof s}`);return Object.keys(s).map(n=>`${WN(n)}: ${s[n]};`).join(`
`)}function DR(s={}){return qN(s).replace(`
`," ")}const HN={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};DR(HN);const ZN=["onabort","onanimationcancel","onanimationend","onanimationiteration","onanimationstart","onauxclick","onbeforeinput","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncompositionend","oncompositionstart","oncompositionupdate","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onfocusin","onfocusout","onformdata","ongotpointercapture","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onlostpointercapture","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onpaste","onpause","onplay","onplaying","onpointercancel","onpointerdown","onpointerenter","onpointerleave","onpointermove","onpointerout","onpointerover","onpointerup","onprogress","onratechange","onreset","onresize","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onselectionchange","onselectstart","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ontransitioncancel","ontransitionend","ontransitionrun","ontransitionstart","onvolumechange","onwaiting","onwebkitanimationend","onwebkitanimationiteration","onwebkitanimationstart","onwebkittransitionend","onwheel"],XN=new Set(ZN);function YN(s){return XN.has(s)}function hT(...s){const n={...s[0]};for(let c=1;c<s.length;c++){const m=s[c];if(m){for(const _ of Object.keys(m)){const x=n[_],T=m[_],r=typeof x=="function",I=typeof T=="function";if(r&&YN(_)){const k=x,P=T;n[_]=DN(k,P)}else if(r&&I)n[_]=zR(x,T);else if(_==="class"){const k=Kw(x),P=Kw(T);k&&P?n[_]=Hg(x,T):k?n[_]=Hg(x):P&&(n[_]=Hg(T))}else if(_==="style"){const k=typeof x=="object",P=typeof T=="object",R=typeof x=="string",F=typeof T=="string";if(k&&P)n[_]={...x,...T};else if(k&&F){const V=Sv(T);n[_]={...x,...V}}else if(R&&P){const V=Sv(x);n[_]={...V,...T}}else if(R&&F){const V=Sv(x),W=Sv(T);n[_]={...V,...W}}else k?n[_]=x:P?n[_]=T:R?n[_]=x:F&&(n[_]=T)}else n[_]=T!==void 0?T:x}for(const _ of Object.getOwnPropertySymbols(m)){const x=n[_],T=m[_];n[_]=T!==void 0?T:x}}}return typeof n.style=="object"&&(n.style=DR(n.style).replaceAll(`
`," ")),n.hidden!==!0&&(n.hidden=void 0,delete n.hidden),n.disabled!==!0&&(n.disabled=void 0,delete n.disabled),n}const KN=typeof window<"u"?window:void 0;function JN(s){let n=s.activeElement;for(;n?.shadowRoot;){const c=n.shadowRoot.activeElement;if(c===n)break;n=c}return n}let QN=class{#t;#e;constructor(n={}){const{window:c=KN,document:m=c?.document}=n;c!==void 0&&(this.#t=m,this.#e=ld(_=>{const x=vs(c,"focusin",_),T=vs(c,"focusout",_);return()=>{x(),T()}}))}get current(){return this.#e?.(),this.#t?JN(this.#t):null}};new QN;function $N(s){fR().then(s)}const e4=9;function t4(s){return cT(s)&&s.nodeType===e4}function n4(s){return cT(s)&&s.constructor?.name==="VisualViewport"}function i4(s){return t4(s)?s:n4(s)?s.document:s?.ownerDocument??document}function r4(s){let n=s.activeElement;for(;n?.shadowRoot;){const c=n.shadowRoot.activeElement;if(c===n)break;n=c}return n}class dT{element;#t=fe(()=>this.element.current?this.element.current.getRootNode()??document:document);get root(){return A(this.#t)}set root(n){rn(this.#t,n)}constructor(n){typeof n=="function"?this.element=Sr.with(n):this.element=n}getDocument=()=>i4(this.root);getWindow=()=>this.getDocument().defaultView??window;getActiveElement=()=>r4(this.root);isActiveElement=n=>n===this.getActiveElement();getElementById(n){return this.root.getElementById(n)}querySelector=n=>this.root?this.root.querySelector(n):null;querySelectorAll=n=>this.root?this.root.querySelectorAll(n):[];setTimeout=(n,c)=>this.getWindow().setTimeout(n,c);clearTimeout=n=>this.getWindow().clearTimeout(n)}function fT(s,n){return{[CB()]:c=>Sr.isBox(s)?(s.current=c,Ia(()=>n?.(c)),()=>{"isConnected"in c&&c.isConnected||(s.current=null)}):(s(c),Ia(()=>n?.(c)),()=>{"isConnected"in c&&c.isConnected||s(null)})}}function o4({layout:s,panesArray:n,pivotIndices:c}){let m=0,_=100,x=0,T=0;const r=c[0];for(let R=0;R<n.length;R++){const F=n[R].constraints,{maxSize:V=100,minSize:W=0}=F;R===r?(m=W,_=V):(x+=W,T+=V)}const I=Math.min(_,100-x),k=Math.max(m,100-T),P=s[r];return{valueMax:I,valueMin:k,valueNow:P}}function Mo(s,n="Assertion failed!"){if(!s)throw console.error(n),new Error(n)}const s4=100,pT=10;function ua(s,n,c=pT){return e_(s,n,c)===0}function e_(s,n,c=pT){const m=RM(s,c),_=RM(n,c);return Math.sign(m-_)}function Sg(s,n){if(s.length!==n.length)return!1;for(let c=0;c<s.length;c++)if(s[c]!==n[c])return!1;return!0}function RM(s,n){return Number.parseFloat(s.toFixed(n))}const nx=typeof document<"u";function a4(s){return s instanceof HTMLElement}function LR(s){return s.type==="keydown"}function OR(s){return s.type.startsWith("mouse")}function FR(s){return s.type.startsWith("touch")}function ip({paneConstraints:s,paneIndex:n,initialSize:c}){const m=s[n];Mo(m!=null,"Pane constraints should not be null.");const{collapsedSize:_=0,collapsible:x,maxSize:T=100,minSize:r=0}=m;let I=c;return e_(I,r)<0&&(I=l4(I,x,_,r)),I=Math.min(T,I),Number.parseFloat(I.toFixed(pT))}function l4(s,n,c,m){if(!n)return m;const _=(c+m)/2;return e_(s,_)<0?c:m}function td(){}function c4({groupId:s,layout:n,panesArray:c,domContext:m}){const _=v_(s,m);for(let x=0;x<c.length-1;x++){const{valueMax:T,valueMin:r,valueNow:I}=o4({layout:n,panesArray:c,pivotIndices:[x,x+1]}),k=_[x];if(a4(k)){const P=c[x];k.setAttribute("aria-controls",P.opts.id.current),k.setAttribute("aria-valuemax",`${Math.round(T)}`),k.setAttribute("aria-valuemin",`${Math.round(r)}`),k.setAttribute("aria-valuenow",I!=null?`${Math.round(I)}`:"")}}return()=>{for(const x of _)x.removeAttribute("aria-controls"),x.removeAttribute("aria-valuemax"),x.removeAttribute("aria-valuemin"),x.removeAttribute("aria-valuenow")}}function v_(s,n){return nx?Array.from(n.querySelectorAll(`[data-pane-resizer-id][data-pane-group-id="${s}"]`)):[]}function BR({groupId:s,id:n,domContext:c}){return nx?v_(s,c).findIndex(x=>x.getAttribute("data-pane-resizer-id")===n)??null:null}function zM({groupId:s,dragHandleId:n,domContext:c}){const m=BR({groupId:s,id:n,domContext:c});return m!=null?[m,m+1]:[-1,-1]}function qf(s,n,c){const m=s.map(k=>k.constraints),_=$f(s,n),x=m[_],r=_===s.length-1?[_-1,_]:[_,_+1],I=c[_];return{...x,paneSize:I,pivotIndices:r}}function $f(s,n){return s.findIndex(c=>c.opts.id.current===n.opts.id.current)}function Eg(s,n,c){for(let m=0;m<n.length;m++){const _=n[m],x=s[m];Mo(x);const{collapsedSize:T=0,collapsible:r}=x.constraints,I=c[x.opts.id.current];if(!(I==null||_!==I))continue;c[x.opts.id.current]=_;const{onCollapse:k,onExpand:P,onResize:R}=x.callbacks;R?.(_,I),r&&(k||P)&&(P&&(I==null||I===T)&&_!==T&&P(),k&&(I==null||I!==T)&&_===T&&k())}}function u4({panesArray:s}){const n=Array(s.length),c=s.map(x=>x.constraints);let m=0,_=100;for(let x=0;x<s.length;x++){const T=c[x];Mo(T);const{defaultSize:r}=T;r!=null&&(m++,n[x]=r,_-=r)}for(let x=0;x<s.length;x++){const T=c[x];Mo(T);const{defaultSize:r}=T;if(r!=null)continue;const I=s.length-m,k=_/I;m++,n[x]=k,_-=k}return n}function h4({layout:s,paneConstraints:n}){const c=[...s],m=c.reduce((x,T)=>x+T,0);if(c.length!==n.length)throw new Error(`Invalid ${n.length} pane layout: ${c.map(x=>`${x}%`).join(", ")}`);if(!ua(m,100))for(let x=0;x<n.length;x++){const T=c[x];Mo(T!=null);const r=100/m*T;c[x]=r}let _=0;for(let x=0;x<n.length;x++){const T=c[x];Mo(T!=null);const r=ip({paneConstraints:n,paneIndex:x,initialSize:T});T!==r&&(_+=T-r,c[x]=r)}if(!ua(_,0))for(let x=0;x<n.length;x++){const T=c[x];Mo(T!=null);const r=T+_,I=ip({paneConstraints:n,paneIndex:x,initialSize:r});if(T!==I&&(_-=I-T,c[x]=I,ua(_,0)))break}return c}function d4(s,n){if(!nx)return null;const c=n.querySelector(`[data-pane-group][data-pane-group-id="${s}"]`);return c||null}function mT(s,n){if(!nx)return null;const c=n.querySelector(`[data-pane-resizer-id="${s}"]`);return c||null}function f4({event:s,dragHandleId:n,dir:c,initialDragState:m,domContext:_}){const x=c==="horizontal",T=mT(n,_);Mo(T);const r=T.getAttribute("data-pane-group-id");Mo(r);const{initialCursorPosition:I}=m,k=NR(c,s),P=d4(r,_);Mo(P);const R=P.getBoundingClientRect(),F=x?R.width:R.height;return(k-I)/F*100}function p4({event:s,dragHandleId:n,dir:c,initialDragState:m,keyboardResizeBy:_,domContext:x}){if(LR(s)){const T=c==="horizontal";let r=0;s.shiftKey?r=100:_!=null?r=_:r=10;let I=0;switch(s.key){case"ArrowDown":I=T?0:r;break;case"ArrowLeft":I=T?-r:0;break;case"ArrowRight":I=T?r:0;break;case"ArrowUp":I=T?0:-r;break;case"End":I=100;break;case"Home":I=-100;break}return I}else return m==null?0:f4({event:s,dragHandleId:n,dir:c,initialDragState:m,domContext:x})}function NR(s,n){const c=s==="horizontal";if(OR(n))return c?n.clientX:n.clientY;if(FR(n)){const m=n.touches[0];return Mo(m),c?m.screenX:m.screenY}else throw new Error(`Unsupported event type "${n.type}"`)}function m4({groupId:s,handleId:n,panesArray:c,domContext:m}){const _=mT(n,m),x=v_(s,m),T=_?x.indexOf(_):-1,r=c[T]?.opts.id.current??null,I=c[T+1]?.opts.id.current??null;return[r,I]}const g4=typeof window<"u"?window:void 0;function _4(s){let n=s.activeElement;for(;n?.shadowRoot;){const c=n.shadowRoot.activeElement;if(c===n)break;n=c}return n}let y4=class{#t;#e;constructor(n={}){const{window:c=g4,document:m=c?.document}=n;c!==void 0&&(this.#t=m,this.#e=ld(_=>{const x=vs(c,"focusin",_),T=vs(c,"focusout",_);return()=>{x(),T()}}))}get current(){return this.#e?.(),this.#t?_4(this.#t):null}};new y4;function v4(s,n){switch(s){case"post":Os(n);break;case"pre":ki(n);break}}function VR(s,n,c,m={}){const{lazy:_=!1}=m;let x=!_,T=Array.isArray(s)?[]:void 0;v4(n,()=>{const r=Array.isArray(s)?s.map(k=>k()):s();if(!x){x=!0,T=r;return}const I=Ia(()=>c(r,T));return T=r,I})}function Zg(s,n,c){VR(s,"post",n,c)}function x4(s,n,c){VR(s,"pre",n,c)}Zg.pre=x4;let b4=class{#t;#e;constructor(n){this.#t=n,this.#e=Symbol(n)}get key(){return this.#e}exists(){return pR(this.#e)}get(){const n=Kg(this.#e);if(n===void 0)throw new Error(`Context "${this.#t}" not found`);return n}getOr(n){const c=Kg(this.#e);return c===void 0?n:c}set(n){return tT(this.#e,n)}};function Ag({delta:s,layout:n,paneConstraints:c,pivotIndices:m,trigger:_}){if(ua(s,0))return n;const x=[...n],[T,r]=m;let I=0;if(_==="keyboard"){{const P=s<0?r:T,R=c[P];if(Mo(R),R.collapsible){const F=n[P];Mo(F!=null);const V=c[P];Mo(V);const{collapsedSize:W=0,minSize:G=0}=V;if(ua(F,W)){const K=G-F;e_(K,Math.abs(s))>0&&(s=s<0?0-K:K)}}}{const P=s<0?T:r,R=c[P];Mo(R);const{collapsible:F}=R;if(F){const V=n[P];Mo(V!=null);const W=c[P];Mo(W);const{collapsedSize:G=0,minSize:K=0}=W;if(ua(V,K)){const Y=V-G;e_(Y,Math.abs(s))>0&&(s=s<0?0-Y:Y)}}}}{const P=s<0?1:-1;let R=s<0?r:T,F=0;for(;;){const W=n[R];Mo(W!=null);const K=ip({paneConstraints:c,paneIndex:R,initialSize:100})-W;if(F+=K,R+=P,R<0||R>=c.length)break}const V=Math.min(Math.abs(s),Math.abs(F));s=s<0?0-V:V}{let R=s<0?T:r;for(;R>=0&&R<c.length;){const F=Math.abs(s)-Math.abs(I),V=n[R];Mo(V!=null);const W=V-F,G=ip({paneConstraints:c,paneIndex:R,initialSize:W});if(!ua(V,G)&&(I+=V-G,x[R]=G,I.toPrecision(3).localeCompare(Math.abs(s).toPrecision(3),void 0,{numeric:!0})>=0))break;s<0?R--:R++}}if(ua(I,0))return n;{const P=s<0?r:T,R=n[P];Mo(R!=null);const F=R+I,V=ip({paneConstraints:c,paneIndex:P,initialSize:F});if(x[P]=V,!ua(V,F)){let W=F-V,K=s<0?r:T;for(;K>=0&&K<c.length;){const Y=x[K];Mo(Y!=null);const ne=Y+W,oe=ip({paneConstraints:c,paneIndex:K,initialSize:ne});if(ua(Y,oe)||(W-=oe-Y,x[K]=oe),ua(W,0))break;s>0?K--:K++}}}const k=x.reduce((P,R)=>R+P,0);return ua(k,100)?x:n}let Jw=null,Jh=null;function UR(s){switch(s){case"horizontal":return"ew-resize";case"horizontal-max":return"w-resize";case"horizontal-min":return"e-resize";case"vertical":return"ns-resize";case"vertical-max":return"n-resize";case"vertical-min":return"s-resize"}}function w4(){Jh!==null&&(document.head.removeChild(Jh),Jw=null,Jh=null)}function Eb(s,n){if(Jw===s)return;Jw=s;const c=UR(s);Jh===null&&(Jh=n.createElement("style"),n.head.appendChild(Jh)),Jh.innerHTML=`*{cursor: ${c}!important;}`}function T4({defaultSize:s,dragState:n,layout:c,panesArray:m,paneIndex:_,precision:x=3}){const T=c[_];let r;return T==null?r=s??"1":m.length===1?r="1":r=T.toPrecision(x),{flexBasis:0,flexGrow:r,flexShrink:1,overflow:"hidden",pointerEvents:n!==null?"none":void 0}}function DM(s){try{if(typeof localStorage>"u")throw new TypeError("localStorage is not supported in this environment");s.getItem=n=>localStorage.getItem(n),s.setItem=(n,c)=>localStorage.setItem(n,c)}catch(n){console.error(n),s.getItem=()=>null,s.setItem=()=>{}}}function jR(s){return`paneforge:${s}`}function GR(s){return s.map(c=>c.opts.order.current?`${c.opts.order.current}:${JSON.stringify(c.constraints)}`:JSON.stringify(c.constraints)).sort().join(",")}function WR(s,n){try{const c=jR(s),m=n.getItem(c),_=JSON.parse(m||"");if(typeof _=="object"&&_!==null)return _}catch{}return null}function S4(s,n,c){const m=WR(s,c)||{},_=GR(n);return m[_]||null}function E4(s,n,c,m,_){const x=jR(s),T=GR(n),r=WR(s,_)||{};r[T]={expandToSizes:Object.fromEntries(c.entries()),layout:m};try{_.setItem(x,JSON.stringify(r))}catch(I){console.error(I)}}const LM={};function A4(s,n=10){let c=null;return(..._)=>{c!==null&&clearTimeout(c),c=setTimeout(()=>{s(..._)},n)}}function I4({autoSaveId:s,layout:n,storage:c,panesArray:m,paneSizeBeforeCollapse:_}){if(n.length===0||n.length!==m.length)return;let x=LM[s];x==null&&(x=A4(E4,s4),LM[s]=x);const T=[...m],r=new Map(_);x(s,T,r,n,c)}const Lg={getItem:s=>(DM(Lg),Lg.getItem(s)),setItem:(s,n)=>{DM(Lg),Lg.setItem(s,n)}},gT=new b4("PaneGroup");class _T{static create(n){return gT.set(new _T(n))}opts;attachment;domContext;#t=Mn(null);get dragState(){return A(this.#t)}set dragState(n){rn(this.#t,n)}#e=Mn([]);get layout(){return A(this.#e)}set layout(n){rn(this.#e,n)}#i=Mn([]);get panesArray(){return A(this.#i)}set panesArray(n){rn(this.#i,n)}#n=Mn(!1);get panesArrayChanged(){return A(this.#n)}set panesArrayChanged(n){rn(this.#n,n,!0)}#r=Mn(Ya({}));get paneIdToLastNotifiedSizeMap(){return A(this.#r)}set paneIdToLastNotifiedSizeMap(n){rn(this.#r,n,!0)}paneSizeBeforeCollapseMap=new Map;prevDelta=0;constructor(n){this.opts=n,this.attachment=fT(this.opts.ref),this.domContext=new dT(this.opts.ref),Zg([()=>this.opts.id.current,()=>this.layout,()=>this.panesArray],()=>c4({groupId:this.opts.id.current,layout:this.layout,panesArray:this.panesArray,domContext:this.domContext})),Os(()=>Ia(()=>this.#o())),Zg([()=>this.opts.autoSaveId.current,()=>this.layout,()=>this.opts.storage.current],()=>{this.opts.autoSaveId.current&&I4({autoSaveId:this.opts.autoSaveId.current,layout:this.layout,storage:this.opts.storage.current,panesArray:this.panesArray,paneSizeBeforeCollapse:this.paneSizeBeforeCollapseMap})}),Zg(()=>this.panesArrayChanged,()=>{if(!this.panesArrayChanged)return;this.panesArrayChanged=!1;const c=this.layout;let m=null;if(this.opts.autoSaveId.current){const x=S4(this.opts.autoSaveId.current,this.panesArray,this.opts.storage.current);x&&(this.paneSizeBeforeCollapseMap=new Map(Object.entries(x.expandToSizes)),m=x.layout)}m==null&&(m=u4({panesArray:this.panesArray}));const _=h4({layout:m,paneConstraints:this.panesArray.map(x=>x.constraints)});Sg(c,_)||(this.layout=_,this.opts.onLayout.current?.(_),Eg(this.panesArray,_,this.paneIdToLastNotifiedSizeMap))})}setLayout=n=>{this.layout=n};registerResizeHandle=n=>c=>{c.preventDefault();const m=this.opts.direction.current,_=this.dragState,x=this.opts.id.current,T=this.opts.keyboardResizeBy.current,r=this.layout,I=this.panesArray,{initialLayout:k}=_??{},P=this.domContext.getDocument(),R=zM({groupId:x,dragHandleId:n,domContext:this.domContext});let F=p4({event:c,dragHandleId:n,dir:m,initialDragState:_,keyboardResizeBy:T,domContext:this.domContext});if(F===0)return;const V=m==="horizontal";P.dir==="rtl"&&V&&(F=-F);const W=I.map(Y=>Y.constraints),G=Ag({delta:F,layout:k??r,paneConstraints:W,pivotIndices:R,trigger:LR(c)?"keyboard":"mouse-or-touch"}),K=!Sg(r,G);(OR(c)||FR(c))&&this.prevDelta!==F&&(this.prevDelta=F,Eb(K?V?"horizontal":"vertical":V?F<0?"horizontal-min":"horizontal-max":F<0?"vertical-min":"vertical-max",P)),K&&(this.setLayout(G),this.opts.onLayout.current?.(G),Eg(I,G,this.paneIdToLastNotifiedSizeMap))};resizePane=(n,c)=>{const m=this.layout,_=this.panesArray,x=_.map(R=>R.constraints),{paneSize:T,pivotIndices:r}=qf(_,n,m);Mo(T!=null);const k=$f(_,n)===_.length-1?T-c:c-T,P=Ag({delta:k,layout:m,paneConstraints:x,pivotIndices:r,trigger:"imperative-api"});Sg(m,P)||(this.setLayout(P),this.opts.onLayout.current?.(P),Eg(_,P,this.paneIdToLastNotifiedSizeMap))};startDragging=(n,c)=>{const m=this.opts.direction.current,_=this.layout,x=mT(n,this.domContext);Mo(x);const T=NR(m,c);this.dragState={dragHandleId:n,dragHandleRect:x.getBoundingClientRect(),initialCursorPosition:T,initialLayout:_}};stopDragging=()=>{w4(),this.dragState=null};isPaneCollapsed=n=>{const c=this.panesArray,m=this.layout,{collapsedSize:_=0,collapsible:x,paneSize:T}=qf(c,n,m);return typeof T!="number"||typeof _!="number"?!1:x===!0&&ua(T,_)};expandPane=n=>{const c=this.layout,m=this.panesArray;if(!n.constraints.collapsible)return;const _=m.map(W=>W.constraints),{collapsedSize:x=0,paneSize:T,minSize:r=0,pivotIndices:I}=qf(m,n,c);if(T!==x)return;const k=this.paneSizeBeforeCollapseMap.get(n.opts.id.current),P=k!=null&&k>=r?k:r,F=$f(m,n)===m.length-1?T-P:P-T,V=Ag({delta:F,layout:c,paneConstraints:_,pivotIndices:I,trigger:"imperative-api"});Sg(c,V)||(this.setLayout(V),this.opts.onLayout.current?.(V),Eg(m,V,this.paneIdToLastNotifiedSizeMap))};collapsePane=n=>{const c=this.layout,m=this.panesArray;if(!n.constraints.collapsible)return;const _=m.map(R=>R.constraints),{collapsedSize:x=0,paneSize:T,pivotIndices:r}=qf(m,n,c);if(Mo(T!=null),T===x)return;this.paneSizeBeforeCollapseMap.set(n.opts.id.current,T);const k=$f(m,n)===m.length-1?T-x:x-T,P=Ag({delta:k,layout:c,paneConstraints:_,pivotIndices:r,trigger:"imperative-api"});Sg(c,P)||(this.layout=P,this.opts.onLayout.current?.(P),Eg(m,P,this.paneIdToLastNotifiedSizeMap))};getPaneSize=n=>qf(this.panesArray,n,this.layout).paneSize;getPaneStyle=(n,c)=>{const m=this.panesArray,_=this.layout,x=this.dragState,T=$f(m,n);return T4({defaultSize:c,dragState:x,layout:_,panesArray:m,paneIndex:T})};isPaneExpanded=n=>{const{collapsedSize:c=0,collapsible:m,paneSize:_}=qf(this.panesArray,n,this.layout);return!m||_>c};registerPane=n=>{const c=[...this.panesArray,n];return c.sort((m,_)=>{const x=m.opts.order.current,T=_.opts.order.current;return x==null&&T==null?0:x==null?-1:T==null?1:x-T}),this.panesArray=c,this.panesArrayChanged=!0,()=>{const m=[...this.panesArray],_=$f(this.panesArray,n);_<0||(m.splice(_,1),this.panesArray=m,delete this.paneIdToLastNotifiedSizeMap[n.opts.id.current],this.panesArrayChanged=!0)}};#o=()=>{const n=this.opts.id.current,c=v_(n,this.domContext),m=this.panesArray,_=c.map(x=>{const T=x.getAttribute("data-pane-resizer-id");if(!T)return td;const[r,I]=m4({groupId:n,handleId:T,panesArray:m,domContext:this.domContext});if(r==null||I==null)return td;const P=jN(x,"keydown",R=>{if(R.defaultPrevented||R.key!=="Enter")return;R.preventDefault();const F=this.panesArray,V=F.findIndex(me=>me.opts.id.current===r);if(V<0)return;const W=F[V];Mo(W);const G=this.layout,K=G[V],{collapsedSize:Y=0,collapsible:ne,minSize:oe=0}=W.constraints;if(!(K!=null&&ne))return;const ce=Ag({delta:ua(K,Y)?oe-K:Y-K,layout:G,paneConstraints:F.map(me=>me.constraints),pivotIndices:zM({groupId:n,dragHandleId:T,domContext:this.domContext}),trigger:"keyboard"});G!==ce&&(this.layout=ce)});return()=>{P()}});return()=>{for(const x of _)x()}};#s=fe(()=>({id:this.opts.id.current,"data-pane-group":"","data-direction":this.opts.direction.current,"data-pane-group-id":this.opts.id.current,style:{display:"flex",flexDirection:this.opts.direction.current==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"},...this.attachment}));get props(){return A(this.#s)}set props(n){rn(this.#s,n)}}const M4=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home"];class yT{static create(n){return new yT(n,gT.get())}opts;#t;attachment;domContext;#e=fe(()=>this.#t.dragState?.dragHandleId===this.opts.id.current);#i=Mn(!1);resizeHandler=null;constructor(n,c){this.opts=n,this.#t=c,this.attachment=fT(this.opts.ref),this.domContext=new dT(this.opts.ref),Os(()=>{this.opts.disabled.current?this.resizeHandler=null:this.resizeHandler=this.#t.registerResizeHandle(this.opts.id.current)}),Os(()=>{const m=this.opts.ref.current;if(!m)return;const _=this.opts.disabled.current,x=this.resizeHandler,T=A(this.#e);if(_||x===null||!T)return;const r=F=>{x(F)},I=F=>{x(F)},k=()=>{m.blur(),this.#t.stopDragging(),this.opts.onDraggingChange.current(!1)},P=this.domContext.getDocument().body,R=this.domContext.getWindow();return zR(vs(P,"contextmenu",k),vs(P,"mousemove",r),vs(P,"touchmove",r,{passive:!1}),vs(P,"mouseleave",I),vs(R,"mouseup",k),vs(R,"touchend",k))})}#n=n=>{n.preventDefault(),!this.opts.disabled.current&&(this.#t.startDragging(this.opts.id.current,n),this.opts.onDraggingChange.current(!0))};#r=()=>{const n=this.opts.ref.current;n&&(n.blur(),this.#t.stopDragging(),this.opts.onDraggingChange.current(!1))};#o=n=>{if(this.opts.disabled.current||!this.resizeHandler||n.defaultPrevented)return;if(M4.includes(n.key)){n.preventDefault(),this.resizeHandler(n);return}if(n.key!=="F6")return;n.preventDefault();const c=v_(this.#t.opts.id.current,this.domContext),m=BR({groupId:this.#t.opts.id.current,id:this.opts.id.current,domContext:this.domContext});if(m===null)return;let _=0;n.shiftKey?m>0?_=m-1:_=c.length-1:m+1<c.length?_=m+1:_=0,c[_].focus()};#s=()=>{rn(this.#i,!1)};#a=()=>{rn(this.#i,!0)};#l=n=>{this.#n(n)};#c=()=>{this.#r()};#u=()=>{this.#r()};#h=()=>{this.#r()};#f=n=>{this.#n(n)};#d=fe(()=>({id:this.opts.id.current,role:"separator","data-direction":this.#t.opts.direction.current,"data-pane-group-id":this.#t.opts.id.current,"data-active":A(this.#e)?"pointer":A(this.#i)?"keyboard":void 0,"data-enabled":!this.opts.disabled.current,"data-pane-resizer-id":this.opts.id.current,"data-pane-resizer":"",tabIndex:this.opts.tabIndex.current,style:{cursor:UR(this.#t.opts.direction.current),touchAction:"none",userSelect:"none","-webkit-user-select":"none","-webkit-touch-callout":"none"},onkeydown:this.#o,onblur:this.#s,onfocus:this.#a,onmousedown:this.#l,onmouseup:this.#c,ontouchcancel:this.#u,ontouchend:this.#h,ontouchstart:this.#f,...this.attachment}));get props(){return A(this.#d)}set props(n){rn(this.#d,n)}}class vT{static create(n){return new vT(n,gT.get())}opts;group;attachment;domContext;#t=Mn("");#e=fe(()=>({onCollapse:this.opts.onCollapse.current,onExpand:this.opts.onExpand.current,onResize:this.opts.onResize.current}));get callbacks(){return A(this.#e)}set callbacks(n){rn(this.#e,n)}#i=fe(()=>({collapsedSize:this.opts.collapsedSize.current,collapsible:this.opts.collapsible.current,defaultSize:this.opts.defaultSize.current,maxSize:this.opts.maxSize.current,minSize:this.opts.minSize.current}));get constraints(){return A(this.#i)}set constraints(n){rn(this.#i,n)}#n=n=>{rn(this.#t,n,!0),$N(()=>{if(this.opts.ref.current){const c=this.opts.ref.current;if(!(getComputedStyle(c).transitionDuration!=="0s")){rn(this.#t,"");return}const x=T=>{T.propertyName==="flex-grow"&&(rn(this.#t,""),c.removeEventListener("transitionend",x))};c.addEventListener("transitionend",x)}else rn(this.#t,"")})};pane={collapse:()=>{this.#n("collapsing"),this.group.collapsePane(this)},expand:()=>{this.#n("expanding"),this.group.expandPane(this)},getSize:()=>this.group.getPaneSize(this),isCollapsed:()=>this.group.isPaneCollapsed(this),isExpanded:()=>this.group.isPaneExpanded(this),resize:n=>this.group.resizePane(this,n),getId:()=>this.opts.id.current};constructor(n,c){this.opts=n,this.group=c,this.attachment=fT(this.opts.ref),this.domContext=new dT(this.opts.ref),bp(()=>this.group.registerPane(this)),Zg(()=>Kv(this.constraints),()=>{this.group.panesArrayChanged=!0})}#r=fe(()=>this.group.isPaneCollapsed(this));#o=fe(()=>A(this.#t)!==""?A(this.#t):A(this.#r)?"collapsed":"expanded");#s=fe(()=>({id:this.opts.id.current,style:this.group.getPaneStyle(this,this.opts.defaultSize.current),"data-pane":"","data-pane-id":this.opts.id.current,"data-pane-group-id":this.group.opts.id.current,"data-collapsed":A(this.#r)?"":void 0,"data-expanded":A(this.#r)?void 0:"","data-pane-state":A(this.#o),...this.attachment}));get props(){return A(this.#s)}set props(n){rn(this.#s,n)}}var C4=Un("<div><!></div>");function P4(s,n){const c=fa();Yn(n,!0);let m=Re(n,"autoSaveId",3,null),_=Re(n,"id",3,c),x=Re(n,"keyboardResizeBy",3,null),T=Re(n,"onLayoutChange",3,td),r=Re(n,"storage",3,Lg),I=Re(n,"ref",15,null),k=bi(n,["$$slots","$$events","$$legacy","autoSaveId","direction","id","keyboardResizeBy","onLayoutChange","storage","ref","child","children"]);const P=_T.create({id:Sr.with(()=>_()??c),ref:Sr.with(()=>I(),ce=>I(ce)),autoSaveId:Sr.with(()=>m()),direction:Sr.with(()=>n.direction),keyboardResizeBy:Sr.with(()=>x()),onLayout:Sr.with(()=>T()),storage:Sr.with(()=>r())}),R=()=>P.layout,F=P.setLayout,V=()=>P.opts.id.current,W=fe(()=>hT(k,P.props));var G={getLayout:R,setLayout:F,getId:V},K=Gt(),Y=yt(K);{var ne=ce=>{var me=Gt(),ue=yt(me);Dn(ue,()=>n.child,()=>({props:A(W)})),je(ce,me)},oe=ce=>{var me=C4();Ii(me,()=>({...A(W)}));var ue=Xn(me);Dn(ue,()=>n.children??Si),Ln(me),je(ce,me)};Zt(Y,ce=>{n.child?ce(ne):ce(oe,!1)})}return je(s,K),Kn(G)}var k4=Un("<div><!></div>");function Ev(s,n){const c=fa();Yn(n,!0);let m=Re(n,"id",3,c),_=Re(n,"ref",15,null),x=Re(n,"onCollapse",3,td),T=Re(n,"onExpand",3,td),r=Re(n,"onResize",3,td),I=bi(n,["$$slots","$$events","$$legacy","id","ref","collapsedSize","collapsible","defaultSize","maxSize","minSize","onCollapse","onExpand","onResize","order","child","children"]);const k=vT.create({id:Sr.with(()=>m()),ref:Sr.with(()=>_(),_e=>_(_e)),collapsedSize:Sr.with(()=>n.collapsedSize),collapsible:Sr.with(()=>n.collapsible),defaultSize:Sr.with(()=>n.defaultSize),maxSize:Sr.with(()=>n.maxSize),minSize:Sr.with(()=>n.minSize),onCollapse:Sr.with(()=>x()),onExpand:Sr.with(()=>T()),onResize:Sr.with(()=>r()),order:Sr.with(()=>n.order)}),P=k.pane.collapse,R=k.pane.expand,F=k.pane.getSize,V=k.pane.isCollapsed,W=k.pane.isExpanded,G=k.pane.resize,K=k.pane.getId,Y=fe(()=>hT(I,k.props));var ne={collapse:P,expand:R,getSize:F,isCollapsed:V,isExpanded:W,resize:G,getId:K},oe=Gt(),ce=yt(oe);{var me=_e=>{var te=Gt(),ie=yt(te);Dn(ie,()=>n.child,()=>({props:A(Y)})),je(_e,te)},ue=_e=>{var te=k4();Ii(te,()=>({...A(Y)}));var ie=Xn(te);Dn(ie,()=>n.children??Si),Ln(te),je(_e,te)};Zt(ce,_e=>{n.child?_e(me):_e(ue,!1)})}return je(s,oe),Kn(ne)}var R4=Un("<div><!></div>");function z4(s,n){const c=fa();Yn(n,!0);let m=Re(n,"id",3,c),_=Re(n,"ref",15,null),x=Re(n,"disabled",3,!1),T=Re(n,"onDraggingChange",3,td),r=Re(n,"tabindex",3,0),I=bi(n,["$$slots","$$events","$$legacy","id","ref","disabled","onDraggingChange","tabindex","child","children"]);const k=yT.create({id:Sr.with(()=>m()),ref:Sr.with(()=>_(),G=>_(G)),disabled:Sr.with(()=>x()),onDraggingChange:Sr.with(()=>T()),tabIndex:Sr.with(()=>r())}),P=fe(()=>hT(I,k.props));var R=Gt(),F=yt(R);{var V=G=>{var K=Gt(),Y=yt(K);Dn(Y,()=>n.child,()=>({props:A(P)})),je(G,K)},W=G=>{var K=R4();Ii(K,()=>({...A(P)}));var Y=Xn(K);Dn(Y,()=>n.children??Si),Ln(K),je(G,K)};Zt(F,G=>{n.child?G(V):G(W,!1)})}je(s,R),Kn()}const xT="-",D4=s=>{const n=O4(s),{conflictingClassGroups:c,conflictingClassGroupModifiers:m}=s;return{getClassGroupId:T=>{const r=T.split(xT);return r[0]===""&&r.length!==1&&r.shift(),qR(r,n)||L4(T)},getConflictingClassGroupIds:(T,r)=>{const I=c[T]||[];return r&&m[T]?[...I,...m[T]]:I}}},qR=(s,n)=>{if(s.length===0)return n.classGroupId;const c=s[0],m=n.nextPart.get(c),_=m?qR(s.slice(1),m):void 0;if(_)return _;if(n.validators.length===0)return;const x=s.join(xT);return n.validators.find(({validator:T})=>T(x))?.classGroupId},OM=/^\[(.+)\]$/,L4=s=>{if(OM.test(s)){const n=OM.exec(s)[1],c=n?.substring(0,n.indexOf(":"));if(c)return"arbitrary.."+c}},O4=s=>{const{theme:n,classGroups:c}=s,m={nextPart:new Map,validators:[]};for(const _ in c)Qw(c[_],m,_,n);return m},Qw=(s,n,c,m)=>{s.forEach(_=>{if(typeof _=="string"){const x=_===""?n:FM(n,_);x.classGroupId=c;return}if(typeof _=="function"){if(F4(_)){Qw(_(m),n,c,m);return}n.validators.push({validator:_,classGroupId:c});return}Object.entries(_).forEach(([x,T])=>{Qw(T,FM(n,x),c,m)})})},FM=(s,n)=>{let c=s;return n.split(xT).forEach(m=>{c.nextPart.has(m)||c.nextPart.set(m,{nextPart:new Map,validators:[]}),c=c.nextPart.get(m)}),c},F4=s=>s.isThemeGetter,B4=s=>{if(s<1)return{get:()=>{},set:()=>{}};let n=0,c=new Map,m=new Map;const _=(x,T)=>{c.set(x,T),n++,n>s&&(n=0,m=c,c=new Map)};return{get(x){let T=c.get(x);if(T!==void 0)return T;if((T=m.get(x))!==void 0)return _(x,T),T},set(x,T){c.has(x)?c.set(x,T):_(x,T)}}},$w="!",e2=":",N4=e2.length,V4=s=>{const{prefix:n,experimentalParseClassName:c}=s;let m=_=>{const x=[];let T=0,r=0,I=0,k;for(let W=0;W<_.length;W++){let G=_[W];if(T===0&&r===0){if(G===e2){x.push(_.slice(I,W)),I=W+N4;continue}if(G==="/"){k=W;continue}}G==="["?T++:G==="]"?T--:G==="("?r++:G===")"&&r--}const P=x.length===0?_:_.substring(I),R=U4(P),F=R!==P,V=k&&k>I?k-I:void 0;return{modifiers:x,hasImportantModifier:F,baseClassName:R,maybePostfixModifierPosition:V}};if(n){const _=n+e2,x=m;m=T=>T.startsWith(_)?x(T.substring(_.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:T,maybePostfixModifierPosition:void 0}}if(c){const _=m;m=x=>c({className:x,parseClassName:_})}return m},U4=s=>s.endsWith($w)?s.substring(0,s.length-1):s.startsWith($w)?s.substring(1):s,j4=s=>{const n=Object.fromEntries(s.orderSensitiveModifiers.map(m=>[m,!0]));return m=>{if(m.length<=1)return m;const _=[];let x=[];return m.forEach(T=>{T[0]==="["||n[T]?(_.push(...x.sort(),T),x=[]):x.push(T)}),_.push(...x.sort()),_}},G4=s=>({cache:B4(s.cacheSize),parseClassName:V4(s),sortModifiers:j4(s),...D4(s)}),W4=/\s+/,q4=(s,n)=>{const{parseClassName:c,getClassGroupId:m,getConflictingClassGroupIds:_,sortModifiers:x}=n,T=[],r=s.trim().split(W4);let I="";for(let k=r.length-1;k>=0;k-=1){const P=r[k],{isExternal:R,modifiers:F,hasImportantModifier:V,baseClassName:W,maybePostfixModifierPosition:G}=c(P);if(R){I=P+(I.length>0?" "+I:I);continue}let K=!!G,Y=m(K?W.substring(0,G):W);if(!Y){if(!K){I=P+(I.length>0?" "+I:I);continue}if(Y=m(W),!Y){I=P+(I.length>0?" "+I:I);continue}K=!1}const ne=x(F).join(":"),oe=V?ne+$w:ne,ce=oe+Y;if(T.includes(ce))continue;T.push(ce);const me=_(Y,K);for(let ue=0;ue<me.length;++ue){const _e=me[ue];T.push(oe+_e)}I=P+(I.length>0?" "+I:I)}return I};function H4(){let s=0,n,c,m="";for(;s<arguments.length;)(n=arguments[s++])&&(c=HR(n))&&(m&&(m+=" "),m+=c);return m}const HR=s=>{if(typeof s=="string")return s;let n,c="";for(let m=0;m<s.length;m++)s[m]&&(n=HR(s[m]))&&(c&&(c+=" "),c+=n);return c};function t2(s,...n){let c,m,_,x=T;function T(I){const k=n.reduce((P,R)=>R(P),s());return c=G4(k),m=c.cache.get,_=c.cache.set,x=r,r(I)}function r(I){const k=m(I);if(k)return k;const P=q4(I,c);return _(I,P),P}return function(){return x(H4.apply(null,arguments))}}const ls=s=>{const n=c=>c[s]||[];return n.isThemeGetter=!0,n},ZR=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,XR=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Z4=/^\d+\/\d+$/,X4=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Y4=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,K4=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,J4=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Q4=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Hf=s=>Z4.test(s),vr=s=>!!s&&!Number.isNaN(Number(s)),Uu=s=>!!s&&Number.isInteger(Number(s)),Ab=s=>s.endsWith("%")&&vr(s.slice(0,-1)),Lc=s=>X4.test(s),$4=()=>!0,eV=s=>Y4.test(s)&&!K4.test(s),YR=()=>!1,tV=s=>J4.test(s),nV=s=>Q4.test(s),iV=s=>!gi(s)&&!_i(s),rV=s=>wp(s,QR,YR),gi=s=>ZR.test(s),Hh=s=>wp(s,$R,eV),Ib=s=>wp(s,cV,vr),BM=s=>wp(s,KR,YR),oV=s=>wp(s,JR,nV),Av=s=>wp(s,ez,tV),_i=s=>XR.test(s),Ig=s=>Tp(s,$R),sV=s=>Tp(s,uV),NM=s=>Tp(s,KR),aV=s=>Tp(s,QR),lV=s=>Tp(s,JR),Iv=s=>Tp(s,ez,!0),wp=(s,n,c)=>{const m=ZR.exec(s);return m?m[1]?n(m[1]):c(m[2]):!1},Tp=(s,n,c=!1)=>{const m=XR.exec(s);return m?m[1]?n(m[1]):c:!1},KR=s=>s==="position"||s==="percentage",JR=s=>s==="image"||s==="url",QR=s=>s==="length"||s==="size"||s==="bg-size",$R=s=>s==="length",cV=s=>s==="number",uV=s=>s==="family-name",ez=s=>s==="shadow",n2=()=>{const s=ls("color"),n=ls("font"),c=ls("text"),m=ls("font-weight"),_=ls("tracking"),x=ls("leading"),T=ls("breakpoint"),r=ls("container"),I=ls("spacing"),k=ls("radius"),P=ls("shadow"),R=ls("inset-shadow"),F=ls("text-shadow"),V=ls("drop-shadow"),W=ls("blur"),G=ls("perspective"),K=ls("aspect"),Y=ls("ease"),ne=ls("animate"),oe=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ce=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],me=()=>[...ce(),_i,gi],ue=()=>["auto","hidden","clip","visible","scroll"],_e=()=>["auto","contain","none"],te=()=>[_i,gi,I],ie=()=>[Hf,"full","auto",...te()],xe=()=>[Uu,"none","subgrid",_i,gi],de=()=>["auto",{span:["full",Uu,_i,gi]},Uu,_i,gi],Te=()=>[Uu,"auto",_i,gi],De=()=>["auto","min","max","fr",_i,gi],Be=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Se=()=>["start","end","center","stretch","center-safe","end-safe"],Ne=()=>["auto",...te()],it=()=>[Hf,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...te()],qe=()=>[s,_i,gi],ft=()=>[...ce(),NM,BM,{position:[_i,gi]}],St=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Dt=()=>["auto","cover","contain",aV,rV,{size:[_i,gi]}],Kt=()=>[Ab,Ig,Hh],et=()=>["","none","full",k,_i,gi],Qe=()=>["",vr,Ig,Hh],st=()=>["solid","dashed","dotted","double"],tt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],gt=()=>[vr,Ab,NM,BM],Lt=()=>["","none",W,_i,gi],_t=()=>["none",vr,_i,gi],Je=()=>["none",vr,_i,gi],Rt=()=>[vr,_i,gi],ut=()=>[Hf,"full",...te()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Lc],breakpoint:[Lc],color:[$4],container:[Lc],"drop-shadow":[Lc],ease:["in","out","in-out"],font:[iV],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Lc],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Lc],shadow:[Lc],spacing:["px",vr],text:[Lc],"text-shadow":[Lc],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Hf,gi,_i,K]}],container:["container"],columns:[{columns:[vr,gi,_i,r]}],"break-after":[{"break-after":oe()}],"break-before":[{"break-before":oe()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:me()}],overflow:[{overflow:ue()}],"overflow-x":[{"overflow-x":ue()}],"overflow-y":[{"overflow-y":ue()}],overscroll:[{overscroll:_e()}],"overscroll-x":[{"overscroll-x":_e()}],"overscroll-y":[{"overscroll-y":_e()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:ie()}],"inset-x":[{"inset-x":ie()}],"inset-y":[{"inset-y":ie()}],start:[{start:ie()}],end:[{end:ie()}],top:[{top:ie()}],right:[{right:ie()}],bottom:[{bottom:ie()}],left:[{left:ie()}],visibility:["visible","invisible","collapse"],z:[{z:[Uu,"auto",_i,gi]}],basis:[{basis:[Hf,"full","auto",r,...te()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[vr,Hf,"auto","initial","none",gi]}],grow:[{grow:["",vr,_i,gi]}],shrink:[{shrink:["",vr,_i,gi]}],order:[{order:[Uu,"first","last","none",_i,gi]}],"grid-cols":[{"grid-cols":xe()}],"col-start-end":[{col:de()}],"col-start":[{"col-start":Te()}],"col-end":[{"col-end":Te()}],"grid-rows":[{"grid-rows":xe()}],"row-start-end":[{row:de()}],"row-start":[{"row-start":Te()}],"row-end":[{"row-end":Te()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":De()}],"auto-rows":[{"auto-rows":De()}],gap:[{gap:te()}],"gap-x":[{"gap-x":te()}],"gap-y":[{"gap-y":te()}],"justify-content":[{justify:[...Be(),"normal"]}],"justify-items":[{"justify-items":[...Se(),"normal"]}],"justify-self":[{"justify-self":["auto",...Se()]}],"align-content":[{content:["normal",...Be()]}],"align-items":[{items:[...Se(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Se(),{baseline:["","last"]}]}],"place-content":[{"place-content":Be()}],"place-items":[{"place-items":[...Se(),"baseline"]}],"place-self":[{"place-self":["auto",...Se()]}],p:[{p:te()}],px:[{px:te()}],py:[{py:te()}],ps:[{ps:te()}],pe:[{pe:te()}],pt:[{pt:te()}],pr:[{pr:te()}],pb:[{pb:te()}],pl:[{pl:te()}],m:[{m:Ne()}],mx:[{mx:Ne()}],my:[{my:Ne()}],ms:[{ms:Ne()}],me:[{me:Ne()}],mt:[{mt:Ne()}],mr:[{mr:Ne()}],mb:[{mb:Ne()}],ml:[{ml:Ne()}],"space-x":[{"space-x":te()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":te()}],"space-y-reverse":["space-y-reverse"],size:[{size:it()}],w:[{w:[r,"screen",...it()]}],"min-w":[{"min-w":[r,"screen","none",...it()]}],"max-w":[{"max-w":[r,"screen","none","prose",{screen:[T]},...it()]}],h:[{h:["screen","lh",...it()]}],"min-h":[{"min-h":["screen","lh","none",...it()]}],"max-h":[{"max-h":["screen","lh",...it()]}],"font-size":[{text:["base",c,Ig,Hh]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[m,_i,Ib]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Ab,gi]}],"font-family":[{font:[sV,gi,n]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[_,_i,gi]}],"line-clamp":[{"line-clamp":[vr,"none",_i,Ib]}],leading:[{leading:[x,...te()]}],"list-image":[{"list-image":["none",_i,gi]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",_i,gi]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:qe()}],"text-color":[{text:qe()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...st(),"wavy"]}],"text-decoration-thickness":[{decoration:[vr,"from-font","auto",_i,Hh]}],"text-decoration-color":[{decoration:qe()}],"underline-offset":[{"underline-offset":[vr,"auto",_i,gi]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:te()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",_i,gi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",_i,gi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:ft()}],"bg-repeat":[{bg:St()}],"bg-size":[{bg:Dt()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Uu,_i,gi],radial:["",_i,gi],conic:[Uu,_i,gi]},lV,oV]}],"bg-color":[{bg:qe()}],"gradient-from-pos":[{from:Kt()}],"gradient-via-pos":[{via:Kt()}],"gradient-to-pos":[{to:Kt()}],"gradient-from":[{from:qe()}],"gradient-via":[{via:qe()}],"gradient-to":[{to:qe()}],rounded:[{rounded:et()}],"rounded-s":[{"rounded-s":et()}],"rounded-e":[{"rounded-e":et()}],"rounded-t":[{"rounded-t":et()}],"rounded-r":[{"rounded-r":et()}],"rounded-b":[{"rounded-b":et()}],"rounded-l":[{"rounded-l":et()}],"rounded-ss":[{"rounded-ss":et()}],"rounded-se":[{"rounded-se":et()}],"rounded-ee":[{"rounded-ee":et()}],"rounded-es":[{"rounded-es":et()}],"rounded-tl":[{"rounded-tl":et()}],"rounded-tr":[{"rounded-tr":et()}],"rounded-br":[{"rounded-br":et()}],"rounded-bl":[{"rounded-bl":et()}],"border-w":[{border:Qe()}],"border-w-x":[{"border-x":Qe()}],"border-w-y":[{"border-y":Qe()}],"border-w-s":[{"border-s":Qe()}],"border-w-e":[{"border-e":Qe()}],"border-w-t":[{"border-t":Qe()}],"border-w-r":[{"border-r":Qe()}],"border-w-b":[{"border-b":Qe()}],"border-w-l":[{"border-l":Qe()}],"divide-x":[{"divide-x":Qe()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Qe()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...st(),"hidden","none"]}],"divide-style":[{divide:[...st(),"hidden","none"]}],"border-color":[{border:qe()}],"border-color-x":[{"border-x":qe()}],"border-color-y":[{"border-y":qe()}],"border-color-s":[{"border-s":qe()}],"border-color-e":[{"border-e":qe()}],"border-color-t":[{"border-t":qe()}],"border-color-r":[{"border-r":qe()}],"border-color-b":[{"border-b":qe()}],"border-color-l":[{"border-l":qe()}],"divide-color":[{divide:qe()}],"outline-style":[{outline:[...st(),"none","hidden"]}],"outline-offset":[{"outline-offset":[vr,_i,gi]}],"outline-w":[{outline:["",vr,Ig,Hh]}],"outline-color":[{outline:qe()}],shadow:[{shadow:["","none",P,Iv,Av]}],"shadow-color":[{shadow:qe()}],"inset-shadow":[{"inset-shadow":["none",R,Iv,Av]}],"inset-shadow-color":[{"inset-shadow":qe()}],"ring-w":[{ring:Qe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:qe()}],"ring-offset-w":[{"ring-offset":[vr,Hh]}],"ring-offset-color":[{"ring-offset":qe()}],"inset-ring-w":[{"inset-ring":Qe()}],"inset-ring-color":[{"inset-ring":qe()}],"text-shadow":[{"text-shadow":["none",F,Iv,Av]}],"text-shadow-color":[{"text-shadow":qe()}],opacity:[{opacity:[vr,_i,gi]}],"mix-blend":[{"mix-blend":[...tt(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":tt()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[vr]}],"mask-image-linear-from-pos":[{"mask-linear-from":gt()}],"mask-image-linear-to-pos":[{"mask-linear-to":gt()}],"mask-image-linear-from-color":[{"mask-linear-from":qe()}],"mask-image-linear-to-color":[{"mask-linear-to":qe()}],"mask-image-t-from-pos":[{"mask-t-from":gt()}],"mask-image-t-to-pos":[{"mask-t-to":gt()}],"mask-image-t-from-color":[{"mask-t-from":qe()}],"mask-image-t-to-color":[{"mask-t-to":qe()}],"mask-image-r-from-pos":[{"mask-r-from":gt()}],"mask-image-r-to-pos":[{"mask-r-to":gt()}],"mask-image-r-from-color":[{"mask-r-from":qe()}],"mask-image-r-to-color":[{"mask-r-to":qe()}],"mask-image-b-from-pos":[{"mask-b-from":gt()}],"mask-image-b-to-pos":[{"mask-b-to":gt()}],"mask-image-b-from-color":[{"mask-b-from":qe()}],"mask-image-b-to-color":[{"mask-b-to":qe()}],"mask-image-l-from-pos":[{"mask-l-from":gt()}],"mask-image-l-to-pos":[{"mask-l-to":gt()}],"mask-image-l-from-color":[{"mask-l-from":qe()}],"mask-image-l-to-color":[{"mask-l-to":qe()}],"mask-image-x-from-pos":[{"mask-x-from":gt()}],"mask-image-x-to-pos":[{"mask-x-to":gt()}],"mask-image-x-from-color":[{"mask-x-from":qe()}],"mask-image-x-to-color":[{"mask-x-to":qe()}],"mask-image-y-from-pos":[{"mask-y-from":gt()}],"mask-image-y-to-pos":[{"mask-y-to":gt()}],"mask-image-y-from-color":[{"mask-y-from":qe()}],"mask-image-y-to-color":[{"mask-y-to":qe()}],"mask-image-radial":[{"mask-radial":[_i,gi]}],"mask-image-radial-from-pos":[{"mask-radial-from":gt()}],"mask-image-radial-to-pos":[{"mask-radial-to":gt()}],"mask-image-radial-from-color":[{"mask-radial-from":qe()}],"mask-image-radial-to-color":[{"mask-radial-to":qe()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":ce()}],"mask-image-conic-pos":[{"mask-conic":[vr]}],"mask-image-conic-from-pos":[{"mask-conic-from":gt()}],"mask-image-conic-to-pos":[{"mask-conic-to":gt()}],"mask-image-conic-from-color":[{"mask-conic-from":qe()}],"mask-image-conic-to-color":[{"mask-conic-to":qe()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:ft()}],"mask-repeat":[{mask:St()}],"mask-size":[{mask:Dt()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",_i,gi]}],filter:[{filter:["","none",_i,gi]}],blur:[{blur:Lt()}],brightness:[{brightness:[vr,_i,gi]}],contrast:[{contrast:[vr,_i,gi]}],"drop-shadow":[{"drop-shadow":["","none",V,Iv,Av]}],"drop-shadow-color":[{"drop-shadow":qe()}],grayscale:[{grayscale:["",vr,_i,gi]}],"hue-rotate":[{"hue-rotate":[vr,_i,gi]}],invert:[{invert:["",vr,_i,gi]}],saturate:[{saturate:[vr,_i,gi]}],sepia:[{sepia:["",vr,_i,gi]}],"backdrop-filter":[{"backdrop-filter":["","none",_i,gi]}],"backdrop-blur":[{"backdrop-blur":Lt()}],"backdrop-brightness":[{"backdrop-brightness":[vr,_i,gi]}],"backdrop-contrast":[{"backdrop-contrast":[vr,_i,gi]}],"backdrop-grayscale":[{"backdrop-grayscale":["",vr,_i,gi]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[vr,_i,gi]}],"backdrop-invert":[{"backdrop-invert":["",vr,_i,gi]}],"backdrop-opacity":[{"backdrop-opacity":[vr,_i,gi]}],"backdrop-saturate":[{"backdrop-saturate":[vr,_i,gi]}],"backdrop-sepia":[{"backdrop-sepia":["",vr,_i,gi]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":te()}],"border-spacing-x":[{"border-spacing-x":te()}],"border-spacing-y":[{"border-spacing-y":te()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",_i,gi]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[vr,"initial",_i,gi]}],ease:[{ease:["linear","initial",Y,_i,gi]}],delay:[{delay:[vr,_i,gi]}],animate:[{animate:["none",ne,_i,gi]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[G,_i,gi]}],"perspective-origin":[{"perspective-origin":me()}],rotate:[{rotate:_t()}],"rotate-x":[{"rotate-x":_t()}],"rotate-y":[{"rotate-y":_t()}],"rotate-z":[{"rotate-z":_t()}],scale:[{scale:Je()}],"scale-x":[{"scale-x":Je()}],"scale-y":[{"scale-y":Je()}],"scale-z":[{"scale-z":Je()}],"scale-3d":["scale-3d"],skew:[{skew:Rt()}],"skew-x":[{"skew-x":Rt()}],"skew-y":[{"skew-y":Rt()}],transform:[{transform:[_i,gi,"","none","gpu","cpu"]}],"transform-origin":[{origin:me()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:ut()}],"translate-x":[{"translate-x":ut()}],"translate-y":[{"translate-y":ut()}],"translate-z":[{"translate-z":ut()}],"translate-none":["translate-none"],accent:[{accent:qe()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:qe()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",_i,gi]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":te()}],"scroll-mx":[{"scroll-mx":te()}],"scroll-my":[{"scroll-my":te()}],"scroll-ms":[{"scroll-ms":te()}],"scroll-me":[{"scroll-me":te()}],"scroll-mt":[{"scroll-mt":te()}],"scroll-mr":[{"scroll-mr":te()}],"scroll-mb":[{"scroll-mb":te()}],"scroll-ml":[{"scroll-ml":te()}],"scroll-p":[{"scroll-p":te()}],"scroll-px":[{"scroll-px":te()}],"scroll-py":[{"scroll-py":te()}],"scroll-ps":[{"scroll-ps":te()}],"scroll-pe":[{"scroll-pe":te()}],"scroll-pt":[{"scroll-pt":te()}],"scroll-pr":[{"scroll-pr":te()}],"scroll-pb":[{"scroll-pb":te()}],"scroll-pl":[{"scroll-pl":te()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",_i,gi]}],fill:[{fill:["none",...qe()]}],"stroke-w":[{stroke:[vr,Ig,Hh,Ib]}],stroke:[{stroke:["none",...qe()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},hV=(s,{cacheSize:n,prefix:c,experimentalParseClassName:m,extend:_={},override:x={}})=>(Og(s,"cacheSize",n),Og(s,"prefix",c),Og(s,"experimentalParseClassName",m),Mv(s.theme,x.theme),Mv(s.classGroups,x.classGroups),Mv(s.conflictingClassGroups,x.conflictingClassGroups),Mv(s.conflictingClassGroupModifiers,x.conflictingClassGroupModifiers),Og(s,"orderSensitiveModifiers",x.orderSensitiveModifiers),Cv(s.theme,_.theme),Cv(s.classGroups,_.classGroups),Cv(s.conflictingClassGroups,_.conflictingClassGroups),Cv(s.conflictingClassGroupModifiers,_.conflictingClassGroupModifiers),tz(s,_,"orderSensitiveModifiers"),s),Og=(s,n,c)=>{c!==void 0&&(s[n]=c)},Mv=(s,n)=>{if(n)for(const c in n)Og(s,c,n[c])},Cv=(s,n)=>{if(n)for(const c in n)tz(s,n,c)},tz=(s,n,c)=>{const m=n[c];m!==void 0&&(s[c]=s[c]?s[c].concat(m):m)},nz=(s,...n)=>typeof s=="function"?t2(n2,s,...n):t2(()=>hV(n2(),s),...n),iz=t2(n2);function xs(...s){return iz(Hg(s))}var dV=Un('<div class="bg-border rounded-xs z-10 flex h-4 w-3 items-center justify-center border"><!></div>');function fV(s,n){Yn(n,!0);let c=Re(n,"ref",15,null),m=Re(n,"withHandle",3,!1),_=bi(n,["$$slots","$$events","$$legacy","ref","class","withHandle"]);var x=Gt(),T=yt(x);{let r=fe(()=>xs("bg-border focus-visible:ring-ring focus-visible:outline-hidden relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 data-[direction=vertical]:h-px data-[direction=vertical]:w-full data-[direction=vertical]:after:left-0 data-[direction=vertical]:after:h-1 data-[direction=vertical]:after:w-full data-[direction=vertical]:after:-translate-y-1/2 data-[direction=vertical]:after:translate-x-0 [&[data-direction=vertical]>div]:rotate-90",n.class));mo(T,()=>z4,(I,k)=>{k(I,Hn({"data-slot":"resizable-handle",get class(){return A(r)}},()=>_,{get ref(){return c()},set ref(P){c(P)},children:(P,R)=>{var F=Gt(),V=yt(F);{var W=G=>{var K=dV(),Y=Xn(K);I5(Y,{class:"size-2.5"}),Ln(K),je(G,K)};Zt(V,G=>{m()&&G(W)})}je(P,F)},$$slots:{default:!0}}))})}je(s,x),Kn()}function VM(s,n){Yn(n,!0),Re(n,"ref",11,null);let c=Re(n,"this",15),m=bi(n,["$$slots","$$events","$$legacy","ref","this","class"]);var _=Gt(),x=yt(_);{let T=fe(()=>xs("flex h-full w-full data-[direction=vertical]:flex-col",n.class));mo(x,()=>P4,(r,I)=>{er(I(r,Hn({"data-slot":"resizable-pane-group",get class(){return A(T)}},()=>m)),k=>c(k),()=>c())})}je(s,_),Kn()}var pV=Un('<div class="w-full h-full bg-blue-200"></div>');function mV(s,n){Yn(n,!0);let c=Mn(void 0);bp(()=>{xR.accessToken=bR,xr.MapApp=new S5,xr.MapApp.initialiseMap(A(c))});var m=pV();er(m,_=>rn(c,_),()=>A(c)),je(s,m),Kn()}var gV=/\s+/g,i2=s=>typeof s!="string"||!s?s:s.replace(gV," ").trim(),f0=(...s)=>{let n=[],c=m=>{if(!m&&m!==0&&m!==0n)return;if(Array.isArray(m)){for(let x=0,T=m.length;x<T;x++)c(m[x]);return}let _=typeof m;if(_==="string"||_==="number"||_==="bigint"){if(_==="number"&&m!==m)return;n.push(String(m))}else if(_==="object"){let x=Object.keys(m);for(let T=0,r=x.length;T<r;T++){let I=x[T];m[I]&&n.push(I)}}};for(let m=0,_=s.length;m<_;m++){let x=s[m];x!=null&&c(x)}return n.length>0?i2(n.join(" ")):void 0},UM=s=>s===!1?"false":s===!0?"true":s===0?"0":s,la=s=>{if(!s||typeof s!="object")return!0;for(let n in s)return!1;return!0},_V=(s,n)=>{if(s===n)return!0;if(!s||!n)return!1;let c=Object.keys(s),m=Object.keys(n);if(c.length!==m.length)return!1;for(let _=0;_<c.length;_++){let x=c[_];if(!m.includes(x)||s[x]!==n[x])return!1}return!0},jM=(s,n)=>{for(let c in n)if(Object.prototype.hasOwnProperty.call(n,c)){let m=n[c];c in s?s[c]=f0(s[c],m):s[c]=m}return s},rz=(s,n)=>{for(let c=0;c<s.length;c++){let m=s[c];Array.isArray(m)?rz(m,n):m&&n.push(m)}},oz=(...s)=>{let n=[];rz(s,n);let c=[];for(let m=0;m<n.length;m++)n[m]&&c.push(n[m]);return c},r2=(s,n)=>{let c={};for(let m in s){let _=s[m];if(m in n){let x=n[m];Array.isArray(_)||Array.isArray(x)?c[m]=oz(x,_):typeof _=="object"&&typeof x=="object"&&_&&x?c[m]=r2(_,x):c[m]=x+" "+_}else c[m]=_}for(let m in n)m in s||(c[m]=n[m]);return c},yV={twMerge:!0,twMergeConfig:{},responsiveVariants:!1};function vV(){let s=null,n={},c=!1;return{get cachedTwMerge(){return s},set cachedTwMerge(m){s=m},get cachedTwMergeConfig(){return n},set cachedTwMergeConfig(m){n=m},get didTwMergeConfigChange(){return c},set didTwMergeConfigChange(m){c=m},reset(){s=null,n={},c=!1}}}var Fc=vV(),xV=s=>{let n=(c,m)=>{let{extend:_=null,slots:x={},variants:T={},compoundVariants:r=[],compoundSlots:I=[],defaultVariants:k={}}=c,P={...yV,...m},R=_?.base?f0(_.base,c?.base):c?.base,F=_?.variants&&!la(_.variants)?r2(T,_.variants):T,V=_?.defaultVariants&&!la(_.defaultVariants)?{..._.defaultVariants,...k}:k;!la(P.twMergeConfig)&&!_V(P.twMergeConfig,Fc.cachedTwMergeConfig)&&(Fc.didTwMergeConfigChange=!0,Fc.cachedTwMergeConfig=P.twMergeConfig);let W=la(_?.slots),G=la(x)?{}:{base:f0(c?.base,W&&_?.base),...x},K=W?G:jM({..._?.slots},la(G)?{base:c?.base}:G),Y=la(_?.compoundVariants)?r:oz(_?.compoundVariants,r),ne=ce=>{if(la(F)&&la(x)&&W)return s(R,ce?.class,ce?.className)(P);if(Y&&!Array.isArray(Y))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof Y}`);if(I&&!Array.isArray(I))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof I}`);let me=(Be,Se,Ne=[],it)=>{let qe=Ne;if(typeof Se=="string"){let ft=i2(Se).split(" ");for(let St=0;St<ft.length;St++)qe.push(`${Be}:${ft[St]}`)}else if(Array.isArray(Se))for(let ft=0;ft<Se.length;ft++)qe.push(`${Be}:${Se[ft]}`);else if(typeof Se=="object"&&typeof it=="string"&&it in Se){let ft=Se[it];if(ft&&typeof ft=="string"){let St=i2(ft).split(" "),Dt=[];for(let Kt=0;Kt<St.length;Kt++)Dt.push(`${Be}:${St[Kt]}`);qe[it]=qe[it]?qe[it].concat(Dt):Dt}else if(Array.isArray(ft)&&ft.length>0){let St=[];for(let Dt=0;Dt<ft.length;Dt++)St.push(`${Be}:${ft[Dt]}`);qe[it]=St}}return qe},ue=(Be,Se=F,Ne=null,it=null)=>{let qe=Se[Be];if(!qe||la(qe))return null;let ft=it?.[Be]??ce?.[Be];if(ft===null)return null;let St=UM(ft),Dt=Array.isArray(P.responsiveVariants)&&P.responsiveVariants.length>0||P.responsiveVariants===!0,Kt=V?.[Be],et=[];if(typeof St=="object"&&Dt)for(let[tt,gt]of Object.entries(St)){let Lt=qe[gt];if(tt==="initial"){Kt=gt;continue}Array.isArray(P.responsiveVariants)&&!P.responsiveVariants.includes(tt)||(et=me(tt,Lt,et,Ne))}let Qe=St!=null&&typeof St!="object"?St:UM(Kt),st=qe[Qe||"false"];return typeof et=="object"&&typeof Ne=="string"&&et[Ne]?jM(et,st):et.length>0?(et.push(st),Ne==="base"?et.join(" "):et):st},_e=()=>{if(!F)return null;let Be=Object.keys(F),Se=[];for(let Ne=0;Ne<Be.length;Ne++){let it=ue(Be[Ne],F);it&&Se.push(it)}return Se},te=(Be,Se)=>{if(!F||typeof F!="object")return null;let Ne=[];for(let it in F){let qe=ue(it,F,Be,Se),ft=Be==="base"&&typeof qe=="string"?qe:qe&&qe[Be];ft&&Ne.push(ft)}return Ne},ie={};for(let Be in ce){let Se=ce[Be];Se!==void 0&&(ie[Be]=Se)}let xe=(Be,Se)=>{let Ne=typeof ce?.[Be]=="object"?{[Be]:ce[Be]?.initial}:{};return{...V,...ie,...Ne,...Se}},de=(Be=[],Se)=>{let Ne=[],it=Be.length;for(let qe=0;qe<it;qe++){let{class:ft,className:St,...Dt}=Be[qe],Kt=!0,et=xe(null,Se);for(let Qe in Dt){let st=Dt[Qe],tt=et[Qe];if(Array.isArray(st)){if(!st.includes(tt)){Kt=!1;break}}else{if((st==null||st===!1)&&(tt==null||tt===!1))continue;if(tt!==st){Kt=!1;break}}}Kt&&(ft&&Ne.push(ft),St&&Ne.push(St))}return Ne},Te=Be=>{let Se=de(Y,Be);if(!Array.isArray(Se))return Se;let Ne={},it=s;for(let qe=0;qe<Se.length;qe++){let ft=Se[qe];if(typeof ft=="string")Ne.base=it(Ne.base,ft)(P);else if(typeof ft=="object")for(let St in ft)Ne[St]=it(Ne[St],ft[St])(P)}return Ne},De=Be=>{if(I.length<1)return null;let Se={},Ne=xe(null,Be);for(let it=0;it<I.length;it++){let{slots:qe=[],class:ft,className:St,...Dt}=I[it];if(!la(Dt)){let Kt=!0;for(let et in Dt){let Qe=Ne[et],st=Dt[et];if(Qe===void 0||(Array.isArray(st)?!st.includes(Qe):st!==Qe)){Kt=!1;break}}if(!Kt)continue}for(let Kt=0;Kt<qe.length;Kt++){let et=qe[Kt];Se[et]||(Se[et]=[]),Se[et].push([ft,St])}}return Se};if(!la(x)||!W){let Be={};if(typeof K=="object"&&!la(K)){let Se=s;for(let Ne in K)Be[Ne]=it=>{let qe=Te(it),ft=De(it);return Se(K[Ne],te(Ne,it),qe?qe[Ne]:void 0,ft?ft[Ne]:void 0,it?.class,it?.className)(P)}}return Be}return s(R,_e(),de(Y),ce?.class,ce?.className)(P)},oe=()=>{if(!(!F||typeof F!="object"))return Object.keys(F)};return ne.variantKeys=oe(),ne.extend=_,ne.base=R,ne.slots=K,ne.variants=F,ne.defaultVariants=V,ne.compoundSlots=I,ne.compoundVariants=Y,ne};return{tv:n,createTV:c=>(m,_)=>n(m,_?r2(c,_):c)}},bV=s=>la(s)?iz:nz({...s,extend:{theme:s.theme,classGroups:s.classGroups,conflictingClassGroupModifiers:s.conflictingClassGroupModifiers,conflictingClassGroups:s.conflictingClassGroups,...s.extend}}),wV=(...s)=>n=>{let c=f0(s);return!c||!n.twMerge?c:((!Fc.cachedTwMerge||Fc.didTwMergeConfigChange)&&(Fc.didTwMergeConfigChange=!1,Fc.cachedTwMerge=bV(Fc.cachedTwMergeConfig)),Fc.cachedTwMerge(c)||void 0)},{tv:TV}=xV(wV);const GM=TV({base:"focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive inline-flex shrink-0 items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium outline-none transition-all focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60 text-white",outline:"bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 border",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 gap-1.5 rounded-md px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});var SV=Un("<a><!></a>"),EV=Un("<button><!></button>");function o2(s,n){Yn(n,!0);let c=Re(n,"variant",3,"default"),m=Re(n,"size",3,"default"),_=Re(n,"ref",15,null),x=Re(n,"href",3,void 0),T=Re(n,"type",3,"button"),r=bi(n,["$$slots","$$events","$$legacy","class","variant","size","ref","href","type","disabled","children"]);var I=Gt(),k=yt(I);{var P=F=>{var V=SV();Ii(V,G=>({"data-slot":"button",class:G,href:n.disabled?void 0:x(),"aria-disabled":n.disabled,role:n.disabled?"link":void 0,tabindex:n.disabled?-1:void 0,...r}),[()=>xs(GM({variant:c(),size:m()}),n.class)]);var W=Xn(V);Dn(W,()=>n.children??Si),Ln(V),er(V,G=>_(G),()=>_()),je(F,V)},R=F=>{var V=EV();Ii(V,G=>({"data-slot":"button",class:G,type:T(),disabled:n.disabled,...r}),[()=>xs(GM({variant:c(),size:m()}),n.class)]);var W=Xn(V);Dn(W,()=>n.children??Si),Ln(V),er(V,G=>_(G),()=>_()),je(F,V)};Zt(k,F=>{x()?F(P):F(R,!1)})}je(s,I),Kn()}var AV=Un("<input/>"),IV=Un("<input/>");function MV(s,n){Yn(n,!0);let c=Re(n,"ref",15,null),m=Re(n,"value",15),_=Re(n,"files",15),x=Re(n,"data-slot",3,"input"),T=bi(n,["$$slots","$$events","$$legacy","ref","value","type","files","class","data-slot"]);var r=Gt(),I=yt(r);{var k=R=>{var F=AV();Ii(F,V=>({"data-slot":x(),class:V,type:"file",...T}),[()=>xs("selection:bg-primary dark:bg-input/30 selection:text-primary-foreground border-input ring-offset-background placeholder:text-muted-foreground shadow-xs flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 pt-1.5 text-sm font-medium outline-none transition-[color,box-shadow] disabled:cursor-not-allowed disabled:opacity-50","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",n.class)],void 0,void 0,!0),er(F,V=>c(V),()=>c()),OB(F,_),fM(F,m),je(R,F)},P=R=>{var F=IV();Ii(F,V=>({"data-slot":x(),class:V,type:n.type,...T}),[()=>xs("border-input bg-background selection:bg-primary dark:bg-input/30 selection:text-primary-foreground ring-offset-background placeholder:text-muted-foreground shadow-xs flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base outline-none transition-[color,box-shadow] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",n.class)],void 0,void 0,!0),er(F,V=>c(V),()=>c()),fM(F,m),je(R,F)};Zt(I,R=>{n.type==="file"?R(k):R(P,!1)})}je(s,r),Kn()}function CV(s){MV(s,{class:"text-xs h-full w-full",placeholder:"Search"})}var PV=Un('<div class="w-full"><!></div>');function kV(s){var n=PV(),c=Xn(n);o2(c,{variant:"ghost",class:"text-current/70 text-xs w-full justify-start",children:(m,_)=>{Yu();var x=Za("Terms & conditions");je(m,x)},$$slots:{default:!0}}),Ln(n),je(s,n)}var RV=Un('<div class="text-xs p-1"> </div>');function zV(s,n){Yn(n,!1),iT();var c=RV(),m=Xn(c);Ln(c),Vi((_,x,T)=>Es(m,`${_??""},${x??""},${T??""}`),[()=>xr.location[0].toFixed(2),()=>xr.location[1].toFixed(8),()=>xr.location[2].toFixed(8)]),je(s,c),Kn()}var DV=Un("<div><!></div>");function bT(s,n){Yn(n,!0);let c=Re(n,"ref",15,null),m=bi(n,["$$slots","$$events","$$legacy","ref","class","children"]);var _=DV();Ii(_,T=>({"data-slot":"card",class:T,...m}),[()=>xs("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",n.class)]);var x=Xn(_);Dn(x,()=>n.children??Si),Ln(_),er(_,T=>c(T),()=>c()),je(s,_),Kn()}var LV=Un("<div><!></div>");function OV(s,n){Yn(n,!0);let c=Re(n,"ref",15,null),m=bi(n,["$$slots","$$events","$$legacy","ref","class","children"]);var _=LV();Ii(_,T=>({"data-slot":"card-content",class:T,...m}),[()=>xs("px-6",n.class)]);var x=Xn(_);Dn(x,()=>n.children??Si),Ln(_),er(_,T=>c(T),()=>c()),je(s,_),Kn()}var FV=Un("<p><!></p>");function wT(s,n){Yn(n,!0);let c=Re(n,"ref",15,null),m=bi(n,["$$slots","$$events","$$legacy","ref","class","children"]);var _=FV();Ii(_,T=>({"data-slot":"card-description",class:T,...m}),[()=>xs("text-muted-foreground text-sm",n.class)]);var x=Xn(_);Dn(x,()=>n.children??Si),Ln(_),er(_,T=>c(T),()=>c()),je(s,_),Kn()}var BV=Un("<div><!></div>");function TT(s,n){Yn(n,!0);let c=Re(n,"ref",15,null),m=bi(n,["$$slots","$$events","$$legacy","ref","class","children"]);var _=BV();Ii(_,T=>({"data-slot":"card-footer",class:T,...m}),[()=>xs("[.border-t]:pt-6 flex items-center px-6",n.class)]);var x=Xn(_);Dn(x,()=>n.children??Si),Ln(_),er(_,T=>c(T),()=>c()),je(s,_),Kn()}var NV=Un("<div><!></div>");function ST(s,n){Yn(n,!0);let c=Re(n,"ref",15,null),m=bi(n,["$$slots","$$events","$$legacy","ref","class","children"]);var _=NV();Ii(_,T=>({"data-slot":"card-header",class:T,...m}),[()=>xs("@container/card-header has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6 grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6",n.class)]);var x=Xn(_);Dn(x,()=>n.children??Si),Ln(_),er(_,T=>c(T),()=>c()),je(s,_),Kn()}var VV=Un("<div><!></div>");function ET(s,n){Yn(n,!0);let c=Re(n,"ref",15,null),m=bi(n,["$$slots","$$events","$$legacy","ref","class","children"]);var _=VV();Ii(_,T=>({"data-slot":"card-title",class:T,...m}),[()=>xs("font-semibold leading-none",n.class)]);var x=Xn(_);Dn(x,()=>n.children??Si),Ln(_),er(_,T=>c(T),()=>c()),je(s,_),Kn()}var UV=Un("<!> <!>",1),jV=Un("<!> <!>",1);function GV(s,n){var c=Gt(),m=yt(c);mo(m,()=>bT,(_,x)=>{x(_,{class:"w-[15em] text-s mb-2",children:(T,r)=>{var I=jV(),k=yt(I);mo(k,()=>ST,(R,F)=>{F(R,{children:(V,W)=>{var G=UV(),K=yt(G);mo(K,()=>ET,(ne,oe)=>{oe(ne,{children:(ce,me)=>{Yu();var ue=Za();Vi(()=>Es(ue,`Bus Route: ${n.busRoute??""}`)),je(ce,ue)},$$slots:{default:!0}})});var Y=Tn(K,2);mo(Y,()=>wT,(ne,oe)=>{oe(ne,{class:"text-xs"})}),je(V,G)},$$slots:{default:!0}})});var P=Tn(k,2);mo(P,()=>TT,(R,F)=>{F(R,{class:"flex-col gap-2"})}),je(T,I)},$$slots:{default:!0}})}),je(s,c)}function Wc(s,n){return s==null||n==null?NaN:s<n?-1:s>n?1:s>=n?0:NaN}function WV(s,n){return s==null||n==null?NaN:n<s?-1:n>s?1:n>=s?0:NaN}function t_(s){let n,c,m;s.length!==2?(n=Wc,c=(r,I)=>Wc(s(r),I),m=(r,I)=>s(r)-I):(n=s===Wc||s===WV?s:qV,c=s,m=s);function _(r,I,k=0,P=r.length){if(k<P){if(n(I,I)!==0)return P;do{const R=k+P>>>1;c(r[R],I)<0?k=R+1:P=R}while(k<P)}return k}function x(r,I,k=0,P=r.length){if(k<P){if(n(I,I)!==0)return P;do{const R=k+P>>>1;c(r[R],I)<=0?k=R+1:P=R}while(k<P)}return k}function T(r,I,k=0,P=r.length){const R=_(r,I,k,P-1);return R>k&&m(r[R-1],I)>-m(r[R],I)?R-1:R}return{left:_,center:T,right:x}}function qV(){return 0}function HV(s){return s===null?NaN:+s}function*ZV(s,n){for(let c of s)c!=null&&(c=+c)>=c&&(yield c)}const XV=t_(Wc),YV=XV.right;t_(HV).center;function Xa(s,n){let c,m;if(n===void 0)for(const _ of s)_!=null&&(c===void 0?_>=_&&(c=m=_):(c>_&&(c=_),m<_&&(m=_)));else{let _=-1;for(let x of s)(x=n(x,++_,s))!=null&&(c===void 0?x>=x&&(c=m=x):(c>x&&(c=x),m<x&&(m=x)))}return[c,m]}class ml{constructor(){this._partials=new Float64Array(32),this._n=0}add(n){const c=this._partials;let m=0;for(let _=0;_<this._n&&_<32;_++){const x=c[_],T=n+x,r=Math.abs(n)<Math.abs(x)?n-(T-x):x-(T-n);r&&(c[m++]=r),n=T}return c[m]=n,this._n=m+1,this}valueOf(){const n=this._partials;let c=this._n,m,_,x,T=0;if(c>0){for(T=n[--c];c>0&&(m=T,_=n[--c],T=m+_,x=_-(T-m),!x););c>0&&(x<0&&n[c-1]<0||x>0&&n[c-1]>0)&&(_=x*2,m=T+_,_==m-T&&(T=m))}return T}}class WM extends Map{constructor(n,c=lz){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:c}}),n!=null)for(const[m,_]of n)this.set(m,_)}get(n){return super.get(s2(this,n))}has(n){return super.has(s2(this,n))}set(n,c){return super.set(sz(this,n),c)}delete(n){return super.delete(az(this,n))}}class KV extends Set{constructor(n,c=lz){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:c}}),n!=null)for(const m of n)this.add(m)}has(n){return super.has(s2(this,n))}add(n){return super.add(sz(this,n))}delete(n){return super.delete(az(this,n))}}function s2({_intern:s,_key:n},c){const m=n(c);return s.has(m)?s.get(m):c}function sz({_intern:s,_key:n},c){const m=n(c);return s.has(m)?s.get(m):(s.set(m,c),c)}function az({_intern:s,_key:n},c){const m=n(c);return s.has(m)&&(c=s.get(m),s.delete(m)),c}function lz(s){return s!==null&&typeof s=="object"?s.valueOf():s}function JV(s=Wc){if(s===Wc)return cz;if(typeof s!="function")throw new TypeError("compare is not a function");return(n,c)=>{const m=s(n,c);return m||m===0?m:(s(c,c)===0)-(s(n,n)===0)}}function cz(s,n){return(s==null||!(s>=s))-(n==null||!(n>=n))||(s<n?-1:s>n?1:0)}const QV=Math.sqrt(50),$V=Math.sqrt(10),eU=Math.sqrt(2);function p0(s,n,c){const m=(n-s)/Math.max(0,c),_=Math.floor(Math.log10(m)),x=m/Math.pow(10,_),T=x>=QV?10:x>=$V?5:x>=eU?2:1;let r,I,k;return _<0?(k=Math.pow(10,-_)/T,r=Math.round(s*k),I=Math.round(n*k),r/k<s&&++r,I/k>n&&--I,k=-k):(k=Math.pow(10,_)*T,r=Math.round(s/k),I=Math.round(n/k),r*k<s&&++r,I*k>n&&--I),I<r&&.5<=c&&c<2?p0(s,n,c*2):[r,I,k]}function tU(s,n,c){if(n=+n,s=+s,c=+c,!(c>0))return[];if(s===n)return[s];const m=n<s,[_,x,T]=m?p0(n,s,c):p0(s,n,c);if(!(x>=_))return[];const r=x-_+1,I=new Array(r);if(m)if(T<0)for(let k=0;k<r;++k)I[k]=(x-k)/-T;else for(let k=0;k<r;++k)I[k]=(x-k)*T;else if(T<0)for(let k=0;k<r;++k)I[k]=(_+k)/-T;else for(let k=0;k<r;++k)I[k]=(_+k)*T;return I}function a2(s,n,c){return n=+n,s=+s,c=+c,p0(s,n,c)[2]}function l2(s,n,c){n=+n,s=+s,c=+c;const m=n<s,_=m?a2(n,s,c):a2(s,n,c);return(m?-1:1)*(_<0?1/-_:_)}function co(s,n){let c;for(const m of s)m!=null&&(c<m||c===void 0&&m>=m)&&(c=m);return c}function Qr(s,n){let c;for(const m of s)m!=null&&(c>m||c===void 0&&m>=m)&&(c=m);return c}function uz(s,n,c=0,m=1/0,_){if(n=Math.floor(n),c=Math.floor(Math.max(0,c)),m=Math.floor(Math.min(s.length-1,m)),!(c<=n&&n<=m))return s;for(_=_===void 0?cz:JV(_);m>c;){if(m-c>600){const I=m-c+1,k=n-c+1,P=Math.log(I),R=.5*Math.exp(2*P/3),F=.5*Math.sqrt(P*R*(I-R)/I)*(k-I/2<0?-1:1),V=Math.max(c,Math.floor(n-k*R/I+F)),W=Math.min(m,Math.floor(n+(I-k)*R/I+F));uz(s,n,V,W,_)}const x=s[n];let T=c,r=m;for(Mg(s,c,n),_(s[m],x)>0&&Mg(s,c,m);T<r;){for(Mg(s,T,r),++T,--r;_(s[T],x)<0;)++T;for(;_(s[r],x)>0;)--r}_(s[c],x)===0?Mg(s,c,r):(++r,Mg(s,r,m)),r<=n&&(c=r+1),n<=r&&(m=r-1)}return s}function Mg(s,n,c){const m=s[n];s[n]=s[c],s[c]=m}function nU(s,n=Wc){let c,m=!1;if(n.length===1){let _;for(const x of s){const T=n(x);(m?Wc(T,_)>0:Wc(T,T)===0)&&(c=x,_=T,m=!0)}}else for(const _ of s)(m?n(_,c)>0:n(_,_)===0)&&(c=_,m=!0);return c}function iU(s,n,c){if(s=Float64Array.from(ZV(s)),!(!(m=s.length)||isNaN(n=+n))){if(n<=0||m<2)return Qr(s);if(n>=1)return co(s);var m,_=(m-1)*n,x=Math.floor(_),T=co(uz(s,x).subarray(0,x+1)),r=Qr(s.subarray(x+1));return T+(r-T)*(_-x)}}function*rU(s){for(const n of s)yield*n}function hz(s){return Array.from(rU(s))}function n_(s,n,c){s=+s,n=+n,c=(_=arguments.length)<2?(n=s,s=0,1):_<3?1:+c;for(var m=-1,_=Math.max(0,Math.ceil((n-s)/c))|0,x=new Array(_);++m<_;)x[m]=s+m*c;return x}function oU(s,n){let c=0;if(n===void 0)for(let m of s)(m=+m)&&(c+=m);else{let m=-1;for(let _ of s)(_=+n(_,++m,s))&&(c+=_)}return c}var dz=typeof global=="object"&&global&&global.Object===Object&&global,sU=typeof self=="object"&&self&&self.Object===Object&&self,Sp=dz||sU||Function("return this")(),hp=Sp.Symbol,fz=Object.prototype,aU=fz.hasOwnProperty,lU=fz.toString,Cg=hp?hp.toStringTag:void 0;function cU(s){var n=aU.call(s,Cg),c=s[Cg];try{s[Cg]=void 0;var m=!0}catch{}var _=lU.call(s);return m&&(n?s[Cg]=c:delete s[Cg]),_}var uU=Object.prototype,hU=uU.toString;function dU(s){return hU.call(s)}var fU="[object Null]",pU="[object Undefined]",qM=hp?hp.toStringTag:void 0;function x_(s){return s==null?s===void 0?pU:fU:qM&&qM in Object(s)?cU(s):dU(s)}function Ep(s){return s!=null&&typeof s=="object"}var mU="[object Symbol]";function AT(s){return typeof s=="symbol"||Ep(s)&&x_(s)==mU}function gU(s,n){for(var c=-1,m=s==null?0:s.length,_=Array(m);++c<m;)_[c]=n(s[c],c,s);return _}var dp=Array.isArray,HM=hp?hp.prototype:void 0,ZM=HM?HM.toString:void 0;function pz(s){if(typeof s=="string")return s;if(dp(s))return gU(s,pz)+"";if(AT(s))return ZM?ZM.call(s):"";var n=s+"";return n=="0"&&1/s==-1/0?"-0":n}function Xc(s){var n=typeof s;return s!=null&&(n=="object"||n=="function")}function mz(s){return s}var _U="[object AsyncFunction]",yU="[object Function]",vU="[object GeneratorFunction]",xU="[object Proxy]";function IT(s){if(!Xc(s))return!1;var n=x_(s);return n==yU||n==vU||n==_U||n==xU}var Mb=Sp["__core-js_shared__"],XM=(function(){var s=/[^.]+$/.exec(Mb&&Mb.keys&&Mb.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""})();function bU(s){return!!XM&&XM in s}var wU=Function.prototype,TU=wU.toString;function SU(s){if(s!=null){try{return TU.call(s)}catch{}try{return s+""}catch{}}return""}var EU=/[\\^$.*+?()[\]{}|]/g,AU=/^\[object .+?Constructor\]$/,IU=Function.prototype,MU=Object.prototype,CU=IU.toString,PU=MU.hasOwnProperty,kU=RegExp("^"+CU.call(PU).replace(EU,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function RU(s){if(!Xc(s)||bU(s))return!1;var n=IT(s)?kU:AU;return n.test(SU(s))}function zU(s,n){return s?.[n]}function MT(s,n){var c=zU(s,n);return RU(c)?c:void 0}var YM=Object.create,DU=(function(){function s(){}return function(n){if(!Xc(n))return{};if(YM)return YM(n);s.prototype=n;var c=new s;return s.prototype=void 0,c}})();function gz(s,n,c){switch(c.length){case 0:return s.call(n);case 1:return s.call(n,c[0]);case 2:return s.call(n,c[0],c[1]);case 3:return s.call(n,c[0],c[1],c[2])}return s.apply(n,c)}function LU(s,n){var c=-1,m=s.length;for(n||(n=Array(m));++c<m;)n[c]=s[c];return n}var OU=800,FU=16,BU=Date.now;function NU(s){var n=0,c=0;return function(){var m=BU(),_=FU-(m-c);if(c=m,_>0){if(++n>=OU)return arguments[0]}else n=0;return s.apply(void 0,arguments)}}function VU(s){return function(){return s}}var m0=(function(){try{var s=MT(Object,"defineProperty");return s({},"",{}),s}catch{}})(),UU=m0?function(s,n){return m0(s,"toString",{configurable:!0,enumerable:!1,value:VU(n),writable:!0})}:mz,jU=NU(UU),GU=9007199254740991,WU=/^(?:0|[1-9]\d*)$/;function _z(s,n){var c=typeof s;return n=n??GU,!!n&&(c=="number"||c!="symbol"&&WU.test(s))&&s>-1&&s%1==0&&s<n}function CT(s,n,c){n=="__proto__"&&m0?m0(s,n,{configurable:!0,enumerable:!0,value:c,writable:!0}):s[n]=c}function ix(s,n){return s===n||s!==s&&n!==n}var qU=Object.prototype,HU=qU.hasOwnProperty;function ZU(s,n,c){var m=s[n];(!(HU.call(s,n)&&ix(m,c))||c===void 0&&!(n in s))&&CT(s,n,c)}function XU(s,n,c,m){var _=!c;c||(c={});for(var x=-1,T=n.length;++x<T;){var r=n[x],I=void 0;I===void 0&&(I=s[r]),_?CT(c,r,I):ZU(c,r,I)}return c}var KM=Math.max;function YU(s,n,c){return n=KM(n===void 0?s.length-1:n,0),function(){for(var m=arguments,_=-1,x=KM(m.length-n,0),T=Array(x);++_<x;)T[_]=m[n+_];_=-1;for(var r=Array(n+1);++_<n;)r[_]=m[_];return r[n]=c(T),gz(s,this,r)}}function yz(s,n){return jU(YU(s,n,mz),s+"")}var KU=9007199254740991;function vz(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=KU}function PT(s){return s!=null&&vz(s.length)&&!IT(s)}function JU(s,n,c){if(!Xc(c))return!1;var m=typeof n;return(m=="number"?PT(c)&&_z(n,c.length):m=="string"&&n in c)?ix(c[n],s):!1}function xz(s){return yz(function(n,c){var m=-1,_=c.length,x=_>1?c[_-1]:void 0,T=_>2?c[2]:void 0;for(x=s.length>3&&typeof x=="function"?(_--,x):void 0,T&&JU(c[0],c[1],T)&&(x=_<3?void 0:x,_=1),n=Object(n);++m<_;){var r=c[m];r&&s(n,r,m,x)}return n})}var QU=Object.prototype;function bz(s){var n=s&&s.constructor,c=typeof n=="function"&&n.prototype||QU;return s===c}function $U(s,n){for(var c=-1,m=Array(s);++c<s;)m[c]=n(c);return m}var e6="[object Arguments]";function JM(s){return Ep(s)&&x_(s)==e6}var wz=Object.prototype,t6=wz.hasOwnProperty,n6=wz.propertyIsEnumerable,c2=JM((function(){return arguments})())?JM:function(s){return Ep(s)&&t6.call(s,"callee")&&!n6.call(s,"callee")};function i6(){return!1}var Tz=typeof exports=="object"&&exports&&!exports.nodeType&&exports,QM=Tz&&typeof module=="object"&&module&&!module.nodeType&&module,r6=QM&&QM.exports===Tz,$M=r6?Sp.Buffer:void 0,o6=$M?$M.isBuffer:void 0,Sz=o6||i6,s6="[object Arguments]",a6="[object Array]",l6="[object Boolean]",c6="[object Date]",u6="[object Error]",h6="[object Function]",d6="[object Map]",f6="[object Number]",p6="[object Object]",m6="[object RegExp]",g6="[object Set]",_6="[object String]",y6="[object WeakMap]",v6="[object ArrayBuffer]",x6="[object DataView]",b6="[object Float32Array]",w6="[object Float64Array]",T6="[object Int8Array]",S6="[object Int16Array]",E6="[object Int32Array]",A6="[object Uint8Array]",I6="[object Uint8ClampedArray]",M6="[object Uint16Array]",C6="[object Uint32Array]",Io={};Io[b6]=Io[w6]=Io[T6]=Io[S6]=Io[E6]=Io[A6]=Io[I6]=Io[M6]=Io[C6]=!0;Io[s6]=Io[a6]=Io[v6]=Io[l6]=Io[x6]=Io[c6]=Io[u6]=Io[h6]=Io[d6]=Io[f6]=Io[p6]=Io[m6]=Io[g6]=Io[_6]=Io[y6]=!1;function P6(s){return Ep(s)&&vz(s.length)&&!!Io[x_(s)]}function k6(s){return function(n){return s(n)}}var Ez=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Xg=Ez&&typeof module=="object"&&module&&!module.nodeType&&module,R6=Xg&&Xg.exports===Ez,Cb=R6&&dz.process,eC=(function(){try{var s=Xg&&Xg.require&&Xg.require("util").types;return s||Cb&&Cb.binding&&Cb.binding("util")}catch{}})(),tC=eC&&eC.isTypedArray,Az=tC?k6(tC):P6;function z6(s,n){var c=dp(s),m=!c&&c2(s),_=!c&&!m&&Sz(s),x=!c&&!m&&!_&&Az(s),T=c||m||_||x,r=T?$U(s.length,String):[],I=r.length;for(var k in s)T&&(k=="length"||_&&(k=="offset"||k=="parent")||x&&(k=="buffer"||k=="byteLength"||k=="byteOffset")||_z(k,I))||r.push(k);return r}function D6(s,n){return function(c){return s(n(c))}}function L6(s){var n=[];if(s!=null)for(var c in Object(s))n.push(c);return n}var O6=Object.prototype,F6=O6.hasOwnProperty;function B6(s){if(!Xc(s))return L6(s);var n=bz(s),c=[];for(var m in s)m=="constructor"&&(n||!F6.call(s,m))||c.push(m);return c}function Iz(s){return PT(s)?z6(s):B6(s)}var N6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,V6=/^\w*$/;function U6(s,n){if(dp(s))return!1;var c=typeof s;return c=="number"||c=="symbol"||c=="boolean"||s==null||AT(s)?!0:V6.test(s)||!N6.test(s)||n!=null&&s in Object(n)}var i_=MT(Object,"create");function j6(){this.__data__=i_?i_(null):{},this.size=0}function G6(s){var n=this.has(s)&&delete this.__data__[s];return this.size-=n?1:0,n}var W6="__lodash_hash_undefined__",q6=Object.prototype,H6=q6.hasOwnProperty;function Z6(s){var n=this.__data__;if(i_){var c=n[s];return c===W6?void 0:c}return H6.call(n,s)?n[s]:void 0}var X6=Object.prototype,Y6=X6.hasOwnProperty;function K6(s){var n=this.__data__;return i_?n[s]!==void 0:Y6.call(n,s)}var J6="__lodash_hash_undefined__";function Q6(s,n){var c=this.__data__;return this.size+=this.has(s)?0:1,c[s]=i_&&n===void 0?J6:n,this}function rd(s){var n=-1,c=s==null?0:s.length;for(this.clear();++n<c;){var m=s[n];this.set(m[0],m[1])}}rd.prototype.clear=j6;rd.prototype.delete=G6;rd.prototype.get=Z6;rd.prototype.has=K6;rd.prototype.set=Q6;function $6(){this.__data__=[],this.size=0}function rx(s,n){for(var c=s.length;c--;)if(ix(s[c][0],n))return c;return-1}var ej=Array.prototype,tj=ej.splice;function nj(s){var n=this.__data__,c=rx(n,s);if(c<0)return!1;var m=n.length-1;return c==m?n.pop():tj.call(n,c,1),--this.size,!0}function ij(s){var n=this.__data__,c=rx(n,s);return c<0?void 0:n[c][1]}function rj(s){return rx(this.__data__,s)>-1}function oj(s,n){var c=this.__data__,m=rx(c,s);return m<0?(++this.size,c.push([s,n])):c[m][1]=n,this}function Qc(s){var n=-1,c=s==null?0:s.length;for(this.clear();++n<c;){var m=s[n];this.set(m[0],m[1])}}Qc.prototype.clear=$6;Qc.prototype.delete=nj;Qc.prototype.get=ij;Qc.prototype.has=rj;Qc.prototype.set=oj;var Mz=MT(Sp,"Map");function sj(){this.size=0,this.__data__={hash:new rd,map:new(Mz||Qc),string:new rd}}function aj(s){var n=typeof s;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?s!=="__proto__":s===null}function ox(s,n){var c=s.__data__;return aj(n)?c[typeof n=="string"?"string":"hash"]:c.map}function lj(s){var n=ox(this,s).delete(s);return this.size-=n?1:0,n}function cj(s){return ox(this,s).get(s)}function uj(s){return ox(this,s).has(s)}function hj(s,n){var c=ox(this,s),m=c.size;return c.set(s,n),this.size+=c.size==m?0:1,this}function $u(s){var n=-1,c=s==null?0:s.length;for(this.clear();++n<c;){var m=s[n];this.set(m[0],m[1])}}$u.prototype.clear=sj;$u.prototype.delete=lj;$u.prototype.get=cj;$u.prototype.has=uj;$u.prototype.set=hj;var dj="Expected a function";function kT(s,n){if(typeof s!="function"||n!=null&&typeof n!="function")throw new TypeError(dj);var c=function(){var m=arguments,_=n?n.apply(this,m):m[0],x=c.cache;if(x.has(_))return x.get(_);var T=s.apply(this,m);return c.cache=x.set(_,T)||x,T};return c.cache=new(kT.Cache||$u),c}kT.Cache=$u;var fj=500;function pj(s){var n=kT(s,function(m){return c.size===fj&&c.clear(),m}),c=n.cache;return n}var mj=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gj=/\\(\\)?/g,_j=pj(function(s){var n=[];return s.charCodeAt(0)===46&&n.push(""),s.replace(mj,function(c,m,_,x){n.push(_?x.replace(gj,"$1"):m||c)}),n});function yj(s){return s==null?"":pz(s)}function vj(s,n){return dp(s)?s:U6(s,n)?[s]:_j(yj(s))}function xj(s){if(typeof s=="string"||AT(s))return s;var n=s+"";return n=="0"&&1/s==-1/0?"-0":n}function bj(s,n){n=vj(n,s);for(var c=0,m=n.length;s!=null&&c<m;)s=s[xj(n[c++])];return c&&c==m?s:void 0}function Cz(s,n,c){var m=s==null?void 0:bj(s,n);return m===void 0?c:m}var Pz=D6(Object.getPrototypeOf,Object),wj="[object Object]",Tj=Function.prototype,Sj=Object.prototype,kz=Tj.toString,Ej=Sj.hasOwnProperty,Aj=kz.call(Object);function Ij(s){if(!Ep(s)||x_(s)!=wj)return!1;var n=Pz(s);if(n===null)return!0;var c=Ej.call(n,"constructor")&&n.constructor;return typeof c=="function"&&c instanceof c&&kz.call(c)==Aj}function Mj(){this.__data__=new Qc,this.size=0}function Cj(s){var n=this.__data__,c=n.delete(s);return this.size=n.size,c}function Pj(s){return this.__data__.get(s)}function kj(s){return this.__data__.has(s)}var Rj=200;function zj(s,n){var c=this.__data__;if(c instanceof Qc){var m=c.__data__;if(!Mz||m.length<Rj-1)return m.push([s,n]),this.size=++c.size,this;c=this.__data__=new $u(m)}return c.set(s,n),this.size=c.size,this}function Ap(s){var n=this.__data__=new Qc(s);this.size=n.size}Ap.prototype.clear=Mj;Ap.prototype.delete=Cj;Ap.prototype.get=Pj;Ap.prototype.has=kj;Ap.prototype.set=zj;var Rz=typeof exports=="object"&&exports&&!exports.nodeType&&exports,nC=Rz&&typeof module=="object"&&module&&!module.nodeType&&module,Dj=nC&&nC.exports===Rz,iC=Dj?Sp.Buffer:void 0;iC&&iC.allocUnsafe;function Lj(s,n){return s.slice()}var rC=Sp.Uint8Array;function Oj(s){var n=new s.constructor(s.byteLength);return new rC(n).set(new rC(s)),n}function Fj(s,n){var c=Oj(s.buffer);return new s.constructor(c,s.byteOffset,s.length)}function Bj(s){return typeof s.constructor=="function"&&!bz(s)?DU(Pz(s)):{}}function Nj(s){return function(n,c,m){for(var _=-1,x=Object(n),T=m(n),r=T.length;r--;){var I=T[++_];if(c(x[I],I,x)===!1)break}return n}}var Vj=Nj();function u2(s,n,c){(c!==void 0&&!ix(s[n],c)||c===void 0&&!(n in s))&&CT(s,n,c)}function Uj(s){return Ep(s)&&PT(s)}function h2(s,n){if(!(n==="constructor"&&typeof s[n]=="function")&&n!="__proto__")return s[n]}function jj(s){return XU(s,Iz(s))}function Gj(s,n,c,m,_,x,T){var r=h2(s,c),I=h2(n,c),k=T.get(I);if(k){u2(s,c,k);return}var P=x?x(r,I,c+"",s,n,T):void 0,R=P===void 0;if(R){var F=dp(I),V=!F&&Sz(I),W=!F&&!V&&Az(I);P=I,F||V||W?dp(r)?P=r:Uj(r)?P=LU(r):V?(R=!1,P=Lj(I)):W?(R=!1,P=Fj(I)):P=[]:Ij(I)||c2(I)?(P=r,c2(r)?P=jj(r):(!Xc(r)||IT(r))&&(P=Bj(I))):R=!1}R&&(T.set(I,P),_(P,I,m,x,T),T.delete(I)),u2(s,c,P)}function sx(s,n,c,m,_){s!==n&&Vj(n,function(x,T){if(_||(_=new Ap),Xc(x))Gj(s,n,T,c,sx,m,_);else{var r=m?m(h2(s,T),x,T+"",s,n,_):void 0;r===void 0&&(r=x),u2(s,T,r)}},Iz)}function zz(s,n,c,m,_,x){return Xc(s)&&Xc(n)&&(x.set(n,s),sx(s,n,void 0,zz,x),x.delete(n)),s}var Wj=xz(function(s,n,c,m){sx(s,n,c,m)}),oC=yz(function(s){return s.push(void 0,zz),gz(Wj,void 0,s)}),cd=xz(function(s,n,c){sx(s,n,c)});function qj(s){return Object.keys(s)}function Dz(s){return s instanceof Map?Array.from(s.entries()):Object.entries(s)}function Hj(s){return Object.fromEntries(s)}function Lz(s){return s&&typeof s=="object"&&s.constructor===Object}function Zj(s){return typeof s=="function"?s:typeof s=="string"?n=>Cz(n,s):n=>n}var Pb=new WeakMap,Xj=0;function Yj(s){return Pb.has(s)||Pb.set(s,++Xj),Pb.get(s)}function Kj(s){return qj.length===0?s:Hj(Dz(s).filter(([n,c])=>c!=null))}function Jj(s){return Array.from(new Set(s))}function Qj(s){return nU(s,(n,c)=>Math.abs(n)-Math.abs(c))}const kb=new Date,Rb=new Date;function ns(s,n,c,m){function _(x){return s(x=arguments.length===0?new Date:new Date(+x)),x}return _.floor=x=>(s(x=new Date(+x)),x),_.ceil=x=>(s(x=new Date(x-1)),n(x,1),s(x),x),_.round=x=>{const T=_(x),r=_.ceil(x);return x-T<r-x?T:r},_.offset=(x,T)=>(n(x=new Date(+x),T==null?1:Math.floor(T)),x),_.range=(x,T,r)=>{const I=[];if(x=_.ceil(x),r=r==null?1:Math.floor(r),!(x<T)||!(r>0))return I;let k;do I.push(k=new Date(+x)),n(x,r),s(x);while(k<x&&x<T);return I},_.filter=x=>ns(T=>{if(T>=T)for(;s(T),!x(T);)T.setTime(T-1)},(T,r)=>{if(T>=T)if(r<0)for(;++r<=0;)for(;n(T,-1),!x(T););else for(;--r>=0;)for(;n(T,1),!x(T););}),c&&(_.count=(x,T)=>(kb.setTime(+x),Rb.setTime(+T),s(kb),s(Rb),Math.floor(c(kb,Rb))),_.every=x=>(x=Math.floor(x),!isFinite(x)||!(x>0)?null:x>1?_.filter(m?T=>m(T)%x===0:T=>_.count(0,T)%x===0):_)),_}const r_=ns(()=>{},(s,n)=>{s.setTime(+s+n)},(s,n)=>n-s);r_.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?ns(n=>{n.setTime(Math.floor(n/s)*s)},(n,c)=>{n.setTime(+n+c*s)},(n,c)=>(c-n)/s):r_);r_.range;const Vc=1e3,qa=Vc*60,Uc=qa*60,Yc=Uc*24,RT=Yc*7,sC=Yc*30,zb=Yc*365,qu=ns(s=>{s.setTime(s-s.getMilliseconds())},(s,n)=>{s.setTime(+s+n*Vc)},(s,n)=>(n-s)/Vc,s=>s.getUTCSeconds());qu.range;const ax=ns(s=>{s.setTime(s-s.getMilliseconds()-s.getSeconds()*Vc)},(s,n)=>{s.setTime(+s+n*qa)},(s,n)=>(n-s)/qa,s=>s.getMinutes());ax.range;const zT=ns(s=>{s.setUTCSeconds(0,0)},(s,n)=>{s.setTime(+s+n*qa)},(s,n)=>(n-s)/qa,s=>s.getUTCMinutes());zT.range;const lx=ns(s=>{s.setTime(s-s.getMilliseconds()-s.getSeconds()*Vc-s.getMinutes()*qa)},(s,n)=>{s.setTime(+s+n*Uc)},(s,n)=>(n-s)/Uc,s=>s.getHours());lx.range;const DT=ns(s=>{s.setUTCMinutes(0,0,0)},(s,n)=>{s.setTime(+s+n*Uc)},(s,n)=>(n-s)/Uc,s=>s.getUTCHours());DT.range;const tc=ns(s=>s.setHours(0,0,0,0),(s,n)=>s.setDate(s.getDate()+n),(s,n)=>(n-s-(n.getTimezoneOffset()-s.getTimezoneOffset())*qa)/Yc,s=>s.getDate()-1);tc.range;const cx=ns(s=>{s.setUTCHours(0,0,0,0)},(s,n)=>{s.setUTCDate(s.getUTCDate()+n)},(s,n)=>(n-s)/Yc,s=>s.getUTCDate()-1);cx.range;const Oz=ns(s=>{s.setUTCHours(0,0,0,0)},(s,n)=>{s.setUTCDate(s.getUTCDate()+n)},(s,n)=>(n-s)/Yc,s=>Math.floor(s/Yc));Oz.range;function ud(s){return ns(n=>{n.setDate(n.getDate()-(n.getDay()+7-s)%7),n.setHours(0,0,0,0)},(n,c)=>{n.setDate(n.getDate()+c*7)},(n,c)=>(c-n-(c.getTimezoneOffset()-n.getTimezoneOffset())*qa)/RT)}const hd=ud(0),fp=ud(1),LT=ud(2),OT=ud(3),Ju=ud(4),FT=ud(5),BT=ud(6);hd.range;fp.range;LT.range;OT.range;Ju.range;FT.range;BT.range;function dd(s){return ns(n=>{n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-s)%7),n.setUTCHours(0,0,0,0)},(n,c)=>{n.setUTCDate(n.getUTCDate()+c*7)},(n,c)=>(c-n)/RT)}const ux=dd(0),g0=dd(1),$j=dd(2),eG=dd(3),pp=dd(4),tG=dd(5),nG=dd(6);ux.range;g0.range;$j.range;eG.range;pp.range;tG.range;nG.range;const hx=ns(s=>{s.setDate(1),s.setHours(0,0,0,0)},(s,n)=>{s.setMonth(s.getMonth()+n)},(s,n)=>n.getMonth()-s.getMonth()+(n.getFullYear()-s.getFullYear())*12,s=>s.getMonth());hx.range;const NT=ns(s=>{s.setUTCDate(1),s.setUTCHours(0,0,0,0)},(s,n)=>{s.setUTCMonth(s.getUTCMonth()+n)},(s,n)=>n.getUTCMonth()-s.getUTCMonth()+(n.getUTCFullYear()-s.getUTCFullYear())*12,s=>s.getUTCMonth());NT.range;const yl=ns(s=>{s.setMonth(0,1),s.setHours(0,0,0,0)},(s,n)=>{s.setFullYear(s.getFullYear()+n)},(s,n)=>n.getFullYear()-s.getFullYear(),s=>s.getFullYear());yl.every=s=>!isFinite(s=Math.floor(s))||!(s>0)?null:ns(n=>{n.setFullYear(Math.floor(n.getFullYear()/s)*s),n.setMonth(0,1),n.setHours(0,0,0,0)},(n,c)=>{n.setFullYear(n.getFullYear()+c*s)});yl.range;const Kc=ns(s=>{s.setUTCMonth(0,1),s.setUTCHours(0,0,0,0)},(s,n)=>{s.setUTCFullYear(s.getUTCFullYear()+n)},(s,n)=>n.getUTCFullYear()-s.getUTCFullYear(),s=>s.getUTCFullYear());Kc.every=s=>!isFinite(s=Math.floor(s))||!(s>0)?null:ns(n=>{n.setUTCFullYear(Math.floor(n.getUTCFullYear()/s)*s),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,c)=>{n.setUTCFullYear(n.getUTCFullYear()+c*s)});Kc.range;function Fz(s,n,c,m,_,x){const T=[[qu,1,Vc],[qu,5,5*Vc],[qu,15,15*Vc],[qu,30,30*Vc],[x,1,qa],[x,5,5*qa],[x,15,15*qa],[x,30,30*qa],[_,1,Uc],[_,3,3*Uc],[_,6,6*Uc],[_,12,12*Uc],[m,1,Yc],[m,2,2*Yc],[c,1,RT],[n,1,sC],[n,3,3*sC],[s,1,zb]];function r(k,P,R){const F=P<k;F&&([k,P]=[P,k]);const V=R&&typeof R.range=="function"?R:I(k,P,R),W=V?V.range(k,+P+1):[];return F?W.reverse():W}function I(k,P,R){const F=Math.abs(P-k)/R,V=t_(([,,K])=>K).right(T,F);if(V===T.length)return s.every(l2(k/zb,P/zb,R));if(V===0)return r_.every(Math.max(l2(k,P,R),1));const[W,G]=T[F/T[V-1][2]<T[V][2]/F?V-1:V];return W.every(G)}return[r,I]}const[iG,rG]=Fz(Kc,NT,ux,Oz,DT,zT),[Bz,oG]=Fz(yl,hx,hd,tc,lx,ax);function Db(s){if(0<=s.y&&s.y<100){var n=new Date(-1,s.m,s.d,s.H,s.M,s.S,s.L);return n.setFullYear(s.y),n}return new Date(s.y,s.m,s.d,s.H,s.M,s.S,s.L)}function Lb(s){if(0<=s.y&&s.y<100){var n=new Date(Date.UTC(-1,s.m,s.d,s.H,s.M,s.S,s.L));return n.setUTCFullYear(s.y),n}return new Date(Date.UTC(s.y,s.m,s.d,s.H,s.M,s.S,s.L))}function Pg(s,n,c){return{y:s,m:n,d:c,H:0,M:0,S:0,L:0}}function sG(s){var n=s.dateTime,c=s.date,m=s.time,_=s.periods,x=s.days,T=s.shortDays,r=s.months,I=s.shortMonths,k=kg(_),P=Rg(_),R=kg(x),F=Rg(x),V=kg(T),W=Rg(T),G=kg(r),K=Rg(r),Y=kg(I),ne=Rg(I),oe={a:it,A:qe,b:ft,B:St,c:null,d:dC,e:dC,f:CG,g:NG,G:UG,H:AG,I:IG,j:MG,L:Nz,m:PG,M:kG,p:Dt,q:Kt,Q:mC,s:gC,S:RG,u:zG,U:DG,V:LG,w:OG,W:FG,x:null,X:null,y:BG,Y:VG,Z:jG,"%":pC},ce={a:et,A:Qe,b:st,B:tt,c:null,d:fC,e:fC,f:HG,g:n8,G:r8,H:GG,I:WG,j:qG,L:Uz,m:ZG,M:XG,p:gt,q:Lt,Q:mC,s:gC,S:YG,u:KG,U:JG,V:QG,w:$G,W:e8,x:null,X:null,y:t8,Y:i8,Z:o8,"%":pC},me={a:xe,A:de,b:Te,B:De,c:Be,d:uC,e:uC,f:wG,g:cC,G:lC,H:hC,I:hC,j:yG,L:bG,m:_G,M:vG,p:ie,q:gG,Q:SG,s:EG,S:xG,u:hG,U:dG,V:fG,w:uG,W:pG,x:Se,X:Ne,y:cC,Y:lC,Z:mG,"%":TG};oe.x=ue(c,oe),oe.X=ue(m,oe),oe.c=ue(n,oe),ce.x=ue(c,ce),ce.X=ue(m,ce),ce.c=ue(n,ce);function ue(_t,Je){return function(Rt){var ut=[],cn=-1,on=0,Jt=_t.length,vt,zt,fn;for(Rt instanceof Date||(Rt=new Date(+Rt));++cn<Jt;)_t.charCodeAt(cn)===37&&(ut.push(_t.slice(on,cn)),(zt=aC[vt=_t.charAt(++cn)])!=null?vt=_t.charAt(++cn):zt=vt==="e"?" ":"0",(fn=Je[vt])&&(vt=fn(Rt,zt)),ut.push(vt),on=cn+1);return ut.push(_t.slice(on,cn)),ut.join("")}}function _e(_t,Je){return function(Rt){var ut=Pg(1900,void 0,1),cn=te(ut,_t,Rt+="",0),on,Jt;if(cn!=Rt.length)return null;if("Q"in ut)return new Date(ut.Q);if("s"in ut)return new Date(ut.s*1e3+("L"in ut?ut.L:0));if(Je&&!("Z"in ut)&&(ut.Z=0),"p"in ut&&(ut.H=ut.H%12+ut.p*12),ut.m===void 0&&(ut.m="q"in ut?ut.q:0),"V"in ut){if(ut.V<1||ut.V>53)return null;"w"in ut||(ut.w=1),"Z"in ut?(on=Lb(Pg(ut.y,0,1)),Jt=on.getUTCDay(),on=Jt>4||Jt===0?g0.ceil(on):g0(on),on=cx.offset(on,(ut.V-1)*7),ut.y=on.getUTCFullYear(),ut.m=on.getUTCMonth(),ut.d=on.getUTCDate()+(ut.w+6)%7):(on=Db(Pg(ut.y,0,1)),Jt=on.getDay(),on=Jt>4||Jt===0?fp.ceil(on):fp(on),on=tc.offset(on,(ut.V-1)*7),ut.y=on.getFullYear(),ut.m=on.getMonth(),ut.d=on.getDate()+(ut.w+6)%7)}else("W"in ut||"U"in ut)&&("w"in ut||(ut.w="u"in ut?ut.u%7:"W"in ut?1:0),Jt="Z"in ut?Lb(Pg(ut.y,0,1)).getUTCDay():Db(Pg(ut.y,0,1)).getDay(),ut.m=0,ut.d="W"in ut?(ut.w+6)%7+ut.W*7-(Jt+5)%7:ut.w+ut.U*7-(Jt+6)%7);return"Z"in ut?(ut.H+=ut.Z/100|0,ut.M+=ut.Z%100,Lb(ut)):Db(ut)}}function te(_t,Je,Rt,ut){for(var cn=0,on=Je.length,Jt=Rt.length,vt,zt;cn<on;){if(ut>=Jt)return-1;if(vt=Je.charCodeAt(cn++),vt===37){if(vt=Je.charAt(cn++),zt=me[vt in aC?Je.charAt(cn++):vt],!zt||(ut=zt(_t,Rt,ut))<0)return-1}else if(vt!=Rt.charCodeAt(ut++))return-1}return ut}function ie(_t,Je,Rt){var ut=k.exec(Je.slice(Rt));return ut?(_t.p=P.get(ut[0].toLowerCase()),Rt+ut[0].length):-1}function xe(_t,Je,Rt){var ut=V.exec(Je.slice(Rt));return ut?(_t.w=W.get(ut[0].toLowerCase()),Rt+ut[0].length):-1}function de(_t,Je,Rt){var ut=R.exec(Je.slice(Rt));return ut?(_t.w=F.get(ut[0].toLowerCase()),Rt+ut[0].length):-1}function Te(_t,Je,Rt){var ut=Y.exec(Je.slice(Rt));return ut?(_t.m=ne.get(ut[0].toLowerCase()),Rt+ut[0].length):-1}function De(_t,Je,Rt){var ut=G.exec(Je.slice(Rt));return ut?(_t.m=K.get(ut[0].toLowerCase()),Rt+ut[0].length):-1}function Be(_t,Je,Rt){return te(_t,n,Je,Rt)}function Se(_t,Je,Rt){return te(_t,c,Je,Rt)}function Ne(_t,Je,Rt){return te(_t,m,Je,Rt)}function it(_t){return T[_t.getDay()]}function qe(_t){return x[_t.getDay()]}function ft(_t){return I[_t.getMonth()]}function St(_t){return r[_t.getMonth()]}function Dt(_t){return _[+(_t.getHours()>=12)]}function Kt(_t){return 1+~~(_t.getMonth()/3)}function et(_t){return T[_t.getUTCDay()]}function Qe(_t){return x[_t.getUTCDay()]}function st(_t){return I[_t.getUTCMonth()]}function tt(_t){return r[_t.getUTCMonth()]}function gt(_t){return _[+(_t.getUTCHours()>=12)]}function Lt(_t){return 1+~~(_t.getUTCMonth()/3)}return{format:function(_t){var Je=ue(_t+="",oe);return Je.toString=function(){return _t},Je},parse:function(_t){var Je=_e(_t+="",!1);return Je.toString=function(){return _t},Je},utcFormat:function(_t){var Je=ue(_t+="",ce);return Je.toString=function(){return _t},Je},utcParse:function(_t){var Je=_e(_t+="",!0);return Je.toString=function(){return _t},Je}}}var aC={"-":"",_:" ",0:"0"},bs=/^\s*\d+/,aG=/^%/,lG=/[\\^$*+?|[\]().{}]/g;function Xr(s,n,c){var m=s<0?"-":"",_=(m?-s:s)+"",x=_.length;return m+(x<c?new Array(c-x+1).join(n)+_:_)}function cG(s){return s.replace(lG,"\\$&")}function kg(s){return new RegExp("^(?:"+s.map(cG).join("|")+")","i")}function Rg(s){return new Map(s.map((n,c)=>[n.toLowerCase(),c]))}function uG(s,n,c){var m=bs.exec(n.slice(c,c+1));return m?(s.w=+m[0],c+m[0].length):-1}function hG(s,n,c){var m=bs.exec(n.slice(c,c+1));return m?(s.u=+m[0],c+m[0].length):-1}function dG(s,n,c){var m=bs.exec(n.slice(c,c+2));return m?(s.U=+m[0],c+m[0].length):-1}function fG(s,n,c){var m=bs.exec(n.slice(c,c+2));return m?(s.V=+m[0],c+m[0].length):-1}function pG(s,n,c){var m=bs.exec(n.slice(c,c+2));return m?(s.W=+m[0],c+m[0].length):-1}function lC(s,n,c){var m=bs.exec(n.slice(c,c+4));return m?(s.y=+m[0],c+m[0].length):-1}function cC(s,n,c){var m=bs.exec(n.slice(c,c+2));return m?(s.y=+m[0]+(+m[0]>68?1900:2e3),c+m[0].length):-1}function mG(s,n,c){var m=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(c,c+6));return m?(s.Z=m[1]?0:-(m[2]+(m[3]||"00")),c+m[0].length):-1}function gG(s,n,c){var m=bs.exec(n.slice(c,c+1));return m?(s.q=m[0]*3-3,c+m[0].length):-1}function _G(s,n,c){var m=bs.exec(n.slice(c,c+2));return m?(s.m=m[0]-1,c+m[0].length):-1}function uC(s,n,c){var m=bs.exec(n.slice(c,c+2));return m?(s.d=+m[0],c+m[0].length):-1}function yG(s,n,c){var m=bs.exec(n.slice(c,c+3));return m?(s.m=0,s.d=+m[0],c+m[0].length):-1}function hC(s,n,c){var m=bs.exec(n.slice(c,c+2));return m?(s.H=+m[0],c+m[0].length):-1}function vG(s,n,c){var m=bs.exec(n.slice(c,c+2));return m?(s.M=+m[0],c+m[0].length):-1}function xG(s,n,c){var m=bs.exec(n.slice(c,c+2));return m?(s.S=+m[0],c+m[0].length):-1}function bG(s,n,c){var m=bs.exec(n.slice(c,c+3));return m?(s.L=+m[0],c+m[0].length):-1}function wG(s,n,c){var m=bs.exec(n.slice(c,c+6));return m?(s.L=Math.floor(m[0]/1e3),c+m[0].length):-1}function TG(s,n,c){var m=aG.exec(n.slice(c,c+1));return m?c+m[0].length:-1}function SG(s,n,c){var m=bs.exec(n.slice(c));return m?(s.Q=+m[0],c+m[0].length):-1}function EG(s,n,c){var m=bs.exec(n.slice(c));return m?(s.s=+m[0],c+m[0].length):-1}function dC(s,n){return Xr(s.getDate(),n,2)}function AG(s,n){return Xr(s.getHours(),n,2)}function IG(s,n){return Xr(s.getHours()%12||12,n,2)}function MG(s,n){return Xr(1+tc.count(yl(s),s),n,3)}function Nz(s,n){return Xr(s.getMilliseconds(),n,3)}function CG(s,n){return Nz(s,n)+"000"}function PG(s,n){return Xr(s.getMonth()+1,n,2)}function kG(s,n){return Xr(s.getMinutes(),n,2)}function RG(s,n){return Xr(s.getSeconds(),n,2)}function zG(s){var n=s.getDay();return n===0?7:n}function DG(s,n){return Xr(hd.count(yl(s)-1,s),n,2)}function Vz(s){var n=s.getDay();return n>=4||n===0?Ju(s):Ju.ceil(s)}function LG(s,n){return s=Vz(s),Xr(Ju.count(yl(s),s)+(yl(s).getDay()===4),n,2)}function OG(s){return s.getDay()}function FG(s,n){return Xr(fp.count(yl(s)-1,s),n,2)}function BG(s,n){return Xr(s.getFullYear()%100,n,2)}function NG(s,n){return s=Vz(s),Xr(s.getFullYear()%100,n,2)}function VG(s,n){return Xr(s.getFullYear()%1e4,n,4)}function UG(s,n){var c=s.getDay();return s=c>=4||c===0?Ju(s):Ju.ceil(s),Xr(s.getFullYear()%1e4,n,4)}function jG(s){var n=s.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+Xr(n/60|0,"0",2)+Xr(n%60,"0",2)}function fC(s,n){return Xr(s.getUTCDate(),n,2)}function GG(s,n){return Xr(s.getUTCHours(),n,2)}function WG(s,n){return Xr(s.getUTCHours()%12||12,n,2)}function qG(s,n){return Xr(1+cx.count(Kc(s),s),n,3)}function Uz(s,n){return Xr(s.getUTCMilliseconds(),n,3)}function HG(s,n){return Uz(s,n)+"000"}function ZG(s,n){return Xr(s.getUTCMonth()+1,n,2)}function XG(s,n){return Xr(s.getUTCMinutes(),n,2)}function YG(s,n){return Xr(s.getUTCSeconds(),n,2)}function KG(s){var n=s.getUTCDay();return n===0?7:n}function JG(s,n){return Xr(ux.count(Kc(s)-1,s),n,2)}function jz(s){var n=s.getUTCDay();return n>=4||n===0?pp(s):pp.ceil(s)}function QG(s,n){return s=jz(s),Xr(pp.count(Kc(s),s)+(Kc(s).getUTCDay()===4),n,2)}function $G(s){return s.getUTCDay()}function e8(s,n){return Xr(g0.count(Kc(s)-1,s),n,2)}function t8(s,n){return Xr(s.getUTCFullYear()%100,n,2)}function n8(s,n){return s=jz(s),Xr(s.getUTCFullYear()%100,n,2)}function i8(s,n){return Xr(s.getUTCFullYear()%1e4,n,4)}function r8(s,n){var c=s.getUTCDay();return s=c>=4||c===0?pp(s):pp.ceil(s),Xr(s.getUTCFullYear()%1e4,n,4)}function o8(){return"+0000"}function pC(){return"%"}function mC(s){return+s}function gC(s){return Math.floor(+s/1e3)}var Zf,Gz,Wz;s8({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function s8(s){return Zf=sG(s),Gz=Zf.format,Zf.parse,Wz=Zf.utcFormat,Zf.utcParse,Zf}function Pv(s){return s!=null}function a8(s){return!!s&&(s instanceof SVGElement||"ownerSVGElement"in s)}function l8(s){return!!s&&"createSVGPoint"in s}function c8(s){return!!s&&"getScreenCTM"in s}function u8(s){return!!s&&"changedTouches"in s}var In;(function(s){s[s.Custom=1]="Custom",s[s.Day=10]="Day",s[s.DayTime=11]="DayTime",s[s.TimeOnly=15]="TimeOnly",s[s.Week=20]="Week",s[s.WeekSun=21]="WeekSun",s[s.WeekMon=22]="WeekMon",s[s.WeekTue=23]="WeekTue",s[s.WeekWed=24]="WeekWed",s[s.WeekThu=25]="WeekThu",s[s.WeekFri=26]="WeekFri",s[s.WeekSat=27]="WeekSat",s[s.Month=30]="Month",s[s.MonthYear=31]="MonthYear",s[s.Quarter=40]="Quarter",s[s.CalendarYear=50]="CalendarYear",s[s.FiscalYearOctober=60]="FiscalYearOctober",s[s.BiWeek1=70]="BiWeek1",s[s.BiWeek1Sun=71]="BiWeek1Sun",s[s.BiWeek1Mon=72]="BiWeek1Mon",s[s.BiWeek1Tue=73]="BiWeek1Tue",s[s.BiWeek1Wed=74]="BiWeek1Wed",s[s.BiWeek1Thu=75]="BiWeek1Thu",s[s.BiWeek1Fri=76]="BiWeek1Fri",s[s.BiWeek1Sat=77]="BiWeek1Sat",s[s.BiWeek2=80]="BiWeek2",s[s.BiWeek2Sun=81]="BiWeek2Sun",s[s.BiWeek2Mon=82]="BiWeek2Mon",s[s.BiWeek2Tue=83]="BiWeek2Tue",s[s.BiWeek2Wed=84]="BiWeek2Wed",s[s.BiWeek2Thu=85]="BiWeek2Thu",s[s.BiWeek2Fri=86]="BiWeek2Fri",s[s.BiWeek2Sat=87]="BiWeek2Sat"})(In||(In={}));const qz={[In.Custom]:"custom",[In.Day]:"day",[In.DayTime]:"daytime",[In.TimeOnly]:"time",[In.WeekSun]:"week-sun",[In.WeekMon]:"week-mon",[In.WeekTue]:"week-tue",[In.WeekWed]:"week-wed",[In.WeekThu]:"week-thu",[In.WeekFri]:"week-fri",[In.WeekSat]:"week-sat",[In.Week]:"week",[In.Month]:"month",[In.MonthYear]:"month-year",[In.Quarter]:"quarter",[In.CalendarYear]:"year",[In.FiscalYearOctober]:"fiscal-year-october",[In.BiWeek1Sun]:"biweek1-sun",[In.BiWeek1Mon]:"biweek1-mon",[In.BiWeek1Tue]:"biweek1-tue",[In.BiWeek1Wed]:"biweek1-wed",[In.BiWeek1Thu]:"biweek1-thu",[In.BiWeek1Fri]:"biweek1-fri",[In.BiWeek1Sat]:"biweek1-sat",[In.BiWeek1]:"biweek1",[In.BiWeek2Sun]:"biweek2-sun",[In.BiWeek2Mon]:"biweek2-mon",[In.BiWeek2Tue]:"biweek2-tue",[In.BiWeek2Wed]:"biweek2-wed",[In.BiWeek2Thu]:"biweek2-thu",[In.BiWeek2Fri]:"biweek2-fri",[In.BiWeek2Sat]:"biweek2-sat",[In.BiWeek2]:"biweek2"};var ys;(function(s){s[s.Sunday=0]="Sunday",s[s.Monday=1]="Monday",s[s.Tuesday=2]="Tuesday",s[s.Wednesday=3]="Wednesday",s[s.Thursday=4]="Thursday",s[s.Friday=5]="Friday",s[s.Saturday=6]="Saturday"})(ys||(ys={}));var Vn;(function(s){s.Year_numeric="yyy",s.Year_2Digit="yy",s.Month_long="MMMM",s.Month_short="MMM",s.Month_2Digit="MM",s.Month_numeric="M",s.Hour_numeric="h",s.Hour_2Digit="hh",s.Hour_wAMPM="a",s.Hour_woAMPM="aaaaaa",s.Minute_numeric="m",s.Minute_2Digit="mm",s.Second_numeric="s",s.Second_2Digit="ss",s.MiliSecond_3="SSS",s.DayOfMonth_numeric="d",s.DayOfMonth_2Digit="dd",s.DayOfMonth_withOrdinal="do",s.DayOfWeek_narrow="eeeee",s.DayOfWeek_long="eeee",s.DayOfWeek_short="eee"})(Vn||(Vn={}));function h8(s){if(!s)return ys.Sunday;const n=new Intl.Locale(s);return((n.weekInfo??n.getWeekInfo?.())?.firstDay??0)%7}const d8={locale:"en",dictionary:{Ok:"Ok",Cancel:"Cancel",Date:{Start:"Start",End:"End",Empty:"Empty",Day:"Day",DayTime:"Day Time",Time:"Time",Week:"Week",BiWeek:"Bi-Week",Month:"Month",Quarter:"Quarter",CalendarYear:"Calendar Year",FiscalYearOct:"Fiscal Year (Oct)",PeriodDay:{Current:"Today",Last:"Yesterday",LastX:"Last {0} days"},PeriodWeek:{Current:"This week",Last:"Last week",LastX:"Last {0} weeks"},PeriodBiWeek:{Current:"This bi-week",Last:"Last bi-week",LastX:"Last {0} bi-weeks"},PeriodMonth:{Current:"This month",Last:"Last month",LastX:"Last {0} months"},PeriodQuarter:{Current:"This quarter",Last:"Last quarter",LastX:"Last {0} quarters"},PeriodQuarterSameLastyear:"Same quarter last year",PeriodYear:{Current:"This year",Last:"Last year",LastX:"Last {0} years"},PeriodFiscalYear:{Current:"This fiscal year",Last:"Last fiscal year",LastX:"Last {0} fiscal years"}}},formats:{numbers:{defaults:{currency:"USD",fractionDigits:2,currencyDisplay:"symbol"}},dates:{baseParsing:"MM/dd/yyyy",weekStartsOn:ys.Sunday,ordinalSuffixes:{one:"st",two:"nd",few:"rd",other:"th"},presets:{day:{short:[Vn.DayOfMonth_numeric,Vn.Month_numeric],default:[Vn.DayOfMonth_numeric,Vn.Month_numeric,Vn.Year_numeric],long:[Vn.DayOfMonth_numeric,Vn.Month_short,Vn.Year_numeric]},dayTime:{short:[Vn.DayOfMonth_numeric,Vn.Month_numeric,Vn.Year_numeric,Vn.Hour_numeric,Vn.Minute_numeric],default:[Vn.DayOfMonth_numeric,Vn.Month_numeric,Vn.Year_numeric,Vn.Hour_2Digit,Vn.Minute_2Digit],long:[Vn.DayOfMonth_numeric,Vn.Month_numeric,Vn.Year_numeric,Vn.Hour_2Digit,Vn.Minute_2Digit,Vn.Second_2Digit]},timeOnly:{short:[Vn.Hour_numeric,Vn.Minute_numeric],default:[Vn.Hour_2Digit,Vn.Minute_2Digit,Vn.Second_2Digit],long:[Vn.Hour_2Digit,Vn.Minute_2Digit,Vn.Second_2Digit,Vn.MiliSecond_3]},week:{short:[Vn.DayOfMonth_numeric,Vn.Month_numeric],default:[Vn.DayOfMonth_numeric,Vn.Month_numeric,Vn.Year_numeric],long:[Vn.DayOfMonth_numeric,Vn.Month_numeric,Vn.Year_numeric]},month:{short:Vn.Month_short,default:Vn.Month_long,long:[Vn.Month_long,Vn.Year_numeric]},monthsYear:{short:[Vn.Month_short,Vn.Year_2Digit],default:[Vn.Month_long,Vn.Year_numeric],long:[Vn.Month_long,Vn.Year_numeric]},year:{short:Vn.Year_2Digit,default:Vn.Year_numeric,long:Vn.Year_numeric}}}}};function f8(s,n=d8){return s.formats?.dates?.ordinalSuffixes&&(s.formats.dates.ordinalSuffixes={one:"",two:"",few:"",other:"",zero:"",many:"",...s.formats.dates.ordinalSuffixes}),s.formats?.dates?.weekStartsOn===void 0&&(s=oC(s,{formats:{dates:{weekStartsOn:h8(s.locale)}}})),oC(s,n)}const _C=f8({locale:"en"});function p8(s){const n=Dz(qz).find(c=>c[1]===s);return parseInt(String(n?.[0]??"0"))}function m8(s=new Date,n){return s===null?NaN:s.getMonth()>=10-1?s.getFullYear()+1:s.getFullYear()}const g8=[new Date("1799-12-22T00:00"),new Date("1799-12-15T00:00")];function Hz(s,n,c){var m=g8[n-1],_=f2("day",m,c),x=Math.floor(E8("day",_,s)/14);return f2("day",_,x*14)}function _8(s,n,c){return f2("day",Hz(s,n,c),13)}function y8(s,n){switch(n){case ys.Sunday:return ju(hd,s);case ys.Monday:return ju(fp,s);case ys.Tuesday:return ju(LT,s);case ys.Wednesday:return ju(OT,s);case ys.Thursday:return ju(Ju,s);case ys.Friday:return ju(FT,s);case ys.Saturday:return ju(BT,s)}}function v8(s,n){switch(n){case ys.Sunday:return Gu(hd,s);case ys.Monday:return Gu(fp,s);case ys.Tuesday:return Gu(LT,s);case ys.Wednesday:return Gu(OT,s);case ys.Thursday:return Gu(Ju,s);case ys.Friday:return Gu(FT,s);case ys.Saturday:return Gu(BT,s)}}function Va(s,n,c){const{locale:m,formats:{dates:{ordinalSuffixes:_}}}=s;function x(I,k=!1){if(k){const P=new Intl.PluralRules(m,{type:"ordinal"});return I.formatToParts(n).map(F=>{if(F.type==="day"){const V=P.select(parseInt(F.value,10)),W=_[V];return`${F.value}${W}`}return F.value}).join("")}return I.format(n)}if(typeof c!="string"&&!Array.isArray(c))return x(new Intl.DateTimeFormat(m,c),c.withOrdinal);const T=Array.isArray(c)?c.join(""):c,r=new Intl.DateTimeFormat(m,{year:T.includes(Vn.Year_numeric)?"numeric":T.includes(Vn.Year_2Digit)?"2-digit":void 0,month:T.includes(Vn.Month_long)?"long":T.includes(Vn.Month_short)?"short":T.includes(Vn.Month_2Digit)?"2-digit":T.includes(Vn.Month_numeric)?"numeric":void 0,day:T.includes(Vn.DayOfMonth_2Digit)?"2-digit":T.includes(Vn.DayOfMonth_numeric)?"numeric":void 0,hour:T.includes(Vn.Hour_2Digit)?"2-digit":T.includes(Vn.Hour_numeric)?"numeric":void 0,hour12:T.includes(Vn.Hour_woAMPM)?!1:T.includes(Vn.Hour_wAMPM)?!0:void 0,minute:T.includes(Vn.Minute_2Digit)?"2-digit":T.includes(Vn.Minute_numeric)?"numeric":void 0,second:T.includes(Vn.Second_2Digit)?"2-digit":T.includes(Vn.Second_numeric)?"numeric":void 0,fractionalSecondDigits:T.includes(Vn.MiliSecond_3)?3:void 0,weekday:T.includes(Vn.DayOfWeek_narrow)?"narrow":T.includes(Vn.DayOfWeek_long)?"long":T.includes(Vn.DayOfWeek_short)?"short":void 0});return x(r,T.includes(Vn.DayOfMonth_withOrdinal))}function qo(s,n,c,m,_=void 0){const x=_===void 0?y8(n,c):Hz(n,_,c),T=_===void 0?v8(n,c):_8(n,_,c);return Va(s,x,m)+" - "+Va(s,T,m)}function x8(s,n){return n===In.Week?n=[In.WeekSun,In.WeekMon,In.WeekTue,In.WeekWed,In.WeekThu,In.WeekFri,In.WeekSat][s]:n===In.BiWeek1?n=[In.BiWeek1Sun,In.BiWeek1Mon,In.BiWeek1Tue,In.BiWeek1Wed,In.BiWeek1Thu,In.BiWeek1Fri,In.BiWeek1Sat][s]:n===In.BiWeek2&&(n=[In.BiWeek2Sun,In.BiWeek2Mon,In.BiWeek2Tue,In.BiWeek2Wed,In.BiWeek2Thu,In.BiWeek2Fri,In.BiWeek2Sat][s]),n}function b8(s,n,c,m={}){if(typeof n=="string"&&(n=d2(n)),n==null||isNaN(n))return"";const _=m.weekStartsOn??s.formats.dates.weekStartsOn,{day:x,dayTime:T,timeOnly:r,week:I,month:k,monthsYear:P,year:R}=s.formats.dates.presets;c=typeof c=="string"?p8(c):c??In.Day,c=x8(_,c)??c;function F(V){return m.variant==="custom"?m.custom??V.default:m.custom&&!m.variant?m.custom:V[m.variant??"default"]}switch(c){case In.Custom:return Va(s,n,m.custom);case In.Day:return Va(s,n,F(x));case In.DayTime:return Va(s,n,F(T));case In.TimeOnly:return Va(s,n,F(r));case In.Week:case In.WeekSun:return qo(s,n,0,F(I));case In.WeekMon:return qo(s,n,1,F(I));case In.WeekTue:return qo(s,n,2,F(I));case In.WeekWed:return qo(s,n,3,F(I));case In.WeekThu:return qo(s,n,4,F(I));case In.WeekFri:return qo(s,n,5,F(I));case In.WeekSat:return qo(s,n,6,F(I));case In.Month:return Va(s,n,F(k));case In.MonthYear:return Va(s,n,F(P));case In.Quarter:return[Va(s,ju("quarter",n),F(k)),Va(s,Gu("quarter",n),F(P))].join(" - ");case In.CalendarYear:return Va(s,n,F(R));case In.FiscalYearOctober:const V=new Date(m8(n),0,1);return Va(s,V,F(R));case In.BiWeek1:case In.BiWeek1Sun:return qo(s,n,0,F(I),1);case In.BiWeek1Mon:return qo(s,n,1,F(I),1);case In.BiWeek1Tue:return qo(s,n,2,F(I),1);case In.BiWeek1Wed:return qo(s,n,3,F(I),1);case In.BiWeek1Thu:return qo(s,n,4,F(I),1);case In.BiWeek1Fri:return qo(s,n,5,F(I),1);case In.BiWeek1Sat:return qo(s,n,6,F(I),1);case In.BiWeek2:case In.BiWeek2Sun:return qo(s,n,0,F(I),2);case In.BiWeek2Mon:return qo(s,n,1,F(I),2);case In.BiWeek2Tue:return qo(s,n,2,F(I),2);case In.BiWeek2Wed:return qo(s,n,3,F(I),2);case In.BiWeek2Thu:return qo(s,n,4,F(I),2);case In.BiWeek2Fri:return qo(s,n,5,F(I),2);case In.BiWeek2Sat:return qo(s,n,6,F(I),2);default:return n.toISOString()}}const w8=/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}(:\d{2}(\.\d+|)?(Z|(-|\+)\d{2}:\d{2}?)?)?)?$/;function VT(s){return w8.test(s)}function T8(s){return VT(s)&&s.includes("T")}function d2(s,n){if(!VT(s))return new Date("Invalid Date");if(T8(s))return new Date(s);const[c,m]=s.split("T"),[_,x,T]=c.split("-").map(Number);if(m){const[r,I,k]=m.split(":").map(Number);return new Date(_,x-1,T,r,I,k)}else return new Date(_,x-1,T)}const S8=ns(s=>{s.setMonth(s.getMonth()-s.getMonth()%3,1),s.setHours(0,0,0,0)},(s,n)=>s.setMonth(s.getMonth()+n*3,1),(s,n)=>(n.getTime()-s.getTime())/(1e3*60*60*24*30*3),s=>s.getMonth());function dx(s){switch(s){case"millisecond":return r_;case"second":return qu;case"minute":return ax;case"hour":return lx;case"day":return tc;case"week":return hd;case"month":return hx;case"quarter":return S8;case"year":return yl}}function ju(s,n){return s=typeof s=="string"?dx(s):s,n===void 0?c=>new Date(s.floor(c)):new Date(s.floor(n))}function Gu(s,n){return s=typeof s=="string"?dx(s):s,n===void 0?c=>new Date(s.offset(s.floor(c),1).getTime()-1):new Date(s.offset(s.floor(n),1).getTime()-1)}function f2(s,n,c){return s=typeof s=="string"?dx(s):s,s.offset(n,c)}function E8(s,n,c){return s=typeof s=="string"?dx(s):s,n===void 0||c===void 0?(m,_)=>s.count(m,_):s.count(n,c)}function jc(s,n){if(n||(n=s.currentTarget??s.target),!n||!s)return{x:0,y:0};const c=A8(s),m=a8(n)?n.ownerSVGElement:n,_=c8(m)?m.getScreenCTM():null;if(l8(m)&&_){let T=m.createSVGPoint();return T.x=c.x,T.y=c.y,T=T.matrixTransform(_.inverse()),{x:T.x,y:T.y}}const x=n.getBoundingClientRect();return{x:c.x-x.left-n.clientLeft,y:c.y-x.top-n.clientTop}}function A8(s){return s?u8(s)?s.changedTouches.length>0?{x:s.changedTouches[0].clientX,y:s.changedTouches[0].clientY}:{x:0,y:0}:{x:s.clientX,y:s.clientY}:{x:0,y:0}}var yC;(function(s){s[s.Year=0]="Year",s[s.Day=1]="Day",s[s.Hour=2]="Hour",s[s.Minute=3]="Minute",s[s.Second=4]="Second",s[s.Millisecond=5]="Millisecond"})(yC||(yC={}));class Oc{#t=0;#e=0;#i=0;#n=0;#r=0;#o=0;constructor(n={}){const c=typeof n.start=="string"?d2(n.start):n.start,m=typeof n.end=="string"?d2(n.end):n.end,_=c?Math.abs(Number(m||new Date)-Number(c)):void 0;if(!(!Number.isFinite(_)&&n.duration==null)){if(this.#t=n.duration?.milliseconds??_??0,this.#e=n.duration?.seconds??0,this.#i=n.duration?.minutes??0,this.#n=n.duration?.hours??0,this.#r=n.duration?.days??0,this.#o=n.duration?.years??0,this.#t>=1e3){const x=(this.#t-this.#t%1e3)/1e3;this.#e+=x,this.#t=this.#t-x*1e3}if(this.#e>=60){const x=(this.#e-this.#e%60)/60;this.#i+=x,this.#e=this.#e-x*60}if(this.#i>=60){const x=(this.#i-this.#i%60)/60;this.#n+=x,this.#i=this.#i-x*60}if(this.#n>=24){const x=(this.#n-this.#n%24)/24;this.#r+=x,this.#n=this.#n-x*24}if(this.#r>=365){const x=(this.#r-this.#r%365)/365;this.#o+=x,this.#r=this.#r-x*365}}}get years(){return this.#o}get days(){return this.#r}get hours(){return this.#n}get minutes(){return this.#i}get seconds(){return this.#e}get milliseconds(){return this.#t}valueOf(){return this.#t+this.#e*1e3+this.#i*60*1e3+this.#n*60*60*1e3+this.#r*24*60*60*1e3+this.#o*365*24*60*60*1e3}toJSON(){return{years:this.#o,days:this.#r,hours:this.#n,minutes:this.#i,seconds:this.#e,milliseconds:this.#t}}format(n={}){const{minUnits:c,totalUnits:m=99,variant:_="short"}=n;var x=[],T=_==="short"?["y","d","h","m","s","ms"]:["years","days","hours","minutes","seconds","milliseconds"],r=[this.years,this.days,this.hours,this.minutes,this.seconds,this.milliseconds].filter((P,R)=>R<=(c??99));for(var I in r){if(x.length>=m)break;const P=r[I];let R=T[I];if(P!==0||x.length===0&&Number(I)===r.length-1)switch(_){case"short":x.push(P+R);break;case"long":P===1&&(R=R.slice(0,-1)),x.push(P+" "+R);break}}return x.join(_==="long"?" and ":" ")}toString(){return this.format()}}function I8(s,n){const{numbers:c}=s.formats,m=n&&n!="none"?c[n]:{};return{...c.defaults,...m}}function M8(s,n,c,m={}){if(n==null)return"";if(c==="none")return`${n}`;c==null&&(c=Number.isInteger(n)?"integer":"decimal");const _=I8(s,c),T=Intl.NumberFormat(s.locale,{..._,...c!=="default"&&{style:c},minimumFractionDigits:m.fractionDigits??_.fractionDigits,maximumFractionDigits:m.fractionDigits??_.fractionDigits,...Kj(m),...c==="currencyRound"&&{style:"currency",minimumFractionDigits:0,maximumFractionDigits:0},...c==="percentRound"&&{style:"percent",minimumFractionDigits:0,maximumFractionDigits:0},...c==="metric"&&{style:"decimal",notation:"compact",minimumFractionDigits:0},...c==="integer"&&{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}}).format(n);let r=m.suffix??"";return r&&Math.abs(n)>=2&&m.suffixExtraIfMany!==""&&(r+=m.suffixExtraIfMany??"s"),`${T}${r}`}function aa(s,n,c){return s<n?n:s>c?c:s}function Jr(s,n,c){return n&&typeof n=="object"&&"type"in n?vC(_C,s,n.type,n.options):vC(_C,s,n,c)}function vC(s,n,c,m){const _=c&&typeof c=="object"&&"type"in c?c.type:c,x=c&&typeof c=="object"&&"type"in c&&"options"in c?c.options:m;return typeof _=="function"?_(n):n instanceof Date||VT(n)||_&&(_ in In||Object.values(qz).includes(_))?b8(s,n,_,x):typeof n=="number"?M8(s,n,_,x):typeof n=="string"?n:n==null?"":`${n}`}const C8=typeof window<"u",xC=["TRACE","DEBUG","INFO","WARN","ERROR"];class Zz{name;constructor(n){this.name=n}trace(...n){this.log("TRACE",...n)}debug(...n){this.log("DEBUG",...n)}info(...n){this.log("INFO",...n)}warn(...n){this.log("WARN",...n)}error(...n){this.log("ERROR",...n)}log(n,...c){const _=(C8?localStorage.getItem("logger")?.split(",").map(T=>T.split(":"))??[]:[]).find(T=>T[0]===this.name);if(_!=null&&xC.indexOf(n)>=xC.indexOf(_[1]??"DEBUG"))switch(n){case"TRACE":console.trace(`%c${this.name} %c${n}`,"color: hsl(200deg, 10%, 50%)","color: hsl(200deg, 40%, 50%)",...c);break;case"DEBUG":console.log(`%c${this.name} %c${n}`,"color: hsl(200deg, 10%, 50%)","color: hsl(200deg, 40%, 50%)",...c);break;case"INFO":console.log(`%c${this.name} %c${n}`,"color: hsl(200deg, 10%, 50%)","color: hsl(60deg, 100%, 50%)",...c);break;case"WARN":console.warn(`%c${this.name} %c${n}`,"color: hsl(200deg, 10%, 50%)","color: hsl(30deg, 100%, 50%)",...c);break;case"ERROR":console.warn(`%c${this.name} %c${n}`,"color: hsl(200deg, 10%, 50%)","color: hsl(0deg, 100%, 50%)",...c);break}}}function Ob(s,n="asc"){const c=n==="asc"?1:-1;return(m,_)=>{const x=Zj(s),T=x(m),r=x(_);return T==null||r==null?T==null&&r!=null?-c:T!=null&&r==null?c:0:T<r?-c:T>r?c:0}}[...n_(100,1e3,100)];const P8=nz({extend:{classGroups:{shadow:["shadow-border-l","shadow-border-r","shadow-border-t","shadow-border-b","elevation-none",...n_(1,25).map(s=>`elevation-${s}`)]}}}),En=(...s)=>P8(Hg(...s));class k8{width(n){return new cl(`(min-width: ${n}px)`)}height(n){return new cl(`(min-height: ${n}px)`)}smScreen=this.width(640);mdScreen=this.width(768);lgScreen=this.width(1024);xlScreen=this.width(1280);xxlScreen=this.width(1536);screen=new cl("screen and (min-width: 0)");print=new cl("print and (min-width: 0)");dark=new cl("(prefers-color-scheme: dark)");light=new cl("(prefers-color-scheme: light)");motion=new cl("(prefers-reduced-motion: no-preference)");motionReduce=new cl("(prefers-reduced-motion: reduce)");landscape=new cl("(orientation: landscape)");portrait=new cl("(orientation: portrait)")}class R8{#t;current;constructor(n){this.#t=n??[],this.current=new c0(n??[])}clear(){this.current.clear()}reset(){this.clear(),this.addEach(this.#t)}add(n){this.current.add(n)}addEach(n){for(const c of n)this.current.add(c)}delete(n){this.current.delete(n)}toggle(n){this.current.has(n)?this.current.delete(n):this.current.add(n)}}class bC{#t;#e;all;single;max;constructor(n={}){this.#t=n.initial??[],this.#e=new R8(this.#t),this.all=n.all??[],this.single=n.single??!1,this.max=n.max}get current(){return this.single?Array.from(this.#e.current)[0]??null:Array.from(this.#e.current)}set current(n){if(Array.isArray(n))if(this.max==null||n.length<this.max)this.#e.clear(),this.#e.addEach(n);else throw new Error(`Too many values selected.  Current: ${n.length}, max: ${this.max}`);else n!=null?(this.#e.clear(),this.#e.add(n)):this.#e.clear()}isSelected(n){return this.#e.current.has(n)}isEmpty(){return this.#e.current.size===0}isAllSelected(){return this.all.every(n=>this.#e.current.has(n))}isAnySelected(){return this.all.some(n=>this.#e.current.has(n))}isMaxSelected(){return this.max!=null?this.#e.current.size>=this.max:!1}isDisabled(n){return!this.isSelected(n)&&this.isMaxSelected()}clear(){this.#e.clear()}reset(){this.#e.reset()}toggle(n){if(this.#e.current.has(n)){const c=[...this.#e.current];this.#e.clear(),this.#e.addEach(c.filter(m=>m!=n))}else if(this.single)this.#e.clear(),this.#e.add(n);else if(this.max==null||this.#e.current.size<this.max)return this.#e.add(n)}toggleAll(){let n;this.isAllSelected()?n=[...this.#e.current].filter(c=>!this.all.includes(c)):n=[...this.#e.current,...this.all],this.#e.clear(),this.#e.addEach(n)}}function _0(s){return Object.prototype.toString.call(s)==="[object Date]"}function p2(s,n,c,m){if(typeof c=="number"||_0(c)){const _=m-c,x=(c-n)/(s.dt||1/60),T=s.opts.stiffness*_,r=s.opts.damping*x,I=(T-r)*s.inv_mass,k=(x+I)*s.dt;return Math.abs(k)<s.opts.precision&&Math.abs(_)<s.opts.precision?m:(s.settled=!1,_0(c)?new Date(c.getTime()+k):c+k)}else{if(Array.isArray(c))return c.map((_,x)=>p2(s,n[x],c[x],m[x]));if(typeof c=="object"){const _={};for(const x in c)_[x]=p2(s,n[x],c[x],m[x]);return _}else throw new Error(`Cannot spring ${typeof c} values`)}}class UT{#t=Mn(.15);#e=Mn(.8);#i=Mn(.01);#n;#r;#o=void 0;#s=0;#a=1;#l=0;#c=null;#u=null;constructor(n,c={}){this.#n=Mn(n),this.#r=Mn(n),typeof c.stiffness=="number"&&(this.#t.v=kv(c.stiffness,0,1)),typeof c.damping=="number"&&(this.#e.v=kv(c.damping,0,1)),typeof c.precision=="number"&&(this.#i.v=c.precision)}static of(n,c){const m=new UT(n(),c);return $0(()=>{m.set(n())}),m}#h(n){if(rn(this.#r,n),this.#n.v??=n,this.#o??=this.#n.v,!this.#c){this.#s=hl.now();var c=1e3/(this.#l*60);this.#c??=rT(m=>{this.#a=Math.min(this.#a+c,1);const _=Math.min(m-this.#s,1e3/30),x={inv_mass:this.#a,opts:{stiffness:this.#t.v,damping:this.#e.v,precision:this.#i.v},settled:!0,dt:_*60/1e3};var T=p2(x,this.#o,this.#n.v,this.#r.v);return this.#o=this.#n.v,this.#s=m,rn(this.#n,T),x.settled&&(this.#c=null),!x.settled})}return this.#c.promise}set(n,c){if(this.#u?.reject(new Error("Aborted")),c?.instant||this.#n.v===void 0)return this.#c?.abort(),this.#c=null,rn(this.#n,rn(this.#r,n)),this.#o=n,Promise.resolve();c?.preserveMomentum&&(this.#a=0,this.#l=c.preserveMomentum);var m=this.#u=EB();return m.promise.catch(Si),this.#h(n).then(()=>{m===this.#u&&m.resolve(void 0)}),m.promise}get current(){return A(this.#n)}get damping(){return A(this.#e)}set damping(n){rn(this.#e,kv(n,0,1))}get precision(){return A(this.#i)}set precision(n){rn(this.#i,n)}get stiffness(){return A(this.#t)}set stiffness(n){rn(this.#t,kv(n,0,1))}get target(){return A(this.#r)}set target(n){this.set(n)}}function kv(s,n,c){return Math.max(n,Math.min(c,s))}function z8(s){return s}function D8(s){return s<.5?4*s*s*s:.5*Math.pow(2*s-2,3)+1}function Xz(s){return s*s*s}function m2(s,n){if(s===n||s!==s)return()=>s;const c=typeof s;if(c!==typeof n||Array.isArray(s)!==Array.isArray(n))throw new Error("Cannot interpolate values of different type");if(Array.isArray(s)){const m=n.map((_,x)=>m2(s[x],_));return _=>m.map(x=>x(_))}if(c==="object"){if(!s||!n)throw new Error("Object cannot be null");if(_0(s)&&_0(n)){const x=s.getTime(),r=n.getTime()-x;return I=>new Date(x+I*r)}const m=Object.keys(n),_={};return m.forEach(x=>{_[x]=m2(s[x],n[x])}),x=>{const T={};return m.forEach(r=>{T[r]=_[r](x)}),T}}if(c==="number"){const m=n-s;return _=>s+_*m}return()=>n}class jT{#t;#e;#i;#n=null;constructor(n,c={}){this.#t=Mn(n),this.#e=Mn(n),this.#i=c}static of(n,c){const m=new jT(n(),c);return $0(()=>{m.set(n())}),m}set(n,c){rn(this.#e,n);let{delay:m=0,duration:_=400,easing:x=z8,interpolate:T=m2}={...this.#i,...c};if(_===0)return this.#n?.abort(),rn(this.#t,n),Promise.resolve();const r=hl.now()+m;let I,k=!1,P=this.#n;return this.#n=rT(R=>{if(R<r)return!0;if(!k){k=!0;const V=this.#t.v;I=T(V,n),typeof _=="function"&&(_=_(V,n)),P?.abort()}const F=R-r;return F>_?(rn(this.#t,n),!1):(rn(this.#t,I(x(F/_))),!0)}),this.#n.promise}get current(){return A(this.#t)}get target(){return A(this.#e)}set target(n){this.set(n)}}class L8 extends UT{type="spring";constructor(n,c){super(n,c)}}class O8 extends jT{type="tween";constructor(n,c){super(n,c)}}class F8{type="none";#t=Mn(null);#e=Mn(null);constructor(n,c={}){rn(this.#t,n,!0),rn(this.#e,n,!0)}set(n,c={}){return rn(this.#t,n,!0),rn(this.#e,n,!0),Promise.resolve()}get current(){return A(this.#t)}get target(){return A(this.#e)}set target(n){this.set(n)}}function B8(s,n,c){c.controlled||Os(()=>{s.set(n())})}function Vo(s,n,c,m={}){const _=Hu(c),x=_.type==="spring"?new L8(s,_.options):_.type==="tween"?new O8(s,_.options):new F8(s);return B8(x,n,m),x}function g2(s,n){return Vo(s,()=>s,n,{controlled:!0})}function wC(){let s=0,n=Mn(!1);function c(m){if(s+=1,!m){rn(n,!1);return}let _=s;rn(n,!0),m.then(()=>{_===s&&rn(n,!1)}).catch(()=>{})}return{handle:c,get current(){return A(n)}}}function Ip(s){const n=Hu(s);if(n.type==="tween")return n}function Hu(s,n){if(typeof s=="object"&&"type"in s&&"options"in s)return typeof s.options=="object"?s:{type:s.type,options:{}};if(s===void 0)return{type:"none",options:{}};if(typeof s=="string")return s==="spring"?{type:"spring",options:{}}:s==="tween"?{type:"tween",options:{}}:{type:"none",options:{}};if(typeof s=="object"&&"type"in s)if(s.type==="spring"){const{type:c,...m}=s;return{type:"spring",options:m}}else if(s.type==="tween"){const{type:c,...m}=s;return{type:"tween",options:m}}else return{type:"none",options:{}};if(n){const c=s[n];if(c!==void 0)return Hu(c)}return{type:"none",options:{}}}function Zr(s){return Array.isArray(s)?n=>s.map(c=>Zr(c)(n)):typeof s=="function"?s:typeof s=="string"||typeof s=="number"?n=>Cz(n,s):n=>n}function e0(s){return s==null?[]:Array.isArray(s)?s:"nodes"in s?s.nodes:"descendants"in s?s.descendants():[]}function N8(s=!0,n=!1){if(s!==!1)return{top:s===!0||s==="y"?4:0,left:s===!0||s==="y"?20:0,bottom:(s===!0||s==="x"?20:0)+(n===!0?32:0),right:s===!0||s==="x"?4:0}}function b_(s,n,c){return s.find(m=>c(m)?.valueOf()===c(n)?.valueOf())}const V8=s=>s;function U8(s){return s<.5?4*s*s*s:.5*Math.pow(2*s-2,3)+1}function GT(s,{delay:n=0,duration:c=400,easing:m=V8}={}){const _=+getComputedStyle(s).opacity;return{delay:n,duration:c,easing:m,css:x=>`opacity: ${x*_}`}}function j8(s,{delay:n=0,speed:c,duration:m,easing:_=U8}={}){let x=s.getTotalLength();const T=getComputedStyle(s);return T.strokeLinecap!=="butt"&&(x+=parseInt(T.strokeWidth)),m===void 0?c===void 0?m=800:m=x/c:typeof m=="function"&&(m=m(x)),{delay:n,duration:m,easing:_,css:(r,I)=>`
			stroke-dasharray: ${x};
			stroke-dashoffset: ${I*x};
		`}}function eo(s){return function(){return s}}const TC=Math.abs,zs=Math.atan2,Zh=Math.cos,G8=Math.max,Fb=Math.min,Kl=Math.sin,rp=Math.sqrt,ca=1e-12,o_=Math.PI,y0=o_/2,W8=2*o_;function q8(s){return s>1?0:s<-1?o_:Math.acos(s)}function SC(s){return s>=1?y0:s<=-1?-y0:Math.asin(s)}const _2=Math.PI,y2=2*_2,Xh=1e-6,H8=y2-Xh;function Yz(s){this._+=s[0];for(let n=1,c=s.length;n<c;++n)this._+=arguments[n]+s[n]}function Z8(s){let n=Math.floor(s);if(!(n>=0))throw new Error(`invalid digits: ${s}`);if(n>15)return Yz;const c=10**n;return function(m){this._+=m[0];for(let _=1,x=m.length;_<x;++_)this._+=Math.round(arguments[_]*c)/c+m[_]}}let WT=class{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?Yz:Z8(n)}moveTo(n,c){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+c}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,c){this._append`L${this._x1=+n},${this._y1=+c}`}quadraticCurveTo(n,c,m,_){this._append`Q${+n},${+c},${this._x1=+m},${this._y1=+_}`}bezierCurveTo(n,c,m,_,x,T){this._append`C${+n},${+c},${+m},${+_},${this._x1=+x},${this._y1=+T}`}arcTo(n,c,m,_,x){if(n=+n,c=+c,m=+m,_=+_,x=+x,x<0)throw new Error(`negative radius: ${x}`);let T=this._x1,r=this._y1,I=m-n,k=_-c,P=T-n,R=r-c,F=P*P+R*R;if(this._x1===null)this._append`M${this._x1=n},${this._y1=c}`;else if(F>Xh)if(!(Math.abs(R*I-k*P)>Xh)||!x)this._append`L${this._x1=n},${this._y1=c}`;else{let V=m-T,W=_-r,G=I*I+k*k,K=V*V+W*W,Y=Math.sqrt(G),ne=Math.sqrt(F),oe=x*Math.tan((_2-Math.acos((G+F-K)/(2*Y*ne)))/2),ce=oe/ne,me=oe/Y;Math.abs(ce-1)>Xh&&this._append`L${n+ce*P},${c+ce*R}`,this._append`A${x},${x},0,0,${+(R*V>P*W)},${this._x1=n+me*I},${this._y1=c+me*k}`}}arc(n,c,m,_,x,T){if(n=+n,c=+c,m=+m,T=!!T,m<0)throw new Error(`negative radius: ${m}`);let r=m*Math.cos(_),I=m*Math.sin(_),k=n+r,P=c+I,R=1^T,F=T?_-x:x-_;this._x1===null?this._append`M${k},${P}`:(Math.abs(this._x1-k)>Xh||Math.abs(this._y1-P)>Xh)&&this._append`L${k},${P}`,m&&(F<0&&(F=F%y2+y2),F>H8?this._append`A${m},${m},0,1,${R},${n-r},${c-I}A${m},${m},0,1,${R},${this._x1=k},${this._y1=P}`:F>Xh&&this._append`A${m},${m},0,${+(F>=_2)},${R},${this._x1=n+m*Math.cos(x)},${this._y1=c+m*Math.sin(x)}`)}rect(n,c,m,_){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+c}h${m=+m}v${+_}h${-m}Z`}toString(){return this._}};function Kz(){return new WT}Kz.prototype=WT.prototype;function qT(s){let n=3;return s.digits=function(c){if(!arguments.length)return n;if(c==null)n=null;else{const m=Math.floor(c);if(!(m>=0))throw new RangeError(`invalid digits: ${c}`);n=m}return s},()=>new WT(n)}function X8(s){return s.innerRadius}function Y8(s){return s.outerRadius}function K8(s){return s.startAngle}function J8(s){return s.endAngle}function Q8(s){return s&&s.padAngle}function $8(s,n,c,m,_,x,T,r){var I=c-s,k=m-n,P=T-_,R=r-x,F=R*I-P*k;if(!(F*F<ca))return F=(P*(n-x)-R*(s-_))/F,[s+F*I,n+F*k]}function Rv(s,n,c,m,_,x,T){var r=s-c,I=n-m,k=(T?x:-x)/rp(r*r+I*I),P=k*I,R=-k*r,F=s+P,V=n+R,W=c+P,G=m+R,K=(F+W)/2,Y=(V+G)/2,ne=W-F,oe=G-V,ce=ne*ne+oe*oe,me=_-x,ue=F*G-W*V,_e=(oe<0?-1:1)*rp(G8(0,me*me*ce-ue*ue)),te=(ue*oe-ne*_e)/ce,ie=(-ue*ne-oe*_e)/ce,xe=(ue*oe+ne*_e)/ce,de=(-ue*ne+oe*_e)/ce,Te=te-K,De=ie-Y,Be=xe-K,Se=de-Y;return Te*Te+De*De>Be*Be+Se*Se&&(te=xe,ie=de),{cx:te,cy:ie,x01:-P,y01:-R,x11:te*(_/me-1),y11:ie*(_/me-1)}}function s_(){var s=X8,n=Y8,c=eo(0),m=null,_=K8,x=J8,T=Q8,r=null,I=qT(k);function k(){var P,R,F=+s.apply(this,arguments),V=+n.apply(this,arguments),W=_.apply(this,arguments)-y0,G=x.apply(this,arguments)-y0,K=TC(G-W),Y=G>W;if(r||(r=P=I()),V<F&&(R=V,V=F,F=R),!(V>ca))r.moveTo(0,0);else if(K>W8-ca)r.moveTo(V*Zh(W),V*Kl(W)),r.arc(0,0,V,W,G,!Y),F>ca&&(r.moveTo(F*Zh(G),F*Kl(G)),r.arc(0,0,F,G,W,Y));else{var ne=W,oe=G,ce=W,me=G,ue=K,_e=K,te=T.apply(this,arguments)/2,ie=te>ca&&(m?+m.apply(this,arguments):rp(F*F+V*V)),xe=Fb(TC(V-F)/2,+c.apply(this,arguments)),de=xe,Te=xe,De,Be;if(ie>ca){var Se=SC(ie/F*Kl(te)),Ne=SC(ie/V*Kl(te));(ue-=Se*2)>ca?(Se*=Y?1:-1,ce+=Se,me-=Se):(ue=0,ce=me=(W+G)/2),(_e-=Ne*2)>ca?(Ne*=Y?1:-1,ne+=Ne,oe-=Ne):(_e=0,ne=oe=(W+G)/2)}var it=V*Zh(ne),qe=V*Kl(ne),ft=F*Zh(me),St=F*Kl(me);if(xe>ca){var Dt=V*Zh(oe),Kt=V*Kl(oe),et=F*Zh(ce),Qe=F*Kl(ce),st;if(K<o_)if(st=$8(it,qe,et,Qe,Dt,Kt,ft,St)){var tt=it-st[0],gt=qe-st[1],Lt=Dt-st[0],_t=Kt-st[1],Je=1/Kl(q8((tt*Lt+gt*_t)/(rp(tt*tt+gt*gt)*rp(Lt*Lt+_t*_t)))/2),Rt=rp(st[0]*st[0]+st[1]*st[1]);de=Fb(xe,(F-Rt)/(Je-1)),Te=Fb(xe,(V-Rt)/(Je+1))}else de=Te=0}_e>ca?Te>ca?(De=Rv(et,Qe,it,qe,V,Te,Y),Be=Rv(Dt,Kt,ft,St,V,Te,Y),r.moveTo(De.cx+De.x01,De.cy+De.y01),Te<xe?r.arc(De.cx,De.cy,Te,zs(De.y01,De.x01),zs(Be.y01,Be.x01),!Y):(r.arc(De.cx,De.cy,Te,zs(De.y01,De.x01),zs(De.y11,De.x11),!Y),r.arc(0,0,V,zs(De.cy+De.y11,De.cx+De.x11),zs(Be.cy+Be.y11,Be.cx+Be.x11),!Y),r.arc(Be.cx,Be.cy,Te,zs(Be.y11,Be.x11),zs(Be.y01,Be.x01),!Y))):(r.moveTo(it,qe),r.arc(0,0,V,ne,oe,!Y)):r.moveTo(it,qe),!(F>ca)||!(ue>ca)?r.lineTo(ft,St):de>ca?(De=Rv(ft,St,Dt,Kt,F,-de,Y),Be=Rv(it,qe,et,Qe,F,-de,Y),r.lineTo(De.cx+De.x01,De.cy+De.y01),de<xe?r.arc(De.cx,De.cy,de,zs(De.y01,De.x01),zs(Be.y01,Be.x01),!Y):(r.arc(De.cx,De.cy,de,zs(De.y01,De.x01),zs(De.y11,De.x11),!Y),r.arc(0,0,F,zs(De.cy+De.y11,De.cx+De.x11),zs(Be.cy+Be.y11,Be.cx+Be.x11),Y),r.arc(Be.cx,Be.cy,de,zs(Be.y11,Be.x11),zs(Be.y01,Be.x01),!Y))):r.arc(0,0,F,me,ce,Y)}if(r.closePath(),P)return r=null,P+""||null}return k.centroid=function(){var P=(+s.apply(this,arguments)+ +n.apply(this,arguments))/2,R=(+_.apply(this,arguments)+ +x.apply(this,arguments))/2-o_/2;return[Zh(R)*P,Kl(R)*P]},k.innerRadius=function(P){return arguments.length?(s=typeof P=="function"?P:eo(+P),k):s},k.outerRadius=function(P){return arguments.length?(n=typeof P=="function"?P:eo(+P),k):n},k.cornerRadius=function(P){return arguments.length?(c=typeof P=="function"?P:eo(+P),k):c},k.padRadius=function(P){return arguments.length?(m=P==null?null:typeof P=="function"?P:eo(+P),k):m},k.startAngle=function(P){return arguments.length?(_=typeof P=="function"?P:eo(+P),k):_},k.endAngle=function(P){return arguments.length?(x=typeof P=="function"?P:eo(+P),k):x},k.padAngle=function(P){return arguments.length?(T=typeof P=="function"?P:eo(+P),k):T},k.context=function(P){return arguments.length?(r=P??null,k):r},k}function HT(s){return typeof s=="object"&&"length"in s?s:Array.from(s)}function Jz(s){this._context=s}Jz.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(s,n){switch(s=+s,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(s,n):this._context.moveTo(s,n);break;case 1:this._point=2;default:this._context.lineTo(s,n);break}}};function fx(s){return new Jz(s)}function Qz(s){return s[0]}function $z(s){return s[1]}function a_(s,n){var c=eo(!0),m=null,_=fx,x=null,T=qT(r);s=typeof s=="function"?s:s===void 0?Qz:eo(s),n=typeof n=="function"?n:n===void 0?$z:eo(n);function r(I){var k,P=(I=HT(I)).length,R,F=!1,V;for(m==null&&(x=_(V=T())),k=0;k<=P;++k)!(k<P&&c(R=I[k],k,I))===F&&((F=!F)?x.lineStart():x.lineEnd()),F&&x.point(+s(R,k,I),+n(R,k,I));if(V)return x=null,V+""||null}return r.x=function(I){return arguments.length?(s=typeof I=="function"?I:eo(+I),r):s},r.y=function(I){return arguments.length?(n=typeof I=="function"?I:eo(+I),r):n},r.defined=function(I){return arguments.length?(c=typeof I=="function"?I:eo(!!I),r):c},r.curve=function(I){return arguments.length?(_=I,m!=null&&(x=_(m)),r):_},r.context=function(I){return arguments.length?(I==null?m=x=null:x=_(m=I),r):m},r}function v2(s,n,c){var m=null,_=eo(!0),x=null,T=fx,r=null,I=qT(k);s=typeof s=="function"?s:s===void 0?Qz:eo(+s),n=typeof n=="function"?n:eo(n===void 0?0:+n),c=typeof c=="function"?c:c===void 0?$z:eo(+c);function k(R){var F,V,W,G=(R=HT(R)).length,K,Y=!1,ne,oe=new Array(G),ce=new Array(G);for(x==null&&(r=T(ne=I())),F=0;F<=G;++F){if(!(F<G&&_(K=R[F],F,R))===Y)if(Y=!Y)V=F,r.areaStart(),r.lineStart();else{for(r.lineEnd(),r.lineStart(),W=F-1;W>=V;--W)r.point(oe[W],ce[W]);r.lineEnd(),r.areaEnd()}Y&&(oe[F]=+s(K,F,R),ce[F]=+n(K,F,R),r.point(m?+m(K,F,R):oe[F],c?+c(K,F,R):ce[F]))}if(ne)return r=null,ne+""||null}function P(){return a_().defined(_).curve(T).context(x)}return k.x=function(R){return arguments.length?(s=typeof R=="function"?R:eo(+R),m=null,k):s},k.x0=function(R){return arguments.length?(s=typeof R=="function"?R:eo(+R),k):s},k.x1=function(R){return arguments.length?(m=R==null?null:typeof R=="function"?R:eo(+R),k):m},k.y=function(R){return arguments.length?(n=typeof R=="function"?R:eo(+R),c=null,k):n},k.y0=function(R){return arguments.length?(n=typeof R=="function"?R:eo(+R),k):n},k.y1=function(R){return arguments.length?(c=R==null?null:typeof R=="function"?R:eo(+R),k):c},k.lineX0=k.lineY0=function(){return P().x(s).y(n)},k.lineY1=function(){return P().x(s).y(c)},k.lineX1=function(){return P().x(m).y(n)},k.defined=function(R){return arguments.length?(_=typeof R=="function"?R:eo(!!R),k):_},k.curve=function(R){return arguments.length?(T=R,x!=null&&(r=T(x)),k):T},k.context=function(R){return arguments.length?(R==null?x=r=null:r=T(x=R),k):x},k}var eD=ZT(fx);function tD(s){this._curve=s}tD.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(s,n){this._curve.point(n*Math.sin(s),n*-Math.cos(s))}};function ZT(s){function n(c){return new tD(s(c))}return n._curve=s,n}function Fg(s){var n=s.curve;return s.angle=s.x,delete s.x,s.radius=s.y,delete s.y,s.curve=function(c){return arguments.length?n(ZT(c)):n()._curve},s}function EC(){return Fg(a_().curve(eD))}function AC(){var s=v2().curve(eD),n=s.curve,c=s.lineX0,m=s.lineX1,_=s.lineY0,x=s.lineY1;return s.angle=s.x,delete s.x,s.startAngle=s.x0,delete s.x0,s.endAngle=s.x1,delete s.x1,s.radius=s.y,delete s.y,s.innerRadius=s.y0,delete s.y0,s.outerRadius=s.y1,delete s.y1,s.lineStartAngle=function(){return Fg(c())},delete s.lineX0,s.lineEndAngle=function(){return Fg(m())},delete s.lineX1,s.lineInnerRadius=function(){return Fg(_())},delete s.lineY0,s.lineOuterRadius=function(){return Fg(x())},delete s.lineY1,s.curve=function(T){return arguments.length?n(ZT(T)):n()._curve},s}function gl(s,n){return[(n=+n)*Math.cos(s-=Math.PI/2),n*Math.sin(s)]}class nD{constructor(n,c){this._context=n,this._x=c}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(n,c){switch(n=+n,c=+c,this._point){case 0:{this._point=1,this._line?this._context.lineTo(n,c):this._context.moveTo(n,c);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+n)/2,this._y0,this._x0,c,n,c):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+c)/2,n,this._y0,n,c);break}}this._x0=n,this._y0=c}}function eW(s){return new nD(s,!0)}function tW(s){return new nD(s,!1)}function IC(){}function iD(s){this._context=s}iD.prototype={areaStart:IC,areaEnd:IC,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(s,n){s=+s,n=+n,this._point?this._context.lineTo(s,n):(this._point=1,this._context.moveTo(s,n))}};function x2(s){return new iD(s)}function rD(s){this._context=s}rD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var s=this._x,n=this._y,c=s.length;if(c)if(this._line?this._context.lineTo(s[0],n[0]):this._context.moveTo(s[0],n[0]),c===2)this._context.lineTo(s[1],n[1]);else for(var m=MC(s),_=MC(n),x=0,T=1;T<c;++x,++T)this._context.bezierCurveTo(m[0][x],_[0][x],m[1][x],_[1][x],s[T],n[T]);(this._line||this._line!==0&&c===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(s,n){this._x.push(+s),this._y.push(+n)}};function MC(s){var n,c=s.length-1,m,_=new Array(c),x=new Array(c),T=new Array(c);for(_[0]=0,x[0]=2,T[0]=s[0]+2*s[1],n=1;n<c-1;++n)_[n]=1,x[n]=4,T[n]=4*s[n]+2*s[n+1];for(_[c-1]=2,x[c-1]=7,T[c-1]=8*s[c-1]+s[c],n=1;n<c;++n)m=_[n]/x[n-1],x[n]-=m,T[n]-=m*T[n-1];for(_[c-1]=T[c-1]/x[c-1],n=c-2;n>=0;--n)_[n]=(T[n]-_[n+1])/x[n];for(x[c-1]=(s[c]+_[c-1])/2,n=0;n<c-1;++n)x[n]=2*s[n+1]-_[n+1];return[_,x]}function nW(s){return new rD(s)}function v0(s,n){if((T=s.length)>1)for(var c=1,m,_,x=s[n[0]],T,r=x.length;c<T;++c)for(_=x,x=s[n[c]],m=0;m<r;++m)x[m][1]+=x[m][0]=isNaN(_[m][1])?_[m][0]:_[m][1]}function CC(s){for(var n=s.length,c=new Array(n);--n>=0;)c[n]=n;return c}function iW(s,n){return s[n]}function rW(s){const n=[];return n.key=s,n}function oW(){var s=eo([]),n=CC,c=v0,m=iW;function _(x){var T=Array.from(s.apply(this,arguments),rW),r,I=T.length,k=-1,P;for(const R of x)for(r=0,++k;r<I;++r)(T[r][k]=[0,+m(R,T[r].key,k,x)]).data=R;for(r=0,P=HT(n(T));r<I;++r)T[P[r]].index=r;return c(T,P),T}return _.keys=function(x){return arguments.length?(s=typeof x=="function"?x:eo(Array.from(x)),_):s},_.value=function(x){return arguments.length?(m=typeof x=="function"?x:eo(+x),_):m},_.order=function(x){return arguments.length?(n=x==null?CC:typeof x=="function"?x:eo(Array.from(x)),_):n},_.offset=function(x){return arguments.length?(c=x??v0,_):c},_}function sW(s,n){if((m=s.length)>0){for(var c,m,_=0,x=s[0].length,T;_<x;++_){for(T=c=0;c<m;++c)T+=s[c][_][1]||0;if(T)for(c=0;c<m;++c)s[c][_][1]/=T}v0(s,n)}}function aW(s,n){if((I=s.length)>0)for(var c,m=0,_,x,T,r,I,k=s[n[0]].length;m<k;++m)for(T=r=0,c=0;c<I;++c)(x=(_=s[n[c]][m])[1]-_[0])>0?(_[0]=T,_[1]=T+=x):x<0?(_[1]=r,_[0]=r+=x):(_[0]=0,_[1]=x)}function PC(s,n){var c=Object.keys(s);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(s);n&&(m=m.filter(function(_){return Object.getOwnPropertyDescriptor(s,_).enumerable})),c.push.apply(c,m)}return c}function lW(s){for(var n=1;n<arguments.length;n++){var c=arguments[n]!=null?arguments[n]:{};n%2?PC(Object(c),!0).forEach(function(m){cW(s,m,c[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(c)):PC(Object(c)).forEach(function(m){Object.defineProperty(s,m,Object.getOwnPropertyDescriptor(c,m))})}return s}function Yg(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Yg=function(n){return typeof n}:Yg=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Yg(s)}function cW(s,n,c){return n in s?Object.defineProperty(s,n,{value:c,enumerable:!0,configurable:!0,writable:!0}):s[n]=c,s}function x0(){return x0=Object.assign||function(s){for(var n=1;n<arguments.length;n++){var c=arguments[n];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(s[m]=c[m])}return s},x0.apply(this,arguments)}function uW(s,n){if(s){if(typeof s=="string")return kC(s,n);var c=Object.prototype.toString.call(s).slice(8,-1);if(c==="Object"&&s.constructor&&(c=s.constructor.name),c==="Map"||c==="Set")return Array.from(s);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return kC(s,n)}}function kC(s,n){(n==null||n>s.length)&&(n=s.length);for(var c=0,m=new Array(n);c<n;c++)m[c]=s[c];return m}function oD(s,n){var c=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!c){if(Array.isArray(s)||(c=uW(s))||n){c&&(s=c);var m=0,_=function(){};return{s:_,n:function(){return m>=s.length?{done:!0}:{done:!1,value:s[m++]}},e:function(I){throw I},f:_}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var x=!0,T=!1,r;return{s:function(){c=c.call(s)},n:function(){var I=c.next();return x=I.done,I},e:function(I){T=!0,r=I},f:function(){try{!x&&c.return!=null&&c.return()}finally{if(T)throw r}}}}function hW(s,n){var c=[],m=[];function _(x,T){if(x.length===1)c.push(x[0]),m.push(x[0]);else{for(var r=Array(x.length-1),I=0;I<r.length;I++)I===0&&c.push(x[0]),I===r.length-1&&m.push(x[I+1]),r[I]=[(1-T)*x[I][0]+T*x[I+1][0],(1-T)*x[I][1]+T*x[I+1][1]];_(r,T)}}return s.length&&_(s,n),{left:c,right:m.reverse()}}function dW(s){var n={};return s.length===4&&(n.x2=s[2][0],n.y2=s[2][1]),s.length>=3&&(n.x1=s[1][0],n.y1=s[1][1]),n.x=s[s.length-1][0],n.y=s[s.length-1][1],s.length===4?n.type="C":s.length===3?n.type="Q":n.type="L",n}function fW(s,n){n=n||2;for(var c=[],m=s,_=1/n,x=0;x<n-1;x++){var T=_/(1-_*x),r=hW(m,T);c.push(r.left),m=r.right}return c.push(m),c}function pW(s,n,c){var m=[[s.x,s.y]];return n.x1!=null&&m.push([n.x1,n.y1]),n.x2!=null&&m.push([n.x2,n.y2]),m.push([n.x,n.y]),fW(m,c).map(dW)}var mW=/[MLCSTQAHVZmlcstqahv]|-?[\d.e+-]+/g,ap={M:["x","y"],L:["x","y"],H:["x"],V:["y"],C:["x1","y1","x2","y2","x","y"],S:["x2","y2","x","y"],Q:["x1","y1","x","y"],T:["x","y"],A:["rx","ry","xAxisRotation","largeArcFlag","sweepFlag","x","y"],Z:[]};Object.keys(ap).forEach(function(s){ap[s.toLowerCase()]=ap[s]});function b2(s,n){for(var c=Array(s),m=0;m<s;m++)c[m]=n;return c}function gW(s){return"".concat(s.type).concat(ap[s.type].map(function(n){return s[n]}).join(","))}function _W(s,n){var c={x1:"x",y1:"y",x2:"x",y2:"y"},m=["xAxisRotation","largeArcFlag","sweepFlag"];if(s.type!==n.type&&n.type.toUpperCase()!=="M"){var _={};Object.keys(n).forEach(function(x){var T=n[x],r=s[x];r===void 0&&(m.includes(x)?r=T:(r===void 0&&c[x]&&(r=s[c[x]]),r===void 0&&(r=0))),_[x]=r}),_.type=n.type,s=_}return s}function yW(s,n,c){var m=[];if(n.type==="L"||n.type==="Q"||n.type==="C")m=m.concat(pW(s,n,c));else{var _=x0({},s);_.type==="M"&&(_.type="L"),m=m.concat(b2(c-1).map(function(){return _})),m.push(n)}return m}function RC(s,n,c){var m=s.length-1,_=n.length-1,x=m/_,T=b2(_).reduce(function(I,k,P){var R=Math.floor(x*P);if(c&&R<s.length-1&&c(s[R],s[R+1])){var F=x*P%1<.5;I[R]&&(F?R>0?R-=1:R<s.length-1&&(R+=1):R<s.length-1?R+=1:R>0&&(R-=1))}return I[R]=(I[R]||0)+1,I},[]),r=T.reduce(function(I,k,P){if(P===s.length-1){var R=b2(k,x0({},s[s.length-1]));return R[0].type==="M"&&R.forEach(function(F){F.type="L"}),I.concat(R)}return I.concat(yW(s[P],s[P+1],k))},[]);return r.unshift(s[0]),r}function zC(s){for(var n=(s||"").match(mW)||[],c=[],m,_,x=0;x<n.length;++x)if(m=ap[n[x]],m){_={type:n[x]};for(var T=0;T<m.length;++T)_[m[T]]=+n[x+T+1];x+=m.length,c.push(_)}return c}function vW(s,n,c){var m=s==null?[]:s.slice(),_=n==null?[]:n.slice(),x=Yg(c)==="object"?c:{excludeSegment:c,snapEndsToInput:!0},T=x.excludeSegment,r=x.snapEndsToInput;if(!m.length&&!_.length)return function(){return[]};var I=(m.length===0||m[m.length-1].type==="Z")&&(_.length===0||_[_.length-1].type==="Z");m.length>0&&m[m.length-1].type==="Z"&&m.pop(),_.length>0&&_[_.length-1].type==="Z"&&_.pop(),m.length?_.length||_.push(m[0]):m.push(_[0]);var k=Math.abs(_.length-m.length);k!==0&&(_.length>m.length?m=RC(m,_,T):_.length<m.length&&(_=RC(_,m,T))),m=m.map(function(R,F){return _W(R,_[F])});var P=m.map(function(R){return lW({},R)});return I&&(P.push({type:"Z"}),m.push({type:"Z"})),function(F){if(F===1&&r)return n??[];if(F===0)return m;for(var V=0;V<P.length;++V){var W=m[V],G=_[V],K=P[V],Y=oD(ap[K.type]),ne;try{for(Y.s();!(ne=Y.n()).done;){var oe=ne.value;K[oe]=(1-F)*W[oe]+F*G[oe],(oe==="largeArcFlag"||oe==="sweepFlag")&&(K[oe]=Math.round(K[oe]))}}catch(ce){Y.e(ce)}finally{Y.f()}}return P}}function XT(s,n,c){var m=zC(s),_=zC(n),x=Yg(c)==="object"?c:{excludeSegment:c,snapEndsToInput:!0},T=x.excludeSegment,r=x.snapEndsToInput;if(!m.length&&!_.length)return function(){return""};var I=vW(m,_,{excludeSegment:T,snapEndsToInput:r});return function(P){if(P===1&&r)return n??"";var R=I(P),F="",V=oD(R),W;try{for(V.s();!(W=V.n()).done;){var G=W.value;F+=gW(G)}}catch(K){V.e(K)}finally{V.f()}return F}}function Mp(s,n){switch(arguments.length){case 0:break;case 1:this.range(s);break;default:this.range(n).domain(s);break}return this}const DC=Symbol("implicit");function px(){var s=new WM,n=[],c=[],m=DC;function _(x){let T=s.get(x);if(T===void 0){if(m!==DC)return m;s.set(x,T=n.push(x)-1)}return c[T%c.length]}return _.domain=function(x){if(!arguments.length)return n.slice();n=[],s=new WM;for(const T of x)s.has(T)||s.set(T,n.push(T)-1);return _},_.range=function(x){return arguments.length?(c=Array.from(x),_):c.slice()},_.unknown=function(x){return arguments.length?(m=x,_):m},_.copy=function(){return px(n,c).unknown(m)},Mp.apply(_,arguments),_}function sD(){var s=px().unknown(void 0),n=s.domain,c=s.range,m=0,_=1,x,T,r=!1,I=0,k=0,P=.5;delete s.unknown;function R(){var F=n().length,V=_<m,W=V?_:m,G=V?m:_;x=(G-W)/Math.max(1,F-I+k*2),r&&(x=Math.floor(x)),W+=(G-W-x*(F-I))*P,T=x*(1-I),r&&(W=Math.round(W),T=Math.round(T));var K=n_(F).map(function(Y){return W+x*Y});return c(V?K.reverse():K)}return s.domain=function(F){return arguments.length?(n(F),R()):n()},s.range=function(F){return arguments.length?([m,_]=F,m=+m,_=+_,R()):[m,_]},s.rangeRound=function(F){return[m,_]=F,m=+m,_=+_,r=!0,R()},s.bandwidth=function(){return T},s.step=function(){return x},s.round=function(F){return arguments.length?(r=!!F,R()):r},s.padding=function(F){return arguments.length?(I=Math.min(1,k=+F),R()):I},s.paddingInner=function(F){return arguments.length?(I=Math.min(1,F),R()):I},s.paddingOuter=function(F){return arguments.length?(k=+F,R()):k},s.align=function(F){return arguments.length?(P=Math.max(0,Math.min(1,F)),R()):P},s.copy=function(){return sD(n(),[m,_]).round(r).paddingInner(I).paddingOuter(k).align(P)},Mp.apply(R(),arguments)}function YT(s,n,c){s.prototype=n.prototype=c,c.constructor=s}function aD(s,n){var c=Object.create(s.prototype);for(var m in n)c[m]=n[m];return c}function w_(){}var l_=.7,b0=1/l_,lp="\\s*([+-]?\\d+)\\s*",c_="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ic="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xW=/^#([0-9a-f]{3,8})$/,bW=new RegExp(`^rgb\\(${lp},${lp},${lp}\\)$`),wW=new RegExp(`^rgb\\(${ic},${ic},${ic}\\)$`),TW=new RegExp(`^rgba\\(${lp},${lp},${lp},${c_}\\)$`),SW=new RegExp(`^rgba\\(${ic},${ic},${ic},${c_}\\)$`),EW=new RegExp(`^hsl\\(${c_},${ic},${ic}\\)$`),AW=new RegExp(`^hsla\\(${c_},${ic},${ic},${c_}\\)$`),LC={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};YT(w_,u_,{copy(s){return Object.assign(new this.constructor,this,s)},displayable(){return this.rgb().displayable()},hex:OC,formatHex:OC,formatHex8:IW,formatHsl:MW,formatRgb:FC,toString:FC});function OC(){return this.rgb().formatHex()}function IW(){return this.rgb().formatHex8()}function MW(){return lD(this).formatHsl()}function FC(){return this.rgb().formatRgb()}function u_(s){var n,c;return s=(s+"").trim().toLowerCase(),(n=xW.exec(s))?(c=n[1].length,n=parseInt(n[1],16),c===6?BC(n):c===3?new ha(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):c===8?zv(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):c===4?zv(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=bW.exec(s))?new ha(n[1],n[2],n[3],1):(n=wW.exec(s))?new ha(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=TW.exec(s))?zv(n[1],n[2],n[3],n[4]):(n=SW.exec(s))?zv(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=EW.exec(s))?UC(n[1],n[2]/100,n[3]/100,1):(n=AW.exec(s))?UC(n[1],n[2]/100,n[3]/100,n[4]):LC.hasOwnProperty(s)?BC(LC[s]):s==="transparent"?new ha(NaN,NaN,NaN,0):null}function BC(s){return new ha(s>>16&255,s>>8&255,s&255,1)}function zv(s,n,c,m){return m<=0&&(s=n=c=NaN),new ha(s,n,c,m)}function CW(s){return s instanceof w_||(s=u_(s)),s?(s=s.rgb(),new ha(s.r,s.g,s.b,s.opacity)):new ha}function w0(s,n,c,m){return arguments.length===1?CW(s):new ha(s,n,c,m??1)}function ha(s,n,c,m){this.r=+s,this.g=+n,this.b=+c,this.opacity=+m}YT(ha,w0,aD(w_,{brighter(s){return s=s==null?b0:Math.pow(b0,s),new ha(this.r*s,this.g*s,this.b*s,this.opacity)},darker(s){return s=s==null?l_:Math.pow(l_,s),new ha(this.r*s,this.g*s,this.b*s,this.opacity)},rgb(){return this},clamp(){return new ha(nd(this.r),nd(this.g),nd(this.b),T0(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:NC,formatHex:NC,formatHex8:PW,formatRgb:VC,toString:VC}));function NC(){return`#${Qh(this.r)}${Qh(this.g)}${Qh(this.b)}`}function PW(){return`#${Qh(this.r)}${Qh(this.g)}${Qh(this.b)}${Qh((isNaN(this.opacity)?1:this.opacity)*255)}`}function VC(){const s=T0(this.opacity);return`${s===1?"rgb(":"rgba("}${nd(this.r)}, ${nd(this.g)}, ${nd(this.b)}${s===1?")":`, ${s})`}`}function T0(s){return isNaN(s)?1:Math.max(0,Math.min(1,s))}function nd(s){return Math.max(0,Math.min(255,Math.round(s)||0))}function Qh(s){return s=nd(s),(s<16?"0":"")+s.toString(16)}function UC(s,n,c,m){return m<=0?s=n=c=NaN:c<=0||c>=1?s=n=NaN:n<=0&&(s=NaN),new dl(s,n,c,m)}function lD(s){if(s instanceof dl)return new dl(s.h,s.s,s.l,s.opacity);if(s instanceof w_||(s=u_(s)),!s)return new dl;if(s instanceof dl)return s;s=s.rgb();var n=s.r/255,c=s.g/255,m=s.b/255,_=Math.min(n,c,m),x=Math.max(n,c,m),T=NaN,r=x-_,I=(x+_)/2;return r?(n===x?T=(c-m)/r+(c<m)*6:c===x?T=(m-n)/r+2:T=(n-c)/r+4,r/=I<.5?x+_:2-x-_,T*=60):r=I>0&&I<1?0:T,new dl(T,r,I,s.opacity)}function kW(s,n,c,m){return arguments.length===1?lD(s):new dl(s,n,c,m??1)}function dl(s,n,c,m){this.h=+s,this.s=+n,this.l=+c,this.opacity=+m}YT(dl,kW,aD(w_,{brighter(s){return s=s==null?b0:Math.pow(b0,s),new dl(this.h,this.s,this.l*s,this.opacity)},darker(s){return s=s==null?l_:Math.pow(l_,s),new dl(this.h,this.s,this.l*s,this.opacity)},rgb(){var s=this.h%360+(this.h<0)*360,n=isNaN(s)||isNaN(this.s)?0:this.s,c=this.l,m=c+(c<.5?c:1-c)*n,_=2*c-m;return new ha(Bb(s>=240?s-240:s+120,_,m),Bb(s,_,m),Bb(s<120?s+240:s-120,_,m),this.opacity)},clamp(){return new dl(jC(this.h),Dv(this.s),Dv(this.l),T0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const s=T0(this.opacity);return`${s===1?"hsl(":"hsla("}${jC(this.h)}, ${Dv(this.s)*100}%, ${Dv(this.l)*100}%${s===1?")":`, ${s})`}`}}));function jC(s){return s=(s||0)%360,s<0?s+360:s}function Dv(s){return Math.max(0,Math.min(1,s||0))}function Bb(s,n,c){return(s<60?n+(c-n)*s/60:s<180?c:s<240?n+(c-n)*(240-s)/60:n)*255}const KT=s=>()=>s;function RW(s,n){return function(c){return s+c*n}}function zW(s,n,c){return s=Math.pow(s,c),n=Math.pow(n,c)-s,c=1/c,function(m){return Math.pow(s+m*n,c)}}function DW(s){return(s=+s)==1?cD:function(n,c){return c-n?zW(n,c,s):KT(isNaN(n)?c:n)}}function cD(s,n){var c=n-s;return c?RW(s,c):KT(isNaN(s)?n:s)}const GC=(function s(n){var c=DW(n);function m(_,x){var T=c((_=w0(_)).r,(x=w0(x)).r),r=c(_.g,x.g),I=c(_.b,x.b),k=cD(_.opacity,x.opacity);return function(P){return _.r=T(P),_.g=r(P),_.b=I(P),_.opacity=k(P),_+""}}return m.gamma=s,m})(1);function LW(s,n){n||(n=[]);var c=s?Math.min(n.length,s.length):0,m=n.slice(),_;return function(x){for(_=0;_<c;++_)m[_]=s[_]*(1-x)+n[_]*x;return m}}function OW(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function FW(s,n){var c=n?n.length:0,m=s?Math.min(c,s.length):0,_=new Array(m),x=new Array(c),T;for(T=0;T<m;++T)_[T]=h_(s[T],n[T]);for(;T<c;++T)x[T]=n[T];return function(r){for(T=0;T<m;++T)x[T]=_[T](r);return x}}function BW(s,n){var c=new Date;return s=+s,n=+n,function(m){return c.setTime(s*(1-m)+n*m),c}}function S0(s,n){return s=+s,n=+n,function(c){return s*(1-c)+n*c}}function NW(s,n){var c={},m={},_;(s===null||typeof s!="object")&&(s={}),(n===null||typeof n!="object")&&(n={});for(_ in n)_ in s?c[_]=h_(s[_],n[_]):m[_]=n[_];return function(x){for(_ in c)m[_]=c[_](x);return m}}var w2=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Nb=new RegExp(w2.source,"g");function VW(s){return function(){return s}}function UW(s){return function(n){return s(n)+""}}function jW(s,n){var c=w2.lastIndex=Nb.lastIndex=0,m,_,x,T=-1,r=[],I=[];for(s=s+"",n=n+"";(m=w2.exec(s))&&(_=Nb.exec(n));)(x=_.index)>c&&(x=n.slice(c,x),r[T]?r[T]+=x:r[++T]=x),(m=m[0])===(_=_[0])?r[T]?r[T]+=_:r[++T]=_:(r[++T]=null,I.push({i:T,x:S0(m,_)})),c=Nb.lastIndex;return c<n.length&&(x=n.slice(c),r[T]?r[T]+=x:r[++T]=x),r.length<2?I[0]?UW(I[0].x):VW(n):(n=I.length,function(k){for(var P=0,R;P<n;++P)r[(R=I[P]).i]=R.x(k);return r.join("")})}function h_(s,n){var c=typeof n,m;return n==null||c==="boolean"?KT(n):(c==="number"?S0:c==="string"?(m=u_(n))?(n=m,GC):jW:n instanceof u_?GC:n instanceof Date?BW:OW(n)?LW:Array.isArray(n)?FW:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?NW:S0)(s,n)}function uD(s,n){return s=+s,n=+n,function(c){return Math.round(s*(1-c)+n*c)}}function WC(s,n){for(var c=new Array(n),m=0;m<n;++m)c[m]=s(m/(n-1));return c}function GW(s){return function(){return s}}function WW(s){return+s}var qC=[0,1];function nc(s){return s}function T2(s,n){return(n-=s=+s)?function(c){return(c-s)/n}:GW(isNaN(n)?NaN:.5)}function qW(s,n){var c;return s>n&&(c=s,s=n,n=c),function(m){return Math.max(s,Math.min(n,m))}}function HW(s,n,c){var m=s[0],_=s[1],x=n[0],T=n[1];return _<m?(m=T2(_,m),x=c(T,x)):(m=T2(m,_),x=c(x,T)),function(r){return x(m(r))}}function ZW(s,n,c){var m=Math.min(s.length,n.length)-1,_=new Array(m),x=new Array(m),T=-1;for(s[m]<s[0]&&(s=s.slice().reverse(),n=n.slice().reverse());++T<m;)_[T]=T2(s[T],s[T+1]),x[T]=c(n[T],n[T+1]);return function(r){var I=YV(s,r,1,m)-1;return x[I](_[I](r))}}function JT(s,n){return n.domain(s.domain()).range(s.range()).interpolate(s.interpolate()).clamp(s.clamp()).unknown(s.unknown())}function hD(){var s=qC,n=qC,c=h_,m,_,x,T=nc,r,I,k;function P(){var F=Math.min(s.length,n.length);return T!==nc&&(T=qW(s[0],s[F-1])),r=F>2?ZW:HW,I=k=null,R}function R(F){return F==null||isNaN(F=+F)?x:(I||(I=r(s.map(m),n,c)))(m(T(F)))}return R.invert=function(F){return T(_((k||(k=r(n,s.map(m),S0)))(F)))},R.domain=function(F){return arguments.length?(s=Array.from(F,WW),P()):s.slice()},R.range=function(F){return arguments.length?(n=Array.from(F),P()):n.slice()},R.rangeRound=function(F){return n=Array.from(F),c=uD,P()},R.clamp=function(F){return arguments.length?(T=F?!0:nc,P()):T!==nc},R.interpolate=function(F){return arguments.length?(c=F,P()):c},R.unknown=function(F){return arguments.length?(x=F,R):x},function(F,V){return m=F,_=V,P()}}function dD(){return hD()(nc,nc)}function XW(s){return Math.abs(s=Math.round(s))>=1e21?s.toLocaleString("en").replace(/,/g,""):s.toString(10)}function E0(s,n){if((c=(s=n?s.toExponential(n-1):s.toExponential()).indexOf("e"))<0)return null;var c,m=s.slice(0,c);return[m.length>1?m[0]+m.slice(2):m,+s.slice(c+1)]}function mp(s){return s=E0(Math.abs(s)),s?s[1]:NaN}function YW(s,n){return function(c,m){for(var _=c.length,x=[],T=0,r=s[0],I=0;_>0&&r>0&&(I+r+1>m&&(r=Math.max(1,m-I)),x.push(c.substring(_-=r,_+r)),!((I+=r+1)>m));)r=s[T=(T+1)%s.length];return x.reverse().join(n)}}function KW(s){return function(n){return n.replace(/[0-9]/g,function(c){return s[+c]})}}var JW=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function A0(s){if(!(n=JW.exec(s)))throw new Error("invalid format: "+s);var n;return new QT({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}A0.prototype=QT.prototype;function QT(s){this.fill=s.fill===void 0?" ":s.fill+"",this.align=s.align===void 0?">":s.align+"",this.sign=s.sign===void 0?"-":s.sign+"",this.symbol=s.symbol===void 0?"":s.symbol+"",this.zero=!!s.zero,this.width=s.width===void 0?void 0:+s.width,this.comma=!!s.comma,this.precision=s.precision===void 0?void 0:+s.precision,this.trim=!!s.trim,this.type=s.type===void 0?"":s.type+""}QT.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function QW(s){e:for(var n=s.length,c=1,m=-1,_;c<n;++c)switch(s[c]){case".":m=_=c;break;case"0":m===0&&(m=c),_=c;break;default:if(!+s[c])break e;m>0&&(m=0);break}return m>0?s.slice(0,m)+s.slice(_+1):s}var fD;function $W(s,n){var c=E0(s,n);if(!c)return s+"";var m=c[0],_=c[1],x=_-(fD=Math.max(-8,Math.min(8,Math.floor(_/3)))*3)+1,T=m.length;return x===T?m:x>T?m+new Array(x-T+1).join("0"):x>0?m.slice(0,x)+"."+m.slice(x):"0."+new Array(1-x).join("0")+E0(s,Math.max(0,n+x-1))[0]}function HC(s,n){var c=E0(s,n);if(!c)return s+"";var m=c[0],_=c[1];return _<0?"0."+new Array(-_).join("0")+m:m.length>_+1?m.slice(0,_+1)+"."+m.slice(_+1):m+new Array(_-m.length+2).join("0")}const ZC={"%":(s,n)=>(s*100).toFixed(n),b:s=>Math.round(s).toString(2),c:s=>s+"",d:XW,e:(s,n)=>s.toExponential(n),f:(s,n)=>s.toFixed(n),g:(s,n)=>s.toPrecision(n),o:s=>Math.round(s).toString(8),p:(s,n)=>HC(s*100,n),r:HC,s:$W,X:s=>Math.round(s).toString(16).toUpperCase(),x:s=>Math.round(s).toString(16)};function XC(s){return s}var YC=Array.prototype.map,KC=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function eq(s){var n=s.grouping===void 0||s.thousands===void 0?XC:YW(YC.call(s.grouping,Number),s.thousands+""),c=s.currency===void 0?"":s.currency[0]+"",m=s.currency===void 0?"":s.currency[1]+"",_=s.decimal===void 0?".":s.decimal+"",x=s.numerals===void 0?XC:KW(YC.call(s.numerals,String)),T=s.percent===void 0?"%":s.percent+"",r=s.minus===void 0?"":s.minus+"",I=s.nan===void 0?"NaN":s.nan+"";function k(R){R=A0(R);var F=R.fill,V=R.align,W=R.sign,G=R.symbol,K=R.zero,Y=R.width,ne=R.comma,oe=R.precision,ce=R.trim,me=R.type;me==="n"?(ne=!0,me="g"):ZC[me]||(oe===void 0&&(oe=12),ce=!0,me="g"),(K||F==="0"&&V==="=")&&(K=!0,F="0",V="=");var ue=G==="$"?c:G==="#"&&/[boxX]/.test(me)?"0"+me.toLowerCase():"",_e=G==="$"?m:/[%p]/.test(me)?T:"",te=ZC[me],ie=/[defgprs%]/.test(me);oe=oe===void 0?6:/[gprs]/.test(me)?Math.max(1,Math.min(21,oe)):Math.max(0,Math.min(20,oe));function xe(de){var Te=ue,De=_e,Be,Se,Ne;if(me==="c")De=te(de)+De,de="";else{de=+de;var it=de<0||1/de<0;if(de=isNaN(de)?I:te(Math.abs(de),oe),ce&&(de=QW(de)),it&&+de==0&&W!=="+"&&(it=!1),Te=(it?W==="("?W:r:W==="-"||W==="("?"":W)+Te,De=(me==="s"?KC[8+fD/3]:"")+De+(it&&W==="("?")":""),ie){for(Be=-1,Se=de.length;++Be<Se;)if(Ne=de.charCodeAt(Be),48>Ne||Ne>57){De=(Ne===46?_+de.slice(Be+1):de.slice(Be))+De,de=de.slice(0,Be);break}}}ne&&!K&&(de=n(de,1/0));var qe=Te.length+de.length+De.length,ft=qe<Y?new Array(Y-qe+1).join(F):"";switch(ne&&K&&(de=n(ft+de,ft.length?Y-De.length:1/0),ft=""),V){case"<":de=Te+de+De+ft;break;case"=":de=Te+ft+de+De;break;case"^":de=ft.slice(0,qe=ft.length>>1)+Te+de+De+ft.slice(qe);break;default:de=ft+Te+de+De;break}return x(de)}return xe.toString=function(){return R+""},xe}function P(R,F){var V=k((R=A0(R),R.type="f",R)),W=Math.max(-8,Math.min(8,Math.floor(mp(F)/3)))*3,G=Math.pow(10,-W),K=KC[8+W/3];return function(Y){return V(G*Y)+K}}return{format:k,formatPrefix:P}}var Lv,pD,mD;tq({thousands:",",grouping:[3],currency:["$",""]});function tq(s){return Lv=eq(s),pD=Lv.format,mD=Lv.formatPrefix,Lv}function nq(s){return Math.max(0,-mp(Math.abs(s)))}function iq(s,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(mp(n)/3)))*3-mp(Math.abs(s)))}function rq(s,n){return s=Math.abs(s),n=Math.abs(n)-s,Math.max(0,mp(n)-mp(s))+1}function oq(s,n,c,m){var _=l2(s,n,c),x;switch(m=A0(m??",f"),m.type){case"s":{var T=Math.max(Math.abs(s),Math.abs(n));return m.precision==null&&!isNaN(x=iq(_,T))&&(m.precision=x),mD(m,T)}case"":case"e":case"g":case"p":case"r":{m.precision==null&&!isNaN(x=rq(_,Math.max(Math.abs(s),Math.abs(n))))&&(m.precision=x-(m.type==="e"));break}case"f":case"%":{m.precision==null&&!isNaN(x=nq(_))&&(m.precision=x-(m.type==="%")*2);break}}return pD(m)}function gD(s){var n=s.domain;return s.ticks=function(c){var m=n();return tU(m[0],m[m.length-1],c??10)},s.tickFormat=function(c,m){var _=n();return oq(_[0],_[_.length-1],c??10,m)},s.nice=function(c){c==null&&(c=10);var m=n(),_=0,x=m.length-1,T=m[_],r=m[x],I,k,P=10;for(r<T&&(k=T,T=r,r=k,k=_,_=x,x=k);P-- >0;){if(k=a2(T,r,c),k===I)return m[_]=T,m[x]=r,n(m);if(k>0)T=Math.floor(T/k)*k,r=Math.ceil(r/k)*k;else if(k<0)T=Math.ceil(T*k)/k,r=Math.floor(r*k)/k;else break;I=k}return s},s}function id(){var s=dD();return s.copy=function(){return JT(s,id())},Mp.apply(s,arguments),gD(s)}function sq(s,n){s=s.slice();var c=0,m=s.length-1,_=s[c],x=s[m],T;return x<_&&(T=c,c=m,m=T,T=_,_=x,x=T),s[c]=n.floor(_),s[m]=n.ceil(x),s}function JC(s){return function(n){return n<0?-Math.pow(-n,s):Math.pow(n,s)}}function aq(s){return s<0?-Math.sqrt(-s):Math.sqrt(s)}function lq(s){return s<0?-s*s:s*s}function cq(s){var n=s(nc,nc),c=1;function m(){return c===1?s(nc,nc):c===.5?s(aq,lq):s(JC(c),JC(1/c))}return n.exponent=function(_){return arguments.length?(c=+_,m()):c},gD(n)}function _D(){var s=cq(hD());return s.copy=function(){return JT(s,_D()).exponent(s.exponent())},Mp.apply(s,arguments),s}function uq(){return _D.apply(null,arguments).exponent(.5)}function hq(s){return new Date(s)}function dq(s){return s instanceof Date?+s:+new Date(+s)}function $T(s,n,c,m,_,x,T,r,I,k){var P=dD(),R=P.invert,F=P.domain,V=k(".%L"),W=k(":%S"),G=k("%I:%M"),K=k("%I %p"),Y=k("%a %d"),ne=k("%b %d"),oe=k("%B"),ce=k("%Y");function me(ue){return(I(ue)<ue?V:r(ue)<ue?W:T(ue)<ue?G:x(ue)<ue?K:m(ue)<ue?_(ue)<ue?Y:ne:c(ue)<ue?oe:ce)(ue)}return P.invert=function(ue){return new Date(R(ue))},P.domain=function(ue){return arguments.length?F(Array.from(ue,dq)):F().map(hq)},P.ticks=function(ue){var _e=F();return s(_e[0],_e[_e.length-1],ue??10)},P.tickFormat=function(ue,_e){return _e==null?me:k(_e)},P.nice=function(ue){var _e=F();return(!ue||typeof ue.range!="function")&&(ue=n(_e[0],_e[_e.length-1],ue??10)),ue?F(sq(_e,ue)):P},P.copy=function(){return JT(P,$T(s,n,c,m,_,x,T,r,I,k))},P}function fq(){return Mp.apply($T(Bz,oG,yl,hx,hd,tc,lx,ax,qu,Gz).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function pq(){return Mp.apply($T(iG,rG,Kc,NT,ux,cx,DT,zT,qu,Wz).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}const mq=(s,n,c,m)=>{if(c==="length"||c==="prototype"||c==="arguments"||c==="caller")return;const _=Object.getOwnPropertyDescriptor(s,c),x=Object.getOwnPropertyDescriptor(n,c);!gq(_,x)&&m||Object.defineProperty(s,c,x)},gq=function(s,n){return s===void 0||s.configurable||s.writable===n.writable&&s.enumerable===n.enumerable&&s.configurable===n.configurable&&(s.writable||s.value===n.value)},_q=(s,n)=>{const c=Object.getPrototypeOf(n);c!==Object.getPrototypeOf(s)&&Object.setPrototypeOf(s,c)},yq=(s,n)=>`/* Wrapped ${s}*/
${n}`,vq=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),xq=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name"),bq=(s,n,c)=>{const m=c===""?"":`with ${c.trim()}() `,_=yq.bind(null,m,n.toString());Object.defineProperty(_,"name",xq);const{writable:x,enumerable:T,configurable:r}=vq;Object.defineProperty(s,"toString",{value:_,writable:x,enumerable:T,configurable:r})};function wq(s,n,{ignoreNonConfigurable:c=!1}={}){const{name:m}=s;for(const _ of Reflect.ownKeys(n))mq(s,n,_,c);return _q(s,n),bq(s,n,m),s}const Tq=new WeakMap,QC=new WeakMap;function mx(s,{cacheKey:n,cache:c=new Map,maxAge:m}={}){if(m===0)return s;if(typeof m=="number"){if(m>2147483647)throw new TypeError("The `maxAge` option cannot exceed 2147483647.");if(m<0)throw new TypeError("The `maxAge` option should not be a negative number.")}const _=function(...x){const T=n?n(x):x[0],r=c.get(T);if(r)return r.data;const I=s.apply(this,x),k=typeof m=="function"?m(...x):m;if(c.set(T,{data:I,maxAge:k?Date.now()+k:Number.POSITIVE_INFINITY}),k&&k>0&&k!==Number.POSITIVE_INFINITY){const P=setTimeout(()=>{c.delete(T)},k);P.unref?.();const R=QC.get(s)??new Set;R.add(P),QC.set(s,R)}return I};return wq(_,s,{ignoreNonConfigurable:!0}),Tq.set(_,c),_}const $C="__text_measurement_id";function Sq(s,n){try{let c=document.getElementById($C);if(!c){const m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.style.width="0",m.style.height="0",m.style.position="absolute",m.style.top="-100%",m.style.left="-100%",c=document.createElementNS("http://www.w3.org/2000/svg","text"),c.setAttribute("id",$C),m.appendChild(c),document.body.appendChild(m)}return Object.assign(c.style,n),c.textContent=s,c.getComputedTextLength()}catch{return null}}const ul=mx(Sq,{cacheKey:([s,n])=>`${s}_${JSON.stringify(n)}`});function I0(s){return s.replace(/^\w/,n=>n.toUpperCase())}const Eq="";function Aq(s,{position:n="end",ellipsis:c=Eq,maxWidth:m,style:_,maxChars:x}){if(!s)return"";if(m===void 0&&x===void 0)return s;let T=s;if(x!==void 0&&s.length>x)if(n==="start")T=c+s.slice(-x);else if(n==="middle"){const r=Math.floor(x/2);T=s.slice(0,r)+c+s.slice(-r)}else T=s.slice(0,x)+c;if(m!==void 0){const r=ul(T,_);if(r===null||r<=m)return T;const I=ul(c,_)??0;let k=m-I;if(n==="start"){let P=T.slice(c.length),R=ul(P,_);for(;R!==null&&R>k&&P.length>0;)P=P.slice(1),R=ul(P,_);return c+P}else if(n==="middle"){const P=k/2;let R="",F="",V="",W="";for(let G=0,K=T.length-1;G<T.length&&K>=0;G++,K--){const Y=T.slice(0,G+1),ne=T.slice(K),oe=ul(Y,_),ce=ul(ne,_);oe!==null&&oe<=P&&(R=Y),ce!==null&&ce<=P&&(F=ne);const me=ul(R+c+F,_);if(me!==null&&me<=m)V=R,W=F;else break}return V+c+W}else{let P=T.slice(0,-c.length),R=ul(P+c,_);for(;R!==null&&R>m&&P.length>0;)P=P.slice(0,-1),R=ul(P+c,_);return P+c}}return T}function Bg(s,n){return s.length!==n.length?!1:s.every(c=>n.includes(c))}function Ov(s,n,c){return n?Iq(n[s],c):c}function Iq(s=[],n){return Array.isArray(n)===!0?n.map((c,m)=>c===null?s[m]:c):s}function Fv(s,{domain:n,scale:c,padding:m,nice:_,reverse:x,width:T,height:r,range:I,percentRange:k}){const P=zq(s,T,r,x,I,k),R=c.copy();return R.domain(n),(!R.interpolator||typeof R.interpolator=="function"&&R.interpolator().name.startsWith("identity"))&&R.range(P),m&&R.domain(Cq(R,m)),(_===!0||typeof _=="number")&&(typeof R.nice=="function"?R.nice(typeof _=="number"?_:void 0):console.error(`[Layer Chart] You set \`${s}Nice: true\` but the ${s}Scale does not have a \`.nice\` method. Ignoring...`)),R}const Mq=["scaleThreshold","scaleQuantile","scaleQuantize","scaleSequentialQuantile"];function Cq(s,n){if(typeof s.range!="function")throw new Error("Scale method `range` must be a function");if(typeof s.domain!="function")throw new Error("Scale method `domain` must be a function");if(!Array.isArray(n)||Mq.includes(yD(s))||vD(s)===!0)return s.domain();const{lift:c,ground:m}=Nq(s),_=s.domain()[0],x=Object.prototype.toString.call(_)==="[object Date]",[T,r]=s.domain().map(V=>c(x?V.getTime():V)),[I,k]=s.range(),P=n[0]||0,R=n[1]||0,F=(r-T)/(Math.abs(k-I)-P-R);return[T-P*F,R*F+r].map(V=>m(x?new Date(V).getTime():V))}function Ks(s,n=""){return`scale${I0(n)}${I0(s)}`}function yD(s){if(typeof s.bandwidth=="function")return typeof s.paddingInner=="function"?Ks("band"):Ks("point");if(Bg(Object.keys(s),["domain","range","unknown","copy"]))return Ks("ordinal");let n="";if(s.interpolator&&(s.domain().length===3?n="diverging":n="sequential"),s.quantiles)return Ks("quantile",n);if(s.thresholds)return Ks("quantize",n);if(s.constant)return Ks("symlog",n);if(s.base)return Ks("log",n);if(s.exponent)return s.exponent()===.5?Ks("sqrt",n):Ks("pow",n);if(Bg(Object.keys(s),["domain","range","invertExtent","unknown","copy"]))return Ks("threshold");if(Bg(Object.keys(s),["invert","range","domain","unknown","copy","ticks","tickFormat","nice"]))return Ks("identity");if(Bg(Object.keys(s),["invert","domain","range","rangeRound","round","clamp","unknown","copy","ticks","tickFormat","nice"]))return Ks("radial");if(n)return Ks(n);if(s.domain()[0]instanceof Date){const c=new Date;let m="";return c.getDay=()=>m="time",c.getUTCDay=()=>m="utc",s.tickFormat(0,"%a")(c),Ks(m)}return Ks("linear")}function vD(s){return!!(typeof s.bandwidth=="function"||Bg(Object.keys(s),["domain","range","unknown","copy"]))}function Pq(s,n,c){const m=Object.entries(c).reduce((x,[T,r])=>{const I=vD(r.scale)===!0?"ordinal":"other";return x[I]||(x[I]={}),x[I][T]=n[T],x},{ordinal:!1,other:!1});let _={};if(m.ordinal){const x=Object.fromEntries(Object.entries(c).map(([T,r])=>[T,r.sort]));_=kq(s,m.ordinal,x)}if(m.other){const x=Vq(s,m.other);_={..._,...x}}return _}function kq(s,n,c={}){if(!Array.isArray(s))throw new TypeError(`The first argument of calcUniques() must be an array. You passed in a ${typeof s}. If you got this error using the <Chart> component, consider passing a flat array to the \`flatData\` prop`);if(Array.isArray(n)||n===void 0||n===null)throw new TypeError("The second argument of calcUniques() must be an object with field names as keys and accessor functions as values.");const m={},_=Object.keys(n);for(const x of _){const T=new KV,r=n[x];if(!r)continue;for(const k of s){const P=r(k);if(Array.isArray(P))for(const R of P)T.add(R);else T.add(P)}const I=Array.from(T);(c.sort===!0||c[x]===!0)&&I.sort((k,P)=>typeof k=="number"&&typeof P=="number"?k-P:String(k).localeCompare(String(P))),m[x]=I}return m}function Rq(s,n,c,m,_){let x,T;return _===!0?(x=0,T=100):(x=s==="r"?1:0,T=s==="y"?c:s==="r"?25:n),m===!0?[T,x]:[x,T]}function zq(s,n,c,m,_,x=!1){return _?typeof _=="function"?_({width:n,height:c}):_:Rq(s,n,c,m,x)}function eP(s){return s}function Dq(s){return s.constant?"symlog":s.base?"log":typeof s.exponent=="function"?s.exponent()===.5?"sqrt":"pow":"other"}function Lq(s){return n=>Math.log(s*n)}function Oq(s){return n=>s*Math.exp(n)}function Fq(s){return n=>Math.sign(n)*Math.log1p(Math.abs(n/s))}function Bq(s){return n=>Math.sign(n)*Math.expm1(Math.abs(n))*s}function Bv(s){return function(c){return c<0?-Math.pow(-c,s):Math.pow(c,s)}}function Nq(s){const n=Dq(s);switch(n){case"log":{const c=s.domain(),m=Math.sign(c[0]);return{lift:Lq(m),ground:Oq(m),scaleType:n}}case"pow":return{lift:Bv(1),ground:Bv(1/1),scaleType:n};case"sqrt":return{lift:Bv(.5),ground:Bv(1/.5),scaleType:n};case"symlog":return{lift:Fq(1),ground:Bq(1),scaleType:n};default:return{lift:eP,ground:eP,scaleType:n}}}function Xf(s,n){return c=>{const m=s(c);if(n)return Array.isArray(m)?m.map(_=>n(_)):n(m)}}function Vq(s,n){if(!Array.isArray(s))throw new TypeError(`The first argument of calcExtents() must be an array. You passed in a ${typeof s}. If you got this error using the <Chart> component, consider passing a flat array to the \`flatData\` prop.`);if(Array.isArray(n)||n===void 0||n===null)throw new TypeError("The second argument of calcExtents() must be an object with field names as keys as accessor functions as values.");const c={},m=Object.keys(n),_=m.length;let x,T,r,I,k,P,R,F;const V=s.length;for(x=0;x<_;x+=1)if(I=m[x],R=n[I],k=null,P=null,!!R){for(T=0;T<V;T+=1)if(F=R(s[T]),Array.isArray(F)){const W=F.length;for(r=0;r<W;r+=1)F[r]!==void 0&&F[r]!==null&&(typeof F[r]=="string"||Number.isNaN(F[r])===!1)&&((k===null||F[r]<k)&&(k=F[r]),(P===null||F[r]>P)&&(P=F[r]))}else F!=null&&(typeof F=="string"||Number.isNaN(F)===!1)&&((k===null||F<k)&&(k=F),(P===null||F>P)&&(P=F));c[I]=[k,P]}return c}function Uq(s){s.nextSibling&&s.parentNode?.appendChild(s)}const ja="    ";function jq(s){Object.entries(s).forEach(([n,c])=>{console.log(`${ja}${n}:`,c)})}function Gq(s){const{r:n,g:c,b:m,opacity:_}=w0(s);return[n,c,m].every(x=>x>=0&&x<=255)?{r:n,g:c,b:m,o:_}:!1}function tP(s,n,c=""){const m=s[n](),_=qq(m);_?Wq(_,n,m):console.log(`${ja}${ja}${I0(n)}:${c}`,m)}function Wq(s,n,c){console.log(`${ja}${ja}${I0(n)}:    %cArray%c(${c.length}) `+s[0]+"%c ]","color: #1377e4","color: #737373","color: #1478e4",...s[1],"color: #1478e4")}function qq(s){const n=[],c=s.map((m,_)=>{const x=Gq(m);if(x!==!1){n.push(x);const T=_===s.length-1?" ":"";return`%c ${m}${T}`}return m});return n.length?[`%c[ ${c.join(", ")}`,n.map(m=>`background-color: rgba(${m.r}, ${m.g}, ${m.b}, ${m.o}); color:${Zq(m)};`)]:null}function Hq(s,n,c){const m=yD(n);console.log(`${ja}${s}:`),console.log(`${ja}${ja}Accessor: "${c.toString()}"`),console.log(`${ja}${ja}Type: ${m}`),tP(n,"domain"),tP(n,"range"," ")}function Zq({r:s,g:n,b:c}){return(.2126*s+.7152*n+.0722*c)/255>.6?"black":"white"}function Xq(s){console.log("/********* LayerChart Debug ************/"),console.log("Bounding box:"),jq(s.boundingBox),console.log("Data:"),console.log(ja,s.data),s.flatData&&(console.log("flatData:"),console.log(ja,s.flatData)),console.log("Scales:"),Object.keys(s.activeGetters).forEach(n=>{Hq(n,s[`${n}Scale`],s[n])}),console.log(`/************ End LayerChart Debug ***************/
`)}function nP(s,n={}){return Object.fromEntries(Object.entries(s).filter(([c,m])=>m!==void 0&&n[c]===void 0))}function Yq(s){return typeof s=="function"&&typeof s.range=="function"}function Wi(s){return typeof s.bandwidth=="function"}function Kq(s){const n=s.domain();return n[0]instanceof Date||n[1]instanceof Date}function Nv(s){return Yq(s)?s.range():(console.error("[LayerChart] Your scale doesn't have a `.range` method?"),[])}function Jq(s){const n=s.domain(),c=s.step(),m=c*(s.paddingOuter?.()??s.padding());return function(_){const x=Math.floor((_-m/2)/c);return n[Math.max(0,Math.min(x,n.length-1))]}}function Bc(s,n){return Wi(s)?Jq(s)(n):s.invert?.(n)}function Vb(s,n,c,m){const _=s.copy();return n&&_.domain(n),typeof c=="function"?_.range(c(m)):_.range(c),_}function Qq(s){return s===0?!0:s}function Vv(s){return Qq(s)?Array.isArray(s)?n=>s.map(c=>typeof c!="function"?n[c]:c(n)):typeof s!="function"?n=>n[s]:s:null}const xD=typeof window<"u"?window:void 0;function $q(s){let n=s.activeElement;for(;n?.shadowRoot;){const c=n.shadowRoot.activeElement;if(c===n)break;n=c}return n}class eH{#t;#e;constructor(n={}){const{window:c=xD,document:m=c?.document}=n;c!==void 0&&(this.#t=m,this.#e=ld(_=>{const x=vs(c,"focusin",_),T=vs(c,"focusout",_);return()=>{x(),T()}}))}get current(){return this.#e?.(),this.#t?$q(this.#t):null}}new eH;function tH(s){return typeof s=="function"}function bD(s,n){if(tH(s)){const m=s();return m===void 0?n:m}return s===void 0?n:s}class eh{#t;#e;constructor(n){this.#t=n,this.#e=Symbol(n)}get key(){return this.#e}exists(){return pR(this.#e)}get(){const n=Kg(this.#e);if(n===void 0)throw new Error(`Context "${this.#t}" not found`);return n}getOr(n){const c=Kg(this.#e);return c===void 0?n:c}set(n){return tT(this.#e,n)}}function nH(s,n){let c=Mn(null);const m=fe(()=>bD(n,250));function _(...x){if(A(c))A(c).timeout&&clearTimeout(A(c).timeout);else{let T,r;const I=new Promise((k,P)=>{T=k,r=P});rn(c,{timeout:null,runner:null,promise:I,resolve:T,reject:r},!0)}return A(c).runner=async()=>{if(!A(c))return;const T=A(c);rn(c,null);try{T.resolve(await s.apply(this,x))}catch(r){T.reject(r)}},A(c).timeout=setTimeout(A(c).runner,A(m)),A(c).promise}return _.cancel=async()=>{(!A(c)||A(c).timeout===null)&&(await new Promise(x=>setTimeout(x,0)),!A(c)||A(c).timeout===null)||(clearTimeout(A(c).timeout),A(c).reject("Cancelled"),rn(c,null))},_.runScheduledNow=async()=>{(!A(c)||!A(c).timeout)&&(await new Promise(x=>setTimeout(x,0)),!A(c)||!A(c).timeout)||(clearTimeout(A(c).timeout),A(c).timeout=null,await A(c).runner?.())},Object.defineProperty(_,"pending",{enumerable:!0,get(){return!!A(c)?.timeout}}),_}function iH(s,n){switch(s){case"post":Os(n);break;case"pre":ki(n);break}}function wD(s,n,c,m={}){const{lazy:_=!1}=m;let x=!_,T=Array.isArray(s)?[]:void 0;iH(n,()=>{const r=Array.isArray(s)?s.map(k=>k()):s();if(!x){x=!0,T=r;return}const I=Ia(()=>c(r,T));return T=r,I})}function eS(s,n,c){wD(s,"post",n,c)}function rH(s,n,c){wD(s,"pre",n,c)}eS.pre=rH;function oH(s,n,c={}){const{window:m=xD}=c;let _;const x=fe(()=>{const r=bD(s);return new Set(r?Array.isArray(r)?r:[r]:[])}),T=m_(()=>{Os(()=>{if(!(!A(x).size||!m)){_=new m.MutationObserver(n);for(const r of A(x))_.observe(r,c);return()=>{_?.disconnect(),_=void 0}}})});return Os(()=>T),{stop:T,takeRecords(){return _?.takeRecords()}}}function Cn(s){return`lc-${s}`}function sH(s){return typeof s=="object"&&s!==null&&typeof s!="function"}function To(s,n,c){const m=Cn(n);return sH(s)?{...s,class:En(m,s.class??"",c)}:{class:En(m,c)}}const S2={x:0,y:0},E2=1,TD=new eh("TransformContext");function aH(){let s=Mn(Ya(S2)),n=Mn(E2);return{mode:"none",get scale(){return A(n)},setScale:m=>{rn(n,m,!0)},get translate(){return A(s)},setTranslate:m=>{rn(s,m,!0)},moving:!1,dragging:!1,scrollMode:"none",setScrollMode:()=>{},reset:()=>{},zoomIn:()=>{},zoomOut:()=>{},translateCenter:()=>{},zoomTo:()=>{}}}function gx(){return TD.getOr(aH())}function lH(s){return TD.set(s)}var cH=Un("<div><!></div>");function uH(s,n){Yn(n,!0);let c=Re(n,"mode",3,"none"),m=Re(n,"processTranslate",3,(vt,zt,fn,Gn)=>({x:vt+fn,y:zt+Gn})),_=Re(n,"disablePointer",3,!1),x=Re(n,"initialScrollMode",3,"none"),T=Re(n,"clickDistance",3,10),r=Re(n,"ondragend",3,()=>{}),I=Re(n,"ondragstart",3,()=>{}),k=Re(n,"onTransform",3,()=>{}),P=Re(n,"onwheel",3,()=>{}),R=Re(n,"onpointerdown",3,()=>{}),F=Re(n,"onpointermove",3,()=>{}),V=Re(n,"ontouchmove",3,()=>{}),W=Re(n,"onpointerup",3,()=>{}),G=Re(n,"ondblclick",3,()=>{}),K=Re(n,"onclickcapture",3,()=>{}),Y=Re(n,"ref",15),ne=Re(n,"transformContext",15),oe=bi(n,["$$slots","$$events","$$legacy","mode","motion","processTranslate","disablePointer","initialScrollMode","clickDistance","ondragend","ondragstart","onTransform","initialTranslate","initialScale","onwheel","onpointerdown","onpointermove","ontouchmove","onpointerup","ondblclick","onclickcapture","ref","children","class","transformContext"]),ce=Mn(void 0);ki(()=>{Y(A(ce))}),ne({get mode(){return c()},get scale(){return de.current},setScale:Rt,get translate(){return xe.current},setTranslate:Je,get dragging(){return A(_e)},get moving(){return A(_t)},reset:Se,zoomIn:Ne,zoomOut:it,translateCenter:qe,zoomTo:ft,get scrollMode(){return A(te)},setScrollMode:Be});const me=_o();let ue=!1,_e=Mn(!1),te=Mn(Ya(x()));const ie=Hu(n.motion),xe=g2(n.initialTranslate??S2,ie),de=g2(n.initialScale??E2,ie);let Te={x:0,y:0},De={x:0,y:0};function Be(vt){rn(te,vt,!0)}function Se(){xe.target=n.initialTranslate??S2,de.target=n.initialScale??E2}function Ne(){tt(1.25,{x:(me.width+me.padding.left)/2,y:(me.height+me.padding.top)/2})}function it(){tt(.8,{x:(me.width+me.padding.left)/2,y:(me.height+me.padding.top)/2})}function qe(){xe.target={x:0,y:0}}function ft(vt,zt){const fn=zt?me.width<me.height?me.width/zt.width:me.height/zt.height:1;xe.target={x:me.width/2-vt.x*fn,y:me.height/2-vt.y*fn},zt&&(de.target=fn)}function St(vt){R()?.(vt),!(c()==="none"||_())&&(vt.preventDefault(),ue=!0,rn(_e,!1),Te=jc(vt),De=xe.current,I()?.())}function Dt(vt){if(F()?.(vt),!ue)return;vt.preventDefault();const zt=jc(vt),fn=zt.x-Te.x,Gn=zt.y-Te.y;A(_e)||rn(_e,fn*fn+Gn*Gn>T()),A(_e)&&(vt.stopPropagation(),vt.currentTarget?.setPointerCapture(vt.pointerId),Je(m()(De.x,De.y,fn,Gn),xe.type==="spring"?{instant:!0}:xe.type==="tween"?{duration:0}:void 0))}function Kt(vt){W()?.(vt),ue=!1,rn(_e,!1),r()?.()}function et(vt){K()?.(vt),A(_e)&&vt.stopPropagation()}function Qe(vt){if(G()?.(vt),c()==="none"||_())return;const zt=jc(vt);tt(vt.shiftKey?.5:2,zt)}function st(vt){if(P()?.(vt),c()==="none"||_()||A(te)==="none")return;vt.preventDefault();const zt=Te=jc(vt),fn=vt.ctrlKey;if(A(te)==="scale"||fn){const Gn=-vt.deltaY*(vt.deltaMode===1?.05:vt.deltaMode?1:.002)*(vt.ctrlKey?10:1);tt(Math.pow(2,Gn),zt,de.type==="spring"?{instant:!0}:de.type==="tween"?{duration:0}:void 0)}else if(A(te)==="translate"){const Gn=xe.current;xe.set(m()(Gn.x,Gn.y,-vt.deltaX,-vt.deltaY),xe.type==="spring"?{instant:!0}:xe.type==="tween"?{duration:0}:void 0).then(()=>{}).catch(()=>{})}}function tt(vt,zt,fn=void 0){const Gn=de.current,Wn=de.current*vt;Rt(Wn,fn);const ti={x:(zt.x-me.padding.left-xe.current.x)/Gn,y:(zt.y-me.padding.top-xe.current.y)/Gn},yi={x:zt.x-me.padding.left-ti.x*Wn,y:zt.y-me.padding.top-ti.y*Wn};Je(yi,fn)}const gt=wC(),Lt=wC(),_t=fe(()=>A(_e)||gt.current||Lt.current);function Je(vt,zt){gt.handle(xe.set(vt,zt))}function Rt(vt,zt){Lt.handle(de.set(vt,zt))}eS([()=>de.current,()=>xe.current],()=>{k()({scale:de.current,translate:xe.current})}),lH(ne());var ut={setScrollMode:Be,reset:Se,zoomIn:Ne,zoomOut:it,translateCenter:qe,zoomTo:ft,setTranslate:Je,setScale:Rt},cn=cH(),on=vt=>{V()?.(vt),c()!=="none"&&!_()&&vt.preventDefault()};Ii(cn,vt=>({onwheel:st,onpointerdown:St,onpointermove:Dt,ontouchmove:on,onpointerup:Kt,ondblclick:Qe,onclickcapture:et,class:vt,...oe}),[()=>En(Cn("transform-context"),"h-full",n.class)]);var Jt=Xn(cn);return Dn(Jt,()=>n.children??Si,()=>({transformContext:ne()})),Ln(cn),er(cn,vt=>rn(ce,vt),()=>A(ce)),je(s,cn),Kn(ut)}const SD=new eh("GeoContext");function tS(){return SD.getOr({projection:void 0})}function hH(s){return SD.set(s)}function dH(s,n){Yn(n,!0);let c=Re(n,"applyTransform",19,()=>[]),m=Re(n,"geoContext",15);const _=_o(),x=gx();let T=Mn(void 0);const r={get projection(){return A(T)},set projection(R){rn(T,R,!0)}};m(r),hH(r);const I=fe(()=>n.fixedAspectRatio?[100,100/n.fixedAspectRatio]:[_.width,_.height]);ki(()=>{if(!n.projection)return;const R=n.projection();n.fitGeojson&&"fitSize"in R&&R.fitSize(A(I),n.fitGeojson),"scale"in R&&(n.scale&&R.scale(n.scale),c().includes("scale")&&R.scale(x.scale)),"rotate"in R&&(n.rotate&&R.rotate([n.rotate.yaw,n.rotate.pitch,n.rotate.roll]),c().includes("rotate")&&R.rotate([x.translate.x,x.translate.y])),"translate"in R&&(n.translate&&R.translate(n.translate),c().includes("translate")&&R.translate([x.translate.x,x.translate.y])),n.center&&"center"in R&&R.center(n.center),n.reflectX&&R.reflectX(n.reflectX),n.reflectY&&R.reflectY(n.reflectY),n.clipAngle&&"clipAngle"in R&&R.clipAngle(n.clipAngle),n.clipExtent&&"clipExtent"in R&&R.clipExtent(n.clipExtent),r.projection=R});var k=Gt(),P=yt(k);Dn(P,()=>n.children,()=>({geoContext:r})),je(s,k),Kn()}function fH(s){const n=+this._x.call(null,s),c=+this._y.call(null,s);return ED(this.cover(n,c),n,c,s)}function ED(s,n,c,m){if(isNaN(n)||isNaN(c))return s;var _,x=s._root,T={data:m},r=s._x0,I=s._y0,k=s._x1,P=s._y1,R,F,V,W,G,K,Y,ne;if(!x)return s._root=T,s;for(;x.length;)if((G=n>=(R=(r+k)/2))?r=R:k=R,(K=c>=(F=(I+P)/2))?I=F:P=F,_=x,!(x=x[Y=K<<1|G]))return _[Y]=T,s;if(V=+s._x.call(null,x.data),W=+s._y.call(null,x.data),n===V&&c===W)return T.next=x,_?_[Y]=T:s._root=T,s;do _=_?_[Y]=new Array(4):s._root=new Array(4),(G=n>=(R=(r+k)/2))?r=R:k=R,(K=c>=(F=(I+P)/2))?I=F:P=F;while((Y=K<<1|G)===(ne=(W>=F)<<1|V>=R));return _[ne]=x,_[Y]=T,s}function pH(s){var n,c,m=s.length,_,x,T=new Array(m),r=new Array(m),I=1/0,k=1/0,P=-1/0,R=-1/0;for(c=0;c<m;++c)isNaN(_=+this._x.call(null,n=s[c]))||isNaN(x=+this._y.call(null,n))||(T[c]=_,r[c]=x,_<I&&(I=_),_>P&&(P=_),x<k&&(k=x),x>R&&(R=x));if(I>P||k>R)return this;for(this.cover(I,k).cover(P,R),c=0;c<m;++c)ED(this,T[c],r[c],s[c]);return this}function mH(s,n){if(isNaN(s=+s)||isNaN(n=+n))return this;var c=this._x0,m=this._y0,_=this._x1,x=this._y1;if(isNaN(c))_=(c=Math.floor(s))+1,x=(m=Math.floor(n))+1;else{for(var T=_-c||1,r=this._root,I,k;c>s||s>=_||m>n||n>=x;)switch(k=(n<m)<<1|s<c,I=new Array(4),I[k]=r,r=I,T*=2,k){case 0:_=c+T,x=m+T;break;case 1:c=_-T,x=m+T;break;case 2:_=c+T,m=x-T;break;case 3:c=_-T,m=x-T;break}this._root&&this._root.length&&(this._root=r)}return this._x0=c,this._y0=m,this._x1=_,this._y1=x,this}function gH(){var s=[];return this.visit(function(n){if(!n.length)do s.push(n.data);while(n=n.next)}),s}function _H(s){return arguments.length?this.cover(+s[0][0],+s[0][1]).cover(+s[1][0],+s[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function na(s,n,c,m,_){this.node=s,this.x0=n,this.y0=c,this.x1=m,this.y1=_}function yH(s,n,c){var m,_=this._x0,x=this._y0,T,r,I,k,P=this._x1,R=this._y1,F=[],V=this._root,W,G;for(V&&F.push(new na(V,_,x,P,R)),c==null?c=1/0:(_=s-c,x=n-c,P=s+c,R=n+c,c*=c);W=F.pop();)if(!(!(V=W.node)||(T=W.x0)>P||(r=W.y0)>R||(I=W.x1)<_||(k=W.y1)<x))if(V.length){var K=(T+I)/2,Y=(r+k)/2;F.push(new na(V[3],K,Y,I,k),new na(V[2],T,Y,K,k),new na(V[1],K,r,I,Y),new na(V[0],T,r,K,Y)),(G=(n>=Y)<<1|s>=K)&&(W=F[F.length-1],F[F.length-1]=F[F.length-1-G],F[F.length-1-G]=W)}else{var ne=s-+this._x.call(null,V.data),oe=n-+this._y.call(null,V.data),ce=ne*ne+oe*oe;if(ce<c){var me=Math.sqrt(c=ce);_=s-me,x=n-me,P=s+me,R=n+me,m=V.data}}return m}function vH(s){if(isNaN(P=+this._x.call(null,s))||isNaN(R=+this._y.call(null,s)))return this;var n,c=this._root,m,_,x,T=this._x0,r=this._y0,I=this._x1,k=this._y1,P,R,F,V,W,G,K,Y;if(!c)return this;if(c.length)for(;;){if((W=P>=(F=(T+I)/2))?T=F:I=F,(G=R>=(V=(r+k)/2))?r=V:k=V,n=c,!(c=c[K=G<<1|W]))return this;if(!c.length)break;(n[K+1&3]||n[K+2&3]||n[K+3&3])&&(m=n,Y=K)}for(;c.data!==s;)if(_=c,!(c=c.next))return this;return(x=c.next)&&delete c.next,_?(x?_.next=x:delete _.next,this):n?(x?n[K]=x:delete n[K],(c=n[0]||n[1]||n[2]||n[3])&&c===(n[3]||n[2]||n[1]||n[0])&&!c.length&&(m?m[Y]=c:this._root=c),this):(this._root=x,this)}function xH(s){for(var n=0,c=s.length;n<c;++n)this.remove(s[n]);return this}function bH(){return this._root}function wH(){var s=0;return this.visit(function(n){if(!n.length)do++s;while(n=n.next)}),s}function TH(s){var n=[],c,m=this._root,_,x,T,r,I;for(m&&n.push(new na(m,this._x0,this._y0,this._x1,this._y1));c=n.pop();)if(!s(m=c.node,x=c.x0,T=c.y0,r=c.x1,I=c.y1)&&m.length){var k=(x+r)/2,P=(T+I)/2;(_=m[3])&&n.push(new na(_,k,P,r,I)),(_=m[2])&&n.push(new na(_,x,P,k,I)),(_=m[1])&&n.push(new na(_,k,T,r,P)),(_=m[0])&&n.push(new na(_,x,T,k,P))}return this}function SH(s){var n=[],c=[],m;for(this._root&&n.push(new na(this._root,this._x0,this._y0,this._x1,this._y1));m=n.pop();){var _=m.node;if(_.length){var x,T=m.x0,r=m.y0,I=m.x1,k=m.y1,P=(T+I)/2,R=(r+k)/2;(x=_[0])&&n.push(new na(x,T,r,P,R)),(x=_[1])&&n.push(new na(x,P,r,I,R)),(x=_[2])&&n.push(new na(x,T,R,P,k)),(x=_[3])&&n.push(new na(x,P,R,I,k))}c.push(m)}for(;m=c.pop();)s(m.node,m.x0,m.y0,m.x1,m.y1);return this}function EH(s){return s[0]}function AH(s){return arguments.length?(this._x=s,this):this._x}function IH(s){return s[1]}function MH(s){return arguments.length?(this._y=s,this):this._y}function AD(s,n,c){var m=new nS(n??EH,c??IH,NaN,NaN,NaN,NaN);return s==null?m:m.addAll(s)}function nS(s,n,c,m,_,x){this._x=s,this._y=n,this._x0=c,this._y0=m,this._x1=_,this._y1=x,this._root=void 0}function iP(s){for(var n={data:s.data},c=n;s=s.next;)c=c.next={data:s.data};return n}var ia=AD.prototype=nS.prototype;ia.copy=function(){var s=new nS(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root,c,m;if(!n)return s;if(!n.length)return s._root=iP(n),s;for(c=[{source:n,target:s._root=new Array(4)}];n=c.pop();)for(var _=0;_<4;++_)(m=n.source[_])&&(m.length?c.push({source:m,target:n.target[_]=new Array(4)}):n.target[_]=iP(m));return s};ia.add=fH;ia.addAll=pH;ia.cover=mH;ia.data=gH;ia.extent=_H;ia.find=yH;ia.remove=vH;ia.removeAll=xH;ia.root=bH;ia.size=wH;ia.visit=TH;ia.visitAfter=SH;ia.x=AH;ia.y=MH;var CH=sr("<title> </title>"),PH=sr("<g><!></g>"),kH=sr("<svg><!><defs><!></defs><g><!></g></svg>");function t0(s,n){Yn(n,!0);let c=Re(n,"ref",15),m=Re(n,"innerRef",15),_=Re(n,"zIndex",3,0),x=Re(n,"ignoreTransform",3,!1),T=Re(n,"center",3,!1),r=bi(n,["$$slots","$$events","$$legacy","ref","innerRef","zIndex","pointerEvents","viewBox","ignoreTransform","center","class","title","defs","children"]),I=Mn(void 0),k=Mn(void 0);ki(()=>{c(A(I))}),ki(()=>{m(A(k))});const P=_o(),R=gx(),F=fe(()=>{if(R.mode==="canvas"&&!x())return`translate(${R.translate.x},${R.translate.y}) scale(${R.scale})`;if(T())return`translate(${T()==="x"||T()===!0?P.width/2:0}, ${T()==="y"||T()===!0?P.height/2:0})`});dS("svg");var V=kH();Ii(V,(_e,te)=>({viewBox:n.viewBox,width:P.containerWidth,height:P.containerHeight,class:_e,role:"figure",...r,[Ua]:te}),[()=>En(Cn("layout-svg"),"absolute top-0 left-0 overflow-visible",n.pointerEvents===!1&&"pointer-events-none",n.class),()=>({"z-index":_()})]);var W=Xn(V);{var G=_e=>{var te=Gt(),ie=yt(te);Dn(ie,()=>n.title),je(_e,te)},K=_e=>{var te=Gt(),ie=yt(te);{var xe=de=>{var Te=CH(),De=Xn(Te,!0);Ln(Te),Vi(Be=>{Pr(Te,0,Be),Es(De,n.title)},[()=>Cr(Cn("layout-svg-title"))]),je(de,Te)};Zt(ie,de=>{n.title&&de(xe)},!0)}je(_e,te)};Zt(W,_e=>{typeof n.title=="function"?_e(G):_e(K,!1)})}var Y=Tn(W),ne=Xn(Y);Dn(ne,()=>n.defs??Si),Ln(Y);var oe=Tn(Y),ce=Xn(oe);{var me=_e=>{var te=PH(),ie=Xn(te);Dn(ie,()=>n.children??Si,()=>({ref:A(I)})),Ln(te),Vi(xe=>{Gi(te,"transform",A(F)),Pr(te,0,xe)},[()=>Cr(Cn("layout-svg-g-transform"))]),je(_e,te)},ue=_e=>{var te=Gt(),ie=yt(te);Dn(ie,()=>n.children??Si,()=>({ref:A(I)})),je(_e,te)};Zt(ce,_e=>{A(F)?_e(me):_e(ue,!1)})}Ln(oe),er(oe,_e=>rn(k,_e),()=>A(k)),Ln(V),er(V,_e=>rn(I,_e),()=>A(I)),Vi(_e=>{Pr(oe,0,_e),Gi(oe,"transform",`translate(${P.padding.left??""}, ${P.padding.top??""})`)},[()=>Cr(Cn("layout-svg-g"))]),je(s,V),Kn()}const RH="rgb(0, 0, 0)",rP="__layerchart_canvas_styles_id",zH=["fill","fillOpacity","stroke","strokeWidth","opacity","fontWeight","fontSize","fontFamily","textAnchor","textAlign","paintOrder"];function DH(s,{styles:n,classes:c}={}){try{let m=document.getElementById(rP);return m||(m=document.createElementNS("http://www.w3.org/2000/svg","svg"),m.setAttribute("id",rP),m.style.display="none",s.after(m)),m=m,m.removeAttribute("style"),m.removeAttribute("class"),n&&Object.assign(m.style,n),m.style.display="none",c&&m.setAttribute("class",En(c).split(" ").filter(x=>!x.startsWith("transition-")).join(" ")),zH.reduce((x,T)=>(x[T]=window.getComputedStyle(m)[T],x),{})}catch(m){return console.error("Unable to get computed styles",m),{}}}function LH(s,{styles:n,classes:c}={}){return JSON.stringify({canvasId:s.id,styles:n,classes:c})}const M0=mx(DH,{cacheKey:([s,n])=>LH(s,n)});function _x(s,n,c={},{applyText:m}={}){let _;if(c.classes==null&&!Object.values(c.styles??{}).some(T=>typeof T=="string"&&T.includes("var(")))_=c.styles??{};else{const{constantStyles:T,variableStyles:r}=Object.entries(c.styles??{}).reduce((k,[P,R])=>(typeof R=="number"||typeof R=="string"&&!R.includes("var(")?k.constantStyles[P]=R:typeof R=="string"&&R.includes("var(")&&(k.variableStyles[P]=R),k),{constantStyles:{},variableStyles:{}});_={...M0(s.canvas,{styles:r,classes:c.classes}),...T}}const x=_?.paintOrder==="stroke"?["stroke","fill"]:["fill","stroke"];if(_?.opacity&&(s.globalAlpha=Number(_?.opacity)),m&&(s.font=`${_.fontWeight} ${_.fontSize} ${_.fontFamily}`,_.textAnchor==="middle"?s.textAlign="center":_.textAnchor==="end"?s.textAlign="right":s.textAlign=_.textAlign),_.strokeDasharray?.includes(",")){const T=_.strokeDasharray.split(",").map(r=>Number(r.replace("px","")));s.setLineDash(T)}for(const T of x)if(T==="fill"){const r=c.styles?.fill&&(c.styles?.fill instanceof CanvasGradient||c.styles?.fill instanceof CanvasPattern||!c.styles?.fill?.includes("var"))?c.styles.fill:_?.fill;if(r&&!["none",RH].includes(r)){const I=s.globalAlpha,k=Number(_?.fillOpacity),P=Number(_?.opacity);s.globalAlpha=k*P,s.fillStyle=r,n.fill(s),s.globalAlpha=I}}else if(T==="stroke"){const r=c.styles?.stroke&&(c.styles?.stroke instanceof CanvasGradient||!c.styles?.stroke?.includes("var"))?c.styles?.stroke:_?.stroke;r&&!["none"].includes(r)&&(s.lineWidth=typeof _?.strokeWidth=="string"?Number(_?.strokeWidth?.replace("px","")):_?.strokeWidth??1,s.strokeStyle=r,n.stroke(s))}}function T_(s,n,c={}){const m=new Path2D(n??"");_x(s,{fill:_=>_.fill(m),stroke:_=>_.stroke(m)},c)}function OH(s,n,c,m={}){n&&_x(s,{fill:_=>_.fillText(n.toString(),c.x,c.y),stroke:_=>_.strokeText(n.toString(),c.x,c.y)},m,{applyText:!0})}function FH(s,n,c={}){_x(s,{fill:m=>m.fillRect(n.x,n.y,n.width,n.height),stroke:m=>m.strokeRect(n.x,n.y,n.width,n.height)},c)}function ID(s,n,c={}){s.beginPath(),s.arc(n.cx,n.cy,n.r,0,2*Math.PI),_x(s,{fill:m=>{m.fill()},stroke:m=>{m.stroke()}},c),s.closePath()}function oP(s,n,c){const m=window.devicePixelRatio||1;return s.canvas.width=n*m,s.canvas.height=c*m,s.canvas.style.width=`${n}px`,s.canvas.style.height=`${c}px`,s.scale(m,m),{width:s.canvas.width,height:s.canvas.height}}function BH(s,n,c){const m=window.devicePixelRatio??1,_=s.getImageData(n*m,c*m,1,1),[x,T,r,I]=_.data;return{r:x,g:T,b:r,a:I}}function NH(s,n,c,m,_,x){const T=s.createLinearGradient(n,c,m,_);for(const{offset:r,color:I}of x)T.addColorStop(r,I);return T}const VH=mx(NH,{cacheKey:s=>JSON.stringify(s.slice(1))});function UH(s,n,c,m,_){const x=document.createElement("canvas"),T=x.getContext("2d");s.canvas.after(x),x.width=n,x.height=c,_&&(T.fillStyle=_,T.fillRect(0,0,n,c));for(const I of m)T.save(),I.type==="circle"?ID(T,{cx:I.cx,cy:I.cy,r:I.r},{styles:{fill:I.fill,opacity:I.opacity}}):I.type==="line"&&T_(T,I.path,{styles:{stroke:I.stroke,strokeWidth:I.strokeWidth,opacity:I.opacity}}),T.restore();const r=s.createPattern(x,"repeat");return s.canvas.parentElement?.removeChild(x),r}const jH=mx(UH,{cacheKey:s=>JSON.stringify(s.slice(1))});function*sP(s=500){let n=0;for(;n<16777216;){const c=n&255,m=(n&65280)>>8,_=(n&16711680)>>16;n+=s,yield{r:c,g:m,b:_,a:255}}return{r:0,g:0,b:0,a:255}}function aP(s){return s.a!==void 0?`rgba(${s.r},${s.g},${s.b},${s.a})`:`rgb(${s.r},${s.g},${s.b})`}const MD=new eh("CanvasContext"),GH={register:s=>()=>{},invalidate:()=>{}};function WH(){return MD.getOr(GH)}function qH(s){return MD.set(s)}function sc(s){const n=WH();ki(()=>Ia(()=>n.register(s)))}var HH=Un("<canvas><!></canvas> <canvas></canvas> <!>",1);function ZH(s,n){Yn(n,!0);let c=Re(n,"ref",15),m=Re(n,"canvasContext",15),_=Re(n,"willReadFrequently",3,!1),x=Re(n,"debug",3,!1),T=Re(n,"zIndex",3,0),r=Re(n,"pointerEvents",3,!0),I=Re(n,"center",3,!1),k=Re(n,"ignoreTransform",3,!1),P=Re(n,"disableHitCanvas",3,!1),R=bi(n,["$$slots","$$events","$$legacy","ref","canvasContext","willReadFrequently","debug","zIndex","pointerEvents","fallback","center","ignoreTransform","disableHitCanvas","class","children","onclick","ondblclick","onpointerenter","onpointermove","onpointerleave","onpointerdown","ontouchmove"]),F=Mn(void 0),V=Mn(void 0);ki(()=>{c(A(F))}),ki(()=>{m(A(V))});const W=_o(),G=gx(),K=new Zz("Canvas");let Y=new Map,ne=!1,oe,ce=Mn(void 0),me=Mn(void 0),ue=sP(),_e=Mn(!1),te=null;const ie=new Map;function xe(Je){const{x:Rt,y:ut}=jc(Je),cn=BH(A(me),Rt,ut),on=aP(cn),Jt=ie.get(on);return K.debug({colorKey:on,component:Jt,componentByColor:ie}),Jt}const de=Je=>{rn(_e,!0);const Rt=xe(Je);Rt!=te&&(te&&(te.events?.pointerleave?.(Je),te.events?.pointerout?.(Je)),Rt?.events?.pointerenter?.(Je),Rt?.events?.pointerover?.(Je)),Rt?.events?.pointermove?.(Je),te=Rt},Te=Je=>{te?.events?.pointerleave?.(Je),te?.events?.pointerout?.(Je),te=null,rn(_e,!1)},{dark:De}=new k8;eS(()=>De.current,()=>{Ne.invalidate()}),oH(()=>document.documentElement,()=>Ne.invalidate(),{attributes:!0,attributeFilter:["class","data-theme"]}),bp(()=>(rn(V,A(F)?.getContext("2d",{willReadFrequently:_()}),!0),rn(me,A(ce)?.getContext("2d",{willReadFrequently:!1}),!0),()=>{oe&&cancelAnimationFrame(oe)}));function Be(){if(!A(V))return;oP(A(V),W.containerWidth,W.containerHeight),A(V).clearRect(0,0,W.containerWidth,W.containerHeight),A(V).translate(W.padding.left??0,W.padding.top??0);let Je;I()?(Je={x:I()==="x"||I()===!0?W.width/2:0,y:I()==="y"||I()===!0?W.height/2:0},A(V).translate(Je.x,Je.y)):G.mode==="canvas"&&!k()&&(A(V).translate(G.translate.x,G.translate.y),A(V).scale(G.scale,G.scale));const Rt=[],ut=[];for(const[on,Jt]of Y)Jt.retainState?Rt.push(Jt):ut.push(Jt);for(const on of Rt)on.render(A(V));const cn=A(V).getTransform();for(const on of ut)A(V).save(),on.render(A(V)),A(V).restore();if(A(me)){const on=!A(_e)&&G.moving;if(P()||G.dragging||on)A(me).clearRect(0,0,W.containerWidth,W.containerHeight);else{oP(A(me),W.containerWidth,W.containerHeight),A(me).clearRect(0,0,W.containerWidth,W.containerHeight),A(me).resetTransform(),A(me).setTransform(cn),ue=sP();for(const Jt of Rt)Jt.events&&Object.values(Jt.events).filter(zt=>zt).length>0;for(const Jt of ut)if(Jt.events&&Object.values(Jt.events).filter(zt=>zt).length>0){const zt=aP(ue.next().value),fn={styles:{fill:zt,stroke:zt,_fillOpacity:.1}};A(me).save(),Jt.render(A(me),fn),A(me).restore(),ie.set(zt,Jt)}}}ne=!1}function Se(){function Je(ut){const cn=Symbol();Y.set(cn,ut),Rt();const on=m_(()=>{ut.deps&&ki(()=>{ut.deps?.(),Rt()})});return ki(()=>on),()=>{Y.delete(cn),on(),Rt()}}function Rt(){ne||(ne=!0,oe=requestAnimationFrame(Be))}return{register:Je,invalidate:Rt}}const Ne=Se();ki(()=>{W.height,W.width,W.containerHeight,W.containerWidth,G.dragging,Ne.invalidate()}),qH(Ne),dS("canvas");var it=HH(),qe=yt(it),ft=Je=>{xe(Je)?.events?.click?.(Je),n.onclick?.(Je)},St=Je=>{xe(Je)?.events?.dblclick?.(Je),n.ondblclick?.(Je)},Dt=Je=>{xe(Je)?.events?.pointerdown?.(Je),n.onpointerdown?.(Je)},Kt=Je=>{n.onpointerenter?.(Je),de(Je)},et=Je=>{n.onpointermove?.(Je),de(Je)},Qe=Je=>{n.onpointerleave?.(Je),Te(Je)},st=Je=>{te&&Je.preventDefault(),xe(Je)?.events?.touchmove?.(Je)};Ii(qe,(Je,Rt)=>({class:Je,onclick:ft,ondblclick:St,onpointerdown:Dt,onpointerenter:Kt,onpointermove:et,onpointerleave:Qe,ontouchmove:st,...R,[Ua]:Rt}),[()=>En(Cn("layout-canvas"),"absolute top-0 left-0 w-full h-full",r()===!1&&"pointer-events-none",n.class),()=>({"z-index":T()})]);var tt=Xn(qe);{var gt=Je=>{var Rt=Gt(),ut=yt(Rt);{var cn=Jt=>{var vt=Gt(),zt=yt(vt);Dn(zt,()=>n.fallback),je(Jt,vt)},on=Jt=>{var vt=Za();Vi(()=>Es(vt,n.fallback)),je(Jt,vt)};Zt(ut,Jt=>{typeof n.fallback=="function"?Jt(cn):Jt(on,!1)})}je(Je,Rt)};Zt(tt,Je=>{n.fallback&&Je(gt)})}Ln(qe),er(qe,Je=>rn(F,Je),()=>A(F));var Lt=Tn(qe,2);er(Lt,Je=>rn(ce,Je),()=>A(ce));var _t=Tn(Lt,2);Dn(_t,()=>n.children??Si,()=>({ref:A(F),canvasContext:A(V)})),Vi(Je=>Pr(Lt,1,Je),[()=>Cr(En(Cn("hit-canvas"),"layerchart-hitcanvas","absolute top-0 left-0 w-full h-full","pointer-events-none","border border-danger",!x()&&"opacity-0"))]),je(s,it),Kn()}function da(s){const n=fe(s),c=fe(()=>A(n)&&typeof A(n)=="object"?Yj(A(n)):A(n));return{get current(){return A(c)}}}var XH=sr("<rect></rect>");function cp(s,n){Yn(n,!0);let c=Re(n,"x",3,0),m=Re(n,"y",3,0),_=Re(n,"initialX",19,c),x=Re(n,"initialY",19,m),T=Re(n,"initialHeight",19,()=>n.height),r=Re(n,"initialWidth",19,()=>n.width),I=Re(n,"ref",15),k=bi(n,["$$slots","$$events","$$legacy","height","width","x","y","initialX","initialY","fill","fillOpacity","stroke","initialHeight","initialWidth","strokeWidth","opacity","ref","motion","class","onclick","ondblclick","onpointerenter","onpointermove","onpointerleave","onpointerover","onpointerout"]),P=Mn(void 0);ki(()=>{I(A(P))});const R=Vo(_(),()=>c(),Hu(n.motion,"x")),F=Vo(x(),()=>m(),Hu(n.motion,"y")),V=Vo(r(),()=>n.width,Hu(n.motion,"width")),W=Vo(T(),()=>n.height,Hu(n.motion,"height")),G=bl();function K(ue,_e){FH(ue,{x:R.current,y:F.current,width:V.current,height:W.current},_e?cd({styles:{strokeWidth:n.strokeWidth}},_e):{styles:{fill:n.fill,fillOpacity:n.fillOpacity,stroke:n.stroke,strokeWidth:n.strokeWidth,opacity:n.opacity},classes:n.class})}const Y=da(()=>n.fill),ne=da(()=>n.stroke);G==="canvas"&&sc({name:"Rect",render:K,events:{click:n.onclick,dblclick:n.ondblclick,pointerenter:n.onpointerenter,pointermove:n.onpointermove,pointerleave:n.onpointerleave,pointerover:n.onpointerover,pointerout:n.onpointerout},deps:()=>[R.current,F.current,V.current,W.current,Y.current,ne.current,n.strokeWidth,n.opacity,n.class]});var oe=Gt(),ce=yt(oe);{var me=ue=>{var _e=XH();Ii(_e,te=>({x:R.current,y:F.current,width:V.current,height:W.current,fill:n.fill,"fill-opacity":n.fillOpacity,stroke:n.stroke,"stroke-width":n.strokeWidth,opacity:n.opacity,class:te,...k,onclick:n.onclick,ondblclick:n.ondblclick,onpointerenter:n.onpointerenter,onpointermove:n.onpointermove,onpointerleave:n.onpointerleave,onpointerover:n.onpointerover,onpointerout:n.onpointerout}),[()=>En(Cn("rect"),n.fill==null&&"fill-surface-content",n.class)]),er(_e,te=>rn(P,te),()=>A(P)),je(ue,_e)};Zt(ce,ue=>{G==="svg"&&ue(me)})}je(s,oe),Kn()}function Ls(s,n){return`${s}-${n}`}var YH=sr("<use></use>"),KH=sr("<defs><clipPath><!><!></clipPath></defs>"),JH=sr("<g><!></g>"),QH=sr("<!><!>",1);function CD(s,n){const c=fa();Yn(n,!0);let m=Re(n,"id",19,()=>Ls("clipPath-",c)),_=Re(n,"disabled",3,!1),x=bi(n,["$$slots","$$events","$$legacy","id","useId","disabled","children","clip"]);const T=fe(()=>`url(#${m()})`),r=bl();var I=QH(),k=yt(I);{var P=V=>{var W=KH(),G=Xn(W);Ii(G,()=>({id:m(),...x}));var K=Xn(G);Dn(K,()=>n.clip??Si,()=>({id:m()}));var Y=Tn(K);{var ne=oe=>{var ce=YH();Vi(()=>Gi(ce,"href",`#${n.useId??""}`)),je(oe,ce)};Zt(Y,oe=>{n.useId&&oe(ne)})}Ln(G),Ln(W),je(V,W)};Zt(k,V=>{r==="svg"&&V(P)})}var R=Tn(k);{var F=V=>{var W=Gt(),G=yt(W);{var K=ne=>{var oe=Gt(),ce=yt(oe);Dn(ce,()=>n.children,()=>({id:m(),url:A(T),useId:n.useId})),je(ne,oe)},Y=ne=>{var oe=JH();let ce;var me=Xn(oe);Dn(me,()=>n.children,()=>({id:m(),url:A(T),useId:n.useId})),Ln(oe),Vi((ue,_e)=>{Pr(oe,0,ue),ce=_l(oe,"",ce,_e)},[()=>Cr(Cn("clip-path-g")),()=>({"clip-path":A(T)})]),je(ne,oe)};Zt(G,ne=>{_()||r!=="svg"?ne(K):ne(Y,!1)})}je(V,W)};Zt(R,V=>{n.children&&V(F)})}je(s,I),Kn()}function $H(s,n){const c=fa();Yn(n,!0);let m=Re(n,"id",19,()=>Ls("clipPath-",c)),_=Re(n,"x",3,0),x=Re(n,"y",3,0),T=Re(n,"disabled",3,!1),r=bi(n,["$$slots","$$events","$$legacy","id","x","y","disabled","children"]);CD(s,{get id(){return m()},get disabled(){return T()},clip:P=>{{let R=fe(()=>To(r,"clip-path-rect"));cp(P,Hn({get x(){return _()},get y(){return x()}},()=>A(R)))}},children:(P,R)=>{let F=()=>R?.().url;var V=Gt(),W=yt(V);Dn(W,()=>n.children??Si,()=>({id:m(),url:F()})),je(P,V)},$$slots:{clip:!0,default:!0}}),Kn()}function A2(s,n){Yn(n,!0);let c=Re(n,"full",3,!1),m=Re(n,"disabled",3,!1),_=bi(n,["$$slots","$$events","$$legacy","full","disabled"]);const x=_o();{let T=fe(()=>c()&&x.padding.left?-x.padding.left:0),r=fe(()=>c()&&x.padding.top?-x.padding.top:0),I=fe(()=>x.height+(c()?(x.padding?.top??0)+(x.padding?.bottom??0):0)),k=fe(()=>x.width+(c()?(x.padding?.left??0)+(x.padding?.right??0):0)),P=fe(()=>To(_,"chart-clip-path"));$H(s,Hn({get x(){return A(T)},get y(){return A(r)},get disabled(){return m()},get height(){return A(I)},get width(){return A(k)}},()=>A(P)))}Kn()}const qc=11102230246251565e-32,Ds=134217729,e9=(3+8*qc)*qc;function Ub(s,n,c,m,_){let x,T,r,I,k=n[0],P=m[0],R=0,F=0;P>k==P>-k?(x=k,k=n[++R]):(x=P,P=m[++F]);let V=0;if(R<s&&F<c)for(P>k==P>-k?(T=k+x,r=x-(T-k),k=n[++R]):(T=P+x,r=x-(T-P),P=m[++F]),x=T,r!==0&&(_[V++]=r);R<s&&F<c;)P>k==P>-k?(T=x+k,I=T-x,r=x-(T-I)+(k-I),k=n[++R]):(T=x+P,I=T-x,r=x-(T-I)+(P-I),P=m[++F]),x=T,r!==0&&(_[V++]=r);for(;R<s;)T=x+k,I=T-x,r=x-(T-I)+(k-I),k=n[++R],x=T,r!==0&&(_[V++]=r);for(;F<c;)T=x+P,I=T-x,r=x-(T-I)+(P-I),P=m[++F],x=T,r!==0&&(_[V++]=r);return(x!==0||V===0)&&(_[V++]=x),V}function t9(s,n){let c=n[0];for(let m=1;m<s;m++)c+=n[m];return c}function S_(s){return new Float64Array(s)}const n9=(3+16*qc)*qc,i9=(2+12*qc)*qc,r9=(9+64*qc)*qc*qc,Yf=S_(4),lP=S_(8),cP=S_(12),uP=S_(16),Js=S_(4);function o9(s,n,c,m,_,x,T){let r,I,k,P,R,F,V,W,G,K,Y,ne,oe,ce,me,ue,_e,te;const ie=s-_,xe=c-_,de=n-x,Te=m-x;ce=ie*Te,F=Ds*ie,V=F-(F-ie),W=ie-V,F=Ds*Te,G=F-(F-Te),K=Te-G,me=W*K-(ce-V*G-W*G-V*K),ue=de*xe,F=Ds*de,V=F-(F-de),W=de-V,F=Ds*xe,G=F-(F-xe),K=xe-G,_e=W*K-(ue-V*G-W*G-V*K),Y=me-_e,R=me-Y,Yf[0]=me-(Y+R)+(R-_e),ne=ce+Y,R=ne-ce,oe=ce-(ne-R)+(Y-R),Y=oe-ue,R=oe-Y,Yf[1]=oe-(Y+R)+(R-ue),te=ne+Y,R=te-ne,Yf[2]=ne-(te-R)+(Y-R),Yf[3]=te;let De=t9(4,Yf),Be=i9*T;if(De>=Be||-De>=Be||(R=s-ie,r=s-(ie+R)+(R-_),R=c-xe,k=c-(xe+R)+(R-_),R=n-de,I=n-(de+R)+(R-x),R=m-Te,P=m-(Te+R)+(R-x),r===0&&I===0&&k===0&&P===0)||(Be=r9*T+e9*Math.abs(De),De+=ie*P+Te*r-(de*k+xe*I),De>=Be||-De>=Be))return De;ce=r*Te,F=Ds*r,V=F-(F-r),W=r-V,F=Ds*Te,G=F-(F-Te),K=Te-G,me=W*K-(ce-V*G-W*G-V*K),ue=I*xe,F=Ds*I,V=F-(F-I),W=I-V,F=Ds*xe,G=F-(F-xe),K=xe-G,_e=W*K-(ue-V*G-W*G-V*K),Y=me-_e,R=me-Y,Js[0]=me-(Y+R)+(R-_e),ne=ce+Y,R=ne-ce,oe=ce-(ne-R)+(Y-R),Y=oe-ue,R=oe-Y,Js[1]=oe-(Y+R)+(R-ue),te=ne+Y,R=te-ne,Js[2]=ne-(te-R)+(Y-R),Js[3]=te;const Se=Ub(4,Yf,4,Js,lP);ce=ie*P,F=Ds*ie,V=F-(F-ie),W=ie-V,F=Ds*P,G=F-(F-P),K=P-G,me=W*K-(ce-V*G-W*G-V*K),ue=de*k,F=Ds*de,V=F-(F-de),W=de-V,F=Ds*k,G=F-(F-k),K=k-G,_e=W*K-(ue-V*G-W*G-V*K),Y=me-_e,R=me-Y,Js[0]=me-(Y+R)+(R-_e),ne=ce+Y,R=ne-ce,oe=ce-(ne-R)+(Y-R),Y=oe-ue,R=oe-Y,Js[1]=oe-(Y+R)+(R-ue),te=ne+Y,R=te-ne,Js[2]=ne-(te-R)+(Y-R),Js[3]=te;const Ne=Ub(Se,lP,4,Js,cP);ce=r*P,F=Ds*r,V=F-(F-r),W=r-V,F=Ds*P,G=F-(F-P),K=P-G,me=W*K-(ce-V*G-W*G-V*K),ue=I*k,F=Ds*I,V=F-(F-I),W=I-V,F=Ds*k,G=F-(F-k),K=k-G,_e=W*K-(ue-V*G-W*G-V*K),Y=me-_e,R=me-Y,Js[0]=me-(Y+R)+(R-_e),ne=ce+Y,R=ne-ce,oe=ce-(ne-R)+(Y-R),Y=oe-ue,R=oe-Y,Js[1]=oe-(Y+R)+(R-ue),te=ne+Y,R=te-ne,Js[2]=ne-(te-R)+(Y-R),Js[3]=te;const it=Ub(Ne,cP,4,Js,uP);return uP[it-1]}function Uv(s,n,c,m,_,x){const T=(n-x)*(c-_),r=(s-_)*(m-x),I=T-r,k=Math.abs(T+r);return Math.abs(I)>=n9*k?I:-o9(s,n,c,m,_,x,k)}const hP=Math.pow(2,-52),jv=new Uint32Array(512);class C0{static from(n,c=u9,m=h9){const _=n.length,x=new Float64Array(_*2);for(let T=0;T<_;T++){const r=n[T];x[2*T]=c(r),x[2*T+1]=m(r)}return new C0(x)}constructor(n){const c=n.length>>1;if(c>0&&typeof n[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=n;const m=Math.max(2*c-5,0);this._triangles=new Uint32Array(m*3),this._halfedges=new Int32Array(m*3),this._hashSize=Math.ceil(Math.sqrt(c)),this._hullPrev=new Uint32Array(c),this._hullNext=new Uint32Array(c),this._hullTri=new Uint32Array(c),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(c),this._dists=new Float64Array(c),this.update()}update(){const{coords:n,_hullPrev:c,_hullNext:m,_hullTri:_,_hullHash:x}=this,T=n.length>>1;let r=1/0,I=1/0,k=-1/0,P=-1/0;for(let ie=0;ie<T;ie++){const xe=n[2*ie],de=n[2*ie+1];xe<r&&(r=xe),de<I&&(I=de),xe>k&&(k=xe),de>P&&(P=de),this._ids[ie]=ie}const R=(r+k)/2,F=(I+P)/2;let V,W,G;for(let ie=0,xe=1/0;ie<T;ie++){const de=jb(R,F,n[2*ie],n[2*ie+1]);de<xe&&(V=ie,xe=de)}const K=n[2*V],Y=n[2*V+1];for(let ie=0,xe=1/0;ie<T;ie++){if(ie===V)continue;const de=jb(K,Y,n[2*ie],n[2*ie+1]);de<xe&&de>0&&(W=ie,xe=de)}let ne=n[2*W],oe=n[2*W+1],ce=1/0;for(let ie=0;ie<T;ie++){if(ie===V||ie===W)continue;const xe=l9(K,Y,ne,oe,n[2*ie],n[2*ie+1]);xe<ce&&(G=ie,ce=xe)}let me=n[2*G],ue=n[2*G+1];if(ce===1/0){for(let de=0;de<T;de++)this._dists[de]=n[2*de]-n[0]||n[2*de+1]-n[1];op(this._ids,this._dists,0,T-1);const ie=new Uint32Array(T);let xe=0;for(let de=0,Te=-1/0;de<T;de++){const De=this._ids[de],Be=this._dists[De];Be>Te&&(ie[xe++]=De,Te=Be)}this.hull=ie.subarray(0,xe),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Uv(K,Y,ne,oe,me,ue)<0){const ie=W,xe=ne,de=oe;W=G,ne=me,oe=ue,G=ie,me=xe,ue=de}const _e=c9(K,Y,ne,oe,me,ue);this._cx=_e.x,this._cy=_e.y;for(let ie=0;ie<T;ie++)this._dists[ie]=jb(n[2*ie],n[2*ie+1],_e.x,_e.y);op(this._ids,this._dists,0,T-1),this._hullStart=V;let te=3;m[V]=c[G]=W,m[W]=c[V]=G,m[G]=c[W]=V,_[V]=0,_[W]=1,_[G]=2,x.fill(-1),x[this._hashKey(K,Y)]=V,x[this._hashKey(ne,oe)]=W,x[this._hashKey(me,ue)]=G,this.trianglesLen=0,this._addTriangle(V,W,G,-1,-1,-1);for(let ie=0,xe,de;ie<this._ids.length;ie++){const Te=this._ids[ie],De=n[2*Te],Be=n[2*Te+1];if(ie>0&&Math.abs(De-xe)<=hP&&Math.abs(Be-de)<=hP||(xe=De,de=Be,Te===V||Te===W||Te===G))continue;let Se=0;for(let St=0,Dt=this._hashKey(De,Be);St<this._hashSize&&(Se=x[(Dt+St)%this._hashSize],!(Se!==-1&&Se!==m[Se]));St++);Se=c[Se];let Ne=Se,it;for(;it=m[Ne],Uv(De,Be,n[2*Ne],n[2*Ne+1],n[2*it],n[2*it+1])>=0;)if(Ne=it,Ne===Se){Ne=-1;break}if(Ne===-1)continue;let qe=this._addTriangle(Ne,Te,m[Ne],-1,-1,_[Ne]);_[Te]=this._legalize(qe+2),_[Ne]=qe,te++;let ft=m[Ne];for(;it=m[ft],Uv(De,Be,n[2*ft],n[2*ft+1],n[2*it],n[2*it+1])<0;)qe=this._addTriangle(ft,Te,it,_[Te],-1,_[ft]),_[Te]=this._legalize(qe+2),m[ft]=ft,te--,ft=it;if(Ne===Se)for(;it=c[Ne],Uv(De,Be,n[2*it],n[2*it+1],n[2*Ne],n[2*Ne+1])<0;)qe=this._addTriangle(it,Te,Ne,-1,_[Ne],_[it]),this._legalize(qe+2),_[it]=qe,m[Ne]=Ne,te--,Ne=it;this._hullStart=c[Te]=Ne,m[Ne]=c[ft]=Te,m[Te]=ft,x[this._hashKey(De,Be)]=Te,x[this._hashKey(n[2*Ne],n[2*Ne+1])]=Ne}this.hull=new Uint32Array(te);for(let ie=0,xe=this._hullStart;ie<te;ie++)this.hull[ie]=xe,xe=m[xe];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(n,c){return Math.floor(s9(n-this._cx,c-this._cy)*this._hashSize)%this._hashSize}_legalize(n){const{_triangles:c,_halfedges:m,coords:_}=this;let x=0,T=0;for(;;){const r=m[n],I=n-n%3;if(T=I+(n+2)%3,r===-1){if(x===0)break;n=jv[--x];continue}const k=r-r%3,P=I+(n+1)%3,R=k+(r+2)%3,F=c[T],V=c[n],W=c[P],G=c[R];if(a9(_[2*F],_[2*F+1],_[2*V],_[2*V+1],_[2*W],_[2*W+1],_[2*G],_[2*G+1])){c[n]=G,c[r]=F;const Y=m[R];if(Y===-1){let oe=this._hullStart;do{if(this._hullTri[oe]===R){this._hullTri[oe]=n;break}oe=this._hullPrev[oe]}while(oe!==this._hullStart)}this._link(n,Y),this._link(r,m[T]),this._link(T,R);const ne=k+(r+1)%3;x<jv.length&&(jv[x++]=ne)}else{if(x===0)break;n=jv[--x]}}return T}_link(n,c){this._halfedges[n]=c,c!==-1&&(this._halfedges[c]=n)}_addTriangle(n,c,m,_,x,T){const r=this.trianglesLen;return this._triangles[r]=n,this._triangles[r+1]=c,this._triangles[r+2]=m,this._link(r,_),this._link(r+1,x),this._link(r+2,T),this.trianglesLen+=3,r}}function s9(s,n){const c=s/(Math.abs(s)+Math.abs(n));return(n>0?3-c:1+c)/4}function jb(s,n,c,m){const _=s-c,x=n-m;return _*_+x*x}function a9(s,n,c,m,_,x,T,r){const I=s-T,k=n-r,P=c-T,R=m-r,F=_-T,V=x-r,W=I*I+k*k,G=P*P+R*R,K=F*F+V*V;return I*(R*K-G*V)-k*(P*K-G*F)+W*(P*V-R*F)<0}function l9(s,n,c,m,_,x){const T=c-s,r=m-n,I=_-s,k=x-n,P=T*T+r*r,R=I*I+k*k,F=.5/(T*k-r*I),V=(k*P-r*R)*F,W=(T*R-I*P)*F;return V*V+W*W}function c9(s,n,c,m,_,x){const T=c-s,r=m-n,I=_-s,k=x-n,P=T*T+r*r,R=I*I+k*k,F=.5/(T*k-r*I),V=s+(k*P-r*R)*F,W=n+(T*R-I*P)*F;return{x:V,y:W}}function op(s,n,c,m){if(m-c<=20)for(let _=c+1;_<=m;_++){const x=s[_],T=n[x];let r=_-1;for(;r>=c&&n[s[r]]>T;)s[r+1]=s[r--];s[r+1]=x}else{const _=c+m>>1;let x=c+1,T=m;zg(s,_,x),n[s[c]]>n[s[m]]&&zg(s,c,m),n[s[x]]>n[s[m]]&&zg(s,x,m),n[s[c]]>n[s[x]]&&zg(s,c,x);const r=s[x],I=n[r];for(;;){do x++;while(n[s[x]]<I);do T--;while(n[s[T]]>I);if(T<x)break;zg(s,x,T)}s[c+1]=s[T],s[T]=r,m-x+1>=T-c?(op(s,n,x,m),op(s,n,c,T-1)):(op(s,n,c,T-1),op(s,n,x,m))}}function zg(s,n,c){const m=s[n];s[n]=s[c],s[c]=m}function u9(s){return s[0]}function h9(s){return s[1]}const dP=1e-6;class $h{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(n,c){this._+=`M${this._x0=this._x1=+n},${this._y0=this._y1=+c}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(n,c){this._+=`L${this._x1=+n},${this._y1=+c}`}arc(n,c,m){n=+n,c=+c,m=+m;const _=n+m,x=c;if(m<0)throw new Error("negative radius");this._x1===null?this._+=`M${_},${x}`:(Math.abs(this._x1-_)>dP||Math.abs(this._y1-x)>dP)&&(this._+="L"+_+","+x),m&&(this._+=`A${m},${m},0,1,1,${n-m},${c}A${m},${m},0,1,1,${this._x1=_},${this._y1=x}`)}rect(n,c,m,_){this._+=`M${this._x0=this._x1=+n},${this._y0=this._y1=+c}h${+m}v${+_}h${-m}Z`}value(){return this._||null}}class I2{constructor(){this._=[]}moveTo(n,c){this._.push([n,c])}closePath(){this._.push(this._[0].slice())}lineTo(n,c){this._.push([n,c])}value(){return this._.length?this._:null}}let d9=class{constructor(n,[c,m,_,x]=[0,0,960,500]){if(!((_=+_)>=(c=+c))||!((x=+x)>=(m=+m)))throw new Error("invalid bounds");this.delaunay=n,this._circumcenters=new Float64Array(n.points.length*2),this.vectors=new Float64Array(n.points.length*2),this.xmax=_,this.xmin=c,this.ymax=x,this.ymin=m,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:n,hull:c,triangles:m},vectors:_}=this;let x,T;const r=this.circumcenters=this._circumcenters.subarray(0,m.length/3*2);for(let G=0,K=0,Y=m.length,ne,oe;G<Y;G+=3,K+=2){const ce=m[G]*2,me=m[G+1]*2,ue=m[G+2]*2,_e=n[ce],te=n[ce+1],ie=n[me],xe=n[me+1],de=n[ue],Te=n[ue+1],De=ie-_e,Be=xe-te,Se=de-_e,Ne=Te-te,it=(De*Ne-Be*Se)*2;if(Math.abs(it)<1e-9){if(x===void 0){x=T=0;for(const ft of c)x+=n[ft*2],T+=n[ft*2+1];x/=c.length,T/=c.length}const qe=1e9*Math.sign((x-_e)*Ne-(T-te)*Se);ne=(_e+de)/2-qe*Ne,oe=(te+Te)/2+qe*Se}else{const qe=1/it,ft=De*De+Be*Be,St=Se*Se+Ne*Ne;ne=_e+(Ne*ft-Be*St)*qe,oe=te+(De*St-Se*ft)*qe}r[K]=ne,r[K+1]=oe}let I=c[c.length-1],k,P=I*4,R,F=n[2*I],V,W=n[2*I+1];_.fill(0);for(let G=0;G<c.length;++G)I=c[G],k=P,R=F,V=W,P=I*4,F=n[2*I],W=n[2*I+1],_[k+2]=_[P]=V-W,_[k+3]=_[P+1]=F-R}render(n){const c=n==null?n=new $h:void 0,{delaunay:{halfedges:m,inedges:_,hull:x},circumcenters:T,vectors:r}=this;if(x.length<=1)return null;for(let P=0,R=m.length;P<R;++P){const F=m[P];if(F<P)continue;const V=Math.floor(P/3)*2,W=Math.floor(F/3)*2,G=T[V],K=T[V+1],Y=T[W],ne=T[W+1];this._renderSegment(G,K,Y,ne,n)}let I,k=x[x.length-1];for(let P=0;P<x.length;++P){I=k,k=x[P];const R=Math.floor(_[k]/3)*2,F=T[R],V=T[R+1],W=I*4,G=this._project(F,V,r[W+2],r[W+3]);G&&this._renderSegment(F,V,G[0],G[1],n)}return c&&c.value()}renderBounds(n){const c=n==null?n=new $h:void 0;return n.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),c&&c.value()}renderCell(n,c){const m=c==null?c=new $h:void 0,_=this._clip(n);if(_===null||!_.length)return;c.moveTo(_[0],_[1]);let x=_.length;for(;_[0]===_[x-2]&&_[1]===_[x-1]&&x>1;)x-=2;for(let T=2;T<x;T+=2)(_[T]!==_[T-2]||_[T+1]!==_[T-1])&&c.lineTo(_[T],_[T+1]);return c.closePath(),m&&m.value()}*cellPolygons(){const{delaunay:{points:n}}=this;for(let c=0,m=n.length/2;c<m;++c){const _=this.cellPolygon(c);_&&(_.index=c,yield _)}}cellPolygon(n){const c=new I2;return this.renderCell(n,c),c.value()}_renderSegment(n,c,m,_,x){let T;const r=this._regioncode(n,c),I=this._regioncode(m,_);r===0&&I===0?(x.moveTo(n,c),x.lineTo(m,_)):(T=this._clipSegment(n,c,m,_,r,I))&&(x.moveTo(T[0],T[1]),x.lineTo(T[2],T[3]))}contains(n,c,m){return c=+c,c!==c||(m=+m,m!==m)?!1:this.delaunay._step(n,c,m)===n}*neighbors(n){const c=this._clip(n);if(c)for(const m of this.delaunay.neighbors(n)){const _=this._clip(m);if(_){e:for(let x=0,T=c.length;x<T;x+=2)for(let r=0,I=_.length;r<I;r+=2)if(c[x]===_[r]&&c[x+1]===_[r+1]&&c[(x+2)%T]===_[(r+I-2)%I]&&c[(x+3)%T]===_[(r+I-1)%I]){yield m;break e}}}}_cell(n){const{circumcenters:c,delaunay:{inedges:m,halfedges:_,triangles:x}}=this,T=m[n];if(T===-1)return null;const r=[];let I=T;do{const k=Math.floor(I/3);if(r.push(c[k*2],c[k*2+1]),I=I%3===2?I-2:I+1,x[I]!==n)break;I=_[I]}while(I!==T&&I!==-1);return r}_clip(n){if(n===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const c=this._cell(n);if(c===null)return null;const{vectors:m}=this,_=n*4;return this._simplify(m[_]||m[_+1]?this._clipInfinite(n,c,m[_],m[_+1],m[_+2],m[_+3]):this._clipFinite(n,c))}_clipFinite(n,c){const m=c.length;let _=null,x,T,r=c[m-2],I=c[m-1],k,P=this._regioncode(r,I),R,F=0;for(let V=0;V<m;V+=2)if(x=r,T=I,r=c[V],I=c[V+1],k=P,P=this._regioncode(r,I),k===0&&P===0)R=F,F=0,_?_.push(r,I):_=[r,I];else{let W,G,K,Y,ne;if(k===0){if((W=this._clipSegment(x,T,r,I,k,P))===null)continue;[G,K,Y,ne]=W}else{if((W=this._clipSegment(r,I,x,T,P,k))===null)continue;[Y,ne,G,K]=W,R=F,F=this._edgecode(G,K),R&&F&&this._edge(n,R,F,_,_.length),_?_.push(G,K):_=[G,K]}R=F,F=this._edgecode(Y,ne),R&&F&&this._edge(n,R,F,_,_.length),_?_.push(Y,ne):_=[Y,ne]}if(_)R=F,F=this._edgecode(_[0],_[1]),R&&F&&this._edge(n,R,F,_,_.length);else if(this.contains(n,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return _}_clipSegment(n,c,m,_,x,T){const r=x<T;for(r&&([n,c,m,_,x,T]=[m,_,n,c,T,x]);;){if(x===0&&T===0)return r?[m,_,n,c]:[n,c,m,_];if(x&T)return null;let I,k,P=x||T;P&8?(I=n+(m-n)*(this.ymax-c)/(_-c),k=this.ymax):P&4?(I=n+(m-n)*(this.ymin-c)/(_-c),k=this.ymin):P&2?(k=c+(_-c)*(this.xmax-n)/(m-n),I=this.xmax):(k=c+(_-c)*(this.xmin-n)/(m-n),I=this.xmin),x?(n=I,c=k,x=this._regioncode(n,c)):(m=I,_=k,T=this._regioncode(m,_))}}_clipInfinite(n,c,m,_,x,T){let r=Array.from(c),I;if((I=this._project(r[0],r[1],m,_))&&r.unshift(I[0],I[1]),(I=this._project(r[r.length-2],r[r.length-1],x,T))&&r.push(I[0],I[1]),r=this._clipFinite(n,r))for(let k=0,P=r.length,R,F=this._edgecode(r[P-2],r[P-1]);k<P;k+=2)R=F,F=this._edgecode(r[k],r[k+1]),R&&F&&(k=this._edge(n,R,F,r,k),P=r.length);else this.contains(n,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(r=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return r}_edge(n,c,m,_,x){for(;c!==m;){let T,r;switch(c){case 5:c=4;continue;case 4:c=6,T=this.xmax,r=this.ymin;break;case 6:c=2;continue;case 2:c=10,T=this.xmax,r=this.ymax;break;case 10:c=8;continue;case 8:c=9,T=this.xmin,r=this.ymax;break;case 9:c=1;continue;case 1:c=5,T=this.xmin,r=this.ymin;break}(_[x]!==T||_[x+1]!==r)&&this.contains(n,T,r)&&(_.splice(x,0,T,r),x+=2)}return x}_project(n,c,m,_){let x=1/0,T,r,I;if(_<0){if(c<=this.ymin)return null;(T=(this.ymin-c)/_)<x&&(I=this.ymin,r=n+(x=T)*m)}else if(_>0){if(c>=this.ymax)return null;(T=(this.ymax-c)/_)<x&&(I=this.ymax,r=n+(x=T)*m)}if(m>0){if(n>=this.xmax)return null;(T=(this.xmax-n)/m)<x&&(r=this.xmax,I=c+(x=T)*_)}else if(m<0){if(n<=this.xmin)return null;(T=(this.xmin-n)/m)<x&&(r=this.xmin,I=c+(x=T)*_)}return[r,I]}_edgecode(n,c){return(n===this.xmin?1:n===this.xmax?2:0)|(c===this.ymin?4:c===this.ymax?8:0)}_regioncode(n,c){return(n<this.xmin?1:n>this.xmax?2:0)|(c<this.ymin?4:c>this.ymax?8:0)}_simplify(n){if(n&&n.length>4){for(let c=0;c<n.length;c+=2){const m=(c+2)%n.length,_=(c+4)%n.length;(n[c]===n[m]&&n[m]===n[_]||n[c+1]===n[m+1]&&n[m+1]===n[_+1])&&(n.splice(m,2),c-=2)}n.length||(n=null)}return n}};const f9=2*Math.PI,Kf=Math.pow;function p9(s){return s[0]}function m9(s){return s[1]}function g9(s){const{triangles:n,coords:c}=s;for(let m=0;m<n.length;m+=3){const _=2*n[m],x=2*n[m+1],T=2*n[m+2];if((c[T]-c[_])*(c[x+1]-c[_+1])-(c[x]-c[_])*(c[T+1]-c[_+1])>1e-10)return!1}return!0}function _9(s,n,c){return[s+Math.sin(s+n)*c,n+Math.cos(s-n)*c]}class yx{static from(n,c=p9,m=m9,_){return new yx("length"in n?y9(n,c,m,_):Float64Array.from(v9(n,c,m,_)))}constructor(n){this._delaunator=new C0(n),this.inedges=new Int32Array(n.length/2),this._hullIndex=new Int32Array(n.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const n=this._delaunator,c=this.points;if(n.hull&&n.hull.length>2&&g9(n)){this.collinear=Int32Array.from({length:c.length/2},(F,V)=>V).sort((F,V)=>c[2*F]-c[2*V]||c[2*F+1]-c[2*V+1]);const I=this.collinear[0],k=this.collinear[this.collinear.length-1],P=[c[2*I],c[2*I+1],c[2*k],c[2*k+1]],R=1e-8*Math.hypot(P[3]-P[1],P[2]-P[0]);for(let F=0,V=c.length/2;F<V;++F){const W=_9(c[2*F],c[2*F+1],R);c[2*F]=W[0],c[2*F+1]=W[1]}this._delaunator=new C0(c)}else delete this.collinear;const m=this.halfedges=this._delaunator.halfedges,_=this.hull=this._delaunator.hull,x=this.triangles=this._delaunator.triangles,T=this.inedges.fill(-1),r=this._hullIndex.fill(-1);for(let I=0,k=m.length;I<k;++I){const P=x[I%3===2?I-2:I+1];(m[I]===-1||T[P]===-1)&&(T[P]=I)}for(let I=0,k=_.length;I<k;++I)r[_[I]]=I;_.length<=2&&_.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=_[0],T[_[0]]=1,_.length===2&&(T[_[1]]=0,this.triangles[1]=_[1],this.triangles[2]=_[1]))}voronoi(n){return new d9(this,n)}*neighbors(n){const{inedges:c,hull:m,_hullIndex:_,halfedges:x,triangles:T,collinear:r}=this;if(r){const R=r.indexOf(n);R>0&&(yield r[R-1]),R<r.length-1&&(yield r[R+1]);return}const I=c[n];if(I===-1)return;let k=I,P=-1;do{if(yield P=T[k],k=k%3===2?k-2:k+1,T[k]!==n)return;if(k=x[k],k===-1){const R=m[(_[n]+1)%m.length];R!==P&&(yield R);return}}while(k!==I)}find(n,c,m=0){if(n=+n,n!==n||(c=+c,c!==c))return-1;const _=m;let x;for(;(x=this._step(m,n,c))>=0&&x!==m&&x!==_;)m=x;return x}_step(n,c,m){const{inedges:_,hull:x,_hullIndex:T,halfedges:r,triangles:I,points:k}=this;if(_[n]===-1||!k.length)return(n+1)%(k.length>>1);let P=n,R=Kf(c-k[n*2],2)+Kf(m-k[n*2+1],2);const F=_[n];let V=F;do{let W=I[V];const G=Kf(c-k[W*2],2)+Kf(m-k[W*2+1],2);if(G<R&&(R=G,P=W),V=V%3===2?V-2:V+1,I[V]!==n)break;if(V=r[V],V===-1){if(V=x[(T[n]+1)%x.length],V!==W&&Kf(c-k[V*2],2)+Kf(m-k[V*2+1],2)<R)return V;break}}while(V!==F);return P}render(n){const c=n==null?n=new $h:void 0,{points:m,halfedges:_,triangles:x}=this;for(let T=0,r=_.length;T<r;++T){const I=_[T];if(I<T)continue;const k=x[T]*2,P=x[I]*2;n.moveTo(m[k],m[k+1]),n.lineTo(m[P],m[P+1])}return this.renderHull(n),c&&c.value()}renderPoints(n,c){c===void 0&&(!n||typeof n.moveTo!="function")&&(c=n,n=null),c=c==null?2:+c;const m=n==null?n=new $h:void 0,{points:_}=this;for(let x=0,T=_.length;x<T;x+=2){const r=_[x],I=_[x+1];n.moveTo(r+c,I),n.arc(r,I,c,0,f9)}return m&&m.value()}renderHull(n){const c=n==null?n=new $h:void 0,{hull:m,points:_}=this,x=m[0]*2,T=m.length;n.moveTo(_[x],_[x+1]);for(let r=1;r<T;++r){const I=2*m[r];n.lineTo(_[I],_[I+1])}return n.closePath(),c&&c.value()}hullPolygon(){const n=new I2;return this.renderHull(n),n.value()}renderTriangle(n,c){const m=c==null?c=new $h:void 0,{points:_,triangles:x}=this,T=x[n*=3]*2,r=x[n+1]*2,I=x[n+2]*2;return c.moveTo(_[T],_[T+1]),c.lineTo(_[r],_[r+1]),c.lineTo(_[I],_[I+1]),c.closePath(),m&&m.value()}*trianglePolygons(){const{triangles:n}=this;for(let c=0,m=n.length/3;c<m;++c)yield this.trianglePolygon(c)}trianglePolygon(n){const c=new I2;return this.renderTriangle(n,c),c.value()}}function y9(s,n,c,m){const _=s.length,x=new Float64Array(_*2);for(let T=0;T<_;++T){const r=s[T];x[T*2]=n.call(m,r,T,s),x[T*2+1]=c.call(m,r,T,s)}return x}function*v9(s,n,c,m){let _=0;for(const x of s)yield n.call(m,x,_,s),yield c.call(m,x,_,s),++_}var go=1e-6,M2=1e-12,Wr=Math.PI,Ha=Wr/2,fP=Wr/4,vl=Wr*2,Qs=180/Wr,Nr=Wr/180,Oo=Math.abs,PD=Math.atan,Jc=Math.atan2,kr=Math.cos,C2=Math.hypot,Rr=Math.sin,x9=Math.sign||function(s){return s>0?1:s<0?-1:0},fd=Math.sqrt;function b9(s){return s>1?0:s<-1?Wr:Math.acos(s)}function Qu(s){return s>1?Ha:s<-1?-Ha:Math.asin(s)}function Ga(){}function P0(s,n){s&&mP.hasOwnProperty(s.type)&&mP[s.type](s,n)}var pP={Feature:function(s,n){P0(s.geometry,n)},FeatureCollection:function(s,n){for(var c=s.features,m=-1,_=c.length;++m<_;)P0(c[m].geometry,n)}},mP={Sphere:function(s,n){n.sphere()},Point:function(s,n){s=s.coordinates,n.point(s[0],s[1],s[2])},MultiPoint:function(s,n){for(var c=s.coordinates,m=-1,_=c.length;++m<_;)s=c[m],n.point(s[0],s[1],s[2])},LineString:function(s,n){P2(s.coordinates,n,0)},MultiLineString:function(s,n){for(var c=s.coordinates,m=-1,_=c.length;++m<_;)P2(c[m],n,0)},Polygon:function(s,n){gP(s.coordinates,n)},MultiPolygon:function(s,n){for(var c=s.coordinates,m=-1,_=c.length;++m<_;)gP(c[m],n)},GeometryCollection:function(s,n){for(var c=s.geometries,m=-1,_=c.length;++m<_;)P0(c[m],n)}};function P2(s,n,c){var m=-1,_=s.length-c,x;for(n.lineStart();++m<_;)x=s[m],n.point(x[0],x[1],x[2]);n.lineEnd()}function gP(s,n){var c=-1,m=s.length;for(n.polygonStart();++c<m;)P2(s[c],n,1);n.polygonEnd()}function iS(s,n){s&&pP.hasOwnProperty(s.type)?pP[s.type](s,n):P0(s,n)}function k2(s){return[Jc(s[1],s[0]),Qu(s[2])]}function gp(s){var n=s[0],c=s[1],m=kr(c);return[m*kr(n),m*Rr(n),Rr(c)]}function Gv(s,n){return s[0]*n[0]+s[1]*n[1]+s[2]*n[2]}function k0(s,n){return[s[1]*n[2]-s[2]*n[1],s[2]*n[0]-s[0]*n[2],s[0]*n[1]-s[1]*n[0]]}function Gb(s,n){s[0]+=n[0],s[1]+=n[1],s[2]+=n[2]}function Wv(s,n){return[s[0]*n,s[1]*n,s[2]*n]}function R2(s){var n=fd(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);s[0]/=n,s[1]/=n,s[2]/=n}var Ng,R0,z0,D0,L0,O0,F0,B0,z2,D2,L2,kD,RD,$s,ea,ta,fl={sphere:Ga,point:rS,lineStart:_P,lineEnd:yP,polygonStart:function(){fl.lineStart=S9,fl.lineEnd=E9},polygonEnd:function(){fl.lineStart=_P,fl.lineEnd=yP}};function rS(s,n){s*=Nr,n*=Nr;var c=kr(n);E_(c*kr(s),c*Rr(s),Rr(n))}function E_(s,n,c){++Ng,z0+=(s-z0)/Ng,D0+=(n-D0)/Ng,L0+=(c-L0)/Ng}function _P(){fl.point=w9}function w9(s,n){s*=Nr,n*=Nr;var c=kr(n);$s=c*kr(s),ea=c*Rr(s),ta=Rr(n),fl.point=T9,E_($s,ea,ta)}function T9(s,n){s*=Nr,n*=Nr;var c=kr(n),m=c*kr(s),_=c*Rr(s),x=Rr(n),T=Jc(fd((T=ea*x-ta*_)*T+(T=ta*m-$s*x)*T+(T=$s*_-ea*m)*T),$s*m+ea*_+ta*x);R0+=T,O0+=T*($s+($s=m)),F0+=T*(ea+(ea=_)),B0+=T*(ta+(ta=x)),E_($s,ea,ta)}function yP(){fl.point=rS}function S9(){fl.point=A9}function E9(){zD(kD,RD),fl.point=rS}function A9(s,n){kD=s,RD=n,s*=Nr,n*=Nr,fl.point=zD;var c=kr(n);$s=c*kr(s),ea=c*Rr(s),ta=Rr(n),E_($s,ea,ta)}function zD(s,n){s*=Nr,n*=Nr;var c=kr(n),m=c*kr(s),_=c*Rr(s),x=Rr(n),T=ea*x-ta*_,r=ta*m-$s*x,I=$s*_-ea*m,k=C2(T,r,I),P=Qu(k),R=k&&-P/k;z2.add(R*T),D2.add(R*r),L2.add(R*I),R0+=P,O0+=P*($s+($s=m)),F0+=P*(ea+(ea=_)),B0+=P*(ta+(ta=x)),E_($s,ea,ta)}function vP(s){Ng=R0=z0=D0=L0=O0=F0=B0=0,z2=new ml,D2=new ml,L2=new ml,iS(s,fl);var n=+z2,c=+D2,m=+L2,_=C2(n,c,m);return _<M2&&(n=O0,c=F0,m=B0,R0<go&&(n=z0,c=D0,m=L0),_=C2(n,c,m),_<M2)?[NaN,NaN]:[Jc(c,n)*Qs,Qu(m/_)*Qs]}function O2(s,n){function c(m,_){return m=s(m,_),n(m[0],m[1])}return s.invert&&n.invert&&(c.invert=function(m,_){return m=n.invert(m,_),m&&s.invert(m[0],m[1])}),c}function F2(s,n){return Oo(s)>Wr&&(s-=Math.round(s/vl)*vl),[s,n]}F2.invert=F2;function DD(s,n,c){return(s%=vl)?n||c?O2(bP(s),wP(n,c)):bP(s):n||c?wP(n,c):F2}function xP(s){return function(n,c){return n+=s,Oo(n)>Wr&&(n-=Math.round(n/vl)*vl),[n,c]}}function bP(s){var n=xP(s);return n.invert=xP(-s),n}function wP(s,n){var c=kr(s),m=Rr(s),_=kr(n),x=Rr(n);function T(r,I){var k=kr(I),P=kr(r)*k,R=Rr(r)*k,F=Rr(I),V=F*c+P*m;return[Jc(R*_-V*x,P*c-F*m),Qu(V*_+R*x)]}return T.invert=function(r,I){var k=kr(I),P=kr(r)*k,R=Rr(r)*k,F=Rr(I),V=F*_-R*x;return[Jc(R*_+F*x,P*c+V*m),Qu(V*c-P*m)]},T}function I9(s){s=DD(s[0]*Nr,s[1]*Nr,s.length>2?s[2]*Nr:0);function n(c){return c=s(c[0]*Nr,c[1]*Nr),c[0]*=Qs,c[1]*=Qs,c}return n.invert=function(c){return c=s.invert(c[0]*Nr,c[1]*Nr),c[0]*=Qs,c[1]*=Qs,c},n}function M9(s,n,c,m,_,x){if(c){var T=kr(n),r=Rr(n),I=m*c;_==null?(_=n+m*vl,x=n-I/2):(_=TP(T,_),x=TP(T,x),(m>0?_<x:_>x)&&(_+=m*vl));for(var k,P=_;m>0?P>x:P<x;P-=I)k=k2([T,-r*kr(P),-r*Rr(P)]),s.point(k[0],k[1])}}function TP(s,n){n=gp(n),n[0]-=s,R2(n);var c=b9(-n[1]);return((-n[2]<0?-c:c)+vl-go)%vl}function LD(){var s=[],n;return{point:function(c,m,_){n.push([c,m,_])},lineStart:function(){s.push(n=[])},lineEnd:Ga,rejoin:function(){s.length>1&&s.push(s.pop().concat(s.shift()))},result:function(){var c=s;return s=[],n=null,c}}}function n0(s,n){return Oo(s[0]-n[0])<go&&Oo(s[1]-n[1])<go}function qv(s,n,c,m){this.x=s,this.z=n,this.o=c,this.e=m,this.v=!1,this.n=this.p=null}function OD(s,n,c,m,_){var x=[],T=[],r,I;if(s.forEach(function(W){if(!((G=W.length-1)<=0)){var G,K=W[0],Y=W[G],ne;if(n0(K,Y)){if(!K[2]&&!Y[2]){for(_.lineStart(),r=0;r<G;++r)_.point((K=W[r])[0],K[1]);_.lineEnd();return}Y[0]+=2*go}x.push(ne=new qv(K,W,null,!0)),T.push(ne.o=new qv(K,null,ne,!1)),x.push(ne=new qv(Y,W,null,!1)),T.push(ne.o=new qv(Y,null,ne,!0))}}),!!x.length){for(T.sort(n),SP(x),SP(T),r=0,I=T.length;r<I;++r)T[r].e=c=!c;for(var k=x[0],P,R;;){for(var F=k,V=!0;F.v;)if((F=F.n)===k)return;P=F.z,_.lineStart();do{if(F.v=F.o.v=!0,F.e){if(V)for(r=0,I=P.length;r<I;++r)_.point((R=P[r])[0],R[1]);else m(F.x,F.n.x,1,_);F=F.n}else{if(V)for(P=F.p.z,r=P.length-1;r>=0;--r)_.point((R=P[r])[0],R[1]);else m(F.x,F.p.x,-1,_);F=F.p}F=F.o,P=F.z,V=!V}while(!F.v);_.lineEnd()}}}function SP(s){if(n=s.length){for(var n,c=0,m=s[0],_;++c<n;)m.n=_=s[c],_.p=m,m=_;m.n=_=s[0],_.p=m}}function Wb(s){return Oo(s[0])<=Wr?s[0]:x9(s[0])*((Oo(s[0])+Wr)%vl-Wr)}function C9(s,n){var c=Wb(n),m=n[1],_=Rr(m),x=[Rr(c),-kr(c),0],T=0,r=0,I=new ml;_===1?m=Ha+go:_===-1&&(m=-Ha-go);for(var k=0,P=s.length;k<P;++k)if(F=(R=s[k]).length)for(var R,F,V=R[F-1],W=Wb(V),G=V[1]/2+fP,K=Rr(G),Y=kr(G),ne=0;ne<F;++ne,W=ce,K=ue,Y=_e,V=oe){var oe=R[ne],ce=Wb(oe),me=oe[1]/2+fP,ue=Rr(me),_e=kr(me),te=ce-W,ie=te>=0?1:-1,xe=ie*te,de=xe>Wr,Te=K*ue;if(I.add(Jc(Te*ie*Rr(xe),Y*_e+Te*kr(xe))),T+=de?te+ie*vl:te,de^W>=c^ce>=c){var De=k0(gp(V),gp(oe));R2(De);var Be=k0(x,De);R2(Be);var Se=(de^te>=0?-1:1)*Qu(Be[2]);(m>Se||m===Se&&(De[0]||De[1]))&&(r+=de^te>=0?1:-1)}}return(T<-go||T<go&&I<-M2)^r&1}function FD(s,n,c,m){return function(_){var x=n(_),T=LD(),r=n(T),I=!1,k,P,R,F={point:V,lineStart:G,lineEnd:K,polygonStart:function(){F.point=Y,F.lineStart=ne,F.lineEnd=oe,P=[],k=[]},polygonEnd:function(){F.point=V,F.lineStart=G,F.lineEnd=K,P=hz(P);var ce=C9(k,m);P.length?(I||(_.polygonStart(),I=!0),OD(P,k9,ce,c,_)):ce&&(I||(_.polygonStart(),I=!0),_.lineStart(),c(null,null,1,_),_.lineEnd()),I&&(_.polygonEnd(),I=!1),P=k=null},sphere:function(){_.polygonStart(),_.lineStart(),c(null,null,1,_),_.lineEnd(),_.polygonEnd()}};function V(ce,me){s(ce,me)&&_.point(ce,me)}function W(ce,me){x.point(ce,me)}function G(){F.point=W,x.lineStart()}function K(){F.point=V,x.lineEnd()}function Y(ce,me){R.push([ce,me]),r.point(ce,me)}function ne(){r.lineStart(),R=[]}function oe(){Y(R[0][0],R[0][1]),r.lineEnd();var ce=r.clean(),me=T.result(),ue,_e=me.length,te,ie,xe;if(R.pop(),k.push(R),R=null,!!_e){if(ce&1){if(ie=me[0],(te=ie.length-1)>0){for(I||(_.polygonStart(),I=!0),_.lineStart(),ue=0;ue<te;++ue)_.point((xe=ie[ue])[0],xe[1]);_.lineEnd()}return}_e>1&&ce&2&&me.push(me.pop().concat(me.shift())),P.push(me.filter(P9))}}return F}}function P9(s){return s.length>1}function k9(s,n){return((s=s.x)[0]<0?s[1]-Ha-go:Ha-s[1])-((n=n.x)[0]<0?n[1]-Ha-go:Ha-n[1])}const EP=FD(function(){return!0},R9,D9,[-Wr,-Ha]);function R9(s){var n=NaN,c=NaN,m=NaN,_;return{lineStart:function(){s.lineStart(),_=1},point:function(x,T){var r=x>0?Wr:-Wr,I=Oo(x-n);Oo(I-Wr)<go?(s.point(n,c=(c+T)/2>0?Ha:-Ha),s.point(m,c),s.lineEnd(),s.lineStart(),s.point(r,c),s.point(x,c),_=0):m!==r&&I>=Wr&&(Oo(n-m)<go&&(n-=m*go),Oo(x-r)<go&&(x-=r*go),c=z9(n,c,x,T),s.point(m,c),s.lineEnd(),s.lineStart(),s.point(r,c),_=0),s.point(n=x,c=T),m=r},lineEnd:function(){s.lineEnd(),n=c=NaN},clean:function(){return 2-_}}}function z9(s,n,c,m){var _,x,T=Rr(s-c);return Oo(T)>go?PD((Rr(n)*(x=kr(m))*Rr(c)-Rr(m)*(_=kr(n))*Rr(s))/(_*x*T)):(n+m)/2}function D9(s,n,c,m){var _;if(s==null)_=c*Ha,m.point(-Wr,_),m.point(0,_),m.point(Wr,_),m.point(Wr,0),m.point(Wr,-_),m.point(0,-_),m.point(-Wr,-_),m.point(-Wr,0),m.point(-Wr,_);else if(Oo(s[0]-n[0])>go){var x=s[0]<n[0]?Wr:-Wr;_=c*x/2,m.point(-x,_),m.point(0,_),m.point(x,_)}else m.point(n[0],n[1])}function L9(s){var n=kr(s),c=2*Nr,m=n>0,_=Oo(n)>go;function x(P,R,F,V){M9(V,s,c,F,P,R)}function T(P,R){return kr(P)*kr(R)>n}function r(P){var R,F,V,W,G;return{lineStart:function(){W=V=!1,G=1},point:function(K,Y){var ne=[K,Y],oe,ce=T(K,Y),me=m?ce?0:k(K,Y):ce?k(K+(K<0?Wr:-Wr),Y):0;if(!R&&(W=V=ce)&&P.lineStart(),ce!==V&&(oe=I(R,ne),(!oe||n0(R,oe)||n0(ne,oe))&&(ne[2]=1)),ce!==V)G=0,ce?(P.lineStart(),oe=I(ne,R),P.point(oe[0],oe[1])):(oe=I(R,ne),P.point(oe[0],oe[1],2),P.lineEnd()),R=oe;else if(_&&R&&m^ce){var ue;!(me&F)&&(ue=I(ne,R,!0))&&(G=0,m?(P.lineStart(),P.point(ue[0][0],ue[0][1]),P.point(ue[1][0],ue[1][1]),P.lineEnd()):(P.point(ue[1][0],ue[1][1]),P.lineEnd(),P.lineStart(),P.point(ue[0][0],ue[0][1],3)))}ce&&(!R||!n0(R,ne))&&P.point(ne[0],ne[1]),R=ne,V=ce,F=me},lineEnd:function(){V&&P.lineEnd(),R=null},clean:function(){return G|(W&&V)<<1}}}function I(P,R,F){var V=gp(P),W=gp(R),G=[1,0,0],K=k0(V,W),Y=Gv(K,K),ne=K[0],oe=Y-ne*ne;if(!oe)return!F&&P;var ce=n*Y/oe,me=-n*ne/oe,ue=k0(G,K),_e=Wv(G,ce),te=Wv(K,me);Gb(_e,te);var ie=ue,xe=Gv(_e,ie),de=Gv(ie,ie),Te=xe*xe-de*(Gv(_e,_e)-1);if(!(Te<0)){var De=fd(Te),Be=Wv(ie,(-xe-De)/de);if(Gb(Be,_e),Be=k2(Be),!F)return Be;var Se=P[0],Ne=R[0],it=P[1],qe=R[1],ft;Ne<Se&&(ft=Se,Se=Ne,Ne=ft);var St=Ne-Se,Dt=Oo(St-Wr)<go,Kt=Dt||St<go;if(!Dt&&qe<it&&(ft=it,it=qe,qe=ft),Kt?Dt?it+qe>0^Be[1]<(Oo(Be[0]-Se)<go?it:qe):it<=Be[1]&&Be[1]<=qe:St>Wr^(Se<=Be[0]&&Be[0]<=Ne)){var et=Wv(ie,(-xe+De)/de);return Gb(et,_e),[Be,k2(et)]}}}function k(P,R){var F=m?s:Wr-s,V=0;return P<-F?V|=1:P>F&&(V|=2),R<-F?V|=4:R>F&&(V|=8),V}return FD(T,r,x,m?[0,-s]:[-Wr,s-Wr])}function O9(s,n,c,m,_,x){var T=s[0],r=s[1],I=n[0],k=n[1],P=0,R=1,F=I-T,V=k-r,W;if(W=c-T,!(!F&&W>0)){if(W/=F,F<0){if(W<P)return;W<R&&(R=W)}else if(F>0){if(W>R)return;W>P&&(P=W)}if(W=_-T,!(!F&&W<0)){if(W/=F,F<0){if(W>R)return;W>P&&(P=W)}else if(F>0){if(W<P)return;W<R&&(R=W)}if(W=m-r,!(!V&&W>0)){if(W/=V,V<0){if(W<P)return;W<R&&(R=W)}else if(V>0){if(W>R)return;W>P&&(P=W)}if(W=x-r,!(!V&&W<0)){if(W/=V,V<0){if(W>R)return;W>P&&(P=W)}else if(V>0){if(W<P)return;W<R&&(R=W)}return P>0&&(s[0]=T+P*F,s[1]=r+P*V),R<1&&(n[0]=T+R*F,n[1]=r+R*V),!0}}}}}var Vg=1e9,Hv=-Vg;function F9(s,n,c,m){function _(k,P){return s<=k&&k<=c&&n<=P&&P<=m}function x(k,P,R,F){var V=0,W=0;if(k==null||(V=T(k,R))!==(W=T(P,R))||I(k,P)<0^R>0)do F.point(V===0||V===3?s:c,V>1?m:n);while((V=(V+R+4)%4)!==W);else F.point(P[0],P[1])}function T(k,P){return Oo(k[0]-s)<go?P>0?0:3:Oo(k[0]-c)<go?P>0?2:1:Oo(k[1]-n)<go?P>0?1:0:P>0?3:2}function r(k,P){return I(k.x,P.x)}function I(k,P){var R=T(k,1),F=T(P,1);return R!==F?R-F:R===0?P[1]-k[1]:R===1?k[0]-P[0]:R===2?k[1]-P[1]:P[0]-k[0]}return function(k){var P=k,R=LD(),F,V,W,G,K,Y,ne,oe,ce,me,ue,_e={point:te,lineStart:Te,lineEnd:De,polygonStart:xe,polygonEnd:de};function te(Se,Ne){_(Se,Ne)&&P.point(Se,Ne)}function ie(){for(var Se=0,Ne=0,it=V.length;Ne<it;++Ne)for(var qe=V[Ne],ft=1,St=qe.length,Dt=qe[0],Kt,et,Qe=Dt[0],st=Dt[1];ft<St;++ft)Kt=Qe,et=st,Dt=qe[ft],Qe=Dt[0],st=Dt[1],et<=m?st>m&&(Qe-Kt)*(m-et)>(st-et)*(s-Kt)&&++Se:st<=m&&(Qe-Kt)*(m-et)<(st-et)*(s-Kt)&&--Se;return Se}function xe(){P=R,F=[],V=[],ue=!0}function de(){var Se=ie(),Ne=ue&&Se,it=(F=hz(F)).length;(Ne||it)&&(k.polygonStart(),Ne&&(k.lineStart(),x(null,null,1,k),k.lineEnd()),it&&OD(F,r,Se,x,k),k.polygonEnd()),P=k,F=V=W=null}function Te(){_e.point=Be,V&&V.push(W=[]),me=!0,ce=!1,ne=oe=NaN}function De(){F&&(Be(G,K),Y&&ce&&R.rejoin(),F.push(R.result())),_e.point=te,ce&&P.lineEnd()}function Be(Se,Ne){var it=_(Se,Ne);if(V&&W.push([Se,Ne]),me)G=Se,K=Ne,Y=it,me=!1,it&&(P.lineStart(),P.point(Se,Ne));else if(it&&ce)P.point(Se,Ne);else{var qe=[ne=Math.max(Hv,Math.min(Vg,ne)),oe=Math.max(Hv,Math.min(Vg,oe))],ft=[Se=Math.max(Hv,Math.min(Vg,Se)),Ne=Math.max(Hv,Math.min(Vg,Ne))];O9(qe,ft,s,n,c,m)?(ce||(P.lineStart(),P.point(qe[0],qe[1])),P.point(ft[0],ft[1]),it||P.lineEnd(),ue=!1):it&&(P.lineStart(),P.point(Se,Ne),ue=!1)}ne=Se,oe=Ne,ce=it}return _e}}var B2,N2,i0,r0,_p={sphere:Ga,point:Ga,lineStart:B9,lineEnd:Ga,polygonStart:Ga,polygonEnd:Ga};function B9(){_p.point=V9,_p.lineEnd=N9}function N9(){_p.point=_p.lineEnd=Ga}function V9(s,n){s*=Nr,n*=Nr,N2=s,i0=Rr(n),r0=kr(n),_p.point=U9}function U9(s,n){s*=Nr,n*=Nr;var c=Rr(n),m=kr(n),_=Oo(s-N2),x=kr(_),T=Rr(_),r=m*T,I=r0*c-i0*m*x,k=i0*c+r0*m*x;B2.add(Jc(fd(r*r+I*I),k)),N2=s,i0=c,r0=m}function j9(s){return B2=new ml,iS(s,_p),+B2}var V2=[null,null],G9={type:"LineString",coordinates:V2};function AP(s,n){return V2[0]=s,V2[1]=n,j9(G9)}const IP=s=>s;var yp=1/0,N0=yp,d_=-yp,V0=d_,MP={point:W9,lineStart:Ga,lineEnd:Ga,polygonStart:Ga,polygonEnd:Ga,result:function(){var s=[[yp,N0],[d_,V0]];return d_=V0=-(N0=yp=1/0),s}};function W9(s,n){s<yp&&(yp=s),s>d_&&(d_=s),n<N0&&(N0=n),n>V0&&(V0=n)}function oS(s){return function(n){var c=new U2;for(var m in s)c[m]=s[m];return c.stream=n,c}}function U2(){}U2.prototype={constructor:U2,point:function(s,n){this.stream.point(s,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function sS(s,n,c){var m=s.clipExtent&&s.clipExtent();return s.scale(150).translate([0,0]),m!=null&&s.clipExtent(null),iS(c,s.stream(MP)),n(MP.result()),m!=null&&s.clipExtent(m),s}function BD(s,n,c){return sS(s,function(m){var _=n[1][0]-n[0][0],x=n[1][1]-n[0][1],T=Math.min(_/(m[1][0]-m[0][0]),x/(m[1][1]-m[0][1])),r=+n[0][0]+(_-T*(m[1][0]+m[0][0]))/2,I=+n[0][1]+(x-T*(m[1][1]+m[0][1]))/2;s.scale(150*T).translate([r,I])},c)}function q9(s,n,c){return BD(s,[[0,0],n],c)}function H9(s,n,c){return sS(s,function(m){var _=+n,x=_/(m[1][0]-m[0][0]),T=(_-x*(m[1][0]+m[0][0]))/2,r=-x*m[0][1];s.scale(150*x).translate([T,r])},c)}function Z9(s,n,c){return sS(s,function(m){var _=+n,x=_/(m[1][1]-m[0][1]),T=-x*m[0][0],r=(_-x*(m[1][1]+m[0][1]))/2;s.scale(150*x).translate([T,r])},c)}var CP=16,X9=kr(30*Nr);function PP(s,n){return+n?K9(s,n):Y9(s)}function Y9(s){return oS({point:function(n,c){n=s(n,c),this.stream.point(n[0],n[1])}})}function K9(s,n){function c(m,_,x,T,r,I,k,P,R,F,V,W,G,K){var Y=k-m,ne=P-_,oe=Y*Y+ne*ne;if(oe>4*n&&G--){var ce=T+F,me=r+V,ue=I+W,_e=fd(ce*ce+me*me+ue*ue),te=Qu(ue/=_e),ie=Oo(Oo(ue)-1)<go||Oo(x-R)<go?(x+R)/2:Jc(me,ce),xe=s(ie,te),de=xe[0],Te=xe[1],De=de-m,Be=Te-_,Se=ne*De-Y*Be;(Se*Se/oe>n||Oo((Y*De+ne*Be)/oe-.5)>.3||T*F+r*V+I*W<X9)&&(c(m,_,x,T,r,I,de,Te,ie,ce/=_e,me/=_e,ue,G,K),K.point(de,Te),c(de,Te,ie,ce,me,ue,k,P,R,F,V,W,G,K))}}return function(m){var _,x,T,r,I,k,P,R,F,V,W,G,K={point:Y,lineStart:ne,lineEnd:ce,polygonStart:function(){m.polygonStart(),K.lineStart=me},polygonEnd:function(){m.polygonEnd(),K.lineStart=ne}};function Y(te,ie){te=s(te,ie),m.point(te[0],te[1])}function ne(){R=NaN,K.point=oe,m.lineStart()}function oe(te,ie){var xe=gp([te,ie]),de=s(te,ie);c(R,F,P,V,W,G,R=de[0],F=de[1],P=te,V=xe[0],W=xe[1],G=xe[2],CP,m),m.point(R,F)}function ce(){K.point=Y,m.lineEnd()}function me(){ne(),K.point=ue,K.lineEnd=_e}function ue(te,ie){oe(_=te,ie),x=R,T=F,r=V,I=W,k=G,K.point=oe}function _e(){c(R,F,P,V,W,G,x,T,_,r,I,k,CP,m),K.lineEnd=ce,ce()}return K}}var J9=oS({point:function(s,n){this.stream.point(s*Nr,n*Nr)}});function Q9(s){return oS({point:function(n,c){var m=s(n,c);return this.stream.point(m[0],m[1])}})}function $9(s,n,c,m,_){function x(T,r){return T*=m,r*=_,[n+s*T,c-s*r]}return x.invert=function(T,r){return[(T-n)/s*m,(c-r)/s*_]},x}function kP(s,n,c,m,_,x){if(!x)return $9(s,n,c,m,_);var T=kr(x),r=Rr(x),I=T*s,k=r*s,P=T/s,R=r/s,F=(r*c-T*n)/s,V=(r*n+T*c)/s;function W(G,K){return G*=m,K*=_,[I*G-k*K+n,c-k*G-I*K]}return W.invert=function(G,K){return[m*(P*G-R*K+F),_*(V-R*G-P*K)]},W}function e7(s){return t7(function(){return s})()}function t7(s){var n,c=150,m=480,_=250,x=0,T=0,r=0,I=0,k=0,P,R=0,F=1,V=1,W=null,G=EP,K=null,Y,ne,oe,ce=IP,me=.5,ue,_e,te,ie,xe;function de(Se){return te(Se[0]*Nr,Se[1]*Nr)}function Te(Se){return Se=te.invert(Se[0],Se[1]),Se&&[Se[0]*Qs,Se[1]*Qs]}de.stream=function(Se){return ie&&xe===Se?ie:ie=J9(Q9(P)(G(ue(ce(xe=Se)))))},de.preclip=function(Se){return arguments.length?(G=Se,W=void 0,Be()):G},de.postclip=function(Se){return arguments.length?(ce=Se,K=Y=ne=oe=null,Be()):ce},de.clipAngle=function(Se){return arguments.length?(G=+Se?L9(W=Se*Nr):(W=null,EP),Be()):W*Qs},de.clipExtent=function(Se){return arguments.length?(ce=Se==null?(K=Y=ne=oe=null,IP):F9(K=+Se[0][0],Y=+Se[0][1],ne=+Se[1][0],oe=+Se[1][1]),Be()):K==null?null:[[K,Y],[ne,oe]]},de.scale=function(Se){return arguments.length?(c=+Se,De()):c},de.translate=function(Se){return arguments.length?(m=+Se[0],_=+Se[1],De()):[m,_]},de.center=function(Se){return arguments.length?(x=Se[0]%360*Nr,T=Se[1]%360*Nr,De()):[x*Qs,T*Qs]},de.rotate=function(Se){return arguments.length?(r=Se[0]%360*Nr,I=Se[1]%360*Nr,k=Se.length>2?Se[2]%360*Nr:0,De()):[r*Qs,I*Qs,k*Qs]},de.angle=function(Se){return arguments.length?(R=Se%360*Nr,De()):R*Qs},de.reflectX=function(Se){return arguments.length?(F=Se?-1:1,De()):F<0},de.reflectY=function(Se){return arguments.length?(V=Se?-1:1,De()):V<0},de.precision=function(Se){return arguments.length?(ue=PP(_e,me=Se*Se),Be()):fd(me)},de.fitExtent=function(Se,Ne){return BD(de,Se,Ne)},de.fitSize=function(Se,Ne){return q9(de,Se,Ne)},de.fitWidth=function(Se,Ne){return H9(de,Se,Ne)},de.fitHeight=function(Se,Ne){return Z9(de,Se,Ne)};function De(){var Se=kP(c,0,0,F,V,R).apply(null,n(x,T)),Ne=kP(c,m-Se[0],_-Se[1],F,V,R);return P=DD(r,I,k),_e=O2(n,Ne),te=O2(P,_e),ue=PP(_e,me),Be()}function Be(){return ie=xe=null,de}return function(){return n=s.apply(this,arguments),de.invert=n.invert&&Te,De()}}function n7(s){return function(n,c){var m=fd(n*n+c*c),_=s(m),x=Rr(_),T=kr(_);return[Jc(n*x,m*T),Qu(m&&c*x/m)]}}function ND(s,n){var c=kr(n),m=1+kr(s)*c;return[c*Rr(s)/m,Rr(n)/m]}ND.invert=n7(function(s){return 2*PD(s)});function i7(){return e7(ND).scale(250).clipAngle(142)}const aS=Math.PI,RP=aS/2,zP=180/aS,DP=aS/180,r7=Math.atan2,LP=Math.cos,o7=Math.max,s7=Math.min,OP=Math.sin,a7=Math.sign||function(s){return s>0?1:s<0?-1:0},VD=Math.sqrt;function l7(s){return s>1?RP:s<-1?-RP:Math.asin(s)}function UD(s,n){return s[0]*n[0]+s[1]*n[1]+s[2]*n[2]}function Aa(s,n){return[s[1]*n[2]-s[2]*n[1],s[2]*n[0]-s[0]*n[2],s[0]*n[1]-s[1]*n[0]]}function U0(s,n){return[s[0]+n[0],s[1]+n[1],s[2]+n[2]]}function j0(s){var n=VD(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);return[s[0]/n,s[1]/n,s[2]/n]}function lS(s){return[r7(s[1],s[0])*zP,l7(o7(-1,s7(1,s[2])))*zP]}function rc(s){const n=s[0]*DP,c=s[1]*DP,m=LP(c);return[m*LP(n),m*OP(n),OP(c)]}function cS(s){return s=s.map(n=>rc(n)),UD(s[0],Aa(s[2],s[1]))}function c7(s){const n=h7(s),c=f7(n),m=d7(c,s),_=m7(c,s.length),x=u7(_,s),T=p7(c,s),{polygons:r,centers:I}=g7(T,c,s),k=_7(r),P=v7(c,s),R=y7(m,c);return{delaunay:n,edges:m,triangles:c,centers:I,neighbors:_,polygons:r,mesh:k,hull:P,urquhart:R,find:x}}function u7(s,n){function c(m,_){let x=m[0]-_[0],T=m[1]-_[1],r=m[2]-_[2];return x*x+T*T+r*r}return function(_,x,T){T===void 0&&(T=0);let r,I,k=T;const P=rc([_,x]);do r=T,T=null,I=c(P,rc(n[r])),s[r].forEach(R=>{let F=c(P,rc(n[R]));if(F<I){I=F,T=R,k=R;return}});while(T!==null);return k}}function h7(s){if(s.length<2)return{};let n=0;for(;isNaN(s[n][0]+s[n][1])&&n++<s.length;);const c=I9(s[n]),m=i7().translate([0,0]).scale(1).rotate(c.invert([180,0]));s=s.map(m);const _=[];let x=1;for(let R=0,F=s.length;R<F;R++){let V=s[R][0]**2+s[R][1]**2;!isFinite(V)||V>1e32?_.push(R):V>x&&(x=V)}const T=1e6*VD(x);_.forEach(R=>s[R]=[T,0]),s.push([0,T]),s.push([-T,0]),s.push([0,-T]);const r=yx.from(s);r.projection=m;const{triangles:I,halfedges:k,inedges:P}=r;for(let R=0,F=k.length;R<F;R++)if(k[R]<0){const V=R%3==2?R-2:R+1,W=R%3==0?R+2:R-1,G=k[V],K=k[W];k[G]=K,k[K]=G,k[V]=k[W]=-1,I[R]=I[V]=I[W]=n,P[I[G]]=G%3==0?G+2:G-1,P[I[K]]=K%3==0?K+2:K-1,R+=2-R%3}else I[R]>s.length-3-1&&(I[R]=n);return r}function d7(s,n){const c=new Set;return n.length===2?[[0,1]]:(s.forEach(m=>{if(m[0]!==m[1]&&!(cS(m.map(_=>n[_]))<0))for(let _=0,x;_<3;_++)x=(_+1)%3,c.add(Xa([m[_],m[x]]).join("-"))}),Array.from(c,m=>m.split("-").map(Number)))}function f7(s){const{triangles:n}=s;if(!n)return[];const c=[];for(let m=0,_=n.length/3;m<_;m++){const x=n[3*m],T=n[3*m+1],r=n[3*m+2];x!==T&&T!==r&&c.push([x,r,T])}return c}function p7(s,n){return s.map(c=>{const m=c.map(x=>n[x]).map(rc),_=U0(U0(Aa(m[1],m[0]),Aa(m[2],m[1])),Aa(m[0],m[2]));return lS(j0(_))})}function m7(s,n){const c=[];return s.forEach(m=>{for(let _=0;_<3;_++){const x=m[_],T=m[(_+1)%3];c[x]=c[x]||[],c[x].push(T)}}),s.length===0&&(n===2?(c[0]=[1],c[1]=[0]):n===1&&(c[0]=[])),c}function g7(s,n,c){const m=[],_=s.slice();if(n.length===0){if(c.length<2)return{polygons:m,centers:_};if(c.length===2){const r=rc(c[0]),I=rc(c[1]),k=j0(U0(r,I)),P=j0(Aa(r,I)),R=Aa(k,P),F=[k,Aa(k,R),Aa(Aa(k,R),R),Aa(Aa(Aa(k,R),R),R)].map(lS).map(T);return m.push(F),m.push(F.slice().reverse()),{polygons:m,centers:_}}}n.forEach((r,I)=>{for(let k=0;k<3;k++){const P=r[k],R=r[(k+1)%3],F=r[(k+2)%3];m[P]=m[P]||[],m[P].push([R,F,I,[P,R,F]])}});const x=m.map(r=>{const I=[r[0][2]];let k=r[0][1];for(let P=1;P<r.length;P++)for(let R=0;R<r.length;R++)if(r[R][0]==k){k=r[R][1],I.push(r[R][2]);break}if(I.length>2)return I;if(I.length==2){const P=FP(c[r[0][3][0]],c[r[0][3][1]],_[I[0]]),R=FP(c[r[0][3][2]],c[r[0][3][0]],_[I[0]]),F=T(P),V=T(R);return[I[0],V,I[1],F]}});function T(r){let I=-1;return _.slice(n.length,1/0).forEach((k,P)=>{k[0]===r[0]&&k[1]===r[1]&&(I=P+n.length)}),I<0&&(I=_.length,_.push(r)),I}return{polygons:x,centers:_}}function FP(s,n,c){s=rc(s),n=rc(n),c=rc(c);const m=a7(UD(Aa(n,s),c));return lS(j0(U0(s,n)).map(_=>m*_))}function _7(s){const n=[];return s.forEach(c=>{if(!c)return;let m=c[c.length-1];for(let _ of c)_>m&&n.push([m,_]),m=_}),n}function y7(s,n){return function(c){const m=new Map,_=new Map;return s.forEach((x,T)=>{const r=x.join("-");m.set(r,c[T]),_.set(r,!0)}),n.forEach(x=>{let T=0,r=-1;for(let I=0;I<3;I++){let k=Xa([x[I],x[(I+1)%3]]).join("-");m.get(k)>T&&(T=m.get(k),r=k)}_.set(r,!1)}),s.map(x=>_.get(x.join("-")))}}function v7(s,n){const c=new Set,m=[];s.map(r=>{if(!(cS(r.map(I=>n[I>n.length?0:I]))>1e-12))for(let I=0;I<3;I++){let k=[r[I],r[(I+1)%3]],P=`${k[0]}-${k[1]}`;c.has(P)?c.delete(P):c.add(`${k[1]}-${k[0]}`)}});const _=new Map;let x;if(c.forEach(r=>{r=r.split("-").map(Number),_.set(r[0],r[1]),x=r[0]}),x===void 0)return m;let T=x;do{m.push(T);let r=_.get(T);_.set(T,-1),T=r}while(T>-1&&T!==x);return m}function x7(s){const n=function(c){if(n.delaunay=null,n._data=c,typeof n._data=="object"&&n._data.type==="FeatureCollection"&&(n._data=n._data.features),typeof n._data=="object"){const m=n._data.map(_=>[n._vx(_),n._vy(_),_]).filter(_=>isFinite(_[0]+_[1]));n.points=m.map(_=>[_[0],_[1]]),n.valid=m.map(_=>_[2]),n.delaunay=c7(n.points)}return n};return n._vx=function(c){if(typeof c=="object"&&"type"in c)return vP(c)[0];if(0 in c)return c[0]},n._vy=function(c){if(typeof c=="object"&&"type"in c)return vP(c)[1];if(1 in c)return c[1]},n.x=function(c){return c?(n._vx=c,n):n._vx},n.y=function(c){return c?(n._vy=c,n):n._vy},n.polygons=function(c){if(c!==void 0&&n(c),!n.delaunay)return!1;const m={type:"FeatureCollection",features:[]};return n.valid.length===0||(n.delaunay.polygons.forEach((_,x)=>m.features.push({type:"Feature",geometry:_?{type:"Polygon",coordinates:[[..._,_[0]].map(T=>n.delaunay.centers[T])]}:null,properties:{site:n.valid[x],sitecoordinates:n.points[x],neighbours:n.delaunay.neighbors[x]}})),n.valid.length===1&&m.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:n.valid[0],sitecoordinates:n.points[0],neighbours:[]}})),m},n.triangles=function(c){return c!==void 0&&n(c),n.delaunay?{type:"FeatureCollection",features:n.delaunay.triangles.map((m,_)=>(m=m.map(x=>n.points[x]),m.center=n.delaunay.centers[_],m)).filter(m=>cS(m)>0).map(m=>({type:"Feature",properties:{circumcenter:m.center},geometry:{type:"Polygon",coordinates:[[...m,m[0]]]}}))}:!1},n.links=function(c){if(c!==void 0&&n(c),!n.delaunay)return!1;const m=n.delaunay.edges.map(x=>AP(n.points[x[0]],n.points[x[1]])),_=n.delaunay.urquhart(m);return{type:"FeatureCollection",features:n.delaunay.edges.map((x,T)=>({type:"Feature",properties:{source:n.valid[x[0]],target:n.valid[x[1]],length:m[T],urquhart:!!_[T]},geometry:{type:"LineString",coordinates:[n.points[x[0]],n.points[x[1]]]}}))}},n.mesh=function(c){return c!==void 0&&n(c),n.delaunay?{type:"MultiLineString",coordinates:n.delaunay.edges.map(m=>[n.points[m[0]],n.points[m[1]]])}:!1},n.cellMesh=function(c){if(c!==void 0&&n(c),!n.delaunay)return!1;const{centers:m,polygons:_}=n.delaunay,x=[];for(const T of _)if(T)for(let r=T.length,I=T[r-1],k=T[0],P=0;P<r;I=k,k=T[++P])k>I&&x.push([m[I],m[k]]);return{type:"MultiLineString",coordinates:x}},n._found=void 0,n.find=function(c,m,_){if(n._found=n.delaunay.find(c,m,n._found),!_||AP([c,m],n.points[n._found])<_)return n._found},n.hull=function(c){c!==void 0&&n(c);const m=n.delaunay.hull,_=n.points;return m.length===0?null:{type:"Polygon",coordinates:[[...m.map(x=>_[x]),_[m[0]]]]}},s?n(s):n}var b7=Math.PI,w7=b7*2,T7=Math.abs,uS=Math.sqrt;function pl(){}function G0(s,n){s&&NP.hasOwnProperty(s.type)&&NP[s.type](s,n)}var BP={Feature:function(s,n){G0(s.geometry,n)},FeatureCollection:function(s,n){for(var c=s.features,m=-1,_=c.length;++m<_;)G0(c[m].geometry,n)}},NP={Sphere:function(s,n){n.sphere()},Point:function(s,n){s=s.coordinates,n.point(s[0],s[1],s[2])},MultiPoint:function(s,n){for(var c=s.coordinates,m=-1,_=c.length;++m<_;)s=c[m],n.point(s[0],s[1],s[2])},LineString:function(s,n){j2(s.coordinates,n,0)},MultiLineString:function(s,n){for(var c=s.coordinates,m=-1,_=c.length;++m<_;)j2(c[m],n,0)},Polygon:function(s,n){VP(s.coordinates,n)},MultiPolygon:function(s,n){for(var c=s.coordinates,m=-1,_=c.length;++m<_;)VP(c[m],n)},GeometryCollection:function(s,n){for(var c=s.geometries,m=-1,_=c.length;++m<_;)G0(c[m],n)}};function j2(s,n,c){var m=-1,_=s.length-c,x;for(n.lineStart();++m<_;)x=s[m],n.point(x[0],x[1],x[2]);n.lineEnd()}function VP(s,n){var c=-1,m=s.length;for(n.polygonStart();++c<m;)j2(s[c],n,1);n.polygonEnd()}function Dg(s,n){s&&BP.hasOwnProperty(s.type)?BP[s.type](s,n):G0(s,n)}const S7=s=>s;var qb=new ml,G2=new ml,jD,GD,W2,q2,Nc={point:pl,lineStart:pl,lineEnd:pl,polygonStart:function(){Nc.lineStart=E7,Nc.lineEnd=I7},polygonEnd:function(){Nc.lineStart=Nc.lineEnd=Nc.point=pl,qb.add(T7(G2)),G2=new ml},result:function(){var s=qb/2;return qb=new ml,s}};function E7(){Nc.point=A7}function A7(s,n){Nc.point=WD,jD=W2=s,GD=q2=n}function WD(s,n){G2.add(q2*s-W2*n),W2=s,q2=n}function I7(){WD(jD,GD)}var vp=1/0,W0=vp,f_=-vp,q0=f_,UP={point:M7,lineStart:pl,lineEnd:pl,polygonStart:pl,polygonEnd:pl,result:function(){var s=[[vp,W0],[f_,q0]];return f_=q0=-(W0=vp=1/0),s}};function M7(s,n){s<vp&&(vp=s),s>f_&&(f_=s),n<W0&&(W0=n),n>q0&&(q0=n)}var H2=0,Z2=0,Ug=0,H0=0,Z0=0,sp=0,X2=0,Y2=0,jg=0,qD,HD,$l,ec,Wa={point:od,lineStart:jP,lineEnd:GP,polygonStart:function(){Wa.lineStart=k7,Wa.lineEnd=R7},polygonEnd:function(){Wa.point=od,Wa.lineStart=jP,Wa.lineEnd=GP},result:function(){var s=jg?[X2/jg,Y2/jg]:sp?[H0/sp,Z0/sp]:Ug?[H2/Ug,Z2/Ug]:[NaN,NaN];return H2=Z2=Ug=H0=Z0=sp=X2=Y2=jg=0,s}};function od(s,n){H2+=s,Z2+=n,++Ug}function jP(){Wa.point=C7}function C7(s,n){Wa.point=P7,od($l=s,ec=n)}function P7(s,n){var c=s-$l,m=n-ec,_=uS(c*c+m*m);H0+=_*($l+s)/2,Z0+=_*(ec+n)/2,sp+=_,od($l=s,ec=n)}function GP(){Wa.point=od}function k7(){Wa.point=z7}function R7(){ZD(qD,HD)}function z7(s,n){Wa.point=ZD,od(qD=$l=s,HD=ec=n)}function ZD(s,n){var c=s-$l,m=n-ec,_=uS(c*c+m*m);H0+=_*($l+s)/2,Z0+=_*(ec+n)/2,sp+=_,_=ec*s-$l*n,X2+=_*($l+s),Y2+=_*(ec+n),jg+=_*3,od($l=s,ec=n)}function XD(s){this._context=s}XD.prototype={_radius:4.5,pointRadius:function(s){return this._radius=s,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(s,n){switch(this._point){case 0:{this._context.moveTo(s,n),this._point=1;break}case 1:{this._context.lineTo(s,n);break}default:{this._context.moveTo(s+this._radius,n),this._context.arc(s,n,this._radius,0,w7);break}}},result:pl};var K2=new ml,Hb,YD,KD,Gg,Wg,p_={point:pl,lineStart:function(){p_.point=D7},lineEnd:function(){Hb&&JD(YD,KD),p_.point=pl},polygonStart:function(){Hb=!0},polygonEnd:function(){Hb=null},result:function(){var s=+K2;return K2=new ml,s}};function D7(s,n){p_.point=JD,YD=Gg=s,KD=Wg=n}function JD(s,n){Gg-=s,Wg-=n,K2.add(uS(Gg*Gg+Wg*Wg)),Gg=s,Wg=n}let WP,X0,qP,HP;class ZP{constructor(n){this._append=n==null?QD:L7(n),this._radius=4.5,this._=""}pointRadius(n){return this._radius=+n,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(n,c){switch(this._point){case 0:{this._append`M${n},${c}`,this._point=1;break}case 1:{this._append`L${n},${c}`;break}default:{if(this._append`M${n},${c}`,this._radius!==qP||this._append!==X0){const m=this._radius,_=this._;this._="",this._append`m0,${m}a${m},${m} 0 1,1 0,${-2*m}a${m},${m} 0 1,1 0,${2*m}z`,qP=m,X0=this._append,HP=this._,this._=_}this._+=HP;break}}}result(){const n=this._;return this._="",n.length?n:null}}function QD(s){let n=1;this._+=s[0];for(const c=s.length;n<c;++n)this._+=arguments[n]+s[n]}function L7(s){const n=Math.floor(s);if(!(n>=0))throw new RangeError(`invalid digits: ${s}`);if(n>15)return QD;if(n!==WP){const c=10**n;WP=n,X0=function(_){let x=1;this._+=_[0];for(const T=_.length;x<T;++x)this._+=Math.round(arguments[x]*c)/c+_[x]}}return X0}function $D(s,n){let c=3,m=4.5,_,x;function T(r){return r&&(typeof m=="function"&&x.pointRadius(+m.apply(this,arguments)),Dg(r,_(x))),x.result()}return T.area=function(r){return Dg(r,_(Nc)),Nc.result()},T.measure=function(r){return Dg(r,_(p_)),p_.result()},T.bounds=function(r){return Dg(r,_(UP)),UP.result()},T.centroid=function(r){return Dg(r,_(Wa)),Wa.result()},T.projection=function(r){return arguments.length?(_=r==null?(s=null,S7):(s=r).stream,T):s},T.context=function(r){return arguments.length?(x=r==null?(n=null,new ZP(c)):new XD(n=r),typeof m!="function"&&x.pointRadius(m),T):n},T.pointRadius=function(r){return arguments.length?(m=typeof r=="function"?r:(x.pointRadius(+r),+r),T):m},T.digits=function(r){if(!arguments.length)return c;if(r==null)c=null;else{const I=Math.floor(r);if(!(I>=0))throw new RangeError(`invalid digits: ${r}`);c=I}return n===null&&(x=new ZP(c)),T},T.projection(s).digits(c).context(n)}function O7(s){return{stream:F7(s)}}function F7(s){return function(n){var c=new J2;for(var m in s)c[m]=s[m];return c.stream=n,c}}function J2(){}J2.prototype={constructor:J2,point:function(s,n){this.stream.point(s,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function B7(s,n,c){const m=Kz(),_=$D(s,N7(n(m))),x=T=>(_(T),c===void 0?m+"":void 0);return Object.setPrototypeOf(x,_),x}function N7(s){return{beginPath(){},moveTo(n,c){s.lineStart(),s.point(n,c)},arc(n,c,m,_,x,T){},lineTo(n,c){s.point(n,c)},closePath(){s.lineEnd()}}}function V7(s,n,c){const m=s.fitSize(n,c),_=m.translate();return{translate:{x:_[0],y:_[1]},scale:m.scale()}}var U7=sr("<path></path>");function j7(s,n){Yn(n,!0);let c=Re(n,"curve",3,x2),m=Re(n,"ref",15),_=bi(n,["$$slots","$$events","$$legacy","fill","stroke","strokeWidth","opacity","geoTransform","geojson","tooltipContext","curve","onclick","class","ref","children"]),x=Mn(void 0);ki(()=>{m(A(x))});const T=tS(),r=fe(()=>n.geoTransform&&T.projection?O7(n.geoTransform(T.projection)):T.projection),I=fe(()=>{if(n.geojson,!!A(r))return c()===x2?$D(A(r)):B7(A(r),c())}),k=bl();function P(me,ue){if(!n.geojson)return;const _e=A(I)?.(n.geojson);T_(me,_e,ue?cd({styles:{strokeWidth:n.strokeWidth}},ue):{styles:{fill:n.fill,stroke:n.stroke,strokeWidth:n.strokeWidth,opacity:n.opacity},classes:n.class})}const R=da(()=>n.fill),F=da(()=>n.stroke);function V(me){n.onclick?.(me,A(I))}const W=me=>{n.onpointerenter?.(me),n.tooltipContext?.show(me,n.geojson)},G=me=>{n.onpointermove?.(me),n.tooltipContext?.show(me,n.geojson)},K=me=>{n.onpointerleave?.(me),n.tooltipContext?.hide()};k==="canvas"&&sc({name:"GeoPath",render:P,events:{click:n.onclick?V:void 0,pointerenter:n.onpointerenter||n.tooltipContext?W:void 0,pointermove:n.onpointermove||n.tooltipContext?G:void 0,pointerleave:n.onpointerleave||n.tooltipContext?K:void 0,pointerdown:n.onpointerdown,touchmove:n.ontouchmove},deps:()=>[A(r),n.geojson,c(),R.current,F.current,n.strokeWidth,n.opacity,n.class]});var Y=Gt(),ne=yt(Y);{var oe=me=>{var ue=Gt(),_e=yt(ue);Dn(_e,()=>n.children,()=>({geoPath:A(I)})),je(me,ue)},ce=me=>{var ue=Gt(),_e=yt(ue);{var te=ie=>{var xe=U7();Ii(xe,(de,Te)=>({..._,d:de,fill:n.fill,stroke:n.stroke,"stroke-width":n.strokeWidth,opacity:n.opacity,onclick:V,onpointerenter:W,onpointermove:G,onpointerleave:K,class:Te}),[()=>n.geojson?A(I)?.(n.geojson):"",()=>En(Cn("geo-path"),n.fill==null&&"fill-transparent",n.class)]),er(xe,de=>rn(x,de),()=>A(x)),je(ie,xe)};Zt(_e,ie=>{k==="svg"&&ie(te)},!0)}je(me,ue)};Zt(ne,me=>{n.children?me(oe):me(ce,!1)})}je(s,Y),Kn()}var G7=sr("<circle></circle>");function sd(s,n){Yn(n,!0);let c=Re(n,"cx",3,0),m=Re(n,"cy",3,0),_=Re(n,"r",3,1),x=Re(n,"ref",15),T=bi(n,["$$slots","$$events","$$legacy","cx","initialCx","cy","initialCy","r","initialR","motion","fill","fillOpacity","stroke","strokeWidth","opacity","class","ref"]),r=Mn(void 0);ki(()=>{x(A(r))});const I=n.initialCx??c(),k=n.initialCy??m(),P=n.initialR??_(),R=bl(),F=Vo(I,()=>c(),n.motion),V=Vo(k,()=>m(),n.motion),W=Vo(P,()=>_(),n.motion);function G(me,ue){ID(me,{cx:F.current,cy:V.current,r:W.current},ue?cd({styles:{strokeWidth:n.strokeWidth}},ue):{styles:{fill:n.fill,fillOpacity:n.fillOpacity,stroke:n.stroke,strokeWidth:n.strokeWidth,opacity:n.opacity},classes:n.class})}const K=da(()=>n.fill),Y=da(()=>n.stroke);R==="canvas"&&sc({name:"Circle",render:G,events:{click:n.onclick,pointerdown:n.onpointerdown,pointerenter:n.onpointerenter,pointermove:n.onpointermove,pointerleave:n.onpointerleave},deps:()=>[F.current,V.current,W.current,K.current,n.fillOpacity,Y.current,n.strokeWidth,n.opacity,n.class]});var ne=Gt(),oe=yt(ne);{var ce=me=>{var ue=G7();Ii(ue,_e=>({cx:F.current,cy:V.current,r:W.current,fill:n.fill,"fill-opacity":n.fillOpacity,stroke:n.stroke,"stroke-width":n.strokeWidth,opacity:n.opacity,class:_e,...T}),[()=>En(Cn("circle"),n.fill==null&&"fill-surface-content",n.class)]),er(ue,_e=>rn(r,_e),()=>A(r)),je(me,ue)};Zt(oe,me=>{R==="svg"&&me(ce)})}je(s,ne),Kn()}function XP(s,n){const c=fa();Yn(n,!0);let m=Re(n,"id",19,()=>Ls("clipPath-",c)),_=Re(n,"cx",3,0),x=Re(n,"cy",3,0),T=Re(n,"disabled",3,!1),r=Re(n,"ref",15),I=bi(n,["$$slots","$$events","$$legacy","id","cx","cy","r","motion","disabled","ref","children"]),k=Mn(void 0);ki(()=>{r(A(k))}),CD(s,{get id(){return m()},get disabled(){return T()},get children(){return n.children},clip:R=>{{let F=fe(()=>To(I,"clip-path-circle"));sd(R,Hn({get cx(){return _()},get cy(){return x()},get r(){return n.r},get motion(){return n.motion}},()=>A(F),{get ref(){return A(k)},set ref(V){rn(k,V,!0)}}))}},$$slots:{clip:!0}}),Kn()}function W7(s,n){Yn(n,!0);let c=Re(n,"classes",19,()=>({})),m=bi(n,["$$slots","$$events","$$legacy","data","r","classes","onclick","onpointerenter","onpointerdown","onpointermove","class"]);const _=_o(),x=tS(),T=fe(()=>(n.data??_.flatData).map(P=>{const R=x.projection?_.x(P):_.xGet(P),F=x.projection?_.y(P):_.yGet(P),V=Array.isArray(R)?Qr(R):R,W=Array.isArray(F)?Qr(F):F;let G;if(_.radial){const K=gl(V,W);G=[K[0]+_.width/2,K[1]+_.height/2]}else G=[V,W];return G.data=P,G})),r=fe(()=>Math.max(_.width,0)),I=fe(()=>Math.max(_.height,0)),k=fe(()=>n.r===0||n.r==null||n.r===1/0);{let P=fe(()=>En(Cn("voronoi-g"),c().root,n.class));oc(s,Hn(()=>m,{get class(){return A(P)},children:(R,F)=>{var V=Gt(),W=yt(V);{var G=Y=>{const ne=fe(()=>x7().polygons(A(T)));var oe=Gt(),ce=yt(oe);ro(ce,17,()=>A(ne).features,cs,(me,ue)=>{const _e=fe(()=>n.r?x.projection?.(A(ue).properties.sitecoordinates):null);{let te=fe(()=>A(_e)?.[0]),ie=fe(()=>A(_e)?.[1]),xe=fe(()=>n.r??0),de=fe(()=>A(_e)==null||A(k));XP(me,{get cx(){return A(te)},get cy(){return A(ie)},get r(){return A(xe)},get disabled(){return A(de)},children:(Te,De)=>{{let Be=fe(()=>En(Cn("voronoi-geo-path"),"fill-transparent stroke-transparent",c().path));j7(Te,{get geojson(){return A(ue)},get class(){return A(Be)},onclick:Se=>n.onclick?.(Se,{data:A(ue).properties.site.data,feature:A(ue)}),onpointerenter:Se=>n.onpointerenter?.(Se,{data:A(ue).properties.site.data,feature:A(ue)}),onpointermove:Se=>n.onpointermove?.(Se,{data:A(ue).properties.site.data,feature:A(ue)}),onpointerdown:Se=>n.onpointerdown?.(Se,{data:A(ue).properties.site.data,feature:A(ue)}),onpointerleave,ontouchmove:Se=>{Se.preventDefault()}})}},$$slots:{default:!0}})}}),je(Y,oe)},K=Y=>{const ne=fe(()=>yx.from(A(T)).voronoi([0,0,A(r),A(I)]));var oe=Gt(),ce=yt(oe);ro(ce,17,()=>A(T),cs,(me,ue,_e)=>{const te=fe(()=>A(ne).renderCell(_e));var ie=Gt(),xe=yt(ie);{var de=Te=>{{let De=fe(()=>n.r??0);XP(Te,{get cx(){return A(ue)[0]},get cy(){return A(ue)[1]},get r(){return A(De)},get disabled(){return A(k)},children:(Be,Se)=>{{let Ne=fe(()=>En(Cn("voronoi-path"),"fill-transparent stroke-transparent",c().path));ad(Be,{get pathData(){return A(te)},get class(){return A(Ne)},onclick:it=>n.onclick?.(it,{data:A(ue).data,point:A(ue)}),onpointerenter:it=>n.onpointerenter?.(it,{data:A(ue).data,point:A(ue)}),onpointermove:it=>n.onpointermove?.(it,{data:A(ue).data,point:A(ue)}),onpointerleave,onpointerdown:it=>n.onpointerdown?.(it,{data:A(ue).data,point:A(ue)}),ontouchmove:it=>{it.preventDefault()}})}},$$slots:{default:!0}})}};Zt(xe,Te=>{A(te)&&Te(de)})}je(me,ie)}),je(Y,oe)};Zt(W,Y=>{x.projection?Y(G):Y(K,!1)})}je(R,V)},$$slots:{default:!0}}))}Kn()}function ep(s){return s*Math.PI/180}function Zv(s){return s*(180/Math.PI)}function q7(s,n){let c=Math.atan2(n,s);return c+=Math.PI/2,c<0&&(c+=2*Math.PI),{radius:Math.sqrt(s**2+n**2),radians:c}}function H7(s){return typeof s=="number"?s:Number(s.replace("%",""))/100}function Xv(s,n){return s instanceof Date?new Date(s.getTime()+n):s+n}function Z7(s,n=!0){const c=[];return s.visit((m,_,x,T,r)=>{(n||Array.isArray(m))&&c.push({x:_,y:x,width:T-_,height:r-x})}),c}function X7({ctx:s,data:n,metaCtx:c}){return(c.stackSeries?[...c.visibleSeries].reverse():c.visibleSeries).map(x=>{const T=x.data?b_(x.data,n,s.x):n,r=Zr(x.value??(x.data?s.y:x.key)),I=c.orientation==="vertical"?s.x(n):s.y(n),k=x.label??(x.key!=="default"?x.key:"value"),P=T?r(T):void 0,R=x.color??s.cScale?.(s.c(n));return{...x.data,chartType:"bar",color:R,label:I,name:k,value:P,valueAccessor:r,key:x.key,payload:n,rawSeriesData:x,formatter:Jr}})}function Y7({ctx:s,data:n,metaCtx:c}){return(c.stackSeries?[...c.visibleSeries].reverse():c.visibleSeries).map(x=>{const T=x.data?b_(x.data,n,s.x):n,r=Zr(x.value??(x.data?s.y:x.key)),I=s.x(n),k=x.label??(x.key!=="default"?x.key:"value"),P=T?r(T):void 0,R=x.color??s.cScale?.(s.c(n));return{...x.data,chartType:"area",color:R,label:I,name:k,value:P,valueAccessor:r,key:x.key,payload:n,rawSeriesData:x,formatter:Jr}})}function K7({ctx:s,data:n,metaCtx:c}){return c.visibleSeries.map(m=>{const _=m.data?b_(m.data,n,s.x):n,x=s.x(n),T=Zr(m.value??(m.data?s.y:m.key)),r=m.label??(m.key!=="default"?m.key:"value"),I=_?T(_):void 0,k=m.color??s.cScale?.(s.c(n));return{...m.data,chartType:"line",color:k,label:x,name:r,value:I,valueAccessor:T,key:m.key,payload:n,rawSeriesData:m,formatter:Jr}})}function J7({ctx:s,data:n,metaCtx:c}){const m=Zr(c.key),_=Zr(c.label),x=Zr(c.value),T=Zr(c.color);return[{key:m(n),label:_(n)||m(n),value:x(n),color:T(n)??s.cScale?.(s.c(n)),payload:n,chartType:"pie",labelAccessor:_,keyAccessor:m,valueAccessor:x,colorAccessor:T}]}function Q7({ctx:s,data:n,metaCtx:c}){return[{payload:n,key:""}]}const eL=new eh("TooltipMetaContext");function $7(){return eL.getOr(null)}function eZ(s){return eL.set(s)}function tZ({ctx:s,tooltipData:n,metaCtx:c}){if(!c)return[{payload:n,key:""}];switch(c.type){case"bar":return X7({ctx:s,data:n,metaCtx:c});case"area":return Y7({ctx:s,data:n,metaCtx:c});case"line":return K7({ctx:s,data:n,metaCtx:c});case"pie":case"arc":return J7({ctx:s,data:n,metaCtx:c});case"scatter":return Q7({ctx:s,data:n,metaCtx:c})}}const tL=new eh("TooltipContext");function hS(){return tL.get()}function nZ(s){return tL.set(s)}function YP(s,n,c){A(n)&&c(s)}var iZ=(s,n,c,m)=>{A(n)&&c.data!=null&&m()(s,{data:c.data})},rZ=()=>{},oZ=(s,n,c)=>n(s,A(c)?.data),sZ=s=>{const n=s.target;n?.hasPointerCapture(s.pointerId)&&n.releasePointerCapture(s.pointerId)},aZ=(s,n,c)=>{n()(s,{data:A(c)?.data})},lZ=sr("<rect></rect>"),cZ=sr("<g></g>"),uZ=sr("<rect></rect>"),hZ=sr("<g><!></g>"),dZ=Un("<div><div><!> <!></div></div>");function fZ(s,n){Yn(n,!0);const c=_o(),m=tS();let _=Re(n,"ref",15),x=Re(n,"debug",3,!1),T=Re(n,"findTooltipData",3,"closest"),r=Re(n,"hideDelay",3,0),I=Re(n,"locked",3,!1),k=Re(n,"mode",3,"manual"),P=Re(n,"onclick",3,()=>{}),R=Re(n,"radius",3,1/0),F=Re(n,"raiseTarget",3,!1),V=Re(n,"tooltipContext",15),W=Mn(void 0);ki(()=>{_(A(W))});let G=Mn(0),K=Mn(0),Y=Mn(null),ne=Mn(Ya([])),oe=Mn(!1),ce=Mn(!1);const me=$7(),ue={get x(){return A(G)},get y(){return A(K)},get data(){return A(Y)},get payload(){return A(ne)},show:de,hide:Te,get mode(){return k()},get isHoveringTooltipArea(){return A(oe)},get isHoveringTooltipContent(){return A(ce)},set isHoveringTooltipContent(tt){rn(ce,tt,!0)}};V(ue),nZ(ue);let _e;const te=t_(tt=>{const gt=c.x(tt);return Array.isArray(gt)?gt[0]:gt}).left,ie=t_(tt=>{const gt=c.y(tt);return Array.isArray(gt)?gt[0]:gt}).left;function xe(tt,gt,Lt,_t){switch(T()){case"closest":return gt===void 0?tt:tt===void 0||Number(Lt)-Number(_t(tt))>Number(_t(gt))-Number(Lt)?gt:tt;case"left":return tt;case"right":default:return gt}}function de(tt,gt){if(_e&&clearTimeout(_e),I())return;const Lt=tt.target.closest(".lc-root-container"),_t=jc(tt,Lt);if(A(W)!==void 0&&gt==null&&(_t.x<A(W).offsetLeft||_t.x>A(W).offsetLeft+A(W).offsetWidth||_t.y<A(W).offsetTop||_t.y>A(W).offsetTop+A(W).offsetHeight)){Te();return}if(gt==null)switch(k()){case"bisect-x":{let Je;if(c.radial){const{radians:on}=q7(_t.x-c.width/2,_t.y-c.height/2);Je=Bc(c.xScale,on)}else Je=Bc(c.xScale,_t.x-c.padding.left);const Rt=te(c.flatData,Je,1),ut=c.flatData[Rt-1],cn=c.flatData[Rt];gt=xe(ut,cn,Je,c.x);break}case"bisect-y":{const Je=Bc(c.yScale,_t.y-c.padding.top),Rt=ie(c.flatData,Je,1),ut=c.flatData[Rt-1],cn=c.flatData[Rt];gt=xe(ut,cn,Je,c.y);break}case"bisect-band":{const Je=Bc(c.xScale,_t.x),Rt=Bc(c.yScale,_t.y);if(Wi(c.xScale)){const ut=c.flatData.filter(vt=>c.x(vt)===Je).sort(Ob(c.y)),cn=ie(ut,Rt,1),on=ut[cn-1],Jt=ut[cn];gt=xe(on,Jt,Rt,c.y)}else if(Wi(c.yScale)){const ut=c.flatData.filter(vt=>c.y(vt)===Rt).sort(Ob(c.x)),cn=te(ut,Je,1),on=ut[cn-1],Jt=ut[cn];gt=xe(on,Jt,Je,c.x)}break}case"quadtree-x":case"quadtree-y":case"quadtree":{gt=A(De)?.find(_t.x-c.padding.left,_t.y-c.padding.top,R());break}}if(gt){F()&&Uq(tt.target);const Je=tZ({ctx:c,tooltipData:gt,metaCtx:me});rn(G,_t.x,!0),rn(K,_t.y,!0),rn(Y,gt,!0),rn(ne,Je,!0)}else Te()}function Te(){I()||(rn(oe,!1),_e=setTimeout(()=>{!A(oe)&&!A(ce)&&(rn(Y,null),rn(ne,[],!0))},r()))}const De=fe(()=>{if(["quadtree","quadtree-x","quadtree-y"].includes(k()))return AD().x(tt=>{if(k()==="quadtree-y")return 0;if(m.projection){const Lt=c.x(tt),_t=c.y(tt);return(m.projection([Lt,_t])??[0,0])[0]}const gt=c.xGet(tt);return Array.isArray(gt)?Qr(gt):gt}).y(tt=>{if(k()==="quadtree-x")return 0;if(m.projection){const Lt=c.x(tt),_t=c.y(tt);return(m.projection([Lt,_t])??[0,0])[1]}const gt=c.yGet(tt);return Array.isArray(gt)?Qr(gt):gt}).addAll(c.flatData)}),Be=fe(()=>k()==="bounds"||k()==="band"?c.flatData.map(tt=>{const gt=c.xGet(tt),Lt=c.yGet(tt),_t=Array.isArray(gt)?gt[0]:gt,Je=Array.isArray(Lt)?Lt[0]:Lt,Rt=Wi(c.xScale)?c.xScale.padding()*c.xScale.step()/2:0,ut=Wi(c.yScale)?c.yScale.padding()*c.yScale.step()/2:0,cn=co(c.xRange)-Qr(c.xRange),on=co(c.yRange)-Qr(c.yRange);if(k()==="band")return{x:Wi(c.xScale)?_t-Rt:Qr(c.xRange),y:Wi(c.yScale)?Je-ut:Qr(c.yRange),width:Wi(c.xScale)?c.xScale.step():cn,height:Wi(c.yScale)?c.yScale.step():on,data:tt};if(k()==="bounds")return{x:Wi(c.xScale)||Array.isArray(gt)?_t-Rt:Qr(c.xRange),y:Je-ut,width:Array.isArray(gt)?gt[1]-gt[0]:Wi(c.xScale)?c.xScale.step():Qr(c.xRange)+_t,height:Array.isArray(Lt)?Lt[1]-Lt[0]:Wi(c.yScale)?c.yScale.step():co(c.yRange)-Je,data:tt}}).filter(tt=>tt!==void 0).sort(Ob("x")):[]),Se=fe(()=>["bisect-x","bisect-y","bisect-band","quadtree","quadtree-x","quadtree-y"].includes(k()));function Ne(tt){rn(oe,!0),A(Se)&&de(tt)}function it(tt){rn(oe,!1),Te()}var qe=dZ();qe.__touchstart=Ne,qe.__mousemove=[YP,Se,de],qe.__touchmove=[YP,Se,de],qe.__touchend=it,qe.__click=[iZ,Se,ue,P],qe.__keydown=[rZ];let ft;var St=Xn(qe);let Dt;var Kt=Xn(St);Dn(Kt,()=>n.children??Si,()=>({tooltipContext:ue}));var et=Tn(Kt,2);{var Qe=tt=>{t0(tt,{children:(gt,Lt)=>{{let _t=fe(()=>({path:En(x()&&"fill-danger/10 stroke-danger")}));W7(gt,{get r(){return R()},onpointerenter:(Je,{data:Rt})=>{de(Je,Rt)},onpointermove:(Je,{data:Rt})=>{de(Je,Rt)},onpointerleave:()=>Te(),onpointerdown:Je=>{Je.target?.hasPointerCapture(Je.pointerId)&&Je.target.releasePointerCapture(Je.pointerId)},onclick:(Je,{data:Rt})=>{P()(Je,{data:Rt})},get classes(){return A(_t)}})}},$$slots:{default:!0}})},st=tt=>{var gt=Gt(),Lt=yt(gt);{var _t=Rt=>{t0(Rt,{get center(){return c.radial},children:(ut,cn)=>{var on=cZ();ro(on,21,()=>A(Be),cs,(Jt,vt)=>{var zt=Gt(),fn=yt(zt);{var Gn=ti=>{{let yi=fe(()=>A(vt).y+A(vt).height),Ri=fe(()=>A(vt).x+A(vt).width),ur=fe(()=>En(Cn("tooltip-rect"),x()?"fill-danger/10 stroke-danger":"fill-transparent"));pS(ti,{get innerRadius(){return A(vt).y},get outerRadius(){return A(yi)},get startAngle(){return A(vt).x},get endAngle(){return A(Ri)},get class(){return A(ur)},onpointerenter:wi=>de(wi,A(vt)?.data),onpointermove:wi=>de(wi,A(vt)?.data),onpointerleave:()=>Te(),onpointerdown:wi=>{const Oi=wi.target;Oi?.hasPointerCapture(wi.pointerId)&&Oi.releasePointerCapture(wi.pointerId)},onclick:wi=>{P()(wi,{data:A(vt)?.data})}})}},Wn=ti=>{var yi=lZ();yi.__pointermove=[oZ,de,vt],yi.__pointerdown=[sZ],yi.__click=[aZ,P,vt],Vi(Ri=>{Gi(yi,"x",A(vt)?.x),Gi(yi,"y",A(vt)?.y),Gi(yi,"width",A(vt)?.width),Gi(yi,"height",A(vt)?.height),Pr(yi,0,Ri)},[()=>Cr(En(Cn("tooltip-rect"),x()?"fill-danger/10 stroke-danger":"fill-transparent"))]),np("pointerenter",yi,Ri=>de(Ri,A(vt)?.data)),np("pointerleave",yi,()=>Te()),je(ti,yi)};Zt(fn,ti=>{c.radial?ti(Gn):ti(Wn,!1)})}je(Jt,zt)}),Ln(on),Vi(Jt=>Pr(on,0,Jt),[()=>Cr(Cn("tooltip-rects-g"))]),je(ut,on)},$$slots:{default:!0}})},Je=Rt=>{var ut=Gt(),cn=yt(ut);{var on=Jt=>{t0(Jt,{pointerEvents:!1,children:(vt,zt)=>{A2(vt,{children:(fn,Gn)=>{var Wn=hZ(),ti=Xn(Wn);{var yi=Ri=>{var ur=Gt(),wi=yt(ur);ro(wi,17,()=>Z7(A(De),!1),cs,(Oi,zi)=>{var qi=uZ();Vi(ir=>{Gi(qi,"x",A(zi).x),Gi(qi,"y",A(zi).y),Gi(qi,"width",A(zi).width),Gi(qi,"height",A(zi).height),Pr(qi,0,ir)},[()=>Cr(En(Cn("tooltip-quadtree-rect"),x()?"fill-danger/10 stroke-danger":"fill-transparent"))]),je(Oi,qi)}),je(Ri,ur)};Zt(ti,Ri=>{A(De)&&Ri(yi)})}Ln(Wn),Vi(Ri=>Pr(Wn,0,Ri),[()=>Cr(Cn("tooltip-quadtree-g"))]),je(fn,Wn)},$$slots:{default:!0}})},$$slots:{default:!0}})};Zt(cn,Jt=>{["quadtree","quadtree-x","quadtree-y"].includes(k())&&x()&&Jt(on)},!0)}je(Rt,ut)};Zt(Lt,Rt=>{k()==="bounds"||k()==="band"?Rt(_t):Rt(Je,!1)},!0)}je(tt,gt)};Zt(et,tt=>{k()==="voronoi"?tt(Qe):tt(st,!1)})}Ln(St),Ln(qe),er(qe,tt=>rn(W,tt),()=>A(W)),Vi((tt,gt,Lt,_t)=>{Pr(qe,1,tt),ft=_l(qe,"",ft,gt),Pr(St,1,Lt),Dt=_l(St,"",Dt,_t)},[()=>Cr(En(Cn("tooltip-context"),"absolute",x()&&A(Se)&&"bg-danger/10 outline outline-danger")),()=>({top:`${c.padding.top??""}px`,left:`${c.padding.left??""}px`,width:`${c.width??""}px`,height:`${c.height??""}px`}),()=>Cr(En(Cn("tooltip-context-container"),"absolute")),()=>({top:`-${c.padding.top??0??""}px`,left:`-${c.padding.left??0??""}px`,width:`${c.containerWidth??""}px`,height:`${c.containerHeight??""}px`})]),np("mouseenter",qe,Ne),np("mouseleave",qe,it),je(s,qe),Kn()}nT(["touchstart","mousemove","touchmove","touchend","click","keydown","pointermove","pointerdown"]);const pZ=new eh("BrushContext");function mZ(s){return pZ.set(s)}var gZ=(s,n)=>n(),_Z=Un("<div></div> <div></div>",1),yZ=Un("<div></div> <div></div>",1),vZ=Un("<div></div> <!> <!>",1),xZ=Un("<div><div><!></div> <!></div>");function bZ(s,n){Yn(n,!0);const c=_o();let m=Re(n,"brushContext",15),_=Re(n,"axis",3,"x"),x=Re(n,"handleSize",3,5),T=Re(n,"resetOnEnd",3,!1),r=Re(n,"ignoreResetClick",3,!1),I=Re(n,"xDomain",7),k=Re(n,"yDomain",7),P=Re(n,"mode",3,"integrated"),R=Re(n,"disabled",3,!1),F=Re(n,"range",19,()=>({})),V=Re(n,"handle",19,()=>({})),W=Re(n,"classes",19,()=>({})),G=Re(n,"onBrushEnd",3,()=>{}),K=Re(n,"onBrushStart",3,()=>{}),Y=Re(n,"onChange",3,()=>{}),ne=Re(n,"onReset",3,()=>{}),oe=Mn(void 0);I()===void 0&&I(c.xScale.domain()),k()===void 0&&k(c.yScale.domain()),ki(()=>{I()===void 0&&I(c.xScale.domain())}),ki(()=>{k()===void 0&&k(c.yScale.domain())});const ce=I(),me=k(),ue=c.config.xDomain,_e=c.config.yDomain,te=fe(()=>Xa(c.xScale.domain())),ie=fe(()=>A(te)[0]),xe=fe(()=>A(te)[1]),de=fe(()=>Xa(c.yScale.domain())),Te=fe(()=>A(de)[0]),De=fe(()=>A(de)[1]),Be=fe(()=>c.yScale(k()?.[1])),Se=fe(()=>c.yScale(k()?.[0])),Ne=fe(()=>c.xScale(I()?.[0])),it=fe(()=>c.xScale(I()?.[1])),qe=fe(()=>({x:_()==="both"||_()==="x"?A(Ne):0,y:_()==="both"||_()==="y"?A(Be):0,width:_()==="both"||_()==="x"?A(it)-A(Ne):c.width,height:_()==="both"||_()==="y"?A(Se)-A(Be):c.height}));let ft=Mn(!1);const St={get xDomain(){return I()},set xDomain(vt){I(vt)},get yDomain(){return k()},set yDomain(vt){k(vt)},get isActive(){return A(ft)},set isActive(vt){rn(ft,vt,!0)},get range(){return A(qe)},get handleSize(){return x()}};m(St),mZ(St);const Dt=new Zz("BrushContext"),Kt=1;function et(vt){return zt=>{Dt.debug("drag start"),zt.stopPropagation();const fn=jc(zt,A(oe));if(fn&&(fn.x<0||fn.x>c.width||fn.y<0||fn.y>c.height)){Dt.debug("ignoring click as outside of chart bounds",{startPoint:fn,width:c.width,height:c.height});return}const Gn={xDomain:[I()?.[0]??A(ie),I()?.[1]??A(xe)],yDomain:[k()?.[0]??A(Te),k()?.[1]??A(De)],value:{x:Bc(c.xScale,fn?.x??0),y:Bc(c.yScale,fn?.y??0)}};K()({xDomain:I(),yDomain:k()});const Wn=yi=>{const Ri=jc(yi,A(oe));vt(Gn,{x:Bc(c.xScale,Ri?.x??0),y:Bc(c.yScale,Ri?.y??0)}),Y()({xDomain:I(),yDomain:k()})},ti=yi=>{const Ri=jc(yi,A(oe)),ur=Math.abs((fn?.x??0)-(Ri?.x??0)),wi=Math.abs((fn?.y??0)-(Ri?.y??0));!Array.from(yi.target.classList).some(zi=>["range","handle"].includes(zi))&&ur<Kt&&wi<Kt||A(qe).width<Kt||A(qe).height<Kt?r()?Dt.debug("ignoring frame click reset"):(Dt.debug("resetting due to frame click"),Je(),Y()({xDomain:I(),yDomain:k()})):Dt.debug("drag end",{target:yi.target,xPointDelta:ur,yPointDelta:wi,rangeWidth:A(qe).width,rangeHeight:A(qe).height}),G()({xDomain:I(),yDomain:k()}),T()&&(r()?St.isActive=!1:Je()),window.removeEventListener("pointermove",Wn),window.removeEventListener("pointerup",ti)};window.addEventListener("pointermove",Wn),window.addEventListener("pointerup",ti)}}const Qe=et((vt,zt)=>{Dt.debug("createRange"),St.isActive=!0,I([aa(Qr([vt.value.x,zt.x]),A(ie),A(xe)),aa(co([vt.value.x,zt.x]),A(ie),A(xe))]),k([aa(Qr([vt.value.y,zt.y]),A(Te),A(De)),aa(co([vt.value.y,zt.y]),A(Te),A(De))])}),st=et((vt,zt)=>{Dt.debug("adjustRange");const fn=aa(zt.x-vt.value.x,A(ie)-vt.xDomain[0],A(xe)-vt.xDomain[1]);I([Xv(vt.xDomain[0],fn),Xv(vt.xDomain[1],fn)]);const Gn=aa(zt.y-vt.value.y,A(Te)-vt.yDomain[0],A(De)-vt.yDomain[1]);k([Xv(vt.yDomain[0],Gn),Xv(vt.yDomain[1],Gn)])}),tt=et((vt,zt)=>{Dt.debug("adjustTop"),k([aa(zt.y<vt.yDomain[0]?zt.y:vt.yDomain[0],A(Te),A(De)),aa(zt.y<vt.yDomain[0]?vt.yDomain[0]:zt.y,A(Te),A(De))])}),gt=et((vt,zt)=>{Dt.debug("adjustBottom"),k([aa(zt.y>vt.yDomain[1]?vt.yDomain[1]:zt.y,A(Te),A(De)),aa(zt.y>vt.yDomain[1]?zt.y:vt.yDomain[1],A(Te),A(De))])}),Lt=et((vt,zt)=>{Dt.debug("adjustLeft"),I([aa(zt.x>vt.xDomain[1]?vt.xDomain[1]:zt.x,A(ie),A(xe)),aa(zt.x>vt.xDomain[1]?zt.x:vt.xDomain[1],A(ie),A(xe))])}),_t=et((vt,zt)=>{Dt.debug("adjustRight"),I([aa(zt.x<vt.xDomain[0]?zt.x:vt.xDomain[0],A(ie),A(xe)),aa(zt.x<vt.xDomain[0]?vt.xDomain[0]:zt.x,A(ie),A(xe))])});function Je(){Dt.debug("reset"),St.isActive=!1,ne()({xDomain:I(),yDomain:k()}),I(ce),k(me)}function Rt(){Dt.debug("selectedAll"),I([A(ie),A(xe)]),k([A(Te),A(De)])}ki(()=>{if(P()==="separated"){const vt=I()?.[0]?.valueOf()!==ue?.[0]?.valueOf()||I()?.[1]?.valueOf()!==ue?.[1]?.valueOf(),zt=k()?.[0]?.valueOf()!==_e?.[0]?.valueOf()||k()?.[1]?.valueOf()!==_e?.[1]?.valueOf(),fn=_()==="x"?vt:_()=="y"?zt:vt||zt;St.isActive=fn}});var ut=Gt(),cn=yt(ut);{var on=vt=>{var zt=Gt(),fn=yt(zt);Dn(fn,()=>n.children??Si,()=>({brushContext:St})),je(vt,zt)},Jt=vt=>{const zt=fe(()=>Cn("brush-handle"));var fn=xZ();fn.__pointerdown=Qe,fn.__dblclick=[gZ,Rt];let Gn;var Wn=Xn(fn);let ti;var yi=Xn(Wn);Dn(yi,()=>n.children??Si,()=>({brushContext:St})),Ln(Wn);var Ri=Tn(Wn,2);{var ur=wi=>{var Oi=vZ(),zi=yt(Oi),qi=()=>Je();Ii(zi,(uo,oo)=>({...F(),class:uo,onpointerdown:st,ondblclick:qi,[Ua]:oo}),[()=>En(Cn("brush-range"),"absolute bg-surface-content/10 cursor-move select-none","z-10",W().range,F()?.class),()=>({left:`${A(qe).x??""}px`,top:`${A(qe).y??""}px`,width:`${A(qe).width??""}px`,height:`${A(qe).height??""}px`})]);var ir=Tn(zi,2);{var $r=uo=>{var oo=_Z(),ho=yt(oo),Co=ar=>{ar.stopPropagation(),k()&&(k()[0]=A(Te),Y()({xDomain:I(),yDomain:k()}))};Ii(ho,(ar,Zo)=>({...V(),"data-position":"top",class:ar,onpointerdown:tt,ondblclick:Co,[Ua]:Zo}),[()=>En(A(zt),"cursor-ns-resize select-none","range absolute","z-10",W().handle,V()?.class),()=>({left:`${A(qe).x??""}px`,top:`${A(qe).y??""}px`,width:`${A(qe).width??""}px`,height:`${x()??""}px`})]);var us=Tn(ho,2),rr=ar=>{ar.stopPropagation(),k()&&(k()[1]=A(De),Y()({xDomain:I(),yDomain:k()}))};Ii(us,(ar,Zo)=>({...V(),"data-position":"bottom",class:ar,onpointerdown:gt,ondblclick:rr,[Ua]:Zo}),[()=>En(A(zt),"handle bottom","cursor-ns-resize select-none","range absolute","z-10",W().handle,V()?.class),()=>({left:`${A(qe).x??""}px`,top:`${A(Se)-x()}px`,width:`${A(qe).width??""}px`,height:`${x()??""}px`})]),je(uo,oo)};Zt(ir,uo=>{(_()==="both"||_()==="y")&&uo($r)})}var lr=Tn(ir,2);{var hr=uo=>{var oo=yZ(),ho=yt(oo),Co=ar=>{ar.stopPropagation(),I()&&(I()[0]=A(ie),Y()({xDomain:I(),yDomain:k()}))};Ii(ho,(ar,Zo)=>({...V(),"data-position":"left",class:ar,onpointerdown:Lt,ondblclick:Co,[Ua]:Zo}),[()=>En(A(zt),"cursor-ew-resize select-none","range absolute","z-10",W().handle,V()?.class),()=>({left:`${A(qe).x??""}px`,top:`${A(qe).y??""}px`,width:`${x()??""}px`,height:`${A(qe).height??""}px`})]);var us=Tn(ho,2),rr=ar=>{ar.stopPropagation(),I()&&(I()[1]=A(xe),Y()({xDomain:I(),yDomain:k()}))};Ii(us,(ar,Zo)=>({...V(),"data-position":"right",class:ar,onpointerdown:_t,ondblclick:rr,[Ua]:Zo}),[()=>En(A(zt),"cursor-ew-resize select-none","range absolute","z-10",W().handle,V()?.class),()=>({left:`${A(it)-x()+1}px`,top:`${A(qe).y??""}px`,width:`${x()??""}px`,height:`${A(qe).height??""}px`})]),je(uo,oo)};Zt(lr,uo=>{(_()==="both"||_()==="x")&&uo(hr)})}je(wi,Oi)};Zt(Ri,wi=>{St.isActive&&wi(ur)})}Ln(fn),er(fn,wi=>rn(oe,wi),()=>A(oe)),Vi((wi,Oi,zi,qi)=>{Pr(fn,1,wi),Gn=_l(fn,"",Gn,Oi),Pr(Wn,1,zi),ti=_l(Wn,"",ti,qi)},[()=>Cr(En(Cn("brush-context"),"absolute touch-none")),()=>({top:`${c.padding.top??""}px`,left:`${c.padding.left??""}px`,width:`${c.width??""}px`,height:`${c.height??""}px`}),()=>Cr(En(Cn("brush-container"),"absolute")),()=>({top:`-${c.padding.top??0??""}px`,left:`-${c.padding.left??0??""}px`,width:`${c.containerWidth??""}px`,height:`${c.containerHeight??""}px`})]),je(vt,fn)};Zt(cn,vt=>{R()?vt(on):vt(Jt,!1)})}je(s,ut),Kn()}nT(["pointerdown","dblclick"]);const KP={top:0,right:0,bottom:0,left:0},nL=new eh("ChartContext");function _o(){return nL.getOr({})}function wZ(s){return nL.set(s)}const iL=new eh("RenderContext");function bl(){return iL.get()}function dS(s){return iL.set(s)}var TZ=Un("<div><!></div>");function SZ(s,n){Yn(n,!0);let c=Re(n,"ssr",3,!1),m=Re(n,"pointerEvents",3,!0),_=Re(n,"position",3,"relative"),x=Re(n,"percentRange",3,!1),T=Re(n,"ref",15),r=Re(n,"data",19,()=>[]),I=Re(n,"xNice",3,!1),k=Re(n,"yNice",3,!1),P=Re(n,"zNice",3,!1),R=Re(n,"rNice",3,!1),F=Re(n,"xScale",19,id),V=Re(n,"yScale",19,id),W=Re(n,"zScale",19,id),G=Re(n,"rScale",19,uq),K=Re(n,"padding",19,()=>({})),Y=Re(n,"verbose",3,!0),ne=Re(n,"debug",3,!1),oe=Re(n,"extents",19,()=>({})),ce=Re(n,"xDomainSort",3,!1),me=Re(n,"yDomainSort",3,!1),ue=Re(n,"zDomainSort",3,!1),_e=Re(n,"rDomainSort",3,!1),te=Re(n,"xReverse",3,!1),ie=Re(n,"zReverse",3,!1),xe=Re(n,"rReverse",3,!1),de=Re(n,"xBaseline",3,null),Te=Re(n,"yBaseline",3,null),De=Re(n,"meta",23,()=>({})),Be=Re(n,"radial",3,!1),Se=Re(n,"context",15),Ne=Mn(void 0);ki(()=>{T(A(Ne))});const it=fe(()=>n.xRange?n.xRange:Be()?[0,2*Math.PI]:void 0);let qe=Mn(100),ft=Mn(100);const St=nH(Xq,200),Dt=fe(()=>{if(n.xDomain!==void 0)return n.xDomain;if(de()!=null&&Array.isArray(r())){const kn=r().flatMap(Zr(n.x));return[Qr([de(),...kn]),co([de(),...kn])]}}),Kt=fe(()=>{if(n.yDomain!==void 0)return n.yDomain;if(Te()!=null&&Array.isArray(r())){const kn=r().flatMap(Zr(n.y));return[Qr([Te(),...kn]),co([Te(),...kn])]}}),et=fe(()=>n.yRange??(Be()?({height:kn})=>[0,kn/2]:void 0)),Qe=fe(()=>V()?!Wi(V()):!0),st=fe(()=>Vv(n.x)),tt=fe(()=>Vv(n.y)),gt=fe(()=>Vv(n.z)),Lt=fe(()=>Vv(n.r)),_t=fe(()=>Zr(n.c)),Je=fe(()=>Zr(n.x1)),Rt=fe(()=>Zr(n.y1)),ut=fe(()=>n.flatData??r()),cn=fe(()=>nP(Kv(oe()))),on=fe(()=>({x:A(st),y:A(tt),z:A(gt),r:A(Lt)})),Jt=fe(()=>typeof K()=="number"?{...KP,top:K(),right:K(),bottom:K(),left:K()}:{...KP,...K()});let vt=Mn(!1);const zt=fe(()=>{const kn=A(Jt).top,Qn=A(qe)-A(Jt).right,Mi=A(ft)-A(Jt).bottom,oi=A(Jt).left,Ui=Qn-oi,Er=Mi-kn;return Y()===!0&&(Ui<=0&&A(vt)===!0&&console.warn(`[LayerChart] Target div has zero or negative width (${Ui}). Did you forget to set an explicit width in CSS on the container?`),Er<=0&&A(vt)===!0&&console.warn(`[LayerChart] Target div has zero or negative height (${Er}). Did you forget to set an explicit height in CSS on the container?`)),{top:kn,left:oi,bottom:Mi,right:Qn,width:Ui,height:Er}}),fn=fe(()=>A(zt).width),Gn=fe(()=>A(zt).height),Wn=fe(()=>{const kn={x:{scale:F(),sort:ce()},y:{scale:V(),sort:me()},z:{scale:W(),sort:ue()},r:{scale:G(),sort:_e()}},Qn=nP(A(on),A(cn)),Mi=Object.fromEntries(Object.keys(Qn).map(oi=>[oi,kn[oi]]));return Object.keys(Qn).length>0?{...Pq(A(ut),Qn,Mi),...A(cn)}:{}}),ti=fe(()=>Ov("x",A(Wn),A(Dt))),yi=fe(()=>Ov("y",A(Wn),A(Kt))),Ri=fe(()=>Ov("z",A(Wn),n.zDomain)),ur=fe(()=>Ov("r",A(Wn),n.rDomain)),wi=fe(()=>n.x1Domain??Xa(e0(r()),A(Je))),Oi=fe(()=>n.y1Domain??Xa(e0(r()),A(Rt))),zi=fe(()=>n.cDomain??Jj(e0(r()).map(A(_t)))),qi=fe(()=>Kv(n.xPadding)),ir=fe(()=>Kv(A(Wn))),$r=fe(()=>Fv("x",{scale:F(),domain:A(ti),padding:A(qi),nice:I(),reverse:te(),percentRange:x(),range:A(it),height:A(Gn),width:A(fn),extents:A(ir)})),lr=fe(()=>Xf(A(st),A($r))),hr=fe(()=>Fv("y",{scale:V(),domain:A(yi),padding:n.yPadding,nice:k(),reverse:A(Qe),percentRange:x(),range:A(et),height:A(Gn),width:A(fn),extents:A(cn)})),uo=fe(()=>Xf(A(tt),A(hr))),oo=fe(()=>Fv("z",{scale:W(),domain:A(Ri),padding:n.zPadding,nice:P(),reverse:ie(),percentRange:x(),range:n.zRange,height:A(Gn),width:A(fn),extents:A(cn)})),ho=fe(()=>Xf(A(gt),A(oo))),Co=fe(()=>Fv("r",{scale:G(),domain:A(ur),padding:n.rPadding,nice:R(),reverse:xe(),percentRange:x(),range:n.rRange,height:A(Gn),width:A(fn),extents:A(cn)})),us=fe(()=>Xf(A(Lt),A(Co))),rr=fe(()=>n.x1Scale&&n.x1Range?Vb(n.x1Scale,A(wi),n.x1Range,{xScale:A($r),width:A(fn),height:A(Gn)}):null),ar=fe(()=>Xf(A(Je),A(rr))),Zo=fe(()=>n.y1Scale&&n.y1Range?Vb(n.y1Scale,A(Oi),n.y1Range,{yScale:A(hr),width:A(fn),height:A(Gn)}):null),to=fe(()=>Xf(A(Rt),A(Zo))),qr=fe(()=>n.cRange?Vb(n.cScale??px(),A(zi),n.cRange,{width:A(fn),height:A(Gn)}):null),Xo=fe(()=>kn=>A(qr)?.(A(_t)(kn))),Uo=fe(()=>A($r).domain()),Po=fe(()=>A(hr).domain()),Mt=fe(()=>A(oo).domain()),fo=fe(()=>A(Co).domain()),Yo=fe(()=>Nv(A($r))),jo=fe(()=>Nv(A(hr))),Xe=fe(()=>Nv(A(oo))),ee=fe(()=>Nv(A(Co))),se=fe(()=>A(fn)/A(Gn)),we=fe(()=>({x:n.x,y:n.y,z:n.z,r:n.r,c:n.c,x1:n.x1,y1:n.y1,xDomain:A(Dt),yDomain:A(Kt),zDomain:n.zDomain,rDomain:n.rDomain,x1Domain:n.x1Domain,y1Domain:n.y1Domain,cDomain:n.cDomain,xRange:n.xRange,yRange:n.yRange,zRange:n.zRange,rRange:n.rRange,cRange:n.cRange,x1Range:n.x1Range,y1Range:n.y1Range}));let Fe=Mn(null),Ie=Mn(null),Pe=Mn(null),nt=Mn(null);const Ge={get activeGetters(){return A(on)},get config(){return A(we)},get width(){return A(fn)},get height(){return A(Gn)},get percentRange(){return x()},get aspectRatio(){return A(se)},get containerWidth(){return A(qe)},get containerHeight(){return A(ft)},get x(){return A(st)},get y(){return A(tt)},get z(){return A(gt)},get r(){return A(Lt)},get c(){return A(_t)},get x1(){return A(Je)},get y1(){return A(Rt)},get data(){return r()},get xNice(){return I()},get yNice(){return k()},get zNice(){return P()},get rNice(){return R()},get xDomainSort(){return ce()},get yDomainSort(){return me()},get zDomainSort(){return ue()},get rDomainSort(){return _e()},get xReverse(){return te()},get yReverse(){return A(Qe)},get zReverse(){return ie()},get rReverse(){return xe()},get xPadding(){return n.xPadding},get yPadding(){return n.yPadding},get zPadding(){return n.zPadding},get rPadding(){return n.rPadding},get padding(){return A(Jt)},get flatData(){return A(ut)},get extents(){return A(Wn)},get xDomain(){return A(Uo)},get yDomain(){return A(Po)},get zDomain(){return A(Mt)},get rDomain(){return A(fo)},get cDomain(){return A(zi)},get x1Domain(){return A(wi)},get y1Domain(){return A(Oi)},get xRange(){return A(Yo)},get yRange(){return A(jo)},get zRange(){return A(Xe)},get rRange(){return A(ee)},get cRange(){return n.cRange},get x1Range(){return n.x1Range},get y1Range(){return n.y1Range},get meta(){return De()},set meta(kn){De(kn)},get xScale(){return A($r)},get yScale(){return A(hr)},get zScale(){return A(oo)},get rScale(){return A(Co)},get yGet(){return A(uo)},get xGet(){return A(lr)},get zGet(){return A(ho)},get rGet(){return A(us)},get cGet(){return A(Xo)},get x1Get(){return A(ar)},get y1Get(){return A(to)},get cScale(){return A(qr)},get x1Scale(){return A(rr)},get y1Scale(){return A(Zo)},get radial(){return Be()},get containerRef(){return A(Ne)},get geo(){return A(Fe)},get transform(){return A(Ie)},get tooltip(){return A(Pe)},get brush(){return A(nt)}};Se(Ge),wZ(Ge),Os(()=>{rn(vt,!0)}),bp(()=>{A(zt)&&ne()===!0&&(c()===!0||typeof window<"u")&&St({data:r(),flatData:typeof A(ut)<"u"?A(ut):null,boundingBox:A(zt),activeGetters:A(on),x:n.x,y:n.y,z:n.z,r:n.r,xScale:A($r),yScale:A(hr),zScale:A(oo),rScale:A(Co)})}),Os(()=>{A(vt)&&n.onResize?.({width:Ge.width,height:Ge.height,containerWidth:Ge.containerWidth,containerHeight:Ge.containerHeight})});const at=fe(()=>n.geo?.applyTransform?.includes("translate")&&n.geo?.fitGeojson&&n.geo?.projection?V7(n.geo.projection(),[A(fn),A(Gn)],n.geo.fitGeojson):void 0),Bt=fe(()=>{if(n.geo)return(kn,Qn,Mi,oi)=>{if(n.geo.applyTransform?.includes("rotate")&&A(Fe)?.projection){const Ui=A(Fe).projection.scale()??0,Er=75;return{x:kn+Mi*(Er/Ui),y:Qn+oi*(Er/Ui)*-1}}else return{x:kn+Mi,y:Qn+oi}}}),At=fe(()=>typeof n.brush=="object"?n.brush:{disabled:!n.brush}),dn=fe(()=>typeof n.tooltip=="object"?n.tooltip:{});var An=Gt(),Nn=yt(An);{var hi=kn=>{var Qn=TZ();let Mi;var oi=Xn(Qn);ex(oi,()=>A(vt),Ui=>{{let Er=fe(()=>n.transform?.mode??n.geo?.applyTransform?.length?"manual":"none"),so=fe(()=>A(at)?.translate),tr=fe(()=>A(at)?.scale);uH(Ui,Hn({get mode(){return A(Er)},get initialTranslate(){return A(so)},get initialScale(){return A(tr)},get processTranslate(){return A(Bt)}},()=>n.transform,{get ondragstart(){return n.ondragstart},get onTransform(){return n.onTransform},get ondragend(){return n.ondragend},get transformContext(){return A(Ie)},set transformContext(Ci){rn(Ie,Ci,!0)},children:(Ci,Vr)=>{dH(Ci,Hn(()=>n.geo,{get geoContext(){return A(Fe)},set geoContext(zr){rn(Fe,zr,!0)},children:(zr,mr)=>{bZ(zr,Hn(()=>A(At),{get brushContext(){return A(nt)},set brushContext(So){rn(nt,So,!0)},children:(So,is)=>{fZ(So,Hn(()=>A(dn),{get tooltipContext(){return A(Pe)},set tooltipContext(rs){rn(Pe,rs,!0)},children:(rs,Ma)=>{var Fo=Gt(),wl=yt(Fo);Dn(wl,()=>n.children??Si,()=>({context:Ge})),je(rs,Fo)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))}}),Ln(Qn),er(Qn,Ui=>rn(Ne,Ui),()=>A(Ne)),Vi((Ui,Er)=>{Pr(Qn,1,Ui,"svelte-2ex2wv"),Mi=_l(Qn,"",Mi,Er)},[()=>Cr(Cn("root-container")),()=>({position:_(),top:_()==="absolute"?"0":null,right:_()==="absolute"?"0":null,bottom:_()==="absolute"?"0":null,left:_()==="absolute"?"0":null,"pointer-events":m()===!1?"none":null})]),s0(Qn,"clientWidth",Ui=>rn(qe,Ui)),s0(Qn,"clientHeight",Ui=>rn(ft,Ui)),je(kn,Qn)};Zt(Nn,kn=>{(c()===!0||typeof window<"u")&&kn(hi)})}je(s,An),Kn()}var EZ=sr("<g><!></g>"),AZ=Un("<div><!></div>");function oc(s,n){Yn(n,!0);const c=_o();let m=Re(n,"center",3,!1),_=Re(n,"preventTouchMove",3,!1),x=Re(n,"opacity",3,void 0),T=Re(n,"ref",15),r=bi(n,["$$slots","$$events","$$legacy","x","initialX","y","initialY","center","preventTouchMove","opacity","motion","transitionIn","transitionInParams","class","children","ref"]),I=Mn(void 0);ki(()=>{T(A(I))});const k=n.initialX??n.x,P=n.initialY??n.y,R=fe(()=>n.x??(m()==="x"||m()===!0?c.width/2:0)),F=fe(()=>n.y??(m()==="y"||m()===!0?c.height/2:0)),V=Vo(k,()=>A(R),n.motion),W=Vo(P,()=>A(F),n.motion),G=fe(()=>n.transitionIn?n.transitionIn:Ip(n.motion)?.options?GT:()=>{}),K=fe(()=>n.transitionInParams?n.transitionInParams:{easing:Xz}),Y=fe(()=>{if(m()||n.x!=null||n.y!=null)return`translate(${V.current}px, ${W.current}px)`}),ne=bl();ne==="canvas"&&sc({name:"Group",render:te=>{const ie=te.globalAlpha;te.globalAlpha=x()??1,te.translate(V.current??0,W.current??0),te.globalAlpha=ie},retainState:!0,events:{click:n.onclick,dblclick:n.ondblclick,pointerenter:n.onpointerenter,pointermove:n.onpointermove,pointerleave:n.onpointerleave,pointerdown:n.onpointerdown},deps:()=>[V.current,W.current,x()]});const oe=te=>{_()&&te.preventDefault(),n.ontouchmove?.(te)};var ce=Gt(),me=yt(ce);{var ue=te=>{var ie=Gt(),xe=yt(ie);Dn(xe,()=>n.children??Si),je(te,ie)},_e=te=>{var ie=Gt(),xe=yt(ie);{var de=De=>{var Be=EZ();Ii(Be,(Ne,it)=>({class:Ne,opacity:x(),...r,ontouchmove:oe,[Ua]:it}),[()=>En(Cn("group-g"),n.class),()=>({transform:A(Y)})]);var Se=Xn(Be);Dn(Se,()=>n.children??Si),Ln(Be),er(Be,Ne=>rn(I,Ne),()=>A(I)),o0(1,Be,()=>A(G),()=>A(K)),je(De,Be)},Te=De=>{var Be=AZ();Ii(Be,(Ne,it)=>({...r,class:Ne,ontouchmove:oe,[Ua]:it}),[()=>En(Cn("group-div"),"absolute",n.class),()=>({transform:A(Y),opacity:x()})]);var Se=Xn(Be);Dn(Se,()=>n.children??Si),Ln(Be),er(Be,Ne=>rn(I,Ne),()=>A(I)),o0(1,Be,()=>A(G),()=>A(K)),je(De,Be)};Zt(xe,De=>{ne==="svg"?De(de):De(Te,!1)},!0)}je(te,ie)};Zt(me,te=>{ne==="canvas"?te(ue):te(_e,!1)})}je(s,ce),Kn()}function rL(s,n=0){let c=s;return c=c.replace(/([MLTQCSAZ])(-?\d*\.?\d+),(-?\d*\.?\d+)/g,(m,_,x,T)=>`${_}${x},${n}`),c=c.replace(/([v])(-?\d*\.?\d+)/g,(m,_,x)=>`${_}0`),c}var IZ=sr('<path d="M 0 0 L 10 5 L 0 10 z"></path>'),MZ=sr('<polyline points="0 0, 10 5, 0 10"></polyline>'),CZ=sr("<circle></circle>"),PZ=sr('<polyline points="5 0, 5 10"></polyline>'),kZ=sr("<defs><marker><!></marker></defs>");function RZ(s,n){const c=fa();Yn(n,!0);let m=Re(n,"id",19,()=>Ls("marker-",c)),_=Re(n,"size",3,10),x=Re(n,"markerWidth",19,_),T=Re(n,"markerHeight",19,_),r=Re(n,"markerUnits",3,"userSpaceOnUse"),I=Re(n,"orient",3,"auto-start-reverse"),k=Re(n,"refX",19,()=>["arrow","triangle"].includes(n.type??"")?9:5),P=Re(n,"refY",3,5),R=Re(n,"viewBox",3,"0 0 10 10"),F=bi(n,["$$slots","$$events","$$legacy","type","id","size","markerWidth","markerHeight","markerUnits","orient","refX","refY","viewBox","class","children"]);var V=kZ(),W=Xn(V);Ii(W,ne=>({id:m(),markerWidth:x(),markerHeight:T(),markerUnits:r(),orient:I(),refX:k(),refY:P(),viewBox:R(),...F,class:ne}),[()=>En(Cn("marker"),"overflow-visible",n.stroke==null&&(["arrow","circle-stroke","line"].includes(n.type??"")?"stroke-[context-stroke]":n.type==="circle"?"stroke-surface-100":"stroke-none"),"[stroke-linecap:round] [stroke-linejoin:round]",n.fill==null&&(["triangle","dot","circle"].includes(n.type??"")?"fill-[context-stroke]":n.type==="circle-stroke"?"fill-surface-100":"fill-none"),n.class)]);var G=Xn(W);{var K=ne=>{var oe=Gt(),ce=yt(oe);Dn(ce,()=>n.children),je(ne,oe)},Y=ne=>{var oe=Gt(),ce=yt(oe);{var me=_e=>{var te=IZ();Vi(ie=>Pr(te,0,ie),[()=>Cr(Cn("marker-triangle"))]),je(_e,te)},ue=_e=>{var te=Gt(),ie=yt(te);{var xe=Te=>{var De=MZ();Vi(Be=>Pr(De,0,Be),[()=>Cr(Cn("marker-arrow"))]),je(Te,De)},de=Te=>{var De=Gt(),Be=yt(De);{var Se=it=>{var qe=CZ();Gi(qe,"cx",5),Gi(qe,"cy",5),Gi(qe,"r",5),Vi(ft=>Pr(qe,0,ft),[()=>Cr(Cn("marker-circle"))]),je(it,qe)},Ne=it=>{var qe=Gt(),ft=yt(qe);{var St=Dt=>{var Kt=PZ();Vi(et=>Pr(Kt,0,et),[()=>Cr(Cn("marker-line"))]),je(Dt,Kt)};Zt(ft,Dt=>{n.type==="line"&&Dt(St)},!0)}je(it,qe)};Zt(Be,it=>{n.type==="circle"||n.type==="circle-stroke"||n.type==="dot"?it(Se):it(Ne,!1)},!0)}je(Te,De)};Zt(ie,Te=>{n.type==="arrow"?Te(xe):Te(de,!1)},!0)}je(_e,te)};Zt(ce,_e=>{n.type==="triangle"?_e(me):_e(ue,!1)},!0)}je(ne,oe)};Zt(G,ne=>{n.children?ne(K):ne(Y,!1)})}Ln(W),Ln(V),je(s,V),Kn()}function Hc(s,n){var c=Gt(),m=yt(c);{var _=T=>{var r=Gt(),I=yt(r);Dn(I,()=>n.marker,()=>({id:n.id})),je(T,r)},x=T=>{var r=Gt(),I=yt(r);{var k=P=>{{let R=fe(()=>typeof n.marker=="string"?n.marker:void 0);RZ(P,Hn({get id(){return n.id},get type(){return A(R)}},()=>typeof n.marker=="object"?n.marker:null))}};Zt(I,P=>{n.marker&&P(k)},!0)}je(T,r)};Zt(m,T=>{typeof n.marker=="function"?T(_):T(x,!1)})}je(s,c)}var zZ=sr("<path></path><!><!><!><!><!>",1);function ad(s,n){const c=fa();Yn(n,!0);const m=_o();let _=Re(n,"pathRef",15),x=bi(n,["$$slots","$$events","$$legacy","data","pathData","x","y","motion","draw","curve","defined","fill","stroke","strokeWidth","fillOpacity","class","marker","markerStart","markerMid","markerEnd","startContent","endContent","opacity","pathRef"]),T=Mn(void 0);ki(()=>{_(A(T))});const r=fe(()=>n.markerStart??n.marker),I=fe(()=>n.markerMid??n.marker),k=fe(()=>n.markerEnd??n.marker),P=fe(()=>A(r)?Ls("marker-start",c):""),R=fe(()=>A(I)?Ls("marker-mid",c):""),F=fe(()=>A(k)?Ls("marker-end",c):"");function V(ft,St,Dt){let Kt=Dt(ft);return Array.isArray(Kt)&&(Kt=co(Kt)),St.domain().length?St(Kt):Kt}const W=fe(()=>n.x?Zr(n.x):m.x),G=fe(()=>n.y?Zr(n.y):m.y),K=fe(()=>Wi(m.xScale)?m.xScale.bandwidth()/2:0),Y=fe(()=>Wi(m.yScale)?m.yScale.bandwidth()/2:0),ne=Ip(n.motion),oe=ne?{type:ne.type,options:{interpolate:XT,...ne.options}}:void 0;function ce(){if(oe){if(n.pathData)return rL(n.pathData,Math.min(m.yScale(0)??m.yRange[0],m.yRange[0]));if(m.config.x){const ft=m.radial?EC().angle(St=>m.xScale(A(W)(St))+0).radius(St=>Math.min(m.yScale(0),m.yRange[0])):a_().x(St=>m.xScale(A(W)(St))+A(K)).y(St=>Math.min(m.yScale(0),m.yRange[0]));return ft.defined(n.defined??(St=>A(W)(St)!=null&&A(G)(St)!=null)),n.curve&&ft.curve(n.curve),ft(n.data??m.data)}}else return""}const me=fe(()=>{const ft=m.radial?EC().angle(St=>V(St,m.xScale,A(W))+0).radius(St=>V(St,m.yScale,A(G))+A(Y)):a_().x(St=>V(St,m.xScale,A(W))+A(K)).y(St=>V(St,m.yScale,A(G))+A(Y));return ft.defined(n.defined??(St=>A(W)(St)!=null&&A(G)(St)!=null)),n.curve&&ft.curve(n.curve),n.pathData??ft(n.data??m.data)??""}),ue=Vo(ce(),()=>A(me),oe),_e=fe(()=>n.draw?j8:()=>({}));let te=Mn(Ya(Symbol()));const ie=bl();function xe(ft,St){T_(ft,ue.current,St?cd({styles:{strokeWidth:n.strokeWidth}},St):{styles:{fill:n.fill,fillOpacity:n.fillOpacity,stroke:n.stroke,strokeWidth:n.strokeWidth,opacity:n.opacity},classes:n.class})}const de=da(()=>n.fill),Te=da(()=>n.stroke);ie==="canvas"&&sc({name:"Spline",render:xe,events:{click:n.onclick,pointerenter:n.onpointerenter,pointermove:n.onpointermove,pointerleave:n.onpointerleave,pointerdown:n.onpointerdown,pointerover:n.onpointerover,pointerout:n.onpointerout,touchmove:n.ontouchmove},deps:()=>[de.current,n.fillOpacity,Te.current,n.strokeWidth,n.opacity,n.class,ue.current]});let De=Mn(void 0);const Be=fe(()=>typeof n.draw=="object"&&n.draw.duration!==void 0&&typeof n.draw.duration!="function"?n.draw.duration:800),Se=g2(void 0,n.draw?{type:"tween",duration:()=>A(Be),easing:typeof n.draw=="object"&&n.draw.easing?n.draw.easing:D8,interpolate(){return ft=>{const St=A(T)?.getTotalLength()??0;return A(T)?.getPointAtLength(St*ft)}}}:{type:"none"});Os(()=>{if(!n.startContent&&!n.endContent||(A(me),!A(T)||!A(T).getTotalLength()))return;rn(De,A(T).getPointAtLength(0),!0);const ft=A(T).getTotalLength();Se.target=A(T).getPointAtLength(ft)}),Os(()=>{n.draw&&(n.pathData,n.data,m.data,rn(te,Symbol(),!0))});var Ne=Gt(),it=yt(Ne);{var qe=ft=>{var St=Gt(),Dt=yt(St);ex(Dt,()=>A(te),Kt=>{var et=zZ(),Qe=yt(et);Ii(Qe,ut=>({d:ue.current,...x,class:ut,fill:n.fill,"fill-opacity":n.fillOpacity,stroke:n.stroke,"stroke-width":n.strokeWidth,opacity:n.opacity,"marker-start":A(P)?`url(#${A(P)})`:void 0,"marker-mid":A(R)?`url(#${A(R)})`:void 0,"marker-end":A(F)?`url(#${A(F)})`:void 0}),[()=>En(Cn("spline-path"),!n.fill&&"fill-none",!n.stroke&&"stroke-surface-content",n.class)]),er(Qe,ut=>rn(T,ut),()=>A(T));var st=Tn(Qe);Hc(st,{get id(){return A(P)},get marker(){return A(r)}});var tt=Tn(st);Hc(tt,{get id(){return A(R)},get marker(){return A(I)}});var gt=Tn(tt);Hc(gt,{get id(){return A(F)},get marker(){return A(k)}});var Lt=Tn(gt);{var _t=ut=>{{let cn=fe(()=>Cn("spline-g-start"));oc(ut,{get x(){return A(De).x},get y(){return A(De).y},get class(){return A(cn)},children:(on,Jt)=>{var vt=Gt(),zt=yt(vt);{let fn=fe(()=>({point:A(De),value:{x:m.xScale?.invert?.(A(De).x),y:m.yScale?.invert?.(A(De).y)}}));Dn(zt,()=>n.startContent,()=>A(fn))}je(on,vt)},$$slots:{default:!0}})}};Zt(Lt,ut=>{n.startContent&&A(De)&&ut(_t)})}var Je=Tn(Lt);{var Rt=ut=>{{let cn=fe(()=>Cn("spline-g-end"));oc(ut,{get x(){return Se.current.x},get y(){return Se.current.y},get class(){return A(cn)},children:(on,Jt)=>{var vt=Gt(),zt=yt(vt);{let fn=fe(()=>({point:Se.current,value:{x:m.xScale?.invert?.(Se.current.x),y:m.yScale?.invert?.(Se.current.y)}}));Dn(zt,()=>n.endContent,()=>A(fn))}je(on,vt)},$$slots:{default:!0}})}};Zt(Je,ut=>{n.endContent&&Se.current&&ut(Rt)})}o0(5,Qe,()=>A(_e),()=>typeof n.draw=="object"?n.draw:void 0),je(Kt,et)}),je(ft,St)};Zt(it,ft=>{ie==="svg"&&ft(qe)})}je(s,Ne),Kn()}function fS(s){const n=s.match(/(^.+?)(L|Z)/);return!n||!n[1]?s:n[1]}function JP(s){return(s%360+360)%360}function DZ(s){const n=fe(()=>(s.innerRadius()+s.outerRadius())/2),c=fe(()=>s.cornerRadius()<=0||A(n)<=0?0:Math.min(s.cornerRadius(),A(n))*.5/A(n)),m=fe(()=>s.invertCorner()?s.startAngle()-A(c):s.startAngle()+A(c)),_=fe(()=>s.invertCorner()?s.endAngle()+A(c):s.endAngle()-A(c)),x=fe(()=>fS(s_().outerRadius(A(n)).innerRadius(A(n)-.5).startAngle(A(m)).endAngle(A(_))()??""));return{get current(){return A(x)}}}function LZ(s){const n=fe(()=>s.cornerRadius()<=0||s.innerRadius()<=0?0:s.cornerRadius()>=s.innerRadius()?Math.PI/4:s.cornerRadius()*.5/s.innerRadius()),c=fe(()=>s.invertCorner()?s.startAngle()-A(n):s.startAngle()+A(n)),m=fe(()=>s.invertCorner()?s.endAngle()+A(n):s.endAngle()-A(n)),_=fe(()=>fS(s_().innerRadius(s.innerRadius()).outerRadius(s.innerRadius()+.5).startAngle(A(c)).endAngle(A(m))()??""));return{get current(){return A(_)}}}function OZ(s){const n=fe(()=>s.cornerRadius()<=0||s.outerRadius()<=0?0:s.cornerRadius()*.5/s.outerRadius()),c=fe(()=>s.invertCorner()?s.startAngle()-A(n):s.startAngle()+A(n)),m=fe(()=>s.invertCorner()?s.endAngle()+A(n):s.endAngle()-A(n)),_=fe(()=>fS(s_().innerRadius(s.outerRadius()-.5).outerRadius(s.outerRadius()).startAngle(A(c)).endAngle(A(m))()??""));return{get current(){return A(_)}}}function FZ(s,n){const c=n-Math.PI/2;return[s*Math.cos(c),s*Math.sin(c)]}function QP(s,n={},c){const m=fe(()=>{const _e=s.startAngle(),te=s.endAngle(),ie=n.startOffset;if(ie)try{const xe=parseFloat(ie.slice(0,-1))/100;if(!isNaN(xe)&&xe>=0&&xe<=1){const de=te-_e;return _e+de*xe}else console.warn("Invalid percentage for startOffset:",ie)}catch(xe){console.warn("Could not parse startOffset percentage:",ie,xe)}return _e}),_=fe(()=>Zv(A(m))),x=fe(()=>JP(A(_))),T=fe(()=>Zv(s.startAngle())),r=fe(()=>Zv(s.endAngle())),I=fe(()=>A(T)<A(r)),k=fe(()=>A(I)&&(A(x)>=270||A(x)<=90)),P=fe(()=>!A(I)&&(A(x)>270||A(x)<=90)),R=fe(()=>A(I)&&A(x)<270&&A(x)>=90),F=fe(()=>!A(I)&&A(x)<=270&&A(x)>90),V=fe(()=>A(P)||A(R)),W={...s,startAngle:()=>A(V)?s.endAngle():s.startAngle(),endAngle:()=>A(V)?s.startAngle():s.endAngle(),invertCorner:()=>A(R)||A(F)},G=LZ(W),K=DZ(W),Y=OZ(W),ne=fe(()=>A(R)||A(F)?"auto":A(k)||A(P)?"hanging":"auto"),oe=fe(()=>{if(A(R)||A(F))return"hanging"}),ce=fe(()=>A(V)?{startOffset:n.startOffset??"100%",textAnchor:"end"}:{startOffset:n.startOffset??void 0}),me=fe(()=>{if(c!=="outer-radial")return{};const _e=(s.startAngle()+s.endAngle())/2,te=n.radialOffset??n.outerPadding??23,ie=JP(Zv(_e));let xe="middle",de=te;const Te=ie>45&&ie<135,De=ie>225&&ie<315,Be=ie<=45||ie>=315,Se=ie>=135&&ie<=225,Ne=s.outerRadius()+de,[it,qe]=FZ(Ne,_e);return Be?(xe="start",(ie>350||ie<10)&&(xe="start")):Se?(xe="end",ie>170&&ie<190&&(xe="end")):(Te||De)&&(xe="middle"),{x:it,y:qe,textAnchor:xe,dominantBaseline:"middle"}}),ue=fe(()=>{if(c==="inner")return{path:G.current,...A(ce),dominantBaseline:A(ne)};if(c==="outer")return{path:Y.current,...A(ce),dominantBaseline:A(oe)};if(c==="middle")return{path:K.current,...A(ce),dominantBaseline:"middle"};if(c==="centroid"){const _e=s.centroid();return{x:_e[0],y:_e[1],textAnchor:"middle",verticalAnchor:"middle"}}else return A(me)});return{get current(){return A(ue)}}}var BZ=Un("<!> <!> <!>",1);function pS(s,n){Yn(n,!0);let c=Re(n,"ref",15),m=Re(n,"trackRef",15),_=Re(n,"value",3,0),x=Re(n,"initialValue",3,0),T=Re(n,"domain",19,()=>[0,100]),r=Re(n,"range",19,()=>[0,360]),I=Re(n,"cornerRadius",3,0),k=Re(n,"padAngle",3,0),P=Re(n,"stroke",3,"none"),R=Re(n,"offset",3,0),F=Re(n,"onpointerenter",3,()=>{}),V=Re(n,"onpointermove",3,()=>{}),W=Re(n,"onpointerleave",3,()=>{}),G=Re(n,"ontouchmove",3,()=>{}),K=Re(n,"track",3,!1),Y=bi(n,["$$slots","$$events","$$legacy","ref","trackRef","motion","value","initialValue","domain","range","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","trackStartAngle","trackEndAngle","trackInnerRadius","trackOuterRadius","trackCornerRadius","trackPadAngle","fill","fillOpacity","stroke","strokeWidth","opacity","data","offset","onpointerenter","onpointermove","onpointerleave","ontouchmove","tooltipContext","track","children","class"]),ne=Mn(void 0),oe=Mn(void 0);ki(()=>{c(A(ne))}),ki(()=>{m(A(oe))});const ce=_o(),me=fe(()=>n.endAngle??ep(ce.config.xRange?co(ce.xRange):co(r()))),ue=Vo(x(),()=>_(),n.motion),_e=fe(()=>id().domain(T()).range(r()));function te(zt,fn){return zt?zt>1?zt:zt>0?fn*zt:zt<0?fn+zt:zt:fn}const ie=fe(()=>te(n.outerRadius,(Math.min(ce.xRange[1],ce.yRange[0])??0)/2)),xe=fe(()=>n.trackOuterRadius?te(n.trackOuterRadius,(Math.min(ce.xRange[1],ce.yRange[0])??0)/2):A(ie));function de(zt,fn){return zt==null?Math.min(...ce.yRange):zt>1?zt:zt>0?fn*zt:zt<0?fn+zt:zt}const Te=fe(()=>de(n.innerRadius,A(ie))),De=fe(()=>n.trackInnerRadius?de(n.trackInnerRadius,A(xe)):A(Te)),Be=fe(()=>n.startAngle??ep(r()[0])),Se=fe(()=>n.trackStartAngle??n.startAngle??ep(r()[0])),Ne=fe(()=>n.trackEndAngle??n.endAngle??ep(r()[1])),it=fe(()=>n.trackCornerRadius??I()),qe=fe(()=>n.trackPadAngle??k()),ft=fe(()=>n.endAngle??ep(A(_e)(ue.current))),St=fe(()=>s_().innerRadius(A(Te)).outerRadius(A(ie)).startAngle(A(Be)).endAngle(A(ft)).cornerRadius(I()).padAngle(k())),Dt=fe(()=>s_().innerRadius(A(De)).outerRadius(A(xe)).startAngle(A(Se)).endAngle(A(Ne)).cornerRadius(A(it)).padAngle(A(qe))),Kt=fe(()=>((A(Be)??0)+(A(me)??0))/2),et=fe(()=>Math.sin(A(Kt))*R()),Qe=fe(()=>-Math.cos(A(Kt))*R()),st=fe(()=>{const zt=A(Dt).centroid();return[zt[0]+A(et),zt[1]+A(Qe)]}),tt=fe(()=>A(oe)?A(oe).getBBox():{}),gt=zt=>{F()?.(zt),n.tooltipContext?.show(zt,n.data)},Lt=zt=>{V()?.(zt),n.tooltipContext?.show(zt,n.data)},_t=zt=>{W()?.(zt),n.tooltipContext?.hide()};function Je(zt,fn={}){return QP({startAngle:()=>A(Se),endAngle:()=>A(Ne),outerRadius:()=>A(xe)+(fn.outerPadding?fn.outerPadding:0),innerRadius:()=>A(De),cornerRadius:()=>A(it),centroid:()=>A(st)},fn,zt).current}function Rt(zt,fn={}){return QP({startAngle:()=>A(Be),endAngle:()=>A(ft),outerRadius:()=>A(ie)+(fn.outerPadding?fn.outerPadding:0),innerRadius:()=>A(Te),cornerRadius:()=>I(),centroid:()=>A(st)},fn,zt).current}var ut=BZ(),cn=yt(ut);{var on=zt=>{{let fn=fe(()=>A(Dt)()),Gn=fe(()=>To(K(),"arc-track"));ad(zt,Hn({get pathData(){return A(fn)},stroke:"none"},()=>A(Gn),{get pathRef(){return A(oe)},set pathRef(Wn){rn(oe,Wn,!0)}}))}};Zt(cn,zt=>{K()&&zt(on)})}var Jt=Tn(cn,2);{let zt=fe(()=>A(St)()),fn=fe(()=>En(Cn("arc-line"),n.class));ad(Jt,Hn({get pathData(){return A(zt)},get transform(){return`translate(${A(et)??""}, ${A(Qe)??""})`},get fill(){return n.fill},get fillOpacity(){return n.fillOpacity},get stroke(){return P()},get"stroke-width"(){return n.strokeWidth},get opacity(){return n.opacity}},()=>Y,{get class(){return A(fn)},onpointerenter:gt,onpointermove:Lt,onpointerleave:_t,ontouchmove:Gn=>{G()?.(Gn),n.tooltipContext&&Gn.preventDefault()},get pathRef(){return A(ne)},set pathRef(Gn){rn(ne,Gn,!0)}}))}var vt=Tn(Jt,2);Dn(vt,()=>n.children??Si,()=>({centroid:A(st),boundingBox:A(tt),value:ue.current,getTrackTextProps:Je,getArcTextProps:Rt})),je(s,ut),Kn()}var NZ=Un("<div><!></div>");function VZ(s,n){Yn(n,!0);let c=Re(n,"ref",15),m=Re(n,"zIndex",3,0),_=Re(n,"pointerEvents",3,!0),x=Re(n,"center",3,!1),T=Re(n,"ignoreTransform",3,!1),r=bi(n,["$$slots","$$events","$$legacy","ref","zIndex","pointerEvents","role","aria-label","aria-labelledby","aria-describedby","center","ignoreTransform","class","children"]),I=Mn(void 0);ki(()=>{c(A(I))});const k=fe(()=>n.role||(n["aria-label"]||n["aria-labelledby"]||n["aria-describedby"]?"figure":void 0)),P=_o(),R=gx(),F=fe(()=>{if(R.mode==="canvas"&&!T())return`translate(${R.translate.x}px,${R.translate.y}px) scale(${R.scale})`;if(x())return`translate(${x()==="x"||x()===!0?P.width/2:0}px, ${x()==="y"||x()===!0?P.height/2:0}px)`});dS("html");var V=NZ();Ii(V,(G,K)=>({class:G,role:A(k),"aria-label":n["aria-label"],"aria-labelledby":n["aria-labelledby"],"aria-describedby":n["aria-describedby"],...r,[Ua]:K}),[()=>En(Cn("layout-html"),"absolute top-0 left-0",_()===!1&&"pointer-events-none",n.class),()=>({transform:A(F),"transform-origin":"top left","z-index":m(),"pointer-events":_()===!1?"none":null,top:`${P.padding.top??""}px`,bottom:`${P.padding.bottom??""}px`,left:`${P.padding.left??""}px`,right:`${P.padding.right??""}px`})]);var W=Xn(V);Dn(W,()=>n.children??Si,()=>({ref:A(I)})),Ln(V),er(V,G=>rn(I,G),()=>A(I)),je(s,V),Kn()}function UZ(s,n){let c=bi(n,["$$slots","$$events","$$legacy","type","children"]);var m=Gt(),_=yt(m);{var x=r=>{ZH(r,Hn(()=>c,{children:(I,k)=>{var P=Gt(),R=yt(P);Dn(R,()=>n.children??Si),je(I,P)},$$slots:{default:!0}}))},T=r=>{var I=Gt(),k=yt(I);{var P=F=>{t0(F,Hn(()=>c,{children:(V,W)=>{var G=Gt(),K=yt(G);Dn(K,()=>n.children??Si),je(V,G)},$$slots:{default:!0}}))},R=F=>{var V=Gt(),W=yt(V);{var G=K=>{VZ(K,Hn(()=>c,{children:(Y,ne)=>{var oe=Gt(),ce=yt(oe);Dn(ce,()=>n.children??Si),je(Y,oe)},$$slots:{default:!0}}))};Zt(W,K=>{n.type==="html"&&K(G)},!0)}je(F,V)};Zt(k,F=>{n.type==="svg"?F(P):F(R,!1)},!0)}je(r,I)};Zt(_,r=>{n.type==="canvas"?r(x):r(T,!1)})}je(s,m)}var jZ=sr("<image></image>");function GZ(s,n){Yn(n,!0);let c=Re(n,"steps",3,10),m=Re(n,"height",3,"20px"),_=Re(n,"width",3,"100%"),x=Re(n,"ref",15),T=bi(n,["$$slots","$$events","$$legacy","interpolator","steps","height","width","ref"]),r=Mn(void 0);ki(()=>{x(A(r))});let I=Mn("");Os(()=>{const P=document.createElement("canvas");P.width=c(),P.height=1;const R=P.getContext("2d");for(let F=0;F<c();++F)n.interpolator&&(R.fillStyle=n.interpolator(F/(c()-1))),R.fillRect(F,0,1,1);rn(I,P.toDataURL(),!0)});var k=jZ();Ii(k,P=>({href:A(I),preserveAspectRatio:"none",height:m(),width:_(),...P}),[()=>To(T,"color-ramp")]),er(k,P=>rn(r,P),()=>A(r)),je(s,k),Kn()}var WZ=sr("<rect></rect>"),qZ=sr("<line></line>"),HZ=sr('<text text-anchor="middle"> </text><!>',1),ZZ=sr("<svg><g><!></g><g></g></svg>"),XZ=(s,n,c)=>n.onclick?.(s,A(c)),YZ=Un("<button><div></div> <div> </div></button>"),KZ=Un("<div></div>"),JZ=Un("<div><div> </div> <!></div>");function QZ(s,n){Yn(n,!0);let c=Re(n,"title",3,""),m=Re(n,"width",3,320),_=Re(n,"height",3,10),x=Re(n,"ticks",19,()=>m()/64),T=Re(n,"tickFontSize",3,10),r=Re(n,"tickLength",3,4),I=Re(n,"orientation",3,"horizontal"),k=Re(n,"variant",3,"ramp"),P=Re(n,"classes",19,()=>({})),R=Re(n,"ref",15),F=bi(n,["$$slots","$$events","$$legacy","scale","title","width","height","ticks","tickFormat","tickValues","tickFontSize","tickLength","placement","orientation","onclick","onpointerenter","onpointerleave","variant","classes","ref","class","children"]),V=Mn(void 0);ki(()=>{R(A(V))});const W=_o(),G=fe(()=>n.scale??W.cScale),K=fe(()=>{if(A(G))if(A(G).interpolate){const _e=Math.min(A(G).domain().length,A(G).range().length),te=A(G).copy().rangeRound?.(WC(h_(0,m()),_e)),ie=A(G).copy().domain(WC(h_(0,1),_e)),xe=n.tickFormat??te?.tickFormat?.();return{xScale:te,interpolator:ie,tickFormat:xe,tickLabelOffset:0,tickLine:!0,tickValues:n.tickValues,tickLength:r(),swatches:void 0}}else if(A(G).interpolator){const _e=Object.assign(A(G).copy().interpolator(uD(0,m())),{range(){return[0,m()]}}),te=A(G).interpolator();let ie=n.tickValues;if(!_e.ticks&&ie===void 0){const de=Math.round(x()+1);ie=n_(de).map(Te=>iU(A(G).domain(),Te/(de-1)))}const xe=n.tickFormat??_e.tickFormat?.();return{interpolator:te,tickValues:ie,tickFormat:xe,swatches:void 0,tickLabelOffset:0,tickLine:!0,tickLength:r(),xScale:_e}}else if(A(G).invertExtent){const _e=A(G).thresholds?A(G).thresholds():A(G).quantiles?A(G).quantiles():A(G).domain(),te=id().domain([-1,A(G).range().length-1]).rangeRound([0,m()]),ie=A(G).range().map((Te,De)=>({x:te(De-1),y:0,width:te(De)-te(De-1),height:_(),fill:Te})),xe=n_(_e.length);return{xScale:te,swatches:ie,tickValues:xe,tickFormat:Te=>{const De=_e[Te];return n.tickFormat?Jr(De,n.tickFormat):De},tickLabelOffset:0,tickLine:!0,tickLength:r(),interpolator:void 0}}else{const _e=sD().domain(A(G).domain()).rangeRound([0,m()]),te=A(G).domain().map(De=>({x:_e(De),y:0,width:Math.max(0,_e.bandwidth()-1),height:_(),fill:A(G)(De)})),ie=A(G).domain(),xe=_e.bandwidth()/2;return{xScale:_e,tickFormat:n.tickFormat,tickLabelOffset:xe,tickLine:!1,tickLength:0,tickValues:ie,swatches:te,interpolator:void 0}}else return{xScale:void 0,interpolator:void 0,swatches:void 0,tickLabelOffset:0,tickLine:!0,tickLength:r(),tickFormat:n.tickFormat,tickValues:n.tickValues}});var Y=JZ();Ii(Y,_e=>({...F,"data-placement":n.placement,class:_e}),[()=>En(Cn("legend-container"),"inline-block","z-1",n.placement&&["absolute",{"top-left":"top-0 left-0",top:"top-0 left-1/2 -translate-x-1/2","top-right":"top-0 right-0",left:"top-1/2 left-0 -translate-y-1/2",center:"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",right:"top-1/2 right-0 -translate-y-1/2","bottom-left":"bottom-0 left-0",bottom:"bottom-0 left-1/2 -translate-x-1/2","bottom-right":"bottom-0 right-0"}[n.placement]],n.class,P().root)]);var ne=Xn(Y),oe=Xn(ne,!0);Ln(ne);var ce=Tn(ne,2);{var me=_e=>{var te=Gt(),ie=yt(te);{let xe=fe(()=>({values:A(K).tickValues??A(K).xScale?.ticks?.(x())??[],scale:A(G)}));Dn(ie,()=>n.children,()=>A(xe))}je(_e,te)},ue=_e=>{var te=Gt(),ie=yt(te);{var xe=Te=>{var De=ZZ(),Be=Xn(De),Se=Xn(Be);{var Ne=ft=>{{let St=fe(()=>Cn("legend-color-ramp"));GZ(ft,{get width(){return m()},get height(){return _()},get interpolator(){return A(K).interpolator},get class(){return A(St)}})}},it=ft=>{var St=Gt(),Dt=yt(St);{var Kt=et=>{var Qe=Gt(),st=yt(Qe);ro(st,17,()=>A(K).swatches,cs,(tt,gt)=>{var Lt=WZ();Ii(Lt,_t=>({..._t}),[()=>To(A(gt),"legend-swatch")]),je(tt,Lt)}),je(et,Qe)};Zt(Dt,et=>{A(K).swatches&&et(Kt)},!0)}je(ft,St)};Zt(Se,ft=>{A(K).interpolator?ft(Ne):ft(it,!1)})}Ln(Be);var qe=Tn(Be);ro(qe,21,()=>n.tickValues??A(K).xScale?.ticks?.(x())??[],cs,(ft,St)=>{var Dt=HZ(),Kt=yt(Dt);let et;var Qe=Xn(Kt,!0);Ln(Kt);var st=Tn(Kt);{var tt=gt=>{var Lt=qZ();Gi(Lt,"y1",0),Vi((_t,Je,Rt)=>{Gi(Lt,"x1",_t),Gi(Lt,"x2",Je),Gi(Lt,"y2",_()+r()),Pr(Lt,0,Rt)},[()=>A(K).xScale?.(A(St)),()=>A(K).xScale?.(A(St)),()=>Cr(En(Cn("legend-tick-line"),"stroke-surface-content",P().tick))]),je(gt,Lt)};Zt(st,gt=>{A(K).tickLine&&gt(tt)})}Vi((gt,Lt,_t,Je)=>{Gi(Kt,"x",gt),Gi(Kt,"y",_()+r()+T()),Pr(Kt,0,Lt),et=_l(Kt,"",et,_t),Es(Qe,Je)},[()=>A(K).xScale?.(A(St))+A(K).tickLabelOffset,()=>Cr(En(Cn("legend-tick-text"),"text-[10px] fill-surface-content",P().label)),()=>({"font-size":T()}),()=>n.tickFormat?Jr(A(St),n.tickFormat):A(St)]),je(ft,Dt)}),Ln(qe),Ln(De),Vi((ft,St,Dt)=>{Gi(De,"width",m()),Gi(De,"height",_()+r()+T()),Gi(De,"viewBox",`0 0 ${m()??""} ${_()+r()+T()}`),Pr(De,0,ft),Pr(Be,0,St),Pr(qe,0,Dt)},[()=>Cr(En(Cn("legend-ramp-svg"),"overflow-visible")),()=>Cr(Cn("legend-ramp-g")),()=>Cr(Cn("legend-tick-group"))]),je(Te,De)},de=Te=>{var De=Gt(),Be=yt(De);{var Se=Ne=>{var it=KZ();ro(it,21,()=>A(K).tickValues??A(K).xScale?.ticks?.(x())??[],cs,(qe,ft)=>{const St=fe(()=>A(G)?.(A(ft))??""),Dt=fe(()=>({value:A(ft),color:A(St)}));var Kt=YZ();Kt.__click=[XZ,n,Dt];var et=Xn(Kt);let Qe;var st=Tn(et,2),tt=Xn(st,!0);Ln(st),Ln(Kt),Vi((gt,Lt,_t,Je,Rt)=>{Pr(Kt,1,gt),Pr(et,1,Lt),Qe=_l(et,"",Qe,_t),Pr(st,1,Je),Es(tt,Rt)},[()=>Cr(En(Cn("legend-swatch-button"),"flex items-center gap-1 truncate",!n.onclick&&"cursor-auto",typeof P().item=="function"?P().item(A(Dt)):P().item)),()=>Cr(En(Cn("legend-swatch"),"h-4 w-4 shrink-0 rounded-full",P().swatch)),()=>({"background-color":A(St)}),()=>Cr(En(Cn("legend-swatch-label"),"text-xs text-surface-content truncate whitespace-nowrap",P().label)),()=>n.tickFormat?Jr(A(ft),n.tickFormat):A(ft)]),np("pointerenter",Kt,gt=>n.onpointerenter?.(gt,A(Dt))),np("pointerleave",Kt,gt=>n.onpointerleave?.(gt,A(Dt))),je(qe,Kt)}),Ln(it),Vi(qe=>Pr(it,1,qe),[()=>Cr(En(Cn("legend-swatch-group"),"flex gap-x-4 gap-y-1",I()==="vertical"&&"flex-col",P().items))]),je(Ne,it)};Zt(Be,Ne=>{k()==="swatches"&&Ne(Se)},!0)}je(Te,De)};Zt(ie,Te=>{k()==="ramp"?Te(xe):Te(de,!1)},!0)}je(_e,te)};Zt(ce,_e=>{n.children?_e(me):_e(ue,!1)})}Ln(Y),er(Y,_e=>rn(V,_e),()=>A(V)),Vi(_e=>{Pr(ne,1,_e),Es(oe,c())},[()=>Cr(En(Cn("legend-title"),"text-[10px] font-semibold",P().title))]),je(s,Y),Kn()}nT(["click"]);var $Z=Un("<div></div>"),eX=Un("<div><!> <!></div>");function tX(s,n){Yn(n,!0);let c=Re(n,"ref",15),m=Re(n,"colorRef",15),_=Re(n,"classes",19,()=>({root:"",color:""})),x=Re(n,"props",19,()=>({root:{},color:{}})),T=bi(n,["$$slots","$$events","$$legacy","ref","colorRef","value","format","color","classes","props","class","children"]),r=Mn(void 0),I=Mn(void 0);ki(()=>{c(A(r))}),ki(()=>{m(A(I))});var k=eX();Ii(k,G=>({class:G,...T}),[()=>En(Cn("tooltip-header"),"font-semibold whitespace-nowrap border-b mb-1 pb-1 flex items-center gap-2",_().root,x().root?.class,n.class)]);var P=Xn(k);{var R=G=>{var K=$Z();let Y;er(K,ne=>rn(I,ne),()=>A(I)),Vi((ne,oe)=>{Pr(K,1,ne),Y=_l(K,"",Y,oe)},[()=>Cr(En(Cn("tooltip-header-color"),"color","inline-block size-2 rounded-full bg-[var(--color)]",_().color)),()=>({"--color":n.color})]),je(G,K)};Zt(P,G=>{n.color&&G(R)})}var F=Tn(P,2);{var V=G=>{var K=Gt(),Y=yt(K);Dn(Y,()=>n.children??Si),je(G,K)},W=G=>{var K=Za();Vi(Y=>Es(K,Y),[()=>n.format?Jr(n.value,n.format):n.value]),je(G,K)};Zt(F,G=>{n.children?G(V):G(W,!1)})}Ln(k),er(k,G=>rn(r,G),()=>A(r)),je(s,k),Kn()}var nX=Un("<div></div>"),iX=Un("<div><div><!> <!></div> <div><!></div></div>");function $P(s,n){Yn(n,!0);let c=Re(n,"ref",15),m=Re(n,"labelRef",15),_=Re(n,"valueRef",15),x=Re(n,"colorRef",15),T=Re(n,"valueAlign",3,"left"),r=Re(n,"classes",19,()=>({root:"",label:"",value:"",color:""})),I=Re(n,"props",19,()=>({root:{},label:{},value:{},color:{}})),k=bi(n,["$$slots","$$events","$$legacy","ref","labelRef","valueRef","colorRef","label","value","format","valueAlign","color","classes","props","class","children"]),P=Mn(void 0),R=Mn(void 0),F=Mn(void 0),V=Mn(void 0);ki(()=>{c(A(P))}),ki(()=>{m(A(R))}),ki(()=>{_(A(F))}),ki(()=>{x(A(V))});var W=iX();Ii(W,ie=>({...I().root,class:ie,...k}),[()=>En(Cn("tooltip-item-root"),"contents",r().root,n.class,I().root?.class)]);var G=Xn(W);Ii(G,ie=>({...I().label,class:ie}),[()=>En(Cn("tooltip-item-label"),"label","flex items-center gap-2 whitespace-nowrap",r().label,I().label?.class)]);var K=Xn(G);{var Y=ie=>{var xe=nX();Ii(xe,(de,Te)=>({...I().color,class:de,[Ua]:Te}),[()=>En(Cn("tooltip-item-color"),"color","inline-block size-2 rounded-full bg-[var(--color)]",r().color,I().color?.class),()=>({"--color":n.color})]),er(xe,de=>rn(V,de),()=>A(V)),je(ie,xe)};Zt(K,ie=>{n.color&&ie(Y)})}var ne=Tn(K,2);{var oe=ie=>{var xe=Gt(),de=yt(xe);Dn(de,()=>n.label),je(ie,xe)},ce=ie=>{var xe=Za();Vi(()=>Es(xe,n.label)),je(ie,xe)};Zt(ne,ie=>{typeof n.label=="function"?ie(oe):ie(ce,!1)})}Ln(G),er(G,ie=>rn(R,ie),()=>A(R));var me=Tn(G,2);Ii(me,ie=>({...I().value,class:ie}),[()=>En(Cn("tooltip-item-value"),"value","tabular-nums",{"text-right":T()==="right","text-center":T()==="center"},r().value,I().value?.class)]);var ue=Xn(me);{var _e=ie=>{var xe=Gt(),de=yt(xe);Dn(de,()=>n.children),je(ie,xe)},te=ie=>{var xe=Za();Vi(de=>Es(xe,de),[()=>n.format?Jr(n.value,n.format):n.value]),je(ie,xe)};Zt(ue,ie=>{n.children?ie(_e):ie(te,!1)})}Ln(me),er(me,ie=>rn(F,ie),()=>A(F)),Ln(W),er(W,ie=>rn(P,ie),()=>A(P)),je(s,W),Kn()}var rX=Un("<div><!></div>");function oX(s,n){Yn(n,!0);let c=Re(n,"ref",15),m=bi(n,["$$slots","$$events","$$legacy","ref","class","children"]),_=Mn(void 0);ki(()=>{c(A(_))});var x=rX();Ii(x,r=>({class:r,...m}),[()=>En(Cn("tooltip-list"),"grid grid-cols-[1fr_auto] gap-x-2 gap-y-1 items-start",n.class)]);var T=Xn(x);Dn(T,()=>n.children??Si),Ln(x),er(x,r=>rn(_,r),()=>A(_)),je(s,x),Kn()}var sX=Un("<div><!></div>");function aX(s,n){Yn(n,!0);let c=Re(n,"ref",15),m=bi(n,["$$slots","$$events","$$legacy","ref","class","children"]),_=Mn(void 0);ki(()=>{c(A(_))});var x=sX();Ii(x,r=>({class:r,...m}),[()=>En(Cn("tooltip-separator"),"rounded-sm bg-surface-content/20 my-1 col-span-full h-px",n.class)]);var T=Xn(x);Dn(T,()=>n.children??Si),Ln(x),er(x,r=>rn(_,r),()=>A(_)),je(s,x),Kn()}var lX=Un("<div><!></div>"),cX=Un("<div><div><!></div></div>");function oL(s,n){Yn(n,!0);let c=Re(n,"anchor",3,"top-left"),m=Re(n,"classes",19,()=>({})),_=Re(n,"contained",3,"container"),x=Re(n,"motion",3,"spring"),T=Re(n,"pointerEvents",3,!1),r=Re(n,"variant",3,"default"),I=Re(n,"x",3,"pointer"),k=Re(n,"xOffset",19,()=>I()==="pointer"?10:0),P=Re(n,"y",3,"pointer"),R=Re(n,"yOffset",19,()=>P()==="pointer"?10:0),F=Re(n,"rootRef",15),V=Re(n,"props",19,()=>({root:{},container:{},content:{}})),W=Mn(void 0);ki(()=>{F(A(W))});const G=_o(),K=hS();let Y=Mn(0),ne=Mn(0);function oe(xe,de,Te,De){const Be=de==="center"?De/2:de==="end"?De:0;return xe+(de==="end"?-Te:Te)-Be}const ce=fe(()=>{if(!K.data){const it=Ia(()=>K.x),qe=Ia(()=>K.y);return{x:it,y:qe}}const xe=Wi(G.xScale)?G.xScale.step()/2-G.xScale.padding()*G.xScale.step()/2:0,de=typeof I()=="number"?I():I()==="data"?G.xGet(K.data)+G.padding.left+xe:K.x;let Te="start";switch(c()){case"top-left":case"left":case"bottom-left":Te="start";break;case"top":case"center":case"bottom":Te="center";break;case"top-right":case"right":case"bottom-right":Te="end";break}const De=Wi(G.yScale)?G.yScale.step()/2-G.yScale.padding()*G.yScale.step()/2:0,Be=typeof P()=="number"?P():P()==="data"?G.yGet(K.data)+G.padding.top+De:K.y;let Se="start";switch(c()){case"top-left":case"top":case"top-right":Se="start";break;case"left":case"center":case"right":Se="center";break;case"bottom-left":case"bottom":case"bottom-right":Se="end";break}const Ne={top:oe(Be,Se,R(),A(ne)),left:oe(de,Te,k(),A(Y)),bottom:0,right:0};if(Ne.bottom=Ne.top+A(ne),Ne.right=Ne.left+A(Y),_()==="container")typeof I()!="number"&&((Te==="start"||Te==="center")&&Ne.right>G.containerWidth&&(Ne.left=oe(de,"end",k(),A(Y))),(Te==="end"||Te==="center")&&Ne.left<G.padding.left&&(Ne.left=oe(de,"start",k(),A(Y)))),Ne.right=Ne.left+A(Y),typeof P()!="number"&&((Se==="start"||Se==="center")&&Ne.bottom>G.containerHeight&&(Ne.top=oe(Be,"end",R(),A(ne))),(Se==="end"||Se==="center")&&Ne.top<G.padding.top&&(Ne.top=oe(Be,"start",R(),A(ne)))),Ne.bottom=Ne.top+A(ne);else if(_()==="window"&&A(W)?.parentElement){const it=A(W).parentElement.getBoundingClientRect();typeof I()!="number"&&((Te==="start"||Te==="center")&&it.left+Ne.right>window.innerWidth&&(Ne.left=oe(de,"end",k(),A(Y))),(Te==="end"||Te==="center")&&it.left+Ne.left<0&&(Ne.left=oe(de,"start",k(),A(Y)))),Ne.right=Ne.left+A(Y),typeof P()!="number"&&((Se==="start"||Se==="center")&&it.top+Ne.bottom>window.innerHeight&&(Ne.top=oe(Be,"end",R(),A(ne))),(Se==="end"||Se==="center")&&it.top+Ne.top<0&&(Ne.top=oe(Be,"start",R(),A(ne)))),Ne.bottom=Ne.top+A(ne)}return{x:Ne.left,y:Ne.top}}),me=Vo(K.x,()=>A(ce).x,x()),ue=Vo(K.y,()=>A(ce).y,x());Os(()=>{K.data||(K.isHoveringTooltipContent=!1)});var _e=Gt(),te=yt(_e);{var ie=xe=>{var de=cX(),Te=()=>{K.isHoveringTooltipContent=!0},De=()=>{K.isHoveringTooltipContent=!1};Ii(de,(it,qe,ft)=>({...V().root,class:it,onpointerenter:Te,onpointerleave:De,[IB]:qe,[Ua]:ft}),[()=>En("root",Cn("tooltip-root"),m().root,V().root?.class),()=>({"pointer-events-none":!T()}),()=>({top:`${ue.current??""}px`,left:`${me.current??""}px`})],void 0,"svelte-crp5m6");var Be=Xn(de);Ii(Be,it=>({...V().container,class:it}),[()=>En(Cn("tooltip-container"),r()!=="none"&&["text-sm py-1 px-2 h-full rounded-sm elevation-1"],{default:["bg-surface-100/90 dark:bg-surface-300/90 backdrop-filter backdrop-blur-[2px] text-surface-content","[&_.label]:text-surface-content/75"],invert:["bg-surface-content/90 backdrop-filter backdrop-blur-[2px] text-surface-100 border border-surface-content","[&_.label]:text-surface-100/50"],none:""}[r()],m().container,V().container?.class,n.class)],void 0,"svelte-crp5m6");var Se=Xn(Be);{var Ne=it=>{var qe=lX();Ii(qe,St=>({...V().content,class:St}),[()=>En(Cn("tooltip-content"),m().content)],void 0,"svelte-crp5m6");var ft=Xn(qe);Dn(ft,()=>n.children,()=>({data:K.data,payload:K.payload})),Ln(qe),je(it,qe)};Zt(Se,it=>{n.children&&it(Ne)})}Ln(Be),Ln(de),er(de,it=>rn(W,it),()=>A(W)),o0(3,de,()=>GT,()=>({duration:100})),s0(de,"clientWidth",it=>rn(Y,it)),s0(de,"clientHeight",it=>rn(ne,it)),je(xe,de)};Zt(te,xe=>{K.data&&xe(ie)})}je(s,_e),Kn()}class uX{#t=Mn(null);get current(){return A(this.#t)}set current(n){rn(this.#t,n,!0)}set=n=>{this.current=n}}class hX{#t=Mn([]);selectedSeries=new bC;selectedKeys=new bC;highlightKey=new uX;constructor(n){rn(this.#t,n()),ki(()=>{rn(this.#t,n())})}get series(){return A(this.#t)}get isDefaultSeries(){return A(this.#t).length===1&&A(this.#t)[0].key==="default"}get allSeriesData(){return A(this.#t).flatMap(n=>n.data?.map(c=>({seriesKey:n.key,...c}))).filter(n=>n)}get visibleSeries(){return A(this.#t).filter(n=>this.selectedSeries.isEmpty()||this.selectedSeries.isSelected(n.key))}}function dX(s){return{scale:s.seriesState.isDefaultSeries?void 0:px(s.seriesState.series.map(n=>n.key),s.seriesState.series.map(n=>n.color)),tickFormat:n=>s.seriesState.series.find(c=>c.key===n)?.label??n,placement:"bottom",variant:"swatches",onclick:(n,c)=>s.seriesState.selectedSeries.toggle(c.value),onpointerenter:(n,c)=>s.seriesState.highlightKey.current=c.value,onpointerleave:()=>s.seriesState.highlightKey.current=null,...s.props,classes:{item:n=>s.seriesState.visibleSeries.length&&!s.seriesState.visibleSeries.some(c=>c.key===n.value)?"opacity-50":"",...s.props?.classes}}}var fX=sr("<path></path>"),pX=sr("<!><!>",1);function mX(s,n){Yn(n,!0);const c=_o(),m=bl();let _=Re(n,"line",3,!1),x=bi(n,["$$slots","$$events","$$legacy","clipPath","curve","data","defined","fill","fillOpacity","line","opacity","pathData","stroke","strokeWidth","motion","x","y0","y1"]);const T=fe(()=>n.x?Zr(n.x):c.x),r=fe(()=>n.y0?Zr(n.y0):te=>Qr(c.yDomain)),I=fe(()=>n.y1?Zr(n.y1):c.y),k=fe(()=>Wi(c.xScale)?c.xScale.bandwidth()/2:0),P=fe(()=>Wi(c.yScale)?c.yScale.bandwidth()/2:0),R=Ip(n.motion),F=R?{type:R.type,options:{interpolate:XT,...R.options}}:void 0;function V(){if(F){if(n.pathData)return rL(n.pathData,Math.min(c.yScale(0),c.yRange[0]));if(c.config.x){const te=c.radial?AC().angle(ie=>c.xScale(A(T)(ie))).innerRadius(()=>Math.min(c.yScale(0),c.yRange[0])).outerRadius(()=>Math.min(c.yScale(0),c.yRange[0])):v2().x(ie=>c.xScale(A(T)(ie))+A(k)).y0(()=>Math.min(c.yScale(0),c.yRange[0])).y1(()=>Math.min(c.yScale(0),c.yRange[0]));return te.defined(n.defined??(ie=>A(T)(ie)!=null&&A(I)(ie)!=null)),n.curve&&te.curve(n.curve),te(n.data??c.data)}}else return""}const W=fe(()=>{const te=c.radial?AC().angle(ie=>c.xScale(A(T)(ie))).innerRadius(ie=>c.yScale(A(r)(ie))).outerRadius(ie=>c.yScale(A(I)(ie))):v2().x(ie=>{const xe=A(T)(ie);return c.xScale(xe)+A(k)}).y0(ie=>{let xe=co(c.yRange);return n.y0?xe=c.yScale(A(r)(ie)):Array.isArray(c.config.y)&&c.config.y[0]===0&&(xe=c.yScale(c.y(ie)[0])),xe+A(P)}).y1(ie=>{let xe=co(c.yRange);return n.y1?xe=c.yScale(A(I)(ie)):Array.isArray(c.config.y)&&c.config.y[1]===1?xe=c.yScale(c.y(ie)[1]):xe=c.yScale(c.y(ie)),xe+A(P)});return te.defined(n.defined??(ie=>A(T)(ie)!=null&&A(I)(ie)!=null)),n.curve&&te.curve(n.curve),n.pathData??te(n.data??c.data)??V()}),G=Vo(V(),()=>A(W),F);function K(te,ie){T_(te,G.current,ie?cd({styles:{strokeWidth:n.strokeWidth}},ie):{styles:{fill:n.fill,fillOpacity:n.fillOpacity,stroke:n.stroke,strokeWidth:n.strokeWidth,opacity:n.opacity},classes:n.class??""})}const Y=da(()=>n.fill),ne=da(()=>n.stroke);m==="canvas"&&sc({name:"Area",render:K,events:{click:n.onclick,pointerenter:n.onpointerenter,pointermove:n.onpointermove,pointerleave:n.onpointerleave},deps:()=>[Y.current,n.fillOpacity,ne.current,n.strokeWidth,n.opacity,n.class,G.current]});var oe=pX(),ce=yt(oe);{var me=te=>{{let ie=fe(()=>To(_(),"area-line"));ad(te,Hn({get data(){return n.data},get x(){return n.x},get y(){return n.y1},get curve(){return n.curve},get defined(){return n.defined},get motion(){return n.motion}},()=>A(ie)))}};Zt(ce,te=>{_()&&te(me)})}var ue=Tn(ce);{var _e=te=>{var ie=fX();Ii(ie,xe=>({d:G.current,"clip-path":n.clipPath,fill:n.fill,"fill-opacity":n.fillOpacity,stroke:n.stroke,"stroke-width":n.strokeWidth,opacity:n.opacity,...xe}),[()=>To(x,"area-path")]),je(te,ie)};Zt(ue,te=>{m==="svg"&&te(_e)})}je(s,oe),Kn()}var gX=sr("<line></line><!><!><!>",1);function Zc(s,n){const c=fa();Yn(n,!0);let m=Re(n,"initialX1",19,()=>n.x1),_=Re(n,"initialY1",19,()=>n.y1),x=Re(n,"initialX2",19,()=>n.x2),T=Re(n,"initialY2",19,()=>n.y2),r=bi(n,["$$slots","$$events","$$legacy","x1","initialX1","y1","initialY1","x2","initialX2","y2","initialY2","class","strokeWidth","opacity","fill","stroke","marker","markerEnd","markerStart","markerMid","motion","fillOpacity"]);const I=fe(()=>n.markerStart||n.marker?Ls("marker-start",c):""),k=fe(()=>n.markerMid||n.marker?Ls("marker-mid",c):""),P=fe(()=>n.markerEnd||n.marker?Ls("marker-end",c):""),R=Vo(m(),()=>n.x1,n.motion),F=Vo(_(),()=>n.y1,n.motion),V=Vo(x(),()=>n.x2,n.motion),W=Vo(T(),()=>n.y2,n.motion),G=bl();function K(ue,_e){const te=`M ${R.current},${F.current} L ${V.current},${W.current}`;T_(ue,te,_e?cd({styles:{strokeWidth:n.strokeWidth}},_e):{styles:{fill:n.fill,stroke:n.stroke,strokeWidth:n.strokeWidth,opacity:n.opacity},classes:n.class})}const Y=da(()=>n.fill),ne=da(()=>n.stroke);G==="canvas"&&sc({name:"Line",render:K,events:{click:n.onclick,pointerenter:n.onpointerenter,pointermove:n.onpointermove,pointerleave:n.onpointerleave},deps:()=>[R.current,F.current,V.current,W.current,Y.current,ne.current,n.strokeWidth,n.opacity,n.class]});var oe=Gt(),ce=yt(oe);{var me=ue=>{var _e=gX(),te=yt(_e);Ii(te,Te=>({x1:R.current,y1:F.current,x2:V.current,y2:W.current,fill:n.fill,stroke:n.stroke,"fill-opacity":n.fillOpacity,"stroke-width":n.strokeWidth,opacity:n.opacity,"marker-start":A(I)?`url(#${A(I)})`:void 0,"marker-mid":A(k)?`url(#${A(k)})`:void 0,"marker-end":A(P)?`url(#${A(P)})`:void 0,class:Te,...r}),[()=>En(Cn("line"),n.stroke===void 0&&"stroke-surface-content",n.class)]);var ie=Tn(te);{let Te=fe(()=>n.markerStart??n.marker);Hc(ie,{get id(){return A(I)},get marker(){return A(Te)}})}var xe=Tn(ie);{let Te=fe(()=>n.markerMid??n.marker);Hc(xe,{get id(){return A(k)},get marker(){return A(Te)}})}var de=Tn(xe);{let Te=fe(()=>n.markerEnd??n.marker);Hc(de,{get id(){return A(P)},get marker(){return A(Te)}})}je(ue,_e)};Zt(ce,ue=>{G==="svg"&&ue(me)})}je(s,oe),Kn()}var _X=Un("<!> <!>",1);function Zu(s,n){Yn(n,!0);let c=Re(n,"x",3,!1),m=Re(n,"xOffset",3,0),_=Re(n,"y",3,!1),x=Re(n,"yOffset",3,0),T=bi(n,["$$slots","$$events","$$legacy","x","xOffset","y","yOffset","class","children"]);const r=_o(),I=fe(()=>Xa(r.xRange)),k=fe(()=>Xa(r.yRange));function P(R,F){switch(typeof R){case"boolean":return R;case"string":return!0;default:return F==="x"?r.xScale(R)>=A(I)[0]&&r.xScale(R)<=A(I)[1]:r.yScale(R)>=A(k)[0]&&r.yScale(R)<=A(k)[1]}}{let R=fe(()=>Cn("rule-g"));oc(s,{get class(){return A(R)},children:(F,V)=>{var W=_X(),G=yt(W);{var K=oe=>{const ce=fe(()=>c()===!0||c()==="left"?A(I)[0]:c()==="right"?A(I)[1]:r.xScale(c())+m());var me=Gt(),ue=yt(me);{var _e=ie=>{const xe=fe(()=>{const[Te,De]=gl(A(ce),Number(A(k)[0]));return{x1:Te,y1:De}}),de=fe(()=>{const[Te,De]=gl(A(ce),Number(A(k)[1]));return{x2:Te,y2:De}});{let Te=fe(()=>En(Cn("rule-x-radial-line"),"stroke-surface-content/10",n.class));Zc(ie,Hn(()=>T,{get x1(){return A(xe).x1},get y1(){return A(xe).y1},get x2(){return A(de).x2},get y2(){return A(de).y2},get class(){return A(Te)}}))}},te=ie=>{{let xe=fe(()=>r.yRange[0]||0),de=fe(()=>r.yRange[1]||0),Te=fe(()=>En(Cn("rule-x-line"),"stroke-surface-content/50",n.class));Zc(ie,Hn(()=>T,{get x1(){return A(ce)},get x2(){return A(ce)},get y1(){return A(xe)},get y2(){return A(de)},get class(){return A(Te)}}))}};Zt(ue,ie=>{r.radial?ie(_e):ie(te,!1)})}je(oe,me)};Zt(G,oe=>{P(c(),"x")&&oe(K)})}var Y=Tn(G,2);{var ne=oe=>{var ce=Gt(),me=yt(ce);{var ue=te=>{{let ie=fe(()=>_()===!0||_()==="bottom"?A(k)[1]:_()==="top"?A(k)[0]:r.yScale(_())+x()),xe=fe(()=>En(Cn("rule-y-radial-circle"),"fill-none stroke-surface-content/50",n.class));sd(te,{get r(){return A(ie)},get class(){return A(xe)}})}},_e=te=>{{let ie=fe(()=>r.xRange[0]||0),xe=fe(()=>r.xRange[1]||0),de=fe(()=>_()===!0||_()==="bottom"?A(k)[1]:_()==="top"?A(k)[0]:r.yScale(_())+x()),Te=fe(()=>_()===!0||_()==="bottom"?A(k)[1]:_()==="top"?A(k)[0]:r.yScale(_())+x()),De=fe(()=>En(Cn("rule-y-line"),"stroke-surface-content/50",n.class));Zc(te,Hn(()=>T,{get x1(){return A(ie)},get x2(){return A(xe)},get y1(){return A(de)},get y2(){return A(Te)},get class(){return A(De)}}))}};Zt(me,te=>{r.radial?te(ue):te(_e,!1)})}je(oe,ce)};Zt(Y,oe=>{P(_(),"y")&&oe(ne)})}je(F,W)},$$slots:{default:!0}})}Kn()}function yX(s){if(s&&typeof s.getTotalLength=="function")try{return s.getTotalLength()}catch(n){return console.error("Error getting path length:",n),0}return 0}var vX=sr("<path></path>"),xX=sr("<defs><!></defs><text><textPath> </textPath></text>",1),bX=sr("<tspan> </tspan>"),wX=sr("<text></text>"),TX=sr("<svg><!></svg>");function xp(s,n){const c=fa();Yn(n,!0);let m=Re(n,"x",3,0),_=Re(n,"initialX",19,m),x=Re(n,"y",3,0),T=Re(n,"initialY",19,x),r=Re(n,"dx",3,0),I=Re(n,"dy",3,0),k=Re(n,"lineHeight",3,"1em"),P=Re(n,"capHeight",3,"0.71em"),R=Re(n,"scaleToFit",3,!1),F=Re(n,"textAnchor",3,"start"),V=Re(n,"verticalAnchor",3,"end"),W=Re(n,"dominantBaseline",3,"auto"),G=Re(n,"opacity",3,1),K=Re(n,"strokeWidth",3,0),Y=Re(n,"svgRef",15),ne=Re(n,"ref",15),oe=Re(n,"svgProps",19,()=>({})),ce=Re(n,"truncate",3,!1),me=Re(n,"pathId",19,()=>Ls("text-path",c)),ue=Re(n,"startOffset",3,"0%"),_e=bi(n,["$$slots","$$events","$$legacy","value","x","initialX","y","initialY","dx","dy","lineHeight","capHeight","width","scaleToFit","textAnchor","verticalAnchor","dominantBaseline","rotate","opacity","strokeWidth","stroke","fill","fillOpacity","motion","svgRef","ref","class","svgProps","truncate","path","pathId","startOffset","transform"]);const te=bl();let ie=Mn(void 0),xe=Mn(void 0),de=Mn(void 0);ki(()=>{ne(A(ie))}),ki(()=>{Y(A(xe))});let Te;const De=fe(()=>n.path?yX(A(de)):n.width),Be=fe(()=>({maxChars:void 0,position:"end",maxWidth:A(De)})),Se=fe(()=>typeof ce()=="boolean"?ce()?A(Be):!1:{...A(Be),...ce()}),Ne=fe(()=>n.value!=null?n.value.toString().replace(/\\n/g,`
`):""),it=fe(()=>A(Se)?Aq(A(Ne),A(Se)):A(Ne)),qe=fe(()=>ul("",Te)||0),ft=fe(()=>A(it).split(`
`).flatMap(vt=>{const zt=vt.split(/(?:(?!\u00A0+)\s+)/);return n.width==null?[{words:zt}]:zt.reduce((fn,Gn)=>{const Wn=fn[fn.length-1],ti=ul(Gn,Te)||0;if(Wn&&(n.width==null||R()||(Wn.width||0)+ti+A(qe)<n.width))Wn.words.push(Gn),Wn.width=Wn.width||0,Wn.width+=ti+A(qe);else{const yi={words:[Gn],width:ti};fn.push(yi)}return fn},[])})),St=fe(()=>A(ft).length);function Dt(Jt){if(typeof Jt=="number")return Jt;const vt=Jt.match(/([\d.]+)(\D+)/),zt=Number(vt?.[1]);switch(vt?.[2]){case"px":return zt;case"em":case"rem":return zt*16;default:return 0}}const Kt=fe(()=>V()==="start"?Dt(k()):V()==="middle"?(A(St)-1)/2*-Dt(k())+Dt(P())/2:(A(St)-1)*-Dt(k())-Dt(P())/2),et=fe(()=>{if(R()&&A(St)>0&&typeof m()=="number"&&typeof x()=="number"&&typeof n.width=="number"){const Jt=A(ft)[0].width||1,vt=n.width/Jt,zt=vt,fn=m()-vt*m(),Gn=x()-zt*x();return`matrix(${vt}, 0, 0, ${zt}, ${fn}, ${Gn})`}else return""}),Qe=fe(()=>n.rotate?`rotate(${n.rotate}, ${m()}, ${x()})`:""),st=fe(()=>n.transform??`${A(et)} ${A(Qe)}`);function tt(Jt){return typeof Jt=="number"&&Number.isFinite(Jt)||typeof Jt=="string"}const gt=Vo(_(),()=>m(),n.motion),Lt=Vo(T(),()=>x(),n.motion);function _t(Jt,vt){const zt=Dt(k()),fn=Dt(Lt.current)+Dt(I())+Dt(A(Kt)),Gn=Dt(gt.current)+Dt(r());if(Jt.save(),n.rotate!==void 0){const Ri=Dt(m()),ur=Dt(x()),wi=ep(n.rotate);Jt.translate(Ri,ur),Jt.rotate(wi),Jt.translate(-Ri,-ur)}const Wn=vt?cd({styles:{strokeWidth:K()}},vt):{styles:{fill:n.fill,fillOpacity:n.fillOpacity,stroke:n.stroke,strokeWidth:K(),opacity:G(),paintOrder:"stroke",textAnchor:F()},classes:En(n.fill===void 0&&"fill-surface-content",n.class)},ti=M0(Jt.canvas,Wn);Jt.font=`${ti.fontSize} ${ti.fontFamily}`;const yi=F()==="middle"?"center":F()==="end"?"end":"start";Jt.textAlign=yi;for(let Ri=0;Ri<A(ft).length;Ri++){const wi=A(ft)[Ri].words.join(" "),Oi=Gn,zi=fn+Ri*zt;OH(Jt,wi,{x:Oi,y:zi},Wn)}Jt.restore()}const Je=da(()=>n.fill),Rt=da(()=>n.stroke);te==="canvas"&&sc({name:"Text",render:_t,deps:()=>[n.value,gt.current,Lt.current,Je.current,Rt.current,K(),G(),n.class,A(Se),n.rotate,k(),F(),V()]});var ut=Gt(),cn=yt(ut);{var on=Jt=>{var vt=TX();Ii(vt,Wn=>({x:r(),y:I(),...oe(),class:Wn}),[()=>En(Cn("text-svg"),"overflow-visible [paint-order:stroke]",oe()?.class)]);var zt=Xn(vt);{var fn=Wn=>{var ti=xX(),yi=yt(ti),Ri=Xn(yi);ex(Ri,()=>n.path,zi=>{var qi=vX();er(qi,ir=>rn(de,ir),()=>A(de)),Vi(()=>{Gi(qi,"id",me()),Gi(qi,"d",n.path)}),je(zi,qi)}),Ln(yi);var ur=Tn(yi);Ii(ur,zi=>({dy:I(),..._e,fill:n.fill,"fill-opacity":n.fillOpacity,stroke:n.stroke,"stroke-width":K(),opacity:G(),transform:n.transform,class:zi}),[()=>En(Cn("text"),n.fill===void 0&&"fill-surface-content",n.class)]);var wi=Xn(ur),Oi=Xn(wi,!0);Ln(wi),Ln(ur),er(ur,zi=>rn(ie,zi),()=>A(ie)),Vi((zi,qi)=>{_l(wi,`text-anchor: ${F()??""};`),Gi(wi,"dominant-baseline",W()),Gi(wi,"href",`#${me()??""}`),Gi(wi,"startOffset",ue()),Pr(wi,0,zi),Es(Oi,qi)},[()=>Cr(En(Cn("text-path"))),()=>A(ft).map(zi=>zi.words.join(" ")).join()]),je(Wn,ti)},Gn=Wn=>{var ti=Gt(),yi=yt(ti);{var Ri=ur=>{var wi=wX();Ii(wi,Oi=>({x:gt.current,y:Lt.current,transform:A(st),"text-anchor":F(),"dominant-baseline":W(),..._e,fill:n.fill,"fill-opacity":n.fillOpacity,stroke:n.stroke,"stroke-width":K(),opacity:G(),class:Oi}),[()=>En(Cn("text"),n.fill===void 0&&"fill-surface-content",n.class)]),ro(wi,21,()=>A(ft),cs,(Oi,zi,qi)=>{var ir=bX(),$r=Xn(ir,!0);Ln(ir),Vi((lr,hr,uo)=>{Gi(ir,"x",gt.current),Gi(ir,"dy",lr),Pr(ir,0,hr),Es($r,uo)},[()=>qi===0?A(Kt):Dt(k()),()=>Cr(Cn("text-tspan")),()=>A(zi).words.join(" ")]),je(Oi,ir)}),Ln(wi),er(wi,Oi=>rn(ie,Oi),()=>A(ie)),je(ur,wi)};Zt(yi,ur=>{tt(m())&&tt(x())&&ur(Ri)},!0)}je(Wn,ti)};Zt(zt,Wn=>{n.path?Wn(fn):Wn(Gn,!1)})}Ln(vt),er(vt,Wn=>rn(xe,Wn),()=>A(xe)),je(Jt,vt)};Zt(cn,Jt=>{te==="svg"&&Jt(on)})}je(s,ut),Kn()}function ek(s,n={multiline:!1}){const{multiline:c=!1,placement:m="bottom"}=n;return function(_,x){let T="";if(+s>=+new Oc({duration:{years:1}}))T=Jr(_,"year");else if(+s>=+new Oc({duration:{days:28}})){const r=x===0||+yl.floor(_)==+_;c?T=[Jr(_,"month",{variant:"short"}),r&&Jr(_,"year")]:T=Jr(_,"month",{variant:"short"})+(r?` '${Jr(_,"year",{variant:"short"})}`:"")}else if(+s>=+new Oc({duration:{days:1}})){const r=x===0||_.getDate()<=s.days;c?T=[Jr(_,"custom",{custom:Vn.DayOfMonth_numeric}),r&&Jr(_,"month",{variant:"short"})]:T=Jr(_,"day",{variant:"short"})}else if(+s>=+new Oc({duration:{hours:1}})){const r=x===0||+tc.floor(_)==+_;c?T=[Jr(_,"custom",{custom:Vn.Hour_numeric}),r&&Jr(_,"day",{variant:"short"})]:T=r?Jr(_,"day",{variant:"short"}):Jr(_,"custom",{custom:Vn.Hour_numeric})}else if(+s>=+new Oc({duration:{minutes:1}})){const r=x===0||+tc.floor(_)==+_;c?T=[Jr(_,"time",{variant:"short"}),r&&Jr(_,"day",{variant:"short"})]:T=Jr(_,"time",{variant:"short"})}else if(+s>=+new Oc({duration:{seconds:1}})){const r=x===0||+tc.floor(_)==+_;T=[Jr(_,"time"),c&&r&&Jr(_,"day",{variant:"short"})]}else if(+s>=+new Oc({duration:{milliseconds:1}})){const r=x===0||+tc.floor(_)==+_;T=[Jr(_,"custom",{custom:[Vn.Hour_2Digit,Vn.Minute_2Digit,Vn.Second_2Digit,Vn.MiliSecond_3,Vn.Hour_woAMPM]}),c&&r&&Jr(_,"day",{variant:"short"})]}else T=_.toString();if(Array.isArray(T))switch(m){case"top":return T.filter(Boolean).reverse().join(`
`);case"bottom":return T.filter(Boolean).join(`
`);case"left":return T.filter(Boolean).reverse().join(" ");case"right":return T.filter(Boolean).join(" ");default:return T.filter(Boolean).join(`
`)}else return T}}function Q2(s,n,c){return Array.isArray(n)?n:typeof n=="function"?n(s)??[]:Lz(n)&&"interval"in n?n.interval===null||!("ticks"in s)||typeof s.ticks!="function"?[]:s.ticks(n.interval):Wi(s)?n&&typeof n=="number"?s.domain().filter((m,_)=>_%n===0):s.domain():s.ticks&&typeof s.ticks=="function"?s.ticks(c??(typeof n=="number"?n:void 0)):[]}function SX(s){const{scale:n,ticks:c,count:m,formatType:_,multiline:x,placement:T}=s;if(_)return r=>Jr(r,_);if(Kq(n)&&m)if(Lz(c)&&"interval"in c&&c.interval!=null){const r=c.interval.floor(new Date),I=c.interval.ceil(new Date);return ek(new Oc({start:r,end:I}),{multiline:x,placement:T})}else{const[r,I]=Bz(n.domain()[0],n.domain()[1],m);return ek(new Oc({start:r,end:I}),{multiline:x,placement:T})}return n.tickFormat?n.tickFormat(m):r=>`${r}`}var EX=Un("<!> <!> <!>",1),AX=Un("<!> <!> <!>",1);function tk(s,n){Yn(n,!0);let c=Re(n,"label",3,""),m=Re(n,"labelPlacement",3,"middle"),_=Re(n,"rule",3,!1),x=Re(n,"grid",3,!1),T=Re(n,"tickSpacing",19,()=>["top","bottom","angle"].includes(n.placement)?80:["left","right","radius"].includes(n.placement)?50:void 0),r=Re(n,"tickMultiline",3,!1),I=Re(n,"tickLength",3,4),k=Re(n,"tickMarks",3,!0),P=Re(n,"classes",19,()=>({})),R=bi(n,["$$slots","$$events","$$legacy","placement","label","labelPlacement","labelProps","rule","grid","ticks","tickSpacing","tickMultiline","tickLength","tickMarks","format","tickLabelProps","motion","transitionIn","transitionInParams","scale","classes","class","tickLabel"]);const F=_o(),V=fe(()=>n.placement==="angle"?"angle":n.placement==="radius"?"radius":["top","bottom"].includes(n.placement)?"horizontal":"vertical"),W=fe(()=>n.scale??(["horizontal","angle"].includes(A(V))?F.xScale:F.yScale)),G=fe(()=>Xa(F.xRange)),K=fe(()=>Xa(F.yRange)),Y=fe(()=>A(V)==="vertical"?F.height:A(V)==="horizontal"?F.width:A(V)==="radius"?F.height/2:A(V)==="angle"?F.width:null),ne=fe(()=>typeof n.ticks=="number"?n.ticks:T()&&A(Y)?Math.round(A(Y)/T()):void 0),oe=fe(()=>Q2(A(W),n.ticks,A(ne))),ce=fe(()=>SX({scale:A(W),ticks:n.ticks,count:A(ne),formatType:n.format,multiline:r(),placement:n.placement}));function me(Te){switch(n.placement){case"top":return{x:A(W)(Te)+(Wi(A(W))?A(W).bandwidth()/2:0),y:A(K)[0]};case"bottom":return{x:A(W)(Te)+(Wi(A(W))?A(W).bandwidth()/2:0),y:A(K)[1]};case"left":return{x:A(G)[0],y:A(W)(Te)+(Wi(A(W))?A(W).bandwidth()/2:0)};case"right":return{x:A(G)[1],y:A(W)(Te)+(Wi(A(W))?A(W).bandwidth()/2:0)};case"angle":return{x:A(W)(Te),y:A(K)[1]};case"radius":return{x:A(G)[0],y:A(W)(Te)+(Wi(A(W))?A(W).bandwidth()/2:0)}}}function ue(Te){switch(n.placement){case"top":return{textAnchor:"middle",verticalAnchor:"end",dy:-I()};case"bottom":return{textAnchor:"middle",verticalAnchor:"start",dy:I()};case"left":return{textAnchor:"end",verticalAnchor:"middle",dx:-I()};case"right":return{textAnchor:"start",verticalAnchor:"middle",dx:I()};case"angle":const De=A(W)(Te);return{textAnchor:De===0||Math.abs(De-Math.PI)<.01||Math.abs(De-Math.PI*2)<.01?"middle":De>Math.PI?"end":"start",verticalAnchor:"middle",dx:Math.sin(De)*I(),dy:-Math.cos(De)*(I()+4)};case"radius":return{textAnchor:"middle",verticalAnchor:"middle",dx:2}}}const _e=fe(()=>n.placement==="left"||A(V)==="horizontal"&&m()==="start"?-F.padding.left:n.placement==="right"||A(V)==="horizontal"&&m()==="end"?F.width+F.padding.right:F.width/2),te=fe(()=>n.placement==="top"||A(V)==="vertical"&&m()==="start"?-F.padding.top:A(V)==="vertical"&&m()==="middle"?F.height/2:n.placement==="bottom"||m()==="end"?F.height+F.padding.bottom:"0"),ie=fe(()=>m()==="middle"?"middle":n.placement==="right"||A(V)==="horizontal"&&m()==="end"?"end":"start"),xe=fe(()=>n.placement==="top"||A(V)==="vertical"&&m()==="start"||n.placement==="left"&&m()==="middle"?"start":"end"),de=fe(()=>({value:typeof c()=="function"?"":void 0,x:A(_e),y:A(te),textAnchor:A(ie),verticalAnchor:A(xe),rotate:A(V)==="vertical"&&m()==="middle"?-90:0,capHeight:".5rem",...n.labelProps,class:En(Cn("axis-label"),"text-[10px] stroke-surface-100 [stroke-width:2px] font-light",P().label,n.labelProps?.class)}));{let Te=fe(()=>En(Cn("axis"),`placement-${n.placement}`,P().root,n.class));oc(s,Hn(()=>R,{get"data-placement"(){return n.placement},get class(){return A(Te)},children:(De,Be)=>{var Se=AX(),Ne=yt(Se);{var it=Kt=>{const et=fe(()=>To(_(),"axis-rule"));{let Qe=fe(()=>n.placement==="left"||n.placement==="right"?n.placement:n.placement==="angle"),st=fe(()=>n.placement==="top"||n.placement==="bottom"?n.placement:n.placement==="radius"),tt=fe(()=>En("stroke-surface-content/50",P().rule,A(et)?.class));Zu(Kt,Hn({get x(){return A(Qe)},get y(){return A(st)},get motion(){return n.motion}},()=>A(et),{get class(){return A(tt)}}))}};Zt(Ne,Kt=>{_()!==!1&&Kt(it)})}var qe=Tn(Ne,2);{var ft=Kt=>{var et=Gt(),Qe=yt(et);Dn(Qe,c,()=>({props:A(de)})),je(Kt,et)},St=Kt=>{var et=Gt(),Qe=yt(et);{var st=tt=>{xp(tt,Hn(()=>A(de)))};Zt(Qe,tt=>{c()&&tt(st)},!0)}je(Kt,et)};Zt(qe,Kt=>{typeof c()=="function"?Kt(ft):Kt(St,!1)})}var Dt=Tn(qe,2);ro(Dt,18,()=>A(oe),Kt=>Kt,(Kt,et,Qe)=>{const st=fe(()=>me(et)),tt=fe(()=>{const[_t,Je]=gl(A(st).x,A(st).y);return{radialTickCoordsX:_t,radialTickCoordsY:Je}}),gt=fe(()=>{const[_t,Je]=gl(A(st).x,A(st).y+I());return{radialTickMarkCoordsX:_t,radialTickMarkCoordsY:Je}}),Lt=fe(()=>({x:A(V)==="angle"?A(tt).radialTickCoordsX:A(st).x,y:A(V)==="angle"?A(tt).radialTickCoordsY:A(st).y,value:A(ce)(et,A(Qe)),...ue(et),motion:n.motion,capHeight:"7px",lineHeight:"11px",...n.tickLabelProps,class:En(Cn("axis-tick-label"),"text-[10px] stroke-surface-100 [stroke-width:2px] font-light",P().tickLabel,n.tickLabelProps?.class)}));{let _t=fe(()=>Cn("axis-tick-group"));oc(Kt,{get transitionIn(){return n.transitionIn},get transitionInParams(){return n.transitionInParams},get class(){return A(_t)},children:(Je,Rt)=>{var ut=EX(),cn=yt(ut);{var on=Wn=>{const ti=fe(()=>To(x(),"axis-grid"));{let yi=fe(()=>A(V)==="horizontal"||A(V)==="angle"?et:!1),Ri=fe(()=>A(V)==="vertical"||A(V)==="radius"?et:!1),ur=fe(()=>En("stroke-surface-content/10",P().rule,A(ti)?.class));Zu(Wn,Hn({get x(){return A(yi)},get y(){return A(Ri)},get motion(){return n.motion}},()=>A(ti),{get class(){return A(ur)}}))}};Zt(cn,Wn=>{x()!==!1&&Wn(on)})}var Jt=Tn(cn,2);{var vt=Wn=>{const ti=fe(()=>En(Cn("axis-tick"),"stroke-surface-content/50",P().tick));var yi=Gt(),Ri=yt(yi);{var ur=Oi=>{{let zi=fe(()=>A(st).y+(n.placement==="top"?-I():I()));Zc(Oi,{get x1(){return A(st).x},get y1(){return A(st).y},get x2(){return A(st).x},get y2(){return A(zi)},get motion(){return n.motion},get class(){return A(ti)}})}},wi=Oi=>{var zi=Gt(),qi=yt(zi);{var ir=lr=>{{let hr=fe(()=>A(st).x+(n.placement==="left"?-I():I()));Zc(lr,{get x1(){return A(st).x},get y1(){return A(st).y},get x2(){return A(hr)},get y2(){return A(st).y},get motion(){return n.motion},get class(){return A(ti)}})}},$r=lr=>{var hr=Gt(),uo=yt(hr);{var oo=ho=>{Zc(ho,{get x1(){return A(tt).radialTickCoordsX},get y1(){return A(tt).radialTickCoordsY},get x2(){return A(gt).radialTickMarkCoordsX},get y2(){return A(gt).radialTickMarkCoordsY},get motion(){return n.motion},get class(){return A(ti)}})};Zt(uo,ho=>{A(V)==="angle"&&ho(oo)},!0)}je(lr,hr)};Zt(qi,lr=>{A(V)==="vertical"?lr(ir):lr($r,!1)},!0)}je(Oi,zi)};Zt(Ri,Oi=>{A(V)==="horizontal"?Oi(ur):Oi(wi,!1)})}je(Wn,yi)};Zt(Jt,Wn=>{k()&&Wn(vt)})}var zt=Tn(Jt,2);{var fn=Wn=>{var ti=Gt(),yi=yt(ti);Dn(yi,()=>n.tickLabel,()=>({props:A(Lt),index:A(Qe)})),je(Wn,ti)},Gn=Wn=>{xp(Wn,Hn(()=>A(Lt)))};Zt(zt,Wn=>{n.tickLabel?Wn(fn):Wn(Gn,!1)})}je(Je,ut)},$$slots:{default:!0}})}}),je(De,Se)},$$slots:{default:!0}}))}Kn()}var IX=Un("<!> <!>",1),MX=Un("<!> <!>",1),CX=Un("<!> <!>",1);function PX(s,n){Yn(n,!0);const c=_o();let m=Re(n,"x",3,!1),_=Re(n,"y",3,!1),x=Re(n,"bandAlign",3,"center"),T=Re(n,"radialY",3,"circle"),r=Re(n,"transitionInParams",19,()=>({easing:Xz})),I=Re(n,"classes",19,()=>({})),k=Re(n,"ref",15),P=bi(n,["$$slots","$$events","$$legacy","x","y","xTicks","yTicks","bandAlign","radialY","motion","transitionIn","transitionInParams","classes","class","ref"]),R=Mn(void 0);ki(()=>{k(A(R))});const F=fe(()=>n.yTicks??(Wi(c.yScale)?void 0:4)),V=fe(()=>Ip(n.motion)),W=fe(()=>n.transitionIn??A(V)?.options?GT:()=>({})),G=fe(()=>Q2(c.xScale,n.xTicks)),K=fe(()=>Q2(c.yScale,A(F))),Y=fe(()=>Wi(c.xScale)?x()==="between"?-(c.xScale.padding()*c.xScale.step())/2:c.xScale.step()/2-c.xScale.padding()*c.xScale.step()/2:0),ne=fe(()=>Wi(c.yScale)?x()==="between"?-(c.yScale.padding()*c.yScale.step())/2:c.yScale.step()/2-c.yScale.padding()*c.yScale.step()/2:0);{let oe=fe(()=>En(Cn("grid"),I().root,n.class));oc(s,Hn({get class(){return A(oe)}},()=>P,{get ref(){return A(R)},set ref(ce){rn(R,ce,!0)},children:(ce,me)=>{var ue=CX(),_e=yt(ue);{var te=de=>{const Te=fe(()=>To(m(),"grid-x-line"));{let De=fe(()=>Cn("grid-x"));oc(de,{get transitionIn(){return A(W)},get transitionInParams(){return r()},get class(){return A(De)},children:(Be,Se)=>{var Ne=IX(),it=yt(Ne);ro(it,16,()=>A(G),St=>St,(St,Dt,Kt,et)=>{var Qe=Gt(),st=yt(Qe);{var tt=Lt=>{const _t=fe(()=>{const[Rt,ut]=gl(c.xScale(Dt),c.yRange[0]);return{x1:Rt,y1:ut}}),Je=fe(()=>{const[Rt,ut]=gl(c.xScale(Dt),c.yRange[1]);return{x2:Rt,y2:ut}});{let Rt=fe(()=>En(Cn("grid-x-radial-line"),"stroke-surface-content/10",I().line,A(Te)?.class));Zc(Lt,Hn({get x1(){return A(_t).x1},get y1(){return A(_t).y1},get x2(){return A(Je).x2},get y2(){return A(Je).y2},get motion(){return A(V)}},()=>A(Te),{get class(){return A(Rt)}}))}},gt=Lt=>{{let _t=fe(()=>En(Cn("grid-x-rule"),"stroke-surface-content/10",I().line,A(Te)?.class));Zu(Lt,Hn({get x(){return Dt},get xOffset(){return A(Y)},get motion(){return n.motion}},()=>A(Te),{get class(){return A(_t)}}))}};Zt(st,Lt=>{c.radial?Lt(tt):Lt(gt,!1)})}je(St,Qe)});var qe=Tn(it,2);{var ft=St=>{{let Dt=fe(()=>c.xScale.step()+A(Y)),Kt=fe(()=>En(Cn("grid-x-end-rule"),"stroke-surface-content/10",I().line,A(Te)?.class));Zu(St,Hn({get x(){return A(G)[A(G).length-1]},get xOffset(){return A(Dt)},get motion(){return n.motion}},()=>A(Te),{get class(){return A(Kt)}}))}};Zt(qe,St=>{Wi(c.xScale)&&x()==="between"&&!c.radial&&A(G).length&&St(ft)})}je(Be,Ne)},$$slots:{default:!0}})}};Zt(_e,de=>{m()&&de(te)})}var ie=Tn(_e,2);{var xe=de=>{const Te=fe(()=>To(_(),"grid-y-line"));{let De=fe(()=>Cn("grid-y"));oc(de,{get transitionIn(){return A(W)},get transitionInParams(){return r()},get class(){return A(De)},children:(Be,Se)=>{var Ne=MX(),it=yt(Ne);ro(it,16,()=>A(K),St=>St,(St,Dt,Kt,et)=>{var Qe=Gt(),st=yt(Qe);{var tt=Lt=>{var _t=Gt(),Je=yt(_t);{var Rt=cn=>{{let on=fe(()=>c.yScale(Dt)+A(ne)),Jt=fe(()=>En(Cn("grid-y-radial-circle"),"fill-none stroke-surface-content/10",I().line,A(Te)?.class));sd(cn,Hn({get r(){return A(on)},get motion(){return n.motion}},()=>A(Te),{get class(){return A(Jt)}}))}},ut=cn=>{{let on=fe(()=>A(G).map(vt=>({x:vt,y:Dt}))),Jt=fe(()=>En(Cn("grid-y-radial-line"),"stroke-surface-content/10",I().line,A(Te)?.class));ad(cn,Hn({get data(){return A(on)},x:"x",y:"y",get motion(){return A(V)},get curve(){return x2}},()=>A(Te),{get class(){return A(Jt)}}))}};Zt(Je,cn=>{T()==="circle"?cn(Rt):cn(ut,!1)})}je(Lt,_t)},gt=Lt=>{{let _t=fe(()=>En(Cn("grid-y-rule"),"stroke-surface-content/10",I().line,A(Te)?.class));Zu(Lt,Hn({get y(){return Dt},get yOffset(){return A(ne)},get motion(){return n.motion}},()=>A(Te),{get class(){return A(_t)}}))}};Zt(st,Lt=>{c.radial?Lt(tt):Lt(gt,!1)})}je(St,Qe)});var qe=Tn(it,2);{var ft=St=>{var Dt=Gt(),Kt=yt(Dt);{var et=st=>{{let tt=fe(()=>c.yScale(A(K)[A(K).length-1])+c.yScale.step()+A(ne)),gt=fe(()=>En(Cn("grid-y-radial-circle"),"fill-none stroke-surface-content/10",I().line,A(Te)?.class));sd(st,Hn({get r(){return A(tt)},get motion(){return n.motion}},()=>A(Te),{get class(){return A(gt)}}))}},Qe=st=>{{let tt=fe(()=>c.yScale.step()+A(ne)),gt=fe(()=>En(Cn("grid-y-end-rule"),"stroke-surface-content/10",I().line,A(Te)?.class));Zu(st,Hn({get y(){return A(K)[A(K).length-1]},get yOffset(){return A(tt)},get motion(){return n.motion}},()=>A(Te),{get class(){return A(gt)}}))}};Zt(Kt,st=>{c.radial?st(et):st(Qe,!1)})}je(St,Dt)};Zt(qe,St=>{Wi(c.yScale)&&x()==="between"&&A(K).length&&St(ft)})}je(Be,Ne)},$$slots:{default:!0}})}};Zt(ie,de=>{_()&&de(xe)})}je(ce,ue)},$$slots:{default:!0}}))}Kn()}function kX(s){const n=s?.all??0,c=s?.x??n,m=s?.y??n,_=s?.left??c,x=s?.right??c,T=s?.top??m,r=s?.bottom??m;return{left:_,right:x,bottom:r,top:T}}function RX(s,n){const c=fe(()=>n?.());return m=>{const _=kX(A(c)?.insets),x=s.xScale.domain(),T=s.yScale.domain(),r=Zr(A(c)?.x??s.x),I=Zr(A(c)?.y??s.y),k=Zr(A(c)?.x1??s.x1),P=Zr(A(c)?.y1??s.y1);if(Wi(s.yScale)){const R=nk(s.yScale(I(m))??0)+(s.y1Scale?s.y1Scale(P(m)):0)+_.top,F=Math.max(0,s.yScale.bandwidth?(s.y1Scale?s.y1Scale.bandwidth?.()??0:s.yScale.bandwidth())-_.bottom-_.top:0),V=r(m);let W=0,G=0;Array.isArray(V)?(W=Qr(V),G=co(V)):V==null?(W=0,G=0):V>0?(W=co([0,x[0]]),G=V):(W=V,G=Qr([0,x[1]]));const K=s.xScale(W)+_.left,Y=Math.max(0,s.xScale(G)-s.xScale(W)-_.left-_.right);return{x:K,y:R,width:Y,height:F}}else{const R=nk(s.xScale(r(m)))+(s.x1Scale?s.x1Scale(k(m)):0)+_.left,F=Math.max(0,s.xScale.bandwidth?(s.x1Scale?s.x1Scale.bandwidth?.()??0:s.xScale.bandwidth())-_.left-_.right:0),V=I(m);let W=0,G=0;Array.isArray(V)?(W=co(V),G=Qr(V)):V==null?(W=0,G=0):V>0?(W=V,G=co([0,T[0]])):(W=Qr([0,T[1]]),G=V);const K=s.yScale(W)+_.top,Y=s.yScale(G)-s.yScale(W)-_.bottom-_.top;return{x:R,y:K,width:F,height:Y}}}}function nk(s){return Array.isArray(s)?s[0]:s}function zX(s,n){Yn(n,!0);const c=_o();let m=Re(n,"x",19,()=>c.x),_=Re(n,"y",19,()=>c.y),x=Re(n,"stroke",3,"black"),T=Re(n,"strokeWidth",3,0),r=Re(n,"radius",3,0),I=Re(n,"rounded",3,"all"),k=bi(n,["$$slots","$$events","$$legacy","data","x","y","x1","y1","fill","fillOpacity","stroke","strokeWidth","opacity","radius","rounded","motion","insets","initialX","initialY","initialHeight","initialWidth"]);const P=fe(()=>x()===null||x()===void 0?"black":x()),R=fe(()=>RX(c,()=>({x:m(),y:_(),x1:n.x1,y1:n.y1,insets:n.insets}))),F=fe(()=>A(R)(n.data)??{x:0,y:0,width:0,height:0}),V=fe(()=>Wi(c.xScale)),W=fe(()=>Zr(A(V)?_():m())),G=fe(()=>A(W)(n.data)),K=fe(()=>Array.isArray(A(G))?Qj(A(G)):A(G)),Y=fe(()=>I()==="edge"?A(V)?A(K)>=0?"top":"bottom":A(K)>=0?"right":"left":I()),ne=fe(()=>["all","top","left","top-left"].includes(A(Y))),oe=fe(()=>["all","top","right","top-right"].includes(A(Y))),ce=fe(()=>["all","bottom","left","bottom-left"].includes(A(Y))),me=fe(()=>["all","bottom","right","bottom-right"].includes(A(Y))),ue=fe(()=>A(F).width),_e=fe(()=>A(F).height),te=fe(()=>2*r()),ie=fe(()=>`M${A(F).x+r()},${A(F).y} h${A(ue)-A(te)}
      ${A(oe)?`a${r()},${r()} 0 0 1 ${r()},${r()}`:`h${r()}v${r()}`}
      v${A(_e)-A(te)}
      ${A(me)?`a${r()},${r()} 0 0 1 ${-r()},${r()}`:`v${r()}h${-r()}`}
      h${A(te)-A(ue)}
      ${A(ce)?`a${r()},${r()} 0 0 1 ${-r()},${-r()}`:`h${-r()}v${-r()}`}
      v${A(te)-A(_e)}
      ${A(ne)?`a${r()},${r()} 0 0 1 ${r()},${-r()}`:`v${-r()}h${r()}`}
      z`.split(`
`).join(""));var xe=Gt(),de=yt(xe);{var Te=Be=>{{let Se=fe(()=>A(F).y+A(F).height),Ne=fe(()=>A(F).x+A(F).width),it=fe(()=>To(k,"bar"));pS(Be,Hn({get innerRadius(){return A(F).y},get outerRadius(){return A(Se)},get startAngle(){return A(F).x},get endAngle(){return A(Ne)},get fill(){return n.fill},get fillOpacity(){return n.fillOpacity},get stroke(){return A(P)},get strokeWidth(){return T()},get opacity(){return n.opacity},get cornerRadius(){return r()}},()=>A(it)))}},De=Be=>{var Se=Gt(),Ne=yt(Se);{var it=ft=>{{let St=fe(()=>A(Y)==="none"?0:r()),Dt=fe(()=>To(k,"bar"));cp(ft,Hn({get fill(){return n.fill},get fillOpacity(){return n.fillOpacity},get stroke(){return A(P)},get strokeWidth(){return T()},get opacity(){return n.opacity},get rx(){return A(St)},get motion(){return n.motion},get initialX(){return n.initialX},get initialY(){return n.initialY},get initialHeight(){return n.initialHeight},get initialWidth(){return n.initialWidth}},()=>A(F),()=>A(Dt)))}},qe=ft=>{const St=fe(()=>Ip(n.motion));{let Dt=fe(()=>To(k,"bar"));ad(ft,Hn({get pathData(){return A(ie)},get fill(){return n.fill},get fillOpacity(){return n.fillOpacity},get stroke(){return A(P)},get strokeWidth(){return T()},get opacity(){return n.opacity},get motion(){return A(St)}},()=>A(Dt)))}};Zt(Ne,ft=>{A(Y)==="all"||A(Y)==="none"||r()===0?ft(it):ft(qe,!1)},!0)}je(Be,Se)};Zt(de,Be=>{c.radial?Be(Te):Be(De,!1)})}je(s,xe),Kn()}var DX=Un("<!> <!> <!> <!>",1);function LX(s,n){Yn(n,!0);const c=_o(),m=hS();let _=Re(n,"x",19,()=>c.x),x=Re(n,"y",19,()=>c.y),T=Re(n,"points",3,!1),r=Re(n,"lines",3,!1),I=Re(n,"area",3,!1),k=Re(n,"bar",3,!1),P=Re(n,"motion",3,"spring");const R=fe(()=>Zr(_())),F=fe(()=>Zr(x())),V=fe(()=>n.data??m.data),W=fe(()=>A(R)(A(V))),G=fe(()=>Array.isArray(A(W))?A(W).map(Se=>c.xScale(Se)):c.xScale(A(W))),K=fe(()=>Wi(c.xScale)&&!c.radial?c.xScale.bandwidth()/2:0),Y=fe(()=>A(F)(A(V))),ne=fe(()=>Array.isArray(A(Y))?A(Y).map(Se=>c.yScale(Se)):c.yScale(A(Y))),oe=fe(()=>Wi(c.yScale)&&!c.radial?c.yScale.bandwidth()/2:0),ce=fe(()=>n.axis==null?Wi(c.yScale)?"y":"x":n.axis),me=fe(()=>{let Se=[];return A(V)&&((A(ce)==="x"||A(ce)==="both")&&(Array.isArray(A(G))?Se=[...Se,...A(G).filter(Pv).map((Ne,it)=>({x1:Ne+A(K),y1:Qr(c.yRange),x2:Ne+A(K),y2:co(c.yRange)}))]:A(G)!=null&&(Se=[...Se,{x1:A(G)+A(K),y1:Qr(c.yRange),x2:A(G)+A(K),y2:co(c.yRange)}])),(A(ce)==="y"||A(ce)==="both")&&(Array.isArray(A(ne))?Se=[...Se,...A(ne).filter(Pv).map((Ne,it)=>({x1:Qr(c.xRange),y1:Ne+A(oe),x2:co(c.xRange),y2:Ne+A(oe)}))]:A(ne)!=null&&(Se=[...Se,{x1:Qr(c.xRange),y1:A(ne)+A(oe),x2:co(c.xRange),y2:A(ne)+A(oe)}])),c.radial&&(Se=Se.map(Ne=>{const[it,qe]=gl(Ne.x1,Ne.y1),[ft,St]=gl(Ne.x2,Ne.y2);return{...Ne,x1:it,y1:qe,x2:ft,y2:St}}))),Se}),ue=fe(()=>{const Se={x:0,y:0,width:0,height:0};if(!A(V))return Se;if(A(ce)==="x"||A(ce)==="both"){if(Array.isArray(A(G)))Se.width=co(A(G))-Qr(A(G));else if(Wi(c.xScale))Se.width=c.xScale.step();else{const Ne=c.flatData.findIndex(ft=>Number(A(R)(ft))===Number(A(R)(A(V)))),qe=Ne+1===c.flatData.length?co(c.xDomain):A(R)(c.flatData[Ne+1]);Se.width=(c.xScale(qe)??0)-(A(G)??0)}Se.x=(Array.isArray(A(G))?Qr(A(G)):A(G))-(Wi(c.xScale)?c.xScale.padding()*c.xScale.step()/2:0),A(ce)==="x"&&(Se.y=Qr(c.yRange),Se.height=co(c.yRange)-Qr(c.yRange))}if(A(ce)==="y"||A(ce)==="both"){if(Array.isArray(A(ne)))Se.height=co(A(ne))-Qr(A(ne));else if(Wi(c.yScale))Se.height=c.yScale.step();else{const Ne=c.flatData.findIndex(ft=>Number(A(R)(ft))===Number(A(R)(A(V)))),qe=Ne+1===c.flatData.length?co(c.yDomain):A(R)(c.flatData[Ne+1]);Se.height=(c.yScale(qe)??0)-(A(ne)??0)}Se.y=(Array.isArray(A(ne))?Qr(A(ne)):A(ne))-(Wi(c.yScale)?c.yScale.padding()*c.yScale.step()/2:0),A(ce)==="y"&&(Se.width=co(c.xRange))}return Se}),_e=fe(()=>{let Se=[];if(!A(V))return Se;if(Array.isArray(A(G)))if(Array.isArray(A(V))){const Ne=A(V);Array.isArray(c.data)&&(Se=c.data.map(qe=>({series:qe,point:qe.find(ft=>A(F)(ft)===A(F)(Ne))})).filter(qe=>qe.point).map((qe,ft)=>({x:c.xScale(qe.point[1])+A(K),y:A(ne)+A(oe),fill:c.config.c?c.cGet(qe.series):null,data:{x:qe.point[1],y:A(Y)}})))}else Se=A(G).filter(Pv).map((Ne,it)=>{const qe=c.config.x?.[it];return{x:Ne+A(K),y:A(ne)+A(oe),fill:c.config.c?c.cGet({...A(V),$key:qe}):null,data:{x:A(W),y:A(Y)}}});else if(Array.isArray(A(ne)))if(Array.isArray(A(V))){const Ne=A(V);Array.isArray(c.data)&&(Se=c.data.map(qe=>({series:qe,point:qe.find(ft=>A(R)(ft)===A(R)(Ne))})).filter(qe=>qe.point).map((qe,ft)=>({x:A(G)+A(K),y:c.yScale(qe.point[1])+A(oe),fill:c.config.c?c.cGet(qe.series):null,data:{x:A(W),y:qe.point[1]}})))}else Se=A(ne).filter(Pv).map((Ne,it)=>{const qe=c.config.y[it];return{x:A(G)+A(K),y:Ne+A(oe),fill:c.config.c?c.cGet({...A(V),$key:qe}):null,data:{x:A(W),y:A(Y)}}});else A(G)!=null&&A(ne)!=null?Se=[{x:A(G)+A(K),y:A(ne)+A(oe),fill:c.config.c?c.cGet(A(V)):null,data:{x:A(W),y:A(Y)}}]:Se=[];return c.radial&&(Se=Se.map(Ne=>{const[it,qe]=gl(Ne.x,Ne.y);return{...Ne,x:it,y:qe}})),Se}),te=fe(()=>To(I(),"highlight-area")),ie=fe(()=>To(k(),"highlight-bar")),xe=fe(()=>To(r(),"highlight-line")),de=fe(()=>To(T(),"highlight-point"));var Te=Gt(),De=yt(Te);{var Be=Se=>{var Ne=DX(),it=yt(Ne);{var qe=st=>{var tt=Gt(),gt=yt(tt);{var Lt=Je=>{var Rt=Gt(),ut=yt(Rt);Dn(ut,I,()=>({area:A(ue)})),je(Je,Rt)},_t=Je=>{var Rt=Gt(),ut=yt(Rt);{var cn=Jt=>{{let vt=fe(()=>P()==="spring"?"spring":void 0),zt=fe(()=>A(ue).x+A(ue).width),fn=fe(()=>A(ue).y+A(ue).height),Gn=fe(()=>En(!A(te).fill&&"fill-surface-content/5",A(te).class)),Wn=fe(()=>n.onAreaClick&&(ti=>n.onAreaClick(ti,{data:A(V)})));pS(Jt,{get motion(){return A(vt)},get startAngle(){return A(ue).x},get endAngle(){return A(zt)},get innerRadius(){return A(ue).y},get outerRadius(){return A(fn)},get class(){return A(Gn)},get onclick(){return A(Wn)}})}},on=Jt=>{{let vt=fe(()=>P()==="spring"?"spring":void 0),zt=fe(()=>En(!A(te).fill&&"fill-surface-content/5",A(te).class)),fn=fe(()=>n.onAreaClick&&(Gn=>n.onAreaClick(Gn,{data:A(V)})));cp(Jt,Hn({get motion(){return A(vt)}},()=>A(ue),()=>A(te),{get class(){return A(zt)},get onclick(){return A(fn)}}))}};Zt(ut,Jt=>{c.radial?Jt(cn):Jt(on,!1)},!0)}je(Je,Rt)};Zt(gt,Je=>{typeof I()=="function"?Je(Lt):Je(_t,!1)})}je(st,tt)};Zt(it,st=>{I()&&st(qe)})}var ft=Tn(it,2);{var St=st=>{var tt=Gt(),gt=yt(tt);{var Lt=Je=>{var Rt=Gt(),ut=yt(Rt);Dn(ut,k),je(Je,Rt)},_t=Je=>{{let Rt=fe(()=>P()==="spring"?"spring":void 0),ut=fe(()=>En(!A(ie).fill&&"fill-primary",A(ie).class)),cn=fe(()=>n.onBarClick&&(on=>n.onBarClick(on,{data:A(V)})));zX(Je,Hn({get motion(){return A(Rt)},get data(){return A(V)}},()=>A(ie),{get class(){return A(ut)},get onclick(){return A(cn)}}))}};Zt(gt,Je=>{typeof k()=="function"?Je(Lt):Je(_t,!1)})}je(st,tt)};Zt(ft,st=>{k()&&st(St)})}var Dt=Tn(ft,2);{var Kt=st=>{var tt=Gt(),gt=yt(tt);{var Lt=Je=>{var Rt=Gt(),ut=yt(Rt);Dn(ut,r,()=>({lines:A(me)})),je(Je,Rt)},_t=Je=>{var Rt=Gt(),ut=yt(Rt);ro(ut,17,()=>A(me),cs,(cn,on)=>{{let Jt=fe(()=>P()==="spring"?"spring":void 0),vt=fe(()=>En("stroke-surface-content/20 stroke-2 [stroke-dasharray:2,2] pointer-events-none",A(xe).class));Zc(cn,Hn({get motion(){return A(Jt)},get x1(){return A(on).x1},get y1(){return A(on).y1},get x2(){return A(on).x2},get y2(){return A(on).y2}},()=>A(xe),{get class(){return A(vt)}}))}}),je(Je,Rt)};Zt(gt,Je=>{typeof r()=="function"?Je(Lt):Je(_t,!1)})}je(st,tt)};Zt(Dt,st=>{r()&&st(Kt)})}var et=Tn(Dt,2);{var Qe=st=>{var tt=Gt(),gt=yt(tt);{var Lt=Je=>{var Rt=Gt(),ut=yt(Rt);Dn(ut,T,()=>({points:A(_e)})),je(Je,Rt)},_t=Je=>{var Rt=Gt(),ut=yt(Rt);ro(ut,17,()=>A(_e),cs,(cn,on)=>{{let Jt=fe(()=>P()==="spring"?"spring":void 0),vt=fe(()=>En("stroke-white [paint-order:stroke] drop-shadow-sm",!A(on).fill&&(typeof T()=="boolean"||!T().fill)&&"fill-primary",A(de).class)),zt=fe(()=>n.onPointClick&&(ti=>{ti.stopPropagation()})),fn=fe(()=>n.onPointClick&&(ti=>n.onPointClick(ti,{point:A(on),data:A(V)}))),Gn=fe(()=>n.onPointEnter&&(ti=>{n.onPointClick&&(ti.target.style.cursor="pointer"),n.onPointEnter(ti,{point:A(on),data:A(V)})})),Wn=fe(()=>n.onPointLeave&&(ti=>{n.onPointClick&&(ti.target.style.cursor="default"),n.onPointLeave(ti,{point:A(on),data:A(V)})}));sd(cn,Hn({get motion(){return A(Jt)},get cx(){return A(on).x},get cy(){return A(on).y},get fill(){return A(on).fill},r:4,strokeWidth:6},()=>A(de),{get class(){return A(vt)},get onpointerdown(){return A(zt)},get onclick(){return A(fn)},get onpointerenter(){return A(Gn)},get onpointerleave(){return A(Wn)}}))}}),je(Je,Rt)};Zt(gt,Je=>{typeof T()=="function"?Je(Lt):Je(_t,!1)})}je(st,tt)};Zt(et,st=>{T()&&st(Qe)})}je(Se,Ne)};Zt(De,Se=>{A(V)&&Se(Be)})}je(s,Te),Kn()}function sL(s,n){return Math.abs(s.x-n.x)<1e-6&&Math.abs(s.y-n.y)<1e-6}function OX(s,n){return sL(s,n)?"":`M ${s.x} ${s.y} L ${n.x} ${n.y}`}function Xu(s){return Math.abs(s)<1e-6}function mS({source:s,target:n,sweep:c}){return c==="horizontal-vertical"?`M ${s.x} ${s.y} L ${n.x} ${s.y} L ${n.x} ${n.y}`:`M ${s.x} ${s.y} L ${s.x} ${n.y} L ${n.x} ${n.y}`}function FX(s){const{radius:n,dx:c,dy:m,source:_,target:x,sweep:T}=s,r=Math.max(0,Math.min(n,Math.abs(c),Math.abs(m)));if(Xu(r))return mS(s);const I=Math.sign(c),k=Math.sign(m);if(T==="horizontal-vertical"){const P={x:x.x-r*I,y:_.y},R={x:x.x,y:_.y+r*k};return`M ${_.x} ${_.y} L ${P.x} ${P.y} L ${R.x} ${R.y} L ${x.x} ${x.y}`}else{const P={x:_.x,y:x.y-r*k},R={x:_.x+r*I,y:x.y};return`M ${_.x} ${_.y} L ${P.x} ${P.y} L ${R.x} ${R.y} L ${x.x} ${x.y}`}}function BX(s){const{radius:n,dx:c,dy:m,source:_,target:x,sweep:T}=s,r=Math.max(0,Math.min(n,Math.abs(c),Math.abs(m)));if(Xu(r))return mS(s);const I=Math.sign(c),k=Math.sign(m);if(T==="horizontal-vertical"){const P={x:x.x-r*I,y:_.y},R={x:x.x,y:_.y+r*k},F=I*k>0?1:0;return`M ${_.x} ${_.y} L ${P.x} ${P.y} A ${r} ${r} 0 0 ${F} ${R.x} ${R.y} L ${x.x} ${x.y}`}else{const P={x:_.x,y:x.y-r*k},R={x:_.x+r*I,y:x.y},F=I*k>0?0:1;return`M ${_.x} ${_.y} L ${P.x} ${P.y} A ${r} ${r} 0 0 ${F} ${R.x} ${R.y} L ${x.x} ${x.y}`}}const ik={square:mS,beveled:FX,rounded:BX};function NX(s){const{source:n,target:c,type:m}=s;if(sL(n,c))return"";const _=c.x-n.x,x=c.y-n.y;return m==="straight"||Xu(_)||Xu(x)?OX(n,c):(ik[m]||ik.square)({...s,dx:_,dy:x})}const rk="M0,0L0,0";function VX({source:s,target:n,sweep:c,curve:m}){const _=n.x-s.x,x=n.y-s.y,T=a_().curve(m);let r=[];const I=Xu(_)||Xu(x);if(c==="none"||I?r=[[s.x,s.y],[n.x,n.y]]:c==="horizontal-vertical"?r=[[s.x,s.y],[n.x,s.y],[n.x,n.y]]:c==="vertical-horizontal"&&(r=[[s.x,s.y],[s.x,n.y],[n.x,n.y]]),r.length===2&&Xu(_)&&Xu(_))return rk;const k=T(r);return!k||k.includes("NaN")?rk:k}var UX=Un("<!> <!> <!> <!>",1);function jX(s,n){const c=fa();Yn(n,!0);let m=Re(n,"source",19,()=>({x:0,y:0})),_=Re(n,"target",19,()=>({x:100,y:100})),x=Re(n,"type",3,"rounded"),T=Re(n,"radius",3,20),r=Re(n,"curve",3,fx),I=Re(n,"pathRef",15),k=bi(n,["$$slots","$$events","$$legacy","source","target","sweep","type","radius","curve","pathRef","pathData","marker","markerStart","markerMid","markerEnd","motion"]);const P=fe(()=>n.sweep?n.sweep:x()==="d3"?"none":"horizontal-vertical"),R=fe(()=>n.markerStart||n.marker?Ls("marker-start",c):""),F=fe(()=>n.markerMid||n.marker?Ls("marker-mid",c):""),V=fe(()=>n.markerEnd||n.marker?Ls("marker-end",c):""),W=Ip(n.motion),G=W?{type:W.type,options:{interpolate:XT,...W.options}}:void 0,K=fe(()=>n.pathData?n.pathData:x()==="d3"?VX({source:m(),target:_(),sweep:A(P),curve:r()}):NX({source:m(),target:_(),sweep:A(P),type:x(),radius:T()})),Y=Vo("",()=>A(K),G||{type:"none"});var ne=UX(),oe=yt(ne);{let _e=fe(()=>A(R)?`url(#${A(R)})`:void 0),te=fe(()=>A(F)?`url(#${A(F)})`:void 0),ie=fe(()=>A(V)?`url(#${A(V)})`:void 0),xe=fe(()=>To(k,"connector"));ad(oe,Hn({get pathData(){return Y.current},get"marker-start"(){return A(_e)},get"marker-mid"(){return A(te)},get"marker-end"(){return A(ie)}},()=>A(xe),()=>k,{get pathRef(){return I()},set pathRef(de){I(de)}}))}var ce=Tn(oe,2);Hc(ce,{get id(){return A(R)},get marker(){return n.markerStart}});var me=Tn(ce,2);Hc(me,{get id(){return A(F)},get marker(){return n.markerMid}});var ue=Tn(me,2);Hc(ue,{get id(){return A(V)},get marker(){return n.markerEnd}}),je(s,ne),Kn()}const Jf={x:0,y:0};function GX(s,n){Yn(n,!0);let c=Re(n,"sankey",3,!1),m=Re(n,"type",3,"d3"),_=Re(n,"sweep",3,"none"),x=bi(n,["$$slots","$$events","$$legacy","data","sankey","source","target","orientation","x","y","curve","explicitCoords","type","sweep"]);const T=fe(()=>n.source?n.source:c()?W=>({node:W.source,y:W.y0,isSource:!0}):W=>W.source),r=fe(()=>n.target?n.target:c()?W=>({node:W.target,y:W.y1,isSource:!1}):W=>W.target),I=fe(()=>n.orientation?n.orientation:c()?"horizontal":"vertical"),k=fe(()=>n.curve?n.curve:A(I)==="horizontal"?eW:tW),P=fe(()=>n.x?n.x:c()?W=>W.isSource?W.node.x1:W.node.x0:W=>A(I)==="horizontal"?W.y:W.x),R=fe(()=>n.y?n.y:c()?W=>W.y:W=>A(I)==="horizontal"?W.x:W.y),F=fe(()=>{if(n.explicitCoords)return{x:n.explicitCoords.x1,y:n.explicitCoords.y1};if(!n.data)return Jf;try{const W=A(T)(n.data);if(W==null)return Jf;const G=A(P)(W),K=A(R)(W);return{x:Number.isFinite(G)?G:0,y:Number.isFinite(K)?K:0}}catch(W){return console.error("Error accessing source coordinates:",W,"Data:",n.data),Jf}}),V=fe(()=>{if(n.explicitCoords)return{x:n.explicitCoords.x2,y:n.explicitCoords.y2};if(!n.data)return Jf;try{const W=A(r)(n.data);if(W==null)return Jf;const G=A(P)(W),K=A(R)(W);return{x:Number.isFinite(G)?G:0,y:Number.isFinite(K)?K:0}}catch(W){return console.error("Error accessing target coordinates:",W,"Data:",n.data),Jf}});{let W=fe(()=>To(x,"link"));jX(s,Hn({get source(){return A(F)},get target(){return A(V)},get type(){return m()},get curve(){return A(k)},get sweep(){return _()}},()=>A(W)))}Kn()}var WX=Un("<!> <!>",1);function aL(s,n){Yn(n,!0);const c=_o();let m=Re(n,"r",3,5),_=Re(n,"links",3,!1),x=bi(n,["$$slots","$$events","$$legacy","data","x","y","r","offsetX","offsetY","links","fill","fillOpacity","stroke","strokeWidth","opacity","children"]);function T(Y,ne,oe){return typeof ne=="function"?ne(Y,c):ne??(Wi(oe)&&!c.radial?oe.bandwidth()/2:0)}const r=fe(()=>n.x?Zr(n.x):c.x),I=fe(()=>n.y?Zr(n.y):c.y),k=fe(()=>n.data??c.data),P=(Y,ne,oe)=>{const ce=c.xScale(Y),me=c.yScale(ne);return{x:ce+T(ce,n.offsetX,c.xScale),y:me+T(me,n.offsetY,c.yScale),r:c.config.r?c.rGet(oe):m(),xValue:Y,yValue:ne,data:oe}},R=fe(()=>A(k).flatMap(Y=>{const ne=A(r)(Y),oe=A(I)(Y);return Array.isArray(ne)?ne.filter(Boolean).map(ce=>P(ce,oe,Y)):Array.isArray(oe)?oe.filter(Boolean).map(ce=>P(ne,ce,Y)):ne!=null&&oe!=null?P(ne,oe,Y):[]})),F=fe(()=>A(k).flatMap(Y=>{const ne=A(r)(Y),oe=A(I)(Y);if(Array.isArray(ne)){const[ce,me]=Xa(c.xGet(Y)),ue=c.yGet(Y)+T(c.yGet(Y),n.offsetY,c.yScale);return{source:{x:ce+T(ce,n.offsetX,c.xScale)+(c.config.r?c.rGet(Y):m()),y:ue},target:{x:me+T(me,n.offsetX,c.xScale)-(c.config.r?c.rGet(Y):m()),y:ue},data:Y}}else if(Array.isArray(oe)){const ce=c.xGet(Y)+T(c.xGet(Y),n.offsetX,c.xScale),[me,ue]=Xa(c.yGet(Y));return{source:{x:ce,y:me+T(me,n.offsetY,c.yScale)},target:{x:ce,y:ue+T(ue,n.offsetY,c.yScale)},data:Y}}}));var V=Gt(),W=yt(V);{var G=Y=>{var ne=Gt(),oe=yt(ne);Dn(oe,()=>n.children,()=>({points:A(R)})),je(Y,ne)},K=Y=>{var ne=WX(),oe=yt(ne);{var ce=ue=>{var _e=Gt(),te=yt(_e);ro(te,17,()=>A(F),cs,(ie,xe)=>{{let de=fe(()=>n.fill??(c.config.c?c.cGet(A(xe).data):null)),Te=fe(()=>To(_(),"points-link"));GX(ie,Hn({get data(){return A(xe)},get stroke(){return A(de)}},()=>A(Te)))}}),je(ue,_e)};Zt(oe,ue=>{_()&&ue(ce)})}var me=Tn(oe,2);ro(me,17,()=>A(R),cs,(ue,_e)=>{const te=fe(()=>gl(A(_e).x,A(_e).y));{let ie=fe(()=>c.radial?A(te)[0]:A(_e).x),xe=fe(()=>c.radial?A(te)[1]:A(_e).y),de=fe(()=>n.fill??(c.config.c?c.cGet(A(_e).data):null)),Te=fe(()=>To(x,"point"));sd(ue,Hn({get cx(){return A(ie)},get cy(){return A(xe)},get r(){return A(_e).r},get fill(){return A(de)},get fillOpacity(){return n.fillOpacity},get stroke(){return n.stroke},get strokeWidth(){return n.strokeWidth},get opacity(){return n.opacity}},()=>A(Te)))}}),je(Y,ne)};Zt(W,Y=>{n.children?Y(G):Y(K,!1)})}je(s,V),Kn()}function qX(s,n){Yn(n,!0);const c=_o();let m=Re(n,"placement",3,"outside"),_=Re(n,"offset",19,()=>m()==="center"?0:4),x=Re(n,"key",3,(I,k)=>k),T=bi(n,["$$slots","$$events","$$legacy","data","value","x","y","placement","offset","format","key","children","class","fill"]);function r(I){const k=Wi(c.yScale)?I.xValue:I.yValue,P=typeof n.fill=="function"?Zr(n.fill)(I.data):n.fill,R=n.value?Zr(n.value)(I.data):Wi(c.yScale)?I.xValue:I.yValue,F=Jr(R,n.format??(n.value?void 0:Wi(c.yScale)?c.xScale.tickFormat?.():c.yScale.tickFormat?.()));return Wi(c.yScale)?k<0?{value:F,fill:P,x:I.x+(m()==="outside"?-_():_()),y:I.y,textAnchor:m()==="outside"?"end":"start",verticalAnchor:"middle",capHeight:".6rem"}:{value:F,fill:P,x:I.x+(m()==="outside"?_():-_()),y:I.y,textAnchor:m()==="outside"?"start":"end",verticalAnchor:"middle",capHeight:".6rem"}:k<0?{value:F,fill:P,x:I.x,y:I.y+(m()==="outside"?_():-_()),capHeight:".6rem",textAnchor:"middle",verticalAnchor:m()==="center"?"middle":m()==="outside"?"start":"end"}:{value:F,fill:P,x:I.x,y:I.y+(m()==="outside"?-_():_()),capHeight:".6rem",textAnchor:"middle",verticalAnchor:m()==="center"?"middle":m()==="outside"?"end":"start"}}{let I=fe(()=>Cn("labels-g"));oc(s,{get class(){return A(I)},children:(k,P)=>{aL(k,{get data(){return n.data},get x(){return n.x},get y(){return n.y},children:(F,V)=>{let W=()=>V?.().points;var G=Gt(),K=yt(G);ro(K,19,W,(Y,ne)=>x()(Y.data,ne),(Y,ne)=>{const oe=fe(()=>To(r(A(ne)),"labels-text"));var ce=Gt(),me=yt(ce);{var ue=te=>{var ie=Gt(),xe=yt(ie);Dn(xe,()=>n.children,()=>({data:A(ne),textProps:A(oe)})),je(te,ie)},_e=te=>{{let ie=fe(()=>En("text-xs",m()==="inside"?"fill-surface-300 stroke-surface-content":"fill-surface-content stroke-surface-100",A(oe).class,n.class));xp(te,Hn(()=>A(oe),()=>T,{get class(){return A(ie)}}))}};Zt(me,te=>{n.children?te(ue):te(_e,!1)})}je(Y,ce)}),je(F,G)},$$slots:{default:!0}})},$$slots:{default:!0}})}Kn()}var HX=Un("<!> <!>",1),ZX=Un("<!> <!>",1),XX=Un("<!> <!>",1);function YX(s,n){Yn(n,!0);let c=Re(n,"seriesState",7),m=Re(n,"canHaveTotal",3,!1);const _=_o();var x=Gt(),T=yt(x);{const r=(I,k)=>{let P=()=>k?.().data,R=()=>k?.().payload;var F=XX(),V=yt(F);mo(V,()=>tX,(G,K)=>{K(G,Hn({get value(){return R()[0].label},get format(){return Jr}},()=>n.tooltipProps?.header))});var W=Tn(V,2);mo(W,()=>oX,(G,K)=>{K(G,Hn(()=>n.tooltipProps?.list,{children:(Y,ne)=>{var oe=ZX(),ce=yt(oe);ro(ce,19,R,(_e,te)=>_e.key??te,(_e,te)=>{var ie=Gt(),xe=yt(ie);mo(xe,()=>$P,(de,Te)=>{Te(de,Hn({get label(){return A(te).name},get value(){return A(te).value},get color(){return A(te).color},get format(){return Jr},valueAlign:"right",onpointerenter:()=>c().highlightKey.current=A(te).key,onpointerleave:()=>c().highlightKey.current=null},()=>n.tooltipProps?.item))}),je(_e,ie)});var me=Tn(ce,2);{var ue=_e=>{var te=HX(),ie=yt(te);mo(ie,()=>aX,(de,Te)=>{Te(de,Hn(()=>n.tooltipProps?.separator,{children:void 0}))});var xe=Tn(ie,2);{let de=fe(()=>oU(c().visibleSeries,Te=>{const De=Te.data?b_(Te.data,P(),_.x):P();return Zr(Te.value??(Te.data?_.y:Te.key))(De)}));mo(xe,()=>$P,(Te,De)=>{De(Te,Hn({label:"total",get value(){return A(de)},format:"integer",valueAlign:"right"},()=>n.tooltipProps?.item))})}je(_e,te)};Zt(me,_e=>{m()&&R().length>1&&!n.tooltipProps?.hideTotal&&_e(ue)})}je(Y,oe)},$$slots:{default:!0}}))}),je(I,F)};mo(T,()=>oL,(I,k)=>{k(I,Hn({get context(){return _}},()=>n.tooltipProps?.root,{children:r,$$slots:{default:!0}}))})}je(s,x),Kn()}var KX=Un("<!> <!>",1);function JX(s,n){Yn(n,!0);const c=Re(n,"labelPlacement",3,"top-right"),m=Re(n,"labelXOffset",3,0),_=Re(n,"labelYOffset",3,0),x=_o(),T=fe(()=>n.x!=null),r=fe(()=>({x1:n.x?x.xScale(n.x):x.xRange[0],y1:n.y&&!n.x?x.yScale(n.y):x.yRange[0],x2:n.x?x.xScale(n.x):x.xRange[1],y2:n.y?x.yScale(n.y):x.yRange[1]})),I=fe(()=>A(T)?{x:A(r).x1+(c().includes("left")?-m():m()),y:(c().includes("top")?A(r).y2:c().includes("bottom")?A(r).y1:(A(r).y1-A(r).y2)/2)+(["top","bottom-left","bottom-right"].includes(c())?-_():_()),dy:-2,textAnchor:c().includes("left")?"end":c().includes("right")?"start":"middle",verticalAnchor:c()==="top"?"end":c()==="bottom"||c().includes("top")?"start":c().includes("bottom")?"end":"middle"}:{x:(c().includes("left")?A(r).x1:c().includes("right")?A(r).x2:(A(r).x2-A(r).x1)/2)+(["left","top-right","bottom-right"].includes(c())?-m():m()),y:A(r).y1+(c().includes("top")?-_():_()),dy:-2,textAnchor:c()==="left"?"end":c()==="right"||c().includes("left")?"start":c().includes("right")?"end":"middle",verticalAnchor:c().includes("top")?"end":c().includes("bottom")?"start":"middle"});var k=KX(),P=yt(k);{let V=fe(()=>En("stroke-surface-content",n.props?.line?.class));Zc(P,Hn({get x1(){return A(r).x1},get y1(){return A(r).y1},get x2(){return A(r).x2},get y2(){return A(r).y2}},()=>n.props?.line,{get class(){return A(V)}}))}var R=Tn(P,2);{var F=V=>{{let W=fe(()=>En("text-xs pointer-events-none",n.props?.label?.class));xp(V,Hn({get value(){return n.label}},()=>A(I),()=>n.props?.label,{get class(){return A(W)}}))}};Zt(R,V=>{n.label&&V(F)})}je(s,k),Kn()}var QX=Un("<!> <!>",1);function $X(s,n){Yn(n,!0);const c=Re(n,"r",3,4),m=Re(n,"labelPlacement",3,"center"),_=Re(n,"labelXOffset",3,0),x=Re(n,"labelYOffset",3,0),T=_o(),r=fe(()=>({x:n.x?T.xScale(n.x)+(Wi(T.xScale)?T.xScale.bandwidth()/2:0):0,y:n.y?T.yScale(n.y)+(Wi(T.yScale)?T.yScale.bandwidth()/2:0):T.height})),I=fe(()=>({x:A(r).x+((["top","center","bottom"].includes(m())?0:c())+_())*(m().includes("left")?-1:1),y:A(r).y+((["left","center","right"].includes(m())?0:c())+x())*(m().includes("top")?-1:1),dy:-2,textAnchor:m().includes("left")?"end":m().includes("right")?"start":"middle",verticalAnchor:m().includes("top")?"end":m().includes("bottom")?"start":"middle"}));var k=QX(),P=yt(k);{let V=fe(()=>En("stroke-surface-100",n.props?.circle?.class));sd(P,Hn({get cx(){return A(r).x},get cy(){return A(r).y},get r(){return c()},onpointermove:W=>{n.details&&(W.stopPropagation(),T.tooltip.show(W,{annotation:{label:n.label,details:n.details}}))},onpointerleave:()=>{n.details&&T.tooltip.hide()}},()=>n.props?.circle,{get class(){return A(V)}}))}var R=Tn(P,2);{var F=V=>{{let W=fe(()=>En("text-xs pointer-events-none",n.props?.label?.class));xp(V,Hn({get value(){return n.label}},()=>A(I),()=>n.props?.label,{get class(){return A(W)}}))}};Zt(R,V=>{n.label&&V(F)})}je(s,k),Kn()}var eY=sr("<stop></stop>"),tY=sr("<stop></stop>"),nY=sr("<defs><linearGradient><!></linearGradient></defs><!>",1);function iY(s,n){const c=fa();Yn(n,!0);let m=Re(n,"id",19,()=>Ls("linearGradient-",c)),_=Re(n,"stops",19,()=>["var(--tw-gradient-from)","var(--tw-gradient-to)"]),x=Re(n,"vertical",3,!1),T=Re(n,"x1",3,"0%"),r=Re(n,"y1",3,"0%"),I=Re(n,"x2",19,()=>x()?"0%":"100%"),k=Re(n,"y2",19,()=>x()?"100%":"0%"),P=Re(n,"units",3,"objectBoundingBox"),R=Re(n,"ref",15),F=bi(n,["$$slots","$$events","$$legacy","id","stops","vertical","x1","y1","x2","y2","rotate","units","ref","class","stopsContent","children"]),V=Mn(void 0);ki(()=>{R(A(V))});const W=_o(),G=bl();let K=Mn(void 0);function Y(ue){const _e=_().map((ie,xe)=>{if(Array.isArray(ie)){const{fill:de}=M0(ue.canvas,{styles:{fill:ie[1]},classes:n.class});return{offset:H7(ie[0]),color:de}}else{const{fill:de}=M0(ue.canvas,{styles:{fill:ie},classes:n.class});return{offset:xe/(_().length-1),color:de}}}),te=VH(ue,W.padding.left,W.padding.top,x()?W.padding.left:W.width-W.padding.right,x()?W.height+W.padding.bottom:W.padding.top,_e);rn(K,te,!0)}G==="canvas"&&sc({name:"Gradient",render:Y,deps:()=>[T(),r(),I(),k(),_(),n.class]});var ne=Gt(),oe=yt(ne);{var ce=ue=>{var _e=Gt(),te=yt(_e);{let ie=fe(()=>({id:m(),gradient:A(K)}));Dn(te,()=>n.children??Si,()=>A(ie))}je(ue,_e)},me=ue=>{var _e=Gt(),te=yt(_e);{var ie=xe=>{var de=nY(),Te=yt(de),De=Xn(Te);Ii(De,qe=>({id:m(),x1:T(),y1:r(),x2:I(),y2:k(),gradientTransform:n.rotate?`rotate(${n.rotate})`:"",gradientUnits:P(),...qe}),[()=>To(F,"linear-gradient")]);var Be=Xn(De);{var Se=qe=>{var ft=Gt(),St=yt(ft);Dn(St,()=>n.stopsContent??Si),je(qe,ft)},Ne=qe=>{var ft=Gt(),St=yt(ft);{var Dt=Kt=>{var et=Gt(),Qe=yt(et);ro(Qe,17,_,cs,(st,tt,gt)=>{var Lt=Gt(),_t=yt(Lt);{var Je=ut=>{var cn=eY();Vi(on=>{Gi(cn,"offset",A(tt)[0]),Gi(cn,"stop-color",A(tt)[1]),Pr(cn,0,on)},[()=>Cr(En(Cn("linear-gradient-stop"),n.class))]),je(ut,cn)},Rt=ut=>{var cn=tY();Vi(on=>{Gi(cn,"offset",`${gt*(100/(_().length-1))}%`),Gi(cn,"stop-color",A(tt)),Pr(cn,0,on)},[()=>Cr(En(Cn("linear-gradient-stop"),n.class))]),je(ut,cn)};Zt(_t,ut=>{Array.isArray(A(tt))?ut(Je):ut(Rt,!1)})}je(st,Lt)}),je(Kt,et)};Zt(St,Kt=>{_()&&Kt(Dt)},!0)}je(qe,ft)};Zt(Be,qe=>{n.stopsContent?qe(Se):qe(Ne,!1)})}Ln(De),er(De,qe=>rn(V,qe),()=>A(V)),Ln(Te);var it=Tn(Te);Dn(it,()=>n.children??Si,()=>({id:m(),gradient:`url(#${m()})`})),je(xe,de)};Zt(te,xe=>{G==="svg"&&xe(ie)},!0)}je(ue,_e)};Zt(oe,ue=>{G==="canvas"?ue(ce):ue(me,!1)})}je(s,ne),Kn()}var rY=sr("<rect></rect>"),oY=sr('<path fill="none"></path>'),sY=sr("<circle></circle>"),aY=sr("<!><!><!>",1),lY=sr("<defs><pattern><!></pattern></defs><!>",1);function cY(s,n){const c=fa();Yn(n,!0);let m=Re(n,"id",19,()=>Ls("pattern-",c)),_=Re(n,"size",3,4),x=Re(n,"width",19,_),T=Re(n,"height",19,_),r=bi(n,["$$slots","$$events","$$legacy","id","size","width","height","lines","circles","background","patternContent","children"]);const I=bl();let k=Mn(null),P=Ya([]);if(n.lines){const K=Array.isArray(n.lines)?n.lines:n.lines===!0?[{}]:[n.lines];for(const Y of K){const ne=Y.color??"var(--color-surface-content)",oe=Y.width??1,ce=Y.opacity??1;let me=Math.round(Y.rotate??0)%360;me>180?me=me-360:me>90?me=me-180:me<-180?me=me+360:me<-90&&(me=me+180);let ue="";me===0?ue=`
        M 0 0 L ${x()} 0
        M 0 ${T()} L ${x()} ${T()}
    `:me===90?ue=`
        M 0 0 L 0 ${T()}
        M ${x()} 0 L ${x()} ${T()}
    `:me>0?ue=`
          M 0 ${-T()} L ${x()*2} ${T()}
          M ${-x()} ${-T()} L ${x()} ${T()}
          M ${-x()} 0 L ${x()} ${T()*2}
      `:ue=`
          M ${-x()} ${T()} L ${x()} ${-T()}
          M ${-x()} ${T()*2} L ${x()*2} ${-T()}
          M 0 ${T()*2} L ${x()*2} 0
      `,P.push({type:"line",path:ue,stroke:ne,strokeWidth:oe,opacity:ce})}}if(n.circles){const K=Array.isArray(n.circles)?n.circles:n.circles===!0?[{}]:[n.circles];for(const Y of K)Y.stagger?P.push({type:"circle",cx:_()/4,cy:_()/4,r:Y.radius??1,fill:Y.color??"var(--color-surface-content)",opacity:Y.opacity??1},{type:"circle",cx:_()*3/4,cy:_()*3/4,r:Y.radius??1,fill:Y.color??"var(--color-surface-content)",opacity:Y.opacity??1}):P.push({type:"circle",cx:_()/2,cy:_()/2,r:Y.radius??1,fill:Y.color??"var(--color-surface-content)",opacity:Y.opacity??1})}function R(K){const Y=jH(K,x(),T(),P,n.background);rn(k,Y,!0)}I==="canvas"&&sc({name:"Pattern",render:R,deps:()=>[x(),T(),P,n.background]});var F=Gt(),V=yt(F);{var W=K=>{var Y=Gt(),ne=yt(Y);{let oe=fe(()=>({id:m(),pattern:A(k)}));Dn(ne,()=>n.children??Si,()=>A(oe))}je(K,Y)},G=K=>{var Y=Gt(),ne=yt(Y);{var oe=ce=>{var me=lY(),ue=yt(me),_e=Xn(ue);Ii(_e,Te=>({id:m(),width:x(),height:T(),patternUnits:"userSpaceOnUse",...Te}),[()=>To(r,"pattern")]);var te=Xn(_e);{var ie=Te=>{var De=Gt(),Be=yt(De);Dn(Be,()=>n.patternContent??Si),je(Te,De)},xe=Te=>{var De=aY(),Be=yt(De);{var Se=qe=>{var ft=rY();Vi(()=>{Gi(ft,"width",x()),Gi(ft,"height",T()),Gi(ft,"fill",n.background)}),je(qe,ft)};Zt(Be,qe=>{n.background&&qe(Se)})}var Ne=Tn(Be);ro(Ne,17,()=>P.filter(qe=>qe.type==="line"),cs,(qe,ft)=>{var St=oY();Vi(()=>{Gi(St,"d",A(ft).path),Gi(St,"stroke",A(ft).stroke),Gi(St,"stroke-width",A(ft).strokeWidth),Gi(St,"opacity",A(ft).opacity)}),je(qe,St)});var it=Tn(Ne);ro(it,17,()=>P.filter(qe=>qe.type==="circle"),cs,(qe,ft)=>{var St=sY();Vi(()=>{Gi(St,"cx",A(ft).cx),Gi(St,"cy",A(ft).cy),Gi(St,"r",A(ft).r),Gi(St,"fill",A(ft).fill),Gi(St,"opacity",A(ft).opacity)}),je(qe,St)}),je(Te,De)};Zt(te,Te=>{n.patternContent?Te(ie):Te(xe,!1)})}Ln(_e),Ln(ue);var de=Tn(ue);Dn(de,()=>n.children??Si,()=>({id:m(),pattern:`url(#${m()})`})),je(ce,me)};Zt(ne,ce=>{I==="svg"&&ce(oe)},!0)}je(K,Y)};Zt(V,K=>{I==="canvas"?K(W):K(G,!1)})}je(s,F),Kn()}var uY=Un("<!> <!> <!> <!>",1);function hY(s,n){Yn(n,!0);const c=Re(n,"labelPlacement",3,"center"),m=Re(n,"labelXOffset",3,0),_=Re(n,"labelYOffset",3,0),x=_o(),T=fe(()=>({x:n.x?x.xScale(n.x[0]??x.xDomain[0])-(Wi(x.xScale)?x.xScale.padding()*x.xScale.step()/2:0):x.xRange[0],y:n.y?x.yScale(n.y[1]??x.yDomain[1]):x.yRange[1],width:n.x?x.xScale(n.x[1]??x.xDomain[1])-x.xScale(n.x[0]??x.xDomain[0])+(Wi(x.xScale)?x.xScale.step():0):x.width,height:n.y?x.yScale(n.y[0]??x.yDomain[0])-x.yScale(n.y[1]??x.yDomain[1]):x.height})),r=fe(()=>({x:((c().includes("left")?A(T).x:c().includes("right")?(A(T).x??0)+A(T).width:(A(T).x??0)+A(T).width/2)??0)+(c().includes("right")?-m():m()),y:((c().includes("top")?A(T).y:c().includes("bottom")?(A(T).y??0)+A(T).height:(A(T).y??0)+A(T).height/2)??0)+(c().includes("bottom")?-_():_()),dy:-2,textAnchor:c().includes("left")?"start":c().includes("right")?"end":"middle",verticalAnchor:c().includes("top")?"start":c().includes("bottom")?"end":"middle"}));var I=uY(),k=yt(I);{var P=Y=>{{let ne=fe(()=>En(n.props?.rect?.class,n.class));cp(Y,Hn(()=>A(T),()=>n.props?.rect,{get fill(){return n.fill},get class(){return A(ne)}}))}};Zt(k,Y=>{(n.fill||n.class)&&Y(P)})}var R=Tn(k,2);{var F=Y=>{iY(Y,Hn(()=>n.gradient,{children:(oe,ce)=>{let me=()=>ce?.().gradient;cp(oe,Hn(()=>A(T),()=>n.props?.rect,{get fill(){return me()}}))},$$slots:{default:!0}}))};Zt(R,Y=>{n.gradient&&Y(F)})}var V=Tn(R,2);{var W=Y=>{cY(Y,Hn(()=>n.pattern,{children:(oe,ce)=>{let me=()=>ce?.().pattern;cp(oe,Hn(()=>A(T),()=>n.props?.rect,{get fill(){return me()}}))},$$slots:{default:!0}}))};Zt(V,Y=>{n.pattern&&Y(W)})}var G=Tn(V,2);{var K=Y=>{{let ne=fe(()=>En("text-xs pointer-events-none",n.props?.label?.class));xp(Y,Hn({get value(){return n.label}},()=>A(r),()=>n.props?.label,{get class(){return A(ne)}}))}};Zt(G,Y=>{n.label&&Y(K)})}je(s,I),Kn()}function ok(s,n){Yn(n,!0);let c=fe(()=>n.annotations.filter(x=>(x.layer===n.layer||x.layer==null&&n.layer==="above")&&(n.highlightKey==null||x.seriesKey==null||x.seriesKey===n.highlightKey)&&n.visibleSeries.some(T=>x.seriesKey==null||x.seriesKey===T.key)));var m=Gt(),_=yt(m);ro(_,17,()=>A(c),cs,(x,T)=>{var r=Gt(),I=yt(r);{var k=R=>{$X(R,Hn(()=>A(T)))},P=R=>{var F=Gt(),V=yt(F);{var W=K=>{JX(K,Hn(()=>A(T)))},G=K=>{var Y=Gt(),ne=yt(Y);{var oe=ce=>{hY(ce,Hn(()=>A(T)))};Zt(ne,ce=>{A(T).type==="range"&&ce(oe)},!0)}je(K,Y)};Zt(V,K=>{A(T).type==="line"?K(W):K(G,!1)},!0)}je(R,F)};Zt(I,R=>{A(T).type==="point"?R(k):R(P,!1)})}je(x,r)}),je(s,m),Kn()}var dY=Un("<!> <!> <!>",1),fY=Un("<!> <!>",1),pY=Un("<!> <!> <!>",1),mY=Un("<!> <!> <!> <!>",1),gY=Un("<!> <!> <!> <!> <!>",1),_Y=Un("<!> <!> <!> <!> <!>",1);function yY(s,n){Yn(n,!0);let c=Re(n,"data",19,()=>[]),m=Re(n,"xDomain",7),_=Re(n,"radial",3,!1),x=Re(n,"seriesLayout",3,"overlap"),T=Re(n,"axis",3,!0),r=Re(n,"brush",3,!1),I=Re(n,"grid",3,!0),k=Re(n,"labels",3,!1),P=Re(n,"legend",3,!1),R=Re(n,"points",3,!1),F=Re(n,"tooltip",3,!0),V=Re(n,"highlight",3,!0),W=Re(n,"annotations",19,()=>[]),G=Re(n,"rule",3,!0),K=Re(n,"onTooltipClick",3,()=>{}),Y=Re(n,"props",19,()=>({})),ne=Re(n,"renderContext",3,"svg"),oe=Re(n,"profile",3,!1),ce=Re(n,"debug",3,!1),me=Re(n,"context",15),ue=bi(n,["$$slots","$$events","$$legacy","data","x","y","xDomain","radial","series","seriesLayout","axis","brush","grid","labels","legend","points","tooltip","highlight","annotations","rule","onTooltipClick","onPointClick","props","renderContext","profile","debug","xScale","children","aboveContext","belowContext","belowMarks","aboveMarks","marks","context"]);const _e=fe(()=>n.series===void 0?[{key:"default",label:typeof n.y=="string"?n.y:"value",value:n.y,color:"var(--color-primary)"}]:n.series),te=new hX(()=>A(_e)),ie=fe(()=>x().startsWith("stack")),xe=fe(()=>{let Qe=te.allSeriesData.length?te.allSeriesData:e0(c());if(A(ie)){const st=te.visibleSeries.map(Lt=>Lt.key),tt=x()==="stackExpand"?sW:x()==="stackDiverging"?aW:v0,gt=oW().keys(st).value((Lt,_t)=>{const Je=A(_e).find(ut=>ut.key===_t);return Zr(Je.value??n.y??Je.key)(Lt)}).offset(tt)(Qe);for(let[Lt,_t]of A(_e).entries())_t.data&&(_t.data=_t.data.map((Je,Rt)=>({...Je,stackData:gt[Lt][Rt]})));Qe=Qe.map((Lt,_t)=>({...Lt,stackData:gt.map(Je=>Je[_t])}))}return Qe}),de=fe(()=>n.xScale??(Zr(n.x)(A(xe)[0])instanceof Date?fq():id()));function Te(Qe){return Qe&&typeof Qe=="object"&&"stackData"in Qe}function De(Qe,st,tt){return Qe.data?st.stackData:st.stackData[tt]??[]}function Be(Qe,st){const tt={...Y().line,...typeof Y().area?.line=="object"?Y().area.line:null,...typeof Qe.props?.line=="object"?Qe.props.line:null},gt=te.visibleSeries.length>1&&te.highlightKey.current&&te.highlightKey.current!==Qe.key?"opacity-10":"";return{data:Qe.data,y0:A(ie)?Lt=>De(Qe,Lt,st)[0]:Array.isArray(Qe.value)?Qe.value[0]:void 0,y1:A(ie)?Lt=>De(Qe,Lt,st)[1]:Array.isArray(Qe.value)?Qe.value[1]:Qe.value??(Qe.data?void 0:Qe.key),fill:Qe.color,fillOpacity:.3,...Y().area,...Qe.props,class:En("transition-opacity",gt,Y().area?.class,Qe.props?.class),line:{stroke:Qe.color,...tt,class:En("transition-opacity",gt,tt.class)}}}function Se(Qe,st){return{data:Qe.data,y:A(ie)?tt=>De(Qe,tt,st)[1]:Array.isArray(Qe.value)?Qe.value[1]:Qe.value??(Qe.data?void 0:Qe.key),fill:Qe.color,...Y().points,...typeof R()=="object"?R():null,class:En("stroke-surface-200 transition-opacity",te.highlightKey.current&&te.highlightKey.current!==Qe.key&&"opacity-10",Y().points?.class,typeof R()=="object"&&R().class)}}function Ne(Qe,st){return{data:Qe.data,y:A(ie)?tt=>Te(tt)?De(Qe,tt,st)[1]:void 0:Array.isArray(Qe.value)?Qe.value[1]:Qe.value??(Qe.data?void 0:Qe.key),...Y().labels,...typeof k()=="object"?k():null,class:En("stroke-surface-200 transition-opacity",te.highlightKey.current&&te.highlightKey.current!==Qe.key&&"opacity-10",Y().labels?.class,typeof k()=="object"&&k().class)}}const it=fe(()=>({...typeof r()=="object"?r():null,...Y().brush}));function qe(Qe,st){if(!me())return{};const tt=Qe.data&&me().tooltip.data?b_(Qe.data,me().tooltip.data,me().x):null,gt=typeof Y().highlight?.points=="object"?Y().highlight.points:null;return{data:tt,y:A(ie)?Lt=>De(Qe,Lt,st)[1]:Qe.value??(Qe.data?void 0:Qe.key),lines:st==0,onPointClick:n.onPointClick?(Lt,_t)=>n.onPointClick(Lt,{..._t,series:Qe}):void 0,onPointEnter:()=>te.highlightKey.current=Qe.key,onPointLeave:()=>te.highlightKey.current=null,...Y().highlight,points:Y().highlight?.points==!1?!1:{...gt,fill:Qe.color,class:En("transition-opacity",te.highlightKey.current&&te.highlightKey.current!==Qe.key&&"opacity-10",gt?.class)}}}function ft(){return dX({seriesState:te,props:{...Y().legend,...typeof P()=="object"?P():null}})}function St(){return{x:_(),y:!0,...typeof I()=="object"?I():null,...Y().grid}}oe()&&(console.time("AreaChart render"),bp(()=>{console.timeEnd("AreaChart render")})),eZ({type:"area",get stackSeries(){return A(ie)},get visibleSeries(){return te.visibleSeries}});function Dt(Qe){return A(ie)?st=>Te(st)?te.visibleSeries.flatMap((tt,gt)=>st.stackData[gt]):void 0:Qe||te.visibleSeries.map(st=>st.value??st.key)}function Kt(Qe){return Qe==="y"?{placement:_()?"radius":"left",format:x()==="stackExpand"?"percentRound":void 0,...typeof T()=="object"?T():null,...Y().yAxis}:{placement:_()?"angle":"bottom",...typeof T()=="object"?T():null,...Y().xAxis}}function et(){return{x:0,y:0,...typeof G()=="object"?G():null,...Y().rule}}{const Qe=(_t,Je)=>{let Rt=()=>Je?.().context;const ut=fe(()=>({context:Rt(),series:A(_e),visibleSeries:te.visibleSeries,getAreaProps:Be,getLabelsProps:Ne,getPointsProps:Se,getHighlightProps:qe,getLegendProps:ft,getGridProps:St,getAxisProps:Kt,getRuleProps:et,highlightKey:te.highlightKey.current,setHighlightKey:te.highlightKey.set}));var cn=Gt(),on=yt(cn);{var Jt=zt=>{var fn=Gt(),Gn=yt(fn);Dn(Gn,()=>n.children,()=>A(ut)),je(zt,fn)},vt=zt=>{var fn=_Y(),Gn=yt(fn);Dn(Gn,()=>n.belowContext??Si,()=>A(ut));var Wn=Tn(Gn,2);{let qi=fe(()=>ne()==="canvas"?Y().canvas:Y().svg);UZ(Wn,Hn({get type(){return ne()}},()=>A(qi),{get center(){return _()},get debug(){return ce()},children:(ir,$r)=>{var lr=gY(),hr=yt(lr);{var uo=to=>{var qr=Gt(),Xo=yt(qr);Dn(Xo,I,()=>A(ut)),je(to,qr)},oo=to=>{var qr=Gt(),Xo=yt(qr);{var Uo=Po=>{{let Mt=fe(St);PX(Po,Hn(()=>A(Mt)))}};Zt(Xo,Po=>{I()&&Po(Uo)},!0)}je(to,qr)};Zt(hr,to=>{typeof I()=="function"?to(uo):to(oo,!1)})}var ho=Tn(hr,2);{let to=fe(()=>!r());A2(ho,{get disabled(){return A(to)},children:(qr,Xo)=>{var Uo=dY(),Po=yt(Uo);ok(Po,{get annotations(){return W()},layer:"below",get highlightKey(){return te.highlightKey.current},get visibleSeries(){return te.visibleSeries}});var Mt=Tn(Po,2);Dn(Mt,()=>n.belowMarks??Si,()=>A(ut));var fo=Tn(Mt,2);{var Yo=Xe=>{var ee=Gt(),se=yt(ee);Dn(se,()=>n.marks,()=>A(ut)),je(Xe,ee)},jo=Xe=>{var ee=Gt(),se=yt(ee);ro(se,19,()=>te.visibleSeries,we=>we.key,(we,Fe,Ie)=>{{let Pe=fe(()=>Be(A(Fe),A(Ie)));mX(we,Hn(()=>A(Pe)))}}),je(Xe,ee)};Zt(fo,Xe=>{n.marks?Xe(Yo):Xe(jo,!1)})}je(qr,Uo)},$$slots:{default:!0}})}var Co=Tn(ho,2);Dn(Co,()=>n.aboveMarks??Si,()=>A(ut));var us=Tn(Co,2);{var rr=to=>{var qr=fY(),Xo=yt(qr);Dn(Xo,T,()=>A(ut));var Uo=Tn(Xo,2);{var Po=fo=>{var Yo=Gt(),jo=yt(Yo);Dn(jo,G,()=>A(ut)),je(fo,Yo)},Mt=fo=>{var Yo=Gt(),jo=yt(Yo);{var Xe=ee=>{{let se=fe(et);Zu(ee,Hn(()=>A(se)))}};Zt(jo,ee=>{G()&&ee(Xe)},!0)}je(fo,Yo)};Zt(Uo,fo=>{typeof G()=="function"?fo(Po):fo(Mt,!1)})}je(to,qr)},ar=to=>{var qr=Gt(),Xo=yt(qr);{var Uo=Po=>{var Mt=pY(),fo=yt(Mt);{var Yo=Fe=>{{let Ie=fe(()=>Kt("y"));tk(Fe,Hn(()=>A(Ie)))}};Zt(fo,Fe=>{T()!=="x"&&Fe(Yo)})}var jo=Tn(fo,2);{var Xe=Fe=>{{let Ie=fe(()=>Kt("x"));tk(Fe,Hn(()=>A(Ie)))}};Zt(jo,Fe=>{T()!=="y"&&Fe(Xe)})}var ee=Tn(jo,2);{var se=Fe=>{var Ie=Gt(),Pe=yt(Ie);Dn(Pe,G,()=>A(ut)),je(Fe,Ie)},we=Fe=>{var Ie=Gt(),Pe=yt(Ie);{var nt=Ge=>{{let at=fe(et);Zu(Ge,Hn(()=>A(at)))}};Zt(Pe,Ge=>{G()&&Ge(nt)},!0)}je(Fe,Ie)};Zt(ee,Fe=>{typeof G()=="function"?Fe(se):Fe(we,!1)})}je(Po,Mt)};Zt(Xo,Po=>{T()&&Po(Uo)},!0)}je(to,qr)};Zt(us,to=>{typeof T()=="function"?to(rr):to(ar,!1)})}var Zo=Tn(us,2);{let to=fe(()=>!r());A2(Zo,{get disabled(){return A(to)},full:!0,children:(qr,Xo)=>{var Uo=mY(),Po=yt(Uo);{var Mt=Ie=>{var Pe=Gt(),nt=yt(Pe);Dn(nt,R,()=>A(ut)),je(Ie,Pe)},fo=Ie=>{var Pe=Gt(),nt=yt(Pe);{var Ge=at=>{var Bt=Gt(),At=yt(Bt);ro(At,19,()=>te.visibleSeries,dn=>dn.key,(dn,An,Nn)=>{{let hi=fe(()=>Se(A(An),A(Nn)));aL(dn,Hn(()=>A(hi)))}}),je(at,Bt)};Zt(nt,at=>{R()&&at(Ge)},!0)}je(Ie,Pe)};Zt(Po,Ie=>{typeof R()=="function"?Ie(Mt):Ie(fo,!1)})}var Yo=Tn(Po,2);{var jo=Ie=>{var Pe=Gt(),nt=yt(Pe);Dn(nt,V,()=>A(ut)),je(Ie,Pe)},Xe=Ie=>{var Pe=Gt(),nt=yt(Pe);{var Ge=at=>{var Bt=Gt(),At=yt(Bt);ro(At,19,()=>te.visibleSeries,dn=>dn.key,(dn,An,Nn)=>{{let hi=fe(()=>qe(A(An),A(Nn)));LX(dn,Hn(()=>A(hi)))}}),je(at,Bt)};Zt(nt,at=>{V()&&at(Ge)},!0)}je(Ie,Pe)};Zt(Yo,Ie=>{typeof V()=="function"?Ie(jo):Ie(Xe,!1)})}var ee=Tn(Yo,2);{var se=Ie=>{var Pe=Gt(),nt=yt(Pe);Dn(nt,k,()=>A(ut)),je(Ie,Pe)},we=Ie=>{var Pe=Gt(),nt=yt(Pe);{var Ge=at=>{var Bt=Gt(),At=yt(Bt);ro(At,19,()=>te.visibleSeries,dn=>dn.key,(dn,An,Nn)=>{{let hi=fe(()=>Ne(A(An),A(Nn)));qX(dn,Hn(()=>A(hi)))}}),je(at,Bt)};Zt(nt,at=>{k()&&at(Ge)},!0)}je(Ie,Pe)};Zt(ee,Ie=>{typeof k()=="function"?Ie(se):Ie(we,!1)})}var Fe=Tn(ee,2);ok(Fe,{get annotations(){return W()},layer:"above",get highlightKey(){return te.highlightKey.current},get visibleSeries(){return te.visibleSeries}}),je(qr,Uo)},$$slots:{default:!0}})}je(ir,lr)},$$slots:{default:!0}}))}var ti=Tn(Wn,2);Dn(ti,()=>n.aboveContext??Si,()=>A(ut));var yi=Tn(ti,2);{var Ri=qi=>{var ir=Gt(),$r=yt(ir);Dn($r,P,()=>A(ut)),je(qi,ir)},ur=qi=>{var ir=Gt(),$r=yt(ir);{var lr=hr=>{{let uo=fe(ft);QZ(hr,Hn(()=>A(uo)))}};Zt($r,hr=>{P()&&hr(lr)},!0)}je(qi,ir)};Zt(yi,qi=>{typeof P()=="function"?qi(Ri):qi(ur,!1)})}var wi=Tn(yi,2);{var Oi=qi=>{var ir=Gt(),$r=yt(ir);Dn($r,F,()=>A(ut)),je(qi,ir)},zi=qi=>{var ir=Gt(),$r=yt(ir);{var lr=hr=>{YX(hr,{get tooltipProps(){return Y().tooltip},get seriesState(){return te},get canHaveTotal(){return A(ie)}})};Zt($r,hr=>{F()&&hr(lr)},!0)}je(qi,ir)};Zt(wi,qi=>{typeof F()=="function"?qi(Oi):qi(zi,!1)})}je(zt,fn)};Zt(on,zt=>{n.children?zt(Jt):zt(vt,!1)})}je(_t,cn)};let st=fe(()=>Dt(n.y)),tt=fe(()=>_()?void 0:N8(T(),P())),gt=fe(()=>F()===!1?!1:{mode:"quadtree-x",onclick:K(),debug:ce(),...Y().tooltip?.context,...typeof F()=="object"?F():null}),Lt=fe(()=>r()&&(r()===!0||r().mode==null||r().mode==="integrated")?{axis:"x",resetOnEnd:!0,xDomain:m(),...A(it),onBrushEnd:_t=>{m(_t.xDomain),A(it).onBrushEnd?.(_t)}}:!1);SZ(s,Hn({get data(){return A(xe)},get x(){return n.x},get xDomain(){return m()},get xScale(){return A(de)},get y(){return A(st)},yBaseline:0,yNice:!0,get radial(){return _()},get padding(){return A(tt)}},()=>ue,{get tooltip(){return A(gt)},get brush(){return A(Lt)},get context(){return me()},set context(_t){me(_t)},children:Qe,$$slots:{default:!0}}))}Kn()}var Zb,sk;function gS(){if(sk)return Zb;sk=1;var s="\0",n="\0",c="";class m{_isDirected=!0;_isMultigraph=!1;_isCompound=!1;_label;_defaultNodeLabelFn=()=>{};_defaultEdgeLabelFn=()=>{};_nodes={};_in={};_preds={};_out={};_sucs={};_edgeObjs={};_edgeLabels={};_nodeCount=0;_edgeCount=0;_parent;_children;constructor(P){P&&(this._isDirected=Object.hasOwn(P,"directed")?P.directed:!0,this._isMultigraph=Object.hasOwn(P,"multigraph")?P.multigraph:!1,this._isCompound=Object.hasOwn(P,"compound")?P.compound:!1),this._isCompound&&(this._parent={},this._children={},this._children[n]={})}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(P){return this._label=P,this}graph(){return this._label}setDefaultNodeLabel(P){return this._defaultNodeLabelFn=P,typeof P!="function"&&(this._defaultNodeLabelFn=()=>P),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var P=this;return this.nodes().filter(R=>Object.keys(P._in[R]).length===0)}sinks(){var P=this;return this.nodes().filter(R=>Object.keys(P._out[R]).length===0)}setNodes(P,R){var F=arguments,V=this;return P.forEach(function(W){F.length>1?V.setNode(W,R):V.setNode(W)}),this}setNode(P,R){return Object.hasOwn(this._nodes,P)?(arguments.length>1&&(this._nodes[P]=R),this):(this._nodes[P]=arguments.length>1?R:this._defaultNodeLabelFn(P),this._isCompound&&(this._parent[P]=n,this._children[P]={},this._children[n][P]=!0),this._in[P]={},this._preds[P]={},this._out[P]={},this._sucs[P]={},++this._nodeCount,this)}node(P){return this._nodes[P]}hasNode(P){return Object.hasOwn(this._nodes,P)}removeNode(P){var R=this;if(Object.hasOwn(this._nodes,P)){var F=V=>R.removeEdge(R._edgeObjs[V]);delete this._nodes[P],this._isCompound&&(this._removeFromParentsChildList(P),delete this._parent[P],this.children(P).forEach(function(V){R.setParent(V)}),delete this._children[P]),Object.keys(this._in[P]).forEach(F),delete this._in[P],delete this._preds[P],Object.keys(this._out[P]).forEach(F),delete this._out[P],delete this._sucs[P],--this._nodeCount}return this}setParent(P,R){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(R===void 0)R=n;else{R+="";for(var F=R;F!==void 0;F=this.parent(F))if(F===P)throw new Error("Setting "+R+" as parent of "+P+" would create a cycle");this.setNode(R)}return this.setNode(P),this._removeFromParentsChildList(P),this._parent[P]=R,this._children[R][P]=!0,this}_removeFromParentsChildList(P){delete this._children[this._parent[P]][P]}parent(P){if(this._isCompound){var R=this._parent[P];if(R!==n)return R}}children(P=n){if(this._isCompound){var R=this._children[P];if(R)return Object.keys(R)}else{if(P===n)return this.nodes();if(this.hasNode(P))return[]}}predecessors(P){var R=this._preds[P];if(R)return Object.keys(R)}successors(P){var R=this._sucs[P];if(R)return Object.keys(R)}neighbors(P){var R=this.predecessors(P);if(R){const V=new Set(R);for(var F of this.successors(P))V.add(F);return Array.from(V.values())}}isLeaf(P){var R;return this.isDirected()?R=this.successors(P):R=this.neighbors(P),R.length===0}filterNodes(P){var R=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});R.setGraph(this.graph());var F=this;Object.entries(this._nodes).forEach(function([G,K]){P(G)&&R.setNode(G,K)}),Object.values(this._edgeObjs).forEach(function(G){R.hasNode(G.v)&&R.hasNode(G.w)&&R.setEdge(G,F.edge(G))});var V={};function W(G){var K=F.parent(G);return K===void 0||R.hasNode(K)?(V[G]=K,K):K in V?V[K]:W(K)}return this._isCompound&&R.nodes().forEach(G=>R.setParent(G,W(G))),R}setDefaultEdgeLabel(P){return this._defaultEdgeLabelFn=P,typeof P!="function"&&(this._defaultEdgeLabelFn=()=>P),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(P,R){var F=this,V=arguments;return P.reduce(function(W,G){return V.length>1?F.setEdge(W,G,R):F.setEdge(W,G),G}),this}setEdge(){var P,R,F,V,W=!1,G=arguments[0];typeof G=="object"&&G!==null&&"v"in G?(P=G.v,R=G.w,F=G.name,arguments.length===2&&(V=arguments[1],W=!0)):(P=G,R=arguments[1],F=arguments[3],arguments.length>2&&(V=arguments[2],W=!0)),P=""+P,R=""+R,F!==void 0&&(F=""+F);var K=T(this._isDirected,P,R,F);if(Object.hasOwn(this._edgeLabels,K))return W&&(this._edgeLabels[K]=V),this;if(F!==void 0&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(P),this.setNode(R),this._edgeLabels[K]=W?V:this._defaultEdgeLabelFn(P,R,F);var Y=r(this._isDirected,P,R,F);return P=Y.v,R=Y.w,Object.freeze(Y),this._edgeObjs[K]=Y,_(this._preds[R],P),_(this._sucs[P],R),this._in[R][K]=Y,this._out[P][K]=Y,this._edgeCount++,this}edge(P,R,F){var V=arguments.length===1?I(this._isDirected,arguments[0]):T(this._isDirected,P,R,F);return this._edgeLabels[V]}edgeAsObj(){const P=this.edge(...arguments);return typeof P!="object"?{label:P}:P}hasEdge(P,R,F){var V=arguments.length===1?I(this._isDirected,arguments[0]):T(this._isDirected,P,R,F);return Object.hasOwn(this._edgeLabels,V)}removeEdge(P,R,F){var V=arguments.length===1?I(this._isDirected,arguments[0]):T(this._isDirected,P,R,F),W=this._edgeObjs[V];return W&&(P=W.v,R=W.w,delete this._edgeLabels[V],delete this._edgeObjs[V],x(this._preds[R],P),x(this._sucs[P],R),delete this._in[R][V],delete this._out[P][V],this._edgeCount--),this}inEdges(P,R){var F=this._in[P];if(F){var V=Object.values(F);return R?V.filter(W=>W.v===R):V}}outEdges(P,R){var F=this._out[P];if(F){var V=Object.values(F);return R?V.filter(W=>W.w===R):V}}nodeEdges(P,R){var F=this.inEdges(P,R);if(F)return F.concat(this.outEdges(P,R))}}function _(k,P){k[P]?k[P]++:k[P]=1}function x(k,P){--k[P]||delete k[P]}function T(k,P,R,F){var V=""+P,W=""+R;if(!k&&V>W){var G=V;V=W,W=G}return V+c+W+c+(F===void 0?s:F)}function r(k,P,R,F){var V=""+P,W=""+R;if(!k&&V>W){var G=V;V=W,W=G}var K={v:V,w:W};return F&&(K.name=F),K}function I(k,P){return T(k,P.v,P.w,P.name)}return Zb=m,Zb}var Xb,ak;function vY(){return ak||(ak=1,Xb="2.2.4"),Xb}var Yb,lk;function xY(){return lk||(lk=1,Yb={Graph:gS(),version:vY()}),Yb}var Kb,ck;function bY(){if(ck)return Kb;ck=1;var s=gS();Kb={write:n,read:_};function n(x){var T={options:{directed:x.isDirected(),multigraph:x.isMultigraph(),compound:x.isCompound()},nodes:c(x),edges:m(x)};return x.graph()!==void 0&&(T.value=structuredClone(x.graph())),T}function c(x){return x.nodes().map(function(T){var r=x.node(T),I=x.parent(T),k={v:T};return r!==void 0&&(k.value=r),I!==void 0&&(k.parent=I),k})}function m(x){return x.edges().map(function(T){var r=x.edge(T),I={v:T.v,w:T.w};return T.name!==void 0&&(I.name=T.name),r!==void 0&&(I.value=r),I})}function _(x){var T=new s(x.options).setGraph(x.value);return x.nodes.forEach(function(r){T.setNode(r.v,r.value),r.parent&&T.setParent(r.v,r.parent)}),x.edges.forEach(function(r){T.setEdge({v:r.v,w:r.w,name:r.name},r.value)}),T}return Kb}var Jb,uk;function wY(){if(uk)return Jb;uk=1,Jb=s;function s(n){var c={},m=[],_;function x(T){Object.hasOwn(c,T)||(c[T]=!0,_.push(T),n.successors(T).forEach(x),n.predecessors(T).forEach(x))}return n.nodes().forEach(function(T){_=[],x(T),_.length&&m.push(_)}),m}return Jb}var Qb,hk;function lL(){if(hk)return Qb;hk=1;class s{_arr=[];_keyIndices={};size(){return this._arr.length}keys(){return this._arr.map(function(c){return c.key})}has(c){return Object.hasOwn(this._keyIndices,c)}priority(c){var m=this._keyIndices[c];if(m!==void 0)return this._arr[m].priority}min(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key}add(c,m){var _=this._keyIndices;if(c=String(c),!Object.hasOwn(_,c)){var x=this._arr,T=x.length;return _[c]=T,x.push({key:c,priority:m}),this._decrease(T),!0}return!1}removeMin(){this._swap(0,this._arr.length-1);var c=this._arr.pop();return delete this._keyIndices[c.key],this._heapify(0),c.key}decrease(c,m){var _=this._keyIndices[c];if(m>this._arr[_].priority)throw new Error("New priority is greater than current priority. Key: "+c+" Old: "+this._arr[_].priority+" New: "+m);this._arr[_].priority=m,this._decrease(_)}_heapify(c){var m=this._arr,_=2*c,x=_+1,T=c;_<m.length&&(T=m[_].priority<m[T].priority?_:T,x<m.length&&(T=m[x].priority<m[T].priority?x:T),T!==c&&(this._swap(c,T),this._heapify(T)))}_decrease(c){for(var m=this._arr,_=m[c].priority,x;c!==0&&(x=c>>1,!(m[x].priority<_));)this._swap(c,x),c=x}_swap(c,m){var _=this._arr,x=this._keyIndices,T=_[c],r=_[m];_[c]=r,_[m]=T,x[r.key]=c,x[T.key]=m}}return Qb=s,Qb}var $b,dk;function cL(){if(dk)return $b;dk=1;var s=lL();$b=c;var n=()=>1;function c(_,x,T,r){return m(_,String(x),T||n,r||function(I){return _.outEdges(I)})}function m(_,x,T,r){var I={},k=new s,P,R,F=function(V){var W=V.v!==P?V.v:V.w,G=I[W],K=T(V),Y=R.distance+K;if(K<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+V+" Weight: "+K);Y<G.distance&&(G.distance=Y,G.predecessor=P,k.decrease(W,Y))};for(_.nodes().forEach(function(V){var W=V===x?0:Number.POSITIVE_INFINITY;I[V]={distance:W},k.add(V,W)});k.size()>0&&(P=k.removeMin(),R=I[P],R.distance!==Number.POSITIVE_INFINITY);)r(P).forEach(F);return I}return $b}var ew,fk;function TY(){if(fk)return ew;fk=1;var s=cL();ew=n;function n(c,m,_){return c.nodes().reduce(function(x,T){return x[T]=s(c,T,m,_),x},{})}return ew}var tw,pk;function uL(){if(pk)return tw;pk=1,tw=s;function s(n){var c=0,m=[],_={},x=[];function T(r){var I=_[r]={onStack:!0,lowlink:c,index:c++};if(m.push(r),n.successors(r).forEach(function(R){Object.hasOwn(_,R)?_[R].onStack&&(I.lowlink=Math.min(I.lowlink,_[R].index)):(T(R),I.lowlink=Math.min(I.lowlink,_[R].lowlink))}),I.lowlink===I.index){var k=[],P;do P=m.pop(),_[P].onStack=!1,k.push(P);while(r!==P);x.push(k)}}return n.nodes().forEach(function(r){Object.hasOwn(_,r)||T(r)}),x}return tw}var nw,mk;function SY(){if(mk)return nw;mk=1;var s=uL();nw=n;function n(c){return s(c).filter(function(m){return m.length>1||m.length===1&&c.hasEdge(m[0],m[0])})}return nw}var iw,gk;function EY(){if(gk)return iw;gk=1,iw=n;var s=()=>1;function n(m,_,x){return c(m,_||s,x||function(T){return m.outEdges(T)})}function c(m,_,x){var T={},r=m.nodes();return r.forEach(function(I){T[I]={},T[I][I]={distance:0},r.forEach(function(k){I!==k&&(T[I][k]={distance:Number.POSITIVE_INFINITY})}),x(I).forEach(function(k){var P=k.v===I?k.w:k.v,R=_(k);T[I][P]={distance:R,predecessor:I}})}),r.forEach(function(I){var k=T[I];r.forEach(function(P){var R=T[P];r.forEach(function(F){var V=R[I],W=k[F],G=R[F],K=V.distance+W.distance;K<G.distance&&(G.distance=K,G.predecessor=W.predecessor)})})}),T}return iw}var rw,_k;function hL(){if(_k)return rw;_k=1;function s(c){var m={},_={},x=[];function T(r){if(Object.hasOwn(_,r))throw new n;Object.hasOwn(m,r)||(_[r]=!0,m[r]=!0,c.predecessors(r).forEach(T),delete _[r],x.push(r))}if(c.sinks().forEach(T),Object.keys(m).length!==c.nodeCount())throw new n;return x}class n extends Error{constructor(){super(...arguments)}}return rw=s,s.CycleException=n,rw}var ow,yk;function AY(){if(yk)return ow;yk=1;var s=hL();ow=n;function n(c){try{s(c)}catch(m){if(m instanceof s.CycleException)return!1;throw m}return!0}return ow}var sw,vk;function dL(){if(vk)return sw;vk=1,sw=s;function s(_,x,T){Array.isArray(x)||(x=[x]);var r=_.isDirected()?R=>_.successors(R):R=>_.neighbors(R),I=T==="post"?n:c,k=[],P={};return x.forEach(R=>{if(!_.hasNode(R))throw new Error("Graph does not have node: "+R);I(R,r,P,k)}),k}function n(_,x,T,r){for(var I=[[_,!1]];I.length>0;){var k=I.pop();k[1]?r.push(k[0]):Object.hasOwn(T,k[0])||(T[k[0]]=!0,I.push([k[0],!0]),m(x(k[0]),P=>I.push([P,!1])))}}function c(_,x,T,r){for(var I=[_];I.length>0;){var k=I.pop();Object.hasOwn(T,k)||(T[k]=!0,r.push(k),m(x(k),P=>I.push(P)))}}function m(_,x){for(var T=_.length;T--;)x(_[T],T,_);return _}return sw}var aw,xk;function IY(){if(xk)return aw;xk=1;var s=dL();aw=n;function n(c,m){return s(c,m,"post")}return aw}var lw,bk;function MY(){if(bk)return lw;bk=1;var s=dL();lw=n;function n(c,m){return s(c,m,"pre")}return lw}var cw,wk;function CY(){if(wk)return cw;wk=1;var s=gS(),n=lL();cw=c;function c(m,_){var x=new s,T={},r=new n,I;function k(R){var F=R.v===I?R.w:R.v,V=r.priority(F);if(V!==void 0){var W=_(R);W<V&&(T[F]=I,r.decrease(F,W))}}if(m.nodeCount()===0)return x;m.nodes().forEach(function(R){r.add(R,Number.POSITIVE_INFINITY),x.setNode(R)}),r.decrease(m.nodes()[0],0);for(var P=!1;r.size()>0;){if(I=r.removeMin(),Object.hasOwn(T,I))x.setEdge(I,T[I]);else{if(P)throw new Error("Input graph is not connected: "+m);P=!0}m.nodeEdges(I).forEach(k)}return x}return cw}var uw,Tk;function PY(){return Tk||(Tk=1,uw={components:wY(),dijkstra:cL(),dijkstraAll:TY(),findCycles:SY(),floydWarshall:EY(),isAcyclic:AY(),postorder:IY(),preorder:MY(),prim:CY(),tarjan:uL(),topsort:hL()}),uw}var hw,Sk;function xl(){if(Sk)return hw;Sk=1;var s=xY();return hw={Graph:s.Graph,json:bY(),alg:PY(),version:s.version},hw}var dw,Ek;function kY(){if(Ek)return dw;Ek=1;class s{constructor(){let _={};_._next=_._prev=_,this._sentinel=_}dequeue(){let _=this._sentinel,x=_._prev;if(x!==_)return n(x),x}enqueue(_){let x=this._sentinel;_._prev&&_._next&&n(_),_._next=x._next,x._next._prev=_,x._next=_,_._prev=x}toString(){let _=[],x=this._sentinel,T=x._prev;for(;T!==x;)_.push(JSON.stringify(T,c)),T=T._prev;return"["+_.join(", ")+"]"}}function n(m){m._prev._next=m._next,m._next._prev=m._prev,delete m._next,delete m._prev}function c(m,_){if(m!=="_next"&&m!=="_prev")return _}return dw=s,dw}var fw,Ak;function RY(){if(Ak)return fw;Ak=1;let s=xl().Graph,n=kY();fw=m;let c=()=>1;function m(k,P){if(k.nodeCount()<=1)return[];let R=T(k,P||c);return _(R.graph,R.buckets,R.zeroIdx).flatMap(V=>k.outEdges(V.v,V.w))}function _(k,P,R){let F=[],V=P[P.length-1],W=P[0],G;for(;k.nodeCount();){for(;G=W.dequeue();)x(k,P,R,G);for(;G=V.dequeue();)x(k,P,R,G);if(k.nodeCount()){for(let K=P.length-2;K>0;--K)if(G=P[K].dequeue(),G){F=F.concat(x(k,P,R,G,!0));break}}}return F}function x(k,P,R,F,V){let W=V?[]:void 0;return k.inEdges(F.v).forEach(G=>{let K=k.edge(G),Y=k.node(G.v);V&&W.push({v:G.v,w:G.w}),Y.out-=K,r(P,R,Y)}),k.outEdges(F.v).forEach(G=>{let K=k.edge(G),Y=G.w,ne=k.node(Y);ne.in-=K,r(P,R,ne)}),k.removeNode(F.v),W}function T(k,P){let R=new s,F=0,V=0;k.nodes().forEach(K=>{R.setNode(K,{v:K,in:0,out:0})}),k.edges().forEach(K=>{let Y=R.edge(K.v,K.w)||0,ne=P(K),oe=Y+ne;R.setEdge(K.v,K.w,oe),V=Math.max(V,R.node(K.v).out+=ne),F=Math.max(F,R.node(K.w).in+=ne)});let W=I(V+F+3).map(()=>new n),G=F+1;return R.nodes().forEach(K=>{r(W,G,R.node(K))}),{graph:R,buckets:W,zeroIdx:G}}function r(k,P,R){R.out?R.in?k[R.out-R.in+P].enqueue(R):k[k.length-1].enqueue(R):k[0].enqueue(R)}function I(k){const P=[];for(let R=0;R<k;R++)P.push(R);return P}return fw}var pw,Ik;function ts(){if(Ik)return pw;Ik=1;let s=xl().Graph;pw={addBorderNode:P,addDummyNode:n,applyWithChunking:V,asNonCompoundGraph:m,buildLayerMatrix:r,intersectRect:T,mapValues:ue,maxRank:W,normalizeRanks:I,notime:Y,partition:G,pick:me,predecessorWeights:x,range:ce,removeEmptyRanks:k,simplify:c,successorWeights:_,time:K,uniqueId:oe,zipObject:_e};function n(te,ie,xe,de){for(var Te=de;te.hasNode(Te);)Te=oe(de);return xe.dummy=ie,te.setNode(Te,xe),Te}function c(te){let ie=new s().setGraph(te.graph());return te.nodes().forEach(xe=>ie.setNode(xe,te.node(xe))),te.edges().forEach(xe=>{let de=ie.edge(xe.v,xe.w)||{weight:0,minlen:1},Te=te.edge(xe);ie.setEdge(xe.v,xe.w,{weight:de.weight+Te.weight,minlen:Math.max(de.minlen,Te.minlen)})}),ie}function m(te){let ie=new s({multigraph:te.isMultigraph()}).setGraph(te.graph());return te.nodes().forEach(xe=>{te.children(xe).length||ie.setNode(xe,te.node(xe))}),te.edges().forEach(xe=>{ie.setEdge(xe,te.edge(xe))}),ie}function _(te){let ie=te.nodes().map(xe=>{let de={};return te.outEdges(xe).forEach(Te=>{de[Te.w]=(de[Te.w]||0)+te.edge(Te).weight}),de});return _e(te.nodes(),ie)}function x(te){let ie=te.nodes().map(xe=>{let de={};return te.inEdges(xe).forEach(Te=>{de[Te.v]=(de[Te.v]||0)+te.edge(Te).weight}),de});return _e(te.nodes(),ie)}function T(te,ie){let xe=te.x,de=te.y,Te=ie.x-xe,De=ie.y-de,Be=te.width/2,Se=te.height/2;if(!Te&&!De)throw new Error("Not possible to find intersection inside of the rectangle");let Ne,it;return Math.abs(De)*Be>Math.abs(Te)*Se?(De<0&&(Se=-Se),Ne=Se*Te/De,it=Se):(Te<0&&(Be=-Be),Ne=Be,it=Be*De/Te),{x:xe+Ne,y:de+it}}function r(te){let ie=ce(W(te)+1).map(()=>[]);return te.nodes().forEach(xe=>{let de=te.node(xe),Te=de.rank;Te!==void 0&&(ie[Te][de.order]=xe)}),ie}function I(te){let ie=te.nodes().map(de=>{let Te=te.node(de).rank;return Te===void 0?Number.MAX_VALUE:Te}),xe=V(Math.min,ie);te.nodes().forEach(de=>{let Te=te.node(de);Object.hasOwn(Te,"rank")&&(Te.rank-=xe)})}function k(te){let ie=te.nodes().map(Be=>te.node(Be).rank),xe=V(Math.min,ie),de=[];te.nodes().forEach(Be=>{let Se=te.node(Be).rank-xe;de[Se]||(de[Se]=[]),de[Se].push(Be)});let Te=0,De=te.graph().nodeRankFactor;Array.from(de).forEach((Be,Se)=>{Be===void 0&&Se%De!==0?--Te:Be!==void 0&&Te&&Be.forEach(Ne=>te.node(Ne).rank+=Te)})}function P(te,ie,xe,de){let Te={width:0,height:0};return arguments.length>=4&&(Te.rank=xe,Te.order=de),n(te,"border",Te,ie)}function R(te,ie=F){const xe=[];for(let de=0;de<te.length;de+=ie){const Te=te.slice(de,de+ie);xe.push(Te)}return xe}const F=65535;function V(te,ie){if(ie.length>F){const xe=R(ie);return te.apply(null,xe.map(de=>te.apply(null,de)))}else return te.apply(null,ie)}function W(te){const xe=te.nodes().map(de=>{let Te=te.node(de).rank;return Te===void 0?Number.MIN_VALUE:Te});return V(Math.max,xe)}function G(te,ie){let xe={lhs:[],rhs:[]};return te.forEach(de=>{ie(de)?xe.lhs.push(de):xe.rhs.push(de)}),xe}function K(te,ie){let xe=Date.now();try{return ie()}finally{console.log(te+" time: "+(Date.now()-xe)+"ms")}}function Y(te,ie){return ie()}let ne=0;function oe(te){var ie=++ne;return te+(""+ie)}function ce(te,ie,xe=1){ie==null&&(ie=te,te=0);let de=De=>De<ie;xe<0&&(de=De=>ie<De);const Te=[];for(let De=te;de(De);De+=xe)Te.push(De);return Te}function me(te,ie){const xe={};for(const de of ie)te[de]!==void 0&&(xe[de]=te[de]);return xe}function ue(te,ie){let xe=ie;return typeof ie=="string"&&(xe=de=>de[ie]),Object.entries(te).reduce((de,[Te,De])=>(de[Te]=xe(De,Te),de),{})}function _e(te,ie){return te.reduce((xe,de,Te)=>(xe[de]=ie[Te],xe),{})}return pw}var mw,Mk;function zY(){if(Mk)return mw;Mk=1;let s=RY(),n=ts().uniqueId;mw={run:c,undo:_};function c(x){(x.graph().acyclicer==="greedy"?s(x,r(x)):m(x)).forEach(I=>{let k=x.edge(I);x.removeEdge(I),k.forwardName=I.name,k.reversed=!0,x.setEdge(I.w,I.v,k,n("rev"))});function r(I){return k=>I.edge(k).weight}}function m(x){let T=[],r={},I={};function k(P){Object.hasOwn(I,P)||(I[P]=!0,r[P]=!0,x.outEdges(P).forEach(R=>{Object.hasOwn(r,R.w)?T.push(R):k(R.w)}),delete r[P])}return x.nodes().forEach(k),T}function _(x){x.edges().forEach(T=>{let r=x.edge(T);if(r.reversed){x.removeEdge(T);let I=r.forwardName;delete r.reversed,delete r.forwardName,x.setEdge(T.w,T.v,r,I)}})}return mw}var gw,Ck;function DY(){if(Ck)return gw;Ck=1;let s=ts();gw={run:n,undo:m};function n(_){_.graph().dummyChains=[],_.edges().forEach(x=>c(_,x))}function c(_,x){let T=x.v,r=_.node(T).rank,I=x.w,k=_.node(I).rank,P=x.name,R=_.edge(x),F=R.labelRank;if(k===r+1)return;_.removeEdge(x);let V,W,G;for(G=0,++r;r<k;++G,++r)R.points=[],W={width:0,height:0,edgeLabel:R,edgeObj:x,rank:r},V=s.addDummyNode(_,"edge",W,"_d"),r===F&&(W.width=R.width,W.height=R.height,W.dummy="edge-label",W.labelpos=R.labelpos),_.setEdge(T,V,{weight:R.weight},P),G===0&&_.graph().dummyChains.push(V),T=V;_.setEdge(T,I,{weight:R.weight},P)}function m(_){_.graph().dummyChains.forEach(x=>{let T=_.node(x),r=T.edgeLabel,I;for(_.setEdge(T.edgeObj,r);T.dummy;)I=_.successors(x)[0],_.removeNode(x),r.points.push({x:T.x,y:T.y}),T.dummy==="edge-label"&&(r.x=T.x,r.y=T.y,r.width=T.width,r.height=T.height),x=I,T=_.node(x)})}return gw}var _w,Pk;function Y0(){if(Pk)return _w;Pk=1;const{applyWithChunking:s}=ts();_w={longestPath:n,slack:c};function n(m){var _={};function x(T){var r=m.node(T);if(Object.hasOwn(_,T))return r.rank;_[T]=!0;let I=m.outEdges(T).map(P=>P==null?Number.POSITIVE_INFINITY:x(P.w)-m.edge(P).minlen);var k=s(Math.min,I);return k===Number.POSITIVE_INFINITY&&(k=0),r.rank=k}m.sources().forEach(x)}function c(m,_){return m.node(_.w).rank-m.node(_.v).rank-m.edge(_).minlen}return _w}var yw,kk;function fL(){if(kk)return yw;kk=1;var s=xl().Graph,n=Y0().slack;yw=c;function c(T){var r=new s({directed:!1}),I=T.nodes()[0],k=T.nodeCount();r.setNode(I,{});for(var P,R;m(r,T)<k;)P=_(r,T),R=r.hasNode(P.v)?n(T,P):-n(T,P),x(r,T,R);return r}function m(T,r){function I(k){r.nodeEdges(k).forEach(P=>{var R=P.v,F=k===R?P.w:R;!T.hasNode(F)&&!n(r,P)&&(T.setNode(F,{}),T.setEdge(k,F,{}),I(F))})}return T.nodes().forEach(I),T.nodeCount()}function _(T,r){return r.edges().reduce((k,P)=>{let R=Number.POSITIVE_INFINITY;return T.hasNode(P.v)!==T.hasNode(P.w)&&(R=n(r,P)),R<k[0]?[R,P]:k},[Number.POSITIVE_INFINITY,null])[1]}function x(T,r,I){T.nodes().forEach(k=>r.node(k).rank+=I)}return yw}var vw,Rk;function LY(){if(Rk)return vw;Rk=1;var s=fL(),n=Y0().slack,c=Y0().longestPath,m=xl().alg.preorder,_=xl().alg.postorder,x=ts().simplify;vw=T,T.initLowLimValues=P,T.initCutValues=r,T.calcCutValue=k,T.leaveEdge=F,T.enterEdge=V,T.exchangeEdges=W;function T(ne){ne=x(ne),c(ne);var oe=s(ne);P(oe),r(oe,ne);for(var ce,me;ce=F(oe);)me=V(oe,ne,ce),W(oe,ne,ce,me)}function r(ne,oe){var ce=_(ne,ne.nodes());ce=ce.slice(0,ce.length-1),ce.forEach(me=>I(ne,oe,me))}function I(ne,oe,ce){var me=ne.node(ce),ue=me.parent;ne.edge(ce,ue).cutvalue=k(ne,oe,ce)}function k(ne,oe,ce){var me=ne.node(ce),ue=me.parent,_e=!0,te=oe.edge(ce,ue),ie=0;return te||(_e=!1,te=oe.edge(ue,ce)),ie=te.weight,oe.nodeEdges(ce).forEach(xe=>{var de=xe.v===ce,Te=de?xe.w:xe.v;if(Te!==ue){var De=de===_e,Be=oe.edge(xe).weight;if(ie+=De?Be:-Be,K(ne,ce,Te)){var Se=ne.edge(ce,Te).cutvalue;ie+=De?-Se:Se}}}),ie}function P(ne,oe){arguments.length<2&&(oe=ne.nodes()[0]),R(ne,{},1,oe)}function R(ne,oe,ce,me,ue){var _e=ce,te=ne.node(me);return oe[me]=!0,ne.neighbors(me).forEach(ie=>{Object.hasOwn(oe,ie)||(ce=R(ne,oe,ce,ie,me))}),te.low=_e,te.lim=ce++,ue?te.parent=ue:delete te.parent,ce}function F(ne){return ne.edges().find(oe=>ne.edge(oe).cutvalue<0)}function V(ne,oe,ce){var me=ce.v,ue=ce.w;oe.hasEdge(me,ue)||(me=ce.w,ue=ce.v);var _e=ne.node(me),te=ne.node(ue),ie=_e,xe=!1;_e.lim>te.lim&&(ie=te,xe=!0);var de=oe.edges().filter(Te=>xe===Y(ne,ne.node(Te.v),ie)&&xe!==Y(ne,ne.node(Te.w),ie));return de.reduce((Te,De)=>n(oe,De)<n(oe,Te)?De:Te)}function W(ne,oe,ce,me){var ue=ce.v,_e=ce.w;ne.removeEdge(ue,_e),ne.setEdge(me.v,me.w,{}),P(ne),r(ne,oe),G(ne,oe)}function G(ne,oe){var ce=ne.nodes().find(ue=>!oe.node(ue).parent),me=m(ne,ce);me=me.slice(1),me.forEach(ue=>{var _e=ne.node(ue).parent,te=oe.edge(ue,_e),ie=!1;te||(te=oe.edge(_e,ue),ie=!0),oe.node(ue).rank=oe.node(_e).rank+(ie?te.minlen:-te.minlen)})}function K(ne,oe,ce){return ne.hasEdge(oe,ce)}function Y(ne,oe,ce){return ce.low<=oe.lim&&oe.lim<=ce.lim}return vw}var xw,zk;function OY(){if(zk)return xw;zk=1;var s=Y0(),n=s.longestPath,c=fL(),m=LY();xw=_;function _(I){var k=I.graph().ranker;if(k instanceof Function)return k(I);switch(I.graph().ranker){case"network-simplex":r(I);break;case"tight-tree":T(I);break;case"longest-path":x(I);break;case"none":break;default:r(I)}}var x=n;function T(I){n(I),c(I)}function r(I){m(I)}return xw}var bw,Dk;function FY(){if(Dk)return bw;Dk=1,bw=s;function s(m){let _=c(m);m.graph().dummyChains.forEach(x=>{let T=m.node(x),r=T.edgeObj,I=n(m,_,r.v,r.w),k=I.path,P=I.lca,R=0,F=k[R],V=!0;for(;x!==r.w;){if(T=m.node(x),V){for(;(F=k[R])!==P&&m.node(F).maxRank<T.rank;)R++;F===P&&(V=!1)}if(!V){for(;R<k.length-1&&m.node(F=k[R+1]).minRank<=T.rank;)R++;F=k[R]}m.setParent(x,F),x=m.successors(x)[0]}})}function n(m,_,x,T){let r=[],I=[],k=Math.min(_[x].low,_[T].low),P=Math.max(_[x].lim,_[T].lim),R,F;R=x;do R=m.parent(R),r.push(R);while(R&&(_[R].low>k||P>_[R].lim));for(F=R,R=T;(R=m.parent(R))!==F;)I.push(R);return{path:r.concat(I.reverse()),lca:F}}function c(m){let _={},x=0;function T(r){let I=x;m.children(r).forEach(T),_[r]={low:I,lim:x++}}return m.children().forEach(T),_}return bw}var ww,Lk;function BY(){if(Lk)return ww;Lk=1;let s=ts();ww={run:n,cleanup:x};function n(T){let r=s.addDummyNode(T,"root",{},"_root"),I=m(T),k=Object.values(I),P=s.applyWithChunking(Math.max,k)-1,R=2*P+1;T.graph().nestingRoot=r,T.edges().forEach(V=>T.edge(V).minlen*=R);let F=_(T)+1;T.children().forEach(V=>c(T,r,R,F,P,I,V)),T.graph().nodeRankFactor=R}function c(T,r,I,k,P,R,F){let V=T.children(F);if(!V.length){F!==r&&T.setEdge(r,F,{weight:0,minlen:I});return}let W=s.addBorderNode(T,"_bt"),G=s.addBorderNode(T,"_bb"),K=T.node(F);T.setParent(W,F),K.borderTop=W,T.setParent(G,F),K.borderBottom=G,V.forEach(Y=>{c(T,r,I,k,P,R,Y);let ne=T.node(Y),oe=ne.borderTop?ne.borderTop:Y,ce=ne.borderBottom?ne.borderBottom:Y,me=ne.borderTop?k:2*k,ue=oe!==ce?1:P-R[F]+1;T.setEdge(W,oe,{weight:me,minlen:ue,nestingEdge:!0}),T.setEdge(ce,G,{weight:me,minlen:ue,nestingEdge:!0})}),T.parent(F)||T.setEdge(r,W,{weight:0,minlen:P+R[F]})}function m(T){var r={};function I(k,P){var R=T.children(k);R&&R.length&&R.forEach(F=>I(F,P+1)),r[k]=P}return T.children().forEach(k=>I(k,1)),r}function _(T){return T.edges().reduce((r,I)=>r+T.edge(I).weight,0)}function x(T){var r=T.graph();T.removeNode(r.nestingRoot),delete r.nestingRoot,T.edges().forEach(I=>{var k=T.edge(I);k.nestingEdge&&T.removeEdge(I)})}return ww}var Tw,Ok;function NY(){if(Ok)return Tw;Ok=1;let s=ts();Tw=n;function n(m){function _(x){let T=m.children(x),r=m.node(x);if(T.length&&T.forEach(_),Object.hasOwn(r,"minRank")){r.borderLeft=[],r.borderRight=[];for(let I=r.minRank,k=r.maxRank+1;I<k;++I)c(m,"borderLeft","_bl",x,r,I),c(m,"borderRight","_br",x,r,I)}}m.children().forEach(_)}function c(m,_,x,T,r,I){let k={width:0,height:0,rank:I,borderType:_},P=r[_][I-1],R=s.addDummyNode(m,"border",k,x);r[_][I]=R,m.setParent(R,T),P&&m.setEdge(P,R,{weight:1})}return Tw}var Sw,Fk;function VY(){if(Fk)return Sw;Fk=1,Sw={adjust:s,undo:n};function s(I){let k=I.graph().rankdir.toLowerCase();(k==="lr"||k==="rl")&&c(I)}function n(I){let k=I.graph().rankdir.toLowerCase();(k==="bt"||k==="rl")&&_(I),(k==="lr"||k==="rl")&&(T(I),c(I))}function c(I){I.nodes().forEach(k=>m(I.node(k))),I.edges().forEach(k=>m(I.edge(k)))}function m(I){let k=I.width;I.width=I.height,I.height=k}function _(I){I.nodes().forEach(k=>x(I.node(k))),I.edges().forEach(k=>{let P=I.edge(k);P.points.forEach(x),Object.hasOwn(P,"y")&&x(P)})}function x(I){I.y=-I.y}function T(I){I.nodes().forEach(k=>r(I.node(k))),I.edges().forEach(k=>{let P=I.edge(k);P.points.forEach(r),Object.hasOwn(P,"x")&&r(P)})}function r(I){let k=I.x;I.x=I.y,I.y=k}return Sw}var Ew,Bk;function UY(){if(Bk)return Ew;Bk=1;let s=ts();Ew=n;function n(c){let m={},_=c.nodes().filter(P=>!c.children(P).length),x=_.map(P=>c.node(P).rank),T=s.applyWithChunking(Math.max,x),r=s.range(T+1).map(()=>[]);function I(P){if(m[P])return;m[P]=!0;let R=c.node(P);r[R.rank].push(P),c.successors(P).forEach(I)}return _.sort((P,R)=>c.node(P).rank-c.node(R).rank).forEach(I),r}return Ew}var Aw,Nk;function jY(){if(Nk)return Aw;Nk=1;let s=ts().zipObject;Aw=n;function n(m,_){let x=0;for(let T=1;T<_.length;++T)x+=c(m,_[T-1],_[T]);return x}function c(m,_,x){let T=s(x,x.map((F,V)=>V)),r=_.flatMap(F=>m.outEdges(F).map(V=>({pos:T[V.w],weight:m.edge(V).weight})).sort((V,W)=>V.pos-W.pos)),I=1;for(;I<x.length;)I<<=1;let k=2*I-1;I-=1;let P=new Array(k).fill(0),R=0;return r.forEach(F=>{let V=F.pos+I;P[V]+=F.weight;let W=0;for(;V>0;)V%2&&(W+=P[V+1]),V=V-1>>1,P[V]+=F.weight;R+=F.weight*W}),R}return Aw}var Iw,Vk;function GY(){if(Vk)return Iw;Vk=1,Iw=s;function s(n,c=[]){return c.map(m=>{let _=n.inEdges(m);if(_.length){let x=_.reduce((T,r)=>{let I=n.edge(r),k=n.node(r.v);return{sum:T.sum+I.weight*k.order,weight:T.weight+I.weight}},{sum:0,weight:0});return{v:m,barycenter:x.sum/x.weight,weight:x.weight}}else return{v:m}})}return Iw}var Mw,Uk;function WY(){if(Uk)return Mw;Uk=1;let s=ts();Mw=n;function n(_,x){let T={};_.forEach((I,k)=>{let P=T[I.v]={indegree:0,in:[],out:[],vs:[I.v],i:k};I.barycenter!==void 0&&(P.barycenter=I.barycenter,P.weight=I.weight)}),x.edges().forEach(I=>{let k=T[I.v],P=T[I.w];k!==void 0&&P!==void 0&&(P.indegree++,k.out.push(T[I.w]))});let r=Object.values(T).filter(I=>!I.indegree);return c(r)}function c(_){let x=[];function T(I){return k=>{k.merged||(k.barycenter===void 0||I.barycenter===void 0||k.barycenter>=I.barycenter)&&m(I,k)}}function r(I){return k=>{k.in.push(I),--k.indegree===0&&_.push(k)}}for(;_.length;){let I=_.pop();x.push(I),I.in.reverse().forEach(T(I)),I.out.forEach(r(I))}return x.filter(I=>!I.merged).map(I=>s.pick(I,["vs","i","barycenter","weight"]))}function m(_,x){let T=0,r=0;_.weight&&(T+=_.barycenter*_.weight,r+=_.weight),x.weight&&(T+=x.barycenter*x.weight,r+=x.weight),_.vs=x.vs.concat(_.vs),_.barycenter=T/r,_.weight=r,_.i=Math.min(x.i,_.i),x.merged=!0}return Mw}var Cw,jk;function qY(){if(jk)return Cw;jk=1;let s=ts();Cw=n;function n(_,x){let T=s.partition(_,W=>Object.hasOwn(W,"barycenter")),r=T.lhs,I=T.rhs.sort((W,G)=>G.i-W.i),k=[],P=0,R=0,F=0;r.sort(m(!!x)),F=c(k,I,F),r.forEach(W=>{F+=W.vs.length,k.push(W.vs),P+=W.barycenter*W.weight,R+=W.weight,F=c(k,I,F)});let V={vs:k.flat(!0)};return R&&(V.barycenter=P/R,V.weight=R),V}function c(_,x,T){let r;for(;x.length&&(r=x[x.length-1]).i<=T;)x.pop(),_.push(r.vs),T++;return T}function m(_){return(x,T)=>x.barycenter<T.barycenter?-1:x.barycenter>T.barycenter?1:_?T.i-x.i:x.i-T.i}return Cw}var Pw,Gk;function HY(){if(Gk)return Pw;Gk=1;let s=GY(),n=WY(),c=qY();Pw=m;function m(T,r,I,k){let P=T.children(r),R=T.node(r),F=R?R.borderLeft:void 0,V=R?R.borderRight:void 0,W={};F&&(P=P.filter(ne=>ne!==F&&ne!==V));let G=s(T,P);G.forEach(ne=>{if(T.children(ne.v).length){let oe=m(T,ne.v,I,k);W[ne.v]=oe,Object.hasOwn(oe,"barycenter")&&x(ne,oe)}});let K=n(G,I);_(K,W);let Y=c(K,k);if(F&&(Y.vs=[F,Y.vs,V].flat(!0),T.predecessors(F).length)){let ne=T.node(T.predecessors(F)[0]),oe=T.node(T.predecessors(V)[0]);Object.hasOwn(Y,"barycenter")||(Y.barycenter=0,Y.weight=0),Y.barycenter=(Y.barycenter*Y.weight+ne.order+oe.order)/(Y.weight+2),Y.weight+=2}return Y}function _(T,r){T.forEach(I=>{I.vs=I.vs.flatMap(k=>r[k]?r[k].vs:k)})}function x(T,r){T.barycenter!==void 0?(T.barycenter=(T.barycenter*T.weight+r.barycenter*r.weight)/(T.weight+r.weight),T.weight+=r.weight):(T.barycenter=r.barycenter,T.weight=r.weight)}return Pw}var kw,Wk;function ZY(){if(Wk)return kw;Wk=1;let s=xl().Graph,n=ts();kw=c;function c(_,x,T){let r=m(_),I=new s({compound:!0}).setGraph({root:r}).setDefaultNodeLabel(k=>_.node(k));return _.nodes().forEach(k=>{let P=_.node(k),R=_.parent(k);(P.rank===x||P.minRank<=x&&x<=P.maxRank)&&(I.setNode(k),I.setParent(k,R||r),_[T](k).forEach(F=>{let V=F.v===k?F.w:F.v,W=I.edge(V,k),G=W!==void 0?W.weight:0;I.setEdge(V,k,{weight:_.edge(F).weight+G})}),Object.hasOwn(P,"minRank")&&I.setNode(k,{borderLeft:P.borderLeft[x],borderRight:P.borderRight[x]}))}),I}function m(_){for(var x;_.hasNode(x=n.uniqueId("_root")););return x}return kw}var Rw,qk;function XY(){if(qk)return Rw;qk=1,Rw=s;function s(n,c,m){let _={},x;m.forEach(T=>{let r=n.parent(T),I,k;for(;r;){if(I=n.parent(r),I?(k=_[I],_[I]=r):(k=x,x=r),k&&k!==r){c.setEdge(k,r);return}r=I}})}return Rw}var zw,Hk;function YY(){if(Hk)return zw;Hk=1;let s=UY(),n=jY(),c=HY(),m=ZY(),_=XY(),x=xl().Graph,T=ts();zw=r;function r(R,F){if(F&&typeof F.customOrder=="function"){F.customOrder(R,r);return}let V=T.maxRank(R),W=I(R,T.range(1,V+1),"inEdges"),G=I(R,T.range(V-1,-1,-1),"outEdges"),K=s(R);if(P(R,K),F&&F.disableOptimalOrderHeuristic)return;let Y=Number.POSITIVE_INFINITY,ne;for(let oe=0,ce=0;ce<4;++oe,++ce){k(oe%2?W:G,oe%4>=2),K=T.buildLayerMatrix(R);let me=n(R,K);me<Y&&(ce=0,ne=Object.assign({},K),Y=me)}P(R,ne)}function I(R,F,V){return F.map(function(W){return m(R,W,V)})}function k(R,F){let V=new x;R.forEach(function(W){let G=W.graph().root,K=c(W,G,V,F);K.vs.forEach((Y,ne)=>W.node(Y).order=ne),_(W,V,K.vs)})}function P(R,F){Object.values(F).forEach(V=>V.forEach((W,G)=>R.node(W).order=G))}return zw}var Dw,Zk;function KY(){if(Zk)return Dw;Zk=1;let s=xl().Graph,n=ts();Dw={positionX:V,findType1Conflicts:c,findType2Conflicts:m,addConflict:x,hasConflict:T,verticalAlignment:r,horizontalCompaction:I,alignCoordinates:R,findSmallestWidthAlignment:P,balance:F};function c(K,Y){let ne={};function oe(ce,me){let ue=0,_e=0,te=ce.length,ie=me[me.length-1];return me.forEach((xe,de)=>{let Te=_(K,xe),De=Te?K.node(Te).order:te;(Te||xe===ie)&&(me.slice(_e,de+1).forEach(Be=>{K.predecessors(Be).forEach(Se=>{let Ne=K.node(Se),it=Ne.order;(it<ue||De<it)&&!(Ne.dummy&&K.node(Be).dummy)&&x(ne,Se,Be)})}),_e=de+1,ue=De)}),me}return Y.length&&Y.reduce(oe),ne}function m(K,Y){let ne={};function oe(me,ue,_e,te,ie){let xe;n.range(ue,_e).forEach(de=>{xe=me[de],K.node(xe).dummy&&K.predecessors(xe).forEach(Te=>{let De=K.node(Te);De.dummy&&(De.order<te||De.order>ie)&&x(ne,Te,xe)})})}function ce(me,ue){let _e=-1,te,ie=0;return ue.forEach((xe,de)=>{if(K.node(xe).dummy==="border"){let Te=K.predecessors(xe);Te.length&&(te=K.node(Te[0]).order,oe(ue,ie,de,_e,te),ie=de,_e=te)}oe(ue,ie,ue.length,te,me.length)}),ue}return Y.length&&Y.reduce(ce),ne}function _(K,Y){if(K.node(Y).dummy)return K.predecessors(Y).find(ne=>K.node(ne).dummy)}function x(K,Y,ne){if(Y>ne){let ce=Y;Y=ne,ne=ce}let oe=K[Y];oe||(K[Y]=oe={}),oe[ne]=!0}function T(K,Y,ne){if(Y>ne){let oe=Y;Y=ne,ne=oe}return!!K[Y]&&Object.hasOwn(K[Y],ne)}function r(K,Y,ne,oe){let ce={},me={},ue={};return Y.forEach(_e=>{_e.forEach((te,ie)=>{ce[te]=te,me[te]=te,ue[te]=ie})}),Y.forEach(_e=>{let te=-1;_e.forEach(ie=>{let xe=oe(ie);if(xe.length){xe=xe.sort((Te,De)=>ue[Te]-ue[De]);let de=(xe.length-1)/2;for(let Te=Math.floor(de),De=Math.ceil(de);Te<=De;++Te){let Be=xe[Te];me[ie]===ie&&te<ue[Be]&&!T(ne,ie,Be)&&(me[Be]=ie,me[ie]=ce[ie]=ce[Be],te=ue[Be])}}})}),{root:ce,align:me}}function I(K,Y,ne,oe,ce){let me={},ue=k(K,Y,ne,ce),_e=ce?"borderLeft":"borderRight";function te(de,Te){let De=ue.nodes(),Be=De.pop(),Se={};for(;Be;)Se[Be]?de(Be):(Se[Be]=!0,De.push(Be),De=De.concat(Te(Be))),Be=De.pop()}function ie(de){me[de]=ue.inEdges(de).reduce((Te,De)=>Math.max(Te,me[De.v]+ue.edge(De)),0)}function xe(de){let Te=ue.outEdges(de).reduce((Be,Se)=>Math.min(Be,me[Se.w]-ue.edge(Se)),Number.POSITIVE_INFINITY),De=K.node(de);Te!==Number.POSITIVE_INFINITY&&De.borderType!==_e&&(me[de]=Math.max(me[de],Te))}return te(ie,ue.predecessors.bind(ue)),te(xe,ue.successors.bind(ue)),Object.keys(oe).forEach(de=>me[de]=me[ne[de]]),me}function k(K,Y,ne,oe){let ce=new s,me=K.graph(),ue=W(me.nodesep,me.edgesep,oe);return Y.forEach(_e=>{let te;_e.forEach(ie=>{let xe=ne[ie];if(ce.setNode(xe),te){var de=ne[te],Te=ce.edge(de,xe);ce.setEdge(de,xe,Math.max(ue(K,ie,te),Te||0))}te=ie})}),ce}function P(K,Y){return Object.values(Y).reduce((ne,oe)=>{let ce=Number.NEGATIVE_INFINITY,me=Number.POSITIVE_INFINITY;Object.entries(oe).forEach(([_e,te])=>{let ie=G(K,_e)/2;ce=Math.max(te+ie,ce),me=Math.min(te-ie,me)});const ue=ce-me;return ue<ne[0]&&(ne=[ue,oe]),ne},[Number.POSITIVE_INFINITY,null])[1]}function R(K,Y){let ne=Object.values(Y),oe=n.applyWithChunking(Math.min,ne),ce=n.applyWithChunking(Math.max,ne);["u","d"].forEach(me=>{["l","r"].forEach(ue=>{let _e=me+ue,te=K[_e];if(te===Y)return;let ie=Object.values(te),xe=oe-n.applyWithChunking(Math.min,ie);ue!=="l"&&(xe=ce-n.applyWithChunking(Math.max,ie)),xe&&(K[_e]=n.mapValues(te,de=>de+xe))})})}function F(K,Y){return n.mapValues(K.ul,(ne,oe)=>{if(Y)return K[Y.toLowerCase()][oe];{let ce=Object.values(K).map(me=>me[oe]).sort((me,ue)=>me-ue);return(ce[1]+ce[2])/2}})}function V(K){let Y=n.buildLayerMatrix(K),ne=Object.assign(c(K,Y),m(K,Y)),oe={},ce;["u","d"].forEach(ue=>{ce=ue==="u"?Y:Object.values(Y).reverse(),["l","r"].forEach(_e=>{_e==="r"&&(ce=ce.map(de=>Object.values(de).reverse()));let te=(ue==="u"?K.predecessors:K.successors).bind(K),ie=r(K,ce,ne,te),xe=I(K,ce,ie.root,ie.align,_e==="r");_e==="r"&&(xe=n.mapValues(xe,de=>-de)),oe[ue+_e]=xe})});let me=P(K,oe);return R(oe,me),F(oe,K.graph().align)}function W(K,Y,ne){return(oe,ce,me)=>{let ue=oe.node(ce),_e=oe.node(me),te=0,ie;if(te+=ue.width/2,Object.hasOwn(ue,"labelpos"))switch(ue.labelpos.toLowerCase()){case"l":ie=-ue.width/2;break;case"r":ie=ue.width/2;break}if(ie&&(te+=ne?ie:-ie),ie=0,te+=(ue.dummy?Y:K)/2,te+=(_e.dummy?Y:K)/2,te+=_e.width/2,Object.hasOwn(_e,"labelpos"))switch(_e.labelpos.toLowerCase()){case"l":ie=_e.width/2;break;case"r":ie=-_e.width/2;break}return ie&&(te+=ne?ie:-ie),ie=0,te}}function G(K,Y){return K.node(Y).width}return Dw}var Lw,Xk;function JY(){if(Xk)return Lw;Xk=1;let s=ts(),n=KY().positionX;Lw=c;function c(_){_=s.asNonCompoundGraph(_),m(_),Object.entries(n(_)).forEach(([x,T])=>_.node(x).x=T)}function m(_){let x=s.buildLayerMatrix(_),T=_.graph().ranksep,r=0;x.forEach(I=>{const k=I.reduce((P,R)=>{const F=_.node(R).height;return P>F?P:F},0);I.forEach(P=>_.node(P).y=r+k/2),r+=k+T})}return Lw}var Ow,Yk;function QY(){if(Yk)return Ow;Yk=1;let s=zY(),n=DY(),c=OY(),m=ts().normalizeRanks,_=FY(),x=ts().removeEmptyRanks,T=BY(),r=NY(),I=VY(),k=YY(),P=JY(),R=ts(),F=xl().Graph;Ow=V;function V(et,Qe){let st=Qe&&Qe.debugTiming?R.time:R.notime;st("layout",()=>{let tt=st("  buildLayoutGraph",()=>te(et));st("  runLayout",()=>W(tt,st,Qe)),st("  updateInputGraph",()=>G(et,tt))})}function W(et,Qe,st){Qe("    makeSpaceForEdgeLabels",()=>ie(et)),Qe("    removeSelfEdges",()=>qe(et)),Qe("    acyclic",()=>s.run(et)),Qe("    nestingGraph.run",()=>T.run(et)),Qe("    rank",()=>c(R.asNonCompoundGraph(et))),Qe("    injectEdgeLabelProxies",()=>xe(et)),Qe("    removeEmptyRanks",()=>x(et)),Qe("    nestingGraph.cleanup",()=>T.cleanup(et)),Qe("    normalizeRanks",()=>m(et)),Qe("    assignRankMinMax",()=>de(et)),Qe("    removeEdgeLabelProxies",()=>Te(et)),Qe("    normalize.run",()=>n.run(et)),Qe("    parentDummyChains",()=>_(et)),Qe("    addBorderSegments",()=>r(et)),Qe("    order",()=>k(et,st)),Qe("    insertSelfEdges",()=>ft(et)),Qe("    adjustCoordinateSystem",()=>I.adjust(et)),Qe("    position",()=>P(et)),Qe("    positionSelfEdges",()=>St(et)),Qe("    removeBorderNodes",()=>it(et)),Qe("    normalize.undo",()=>n.undo(et)),Qe("    fixupEdgeLabelCoords",()=>Se(et)),Qe("    undoCoordinateSystem",()=>I.undo(et)),Qe("    translateGraph",()=>De(et)),Qe("    assignNodeIntersects",()=>Be(et)),Qe("    reversePoints",()=>Ne(et)),Qe("    acyclic.undo",()=>s.undo(et))}function G(et,Qe){et.nodes().forEach(st=>{let tt=et.node(st),gt=Qe.node(st);tt&&(tt.x=gt.x,tt.y=gt.y,tt.rank=gt.rank,Qe.children(st).length&&(tt.width=gt.width,tt.height=gt.height))}),et.edges().forEach(st=>{let tt=et.edge(st),gt=Qe.edge(st);tt.points=gt.points,Object.hasOwn(gt,"x")&&(tt.x=gt.x,tt.y=gt.y)}),et.graph().width=Qe.graph().width,et.graph().height=Qe.graph().height}let K=["nodesep","edgesep","ranksep","marginx","marginy"],Y={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},ne=["acyclicer","ranker","rankdir","align"],oe=["width","height","rank"],ce={width:0,height:0},me=["minlen","weight","width","height","labeloffset"],ue={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},_e=["labelpos"];function te(et){let Qe=new F({multigraph:!0,compound:!0}),st=Kt(et.graph());return Qe.setGraph(Object.assign({},Y,Dt(st,K),R.pick(st,ne))),et.nodes().forEach(tt=>{let gt=Kt(et.node(tt));const Lt=Dt(gt,oe);Object.keys(ce).forEach(_t=>{Lt[_t]===void 0&&(Lt[_t]=ce[_t])}),Qe.setNode(tt,Lt),Qe.setParent(tt,et.parent(tt))}),et.edges().forEach(tt=>{let gt=Kt(et.edge(tt));Qe.setEdge(tt,Object.assign({},ue,Dt(gt,me),R.pick(gt,_e)))}),Qe}function ie(et){let Qe=et.graph();Qe.ranksep/=2,et.edges().forEach(st=>{let tt=et.edge(st);tt.minlen*=2,tt.labelpos.toLowerCase()!=="c"&&(Qe.rankdir==="TB"||Qe.rankdir==="BT"?tt.width+=tt.labeloffset:tt.height+=tt.labeloffset)})}function xe(et){et.edges().forEach(Qe=>{let st=et.edge(Qe);if(st.width&&st.height){let tt=et.node(Qe.v),Lt={rank:(et.node(Qe.w).rank-tt.rank)/2+tt.rank,e:Qe};R.addDummyNode(et,"edge-proxy",Lt,"_ep")}})}function de(et){let Qe=0;et.nodes().forEach(st=>{let tt=et.node(st);tt.borderTop&&(tt.minRank=et.node(tt.borderTop).rank,tt.maxRank=et.node(tt.borderBottom).rank,Qe=Math.max(Qe,tt.maxRank))}),et.graph().maxRank=Qe}function Te(et){et.nodes().forEach(Qe=>{let st=et.node(Qe);st.dummy==="edge-proxy"&&(et.edge(st.e).labelRank=st.rank,et.removeNode(Qe))})}function De(et){let Qe=Number.POSITIVE_INFINITY,st=0,tt=Number.POSITIVE_INFINITY,gt=0,Lt=et.graph(),_t=Lt.marginx||0,Je=Lt.marginy||0;function Rt(ut){let cn=ut.x,on=ut.y,Jt=ut.width,vt=ut.height;Qe=Math.min(Qe,cn-Jt/2),st=Math.max(st,cn+Jt/2),tt=Math.min(tt,on-vt/2),gt=Math.max(gt,on+vt/2)}et.nodes().forEach(ut=>Rt(et.node(ut))),et.edges().forEach(ut=>{let cn=et.edge(ut);Object.hasOwn(cn,"x")&&Rt(cn)}),Qe-=_t,tt-=Je,et.nodes().forEach(ut=>{let cn=et.node(ut);cn.x-=Qe,cn.y-=tt}),et.edges().forEach(ut=>{let cn=et.edge(ut);cn.points.forEach(on=>{on.x-=Qe,on.y-=tt}),Object.hasOwn(cn,"x")&&(cn.x-=Qe),Object.hasOwn(cn,"y")&&(cn.y-=tt)}),Lt.width=st-Qe+_t,Lt.height=gt-tt+Je}function Be(et){et.edges().forEach(Qe=>{let st=et.edge(Qe),tt=et.node(Qe.v),gt=et.node(Qe.w),Lt,_t;st.points?(Lt=st.points[0],_t=st.points[st.points.length-1]):(st.points=[],Lt=gt,_t=tt),st.points.unshift(R.intersectRect(tt,Lt)),st.points.push(R.intersectRect(gt,_t))})}function Se(et){et.edges().forEach(Qe=>{let st=et.edge(Qe);if(Object.hasOwn(st,"x"))switch((st.labelpos==="l"||st.labelpos==="r")&&(st.width-=st.labeloffset),st.labelpos){case"l":st.x-=st.width/2+st.labeloffset;break;case"r":st.x+=st.width/2+st.labeloffset;break}})}function Ne(et){et.edges().forEach(Qe=>{let st=et.edge(Qe);st.reversed&&st.points.reverse()})}function it(et){et.nodes().forEach(Qe=>{if(et.children(Qe).length){let st=et.node(Qe),tt=et.node(st.borderTop),gt=et.node(st.borderBottom),Lt=et.node(st.borderLeft[st.borderLeft.length-1]),_t=et.node(st.borderRight[st.borderRight.length-1]);st.width=Math.abs(_t.x-Lt.x),st.height=Math.abs(gt.y-tt.y),st.x=Lt.x+st.width/2,st.y=tt.y+st.height/2}}),et.nodes().forEach(Qe=>{et.node(Qe).dummy==="border"&&et.removeNode(Qe)})}function qe(et){et.edges().forEach(Qe=>{if(Qe.v===Qe.w){var st=et.node(Qe.v);st.selfEdges||(st.selfEdges=[]),st.selfEdges.push({e:Qe,label:et.edge(Qe)}),et.removeEdge(Qe)}})}function ft(et){var Qe=R.buildLayerMatrix(et);Qe.forEach(st=>{var tt=0;st.forEach((gt,Lt)=>{var _t=et.node(gt);_t.order=Lt+tt,(_t.selfEdges||[]).forEach(Je=>{R.addDummyNode(et,"selfedge",{width:Je.label.width,height:Je.label.height,rank:_t.rank,order:Lt+ ++tt,e:Je.e,label:Je.label},"_se")}),delete _t.selfEdges})})}function St(et){et.nodes().forEach(Qe=>{var st=et.node(Qe);if(st.dummy==="selfedge"){var tt=et.node(st.e.v),gt=tt.x+tt.width/2,Lt=tt.y,_t=st.x-gt,Je=tt.height/2;et.setEdge(st.e,st.label),et.removeNode(Qe),st.label.points=[{x:gt+2*_t/3,y:Lt-Je},{x:gt+5*_t/6,y:Lt-Je},{x:gt+_t,y:Lt},{x:gt+5*_t/6,y:Lt+Je},{x:gt+2*_t/3,y:Lt+Je}],st.label.x=st.x,st.label.y=st.y}})}function Dt(et,Qe){return R.mapValues(R.pick(et,Qe),Number)}function Kt(et){var Qe={};return et&&Object.entries(et).forEach(([st,tt])=>{typeof st=="string"&&(st=st.toLowerCase()),Qe[st]=tt}),Qe}return Ow}var Fw,Kk;function $Y(){if(Kk)return Fw;Kk=1;let s=ts(),n=xl().Graph;Fw={debugOrdering:c};function c(m){let _=s.buildLayerMatrix(m),x=new n({compound:!0,multigraph:!0}).setGraph({});return m.nodes().forEach(T=>{x.setNode(T,{label:T}),x.setParent(T,"layer"+m.node(T).rank)}),m.edges().forEach(T=>x.setEdge(T.v,T.w,{},T.name)),_.forEach((T,r)=>{let I="layer"+r;x.setNode(I,{rank:"same"}),T.reduce((k,P)=>(x.setEdge(k,P,{style:"invis"}),P))}),x}return Fw}var Bw,Jk;function eK(){return Jk||(Jk=1,Bw="1.1.5"),Bw}var Nw,Qk;function tK(){return Qk||(Qk=1,Nw={graphlib:xl(),layout:QY(),debug:$Y(),util:{time:ts().time,notime:ts().notime},version:eK()}),Nw}tK();const nK={light:"",dark:".dark"};function $k(s,n,c){if(typeof n!="object"||n===null)return;const m="payload"in n&&typeof n.payload=="object"&&n.payload!==null?n.payload:void 0;let _=c;return n.key===c?_=n.key:n.name===c?_=n.name:c in n&&typeof n[c]=="string"?_=n[c]:m!==void 0&&c in m&&typeof m[c]=="string"&&(_=m[c]),_ in s?s[_]:s[c]}const pL=Symbol("chart-context");function iK(s){return tT(pL,s)}function rK(){return Kg(pL)}function oK(s,n){Yn(n,!0);const c=fe(()=>n.config?Object.entries(n.config).filter(([,r])=>r.theme||r.color):null),m=fe(()=>{if(!A(c)||!A(c).length)return;const r=[];for(let[I,k]of Object.entries(nK)){let P=`${k} [data-chart=${n.id}] {
`;const R=A(c).map(([F,V])=>{const W=I,G=V.theme?.[W]||V.color;return G?`	--color-${F}: ${G};`:null});P+=R.join(`
`)+`
}`,r.push(P)}return r.join(`
`)});var _=Gt(),x=yt(_);{var T=r=>{var I=Gt(),k=yt(I);ex(k,()=>n.id,P=>{var R=Gt(),F=yt(R);gR(F,()=>"style",!1,(V,W)=>{var G=Za();Vi(()=>Es(G,A(m))),je(W,G)}),je(P,R)}),je(r,I)};Zt(x,r=>{A(m)&&r(T)})}je(s,_),Kn()}var sK=Un("<div><!> <!></div>");function aK(s,n){const c=fa();Yn(n,!0);let m=Re(n,"ref",15,null),_=Re(n,"id",3,c),x=bi(n,["$$slots","$$events","$$legacy","ref","id","class","children","config"]);const T=`chart-${_()||c.replace(/:/g,"")}`;iK({get config(){return n.config}});var r=sK();Ii(r,P=>({"data-chart":T,"data-slot":"chart",class:P,...x}),[()=>xs("flex aspect-video justify-center overflow-visible text-xs","[&_.stroke-white]:stroke-transparent","[&_.lc-line]:stroke-border/50","[&_.lc-highlight-line]:stroke-0","[&_.lc-area-path]:opacity-100 [&_.lc-highlight-line]:opacity-100 [&_.lc-highlight-point]:opacity-100 [&_.lc-spline-path]:opacity-100 [&_.lc-text-svg]:overflow-visible [&_.lc-text]:text-xs","[&_.lc-axis-tick]:stroke-0","[&_.lc-rule-x-line:not(.lc-grid-x-rule)]:stroke-0 [&_.lc-rule-y-line:not(.lc-grid-y-rule)]:stroke-0","[&_.lc-grid-x-radial-line]:stroke-border [&_.lc-grid-x-radial-circle]:stroke-border","[&_.lc-grid-y-radial-line]:stroke-border [&_.lc-grid-y-radial-circle]:stroke-border","[&_.lc-legend-swatch-button]:items-center [&_.lc-legend-swatch-button]:gap-1.5","[&_.lc-legend-swatch-group]:items-center [&_.lc-legend-swatch-group]:gap-4","[&_.lc-legend-swatch]:size-2.5 [&_.lc-legend-swatch]:rounded-[2px]","[&_.lc-labels-text:not([fill])]:fill-foreground [&_text]:stroke-transparent","[&_.lc-axis-tick-label]:fill-muted-foreground [&_.lc-axis-tick-label]:font-normal","[&_.lc-tooltip-rects-g]:fill-transparent","[&_.lc-layout-svg-g]:fill-transparent","[&_.lc-root-container]:w-full",n.class)]);var I=Xn(r);oK(I,{get id(){return T},get config(){return n.config}});var k=Tn(I,2);Dn(k,()=>n.children??Si),Ln(r),er(r,P=>m(P),()=>m()),je(s,r),Kn()}var lK=Un("<div><!></div>"),cK=Un("<div></div>"),uK=Un('<span class="text-foreground font-mono font-medium tabular-nums"> </span>'),hK=Un('<!> <div><div class="grid gap-1.5"><!> <span class="text-muted-foreground"> </span></div> <!></div>',1),dK=Un("<div><!></div>"),fK=Un('<div><!> <div class="grid gap-1.5"></div></div>');function pK(s,n){Yn(n,!0);const c=G=>{var K=Gt(),Y=yt(K);{var ne=oe=>{var ce=lK(),me=Xn(ce);{var ue=te=>{var ie=Gt(),xe=yt(ie);Dn(xe,()=>A(R)),je(te,ie)},_e=te=>{var ie=Za();Vi(()=>Es(ie,A(R))),je(te,ie)};Zt(me,te=>{typeof A(R)=="function"?te(ue):te(_e,!1)})}Ln(ce),Vi(te=>Pr(ce,1,te),[()=>Cr(xs("font-medium",n.labelClassName))]),je(oe,ce)};Zt(Y,oe=>{A(R)&&oe(ne)})}je(G,K)};function m(G,K){return`${G}`}Re(n,"ref",11,null);let _=Re(n,"hideLabel",3,!1),x=Re(n,"indicator",3,"dot"),T=Re(n,"hideIndicator",3,!1),r=Re(n,"labelFormatter",3,m),I=bi(n,["$$slots","$$events","$$legacy","ref","class","hideLabel","indicator","hideIndicator","labelKey","label","labelFormatter","labelClassName","formatter","nameKey","color"]);const k=rK(),P=hS(),R=fe(()=>{if(_()||!P.payload?.length)return null;const[G]=P.payload,K=n.labelKey??G?.label??G?.name??"value",Y=$k(k.config,G,K),ne=!n.labelKey&&typeof n.label=="string"?k.config[n.label]?.label??n.label:Y?.label??G.label;return ne===void 0?null:r()?r()(ne,P.payload):ne}),F=fe(()=>P.payload.length===1&&x()!=="dot");var V=Gt(),W=yt(V);mo(W,()=>oL,(G,K)=>{K(G,{variant:"none",children:(Y,ne)=>{var oe=fK();Ii(oe,_e=>({class:_e,...I}),[()=>xs("border-border/50 bg-background grid min-w-[9rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",n.class)]);var ce=Xn(oe);{var me=_e=>{c(_e)};Zt(ce,_e=>{A(F)||_e(me)})}var ue=Tn(ce,2);ro(ue,23,()=>P.payload,(_e,te)=>_e.key+te,(_e,te,ie)=>{const xe=fe(()=>`${n.nameKey||A(te).key||A(te).name||"value"}`),de=fe(()=>$k(k.config,A(te),A(xe))),Te=fe(()=>n.color||A(te).payload?.color||A(te).color);var De=dK(),Be=Xn(De);{var Se=it=>{var qe=Gt(),ft=yt(qe);Dn(ft,()=>n.formatter,()=>({value:A(te).value,name:A(te).name,item:A(te),index:A(ie),payload:P.payload})),je(it,qe)},Ne=it=>{var qe=hK(),ft=yt(qe);{var St=Je=>{var Rt=Gt(),ut=yt(Rt);mo(ut,()=>A(de).icon,(cn,on)=>{on(cn,{})}),je(Je,Rt)},Dt=Je=>{var Rt=Gt(),ut=yt(Rt);{var cn=on=>{var Jt=cK();Vi(vt=>{_l(Jt,`--color-bg: ${A(Te)??""}; --color-border: ${A(Te)??""};`),Pr(Jt,1,vt)},[()=>Cr(xs("border-(--color-border) bg-(--color-bg) shrink-0 rounded-[2px]",{"size-2.5":x()==="dot","h-full w-1":x()==="line","w-0 border-[1.5px] border-dashed bg-transparent":x()==="dashed","my-0.5":A(F)&&x()==="dashed"}))]),je(on,Jt)};Zt(ut,on=>{T()||on(cn)},!0)}je(Je,Rt)};Zt(ft,Je=>{A(de)?.icon?Je(St):Je(Dt,!1)})}var Kt=Tn(ft,2),et=Xn(Kt),Qe=Xn(et);{var st=Je=>{c(Je)};Zt(Qe,Je=>{A(F)&&Je(st)})}var tt=Tn(Qe,2),gt=Xn(tt,!0);Ln(tt),Ln(et);var Lt=Tn(et,2);{var _t=Je=>{var Rt=uK(),ut=Xn(Rt,!0);Ln(Rt),Vi(cn=>Es(ut,cn),[()=>A(te).value.toLocaleString()]),je(Je,Rt)};Zt(Lt,Je=>{A(te).value!==void 0&&Je(_t)})}Ln(Kt),Vi(Je=>{Pr(Kt,1,Je),Es(gt,A(de)?.label||A(te).name)},[()=>Cr(xs("flex flex-1 shrink-0 justify-between leading-none",A(F)?"items-end":"items-center"))]),je(it,qe)};Zt(Be,it=>{n.formatter&&A(te).value!==void 0&&A(te).name?it(Se):it(Ne,!1)})}Ln(De),Vi(it=>Pr(De,1,it),[()=>Cr(xs("[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:size-2.5",x()==="dot"&&"items-center"))]),je(_e,De)}),Ln(ue),Ln(oe),je(Y,oe)},$$slots:{default:!0}})}),je(s,V),Kn()}var mK=Un("<!> <!>",1),gK=Un('<div class="flex w-full items-start gap-2 text-sm"><div class="grid gap-2"><div class="flex items-center gap-2 font-medium leading-none">Trending up by 5.2% this month <!></div> <div class="text-muted-foreground flex items-center gap-2 leading-none">January - June 2024</div></div></div>'),_K=Un("<!> <!> <!>",1);function yK(s,n){Yn(n,!1);const c=[{date:new Date("2024-01-01"),hgv:186,car:80},{date:new Date("2024-02-01"),hgv:305,car:200},{date:new Date("2024-03-01"),hgv:237,car:120},{date:new Date("2024-04-01"),hgv:73,car:190},{date:new Date("2024-05-01"),hgv:209,car:130},{date:new Date("2024-06-01"),hgv:214,car:140}],m={hgv:{label:"HGV",color:"var(--chart-1)"},car:{label:"car",color:"var(--chart-2)"}};iT(),bT(s,{children:(_,x)=>{var T=_K(),r=yt(T);ST(r,{children:(P,R)=>{var F=mK(),V=yt(F);ET(V,{children:(G,K)=>{Yu();var Y=Za("Area Chart - Legend");je(G,Y)},$$slots:{default:!0}});var W=Tn(V,2);wT(W,{children:(G,K)=>{Yu();var Y=Za("Showing a pretend data about the query");je(G,Y)},$$slots:{default:!0}}),je(P,F)},$$slots:{default:!0}});var I=Tn(r,2);OV(I,{children:(P,R)=>{aK(P,{get config(){return m},children:(F,V)=>{{const W=ne=>{pK(ne,{labelFormatter:oe=>oe.toLocaleDateString("en-US",{month:"long"}),indicator:"line"})};let G=Yv(pq),K=Yv(()=>[{key:"hgv",label:"HGV",color:m.hgv.color},{key:"car",label:"Car",color:m.car.color}]),Y=Yv(()=>({area:{curve:nW,"fill-opacity":.4,line:{class:"stroke-1"},motion:"tween"},xAxis:{format:ne=>ne.toLocaleDateString("en-US",{month:"short"})},yAxis:{format:()=>""}}));yY(F,{legend:!0,get data(){return c},x:"date",get xScale(){return A(G)},yPadding:[0,25],get series(){return A(K)},seriesLayout:"stack",get props(){return A(Y)},tooltip:W,$$slots:{tooltip:!0}})}},$$slots:{default:!0}})},$$slots:{default:!0}});var k=Tn(I,2);TT(k,{children:(P,R)=>{var F=gK(),V=Xn(F),W=Xn(V),G=Tn(Xn(W));k5(G,{class:"size-4"}),Ln(W),Yu(2),Ln(V),Ln(F),je(P,F)},$$slots:{default:!0}}),je(_,T)},$$slots:{default:!0}}),Kn()}var vK=Un("<!> <!>",1),xK=Un("<!> <!>",1);function bK(s,n){Yn(n,!0);var c=Gt(),m=yt(c);mo(m,()=>bT,(_,x)=>{x(_,{class:"w-[15em] text-s mb-2",children:(T,r)=>{var I=xK(),k=yt(I);mo(k,()=>ST,(R,F)=>{F(R,{children:(V,W)=>{var G=vK(),K=yt(G);mo(K,()=>ET,(ne,oe)=>{oe(ne,{children:(ce,me)=>{Yu();var ue=Za("Traffic Light");je(ce,ue)},$$slots:{default:!0}})});var Y=Tn(K,2);mo(Y,()=>wT,(ne,oe)=>{oe(ne,{class:"text-xs",children:(ce,me)=>{Yu();var ue=Za();Vi(()=>Es(ue,`${n.feature.properties.Address??""} - ${n.feature.properties.Postcode??""}`)),je(ce,ue)},$$slots:{default:!0}})}),je(V,G)},$$slots:{default:!0}})});var P=Tn(k,2);mo(P,()=>TT,(R,F)=>{F(R,{class:"flex-col gap-2"})}),je(T,I)},$$slots:{default:!0}})}),je(s,c),Kn()}var wK=Un('<span class="font-semibold w-full h-full flex overflow-auto p-2"><div class="overflow-auto h-full p-1 max-w-[50%] w-fit"></div> <div class="overflow-auto h-full p-1 max-w-[50%] w-fit"></div> <div class="overflow-auto h-full p-1 max-w-[50%] w-fit"><!></div></span>');function TK(s,n){Yn(n,!1),iT();var c=wK(),m=Xn(c);ro(m,5,()=>xr.highlightedTrafficLights,cs,(I,k)=>{bK(I,{get feature(){return A(k)}})}),Ln(m);var _=Tn(m,2);ro(_,5,()=>xr.affectedBusRoutes,cs,(I,k)=>{GV(I,{get busRoute(){return A(k)}})}),Ln(_);var x=Tn(_,2),T=Xn(x);{var r=I=>{yK(I,{})};Zt(T,I=>{xr.highlightedTrafficLights.length>0&&I(r)})}Ln(x),Ln(c),je(s,c),Kn()}var SK=Un('<div class="h-full p-2 flex flex-col"><div class="w-full flex-shrink-0"><!></div> <div class="flex-1 overflow-auto"></div> <div class="w-full flex-shrink-0"><!></div></div>'),EK=Un('<!> <!> <span class="sr-only">Toggle theme</span>',1),AK=Un('<div class="flex flex-col h-full items-center justify-center"><div class="w-full p-2 flex justify-start items-center"><!> <h2 class="pr-2">Map</h2> <div class="grow"></div> <div><!></div></div> <!></div>'),IK=Un('<div class="flex h-full items-center justify-center"><!></div>'),MK=Un("<!> <!> <!>",1),CK=Un("<!> <!>",1),PK=Un("<!> <!> <!>",1);function HK(s,n){Yn(n,!0);let c=Mn(void 0),m=Mn(!1);Os(()=>{xr.MapApp?.resize()});var _=PK(),x=yt(_);EN(x,{defaultMode:"dark"});var T=Tn(x,2);mo(T,()=>VM,(I,k)=>{k(I,{direction:"horizontal",class:"w-screen grow border",onLayoutChange:()=>xr.MapApp?.resize(),children:(P,R)=>{var F=CK(),V=yt(F);mo(V,()=>Ev,(G,K)=>{er(K(G,{defaultSize:20,minSize:20,maxSize:20,class:"border-r",collapsedSize:0,collapsible:!0,onResize:()=>xr.MapApp?.resize(),onCollapse:()=>xr.MapApp?.resize(),onExpand:()=>xr.MapApp?.resize(),children:(Y,ne)=>{var oe=SK(),ce=Xn(oe),me=Xn(ce);CV(me),Ln(ce);var ue=Tn(ce,4),_e=Xn(ue);kV(_e),Ln(ue),Ln(oe),je(Y,oe)},$$slots:{default:!0}}),Y=>rn(c,Y,!0),()=>A(c))});var W=Tn(V,2);mo(W,()=>Ev,(G,K)=>{K(G,{defaultSize:80,minSize:80,onResize:()=>xr.MapApp?.resize(),children:(Y,ne)=>{var oe=Gt(),ce=yt(oe);mo(ce,()=>VM,(me,ue)=>{ue(me,{direction:"vertical",onLayoutChange:()=>xr.MapApp?.resize(),children:(_e,te)=>{var ie=MK(),xe=yt(ie);mo(xe,()=>Ev,(De,Be)=>{Be(De,{defaultSize:75,onResize:()=>xr.MapApp?.resize(),children:(Se,Ne)=>{var it=AK(),qe=Xn(it),ft=Xn(qe);o2(ft,{variant:"outline",size:"icon-sm",class:"mr-5",onclick:()=>{A(m)?(A(c).expand(),rn(m,!1)):(A(c).collapse(),rn(m,!0))},children:(et,Qe)=>{C5(et,{class:"h-[1.2rem] w-[1.2rem]"})},$$slots:{default:!0}});var St=Tn(ft,6),Dt=Xn(St);o2(Dt,{get onclick(){return gN},variant:"outline",size:"icon-sm",children:(et,Qe)=>{var st=EK(),tt=yt(st);P5(tt,{class:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 !transition-all dark:-rotate-90 dark:scale-0"});var gt=Tn(tt,2);M5(gt,{class:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 !transition-all dark:rotate-0 dark:scale-100"}),Yu(2),je(et,st)},$$slots:{default:!0}}),Ln(St),Ln(qe);var Kt=Tn(qe,2);mV(Kt,{}),Ln(it),je(Se,it)},$$slots:{default:!0}})});var de=Tn(xe,2);mo(de,()=>fV,(De,Be)=>{Be(De,{})});var Te=Tn(de,2);mo(Te,()=>Ev,(De,Be)=>{Be(De,{defaultSize:25,children:(Se,Ne)=>{var it=IK(),qe=Xn(it);TK(qe,{}),Ln(it),je(Se,it)},$$slots:{default:!0}})}),je(_e,ie)},$$slots:{default:!0}})}),je(Y,oe)},$$slots:{default:!0}})}),je(P,F)},$$slots:{default:!0}})});var r=Tn(T,2);zV(r,{}),je(s,_),Kn()}export{HK as component};
